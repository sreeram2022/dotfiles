"use strict";var zY=Object.create;var NS=Object.defineProperty;var Fj=Object.getOwnPropertyDescriptor;var QY=Object.getOwnPropertyNames;var YY=Object.getPrototypeOf,XY=Object.prototype.hasOwnProperty;var ZY=(r,e)=>()=>(r&&(e=r(r=0)),e);var M=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Lj=(r,e)=>{for(var t in e)NS(r,t,{get:e[t],enumerable:!0})},Uj=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of QY(e))!XY.call(r,i)&&i!==t&&NS(r,i,{get:()=>e[i],enumerable:!(n=Fj(e,i))||n.enumerable});return r};var D=(r,e,t)=>(t=r!=null?zY(YY(r)):{},Uj(e||!r||!r.__esModule?NS(t,"default",{value:r,enumerable:!0}):t,r)),jj=r=>Uj(NS({},"__esModule",{value:!0}),r),v=(r,e,t,n)=>{for(var i=n>1?void 0:n?Fj(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&NS(e,t,i),i},d=(r,e)=>(t,n)=>e(t,n,r);var Vj=M(()=>{var Wj;(function(r){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof t.Reflect>"u"?t.Reflect=r:n=i(t.Reflect,n),e(n);function i(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,l={create:s?function(){return sn(Object.create(null))}:a?function(){return sn({__proto__:null})}:function(){return sn({})},has:c?function(H,ie){return t.call(H,ie)}:function(H,ie){return ie in H},get:c?function(H,ie){return t.call(H,ie)?H[ie]:void 0}:function(H,ie){return H[ie]}},u=Object.getPrototypeOf(Function),p=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",m=!p&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:kr(),h=!p&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Gr(),g=!p&&typeof WeakMap=="function"?WeakMap:Ar(),y=new g;function x(H,ie,ge,Ee){if(Pt(ge)){if(!Ml(H))throw new TypeError;if(!V(ie))throw new TypeError;return Ce(H,ie)}else{if(!Ml(H))throw new TypeError;if(!Bt(ie))throw new TypeError;if(!Bt(Ee)&&!Pt(Ee)&&!Hr(Ee))throw new TypeError;return Hr(Ee)&&(Ee=void 0),ge=si(ge),Le(H,ie,ge,Ee)}}e("decorate",x);function E(H,ie){function ge(Ee,ze){if(!Bt(Ee))throw new TypeError;if(!Pt(ze)&&!be(ze))throw new TypeError;X(H,ie,Ee,ze)}return ge}e("metadata",E);function A(H,ie,ge,Ee){if(!Bt(ge))throw new TypeError;return Pt(Ee)||(Ee=si(Ee)),X(H,ie,ge,Ee)}e("defineMetadata",A);function T(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=si(ge)),ft(H,ie,ge)}e("hasMetadata",T);function j(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=si(ge)),rt(H,ie,ge)}e("hasOwnMetadata",j);function oe(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=si(ge)),ae(H,ie,ge)}e("getMetadata",oe);function G(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=si(ge)),ke(H,ie,ge)}e("getOwnMetadata",G);function ue(H,ie){if(!Bt(H))throw new TypeError;return Pt(ie)||(ie=si(ie)),ye(H,ie)}e("getMetadataKeys",ue);function pe(H,ie){if(!Bt(H))throw new TypeError;return Pt(ie)||(ie=si(ie)),qe(H,ie)}e("getOwnMetadataKeys",pe);function te(H,ie,ge){if(!Bt(ie))throw new TypeError;Pt(ge)||(ge=si(ge));var Ee=ct(ie,ge,!1);if(Pt(Ee)||!Ee.delete(H))return!1;if(Ee.size>0)return!0;var ze=y.get(ie);return ze.delete(ge),ze.size>0||y.delete(ie),!0}e("deleteMetadata",te);function Ce(H,ie){for(var ge=H.length-1;ge>=0;--ge){var Ee=H[ge],ze=Ee(ie);if(!Pt(ze)&&!Hr(ze)){if(!V(ze))throw new TypeError;ie=ze}}return ie}function Le(H,ie,ge,Ee){for(var ze=H.length-1;ze>=0;--ze){var an=H[ze],kt=an(ie,ge,Ee);if(!Pt(kt)&&!Hr(kt)){if(!Bt(kt))throw new TypeError;Ee=kt}}return Ee}function ct(H,ie,ge){var Ee=y.get(H);if(Pt(Ee)){if(!ge)return;Ee=new m,y.set(H,Ee)}var ze=Ee.get(ie);if(Pt(ze)){if(!ge)return;ze=new m,Ee.set(ie,ze)}return ze}function ft(H,ie,ge){var Ee=rt(H,ie,ge);if(Ee)return!0;var ze=Ot(ie);return Hr(ze)?!1:ft(H,ze,ge)}function rt(H,ie,ge){var Ee=ct(ie,ge,!1);return Pt(Ee)?!1:Mt(Ee.has(H))}function ae(H,ie,ge){var Ee=rt(H,ie,ge);if(Ee)return ke(H,ie,ge);var ze=Ot(ie);if(!Hr(ze))return ae(H,ze,ge)}function ke(H,ie,ge){var Ee=ct(ie,ge,!1);if(!Pt(Ee))return Ee.get(H)}function X(H,ie,ge,Ee){var ze=ct(ge,Ee,!0);ze.set(H,ie)}function ye(H,ie){var ge=qe(H,ie),Ee=Ot(H);if(Ee===null)return ge;var ze=ye(Ee,ie);if(ze.length<=0)return ge;if(ge.length<=0)return ze;for(var an=new h,kt=[],Rt=0,it=ge;Rt<it.length;Rt++){var jt=it[Rt],se=an.has(jt);se||(an.add(jt),kt.push(jt))}for(var fe=0,q=ze;fe<q.length;fe++){var jt=q[fe],se=an.has(jt);se||(an.add(jt),kt.push(jt))}return kt}function qe(H,ie){var ge=[],Ee=ct(H,ie,!1);if(Pt(Ee))return ge;for(var ze=Ee.keys(),an=nt(ze),kt=0;;){var Rt=Ht(an);if(!Rt)return ge.length=kt,ge;var it=on(Rt);try{ge[kt]=it}catch(jt){try{Wt(an)}finally{throw jt}}kt++}}function hn(H){if(H===null)return 1;switch(typeof H){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return H===null?1:6;default:return 6}}function Pt(H){return H===void 0}function Hr(H){return H===null}function xs(H){return typeof H=="symbol"}function Bt(H){return typeof H=="object"?H!==null:typeof H=="function"}function nn(H,ie){switch(hn(H)){case 0:return H;case 1:return H;case 2:return H;case 3:return H;case 4:return H;case 5:return H}var ge=ie===3?"string":ie===5?"number":"default",Ee=Oe(H,i);if(Ee!==void 0){var ze=Ee.call(H,ge);if(Bt(ze))throw new TypeError;return ze}return Gi(H,ge==="default"?"number":ge)}function Gi(H,ie){if(ie==="string"){var ge=H.toString;if(L(ge)){var Ee=ge.call(H);if(!Bt(Ee))return Ee}var ze=H.valueOf;if(L(ze)){var Ee=ze.call(H);if(!Bt(Ee))return Ee}}else{var ze=H.valueOf;if(L(ze)){var Ee=ze.call(H);if(!Bt(Ee))return Ee}var an=H.toString;if(L(an)){var Ee=an.call(H);if(!Bt(Ee))return Ee}}throw new TypeError}function Mt(H){return!!H}function ur(H){return""+H}function si(H){var ie=nn(H,3);return xs(ie)?ie:ur(ie)}function Ml(H){return Array.isArray?Array.isArray(H):H instanceof Object?H instanceof Array:Object.prototype.toString.call(H)==="[object Array]"}function L(H){return typeof H=="function"}function V(H){return typeof H=="function"}function be(H){switch(hn(H)){case 3:return!0;case 4:return!0;default:return!1}}function Oe(H,ie){var ge=H[ie];if(ge!=null){if(!L(ge))throw new TypeError;return ge}}function nt(H){var ie=Oe(H,o);if(!L(ie))throw new TypeError;var ge=ie.call(H);if(!Bt(ge))throw new TypeError;return ge}function on(H){return H.value}function Ht(H){var ie=H.next();return ie.done?!1:ie}function Wt(H){var ie=H.return;ie&&ie.call(H)}function Ot(H){var ie=Object.getPrototypeOf(H);if(typeof H!="function"||H===u||ie!==u)return ie;var ge=H.prototype,Ee=ge&&Object.getPrototypeOf(ge);if(Ee==null||Ee===Object.prototype)return ie;var ze=Ee.constructor;return typeof ze!="function"||ze===H?ie:ze}function kr(){var H={},ie=[],ge=function(){function kt(Rt,it,jt){this._index=0,this._keys=Rt,this._values=it,this._selector=jt}return kt.prototype["@@iterator"]=function(){return this},kt.prototype[o]=function(){return this},kt.prototype.next=function(){var Rt=this._index;if(Rt>=0&&Rt<this._keys.length){var it=this._selector(this._keys[Rt],this._values[Rt]);return Rt+1>=this._keys.length?(this._index=-1,this._keys=ie,this._values=ie):this._index++,{value:it,done:!1}}return{value:void 0,done:!0}},kt.prototype.throw=function(Rt){throw this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),Rt},kt.prototype.return=function(Rt){return this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),{value:Rt,done:!0}},kt}();return function(){function kt(){this._keys=[],this._values=[],this._cacheKey=H,this._cacheIndex=-2}return Object.defineProperty(kt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),kt.prototype.has=function(Rt){return this._find(Rt,!1)>=0},kt.prototype.get=function(Rt){var it=this._find(Rt,!1);return it>=0?this._values[it]:void 0},kt.prototype.set=function(Rt,it){var jt=this._find(Rt,!0);return this._values[jt]=it,this},kt.prototype.delete=function(Rt){var it=this._find(Rt,!1);if(it>=0){for(var jt=this._keys.length,se=it+1;se<jt;se++)this._keys[se-1]=this._keys[se],this._values[se-1]=this._values[se];return this._keys.length--,this._values.length--,Rt===this._cacheKey&&(this._cacheKey=H,this._cacheIndex=-2),!0}return!1},kt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=H,this._cacheIndex=-2},kt.prototype.keys=function(){return new ge(this._keys,this._values,Ee)},kt.prototype.values=function(){return new ge(this._keys,this._values,ze)},kt.prototype.entries=function(){return new ge(this._keys,this._values,an)},kt.prototype["@@iterator"]=function(){return this.entries()},kt.prototype[o]=function(){return this.entries()},kt.prototype._find=function(Rt,it){return this._cacheKey!==Rt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Rt)),this._cacheIndex<0&&it&&(this._cacheIndex=this._keys.length,this._keys.push(Rt),this._values.push(void 0)),this._cacheIndex},kt}();function Ee(kt,Rt){return kt}function ze(kt,Rt){return Rt}function an(kt,Rt){return[kt,Rt]}}function Gr(){return function(){function H(){this._map=new m}return Object.defineProperty(H.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),H.prototype.has=function(ie){return this._map.has(ie)},H.prototype.add=function(ie){return this._map.set(ie,ie),this},H.prototype.delete=function(ie){return this._map.delete(ie)},H.prototype.clear=function(){this._map.clear()},H.prototype.keys=function(){return this._map.keys()},H.prototype.values=function(){return this._map.values()},H.prototype.entries=function(){return this._map.entries()},H.prototype["@@iterator"]=function(){return this.keys()},H.prototype[o]=function(){return this.keys()},H}()}function Ar(){var H=16,ie=l.create(),ge=Ee();return function(){function it(){this._key=Ee()}return it.prototype.has=function(jt){var se=ze(jt,!1);return se!==void 0?l.has(se,this._key):!1},it.prototype.get=function(jt){var se=ze(jt,!1);return se!==void 0?l.get(se,this._key):void 0},it.prototype.set=function(jt,se){var fe=ze(jt,!0);return fe[this._key]=se,this},it.prototype.delete=function(jt){var se=ze(jt,!1);return se!==void 0?delete se[this._key]:!1},it.prototype.clear=function(){this._key=Ee()},it}();function Ee(){var it;do it="@@WeakMap@@"+Rt();while(l.has(ie,it));return ie[it]=!0,it}function ze(it,jt){if(!t.call(it,ge)){if(!jt)return;Object.defineProperty(it,ge,{value:l.create()})}return it[ge]}function an(it,jt){for(var se=0;se<jt;++se)it[se]=Math.random()*255|0;return it}function kt(it){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(it)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(it)):an(new Uint8Array(it),it):an(new Array(it),it)}function Rt(){var it=kt(H);it[6]=it[6]&79|64,it[8]=it[8]&191|128;for(var jt="",se=0;se<H;++se){var fe=it[se];(se===4||se===6||se===8)&&(jt+="-"),fe<16&&(jt+="0"),jt+=fe.toString(16).toLowerCase()}return jt}}function sn(H){return H.__=void 0,delete H.__,H}})})(Wj||(Wj={}))});var Bj={};Lj(Bj,{isPreRelesVersionOfJupyterExtension:()=>eX});var eX,qj=ZY(()=>{"use strict";eX=!1});var Rn=M(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.NON_CUSTOM_TAG_KEYS=Xt.PRE_DESTROY=Xt.POST_CONSTRUCT=Xt.DESIGN_PARAM_TYPES=Xt.PARAM_TYPES=Xt.TAGGED_PROP=Xt.TAGGED=Xt.MULTI_INJECT_TAG=Xt.INJECT_TAG=Xt.OPTIONAL_TAG=Xt.UNMANAGED_TAG=Xt.NAME_TAG=Xt.NAMED_TAG=void 0;Xt.NAMED_TAG="named";Xt.NAME_TAG="name";Xt.UNMANAGED_TAG="unmanaged";Xt.OPTIONAL_TAG="optional";Xt.INJECT_TAG="inject";Xt.MULTI_INJECT_TAG="multi_inject";Xt.TAGGED="inversify:tagged";Xt.TAGGED_PROP="inversify:tagged_props";Xt.PARAM_TYPES="inversify:paramtypes";Xt.DESIGN_PARAM_TYPES="design:paramtypes";Xt.POST_CONSTRUCT="post_construct";Xt.PRE_DESTROY="pre_destroy";function OX(){return[Xt.INJECT_TAG,Xt.MULTI_INJECT_TAG,Xt.NAME_TAG,Xt.UNMANAGED_TAG,Xt.NAMED_TAG,Xt.OPTIONAL_TAG]}Xt.NON_CUSTOM_TAG_KEYS=OX()});var xa=M(ap=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});ap.TargetTypeEnum=ap.BindingTypeEnum=ap.BindingScopeEnum=void 0;var KX={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ap.BindingScopeEnum=KX;var FX={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ap.BindingTypeEnum=FX;var LX={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ap.TargetTypeEnum=LX});var cp=M(hE=>{"use strict";Object.defineProperty(hE,"__esModule",{value:!0});hE.id=void 0;var UX=0;function jX(){return UX++}hE.id=jX});var K2=M(gE=>{"use strict";Object.defineProperty(gE,"__esModule",{value:!0});gE.Binding=void 0;var O2=xa(),WX=cp(),VX=function(){function r(e,t){this.id=(0,WX.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=O2.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return r.prototype.clone=function(){var e=new r(this.serviceIdentifier,this.scope);return e.activated=e.scope===O2.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},r}();gE.Binding=VX});var Ri=M(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.STACK_OVERFLOW=Ue.CIRCULAR_DEPENDENCY_IN_FACTORY=Ue.ON_DEACTIVATION_ERROR=Ue.PRE_DESTROY_ERROR=Ue.POST_CONSTRUCT_ERROR=Ue.ASYNC_UNBIND_REQUIRED=Ue.MULTIPLE_POST_CONSTRUCT_METHODS=Ue.MULTIPLE_PRE_DESTROY_METHODS=Ue.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ue.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ue.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ue.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ue.ARGUMENTS_LENGTH_MISMATCH=Ue.INVALID_DECORATOR_OPERATION=Ue.INVALID_TO_SELF_VALUE=Ue.LAZY_IN_SYNC=Ue.INVALID_FUNCTION_BINDING=Ue.INVALID_MIDDLEWARE_RETURN=Ue.NO_MORE_SNAPSHOTS_AVAILABLE=Ue.INVALID_BINDING_TYPE=Ue.NOT_IMPLEMENTED=Ue.CIRCULAR_DEPENDENCY=Ue.UNDEFINED_INJECT_ANNOTATION=Ue.MISSING_INJECT_ANNOTATION=Ue.MISSING_INJECTABLE_ANNOTATION=Ue.NOT_REGISTERED=Ue.CANNOT_UNBIND=Ue.AMBIGUOUS_MATCH=Ue.KEY_NOT_FOUND=Ue.NULL_ARGUMENT=Ue.DUPLICATED_METADATA=Ue.DUPLICATED_INJECTABLE_DECORATOR=void 0;Ue.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";Ue.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";Ue.NULL_ARGUMENT="NULL argument";Ue.KEY_NOT_FOUND="Key Not Found";Ue.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";Ue.CANNOT_UNBIND="Could not unbind serviceIdentifier:";Ue.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";Ue.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";Ue.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var BX=function(r){return"@inject called with undefined this could mean that the class "+r+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ue.UNDEFINED_INJECT_ANNOTATION=BX;Ue.CIRCULAR_DEPENDENCY="Circular dependency found:";Ue.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";Ue.INVALID_BINDING_TYPE="Invalid binding type:";Ue.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";Ue.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";Ue.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var qX=function(r){return"You are attempting to construct '"+r+`' in a synchronous way
 but it has asynchronous dependencies.`};Ue.LAZY_IN_SYNC=qX;Ue.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";Ue.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var JX=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return"The number of constructor arguments in the derived class "+(r[0]+" must be >= than the number of constructor arguments of its base class.")};Ue.ARGUMENTS_LENGTH_MISMATCH=JX;Ue.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";Ue.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";Ue.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";Ue.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";Ue.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";Ue.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Ue.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var $X=function(r,e){return"@postConstruct error in class "+r+": "+e};Ue.POST_CONSTRUCT_ERROR=$X;var HX=function(r,e){return"@preDestroy error in class "+r+": "+e};Ue.PRE_DESTROY_ERROR=HX;var GX=function(r,e){return"onDeactivation() error in class "+r+": "+e};Ue.ON_DEACTIVATION_ERROR=GX;var zX=function(r,e){return"It looks like there is a circular dependency in one of the '"+r+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};Ue.CIRCULAR_DEPENDENCY_IN_FACTORY=zX;Ue.STACK_OVERFLOW="Maximum call stack size exceeded"});var TA=M(cc=>{"use strict";var QX=cc&&cc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),YX=cc&&cc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),XX=cc&&cc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&QX(e,r,t);return YX(e,r),e};Object.defineProperty(cc,"__esModule",{value:!0});cc.MetadataReader=void 0;var _A=XX(Rn()),ZX=function(){function r(){}return r.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(_A.PARAM_TYPES,e),n=Reflect.getMetadata(_A.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},r.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(_A.TAGGED_PROP,e)||[];return t},r}();cc.MetadataReader=ZX});var F2=M(vE=>{"use strict";Object.defineProperty(vE,"__esModule",{value:!0});vE.BindingCount=void 0;var eZ={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};vE.BindingCount=eZ});var RA=M(Ds=>{"use strict";var tZ=Ds&&Ds.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),rZ=Ds&&Ds.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),nZ=Ds&&Ds.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&tZ(e,r,t);return rZ(e,r),e};Object.defineProperty(Ds,"__esModule",{value:!0});Ds.tryAndThrowErrorIfStackOverflow=Ds.isStackOverflowExeption=void 0;var iZ=nZ(Ri());function L2(r){return r instanceof RangeError||r.message===iZ.STACK_OVERFLOW}Ds.isStackOverflowExeption=L2;var oZ=function(r,e){try{return r()}catch(t){throw L2(t)&&(t=e()),t}};Ds.tryAndThrowErrorIfStackOverflow=oZ});var Lh=M(An=>{"use strict";var sZ=An&&An.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),aZ=An&&An.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),cZ=An&&An.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&sZ(e,r,t);return aZ(e,r),e};Object.defineProperty(An,"__esModule",{value:!0});An.getSymbolDescription=An.circularDependencyToException=An.listMetadataForTarget=An.listRegisteredBindingsForServiceIdentifier=An.getServiceIdentifierAsString=An.getFunctionName=void 0;var lZ=cZ(Ri());function U2(r){if(typeof r=="function"){var e=r;return e.name}else{if(typeof r=="symbol")return r.toString();var e=r;return e}}An.getServiceIdentifierAsString=U2;function uZ(r,e,t){var n="",i=t(r,e);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=V2(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}An.listRegisteredBindingsForServiceIdentifier=uZ;function j2(r,e){return r.parentRequest===null?!1:r.parentRequest.serviceIdentifier===e?!0:j2(r.parentRequest,e)}function pZ(r){function e(n,i){i===void 0&&(i=[]);var o=U2(n.serviceIdentifier);return i.push(o),n.parentRequest!==null?e(n.parentRequest,i):i}var t=e(r);return t.reverse().join(" --> ")}function W2(r){r.childRequests.forEach(function(e){if(j2(e,e.serviceIdentifier)){var t=pZ(e);throw new Error(lZ.CIRCULAR_DEPENDENCY+" "+t)}else W2(e)})}An.circularDependencyToException=W2;function dZ(r,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),i=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+r+`
 `+r+" - "+t}else return" "+r}An.listMetadataForTarget=dZ;function V2(r){if(r.name)return r.name;var e=r.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}An.getFunctionName=V2;function mZ(r){return r.toString().slice(7,-1)}An.getSymbolDescription=mZ});var B2=M(yE=>{"use strict";Object.defineProperty(yE,"__esModule",{value:!0});yE.Context=void 0;var fZ=cp(),hZ=function(){function r(e){this.id=(0,fZ.id)(),this.container=e}return r.prototype.addPlan=function(e){this.plan=e},r.prototype.setCurrentRequest=function(e){this.currentRequest=e},r}();yE.Context=hZ});var Ca=M(lc=>{"use strict";var gZ=lc&&lc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vZ=lc&&lc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),yZ=lc&&lc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gZ(e,r,t);return vZ(e,r),e};Object.defineProperty(lc,"__esModule",{value:!0});lc.Metadata=void 0;var bZ=yZ(Rn()),IZ=function(){function r(e,t){this.key=e,this.value=t}return r.prototype.toString=function(){return this.key===bZ.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},r}();lc.Metadata=IZ});var q2=M(bE=>{"use strict";Object.defineProperty(bE,"__esModule",{value:!0});bE.Plan=void 0;var SZ=function(){function r(e,t){this.parentContext=e,this.rootRequest=t}return r}();bE.Plan=SZ});var AA=M(IE=>{"use strict";Object.defineProperty(IE,"__esModule",{value:!0});IE.LazyServiceIdentifer=void 0;var xZ=function(){function r(e){this._cb=e}return r.prototype.unwrap=function(){return this._cb()},r}();IE.LazyServiceIdentifer=xZ});var J2=M(SE=>{"use strict";Object.defineProperty(SE,"__esModule",{value:!0});SE.QueryableString=void 0;var CZ=function(){function r(e){this.str=e}return r.prototype.startsWith=function(e){return this.str.indexOf(e)===0},r.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},r.prototype.contains=function(e){return this.str.indexOf(e)!==-1},r.prototype.equals=function(e){return this.str===e},r.prototype.value=function(){return this.str},r}();SE.QueryableString=CZ});var NA=M(uc=>{"use strict";var wZ=uc&&uc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),EZ=uc&&uc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),PZ=uc&&uc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&wZ(e,r,t);return EZ(e,r),e};Object.defineProperty(uc,"__esModule",{value:!0});uc.Target=void 0;var Vl=PZ(Rn()),kZ=cp(),DZ=Lh(),$2=Ca(),_Z=J2(),TZ=function(){function r(e,t,n,i){this.id=(0,kZ.id)(),this.type=e,this.serviceIdentifier=n;var o=typeof t=="symbol"?(0,DZ.getSymbolDescription)(t):t;this.name=new _Z.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new $2.Metadata(Vl.NAMED_TAG,i):i instanceof $2.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return r.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var i=n[t];if(i.key===e)return!0}return!1},r.prototype.isArray=function(){return this.hasTag(Vl.MULTI_INJECT_TAG)},r.prototype.matchesArray=function(e){return this.matchesTag(Vl.MULTI_INJECT_TAG)(e)},r.prototype.isNamed=function(){return this.hasTag(Vl.NAMED_TAG)},r.prototype.isTagged=function(){return this.metadata.some(function(e){return Vl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},r.prototype.isOptional=function(){return this.matchesTag(Vl.OPTIONAL_TAG)(!0)},r.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Vl.NAMED_TAG})[0]:null},r.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Vl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},r.prototype.matchesNamedTag=function(e){return this.matchesTag(Vl.NAMED_TAG)(e)},r.prototype.matchesTag=function(e){var t=this;return function(n){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===n)return!0}return!1}},r}();uc.Target=TZ});var eW=M(Ai=>{"use strict";var RZ=Ai&&Ai.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),AZ=Ai&&Ai.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),H2=Ai&&Ai.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&RZ(e,r,t);return AZ(e,r),e},xE=Ai&&Ai.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Ai,"__esModule",{value:!0});Ai.getFunctionName=Ai.getBaseClassDependencyCount=Ai.getDependencies=void 0;var NZ=AA(),MA=H2(Ri()),G2=xa(),QS=H2(Rn()),OA=Lh();Object.defineProperty(Ai,"getFunctionName",{enumerable:!0,get:function(){return OA.getFunctionName}});var z2=NA();function MZ(r,e){var t=(0,OA.getFunctionName)(e);return Q2(r,t,e,!1)}Ai.getDependencies=MZ;function Q2(r,e,t,n){var i=r.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=MA.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,c=Object.keys(a),l=t.length===0&&c.length>0,u=c.length>t.length,p=l||u?c.length:t.length,m=KZ(n,e,o,a,p),h=Y2(r,t,e),g=xE(xE([],m,!0),h,!0);return g}function OZ(r,e,t,n,i){var o=i[r.toString()]||[],s=Z2(o),a=s.unmanaged!==!0,c=n[r],l=s.inject||s.multiInject;if(c=l||c,c instanceof NZ.LazyServiceIdentifer&&(c=c.unwrap()),a){var u=c===Object,p=c===Function,m=c===void 0,h=u||p||m;if(!e&&h){var g=MA.MISSING_INJECT_ANNOTATION+" argument "+r+" in class "+t+".";throw new Error(g)}var y=new z2.Target(G2.TargetTypeEnum.ConstructorArgument,s.targetName,c);return y.metadata=o,y}return null}function KZ(r,e,t,n,i){for(var o=[],s=0;s<i;s++){var a=s,c=OZ(a,r,e,t,n);c!==null&&o.push(c)}return o}function FZ(r,e,t,n){var i=r||e;if(i===void 0){var o=MA.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+n+".";throw new Error(o)}return i}function Y2(r,e,t){for(var n=r.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(n),s=Object.keys(n),a=s.concat(o),c=0,l=a;c<l.length;c++){var u=l[c],p=n[u],m=Z2(p),h=m.targetName||u,g=FZ(m.inject,m.multiInject,u,t),y=new z2.Target(G2.TargetTypeEnum.ClassProperty,h,g);y.metadata=p,i.push(y)}var x=Object.getPrototypeOf(e.prototype).constructor;if(x!==Object){var E=Y2(r,x,t);i=xE(xE([],i,!0),E,!0)}return i}function X2(r,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=(0,OA.getFunctionName)(t),i=Q2(r,n,t,!0),o=i.map(function(c){return c.metadata.filter(function(l){return l.key===QS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:X2(r,t)}else return 0}Ai.getBaseClassDependencyCount=X2;function Z2(r){var e={};return r.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[QS.INJECT_TAG],multiInject:e[QS.MULTI_INJECT_TAG],targetName:e[QS.NAME_TAG],unmanaged:e[QS.UNMANAGED_TAG]}}});var tW=M(CE=>{"use strict";Object.defineProperty(CE,"__esModule",{value:!0});CE.Request=void 0;var LZ=cp(),UZ=function(){function r(e,t,n,i,o){this.id=(0,LZ.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return r.prototype.addChildRequest=function(e,t,n){var i=new r(e,this.parentContext,this,t,n);return this.childRequests.push(i),i},r}();CE.Request=UZ});var jA=M(ho=>{"use strict";var jZ=ho&&ho.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),WZ=ho&&ho.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),iW=ho&&ho.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&jZ(e,r,t);return WZ(e,r),e};Object.defineProperty(ho,"__esModule",{value:!0});ho.getBindingDictionary=ho.createMockRequest=ho.plan=void 0;var wE=F2(),FA=iW(Ri()),oW=xa(),rW=iW(Rn()),VZ=RA(),Uh=Lh(),sW=B2(),LA=Ca(),BZ=q2(),KA=eW(),UA=tW(),aW=NA();function cW(r){return r._bindingDictionary}ho.getBindingDictionary=cW;function qZ(r,e,t,n,i,o){var s=r?rW.MULTI_INJECT_TAG:rW.INJECT_TAG,a=new LA.Metadata(s,t),c=new aW.Target(e,n,t,a);if(i!==void 0){var l=new LA.Metadata(i,o);c.metadata.push(l)}return c}function nW(r,e,t,n,i){var o=YS(t.container,i.serviceIdentifier),s=[];return o.length===wE.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&r.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=YS(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new UA.Request(a.serviceIdentifier,t,n,a,i);return a.constraint(c)}),JZ(i.serviceIdentifier,s,i,t.container),s}function JZ(r,e,t,n){switch(e.length){case wE.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,Uh.getServiceIdentifierAsString)(r),o=FA.NOT_REGISTERED;throw o+=(0,Uh.listMetadataForTarget)(i,t),o+=(0,Uh.listRegisteredBindingsForServiceIdentifier)(n,i,YS),new Error(o);case wE.BindingCount.OnlyOneBindingAvailable:return e;case wE.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,Uh.getServiceIdentifierAsString)(r),o=FA.AMBIGUOUS_MATCH+" "+i;throw o+=(0,Uh.listRegisteredBindingsForServiceIdentifier)(n,i,YS),new Error(o)}}function lW(r,e,t,n,i,o){var s,a;if(i===null){s=nW(r,e,n,null,o),a=new UA.Request(t,n,null,s,o);var c=new BZ.Plan(n,a);n.addPlan(c)}else s=nW(r,e,n,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(l){var u=null;if(o.isArray())u=a.addChildRequest(l.serviceIdentifier,l,o);else{if(l.cache)return;u=a}if(l.type===oW.BindingTypeEnum.Instance&&l.implementationType!==null){var p=(0,KA.getDependencies)(r,l.implementationType);if(!n.container.options.skipBaseClassChecks){var m=(0,KA.getBaseClassDependencyCount)(r,l.implementationType);if(p.length<m){var h=FA.ARGUMENTS_LENGTH_MISMATCH((0,KA.getFunctionName)(l.implementationType));throw new Error(h)}}p.forEach(function(g){lW(r,!1,g.serviceIdentifier,n,u,g)})}})}function YS(r,e){var t=[],n=cW(r);return n.hasKey(e)?t=n.get(e):r.parent!==null&&(t=YS(r.parent,e)),t}function $Z(r,e,t,n,i,o,s,a){a===void 0&&(a=!1);var c=new sW.Context(e),l=qZ(t,n,i,"",o,s);try{return lW(r,a,i,c,null,l),c}catch(u){throw(0,VZ.isStackOverflowExeption)(u)&&(0,Uh.circularDependencyToException)(c.plan.rootRequest),u}}ho.plan=$Z;function HZ(r,e,t,n){var i=new aW.Target(oW.TargetTypeEnum.Variable,"",e,new LA.Metadata(t,n)),o=new sW.Context(r),s=new UA.Request(e,o,null,[],i);return s}ho.createMockRequest=HZ});var XS=M(jh=>{"use strict";Object.defineProperty(jh,"__esModule",{value:!0});jh.isPromiseOrContainsPromise=jh.isPromise=void 0;function WA(r){var e=typeof r=="object"&&r!==null||typeof r=="function";return e&&typeof r.then=="function"}jh.isPromise=WA;function GZ(r){return WA(r)?!0:Array.isArray(r)&&r.some(WA)}jh.isPromiseOrContainsPromise=GZ});var uW=M(pc=>{"use strict";var zZ=pc&&pc.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},QZ=pc&&pc.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(pc,"__esModule",{value:!0});pc.saveToScope=pc.tryGetFromScope=void 0;var EE=O(),YZ=XS(),XZ=function(r,e){return e.scope===EE.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===EE.BindingScopeEnum.Request&&r.has(e.id)?r.get(e.id):null};pc.tryGetFromScope=XZ;var ZZ=function(r,e,t){e.scope===EE.BindingScopeEnum.Singleton&&tee(e,t),e.scope===EE.BindingScopeEnum.Request&&eee(r,e,t)};pc.saveToScope=ZZ;var eee=function(r,e,t){r.has(e.id)||r.set(e.id,t)},tee=function(r,e){r.cache=e,r.activated=!0,(0,YZ.isPromise)(e)&&ree(r,e)},ree=function(r,e){return zZ(void 0,void 0,void 0,function(){var t,n;return QZ(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),r.cache=t,[3,3];case 2:throw n=i.sent(),r.cache=null,r.activated=!1,n;case 3:return[2]}})})}});var pW=M(ZS=>{"use strict";Object.defineProperty(ZS,"__esModule",{value:!0});ZS.FactoryType=void 0;var nee;(function(r){r.DynamicValue="toDynamicValue",r.Factory="toFactory",r.Provider="toProvider"})(nee=ZS.FactoryType||(ZS.FactoryType={}))});var BA=M(go=>{"use strict";var iee=go&&go.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),oee=go&&go.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),see=go&&go.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&iee(e,r,t);return oee(e,r),e};Object.defineProperty(go,"__esModule",{value:!0});go.getFactoryDetails=go.ensureFullyBound=go.multiBindToService=void 0;var aee=O(),cee=see(Ri()),dc=xa(),VA=pW(),lee=function(r){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(i){return r.bind(i).toService(e)})}}};go.multiBindToService=lee;var uee=function(r){var e=null;switch(r.type){case dc.BindingTypeEnum.ConstantValue:case dc.BindingTypeEnum.Function:e=r.cache;break;case dc.BindingTypeEnum.Constructor:case dc.BindingTypeEnum.Instance:e=r.implementationType;break;case dc.BindingTypeEnum.DynamicValue:e=r.dynamicValue;break;case dc.BindingTypeEnum.Provider:e=r.provider;break;case dc.BindingTypeEnum.Factory:e=r.factory;break}if(e===null){var t=(0,aee.getServiceIdentifierAsString)(r.serviceIdentifier);throw new Error(cee.INVALID_BINDING_TYPE+" "+t)}};go.ensureFullyBound=uee;var pee=function(r){switch(r.type){case dc.BindingTypeEnum.Factory:return{factory:r.factory,factoryType:VA.FactoryType.Factory};case dc.BindingTypeEnum.Provider:return{factory:r.provider,factoryType:VA.FactoryType.Provider};case dc.BindingTypeEnum.DynamicValue:return{factory:r.dynamicValue,factoryType:VA.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+r.type)}};go.getFactoryDetails=pee});var vW=M(ei=>{"use strict";var Wh=ei&&ei.__assign||function(){return Wh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Wh.apply(this,arguments)},dee=ei&&ei.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),mee=ei&&ei.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),fee=ei&&ei.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&dee(e,r,t);return mee(e,r),e},fW=ei&&ei.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},hW=ei&&ei.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},hee=ei&&ei.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(ei,"__esModule",{value:!0});ei.resolveInstance=void 0;var qA=Ri(),$A=xa(),JA=fee(Rn()),HA=XS();function gee(r,e){return r.reduce(function(t,n){var i=e(n),o=n.target.type;return o===$A.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(n),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,HA.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function vee(r,e,t){var n;if(e.length>0){var i=gee(e,t),o=Wh(Wh({},i),{constr:r});i.isAsync?n=yee(o):n=gW(o)}else n=new r;return n}function gW(r){var e,t=new((e=r.constr).bind.apply(e,hee([void 0],r.constructorInjections,!1)));return r.propertyRequests.forEach(function(n,i){var o=n.target.identifier,s=r.propertyInjections[i];t[o]=s}),t}function yee(r){return fW(this,void 0,void 0,function(){var e,t;return hW(this,function(n){switch(n.label){case 0:return[4,dW(r.constructorInjections)];case 1:return e=n.sent(),[4,dW(r.propertyInjections)];case 2:return t=n.sent(),[2,gW(Wh(Wh({},r),{constructorInjections:e,propertyInjections:t}))]}})})}function dW(r){return fW(this,void 0,void 0,function(){var e,t,n,i;return hW(this,function(o){for(e=[],t=0,n=r;t<n.length;t++)i=n[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function mW(r,e){var t=bee(r,e);return(0,HA.isPromise)(t)?t.then(function(){return e}):e}function bee(r,e){var t,n;if(Reflect.hasMetadata(JA.POST_CONSTRUCT,r)){var i=Reflect.getMetadata(JA.POST_CONSTRUCT,r);try{return(n=(t=e)[i.value])===null||n===void 0?void 0:n.call(t)}catch(o){throw new Error((0,qA.POST_CONSTRUCT_ERROR)(r.name,o.message))}}}function Iee(r,e){r.scope!==$A.BindingScopeEnum.Singleton&&See(r,e)}function See(r,e){var t="Class cannot be instantiated in "+(r.scope===$A.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof r.onDeactivation=="function")throw new Error((0,qA.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(JA.PRE_DESTROY,e))throw new Error((0,qA.PRE_DESTROY_ERROR)(e.name,t))}function xee(r,e,t,n){Iee(r,e);var i=vee(e,t,n);return(0,HA.isPromise)(i)?i.then(function(o){return mW(e,o)}):mW(e,i)}ei.resolveInstance=xee});var xW=M(vo=>{"use strict";var Cee=vo&&vo.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),wee=vo&&vo.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Eee=vo&&vo.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Cee(e,r,t);return wee(e,r),e},Pee=vo&&vo.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},kee=vo&&vo.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(vo,"__esModule",{value:!0});vo.resolve=void 0;var Dee=Eee(Ri()),PE=xa(),_ee=jA(),yW=uW(),GA=XS(),IW=BA(),Tee=RA(),Ree=vW(),zA=function(r){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return n.map(function(a){var c=zA(r);return c(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return Oee(r,e,s)}},Aee=function(r,e){var t=(0,IW.getFactoryDetails)(r);return(0,Tee.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(r)(e)},function(){return new Error(Dee.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},Nee=function(r,e,t){var n,i=e.childRequests;switch((0,IW.ensureFullyBound)(t),t.type){case PE.BindingTypeEnum.ConstantValue:case PE.BindingTypeEnum.Function:n=t.cache;break;case PE.BindingTypeEnum.Constructor:n=t.implementationType;break;case PE.BindingTypeEnum.Instance:n=(0,Ree.resolveInstance)(t,t.implementationType,i,zA(r));break;default:n=Aee(t,e.parentContext)}return n},Mee=function(r,e,t){var n=(0,yW.tryGetFromScope)(r,e);return n!==null||(n=t(),(0,yW.saveToScope)(r,e,n)),n},Oee=function(r,e,t){return Mee(r,t,function(){var n=Nee(r,e,t);return(0,GA.isPromise)(n)?n=n.then(function(i){return bW(e,t,i)}):n=bW(e,t,n),n})};function bW(r,e,t){var n=Kee(r.parentContext,e,t),i=Uee(r.parentContext.container),o,s=i.next();do{o=s.value;var a=r.parentContext,c=r.serviceIdentifier,l=Lee(o,c);(0,GA.isPromise)(n)?n=SW(l,a,n):n=Fee(l,a,n),s=i.next()}while(s.done!==!0&&!(0,_ee.getBindingDictionary)(o).hasKey(r.serviceIdentifier));return n}var Kee=function(r,e,t){var n;return typeof e.onActivation=="function"?n=e.onActivation(r,t):n=t,n},Fee=function(r,e,t){for(var n=r.next();!n.done;){if(t=n.value(e,t),(0,GA.isPromise)(t))return SW(r,e,t);n=r.next()}return t},SW=function(r,e,t){return Pee(void 0,void 0,void 0,function(){var n,i;return kee(this,function(o){switch(o.label){case 0:return[4,t];case 1:n=o.sent(),i=r.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,n)];case 3:return n=o.sent(),i=r.next(),[3,2];case 4:return[2,n]}})})},Lee=function(r,e){var t=r._activations;return t.hasKey(e)?t.get(e).values():[].values()},Uee=function(r){for(var e=[r],t=r.parent;t!==null;)e.push(t),t=t.parent;var n=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:n};return i};function jee(r){var e=zA(r.plan.rootRequest.requestScope);return e(r.plan.rootRequest)}vo.resolve=jee});var QA=M(Ni=>{"use strict";var Wee=Ni&&Ni.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Vee=Ni&&Ni.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Bee=Ni&&Ni.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Wee(e,r,t);return Vee(e,r),e};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.typeConstraint=Ni.namedConstraint=Ni.taggedConstraint=Ni.traverseAncerstors=void 0;var qee=Bee(Rn()),Jee=Ca(),CW=function(r,e){var t=r.parentRequest;return t!==null?e(t)?!0:CW(t,e):!1};Ni.traverseAncerstors=CW;var wW=function(r){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(r)(e)};return t.metaData=new Jee.Metadata(r,e),t}};Ni.taggedConstraint=wW;var $ee=wW(qee.NAMED_TAG);Ni.namedConstraint=$ee;var Hee=function(r){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof r=="string"){var n=t.serviceIdentifier;return n===r}else{var i=e.bindings[0].implementationType;return r===i}return!1}};Ni.typeConstraint=Hee});var DE=M(kE=>{"use strict";Object.defineProperty(kE,"__esModule",{value:!0});kE.BindingWhenSyntax=void 0;var Yi=_E(),Bn=QA(),Gee=function(){function r(e){this._binding=e}return r.prototype.when=function(e){return this._binding.constraint=e,new Yi.BindingOnSyntax(this._binding)},r.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Bn.namedConstraint)(e),new Yi.BindingOnSyntax(this._binding)},r.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Bn.taggedConstraint)(e)(t),new Yi.BindingOnSyntax(this._binding)},r.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.typeConstraint)(e)(t.parentRequest)},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.namedConstraint)(e)(t.parentRequest)},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Bn.taggedConstraint)(e)(t)(n.parentRequest)},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.traverseAncerstors)(t,(0,Bn.typeConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Bn.traverseAncerstors)(t,(0,Bn.typeConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.traverseAncerstors)(t,(0,Bn.namedConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Bn.traverseAncerstors)(t,(0,Bn.namedConstraint)(e))},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Bn.traverseAncerstors)(n,(0,Bn.taggedConstraint)(e)(t))},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&!(0,Bn.traverseAncerstors)(n,(0,Bn.taggedConstraint)(e)(t))},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.traverseAncerstors)(t,e)},new Yi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Bn.traverseAncerstors)(t,e)},new Yi.BindingOnSyntax(this._binding)},r}();kE.BindingWhenSyntax=Gee});var _E=M(TE=>{"use strict";Object.defineProperty(TE,"__esModule",{value:!0});TE.BindingOnSyntax=void 0;var EW=DE(),zee=function(){function r(e){this._binding=e}return r.prototype.onActivation=function(e){return this._binding.onActivation=e,new EW.BindingWhenSyntax(this._binding)},r.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new EW.BindingWhenSyntax(this._binding)},r}();TE.BindingOnSyntax=zee});var YA=M(RE=>{"use strict";Object.defineProperty(RE,"__esModule",{value:!0});RE.BindingWhenOnSyntax=void 0;var Qee=_E(),Yee=DE(),Xee=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new Yee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Qee.BindingOnSyntax(this._binding)}return r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();RE.BindingWhenOnSyntax=Xee});var PW=M(AE=>{"use strict";Object.defineProperty(AE,"__esModule",{value:!0});AE.BindingInSyntax=void 0;var XA=xa(),ZA=YA(),Zee=function(){function r(e){this._binding=e}return r.prototype.inRequestScope=function(){return this._binding.scope=XA.BindingScopeEnum.Request,new ZA.BindingWhenOnSyntax(this._binding)},r.prototype.inSingletonScope=function(){return this._binding.scope=XA.BindingScopeEnum.Singleton,new ZA.BindingWhenOnSyntax(this._binding)},r.prototype.inTransientScope=function(){return this._binding.scope=XA.BindingScopeEnum.Transient,new ZA.BindingWhenOnSyntax(this._binding)},r}();AE.BindingInSyntax=Zee});var kW=M(NE=>{"use strict";Object.defineProperty(NE,"__esModule",{value:!0});NE.BindingInWhenOnSyntax=void 0;var ete=PW(),tte=_E(),rte=DE(),nte=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new rte.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new tte.BindingOnSyntax(this._binding),this._bindingInSyntax=new ete.BindingInSyntax(e)}return r.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},r.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},r.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();NE.BindingInWhenOnSyntax=nte});var TW=M(mc=>{"use strict";var ite=mc&&mc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ote=mc&&mc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ste=mc&&mc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ite(e,r,t);return ote(e,r),e};Object.defineProperty(mc,"__esModule",{value:!0});mc.BindingToSyntax=void 0;var DW=ste(Ri()),Xi=xa(),_W=kW(),Vh=YA(),ate=function(){function r(e){this._binding=e}return r.prototype.to=function(e){return this._binding.type=Xi.BindingTypeEnum.Instance,this._binding.implementationType=e,new _W.BindingInWhenOnSyntax(this._binding)},r.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+DW.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},r.prototype.toConstantValue=function(e){return this._binding.type=Xi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Vh.BindingWhenOnSyntax(this._binding)},r.prototype.toDynamicValue=function(e){return this._binding.type=Xi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new _W.BindingInWhenOnSyntax(this._binding)},r.prototype.toConstructor=function(e){return this._binding.type=Xi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Vh.BindingWhenOnSyntax(this._binding)},r.prototype.toFactory=function(e){return this._binding.type=Xi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Vh.BindingWhenOnSyntax(this._binding)},r.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(DW.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Xi.BindingTypeEnum.Function,this._binding.scope=Xi.BindingScopeEnum.Singleton,t},r.prototype.toAutoFactory=function(e){return this._binding.type=Xi.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=Xi.BindingScopeEnum.Singleton,new Vh.BindingWhenOnSyntax(this._binding)},r.prototype.toAutoNamedFactory=function(e){return this._binding.type=Xi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new Vh.BindingWhenOnSyntax(this._binding)},r.prototype.toProvider=function(e){return this._binding.type=Xi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Xi.BindingScopeEnum.Singleton,new Vh.BindingWhenOnSyntax(this._binding)},r.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},r}();mc.BindingToSyntax=ate});var RW=M(ME=>{"use strict";Object.defineProperty(ME,"__esModule",{value:!0});ME.ContainerSnapshot=void 0;var cte=function(){function r(){}return r.of=function(e,t,n,i,o){var s=new r;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=n,s.moduleActivationStore=o,s},r}();ME.ContainerSnapshot=cte});var AW=M(OE=>{"use strict";Object.defineProperty(OE,"__esModule",{value:!0});OE.isClonable=void 0;function lte(r){return typeof r=="object"&&r!==null&&"clone"in r&&typeof r.clone=="function"}OE.isClonable=lte});var eN=M(fc=>{"use strict";var ute=fc&&fc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),pte=fc&&fc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),dte=fc&&fc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ute(e,r,t);return pte(e,r),e};Object.defineProperty(fc,"__esModule",{value:!0});fc.Lookup=void 0;var mm=dte(Ri()),mte=AW(),fte=function(){function r(){this._map=new Map}return r.prototype.getMap=function(){return this._map},r.prototype.add=function(e,t){if(e==null)throw new Error(mm.NULL_ARGUMENT);if(t==null)throw new Error(mm.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?n.push(t):this._map.set(e,[t])},r.prototype.get=function(e){if(e==null)throw new Error(mm.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(mm.KEY_NOT_FOUND)},r.prototype.remove=function(e){if(e==null)throw new Error(mm.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(mm.KEY_NOT_FOUND)},r.prototype.removeIntersection=function(e){var t=this;this.traverse(function(n,i){var o=e.hasKey(n)?e.get(n):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(c){return a===c})});t._setValue(n,s)}})},r.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach(function(i,o){for(var s=[],a=0,c=i;a<c.length;a++){var l=c[a],u=e(l);u?n.push(l):s.push(l)}t._setValue(o,s)}),n},r.prototype.hasKey=function(e){if(e==null)throw new Error(mm.NULL_ARGUMENT);return this._map.has(e)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){t.forEach(function(i){return e.add(n,(0,mte.isClonable)(i)?i.clone():i)})}),e},r.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},r.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},r}();fc.Lookup=fte});var MW=M(KE=>{"use strict";Object.defineProperty(KE,"__esModule",{value:!0});KE.ModuleActivationStore=void 0;var NW=eN(),hte=function(){function r(){this._map=new Map}return r.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},r.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},r.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){e._map.set(n,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},r.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},r.prototype._getEmptyHandlersStore=function(){var e={onActivations:new NW.Lookup,onDeactivations:new NW.Lookup};return e},r}();KE.ModuleActivationStore=hte});var tN=M(ti=>{"use strict";var LE=ti&&ti.__assign||function(){return LE=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},LE.apply(this,arguments)},gte=ti&&ti.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vte=ti&&ti.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),OW=ti&&ti.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gte(e,r,t);return vte(e,r),e},_s=ti&&ti.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},Ts=ti&&ti.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},yte=ti&&ti.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(ti,"__esModule",{value:!0});ti.Container=void 0;var bte=K2(),wa=OW(Ri()),Bh=xa(),fm=OW(Rn()),Ite=TA(),FE=jA(),Ste=xW(),xte=TW(),hm=XS(),Cte=cp(),wte=Lh(),Ete=RW(),ex=eN(),Pte=MW(),kte=function(){function r(e){var t=e||{};if(typeof t!="object")throw new Error(""+wa.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Bh.BindingScopeEnum.Transient;else if(t.defaultScope!==Bh.BindingScopeEnum.Singleton&&t.defaultScope!==Bh.BindingScopeEnum.Transient&&t.defaultScope!==Bh.BindingScopeEnum.Request)throw new Error(""+wa.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+wa.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+wa.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,Cte.id)(),this._bindingDictionary=new ex.Lookup,this._snapshots=[],this._middleware=null,this._activations=new ex.Lookup,this._deactivations=new ex.Lookup,this.parent=null,this._metadataReader=new Ite.MetadataReader,this._moduleActivationStore=new Pte.ModuleActivationStore}return r.merge=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=new r,s=yte([e,t],n,!0).map(function(l){return(0,FE.getBindingDictionary)(l)}),a=(0,FE.getBindingDictionary)(o);function c(l,u){l.traverse(function(p,m){m.forEach(function(h){u.add(h.serviceIdentifier,h.clone())})})}return s.forEach(function(l){c(l,a)}),o},r.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},r.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _s(this,void 0,void 0,function(){var n,i,o,s,a;return Ts(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,o=e,c.label=1;case 1:return i<o.length?(s=o[i],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},r.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},r.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _s(this,void 0,void 0,function(){var n,i,o,s;return Ts(this,function(a){switch(a.label){case 0:n=0,i=e,a.label=1;case 1:return n<i.length?(o=i[n],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.bind=function(e){var t=this.options.defaultScope||Bh.BindingScopeEnum.Transient,n=new bte.Binding(e,t);return this._bindingDictionary.add(e,n),new xte.BindingToSyntax(n)},r.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},r.prototype.rebindAsync=function(e){return _s(this,void 0,void 0,function(){return Ts(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},r.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},r.prototype.unbindAsync=function(e){return _s(this,void 0,void 0,function(){var t;return Ts(this,function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},r.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,n){e._deactivateSingletons(n)}),this._bindingDictionary=new ex.Lookup},r.prototype.unbindAllAsync=function(){return _s(this,void 0,void 0,function(){var e,t=this;return Ts(this,function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new ex.Lookup,[2]}})})},r.prototype.onActivation=function(e,t){this._activations.add(e,t)},r.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},r.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},r.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},r.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,fm.NAMED_TAG,t)},r.prototype.isBoundTagged=function(e,t,n){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,FE.createMockRequest)(this,e,t,n);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,n)),i},r.prototype.snapshot=function(){this._snapshots.push(Ete.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},r.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(wa.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},r.prototype.createChild=function(e){var t=new r(e||this.options);return t.parent=this,t},r.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},n)},r.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},r.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},r.prototype.getAsync=function(e){return _s(this,void 0,void 0,function(){var t;return Ts(this,function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},r.prototype.getTagged=function(e,t,n){var i=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(i)},r.prototype.getTaggedAsync=function(e,t,n){return _s(this,void 0,void 0,function(){var i;return Ts(this,function(o){return i=this._getNotAllArgs(e,!1,t,n),[2,this._get(i)]})})},r.prototype.getNamed=function(e,t){return this.getTagged(e,fm.NAMED_TAG,t)},r.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,fm.NAMED_TAG,t)},r.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},r.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},r.prototype.getAllTagged=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(i)},r.prototype.getAllTaggedAsync=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getAll(i)},r.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,fm.NAMED_TAG,t)},r.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,fm.NAMED_TAG,t)},r.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},r.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(fm.PRE_DESTROY,e)){var n=Reflect.getMetadata(fm.PRE_DESTROY,e);return t[n.value]()}},r.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},r.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},r.prototype._deactivate=function(e,t){var n=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,hm.isPromise)(o))return this._handleDeactivationError(o.then(function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,hm.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(wa.ON_DEACTIVATION_ERROR(i.name,a.message))}},r.prototype._handleDeactivationError=function(e,t){return _s(this,void 0,void 0,function(){var n;return Ts(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw n=i.sent(),new Error(wa.ON_DEACTIVATION_ERROR(t.name,n.message));case 3:return[2]}})})},r.prototype._deactivateContainer=function(e,t){for(var n=this,i=t.next();i.value;){var o=i.value(e);if((0,hm.isPromise)(o))return o.then(function(){return n._deactivateContainerAsync(e,t)});i=t.next()}},r.prototype._deactivateContainerAsync=function(e,t){return _s(this,void 0,void 0,function(){var n;return Ts(this,function(i){switch(i.label){case 0:n=t.next(),i.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return i.sent(),n=t.next(),[3,1];case 3:return[2]}})})},r.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,p){u._binding.moduleId=p},n=function(u){return function(p){var m=e.bind(p);return t(m,u),m}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(p){var m=e.rebind(p);return t(m,u),m}},c=function(u){return function(p,m){e._moduleActivationStore.addActivation(u,p,m),e.onActivation(p,m)}},l=function(u){return function(p,m){e._moduleActivationStore.addDeactivation(u,p,m),e.onDeactivation(p,m)}};return function(u){return{bindFunction:n(u),isboundFunction:s(),onActivationFunction:c(u),onDeactivationFunction:l(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},r.prototype._getAll=function(e){return Promise.all(this._get(e))},r.prototype._get=function(e){var t=LE(LE({},e),{contextInterceptor:function(i){return i},targetType:Bh.TargetTypeEnum.Variable});if(this._middleware){var n=this._middleware(t);if(n==null)throw new Error(wa.INVALID_MIDDLEWARE_RETURN);return n}return this._planAndResolve()(t)},r.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,hm.isPromiseOrContainsPromise)(t))throw new Error(wa.LAZY_IN_SYNC(e.serviceIdentifier));return t},r.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},r.prototype._getNotAllArgs=function(e,t,n,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:i};return o},r.prototype._planAndResolve=function(){var e=this;return function(t){var n=(0,FE.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var i=(0,Ste.resolve)(n);return i}},r.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,hm.isPromise)(e.cache)?e.cache.then(function(n){return t._deactivate(e,n)}):this._deactivate(e,e.cache)},r.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],o=this._deactivateIfSingleton(i);if((0,hm.isPromise)(o))throw new Error(wa.ASYNC_UNBIND_REQUIRED)}},r.prototype._deactivateSingletonsAsync=function(e){return _s(this,void 0,void 0,function(){var t=this;return Ts(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return n.sent(),[2]}})})},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return _s(this,void 0,void 0,function(){return Ts(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},r.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(wa.CANNOT_UNBIND+" "+(0,wte.getServiceIdentifierAsString)(e))}},r.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,hm.isPromise)(o))return o.then(function(){return i._preDestroy(n,t)})}return this._preDestroy(n,t)},r.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return _s(this,void 0,void 0,function(){return Ts(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return i.sent(),[2]}})})},r}();ti.Container=kte});var FW=M(qh=>{"use strict";Object.defineProperty(qh,"__esModule",{value:!0});qh.AsyncContainerModule=qh.ContainerModule=void 0;var KW=cp(),Dte=function(){function r(e){this.id=(0,KW.id)(),this.registry=e}return r}();qh.ContainerModule=Dte;var _te=function(){function r(e){this.id=(0,KW.id)(),this.registry=e}return r}();qh.AsyncContainerModule=_te});var LW=M(UE=>{"use strict";Object.defineProperty(UE,"__esModule",{value:!0});UE.getFirstArrayDuplicate=void 0;function Tte(r){for(var e=new Set,t=0,n=r;t<n.length;t++){var i=n[t];if(e.has(i))return i;e.add(i)}}UE.getFirstArrayDuplicate=Tte});var Bl=M(Mi=>{"use strict";var Rte=Mi&&Mi.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ate=Mi&&Mi.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),jW=Mi&&Mi.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Rte(e,r,t);return Ate(e,r),e};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.createTaggedDecorator=Mi.tagProperty=Mi.tagParameter=Mi.decorate=void 0;var jE=jW(Ri()),WW=jW(Rn()),Nte=LW();function Mte(r){return r.prototype!==void 0}function Ote(r){if(r!==void 0)throw new Error(jE.INVALID_DECORATOR_OPERATION)}function VW(r,e,t,n){Ote(e),qW(WW.TAGGED,r,t.toString(),n)}Mi.tagParameter=VW;function BW(r,e,t){if(Mte(r))throw new Error(jE.INVALID_DECORATOR_OPERATION);qW(WW.TAGGED_PROP,r.constructor,e,t)}Mi.tagProperty=BW;function Kte(r){var e=[];if(Array.isArray(r)){e=r;var t=(0,Nte.getFirstArrayDuplicate)(e.map(function(n){return n.key}));if(t!==void 0)throw new Error(jE.DUPLICATED_METADATA+" "+t.toString())}else e=[r];return e}function qW(r,e,t,n){var i=Kte(n),o={};Reflect.hasOwnMetadata(r,e)&&(o=Reflect.getMetadata(r,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(p){if(i.some(function(m){return m.key===p.key}))throw new Error(jE.DUPLICATED_METADATA+" "+p.key.toString())},c=0,l=s;c<l.length;c++){var u=l[c];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(r,o,e)}function Fte(r){return function(e,t,n){typeof n=="number"?VW(e,t,n,r):BW(e,t,r)}}Mi.createTaggedDecorator=Fte;function UW(r,e){Reflect.decorate(r,e)}function Lte(r,e){return function(t,n){e(t,n,r)}}function Ute(r,e,t){typeof t=="number"?UW([Lte(t,r)],e):typeof t=="string"?Reflect.decorate([r],e,t):UW([r],e)}Mi.decorate=Ute});var $W=M(hc=>{"use strict";var jte=hc&&hc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Wte=hc&&hc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),JW=hc&&hc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&jte(e,r,t);return Wte(e,r),e};Object.defineProperty(hc,"__esModule",{value:!0});hc.injectable=void 0;var Vte=JW(Ri()),rN=JW(Rn());function Bte(){return function(r){if(Reflect.hasOwnMetadata(rN.PARAM_TYPES,r))throw new Error(Vte.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(rN.DESIGN_PARAM_TYPES,r)||[];return Reflect.defineMetadata(rN.PARAM_TYPES,e,r),r}}hc.injectable=Bte});var HW=M(WE=>{"use strict";Object.defineProperty(WE,"__esModule",{value:!0});WE.tagged=void 0;var qte=Ca(),Jte=Bl();function $te(r,e){return(0,Jte.createTaggedDecorator)(new qte.Metadata(r,e))}WE.tagged=$te});var GW=M(gc=>{"use strict";var Hte=gc&&gc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Gte=gc&&gc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),zte=gc&&gc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Hte(e,r,t);return Gte(e,r),e};Object.defineProperty(gc,"__esModule",{value:!0});gc.named=void 0;var Qte=zte(Rn()),Yte=Ca(),Xte=Bl();function Zte(r){return(0,Xte.createTaggedDecorator)(new Yte.Metadata(Qte.NAMED_TAG,r))}gc.named=Zte});var nN=M(VE=>{"use strict";Object.defineProperty(VE,"__esModule",{value:!0});VE.injectBase=void 0;var ere=Ri(),tre=Ca(),rre=Bl();function nre(r){return function(e){return function(t,n,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,ere.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,rre.createTaggedDecorator)(new tre.Metadata(r,e))(t,n,i)}}}VE.injectBase=nre});var zW=M(vc=>{"use strict";var ire=vc&&vc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ore=vc&&vc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),sre=vc&&vc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ire(e,r,t);return ore(e,r),e};Object.defineProperty(vc,"__esModule",{value:!0});vc.inject=void 0;var are=sre(Rn()),cre=nN(),lre=(0,cre.injectBase)(are.INJECT_TAG);vc.inject=lre});var QW=M(yc=>{"use strict";var ure=yc&&yc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),pre=yc&&yc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),dre=yc&&yc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ure(e,r,t);return pre(e,r),e};Object.defineProperty(yc,"__esModule",{value:!0});yc.optional=void 0;var mre=dre(Rn()),fre=Ca(),hre=Bl();function gre(){return(0,hre.createTaggedDecorator)(new fre.Metadata(mre.OPTIONAL_TAG,!0))}yc.optional=gre});var YW=M(bc=>{"use strict";var vre=bc&&bc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),yre=bc&&bc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bre=bc&&bc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vre(e,r,t);return yre(e,r),e};Object.defineProperty(bc,"__esModule",{value:!0});bc.unmanaged=void 0;var Ire=bre(Rn()),Sre=Ca(),xre=Bl();function Cre(){return function(r,e,t){var n=new Sre.Metadata(Ire.UNMANAGED_TAG,!0);(0,xre.tagParameter)(r,e,t,n)}}bc.unmanaged=Cre});var XW=M(Ic=>{"use strict";var wre=Ic&&Ic.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ere=Ic&&Ic.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Pre=Ic&&Ic.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&wre(e,r,t);return Ere(e,r),e};Object.defineProperty(Ic,"__esModule",{value:!0});Ic.multiInject=void 0;var kre=Pre(Rn()),Dre=nN(),_re=(0,Dre.injectBase)(kre.MULTI_INJECT_TAG);Ic.multiInject=_re});var ZW=M(Sc=>{"use strict";var Tre=Sc&&Sc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Rre=Sc&&Sc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Are=Sc&&Sc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Tre(e,r,t);return Rre(e,r),e};Object.defineProperty(Sc,"__esModule",{value:!0});Sc.targetName=void 0;var Nre=Are(Rn()),Mre=Ca(),Ore=Bl();function Kre(r){return function(e,t,n){var i=new Mre.Metadata(Nre.NAME_TAG,r);(0,Ore.tagParameter)(e,t,n,i)}}Sc.targetName=Kre});var iN=M(BE=>{"use strict";Object.defineProperty(BE,"__esModule",{value:!0});BE.propertyEventDecorator=void 0;var Fre=Ca();function Lre(r,e){return function(){return function(t,n){var i=new Fre.Metadata(r,n);if(Reflect.hasOwnMetadata(r,t.constructor))throw new Error(e);Reflect.defineMetadata(r,i,t.constructor)}}}BE.propertyEventDecorator=Lre});var tV=M(xc=>{"use strict";var Ure=xc&&xc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),jre=xc&&xc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),eV=xc&&xc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Ure(e,r,t);return jre(e,r),e};Object.defineProperty(xc,"__esModule",{value:!0});xc.postConstruct=void 0;var Wre=eV(Ri()),Vre=eV(Rn()),Bre=iN(),qre=(0,Bre.propertyEventDecorator)(Vre.POST_CONSTRUCT,Wre.MULTIPLE_POST_CONSTRUCT_METHODS);xc.postConstruct=qre});var nV=M(Cc=>{"use strict";var Jre=Cc&&Cc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),$re=Cc&&Cc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),rV=Cc&&Cc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Jre(e,r,t);return $re(e,r),e};Object.defineProperty(Cc,"__esModule",{value:!0});Cc.preDestroy=void 0;var Hre=rV(Ri()),Gre=rV(Rn()),zre=iN(),Qre=(0,zre.propertyEventDecorator)(Gre.PRE_DESTROY,Hre.MULTIPLE_PRE_DESTROY_METHODS);Cc.preDestroy=Qre});var iV=M(qE=>{"use strict";Object.defineProperty(qE,"__esModule",{value:!0});qE.interfaces=void 0;var oN;oN||(oN={});qE.interfaces=oN});var O=M(je=>{"use strict";var Yre=je&&je.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Xre=je&&je.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Zre=je&&je.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Yre(e,r,t);return Xre(e,r),e};Object.defineProperty(je,"__esModule",{value:!0});je.multiBindToService=je.getServiceIdentifierAsString=je.typeConstraint=je.namedConstraint=je.taggedConstraint=je.traverseAncerstors=je.decorate=je.interfaces=je.id=je.MetadataReader=je.preDestroy=je.postConstruct=je.targetName=je.multiInject=je.unmanaged=je.optional=je.LazyServiceIdentifer=je.inject=je.named=je.tagged=je.injectable=je.createTaggedDecorator=je.ContainerModule=je.AsyncContainerModule=je.TargetTypeEnum=je.BindingTypeEnum=je.BindingScopeEnum=je.Container=je.METADATA_KEY=void 0;var ene=Zre(Rn());je.METADATA_KEY=ene;var tne=tN();Object.defineProperty(je,"Container",{enumerable:!0,get:function(){return tne.Container}});var sN=xa();Object.defineProperty(je,"BindingScopeEnum",{enumerable:!0,get:function(){return sN.BindingScopeEnum}});Object.defineProperty(je,"BindingTypeEnum",{enumerable:!0,get:function(){return sN.BindingTypeEnum}});Object.defineProperty(je,"TargetTypeEnum",{enumerable:!0,get:function(){return sN.TargetTypeEnum}});var oV=FW();Object.defineProperty(je,"AsyncContainerModule",{enumerable:!0,get:function(){return oV.AsyncContainerModule}});Object.defineProperty(je,"ContainerModule",{enumerable:!0,get:function(){return oV.ContainerModule}});var rne=Bl();Object.defineProperty(je,"createTaggedDecorator",{enumerable:!0,get:function(){return rne.createTaggedDecorator}});var nne=$W();Object.defineProperty(je,"injectable",{enumerable:!0,get:function(){return nne.injectable}});var ine=HW();Object.defineProperty(je,"tagged",{enumerable:!0,get:function(){return ine.tagged}});var one=GW();Object.defineProperty(je,"named",{enumerable:!0,get:function(){return one.named}});var sne=zW();Object.defineProperty(je,"inject",{enumerable:!0,get:function(){return sne.inject}});var ane=AA();Object.defineProperty(je,"LazyServiceIdentifer",{enumerable:!0,get:function(){return ane.LazyServiceIdentifer}});var cne=QW();Object.defineProperty(je,"optional",{enumerable:!0,get:function(){return cne.optional}});var lne=YW();Object.defineProperty(je,"unmanaged",{enumerable:!0,get:function(){return lne.unmanaged}});var une=XW();Object.defineProperty(je,"multiInject",{enumerable:!0,get:function(){return une.multiInject}});var pne=ZW();Object.defineProperty(je,"targetName",{enumerable:!0,get:function(){return pne.targetName}});var dne=tV();Object.defineProperty(je,"postConstruct",{enumerable:!0,get:function(){return dne.postConstruct}});var mne=nV();Object.defineProperty(je,"preDestroy",{enumerable:!0,get:function(){return mne.preDestroy}});var fne=TA();Object.defineProperty(je,"MetadataReader",{enumerable:!0,get:function(){return fne.MetadataReader}});var hne=cp();Object.defineProperty(je,"id",{enumerable:!0,get:function(){return hne.id}});var gne=iV();Object.defineProperty(je,"interfaces",{enumerable:!0,get:function(){return gne.interfaces}});var vne=Bl();Object.defineProperty(je,"decorate",{enumerable:!0,get:function(){return vne.decorate}});var JE=QA();Object.defineProperty(je,"traverseAncerstors",{enumerable:!0,get:function(){return JE.traverseAncerstors}});Object.defineProperty(je,"taggedConstraint",{enumerable:!0,get:function(){return JE.taggedConstraint}});Object.defineProperty(je,"namedConstraint",{enumerable:!0,get:function(){return JE.namedConstraint}});Object.defineProperty(je,"typeConstraint",{enumerable:!0,get:function(){return JE.typeConstraint}});var yne=Lh();Object.defineProperty(je,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return yne.getServiceIdentifierAsString}});var bne=BA();Object.defineProperty(je,"multiBindToService",{enumerable:!0,get:function(){return bne.multiBindToService}})});var dV=M(up=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});up.PythonExtension=up.PVSC_EXTENSION_ID=void 0;var Sne=require("vscode");up.PVSC_EXTENSION_ID="ms-python.python";var xne;(function(r){async function e(){let t=Sne.extensions.getExtension(up.PVSC_EXTENSION_ID);if(t===void 0)throw new Error("Python extension is not installed or is disabled");return t.isActive||await t.activate(),t.exports}r.api=e})(xne=up.PythonExtension||(up.PythonExtension={}))});var fV=M(cx=>{cx.get=function(r){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},n=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,r||cx.get);var i=t.stack;return Error.prepareStackTrace=n,Error.stackTraceLimit=e,i};cx.parse=function(r){if(!r.stack)return[];var e=this,t=r.stack.split(`
`).slice(1);return t.map(function(n){if(n.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:n,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=n.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,c=null,l=null,u=i[5]==="native";if(i[1]){a=i[1];var p=a.lastIndexOf(".");if(a[p-1]=="."&&p--,p>0){o=a.substr(0,p),s=a.substr(p+1);var m=o.indexOf(".Module");m>0&&(a=a.substr(m+1),o=o.substr(0,m))}c=null}s&&(c=o,l=s),s==="<anonymous>"&&(l=null,a=null);var h={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:c,methodName:l,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(h)}}).filter(function(n){return!!n})};function ax(r){for(var e in r)this[e]=r[e]}var Pne=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],kne=["topLevel","eval","native","constructor"];Pne.forEach(function(r){ax.prototype[r]=null,ax.prototype["get"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});kne.forEach(function(r){ax.prototype[r]=!1,ax.prototype["is"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});cx._createParsedCallSite=function(r){return new ax(r)}});var sg=M((Tt,WV)=>{Tt=WV.exports=Gt;var Er;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Er=function(){var r=Array.prototype.slice.call(arguments,0);r.unshift("SEMVER"),console.log.apply(console,r)}:Er=function(){};Tt.SEMVER_SPEC_VERSION="2.0.0";var px=256,iP=Number.MAX_SAFE_INTEGER||9007199254740991,bN=16,Lse=px-6,dx=Tt.re=[],Vr=Tt.safeRe=[],he=Tt.src=[],Jt=0,wN="[a-zA-Z0-9-]",IN=[["\\s",1],["\\d",px],[wN,Lse]];function uP(r){for(var e=0;e<IN.length;e++){var t=IN[e][0],n=IN[e][1];r=r.split(t+"*").join(t+"{0,"+n+"}").split(t+"+").join(t+"{1,"+n+"}")}return r}var Zh=Jt++;he[Zh]="0|[1-9]\\d*";var eg=Jt++;he[eg]="\\d+";var EN=Jt++;he[EN]="\\d*[a-zA-Z-]"+wN+"*";var kV=Jt++;he[kV]="("+he[Zh]+")\\.("+he[Zh]+")\\.("+he[Zh]+")";var DV=Jt++;he[DV]="("+he[eg]+")\\.("+he[eg]+")\\.("+he[eg]+")";var SN=Jt++;he[SN]="(?:"+he[Zh]+"|"+he[EN]+")";var xN=Jt++;he[xN]="(?:"+he[eg]+"|"+he[EN]+")";var PN=Jt++;he[PN]="(?:-("+he[SN]+"(?:\\."+he[SN]+")*))";var kN=Jt++;he[kN]="(?:-?("+he[xN]+"(?:\\."+he[xN]+")*))";var CN=Jt++;he[CN]=wN+"+";var fx=Jt++;he[fx]="(?:\\+("+he[CN]+"(?:\\."+he[CN]+")*))";var DN=Jt++,_V="v?"+he[kV]+he[PN]+"?"+he[fx]+"?";he[DN]="^"+_V+"$";var _N="[v=\\s]*"+he[DV]+he[kN]+"?"+he[fx]+"?",TN=Jt++;he[TN]="^"+_N+"$";var og=Jt++;he[og]="((?:<|>)?=?)";var oP=Jt++;he[oP]=he[eg]+"|x|X|\\*";var sP=Jt++;he[sP]=he[Zh]+"|x|X|\\*";var bm=Jt++;he[bm]="[v=\\s]*("+he[sP]+")(?:\\.("+he[sP]+")(?:\\.("+he[sP]+")(?:"+he[PN]+")?"+he[fx]+"?)?)?";var rg=Jt++;he[rg]="[v=\\s]*("+he[oP]+")(?:\\.("+he[oP]+")(?:\\.("+he[oP]+")(?:"+he[kN]+")?"+he[fx]+"?)?)?";var TV=Jt++;he[TV]="^"+he[og]+"\\s*"+he[bm]+"$";var RV=Jt++;he[RV]="^"+he[og]+"\\s*"+he[rg]+"$";var AV=Jt++;he[AV]="(?:^|[^\\d])(\\d{1,"+bN+"})(?:\\.(\\d{1,"+bN+"}))?(?:\\.(\\d{1,"+bN+"}))?(?:$|[^\\d])";var pP=Jt++;he[pP]="(?:~>?)";var ng=Jt++;he[ng]="(\\s*)"+he[pP]+"\\s+";dx[ng]=new RegExp(he[ng],"g");Vr[ng]=new RegExp(uP(he[ng]),"g");var Use="$1~",NV=Jt++;he[NV]="^"+he[pP]+he[bm]+"$";var MV=Jt++;he[MV]="^"+he[pP]+he[rg]+"$";var dP=Jt++;he[dP]="(?:\\^)";var ig=Jt++;he[ig]="(\\s*)"+he[dP]+"\\s+";dx[ig]=new RegExp(he[ig],"g");Vr[ig]=new RegExp(uP(he[ig]),"g");var jse="$1^",OV=Jt++;he[OV]="^"+he[dP]+he[bm]+"$";var KV=Jt++;he[KV]="^"+he[dP]+he[rg]+"$";var RN=Jt++;he[RN]="^"+he[og]+"\\s*("+_N+")$|^$";var AN=Jt++;he[AN]="^"+he[og]+"\\s*("+_V+")$|^$";var Im=Jt++;he[Im]="(\\s*)"+he[og]+"\\s*("+_N+"|"+he[bm]+")";dx[Im]=new RegExp(he[Im],"g");Vr[Im]=new RegExp(uP(he[Im]),"g");var Wse="$1$2$3",FV=Jt++;he[FV]="^\\s*("+he[bm]+")\\s+-\\s+("+he[bm]+")\\s*$";var LV=Jt++;he[LV]="^\\s*("+he[rg]+")\\s+-\\s+("+he[rg]+")\\s*$";var UV=Jt++;he[UV]="(<|>)?=?\\s*\\*";for(kc=0;kc<Jt;kc++)Er(kc,he[kc]),dx[kc]||(dx[kc]=new RegExp(he[kc]),Vr[kc]=new RegExp(uP(he[kc])));var kc;Tt.parse=Sm;function Sm(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Gt)return r;if(typeof r!="string"||r.length>px)return null;var t=e.loose?Vr[TN]:Vr[DN];if(!t.test(r))return null;try{return new Gt(r,e)}catch{return null}}Tt.valid=Vse;function Vse(r,e){var t=Sm(r,e);return t?t.version:null}Tt.clean=Bse;function Bse(r,e){var t=Sm(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null}Tt.SemVer=Gt;function Gt(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Gt){if(r.loose===e.loose)return r;r=r.version}else if(typeof r!="string")throw new TypeError("Invalid Version: "+r);if(r.length>px)throw new TypeError("version is longer than "+px+" characters");if(!(this instanceof Gt))return new Gt(r,e);Er("SemVer",r,e),this.options=e,this.loose=!!e.loose;var t=r.trim().match(e.loose?Vr[TN]:Vr[DN]);if(!t)throw new TypeError("Invalid Version: "+r);if(this.raw=r,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>iP||this.major<0)throw new TypeError("Invalid major version");if(this.minor>iP||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>iP||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<iP)return i}return n}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}Gt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Gt.prototype.toString=function(){return this.version};Gt.prototype.compare=function(r){return Er("SemVer.compare",this.version,this.options,r),r instanceof Gt||(r=new Gt(r,this.options)),this.compareMain(r)||this.comparePre(r)};Gt.prototype.compareMain=function(r){return r instanceof Gt||(r=new Gt(r,this.options)),tg(this.major,r.major)||tg(this.minor,r.minor)||tg(this.patch,r.patch)};Gt.prototype.comparePre=function(r){if(r instanceof Gt||(r=new Gt(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],n=r.prerelease[e];if(Er("prerelease compare",e,t,n),t===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(t===void 0)return-1;if(t===n)continue;return tg(t,n)}while(++e)};Gt.prototype.inc=function(r,e){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+r)}return this.format(),this.raw=this.version,this};Tt.inc=qse;function qse(r,e,t,n){typeof t=="string"&&(n=t,t=void 0);try{return new Gt(r,t).inc(e,n).version}catch{return null}}Tt.diff=Jse;function Jse(r,e){if(NN(r,e))return null;var t=Sm(r),n=Sm(e),i="";if(t.prerelease.length||n.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==n[s])return i+s;return o}Tt.compareIdentifiers=tg;var PV=/^[0-9]+$/;function tg(r,e){var t=PV.test(r),n=PV.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1}Tt.rcompareIdentifiers=$se;function $se(r,e){return tg(e,r)}Tt.major=Hse;function Hse(r,e){return new Gt(r,e).major}Tt.minor=Gse;function Gse(r,e){return new Gt(r,e).minor}Tt.patch=zse;function zse(r,e){return new Gt(r,e).patch}Tt.compare=ql;function ql(r,e,t){return new Gt(r,t).compare(new Gt(e,t))}Tt.compareLoose=Qse;function Qse(r,e){return ql(r,e,!0)}Tt.rcompare=Yse;function Yse(r,e,t){return ql(e,r,t)}Tt.sort=Xse;function Xse(r,e){return r.sort(function(t,n){return Tt.compare(t,n,e)})}Tt.rsort=Zse;function Zse(r,e){return r.sort(function(t,n){return Tt.rcompare(t,n,e)})}Tt.gt=mx;function mx(r,e,t){return ql(r,e,t)>0}Tt.lt=aP;function aP(r,e,t){return ql(r,e,t)<0}Tt.eq=NN;function NN(r,e,t){return ql(r,e,t)===0}Tt.neq=jV;function jV(r,e,t){return ql(r,e,t)!==0}Tt.gte=MN;function MN(r,e,t){return ql(r,e,t)>=0}Tt.lte=ON;function ON(r,e,t){return ql(r,e,t)<=0}Tt.cmp=cP;function cP(r,e,t,n){switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return NN(r,t,n);case"!=":return jV(r,t,n);case">":return mx(r,t,n);case">=":return MN(r,t,n);case"<":return aP(r,t,n);case"<=":return ON(r,t,n);default:throw new TypeError("Invalid operator: "+e)}}Tt.Comparator=As;function As(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof As){if(r.loose===!!e.loose)return r;r=r.value}if(!(this instanceof As))return new As(r,e);r=r.trim().split(/\s+/).join(" "),Er("comparator",r,e),this.options=e,this.loose=!!e.loose,this.parse(r),this.semver===hx?this.value="":this.value=this.operator+this.semver.version,Er("comp",this)}var hx={};As.prototype.parse=function(r){var e=this.options.loose?Vr[RN]:Vr[AN],t=r.match(e);if(!t)throw new TypeError("Invalid comparator: "+r);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new Gt(t[2],this.options.loose):this.semver=hx};As.prototype.toString=function(){return this.value};As.prototype.test=function(r){return Er("Comparator.test",r,this.options.loose),this.semver===hx?!0:(typeof r=="string"&&(r=new Gt(r,this.options)),cP(r,this.operator,this.semver,this.options))};As.prototype.intersects=function(r,e){if(!(r instanceof As))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new pn(r.value,e),lP(this.value,t,e);if(r.operator==="")return t=new pn(this.value,e),lP(r.semver,t,e);var n=(this.operator===">="||this.operator===">")&&(r.operator===">="||r.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(r.operator==="<="||r.operator==="<"),o=this.semver.version===r.semver.version,s=(this.operator===">="||this.operator==="<=")&&(r.operator===">="||r.operator==="<="),a=cP(this.semver,"<",r.semver,e)&&(this.operator===">="||this.operator===">")&&(r.operator==="<="||r.operator==="<"),c=cP(this.semver,">",r.semver,e)&&(this.operator==="<="||this.operator==="<")&&(r.operator===">="||r.operator===">");return n||i||o&&s||a||c};Tt.Range=pn;function pn(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof pn)return r.loose===!!e.loose&&r.includePrerelease===!!e.includePrerelease?r:new pn(r.raw,e);if(r instanceof As)return new pn(r.value,e);if(!(this instanceof pn))return new pn(r,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=r.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}pn.prototype.format=function(){return this.range=this.set.map(function(r){return r.join(" ").trim()}).join("||").trim(),this.range};pn.prototype.toString=function(){return this.range};pn.prototype.parseRange=function(r){var e=this.options.loose,t=e?Vr[LV]:Vr[FV];r=r.replace(t,lae),Er("hyphen replace",r),r=r.replace(Vr[Im],Wse),Er("comparator trim",r,Vr[Im]),r=r.replace(Vr[ng],Use),r=r.replace(Vr[ig],jse);var n=e?Vr[RN]:Vr[AN],i=r.split(" ").map(function(o){return tae(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(n)})),i=i.map(function(o){return new As(o,this.options)},this),i};pn.prototype.intersects=function(r,e){if(!(r instanceof pn))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(n){return r.set.some(function(i){return i.every(function(o){return n.intersects(o,e)})})})})};Tt.toComparators=eae;function eae(r,e){return new pn(r,e).set.map(function(t){return t.map(function(n){return n.value}).join(" ").trim().split(" ")})}function tae(r,e){return Er("comp",r,e),r=iae(r,e),Er("caret",r),r=rae(r,e),Er("tildes",r),r=sae(r,e),Er("xrange",r),r=cae(r,e),Er("stars",r),r}function to(r){return!r||r.toLowerCase()==="x"||r==="*"}function rae(r,e){return r.trim().split(/\s+/).map(function(t){return nae(t,e)}).join(" ")}function nae(r,e){var t=e.loose?Vr[MV]:Vr[NV];return r.replace(t,function(n,i,o,s,a){Er("tilde",r,n,i,o,s,a);var c;return to(i)?c="":to(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":to(s)?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(Er("replaceTilde pr",a),c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",Er("tilde return",c),c})}function iae(r,e){return r.trim().split(/\s+/).map(function(t){return oae(t,e)}).join(" ")}function oae(r,e){Er("caret",r,e);var t=e.loose?Vr[KV]:Vr[OV];return r.replace(t,function(n,i,o,s,a){Er("caret",r,n,i,o,s,a);var c;return to(i)?c="":to(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":to(s)?i==="0"?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(Er("replaceCaret pr",a),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(Er("no pr"),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),Er("caret return",c),c})}function sae(r,e){return Er("replaceXRanges",r,e),r.split(/\s+/).map(function(t){return aae(t,e)}).join(" ")}function aae(r,e){r=r.trim();var t=e.loose?Vr[RV]:Vr[TV];return r.replace(t,function(n,i,o,s,a,c){Er("xRange",r,n,i,o,s,a,c);var l=to(o),u=l||to(s),p=u||to(a),m=p;return i==="="&&m&&(i=""),l?i===">"||i==="<"?n="<0.0.0":n="*":i&&m?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),n=i+o+"."+s+"."+a):u?n=">="+o+".0.0 <"+(+o+1)+".0.0":p&&(n=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),Er("xRange return",n),n})}function cae(r,e){return Er("replaceStars",r,e),r.trim().replace(Vr[UV],"")}function lae(r,e,t,n,i,o,s,a,c,l,u,p,m){return to(t)?e="":to(n)?e=">="+t+".0.0":to(i)?e=">="+t+"."+n+".0":e=">="+e,to(c)?a="":to(l)?a="<"+(+c+1)+".0.0":to(u)?a="<"+c+"."+(+l+1)+".0":p?a="<="+c+"."+l+"."+u+"-"+p:a="<="+a,(e+" "+a).trim()}pn.prototype.test=function(r){if(!r)return!1;typeof r=="string"&&(r=new Gt(r,this.options));for(var e=0;e<this.set.length;e++)if(uae(this.set[e],r,this.options))return!0;return!1};function uae(r,e,t){for(var n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(n=0;n<r.length;n++)if(Er(r[n].semver),r[n].semver!==hx&&r[n].semver.prerelease.length>0){var i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}Tt.satisfies=lP;function lP(r,e,t){try{e=new pn(e,t)}catch{return!1}return e.test(r)}Tt.maxSatisfying=pae;function pae(r,e,t){var n=null,i=null;try{var o=new pn(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new Gt(n,t))}),n}Tt.minSatisfying=dae;function dae(r,e,t){var n=null,i=null;try{var o=new pn(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new Gt(n,t))}),n}Tt.minVersion=mae;function mae(r,e){r=new pn(r,e);var t=new Gt("0.0.0");if(r.test(t)||(t=new Gt("0.0.0-0"),r.test(t)))return t;t=null;for(var n=0;n<r.set.length;++n){var i=r.set[n];i.forEach(function(o){var s=new Gt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||mx(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&r.test(t)?t:null}Tt.validRange=fae;function fae(r,e){try{return new pn(r,e).range||"*"}catch{return null}}Tt.ltr=hae;function hae(r,e,t){return KN(r,e,"<",t)}Tt.gtr=gae;function gae(r,e,t){return KN(r,e,">",t)}Tt.outside=KN;function KN(r,e,t,n){r=new Gt(r,n),e=new pn(e,n);var i,o,s,a,c;switch(t){case">":i=mx,o=ON,s=aP,a=">",c=">=";break;case"<":i=aP,o=MN,s=mx,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(lP(r,e,n))return!1;for(var l=0;l<e.set.length;++l){var u=e.set[l],p=null,m=null;if(u.forEach(function(h){h.semver===hx&&(h=new As(">=0.0.0")),p=p||h,m=m||h,i(h.semver,p.semver,n)?p=h:s(h.semver,m.semver,n)&&(m=h)}),p.operator===a||p.operator===c||(!m.operator||m.operator===a)&&o(r,m.semver))return!1;if(m.operator===c&&s(r,m.semver))return!1}return!0}Tt.prerelease=vae;function vae(r,e){var t=Sm(r,e);return t&&t.prerelease.length?t.prerelease:null}Tt.intersects=yae;function yae(r,e,t){return r=new pn(r,t),e=new pn(e,t),r.intersects(e)}Tt.coerce=bae;function bae(r){if(r instanceof Gt)return r;if(typeof r!="string")return null;var e=r.match(Vr[AV]);return e==null?null:Sm(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var VV=M(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.EventEmitter=_c.once=_c.toPromise=void 0;function Iae(r,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let n=(0,_c.once)(r,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{n.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,_c.once)(r,t))}_c.toPromise=Iae;var Sae=(r,e)=>{let t=r(n=>{e(n),t.dispose()});return t};_c.once=Sae;var FN=class{constructor(){this.event=(e,t,n)=>{let i=this.add(t?e.bind(t):e);return n?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};_c.EventEmitter=FN});var m9=M((XPe,d9)=>{"use strict";d9.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var g9=M(BN=>{"use strict";var Kae=Object.prototype.hasOwnProperty,Fae;function f9(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return null}}function h9(r){try{return encodeURIComponent(r)}catch{return null}}function Lae(r){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},n;n=e.exec(r);){var i=f9(n[1]),o=f9(n[2]);i===null||o===null||i in t||(t[i]=o)}return t}function Uae(r,e){e=e||"";var t=[],n,i;typeof e!="string"&&(e="?");for(i in r)if(Kae.call(r,i)){if(n=r[i],!n&&(n===null||n===Fae||isNaN(n))&&(n=""),i=h9(i),n=h9(n),i===null||n===null)continue;t.push(i+"="+n)}return t.length?e+t.join("&"):""}BN.stringify=Uae;BN.parse=Lae});var w9=M((eke,C9)=>{"use strict";var y9=m9(),_P=g9(),jae=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,b9=/[\n\r\t]/g,Wae=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,I9=/:\d+$/,Vae=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Bae=/^[a-zA-Z]:/;function JN(r){return(r||"").toString().replace(jae,"")}var qN=[["#","hash"],["?","query"],function(e,t){return Rc(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],v9={hash:1,query:1};function S9(r){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};r=r||t;var n={},i=typeof r,o;if(r.protocol==="blob:")n=new Ac(unescape(r.pathname),{});else if(i==="string"){n=new Ac(r,{});for(o in v9)delete n[o]}else if(i==="object"){for(o in r)o in v9||(n[o]=r[o]);n.slashes===void 0&&(n.slashes=Wae.test(r.href))}return n}function Rc(r){return r==="file:"||r==="ftp:"||r==="http:"||r==="https:"||r==="ws:"||r==="wss:"}function x9(r,e){r=JN(r),r=r.replace(b9,""),e=e||{};var t=Vae.exec(r),n=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],n==="file:"?s>=2&&(a=a.slice(2)):Rc(n)?a=t[4]:n?i&&(a=a.slice(2)):s>=2&&Rc(e.protocol)&&(a=t[4]),{protocol:n,slashes:i||Rc(n),slashesCount:s,rest:a}}function qae(r,e){if(r==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(r.split("/")),n=t.length,i=t[n-1],o=!1,s=0;n--;)t[n]==="."?t.splice(n,1):t[n]===".."?(t.splice(n,1),s++):s&&(n===0&&(o=!0),t.splice(n,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function Ac(r,e,t){if(r=JN(r),r=r.replace(b9,""),!(this instanceof Ac))return new Ac(r,e,t);var n,i,o,s,a,c,l=qN.slice(),u=typeof e,p=this,m=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=_P.parse),e=S9(e),i=x9(r||"",e),n=!i.protocol&&!i.slashes,p.slashes=i.slashes||n&&e.slashes,p.protocol=i.protocol||e.protocol||"",r=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Bae.test(r))||!i.slashes&&(i.protocol||i.slashesCount<2||!Rc(p.protocol)))&&(l[3]=[/(.*)/,"pathname"]);m<l.length;m++){if(s=l[m],typeof s=="function"){r=s(r,p);continue}o=s[0],c=s[1],o!==o?p[c]=r:typeof o=="string"?(a=o==="@"?r.lastIndexOf(o):r.indexOf(o),~a&&(typeof s[2]=="number"?(p[c]=r.slice(0,a),r=r.slice(a+s[2])):(p[c]=r.slice(a),r=r.slice(0,a)))):(a=o.exec(r))&&(p[c]=a[1],r=r.slice(0,a.index)),p[c]=p[c]||n&&s[3]&&e[c]||"",s[4]&&(p[c]=p[c].toLowerCase())}t&&(p.query=t(p.query)),n&&e.slashes&&p.pathname.charAt(0)!=="/"&&(p.pathname!==""||e.pathname!=="")&&(p.pathname=qae(p.pathname,e.pathname)),p.pathname.charAt(0)!=="/"&&Rc(p.protocol)&&(p.pathname="/"+p.pathname),y9(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(a=p.auth.indexOf(":"),~a?(p.username=p.auth.slice(0,a),p.username=encodeURIComponent(decodeURIComponent(p.username)),p.password=p.auth.slice(a+1),p.password=encodeURIComponent(decodeURIComponent(p.password))):p.username=encodeURIComponent(decodeURIComponent(p.auth)),p.auth=p.password?p.username+":"+p.password:p.username),p.origin=p.protocol!=="file:"&&Rc(p.protocol)&&p.host?p.protocol+"//"+p.host:"null",p.href=p.toString()}function Jae(r,e,t){var n=this;switch(r){case"query":typeof e=="string"&&e.length&&(e=(t||_P.parse)(e)),n[r]=e;break;case"port":n[r]=e,y9(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[r]="");break;case"hostname":n[r]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[r]=e,I9.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!t;break;case"pathname":case"hash":if(e){var i=r==="pathname"?"/":"#";n[r]=e.charAt(0)!==i?i+e:e}else n[r]=e;break;case"username":case"password":n[r]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(n.username=e.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<qN.length;s++){var a=qN[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&Rc(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function $ae(r){(!r||typeof r!="function")&&(r=_P.stringify);var e,t=this,n=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||Rc(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&Rc(t.protocol)&&!n&&t.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||I9.test(t.hostname)&&!t.port)&&(n+=":"),o+=n+t.pathname,e=typeof t.query=="object"?r(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}Ac.prototype={set:Jae,toString:$ae};Ac.extractProtocol=x9;Ac.location=S9;Ac.trimLeft=JN;Ac.qs=_P;C9.exports=Ac});var $N=M((rke,k9)=>{"use strict";var E9=Array.isArray,P9=Object.keys,Hae=Object.prototype.hasOwnProperty;k9.exports=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=E9(e),i=E9(t),o,s,a;if(n&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!r(e[o],t[o]))return!1;return!0}if(n!=i)return!1;var c=e instanceof Date,l=t instanceof Date;if(c!=l)return!1;if(c&&l)return e.getTime()==t.getTime();var u=e instanceof RegExp,p=t instanceof RegExp;if(u!=p)return!1;if(u&&p)return e.toString()==t.toString();var m=P9(e);if(s=m.length,s!==P9(t).length)return!1;for(o=s;o--!==0;)if(!Hae.call(t,m[o]))return!1;for(o=s;o--!==0;)if(a=m[o],!r(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var pM=M(_p=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});_p.TargetPopulation=_p.Filters=_p.VSCodeFilterProvider=void 0;var ak=require("vscode"),uM=class r{constructor(e,t,n){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=n}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Bc.ApplicationVersion:return r.trimVersionSuffix(ak.version);case Bc.Build:return ak.env.appName;case Bc.ClientId:return ak.env.machineId;case Bc.ExtensionName:return this.extensionName;case Bc.ExtensionVersion:return r.trimVersionSuffix(this.extensionVersion);case Bc.Language:return ak.env.language;case Bc.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Bc);for(let n of t)e.set(n,this.getFilterValue(n));return e}};_p.VSCodeFilterProvider=uM;var Bc;(function(r){r.Market="X-MSEdge-Market",r.CorpNet="X-FD-Corpnet",r.ApplicationVersion="X-VSCode-AppVersion",r.Build="X-VSCode-Build",r.ClientId="X-MSEdge-ClientId",r.ExtensionName="X-VSCode-ExtensionName",r.ExtensionVersion="X-VSCode-ExtensionVersion",r.Language="X-VSCode-Language",r.TargetPopulation="X-VSCode-TargetPopulation"})(Bc||(_p.Filters=Bc={}));var P3;(function(r){r.Team="team",r.Internal="internal",r.Insiders="insider",r.Public="public"})(P3||(_p.TargetPopulation=P3={}))});var k3=M(ck=>{"use strict";Object.defineProperty(ck,"__esModule",{value:!0});ck.BaseFeatureProvider=void 0;var dM=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};ck.BaseFeatureProvider=dM});var D3=M(lk=>{"use strict";Object.defineProperty(lk,"__esModule",{value:!0});lk.FilteredFeatureProvider=void 0;var vce=k3(),mM=class extends vce.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let n=t.getFilters();for(let i of n.keys()){let o=n.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};lk.FilteredFeatureProvider=mM});var _3=M(Tp=>{"use strict";Object.defineProperty(Tp,"__esModule",{value:!0});Tp.TasApiFeatureProvider=Tp.TASAPI_FETCHERROR_EVENTNAME=void 0;var yce=D3();Tp.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var fM="ErrorType",hM=class extends yce.FilteredFeatureProvider{constructor(e,t,n){super(t,n),this.httpClient=e,this.telemetry=t,this.filterProviders=n}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let c=e.get(a);t[a]=c}let n;try{n=await this.httpClient.get({headers:t})}catch(a){let c=a,l=new Map;c.response?l.set(fM,"ServerError"):c.request?l.set(fM,"NoResponse"):l.set(fM,"GenericError"),this.telemetry.postEvent(Tp.TASAPI_FETCHERROR_EVENTNAME,l)}if(!n)throw Error(Tp.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=n.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let c of Object.keys(a.Parameters)){let l=c+(a.Parameters[c]?"":"cf");s.includes(l)||s.push(l)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};Tp.TasApiFeatureProvider=hM});var A3=M((R1e,R3)=>{var T3=require("stream").Stream,bce=require("util");R3.exports=Ta;function Ta(){this.source=null,this.dataSize=0,this.maxDataSize=1024*1024,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}bce.inherits(Ta,T3);Ta.create=function(r,e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];t.source=r;var i=r.emit;return r.emit=function(){return t._handleEmit(arguments),i.apply(r,arguments)},r.on("error",function(){}),t.pauseStream&&r.pause(),t};Object.defineProperty(Ta.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});Ta.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};Ta.prototype.resume=function(){this._released||this.release(),this.source.resume()};Ta.prototype.pause=function(){this.source.pause()};Ta.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(r){this.emit.apply(this,r)}.bind(this)),this._bufferedEvents=[]};Ta.prototype.pipe=function(){var r=T3.prototype.pipe.apply(this,arguments);return this.resume(),r};Ta.prototype._handleEmit=function(r){if(this._released){this.emit.apply(this,r);return}r[0]==="data"&&(this.dataSize+=r[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(r)};Ta.prototype._checkIfMaxDataSizeExceeded=function(){if(!this._maxDataSizeExceeded&&!(this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(r))}}});var K3=M((A1e,O3)=>{var Ice=require("util"),M3=require("stream").Stream,N3=A3();O3.exports=xn;function xn(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}Ice.inherits(xn,M3);xn.create=function(r){var e=new this;r=r||{};for(var t in r)e[t]=r[t];return e};xn.isStreamLike=function(r){return typeof r!="function"&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"&&!Buffer.isBuffer(r)};xn.prototype.append=function(r){var e=xn.isStreamLike(r);if(e){if(!(r instanceof N3)){var t=N3.create(r,{maxDataSize:1/0,pauseStream:this.pauseStreams});r.on("data",this._checkDataSize.bind(this)),r=t}this._handleErrors(r),this.pauseStreams&&r.pause()}return this._streams.push(r),this};xn.prototype.pipe=function(r,e){return M3.prototype.pipe.call(this,r,e),this.resume(),r};xn.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};xn.prototype._realGetNext=function(){var r=this._streams.shift();if(typeof r>"u"){this.end();return}if(typeof r!="function"){this._pipeNext(r);return}var e=r;e(function(t){var n=xn.isStreamLike(t);n&&(t.on("data",this._checkDataSize.bind(this)),this._handleErrors(t)),this._pipeNext(t)}.bind(this))};xn.prototype._pipeNext=function(r){this._currentStream=r;var e=xn.isStreamLike(r);if(e){r.on("end",this._getNext.bind(this)),r.pipe(this,{end:!1});return}var t=r;this.write(t),this._getNext()};xn.prototype._handleErrors=function(r){var e=this;r.on("error",function(t){e._emitError(t)})};xn.prototype.write=function(r){this.emit("data",r)};xn.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};xn.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};xn.prototype.end=function(){this._reset(),this.emit("end")};xn.prototype.destroy=function(){this._reset(),this.emit("close")};xn.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};xn.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(r))}};xn.prototype._updateDataSize=function(){this.dataSize=0;var r=this;this._streams.forEach(function(e){e.dataSize&&(r.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};xn.prototype._emitError=function(r){this._reset(),this.emit("error",r)}});var F3=M((N1e,Sce)=>{Sce.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var U3=M((M1e,L3)=>{L3.exports=F3()});var V3=M(Eo=>{"use strict";var uk=U3(),xce=require("path").extname,j3=/^\s*([^;\s]*)(?:;|\s|$)/,Cce=/^text\//i;Eo.charset=W3;Eo.charsets={lookup:W3};Eo.contentType=wce;Eo.extension=Ece;Eo.extensions=Object.create(null);Eo.lookup=Pce;Eo.types=Object.create(null);kce(Eo.extensions,Eo.types);function W3(r){if(!r||typeof r!="string")return!1;var e=j3.exec(r),t=e&&uk[e[1].toLowerCase()];return t&&t.charset?t.charset:e&&Cce.test(e[1])?"UTF-8":!1}function wce(r){if(!r||typeof r!="string")return!1;var e=r.indexOf("/")===-1?Eo.lookup(r):r;if(!e)return!1;if(e.indexOf("charset")===-1){var t=Eo.charset(e);t&&(e+="; charset="+t.toLowerCase())}return e}function Ece(r){if(!r||typeof r!="string")return!1;var e=j3.exec(r),t=e&&Eo.extensions[e[1].toLowerCase()];return!t||!t.length?!1:t[0]}function Pce(r){if(!r||typeof r!="string")return!1;var e=xce("x."+r).toLowerCase().substr(1);return e&&Eo.types[e]||!1}function kce(r,e){var t=["nginx","apache",void 0,"iana"];Object.keys(uk).forEach(function(i){var o=uk[i],s=o.extensions;if(!(!s||!s.length)){r[i]=s;for(var a=0;a<s.length;a++){var c=s[a];if(e[c]){var l=t.indexOf(uk[e[c]].source),u=t.indexOf(o.source);if(e[c]!=="application/octet-stream"&&(l>u||l===u&&e[c].substr(0,12)==="application/"))continue}e[c]=i}}})}});var q3=M((K1e,B3)=>{B3.exports=Dce;function Dce(r){var e=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;e?e(r):setTimeout(r,0)}});var gM=M((F1e,$3)=>{var J3=q3();$3.exports=_ce;function _ce(r){var e=!1;return J3(function(){e=!0}),function(n,i){e?r(n,i):J3(function(){r(n,i)})}}});var vM=M((L1e,H3)=>{H3.exports=Tce;function Tce(r){Object.keys(r.jobs).forEach(Rce.bind(r)),r.jobs={}}function Rce(r){typeof this.jobs[r]=="function"&&this.jobs[r]()}});var yM=M((U1e,z3)=>{var G3=gM(),Ace=vM();z3.exports=Nce;function Nce(r,e,t,n){var i=t.keyedList?t.keyedList[t.index]:t.index;t.jobs[i]=Mce(e,i,r[i],function(o,s){i in t.jobs&&(delete t.jobs[i],o?Ace(t):t.results[i]=s,n(o,t.results))})}function Mce(r,e,t,n){var i;return r.length==2?i=r(t,G3(n)):i=r(t,e,G3(n)),i}});var bM=M((j1e,Q3)=>{Q3.exports=Oce;function Oce(r,e){var t=!Array.isArray(r),n={index:0,keyedList:t||e?Object.keys(r):null,jobs:{},results:t?{}:[],size:t?Object.keys(r).length:r.length};return e&&n.keyedList.sort(t?e:function(i,o){return e(r[i],r[o])}),n}});var IM=M((W1e,Y3)=>{var Kce=vM(),Fce=gM();Y3.exports=Lce;function Lce(r){Object.keys(this.jobs).length&&(this.index=this.size,Kce(this),Fce(r)(null,this.results))}});var Z3=M((V1e,X3)=>{var Uce=yM(),jce=bM(),Wce=IM();X3.exports=Vce;function Vce(r,e,t){for(var n=jce(r);n.index<(n.keyedList||r).length;)Uce(r,e,n,function(i,o){if(i){t(i,o);return}if(Object.keys(n.jobs).length===0){t(null,n.results);return}}),n.index++;return Wce.bind(n,t)}});var SM=M((B1e,pk)=>{var eB=yM(),Bce=bM(),qce=IM();pk.exports=Jce;pk.exports.ascending=tB;pk.exports.descending=$ce;function Jce(r,e,t,n){var i=Bce(r,t);return eB(r,e,i,function o(s,a){if(s){n(s,a);return}if(i.index++,i.index<(i.keyedList||r).length){eB(r,e,i,o);return}n(null,i.results)}),qce.bind(i,n)}function tB(r,e){return r<e?-1:r>e?1:0}function $ce(r,e){return-1*tB(r,e)}});var nB=M((q1e,rB)=>{var Hce=SM();rB.exports=Gce;function Gce(r,e,t){return Hce(r,e,null,t)}});var oB=M((J1e,iB)=>{iB.exports={parallel:Z3(),serial:nB(),serialOrdered:SM()}});var aB=M(($1e,sB)=>{sB.exports=function(r,e){return Object.keys(e).forEach(function(t){r[t]=r[t]||e[t]}),r}});var uB=M((H1e,lB)=>{var EM=K3(),cB=require("util"),xM=require("path"),zce=require("http"),Qce=require("https"),Yce=require("url").parse,Xce=require("fs"),Zce=require("stream").Stream,CM=V3(),ele=oB(),wM=aB();lB.exports=rr;cB.inherits(rr,EM);function rr(r){if(!(this instanceof rr))return new rr(r);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],EM.call(this),r=r||{};for(var e in r)this[e]=r[e]}rr.LINE_BREAK=`\r
`;rr.DEFAULT_CONTENT_TYPE="application/octet-stream";rr.prototype.append=function(r,e,t){t=t||{},typeof t=="string"&&(t={filename:t});var n=EM.prototype.append.bind(this);if(typeof e=="number"&&(e=""+e),cB.isArray(e)){this._error(new Error("Arrays are not supported."));return}var i=this._multiPartHeader(r,e,t),o=this._multiPartFooter();n(i),n(e),n(o),this._trackLength(i,e,t)};rr.prototype._trackLength=function(r,e,t){var n=0;t.knownLength!=null?n+=+t.knownLength:Buffer.isBuffer(e)?n=e.length:typeof e=="string"&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(r)+rr.LINE_BREAK.length,!(!e||!e.path&&!(e.readable&&e.hasOwnProperty("httpVersion"))&&!(e instanceof Zce))&&(t.knownLength||this._valuesToMeasure.push(e))};rr.prototype._lengthRetriever=function(r,e){r.hasOwnProperty("fd")?r.end!=null&&r.end!=1/0&&r.start!=null?e(null,r.end+1-(r.start?r.start:0)):Xce.stat(r.path,function(t,n){var i;if(t){e(t);return}i=n.size-(r.start?r.start:0),e(null,i)}):r.hasOwnProperty("httpVersion")?e(null,+r.headers["content-length"]):r.hasOwnProperty("httpModule")?(r.on("response",function(t){r.pause(),e(null,+t.headers["content-length"])}),r.resume()):e("Unknown stream")};rr.prototype._multiPartHeader=function(r,e,t){if(typeof t.header=="string")return t.header;var n=this._getContentDisposition(e,t),i=this._getContentType(e,t),o="",s={"Content-Disposition":["form-data",'name="'+r+'"'].concat(n||[]),"Content-Type":[].concat(i||[])};typeof t.header=="object"&&wM(s,t.header);var a;for(var c in s)s.hasOwnProperty(c)&&(a=s[c],a!=null&&(Array.isArray(a)||(a=[a]),a.length&&(o+=c+": "+a.join("; ")+rr.LINE_BREAK)));return"--"+this.getBoundary()+rr.LINE_BREAK+o+rr.LINE_BREAK};rr.prototype._getContentDisposition=function(r,e){var t,n;return typeof e.filepath=="string"?t=xM.normalize(e.filepath).replace(/\\/g,"/"):e.filename||r.name||r.path?t=xM.basename(e.filename||r.name||r.path):r.readable&&r.hasOwnProperty("httpVersion")&&(t=xM.basename(r.client._httpMessage.path||"")),t&&(n='filename="'+t+'"'),n};rr.prototype._getContentType=function(r,e){var t=e.contentType;return!t&&r.name&&(t=CM.lookup(r.name)),!t&&r.path&&(t=CM.lookup(r.path)),!t&&r.readable&&r.hasOwnProperty("httpVersion")&&(t=r.headers["content-type"]),!t&&(e.filepath||e.filename)&&(t=CM.lookup(e.filepath||e.filename)),!t&&typeof r=="object"&&(t=rr.DEFAULT_CONTENT_TYPE),t};rr.prototype._multiPartFooter=function(){return function(r){var e=rr.LINE_BREAK,t=this._streams.length===0;t&&(e+=this._lastBoundary()),r(e)}.bind(this)};rr.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+rr.LINE_BREAK};rr.prototype.getHeaders=function(r){var e,t={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in r)r.hasOwnProperty(e)&&(t[e.toLowerCase()]=r[e]);return t};rr.prototype.setBoundary=function(r){this._boundary=r};rr.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary};rr.prototype.getBuffer=function(){for(var r=new Buffer.alloc(0),e=this.getBoundary(),t=0,n=this._streams.length;t<n;t++)typeof this._streams[t]!="function"&&(Buffer.isBuffer(this._streams[t])?r=Buffer.concat([r,this._streams[t]]):r=Buffer.concat([r,Buffer.from(this._streams[t])]),(typeof this._streams[t]!="string"||this._streams[t].substring(2,e.length+2)!==e)&&(r=Buffer.concat([r,Buffer.from(rr.LINE_BREAK)])));return Buffer.concat([r,Buffer.from(this._lastBoundary())])};rr.prototype._generateBoundary=function(){for(var r="--------------------------",e=0;e<24;e++)r+=Math.floor(Math.random()*10).toString(16);this._boundary=r};rr.prototype.getLengthSync=function(){var r=this._overheadLength+this._valueLength;return this._streams.length&&(r+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),r};rr.prototype.hasKnownLength=function(){var r=!0;return this._valuesToMeasure.length&&(r=!1),r};rr.prototype.getLength=function(r){var e=this._overheadLength+this._valueLength;if(this._streams.length&&(e+=this._lastBoundary().length),!this._valuesToMeasure.length){process.nextTick(r.bind(this,null,e));return}ele.parallel(this._valuesToMeasure,this._lengthRetriever,function(t,n){if(t){r(t);return}n.forEach(function(i){e+=i}),r(null,e)})};rr.prototype.submit=function(r,e){var t,n,i={method:"post"};return typeof r=="string"?(r=Yce(r),n=wM({port:r.port,path:r.pathname,host:r.hostname,protocol:r.protocol},i)):(n=wM(r,i),n.port||(n.port=n.protocol=="https:"?443:80)),n.headers=this.getHeaders(r.headers),n.protocol=="https:"?t=Qce.request(n):t=zce.request(n),this.getLength(function(o,s){if(o&&o!=="Unknown stream"){this._error(o);return}if(s&&t.setHeader("Content-Length",s),this.pipe(t),e){var a,c=function(l,u){return t.removeListener("error",c),t.removeListener("response",a),e.call(this,l,u)};a=c.bind(this,null),t.on("error",c),t.on("response",a)}}.bind(this)),t};rr.prototype._error=function(r){this.error||(this.error=r,this.pause(),this.emit("error",r))};rr.prototype.toString=function(){return"[object FormData]"}});var dB=M(pB=>{"use strict";var tle=require("url").parse,rle={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},nle=String.prototype.endsWith||function(r){return r.length<=this.length&&this.indexOf(r,this.length-r.length)!==-1};function ile(r){var e=typeof r=="string"?tle(r):r||{},t=e.protocol,n=e.host,i=e.port;if(typeof n!="string"||!n||typeof t!="string"||(t=t.split(":",1)[0],n=n.replace(/:\d*$/,""),i=parseInt(i)||rle[t]||0,!ole(n,i)))return"";var o=Ug("npm_config_"+t+"_proxy")||Ug(t+"_proxy")||Ug("npm_config_proxy")||Ug("all_proxy");return o&&o.indexOf("://")===-1&&(o=t+"://"+o),o}function ole(r,e){var t=(Ug("npm_config_no_proxy")||Ug("no_proxy")).toLowerCase();return t?t==="*"?!1:t.split(/[,\s]/).every(function(n){if(!n)return!0;var i=n.match(/^(.+):(\d+)$/),o=i?i[1]:n,s=i?parseInt(i[2]):0;return s&&s!==e?!0:/^[.*]/.test(o)?(o.charAt(0)==="*"&&(o=o.slice(1)),!nle.call(r,o)):r!==o}):!0}function Ug(r){return process.env[r.toLowerCase()]||process.env[r.toUpperCase()]||""}pB.getProxyForUrl=ile});var mk=M((z1e,mB)=>{var jg=1e3,Wg=jg*60,Vg=Wg*60,Rm=Vg*24,sle=Rm*7,ale=Rm*365.25;mB.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return cle(r);if(t==="number"&&isFinite(r))return e.long?ule(r):lle(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function cle(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*ale;case"weeks":case"week":case"w":return t*sle;case"days":case"day":case"d":return t*Rm;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Vg;case"minutes":case"minute":case"mins":case"min":case"m":return t*Wg;case"seconds":case"second":case"secs":case"sec":case"s":return t*jg;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function lle(r){var e=Math.abs(r);return e>=Rm?Math.round(r/Rm)+"d":e>=Vg?Math.round(r/Vg)+"h":e>=Wg?Math.round(r/Wg)+"m":e>=jg?Math.round(r/jg)+"s":r+"ms"}function ule(r){var e=Math.abs(r);return e>=Rm?dk(r,e,Rm,"day"):e>=Vg?dk(r,e,Vg,"hour"):e>=Wg?dk(r,e,Wg,"minute"):e>=jg?dk(r,e,jg,"second"):r+" ms"}function dk(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var PM=M((Q1e,fB)=>{function ple(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=mk(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null,h,g;function y(...x){if(!y.enabled)return;let E=y,A=Number(new Date),T=A-(p||A);E.diff=T,E.prev=p,E.curr=A,p=A,x[0]=t.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let j=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(G,ue)=>{if(G==="%%")return"%";j++;let pe=t.formatters[ue];if(typeof pe=="function"){let te=x[j];G=pe.call(E,te),x.splice(j,1),j--}return G}),t.formatArgs.call(E,x),(E.log||t.log).apply(E,x)}return y.namespace=u,y.useColors=t.useColors(),y.color=t.selectColor(u),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==t.namespaces&&(h=t.namespaces,g=t.enabled(u)),g),set:x=>{m=x}}),typeof t.init=="function"&&t.init(y),y}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}fB.exports=ple});var hB=M((Yo,fk)=>{Yo.formatArgs=mle;Yo.save=fle;Yo.load=hle;Yo.useColors=dle;Yo.storage=gle();Yo.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Yo.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function dle(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function mle(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+fk.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}Yo.log=console.debug||console.log||(()=>{});function fle(r){try{r?Yo.storage.setItem("debug",r):Yo.storage.removeItem("debug")}catch{}}function hle(){let r;try{r=Yo.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function gle(){try{return localStorage}catch{}}fk.exports=PM()(Yo);var{formatters:vle}=fk.exports;vle.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var vB=M((Y1e,gB)=>{"use strict";gB.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),i=e.indexOf("--");return n!==-1&&(i===-1?!0:n<i)}});var hk=M((X1e,yB)=>{"use strict";var yle=require("os"),Ra=vB(),Wi=process.env,Bg;Ra("no-color")||Ra("no-colors")||Ra("color=false")?Bg=!1:(Ra("color")||Ra("colors")||Ra("color=true")||Ra("color=always"))&&(Bg=!0);"FORCE_COLOR"in Wi&&(Bg=Wi.FORCE_COLOR.length===0||parseInt(Wi.FORCE_COLOR,10)!==0);function ble(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function Ile(r){if(Bg===!1)return 0;if(Ra("color=16m")||Ra("color=full")||Ra("color=truecolor"))return 3;if(Ra("color=256"))return 2;if(r&&!r.isTTY&&Bg!==!0)return 0;let e=Bg?1:0;if(process.platform==="win32"){let t=yle.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Wi)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Wi)||Wi.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Wi)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Wi.TEAMCITY_VERSION)?1:0;if(Wi.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Wi){let t=parseInt((Wi.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Wi.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Wi.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Wi.TERM)||"COLORTERM"in Wi?1:(Wi.TERM==="dumb",e)}function kM(r){let e=Ile(r);return ble(e)}yB.exports={supportsColor:kM,stdout:kM(process.stdout),stderr:kM(process.stderr)}});var IB=M((fi,vk)=>{var Sle=require("tty"),gk=require("util");fi.init=Dle;fi.log=Ele;fi.formatArgs=Cle;fi.save=Ple;fi.load=kle;fi.useColors=xle;fi.destroy=gk.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");fi.colors=[6,2,3,4,5,1];try{let r=hk();r&&(r.stderr||r).level>=2&&(fi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}fi.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function xle(){return"colors"in fi.inspectOpts?!!fi.inspectOpts.colors:Sle.isatty(process.stderr.fd)}function Cle(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+vk.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=wle()+e+" "+r[0]}function wle(){return fi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Ele(...r){return process.stderr.write(gk.format(...r)+`
`)}function Ple(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function kle(){return process.env.DEBUG}function Dle(r){r.inspectOpts={};let e=Object.keys(fi.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=fi.inspectOpts[e[t]]}vk.exports=PM()(fi);var{formatters:bB}=vk.exports;bB.o=function(r){return this.inspectOpts.colors=this.useColors,gk.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};bB.O=function(r){return this.inspectOpts.colors=this.useColors,gk.inspect(r,this.inspectOpts)}});var SB=M((Z1e,DM)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?DM.exports=hB():DM.exports=IB()});var CB=M((eRe,xB)=>{var Ax;xB.exports=function(){if(!Ax){try{Ax=SB()("follow-redirects")}catch{}typeof Ax!="function"&&(Ax=function(){})}Ax.apply(null,arguments)}});var DB=M((tRe,jM)=>{var Ox=require("url"),Nx=Ox.URL,_le=require("http"),Tle=require("https"),NM=require("stream").Writable,MM=require("assert"),wB=CB(),OM=!1;try{MM(new Nx)}catch(r){OM=r.code==="ERR_INVALID_URL"}var Rle=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],KM=["abort","aborted","connect","error","socket","timeout"],FM=Object.create(null);KM.forEach(function(r){FM[r]=function(e,t,n){this._redirectable.emit(r,e,t,n)}});var TM=Kx("ERR_INVALID_URL","Invalid URL",TypeError),RM=Kx("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),Ale=Kx("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",RM),Nle=Kx("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),Mle=Kx("ERR_STREAM_WRITE_AFTER_END","write after end"),Ole=NM.prototype.destroy||PB;function Po(r,e){NM.call(this),this._sanitizeOptions(r),this._options=r,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],e&&this.on("response",e);var t=this;this._onNativeResponse=function(n){try{t._processResponse(n)}catch(i){t.emit("error",i instanceof RM?i:new RM({cause:i}))}},this._performRequest()}Po.prototype=Object.create(NM.prototype);Po.prototype.abort=function(){UM(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};Po.prototype.destroy=function(r){return UM(this._currentRequest,r),Ole.call(this,r),this};Po.prototype.write=function(r,e,t){if(this._ending)throw new Mle;if(!Am(r)&&!Lle(r))throw new TypeError("data should be a string, Buffer or Uint8Array");if(Mx(e)&&(t=e,e=null),r.length===0){t&&t();return}this._requestBodyLength+r.length<=this._options.maxBodyLength?(this._requestBodyLength+=r.length,this._requestBodyBuffers.push({data:r,encoding:e}),this._currentRequest.write(r,e,t)):(this.emit("error",new Nle),this.abort())};Po.prototype.end=function(r,e,t){if(Mx(r)?(t=r,r=e=null):Mx(e)&&(t=e,e=null),!r)this._ended=this._ending=!0,this._currentRequest.end(null,null,t);else{var n=this,i=this._currentRequest;this.write(r,e,function(){n._ended=!0,i.end(null,null,t)}),this._ending=!0}};Po.prototype.setHeader=function(r,e){this._options.headers[r]=e,this._currentRequest.setHeader(r,e)};Po.prototype.removeHeader=function(r){delete this._options.headers[r],this._currentRequest.removeHeader(r)};Po.prototype.setTimeout=function(r,e){var t=this;function n(s){s.setTimeout(r),s.removeListener("timeout",s.destroy),s.addListener("timeout",s.destroy)}function i(s){t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){t.emit("timeout"),o()},r),n(s)}function o(){t._timeout&&(clearTimeout(t._timeout),t._timeout=null),t.removeListener("abort",o),t.removeListener("error",o),t.removeListener("response",o),t.removeListener("close",o),e&&t.removeListener("timeout",e),t.socket||t._currentRequest.removeListener("socket",i)}return e&&this.on("timeout",e),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",n),this.on("abort",o),this.on("error",o),this.on("response",o),this.on("close",o),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(r){Po.prototype[r]=function(e,t){return this._currentRequest[r](e,t)}});["aborted","connection","socket"].forEach(function(r){Object.defineProperty(Po.prototype,r,{get:function(){return this._currentRequest[r]}})});Po.prototype._sanitizeOptions=function(r){if(r.headers||(r.headers={}),r.host&&(r.hostname||(r.hostname=r.host),delete r.host),!r.pathname&&r.path){var e=r.path.indexOf("?");e<0?r.pathname=r.path:(r.pathname=r.path.substring(0,e),r.search=r.path.substring(e))}};Po.prototype._performRequest=function(){var r=this._options.protocol,e=this._options.nativeProtocols[r];if(!e)throw new TypeError("Unsupported protocol "+r);if(this._options.agents){var t=r.slice(0,-1);this._options.agent=this._options.agents[t]}var n=this._currentRequest=e.request(this._options,this._onNativeResponse);n._redirectable=this;for(var i of KM)n.on(i,FM[i]);if(this._currentUrl=/^\//.test(this._options.path)?Ox.format(this._options):this._options.path,this._isRedirect){var o=0,s=this,a=this._requestBodyBuffers;(function c(l){if(n===s._currentRequest)if(l)s.emit("error",l);else if(o<a.length){var u=a[o++];n.finished||n.write(u.data,u.encoding,c)}else s._ended&&n.end()})()}};Po.prototype._processResponse=function(r){var e=r.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:r.headers,statusCode:e});var t=r.headers.location;if(!t||this._options.followRedirects===!1||e<300||e>=400){r.responseUrl=this._currentUrl,r.redirects=this._redirects,this.emit("response",r),this._requestBodyBuffers=[];return}if(UM(this._currentRequest),r.destroy(),++this._redirectCount>this._options.maxRedirects)throw new Ale;var n,i=this._options.beforeRedirect;i&&(n=Object.assign({Host:r.req.getHeader("host")},this._options.headers));var o=this._options.method;((e===301||e===302)&&this._options.method==="POST"||e===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],_M(/^content-/i,this._options.headers));var s=_M(/^host$/i,this._options.headers),a=LM(this._currentUrl),c=s||a.host,l=/^\w+:/.test(t)?this._currentUrl:Ox.format(Object.assign(a,{host:c})),u=Kle(t,l);if(wB("redirecting to",u.href),this._isRedirect=!0,AM(u,this._options),(u.protocol!==a.protocol&&u.protocol!=="https:"||u.host!==c&&!Fle(u.host,c))&&_M(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),Mx(i)){var p={headers:r.headers,statusCode:e},m={url:l,method:o,headers:n};i(this._options,p,m),this._sanitizeOptions(this._options)}this._performRequest()};function EB(r){var e={maxRedirects:21,maxBodyLength:10485760},t={};return Object.keys(r).forEach(function(n){var i=n+":",o=t[i]=r[n],s=e[n]=Object.create(o);function a(l,u,p){return Ule(l)?l=AM(l):Am(l)?l=AM(LM(l)):(p=u,u=kB(l),l={protocol:i}),Mx(u)&&(p=u,u=null),u=Object.assign({maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},l,u),u.nativeProtocols=t,!Am(u.host)&&!Am(u.hostname)&&(u.hostname="::1"),MM.equal(u.protocol,i,"protocol mismatch"),wB("options",u),new Po(u,p)}function c(l,u,p){var m=s.request(l,u,p);return m.end(),m}Object.defineProperties(s,{request:{value:a,configurable:!0,enumerable:!0,writable:!0},get:{value:c,configurable:!0,enumerable:!0,writable:!0}})}),e}function PB(){}function LM(r){var e;if(OM)e=new Nx(r);else if(e=kB(Ox.parse(r)),!Am(e.protocol))throw new TM({input:r});return e}function Kle(r,e){return OM?new Nx(r,e):LM(Ox.resolve(e,r))}function kB(r){if(/^\[/.test(r.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(r.hostname))throw new TM({input:r.href||r});if(/^\[/.test(r.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(r.host))throw new TM({input:r.href||r});return r}function AM(r,e){var t=e||{};for(var n of Rle)t[n]=r[n];return t.hostname.startsWith("[")&&(t.hostname=t.hostname.slice(1,-1)),t.port!==""&&(t.port=Number(t.port)),t.path=t.search?t.pathname+t.search:t.pathname,t}function _M(r,e){var t;for(var n in e)r.test(n)&&(t=e[n],delete e[n]);return t===null||typeof t>"u"?void 0:String(t).trim()}function Kx(r,e,t){function n(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=r,this.message=this.cause?e+": "+this.cause.message:e}return n.prototype=new(t||Error),Object.defineProperties(n.prototype,{constructor:{value:n,enumerable:!1},name:{value:"Error ["+r+"]",enumerable:!1}}),n}function UM(r,e){for(var t of KM)r.removeListener(t,FM[t]);r.on("error",PB),r.destroy(e)}function Fle(r,e){MM(Am(r)&&Am(e));var t=r.length-e.length-1;return t>0&&r[t]==="."&&r.endsWith(e)}function Am(r){return typeof r=="string"||r instanceof String}function Mx(r){return typeof r=="function"}function Lle(r){return typeof r=="object"&&"length"in r}function Ule(r){return Nx&&r instanceof Nx}jM.exports=EB({http:_le,https:Tle});jM.exports.wrap=EB});var y6=M((rRe,v6)=>{"use strict";var jle=uB(),Wle=require("url"),Vle=dB(),Ble=require("http"),qle=require("https"),$B=require("util"),Jle=DB(),$le=require("zlib"),HB=require("stream"),Hle=require("events");function Xl(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var GB=Xl(jle),Gle=Xl(Wle),zle=Xl(Ble),Qle=Xl(qle),Yle=Xl($B),Xle=Xl(Jle),Mp=Xl($le),Ap=Xl(HB),Zle=Xl(Hle);function zB(r,e){return function(){return r.apply(e,arguments)}}var{toString:eue}=Object.prototype,{getPrototypeOf:tO}=Object,Ck=(r=>e=>{let t=eue.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),qc=r=>(r=r.toLowerCase(),e=>Ck(e)===r),wk=r=>e=>typeof e===r,{isArray:Hg}=Array,Ux=wk("undefined");function tue(r){return r!==null&&!Ux(r)&&r.constructor!==null&&!Ux(r.constructor)&&Vs(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var QB=qc("ArrayBuffer");function rue(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&QB(r.buffer),e}var nue=wk("string"),Vs=wk("function"),YB=wk("number"),Ek=r=>r!==null&&typeof r=="object",iue=r=>r===!0||r===!1,bk=r=>{if(Ck(r)!=="object")return!1;let e=tO(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},oue=qc("Date"),sue=qc("File"),aue=qc("Blob"),cue=qc("FileList"),lue=r=>Ek(r)&&Vs(r.pipe),uue=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Vs(r.append)&&((e=Ck(r))==="formdata"||e==="object"&&Vs(r.toString)&&r.toString()==="[object FormData]"))},pue=qc("URLSearchParams"),due=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Wx(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Hg(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{let o=t?Object.getOwnPropertyNames(r):Object.keys(r),s=o.length,a;for(n=0;n<s;n++)a=o[n],e.call(null,r[a],a,r)}}function XB(r,e){e=e.toLowerCase();let t=Object.keys(r),n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}var ZB=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),e6=r=>!Ux(r)&&r!==ZB;function JM(){let{caseless:r}=e6(this)&&this||{},e={},t=(n,i)=>{let o=r&&XB(e,i)||i;bk(e[o])&&bk(n)?e[o]=JM(e[o],n):bk(n)?e[o]=JM({},n):Hg(n)?e[o]=n.slice():e[o]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Wx(arguments[n],t);return e}var mue=(r,e,t,{allOwnKeys:n}={})=>(Wx(e,(i,o)=>{t&&Vs(i)?r[o]=zB(i,t):r[o]=i},{allOwnKeys:n}),r),fue=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),hue=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},gue=(r,e,t,n)=>{let i,o,s,a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),o=i.length;o-- >0;)s=i[o],(!n||n(s,r,e))&&!a[s]&&(e[s]=r[s],a[s]=!0);r=t!==!1&&tO(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},vue=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},yue=r=>{if(!r)return null;if(Hg(r))return r;let e=r.length;if(!YB(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},bue=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&tO(Uint8Array)),Iue=(r,e)=>{let n=(r&&r[Symbol.iterator]).call(r),i;for(;(i=n.next())&&!i.done;){let o=i.value;e.call(r,o[0],o[1])}},Sue=(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},xue=qc("HTMLFormElement"),Cue=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),_B=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),wue=qc("RegExp"),t6=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};Wx(t,(i,o)=>{let s;(s=e(i,o,r))!==!1&&(n[o]=s||i)}),Object.defineProperties(r,n)},Eue=r=>{t6(r,(e,t)=>{if(Vs(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];if(Vs(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Pue=(r,e)=>{let t={},n=i=>{i.forEach(o=>{t[o]=!0})};return Hg(r)?n(r):n(String(r).split(e)),t},kue=()=>{},Due=(r,e)=>(r=+r,Number.isFinite(r)?r:e),WM="abcdefghijklmnopqrstuvwxyz",TB="0123456789",r6={DIGIT:TB,ALPHA:WM,ALPHA_DIGIT:WM+WM.toUpperCase()+TB},_ue=(r=16,e=r6.ALPHA_DIGIT)=>{let t="",{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function Tue(r){return!!(r&&Vs(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var Rue=r=>{let e=new Array(10),t=(n,i)=>{if(Ek(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;let o=Hg(n)?[]:{};return Wx(n,(s,a)=>{let c=t(s,i+1);!Ux(c)&&(o[a]=c)}),e[i]=void 0,o}}return n};return t(r,0)},Aue=qc("AsyncFunction"),Nue=r=>r&&(Ek(r)||Vs(r))&&Vs(r.then)&&Vs(r.catch),Z={isArray:Hg,isArrayBuffer:QB,isBuffer:tue,isFormData:uue,isArrayBufferView:rue,isString:nue,isNumber:YB,isBoolean:iue,isObject:Ek,isPlainObject:bk,isUndefined:Ux,isDate:oue,isFile:sue,isBlob:aue,isRegExp:wue,isFunction:Vs,isStream:lue,isURLSearchParams:pue,isTypedArray:bue,isFileList:cue,forEach:Wx,merge:JM,extend:mue,trim:due,stripBOM:fue,inherits:hue,toFlatObject:gue,kindOf:Ck,kindOfTest:qc,endsWith:vue,toArray:yue,forEachEntry:Iue,matchAll:Sue,isHTMLForm:xue,hasOwnProperty:_B,hasOwnProp:_B,reduceDescriptors:t6,freezeMethods:Eue,toObjectSet:Pue,toCamelCase:Cue,noop:kue,toFiniteNumber:Due,findKey:XB,global:ZB,isContextDefined:e6,ALPHABET:r6,generateString:_ue,isSpecCompliantForm:Tue,toJSONObject:Rue,isAsyncFn:Aue,isThenable:Nue};function Xe(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}Z.inherits(Xe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Z.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var n6=Xe.prototype,i6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{i6[r]={value:r}});Object.defineProperties(Xe,i6);Object.defineProperty(n6,"isAxiosError",{value:!0});Xe.from=(r,e,t,n,i,o)=>{let s=Object.create(n6);return Z.toFlatObject(r,s,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Xe.call(s,r.message,e,t,n,i),s.cause=r,s.name=r.name,o&&Object.assign(s,o),s};function $M(r){return Z.isPlainObject(r)||Z.isArray(r)}function o6(r){return Z.endsWith(r,"[]")?r.slice(0,-2):r}function RB(r,e,t){return r?r.concat(e).map(function(i,o){return i=o6(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function Mue(r){return Z.isArray(r)&&!r.some($M)}var Oue=Z.toFlatObject(Z,{},null,function(e){return/^is[A-Z]/.test(e)});function Pk(r,e,t){if(!Z.isObject(r))throw new TypeError("target must be an object");e=e||new(GB.default||FormData),t=Z.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,x){return!Z.isUndefined(x[y])});let n=t.metaTokens,i=t.visitor||u,o=t.dots,s=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&Z.isSpecCompliantForm(e);if(!Z.isFunction(i))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(Z.isDate(g))return g.toISOString();if(!c&&Z.isBlob(g))throw new Xe("Blob is not supported. Use a Buffer instead.");return Z.isArrayBuffer(g)||Z.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,y,x){let E=g;if(g&&!x&&typeof g=="object"){if(Z.endsWith(y,"{}"))y=n?y:y.slice(0,-2),g=JSON.stringify(g);else if(Z.isArray(g)&&Mue(g)||(Z.isFileList(g)||Z.endsWith(y,"[]"))&&(E=Z.toArray(g)))return y=o6(y),E.forEach(function(T,j){!(Z.isUndefined(T)||T===null)&&e.append(s===!0?RB([y],j,o):s===null?y:y+"[]",l(T))}),!1}return $M(g)?!0:(e.append(RB(x,y,o),l(g)),!1)}let p=[],m=Object.assign(Oue,{defaultVisitor:u,convertValue:l,isVisitable:$M});function h(g,y){if(!Z.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));p.push(g),Z.forEach(g,function(E,A){(!(Z.isUndefined(E)||E===null)&&i.call(e,E,Z.isString(A)?A.trim():A,y,m))===!0&&h(E,y?y.concat(A):[A])}),p.pop()}}if(!Z.isObject(r))throw new TypeError("data must be an object");return h(r),e}function AB(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function s6(r,e){this._pairs=[],r&&Pk(r,this,e)}var a6=s6.prototype;a6.append=function(e,t){this._pairs.push([e,t])};a6.toString=function(e){let t=e?function(n){return e.call(this,n,AB)}:AB;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Kue(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function rO(r,e,t){if(!e)return r;let n=t&&t.encode||Kue,i=t&&t.serialize,o;if(i?o=i(e,t):o=Z.isURLSearchParams(e)?e.toString():new s6(e,t).toString(n),o){let s=r.indexOf("#");s!==-1&&(r=r.slice(0,s)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}var HM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Z.forEach(this.handlers,function(n){n!==null&&e(n)})}},NB=HM,nO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fue=Gle.default.URLSearchParams,Lue={isNode:!0,classes:{URLSearchParams:Fue,FormData:GB.default,Blob:typeof Blob<"u"&&Blob||null},protocols:["http","https","file","data"]},c6=typeof window<"u"&&typeof document<"u",Uue=(r=>c6&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),jue=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Wue=Object.freeze({__proto__:null,hasBrowserEnv:c6,hasStandardBrowserWebWorkerEnv:jue,hasStandardBrowserEnv:Uue}),Ws={...Wue,...Lue};function Vue(r,e){return Pk(r,new Ws.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,o){return Ws.isNode&&Z.isBuffer(t)?(this.append(n,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Bue(r){return Z.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function que(r){let e={},t=Object.keys(r),n,i=t.length,o;for(n=0;n<i;n++)o=t[n],e[o]=r[o];return e}function l6(r){function e(t,n,i,o){let s=t[o++],a=Number.isFinite(+s),c=o>=t.length;return s=!s&&Z.isArray(i)?i.length:s,c?(Z.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a):((!i[s]||!Z.isObject(i[s]))&&(i[s]=[]),e(t,n,i[s],o)&&Z.isArray(i[s])&&(i[s]=que(i[s])),!a)}if(Z.isFormData(r)&&Z.isFunction(r.entries)){let t={};return Z.forEachEntry(r,(n,i)=>{e(Bue(n),i,t,0)}),t}return null}function Jue(r,e,t){if(Z.isString(r))try{return(e||JSON.parse)(r),Z.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var iO={transitional:nO,adapter:["xhr","http"],transformRequest:[function(e,t){let n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=Z.isObject(e);if(o&&Z.isHTMLForm(e)&&(e=new FormData(e)),Z.isFormData(e))return i&&i?JSON.stringify(l6(e)):e;if(Z.isArrayBuffer(e)||Z.isBuffer(e)||Z.isStream(e)||Z.isFile(e)||Z.isBlob(e))return e;if(Z.isArrayBufferView(e))return e.buffer;if(Z.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Vue(e,this.formSerializer).toString();if((a=Z.isFileList(e))||n.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return Pk(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),Jue(e)):e}],transformResponse:[function(e){let t=this.transitional||iO.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&Z.isString(e)&&(n&&!this.responseType||i)){let s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Xe.from(a,Xe.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ws.classes.FormData,Blob:Ws.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Z.forEach(["delete","get","head","post","put","patch"],r=>{iO.headers[r]={}});var oO=iO,$ue=Z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hue=r=>{let e={},t,n,i;return r&&r.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),n=s.substring(i+1).trim(),!(!t||e[t]&&$ue[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},MB=Symbol("internals");function Fx(r){return r&&String(r).trim().toLowerCase()}function Ik(r){return r===!1||r==null?r:Z.isArray(r)?r.map(Ik):String(r)}function Gue(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}var zue=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function VM(r,e,t,n,i){if(Z.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!Z.isString(e)){if(Z.isString(n))return e.indexOf(n)!==-1;if(Z.isRegExp(n))return n.test(e)}}function Que(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Yue(r,e){let t=Z.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,o,s){return this[n].call(this,e,i,o,s)},configurable:!0})})}var qg=class{constructor(e){e&&this.set(e)}set(e,t,n){let i=this;function o(a,c,l){let u=Fx(c);if(!u)throw new Error("header name must be a non-empty string");let p=Z.findKey(i,u);(!p||i[p]===void 0||l===!0||l===void 0&&i[p]!==!1)&&(i[p||c]=Ik(a))}let s=(a,c)=>Z.forEach(a,(l,u)=>o(l,u,c));return Z.isPlainObject(e)||e instanceof this.constructor?s(e,t):Z.isString(e)&&(e=e.trim())&&!zue(e)?s(Hue(e),t):e!=null&&o(t,e,n),this}get(e,t){if(e=Fx(e),e){let n=Z.findKey(this,e);if(n){let i=this[n];if(!t)return i;if(t===!0)return Gue(i);if(Z.isFunction(t))return t.call(this,i,n);if(Z.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Fx(e),e){let n=Z.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||VM(this,this[n],n,t)))}return!1}delete(e,t){let n=this,i=!1;function o(s){if(s=Fx(s),s){let a=Z.findKey(n,s);a&&(!t||VM(n,n[a],a,t))&&(delete n[a],i=!0)}}return Z.isArray(e)?e.forEach(o):o(e),i}clear(e){let t=Object.keys(this),n=t.length,i=!1;for(;n--;){let o=t[n];(!e||VM(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){let t=this,n={};return Z.forEach(this,(i,o)=>{let s=Z.findKey(n,o);if(s){t[s]=Ik(i),delete t[o];return}let a=e?Que(o):String(o).trim();a!==o&&delete t[o],t[a]=Ik(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return Z.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&Z.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){let n=(this[MB]=this[MB]={accessors:{}}).accessors,i=this.prototype;function o(s){let a=Fx(s);n[a]||(Yue(i,s),n[a]=!0)}return Z.isArray(e)?e.forEach(o):o(e),this}};qg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Z.reduceDescriptors(qg.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});Z.freezeMethods(qg);var Bs=qg;function BM(r,e){let t=this||oO,n=e||t,i=Bs.from(n.headers),o=n.data;return Z.forEach(r,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function u6(r){return!!(r&&r.__CANCEL__)}function Nm(r,e,t){Xe.call(this,r??"canceled",Xe.ERR_CANCELED,e,t),this.name="CanceledError"}Z.inherits(Nm,Xe,{__CANCEL__:!0});function Lx(r,e,t){let n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new Xe("Request failed with status code "+t.status,[Xe.ERR_BAD_REQUEST,Xe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Xue(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Zue(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function sO(r,e){return r&&!Xue(e)?Zue(r,e):e}var xk="1.6.1";function p6(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}var epe=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function tpe(r,e,t){let n=t&&t.Blob||Ws.classes.Blob,i=p6(r);if(e===void 0&&n&&(e=!0),i==="data"){r=i.length?r.slice(i.length+1):r;let o=epe.exec(r);if(!o)throw new Xe("Invalid URL",Xe.ERR_INVALID_URL);let s=o[1],a=o[2],c=o[3],l=Buffer.from(decodeURIComponent(c),a?"base64":"utf8");if(e){if(!n)throw new Xe("Blob is not supported",Xe.ERR_NOT_SUPPORT);return new n([l],{type:s})}return l}throw new Xe("Unsupported protocol "+i,Xe.ERR_NOT_SUPPORT)}function rpe(r,e){let t=0,n=1e3/e,i=null;return function(s,a){let c=Date.now();if(s||c-t>n)return i&&(clearTimeout(i),i=null),t=c,r.apply(null,a);i||(i=setTimeout(()=>(i=null,t=Date.now(),r.apply(null,a)),n-(c-t)))}}function d6(r,e){r=r||10;let t=new Array(r),n=new Array(r),i=0,o=0,s;return e=e!==void 0?e:1e3,function(c){let l=Date.now(),u=n[o];s||(s=l),t[i]=c,n[i]=l;let p=o,m=0;for(;p!==i;)m+=t[p++],p=p%r;if(i=(i+1)%r,i===o&&(o=(o+1)%r),l-s<e)return;let h=u&&l-u;return h?Math.round(m*1e3/h):void 0}}var yk=Symbol("internals"),GM=class extends Ap.default.Transform{constructor(e){e=Z.toFlatObject(e,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(a,c)=>!Z.isUndefined(c[a])),super({readableHighWaterMark:e.chunkSize});let t=this,n=this[yk]={length:e.length,timeWindow:e.timeWindow,ticksRate:e.ticksRate,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null},i=d6(n.ticksRate*e.samplesCount,n.timeWindow);this.on("newListener",a=>{a==="progress"&&(n.isCaptured||(n.isCaptured=!0))});let o=0;n.updateProgress=rpe(function(){let c=n.length,l=n.bytesSeen,u=l-o;if(!u||t.destroyed)return;let p=i(u);o=l,process.nextTick(()=>{t.emit("progress",{loaded:l,total:c,progress:c?l/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&l<=c?(c-l)/p:void 0})})},n.ticksRate);let s=()=>{n.updateProgress(!0)};this.once("end",s),this.once("error",s)}_read(e){let t=this[yk];return t.onReadCallback&&t.onReadCallback(),super._read(e)}_transform(e,t,n){let i=this,o=this[yk],s=o.maxRate,a=this.readableHighWaterMark,c=o.timeWindow,l=1e3/c,u=s/l,p=o.minChunkSize!==!1?Math.max(o.minChunkSize,u*.01):0;function m(g,y){let x=Buffer.byteLength(g);o.bytesSeen+=x,o.bytes+=x,o.isCaptured&&o.updateProgress(),i.push(g)?process.nextTick(y):o.onReadCallback=()=>{o.onReadCallback=null,process.nextTick(y)}}let h=(g,y)=>{let x=Buffer.byteLength(g),E=null,A=a,T,j=0;if(s){let oe=Date.now();(!o.ts||(j=oe-o.ts)>=c)&&(o.ts=oe,T=u-o.bytes,o.bytes=T<0?-T:0,j=0),T=u-o.bytes}if(s){if(T<=0)return setTimeout(()=>{y(null,g)},c-j);T<A&&(A=T)}A&&x>A&&x-A>p&&(E=g.subarray(A),g=g.subarray(0,A)),m(g,E?()=>{process.nextTick(y,null,E)}:y)};h(e,function g(y,x){if(y)return n(y);x?h(x,g):n(null)})}setLength(e){return this[yk].length=+e,this}},OB=GM,{asyncIterator:KB}=Symbol,npe=async function*(r){r.stream?yield*r.stream():r.arrayBuffer?yield await r.arrayBuffer():r[KB]?yield*r[KB]():yield r},m6=npe,ipe=Z.ALPHABET.ALPHA_DIGIT+"-_",jx=new $B.TextEncoder,Np=`\r
`,ope=jx.encode(Np),spe=2,zM=class{constructor(e,t){let{escapeName:n}=this.constructor,i=Z.isString(t),o=`Content-Disposition: form-data; name="${n(e)}"${!i&&t.name?`; filename="${n(t.name)}"`:""}${Np}`;i?t=jx.encode(String(t).replace(/\r?\n|\r\n?/g,Np)):o+=`Content-Type: ${t.type||"application/octet-stream"}${Np}`,this.headers=jx.encode(o+Np),this.contentLength=i?t.byteLength:t.size,this.size=this.headers.byteLength+this.contentLength+spe,this.name=e,this.value=t}async*encode(){yield this.headers;let{value:e}=this;Z.isTypedArray(e)?yield e:yield*m6(e),yield ope}static escapeName(e){return String(e).replace(/[\r\n"]/g,t=>({"\r":"%0D","\n":"%0A",'"':"%22"})[t])}},ape=(r,e,t)=>{let{tag:n="form-data-boundary",size:i=25,boundary:o=n+"-"+Z.generateString(i,ipe)}=t||{};if(!Z.isFormData(r))throw TypeError("FormData instance required");if(o.length<1||o.length>70)throw Error("boundary must be 10-70 characters long");let s=jx.encode("--"+o+Np),a=jx.encode("--"+o+"--"+Np+Np),c=a.byteLength,l=Array.from(r.entries()).map(([p,m])=>{let h=new zM(p,m);return c+=h.size,h});c+=s.byteLength*l.length,c=Z.toFiniteNumber(c);let u={"Content-Type":`multipart/form-data; boundary=${o}`};return Number.isFinite(c)&&(u["Content-Length"]=c),e&&e(u),HB.Readable.from(async function*(){for(let p of l)yield s,yield*p.encode();yield a}())},cpe=ape,QM=class extends Ap.default.Transform{__transform(e,t,n){this.push(e),n()}_transform(e,t,n){if(e.length!==0&&(this._transform=this.__transform,e[0]!==120)){let i=Buffer.alloc(2);i[0]=120,i[1]=156,this.push(i,t)}this.__transform(e,t,n)}},lpe=QM,upe=(r,e)=>Z.isAsyncFn(r)?function(...t){let n=t.pop();r.apply(this,t).then(i=>{try{e?n(null,...e(i)):n(null,i)}catch(o){n(o)}},n)}:r,ppe=upe,FB={flush:Mp.default.constants.Z_SYNC_FLUSH,finishFlush:Mp.default.constants.Z_SYNC_FLUSH},dpe={flush:Mp.default.constants.BROTLI_OPERATION_FLUSH,finishFlush:Mp.default.constants.BROTLI_OPERATION_FLUSH},LB=Z.isFunction(Mp.default.createBrotliDecompress),{http:mpe,https:fpe}=Xle.default,hpe=/https:?/,UB=Ws.protocols.map(r=>r+":");function gpe(r){r.beforeRedirects.proxy&&r.beforeRedirects.proxy(r),r.beforeRedirects.config&&r.beforeRedirects.config(r)}function f6(r,e,t){let n=e;if(!n&&n!==!1){let i=Vle.getProxyForUrl(t);i&&(n=new URL(i))}if(n){if(n.username&&(n.auth=(n.username||"")+":"+(n.password||"")),n.auth){(n.auth.username||n.auth.password)&&(n.auth=(n.auth.username||"")+":"+(n.auth.password||""));let o=Buffer.from(n.auth,"utf8").toString("base64");r.headers["Proxy-Authorization"]="Basic "+o}r.headers.host=r.hostname+(r.port?":"+r.port:"");let i=n.hostname||n.host;r.hostname=i,r.host=i,r.port=n.port,r.path=t,n.protocol&&(r.protocol=n.protocol.includes(":")?n.protocol:`${n.protocol}:`)}r.beforeRedirects.proxy=function(o){f6(o,e,o.href)}}var vpe=typeof process<"u"&&Z.kindOf(process)==="process",ype=r=>new Promise((e,t)=>{let n,i,o=(c,l)=>{i||(i=!0,n&&n(c,l))},s=c=>{o(c),e(c)},a=c=>{o(c,!0),t(c)};r(s,a,c=>n=c).catch(a)}),bpe=({address:r,family:e})=>{if(!Z.isString(r))throw TypeError("address must be a string");return{address:r,family:e||(r.indexOf(".")<0?6:4)}},jB=(r,e)=>bpe(Z.isObject(r)?r:{address:r,family:e}),Ipe=vpe&&function(e){return ype(async function(n,i,o){let{data:s,lookup:a,family:c}=e,{responseType:l,responseEncoding:u}=e,p=e.method.toUpperCase(),m,h=!1,g;if(a){let X=ppe(a,ye=>Z.isArray(ye)?ye:[ye]);a=(ye,qe,hn)=>{X(ye,qe,(Pt,Hr,xs)=>{let Bt=Z.isArray(Hr)?Hr.map(nn=>jB(nn)):[jB(Hr,xs)];qe.all?hn(Pt,Bt):hn(Pt,Bt[0].address,Bt[0].family)})}}let y=new Zle.default,x=()=>{e.cancelToken&&e.cancelToken.unsubscribe(E),e.signal&&e.signal.removeEventListener("abort",E),y.removeAllListeners()};o((X,ye)=>{m=!0,ye&&(h=!0,x())});function E(X){y.emit("abort",!X||X.type?new Nm(null,e,g):X)}y.once("abort",i),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(E),e.signal&&(e.signal.aborted?E():e.signal.addEventListener("abort",E)));let A=sO(e.baseURL,e.url),T=new URL(A,"http://localhost"),j=T.protocol||UB[0];if(j==="data:"){let X;if(p!=="GET")return Lx(n,i,{status:405,statusText:"method not allowed",headers:{},config:e});try{X=tpe(e.url,l==="blob",{Blob:e.env&&e.env.Blob})}catch(ye){throw Xe.from(ye,Xe.ERR_BAD_REQUEST,e)}return l==="text"?(X=X.toString(u),(!u||u==="utf8")&&(X=Z.stripBOM(X))):l==="stream"&&(X=Ap.default.Readable.from(X)),Lx(n,i,{data:X,status:200,statusText:"OK",headers:new Bs,config:e})}if(UB.indexOf(j)===-1)return i(new Xe("Unsupported protocol "+j,Xe.ERR_BAD_REQUEST,e));let oe=Bs.from(e.headers).normalize();oe.set("User-Agent","axios/"+xk,!1);let G=e.onDownloadProgress,ue=e.onUploadProgress,pe=e.maxRate,te,Ce;if(Z.isSpecCompliantForm(s)){let X=oe.getContentType(/boundary=([-_\w\d]{10,70})/i);s=cpe(s,ye=>{oe.set(ye)},{tag:`axios-${xk}-boundary`,boundary:X&&X[1]||void 0})}else if(Z.isFormData(s)&&Z.isFunction(s.getHeaders)){if(oe.set(s.getHeaders()),!oe.hasContentLength())try{let X=await Yle.default.promisify(s.getLength).call(s);Number.isFinite(X)&&X>=0&&oe.setContentLength(X)}catch{}}else if(Z.isBlob(s))s.size&&oe.setContentType(s.type||"application/octet-stream"),oe.setContentLength(s.size||0),s=Ap.default.Readable.from(m6(s));else if(s&&!Z.isStream(s)){if(!Buffer.isBuffer(s))if(Z.isArrayBuffer(s))s=Buffer.from(new Uint8Array(s));else if(Z.isString(s))s=Buffer.from(s,"utf-8");else return i(new Xe("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",Xe.ERR_BAD_REQUEST,e));if(oe.setContentLength(s.length,!1),e.maxBodyLength>-1&&s.length>e.maxBodyLength)return i(new Xe("Request body larger than maxBodyLength limit",Xe.ERR_BAD_REQUEST,e))}let Le=Z.toFiniteNumber(oe.getContentLength());Z.isArray(pe)?(te=pe[0],Ce=pe[1]):te=Ce=pe,s&&(ue||te)&&(Z.isStream(s)||(s=Ap.default.Readable.from(s,{objectMode:!1})),s=Ap.default.pipeline([s,new OB({length:Le,maxRate:Z.toFiniteNumber(te)})],Z.noop),ue&&s.on("progress",X=>{ue(Object.assign(X,{upload:!0}))}));let ct;if(e.auth){let X=e.auth.username||"",ye=e.auth.password||"";ct=X+":"+ye}if(!ct&&T.username){let X=T.username,ye=T.password;ct=X+":"+ye}ct&&oe.delete("authorization");let ft;try{ft=rO(T.pathname+T.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(X){let ye=new Error(X.message);return ye.config=e,ye.url=e.url,ye.exists=!0,i(ye)}oe.set("Accept-Encoding","gzip, compress, deflate"+(LB?", br":""),!1);let rt={path:ft,method:p,headers:oe.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:ct,protocol:j,family:c,beforeRedirect:gpe,beforeRedirects:{}};!Z.isUndefined(a)&&(rt.lookup=a),e.socketPath?rt.socketPath=e.socketPath:(rt.hostname=T.hostname,rt.port=T.port,f6(rt,e.proxy,j+"//"+T.hostname+(T.port?":"+T.port:"")+rt.path));let ae,ke=hpe.test(rt.protocol);if(rt.agent=ke?e.httpsAgent:e.httpAgent,e.transport?ae=e.transport:e.maxRedirects===0?ae=ke?Qle.default:zle.default:(e.maxRedirects&&(rt.maxRedirects=e.maxRedirects),e.beforeRedirect&&(rt.beforeRedirects.config=e.beforeRedirect),ae=ke?fpe:mpe),e.maxBodyLength>-1?rt.maxBodyLength=e.maxBodyLength:rt.maxBodyLength=1/0,e.insecureHTTPParser&&(rt.insecureHTTPParser=e.insecureHTTPParser),g=ae.request(rt,function(ye){if(g.destroyed)return;let qe=[ye],hn=+ye.headers["content-length"];if(G){let nn=new OB({length:Z.toFiniteNumber(hn),maxRate:Z.toFiniteNumber(Ce)});G&&nn.on("progress",Gi=>{G(Object.assign(Gi,{download:!0}))}),qe.push(nn)}let Pt=ye,Hr=ye.req||g;if(e.decompress!==!1&&ye.headers["content-encoding"])switch((p==="HEAD"||ye.statusCode===204)&&delete ye.headers["content-encoding"],(ye.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":qe.push(Mp.default.createUnzip(FB)),delete ye.headers["content-encoding"];break;case"deflate":qe.push(new lpe),qe.push(Mp.default.createUnzip(FB)),delete ye.headers["content-encoding"];break;case"br":LB&&(qe.push(Mp.default.createBrotliDecompress(dpe)),delete ye.headers["content-encoding"])}Pt=qe.length>1?Ap.default.pipeline(qe,Z.noop):qe[0];let xs=Ap.default.finished(Pt,()=>{xs(),x()}),Bt={status:ye.statusCode,statusText:ye.statusMessage,headers:new Bs(ye.headers),config:e,request:Hr};if(l==="stream")Bt.data=Pt,Lx(n,i,Bt);else{let nn=[],Gi=0;Pt.on("data",function(ur){nn.push(ur),Gi+=ur.length,e.maxContentLength>-1&&Gi>e.maxContentLength&&(h=!0,Pt.destroy(),i(new Xe("maxContentLength size of "+e.maxContentLength+" exceeded",Xe.ERR_BAD_RESPONSE,e,Hr)))}),Pt.on("aborted",function(){if(h)return;let ur=new Xe("maxContentLength size of "+e.maxContentLength+" exceeded",Xe.ERR_BAD_RESPONSE,e,Hr);Pt.destroy(ur),i(ur)}),Pt.on("error",function(ur){g.destroyed||i(Xe.from(ur,null,e,Hr))}),Pt.on("end",function(){try{let ur=nn.length===1?nn[0]:Buffer.concat(nn);l!=="arraybuffer"&&(ur=ur.toString(u),(!u||u==="utf8")&&(ur=Z.stripBOM(ur))),Bt.data=ur}catch(ur){return i(Xe.from(ur,null,e,Bt.request,Bt))}Lx(n,i,Bt)})}y.once("abort",nn=>{Pt.destroyed||(Pt.emit("error",nn),Pt.destroy())})}),y.once("abort",X=>{i(X),g.destroy(X)}),g.on("error",function(ye){i(Xe.from(ye,null,e,g))}),g.on("socket",function(ye){ye.setKeepAlive(!0,1e3*60)}),e.timeout){let X=parseInt(e.timeout,10);if(Number.isNaN(X)){i(new Xe("error trying to parse `config.timeout` to int",Xe.ERR_BAD_OPTION_VALUE,e,g));return}g.setTimeout(X,function(){if(m)return;let qe=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",hn=e.transitional||nO;e.timeoutErrorMessage&&(qe=e.timeoutErrorMessage),i(new Xe(qe,hn.clarifyTimeoutError?Xe.ETIMEDOUT:Xe.ECONNABORTED,e,g)),E()})}if(Z.isStream(s)){let X=!1,ye=!1;s.on("end",()=>{X=!0}),s.once("error",qe=>{ye=!0,g.destroy(qe)}),s.on("close",()=>{!X&&!ye&&E(new Nm("Request stream has been aborted",e,g))}),s.pipe(g)}else g.end(s)})},Spe=Ws.hasStandardBrowserEnv?function(){return{write:function(t,n,i,o,s,a){let c=[];c.push(t+"="+encodeURIComponent(n)),Z.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),Z.isString(o)&&c.push("path="+o),Z.isString(s)&&c.push("domain="+s),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){let n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),xpe=Ws.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),n;function i(o){let s=o;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(s){let a=Z.isString(s)?i(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function WB(r,e){let t=0,n=d6(50,250);return i=>{let o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=n(a),l=o<=s;t=o;let u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,r(u)}}var Cpe=typeof XMLHttpRequest<"u",wpe=Cpe&&function(r){return new Promise(function(t,n){let i=r.data,o=Bs.from(r.headers).normalize(),s=r.responseType,a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let l;if(Z.isFormData(i)){if(Ws.hasStandardBrowserEnv||Ws.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((l=o.getContentType())!==!1){let[g,...y]=l?l.split(";").map(x=>x.trim()).filter(Boolean):[];o.setContentType([g||"multipart/form-data",...y].join("; "))}}let u=new XMLHttpRequest;if(r.auth){let g=r.auth.username||"",y=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(g+":"+y))}let p=sO(r.baseURL,r.url);u.open(r.method.toUpperCase(),rO(p,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function m(){if(!u)return;let g=Bs.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),x={data:!s||s==="text"||s==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:g,config:r,request:u};Lx(function(A){t(A),c()},function(A){n(A),c()},x),u=null}if("onloadend"in u?u.onloadend=m:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(m)},u.onabort=function(){u&&(n(new Xe("Request aborted",Xe.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new Xe("Network Error",Xe.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",x=r.transitional||nO;r.timeoutErrorMessage&&(y=r.timeoutErrorMessage),n(new Xe(y,x.clarifyTimeoutError?Xe.ETIMEDOUT:Xe.ECONNABORTED,r,u)),u=null},Ws.hasStandardBrowserEnv){let g=xpe(p)&&r.xsrfCookieName&&Spe.read(r.xsrfCookieName);g&&o.set(r.xsrfHeaderName,g)}i===void 0&&o.setContentType(null),"setRequestHeader"in u&&Z.forEach(o.toJSON(),function(y,x){u.setRequestHeader(x,y)}),Z.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),s&&s!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",WB(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",WB(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=g=>{u&&(n(!g||g.type?new Nm(null,r,u):g),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));let h=p6(p);if(h&&Ws.protocols.indexOf(h)===-1){n(new Xe("Unsupported protocol "+h+":",Xe.ERR_BAD_REQUEST,r));return}u.send(i||null)})},YM={http:Ipe,xhr:wpe};Z.forEach(YM,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var VB=r=>`- ${r}`,Epe=r=>Z.isFunction(r)||r===null||r===!1,h6={getAdapter:r=>{r=Z.isArray(r)?r:[r];let{length:e}=r,t,n,i={};for(let o=0;o<e;o++){t=r[o];let s;if(n=t,!Epe(t)&&(n=YM[(s=String(t)).toLowerCase()],n===void 0))throw new Xe(`Unknown adapter '${s}'`);if(n)break;i[s||"#"+o]=n}if(!n){let o=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build")),s=e?o.length>1?`since :
`+o.map(VB).join(`
`):" "+VB(o[0]):"as no adapter specified";throw new Xe("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:YM};function qM(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Nm(null,r)}function BB(r){return qM(r),r.headers=Bs.from(r.headers),r.data=BM.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),h6.getAdapter(r.adapter||oO.adapter)(r).then(function(n){return qM(r),n.data=BM.call(r,r.transformResponse,n),n.headers=Bs.from(n.headers),n},function(n){return u6(n)||(qM(r),n&&n.response&&(n.response.data=BM.call(r,r.transformResponse,n.response),n.response.headers=Bs.from(n.response.headers))),Promise.reject(n)})}var qB=r=>r instanceof Bs?r.toJSON():r;function Jg(r,e){e=e||{};let t={};function n(l,u,p){return Z.isPlainObject(l)&&Z.isPlainObject(u)?Z.merge.call({caseless:p},l,u):Z.isPlainObject(u)?Z.merge({},u):Z.isArray(u)?u.slice():u}function i(l,u,p){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return n(void 0,l,p)}else return n(l,u,p)}function o(l,u){if(!Z.isUndefined(u))return n(void 0,u)}function s(l,u){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return n(void 0,l)}else return n(void 0,u)}function a(l,u,p){if(p in e)return n(l,u);if(p in r)return n(void 0,l)}let c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(qB(l),qB(u),!0)};return Z.forEach(Object.keys(Object.assign({},r,e)),function(u){let p=c[u]||i,m=p(r[u],e[u],u);Z.isUndefined(m)&&p!==a||(t[u]=m)}),t}var aO={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{aO[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var JB={};aO.transitional=function(e,t,n){function i(o,s){return"[Axios v"+xk+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,a)=>{if(e===!1)throw new Xe(i(s," has been removed"+(t?" in "+t:"")),Xe.ERR_DEPRECATED);return t&&!JB[s]&&(JB[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};function Ppe(r,e,t){if(typeof r!="object")throw new Xe("options must be an object",Xe.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let o=n[i],s=e[o];if(s){let a=r[o],c=a===void 0||s(a,o,r);if(c!==!0)throw new Xe("option "+o+" must be "+c,Xe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Xe("Unknown option "+o,Xe.ERR_BAD_OPTION)}}var XM={assertOptions:Ppe,validators:aO},Rp=XM.validators,$g=class{constructor(e){this.defaults=e,this.interceptors={request:new NB,response:new NB}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Jg(this.defaults,t);let{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&XM.assertOptions(n,{silentJSONParsing:Rp.transitional(Rp.boolean),forcedJSONParsing:Rp.transitional(Rp.boolean),clarifyTimeoutError:Rp.transitional(Rp.boolean)},!1),i!=null&&(Z.isFunction(i)?t.paramsSerializer={serialize:i}:XM.assertOptions(i,{encode:Rp.function,serialize:Rp.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&Z.merge(o.common,o[t.method]);o&&Z.forEach(["delete","get","head","post","put","patch","common"],g=>{delete o[g]}),t.headers=Bs.concat(s,o);let a=[],c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});let l=[];this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let u,p=0,m;if(!c){let g=[BB.bind(this),void 0];for(g.unshift.apply(g,a),g.push.apply(g,l),m=g.length,u=Promise.resolve(t);p<m;)u=u.then(g[p++],g[p++]);return u}m=a.length;let h=t;for(p=0;p<m;){let g=a[p++],y=a[p++];try{h=g(h)}catch(x){y.call(this,x);break}}try{u=BB.call(this,h)}catch(g){return Promise.reject(g)}for(p=0,m=l.length;p<m;)u=u.then(l[p++],l[p++]);return u}getUri(e){e=Jg(this.defaults,e);let t=sO(e.baseURL,e.url);return rO(t,e.params,e.paramsSerializer)}};Z.forEach(["delete","get","head","options"],function(e){$g.prototype[e]=function(t,n){return this.request(Jg(n||{},{method:e,url:t,data:(n||{}).data}))}});Z.forEach(["post","put","patch"],function(e){function t(n){return function(o,s,a){return this.request(Jg(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}$g.prototype[e]=t(),$g.prototype[e+"Form"]=t(!0)});var Sk=$g,ZM=class r{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,s=new Promise(a=>{n.subscribe(a),o=a}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},e(function(o,s,a){n.reason||(n.reason=new Nm(o,s,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new r(function(i){e=i}),cancel:e}}},kpe=ZM;function Dpe(r){return function(t){return r.apply(null,t)}}function _pe(r){return Z.isObject(r)&&r.isAxiosError===!0}var eO={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(eO).forEach(([r,e])=>{eO[e]=r});var Tpe=eO;function g6(r){let e=new Sk(r),t=zB(Sk.prototype.request,e);return Z.extend(t,Sk.prototype,e,{allOwnKeys:!0}),Z.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return g6(Jg(r,i))},t}var Fn=g6(oO);Fn.Axios=Sk;Fn.CanceledError=Nm;Fn.CancelToken=kpe;Fn.isCancel=u6;Fn.VERSION=xk;Fn.toFormData=Pk;Fn.AxiosError=Xe;Fn.Cancel=Fn.CanceledError;Fn.all=function(e){return Promise.all(e)};Fn.spread=Dpe;Fn.isAxiosError=_pe;Fn.mergeConfig=Jg;Fn.AxiosHeaders=Bs;Fn.formToJSON=r=>l6(Z.isHTMLForm(r)?new FormData(r):r);Fn.getAdapter=h6.getAdapter;Fn.HttpStatusCode=Tpe;Fn.default=Fn;v6.exports=Fn});var b6=M(kk=>{"use strict";Object.defineProperty(kk,"__esModule",{value:!0});kk.AxiosHttpClient=void 0;var Rpe=y6(),cO=class{constructor(e){this.endpoint=e}get(e){return Rpe.default.get(this.endpoint,Object.assign(Object.assign({},e),{proxy:!1}))}};kk.AxiosHttpClient=cO});var I6=M(Dk=>{"use strict";Object.defineProperty(Dk,"__esModule",{value:!0});Dk.MemoryKeyValueStorage=void 0;var lO=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};Dk.MemoryKeyValueStorage=lO});var S6=M(_k=>{"use strict";Object.defineProperty(_k,"__esModule",{value:!0});_k.ExperimentationServiceBase=void 0;var Ape=I6(),uO=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,n,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=n,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new Ape.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async n=>await n.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let n={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)n.features.includes(o)||n.features.push(o);for(let o of i.configs){let s=n.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):n.configs.push(o)}n.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=n),this.storage&&this.storage.setValue(this.storageKey,n)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let n=this.features.configs.find(i=>i.Id===e);return n?.Parameters[t]}async getTreatmentVariableAsync(e,t,n){if(n){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};_k.ExperimentationServiceBase=uO});var x6=M(Tk=>{"use strict";Object.defineProperty(Tk,"__esModule",{value:!0});Tk.PollingService=void 0;var pO=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};Tk.PollingService=pO});var C6=M(Rk=>{"use strict";Object.defineProperty(Rk,"__esModule",{value:!0});Rk.ExperimentationServiceAutoPolling=void 0;var Npe=S6(),Mpe=x6(),dO=class extends Npe.ExperimentationServiceBase{constructor(e,t,n,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=n,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,n<1e3&&n!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");n>0&&(this.pollingService=new Mpe.PollingService(n),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};Rk.ExperimentationServiceAutoPolling=dO});var w6=M(Nk=>{"use strict";Object.defineProperty(Nk,"__esModule",{value:!0});Nk.ExperimentationService=void 0;var Ope=_3(),Kpe=b6(),Fpe=C6(),Ak=class extends Fpe.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Ope.TasApiFeatureProvider(new Kpe.AxiosHttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};Nk.ExperimentationService=Ak;Ak.REFRESH_RATE_IN_MINUTES=30});var E6=M(Mk=>{"use strict";Object.defineProperty(Mk,"__esModule",{value:!0});Mk.ExperimentationService=void 0;var Lpe=w6();Object.defineProperty(Mk,"ExperimentationService",{enumerable:!0,get:function(){return Lpe.ExperimentationService}})});var P6=M(Ok=>{"use strict";Object.defineProperty(Ok,"__esModule",{value:!0});Ok.MementoKeyValueStorage=void 0;var mO=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};Ok.MementoKeyValueStorage=mO});var k6=M(hO=>{"use strict";Object.defineProperty(hO,"__esModule",{value:!0});var fO=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};hO.default=fO});var _6=M(Gg=>{"use strict";Object.defineProperty(Gg,"__esModule",{value:!0});Gg.getExperimentationServiceAsync=Gg.getExperimentationService=void 0;var Upe=pM(),jpe=E6(),gO=require("vscode"),Wpe=P6(),Vpe=k6(),Bpe="https://default.exp-tas.com/vscode/ab",qpe="query-expfeature",Jpe="abexp.assignmentcontext",$pe="VSCode.ABExp.FeatureData",Hpe=1e3*60*30;function D6(r,e,t,n,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=gO.workspace.getConfiguration("telemetry");if(!(gO.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):gO.env.isTelemetryEnabled))return new Vpe.default;let l=[new Upe.VSCodeFilterProvider(r,e,t),...o],u=new Wpe.MementoKeyValueStorage(i);return new jpe.ExperimentationService({filterProviders:l,telemetry:n,storageKey:$pe,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:Jpe,telemetryEventName:qpe,endpoint:Bpe,refetchInterval:Hpe})}Gg.getExperimentationService=D6;async function Gpe(r,e,t,n,i,...o){let s=D6(r,e,t,n,i,...o);return await s.initializePromise,s}Gg.getExperimentationServiceAsync=Gpe});var R6=M(Op=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});Op.TargetPopulation=Op.getExperimentationServiceAsync=Op.getExperimentationService=void 0;var T6=_6();Object.defineProperty(Op,"getExperimentationService",{enumerable:!0,get:function(){return T6.getExperimentationService}});Object.defineProperty(Op,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return T6.getExperimentationServiceAsync}});var zpe=pM();Object.defineProperty(Op,"TargetPopulation",{enumerable:!0,get:function(){return zpe.TargetPopulation}})});var W6=M((gAe,j6)=>{"use strict";function Xpe(){let r=[].slice.call(arguments).filter(t=>t),e=r.shift();return r.forEach(t=>{Object.keys(t).forEach(n=>{e[n]=t[n]})}),e}j6.exports=Xpe});var ko=M(IO=>{"use strict";IO.fromCallback=function(r){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")r.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(n,i)=>{if(n)return t(n);e(i)},arguments.length++,r.apply(this,arguments)})},"name",{value:r.name})};IO.fromPromise=function(r){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return r.apply(this,arguments);r.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:r.name})}});var B6=M((yAe,V6)=>{var Up=require("constants"),Zpe=process.cwd,Wk=null,ede=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return Wk||(Wk=Zpe.call(process)),Wk};try{process.cwd()}catch{}typeof process.chdir=="function"&&(SO=process.chdir,process.chdir=function(r){Wk=null,SO.call(process,r)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,SO));var SO;V6.exports=tde;function tde(r){Up.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(r),r.lutimes||t(r),r.chown=o(r.chown),r.fchown=o(r.fchown),r.lchown=o(r.lchown),r.chmod=n(r.chmod),r.fchmod=n(r.fchmod),r.lchmod=n(r.lchmod),r.chownSync=s(r.chownSync),r.fchownSync=s(r.fchownSync),r.lchownSync=s(r.lchownSync),r.chmodSync=i(r.chmodSync),r.fchmodSync=i(r.fchmodSync),r.lchmodSync=i(r.lchmodSync),r.stat=a(r.stat),r.fstat=a(r.fstat),r.lstat=a(r.lstat),r.statSync=c(r.statSync),r.fstatSync=c(r.fstatSync),r.lstatSync=c(r.lstatSync),r.chmod&&!r.lchmod&&(r.lchmod=function(u,p,m){m&&process.nextTick(m)},r.lchmodSync=function(){}),r.chown&&!r.lchown&&(r.lchown=function(u,p,m,h){h&&process.nextTick(h)},r.lchownSync=function(){}),ede==="win32"&&(r.rename=typeof r.rename!="function"?r.rename:function(u){function p(m,h,g){var y=Date.now(),x=0;u(m,h,function E(A){if(A&&(A.code==="EACCES"||A.code==="EPERM")&&Date.now()-y<6e4){setTimeout(function(){r.stat(h,function(T,j){T&&T.code==="ENOENT"?u(m,h,E):g(A)})},x),x<100&&(x+=10);return}g&&g(A)})}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.rename)),r.read=typeof r.read!="function"?r.read:function(u){function p(m,h,g,y,x,E){var A;if(E&&typeof E=="function"){var T=0;A=function(j,oe,G){if(j&&j.code==="EAGAIN"&&T<10)return T++,u.call(r,m,h,g,y,x,A);E.apply(this,arguments)}}return u.call(r,m,h,g,y,x,A)}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.read),r.readSync=typeof r.readSync!="function"?r.readSync:function(u){return function(p,m,h,g,y){for(var x=0;;)try{return u.call(r,p,m,h,g,y)}catch(E){if(E.code==="EAGAIN"&&x<10){x++;continue}throw E}}}(r.readSync);function e(u){u.lchmod=function(p,m,h){u.open(p,Up.O_WRONLY|Up.O_SYMLINK,m,function(g,y){if(g){h&&h(g);return}u.fchmod(y,m,function(x){u.close(y,function(E){h&&h(x||E)})})})},u.lchmodSync=function(p,m){var h=u.openSync(p,Up.O_WRONLY|Up.O_SYMLINK,m),g=!0,y;try{y=u.fchmodSync(h,m),g=!1}finally{if(g)try{u.closeSync(h)}catch{}else u.closeSync(h)}return y}}function t(u){Up.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(p,m,h,g){u.open(p,Up.O_SYMLINK,function(y,x){if(y){g&&g(y);return}u.futimes(x,m,h,function(E){u.close(x,function(A){g&&g(E||A)})})})},u.lutimesSync=function(p,m,h){var g=u.openSync(p,Up.O_SYMLINK),y,x=!0;try{y=u.futimesSync(g,m,h),x=!1}finally{if(x)try{u.closeSync(g)}catch{}else u.closeSync(g)}return y}):u.futimes&&(u.lutimes=function(p,m,h,g){g&&process.nextTick(g)},u.lutimesSync=function(){})}function n(u){return u&&function(p,m,h){return u.call(r,p,m,function(g){l(g)&&(g=null),h&&h.apply(this,arguments)})}}function i(u){return u&&function(p,m){try{return u.call(r,p,m)}catch(h){if(!l(h))throw h}}}function o(u){return u&&function(p,m,h,g){return u.call(r,p,m,h,function(y){l(y)&&(y=null),g&&g.apply(this,arguments)})}}function s(u){return u&&function(p,m,h){try{return u.call(r,p,m,h)}catch(g){if(!l(g))throw g}}}function a(u){return u&&function(p,m,h){typeof m=="function"&&(h=m,m=null);function g(y,x){x&&(x.uid<0&&(x.uid+=4294967296),x.gid<0&&(x.gid+=4294967296)),h&&h.apply(this,arguments)}return m?u.call(r,p,m,g):u.call(r,p,g)}}function c(u){return u&&function(p,m){var h=m?u.call(r,p,m):u.call(r,p);return h&&(h.uid<0&&(h.uid+=4294967296),h.gid<0&&(h.gid+=4294967296)),h}}function l(u){if(!u||u.code==="ENOSYS")return!0;var p=!process.getuid||process.getuid()!==0;return!!(p&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var $6=M((bAe,J6)=>{var q6=require("stream").Stream;J6.exports=rde;function rde(r){return{ReadStream:e,WriteStream:t};function e(n,i){if(!(this instanceof e))return new e(n,i);q6.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var l=s[a];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}r.open(this.path,this.flags,this.mode,function(u,p){if(u){o.emit("error",u),o.readable=!1;return}o.fd=p,o.emit("open",p),o._read()})}function t(n,i){if(!(this instanceof t))return new t(n,i);q6.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var c=o[s];this[c]=i[c]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=r.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var G6=M((IAe,H6)=>{"use strict";H6.exports=ide;var nde=Object.getPrototypeOf||function(r){return r.__proto__};function ide(r){if(r===null||typeof r!="object")return r;if(r instanceof Object)var e={__proto__:nde(r)};else var e=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}});var Ln=M((SAe,wO)=>{var mn=require("fs"),ode=B6(),sde=$6(),ade=G6(),Vk=require("util"),hi,qk;typeof Symbol=="function"&&typeof Symbol.for=="function"?(hi=Symbol.for("graceful-fs.queue"),qk=Symbol.for("graceful-fs.previous")):(hi="___graceful-fs.queue",qk="___graceful-fs.previous");function cde(){}function Y6(r,e){Object.defineProperty(r,hi,{get:function(){return e}})}var Mm=cde;Vk.debuglog?Mm=Vk.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Mm=function(){var r=Vk.format.apply(Vk,arguments);r="GFS4: "+r.split(/\n/).join(`
GFS4: `),console.error(r)});mn[hi]||(z6=global[hi]||[],Y6(mn,z6),mn.close=function(r){function e(t,n){return r.call(mn,t,function(i){i||Q6(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,qk,{value:r}),e}(mn.close),mn.closeSync=function(r){function e(t){r.apply(mn,arguments),Q6()}return Object.defineProperty(e,qk,{value:r}),e}(mn.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Mm(mn[hi]),require("assert").equal(mn[hi].length,0)}));var z6;global[hi]||Y6(global,mn[hi]);wO.exports=xO(ade(mn));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!mn.__patched&&(wO.exports=xO(mn),mn.__patched=!0);function xO(r){ode(r),r.gracefulify=xO,r.createReadStream=oe,r.createWriteStream=G;var e=r.readFile;r.readFile=t;function t(te,Ce,Le){return typeof Ce=="function"&&(Le=Ce,Ce=null),ct(te,Ce,Le);function ct(ft,rt,ae,ke){return e(ft,rt,function(X){X&&(X.code==="EMFILE"||X.code==="ENFILE")?rv([ct,[ft,rt,ae],X,ke||Date.now(),Date.now()]):typeof ae=="function"&&ae.apply(this,arguments)})}}var n=r.writeFile;r.writeFile=i;function i(te,Ce,Le,ct){return typeof Le=="function"&&(ct=Le,Le=null),ft(te,Ce,Le,ct);function ft(rt,ae,ke,X,ye){return n(rt,ae,ke,function(qe){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?rv([ft,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}var o=r.appendFile;o&&(r.appendFile=s);function s(te,Ce,Le,ct){return typeof Le=="function"&&(ct=Le,Le=null),ft(te,Ce,Le,ct);function ft(rt,ae,ke,X,ye){return o(rt,ae,ke,function(qe){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?rv([ft,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}var a=r.copyFile;a&&(r.copyFile=c);function c(te,Ce,Le,ct){return typeof Le=="function"&&(ct=Le,Le=0),ft(te,Ce,Le,ct);function ft(rt,ae,ke,X,ye){return a(rt,ae,ke,function(qe){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?rv([ft,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}var l=r.readdir;r.readdir=p;var u=/^v[0-5]\./;function p(te,Ce,Le){typeof Ce=="function"&&(Le=Ce,Ce=null);var ct=u.test(process.version)?function(ae,ke,X,ye){return l(ae,ft(ae,ke,X,ye))}:function(ae,ke,X,ye){return l(ae,ke,ft(ae,ke,X,ye))};return ct(te,Ce,Le);function ft(rt,ae,ke,X){return function(ye,qe){ye&&(ye.code==="EMFILE"||ye.code==="ENFILE")?rv([ct,[rt,ae,ke],ye,X||Date.now(),Date.now()]):(qe&&qe.sort&&qe.sort(),typeof ke=="function"&&ke.call(this,ye,qe))}}}if(process.version.substr(0,4)==="v0.8"){var m=sde(r);E=m.ReadStream,T=m.WriteStream}var h=r.ReadStream;h&&(E.prototype=Object.create(h.prototype),E.prototype.open=A);var g=r.WriteStream;g&&(T.prototype=Object.create(g.prototype),T.prototype.open=j),Object.defineProperty(r,"ReadStream",{get:function(){return E},set:function(te){E=te},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WriteStream",{get:function(){return T},set:function(te){T=te},enumerable:!0,configurable:!0});var y=E;Object.defineProperty(r,"FileReadStream",{get:function(){return y},set:function(te){y=te},enumerable:!0,configurable:!0});var x=T;Object.defineProperty(r,"FileWriteStream",{get:function(){return x},set:function(te){x=te},enumerable:!0,configurable:!0});function E(te,Ce){return this instanceof E?(h.apply(this,arguments),this):E.apply(Object.create(E.prototype),arguments)}function A(){var te=this;pe(te.path,te.flags,te.mode,function(Ce,Le){Ce?(te.autoClose&&te.destroy(),te.emit("error",Ce)):(te.fd=Le,te.emit("open",Le),te.read())})}function T(te,Ce){return this instanceof T?(g.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function j(){var te=this;pe(te.path,te.flags,te.mode,function(Ce,Le){Ce?(te.destroy(),te.emit("error",Ce)):(te.fd=Le,te.emit("open",Le))})}function oe(te,Ce){return new r.ReadStream(te,Ce)}function G(te,Ce){return new r.WriteStream(te,Ce)}var ue=r.open;r.open=pe;function pe(te,Ce,Le,ct){return typeof Le=="function"&&(ct=Le,Le=null),ft(te,Ce,Le,ct);function ft(rt,ae,ke,X,ye){return ue(rt,ae,ke,function(qe,hn){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?rv([ft,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}return r}function rv(r){Mm("ENQUEUE",r[0].name,r[1]),mn[hi].push(r),CO()}var Bk;function Q6(){for(var r=Date.now(),e=0;e<mn[hi].length;++e)mn[hi][e].length>2&&(mn[hi][e][3]=r,mn[hi][e][4]=r);CO()}function CO(){if(clearTimeout(Bk),Bk=void 0,mn[hi].length!==0){var r=mn[hi].shift(),e=r[0],t=r[1],n=r[2],i=r[3],o=r[4];if(i===void 0)Mm("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Mm("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,c=Math.max(o-i,1),l=Math.min(c*1.2,100);a>=l?(Mm("RETRY",e.name,t),e.apply(null,t.concat([i]))):mn[hi].push(r)}Bk===void 0&&(Bk=setTimeout(CO,0))}}});var EO=M(nv=>{var lde=ko().fromCallback,Aa=Ln(),ude=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(r=>typeof Aa[r]=="function");Object.keys(Aa).forEach(r=>{nv[r]=Aa[r]});ude.forEach(r=>{nv[r]=lde(Aa[r])});nv.exists=function(r,e){return typeof e=="function"?Aa.exists(r,e):new Promise(t=>Aa.exists(r,t))};nv.read=function(r,e,t,n,i,o){return typeof o=="function"?Aa.read(r,e,t,n,i,o):new Promise((s,a)=>{Aa.read(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesRead:l,buffer:u})})})};nv.write=function(r,e,t,n,i,o){return typeof arguments[arguments.length-1]=="function"?Aa.write(r,e,t,n,i,o):typeof e=="string"?new Promise((s,a)=>{Aa.write(r,e,t,n,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})}):new Promise((s,a)=>{Aa.write(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})})}});var eq=M((CAe,Z6)=>{"use strict";var Zo=Ln(),X6=require("os"),Jk=require("path");function pde(){let r=Jk.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));r=Jk.join(X6.tmpdir(),r);let e=new Date(1435410243862);Zo.writeFileSync(r,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=Zo.openSync(r,"r+");return Zo.futimesSync(t,e,e),Zo.closeSync(t),Zo.statSync(r).mtime>1435410243e3}function dde(r){let e=Jk.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=Jk.join(X6.tmpdir(),e);let t=new Date(1435410243862);Zo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",n=>{if(n)return r(n);Zo.open(e,"r+",(i,o)=>{if(i)return r(i);Zo.futimes(o,t,t,s=>{if(s)return r(s);Zo.close(o,a=>{if(a)return r(a);Zo.stat(e,(c,l)=>{if(c)return r(c);r(null,l.mtime>1435410243e3)})})})})})}function mde(r){if(typeof r=="number")return Math.floor(r/1e3)*1e3;if(r instanceof Date)return new Date(Math.floor(r.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function fde(r,e,t,n){Zo.open(r,"r+",(i,o)=>{if(i)return n(i);Zo.futimes(o,e,t,s=>{Zo.close(o,a=>{n&&n(s||a)})})})}Z6.exports={hasMillisRes:dde,hasMillisResSync:pde,timeRemoveMillis:mde,utimesMillis:fde}});var PO=M((wAe,tq)=>{var es=Ln(),qx=require("path"),hde=eq();function gde(r,e,t,n){n||(n=t,t={});var i=process.cwd(),o=qx.resolve(i,r),s=qx.resolve(i,e),a=t.filter,c=t.transform,l=t.overwrite;l===void 0&&(l=t.clobber),l===void 0&&(l=!0);var u=t.errorOnExist,p=t.dereference,m=t.preserveTimestamps===!0,h=0,g=0,y=0,x=!1;E(o);function E(ae){if(h++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(ae))return rt(!0)}else if(typeof a=="function"&&!a(ae,e))return rt(!0)}return A(ae)}function A(ae){var ke=p?es.stat:es.lstat;y++,ke(ae,function(X,ye){if(X)return ft(X);var qe={name:ae,mode:ye.mode,mtime:ye.mtime,atime:ye.atime,stats:ye};if(ye.isDirectory())return G(qe);if(ye.isFile()||ye.isCharacterDevice()||ye.isBlockDevice())return T(qe);if(ye.isSymbolicLink())return te(ae)})}function T(ae){var ke=ae.name.replace(o,s.replace("$","$$$$"));ct(ke,function(X){X?j(ae,ke):l?oe(ke,function(){j(ae,ke)}):u?ft(new Error(ke+" already exists")):rt()})}function j(ae,ke){var X=es.createReadStream(ae.name),ye=es.createWriteStream(ke,{mode:ae.mode});X.on("error",ft),ye.on("error",ft),c?c(X,ye,ae):ye.on("open",function(){X.pipe(ye)}),ye.once("close",function(){es.chmod(ke,ae.mode,function(qe){if(qe)return ft(qe);m?hde.utimesMillis(ke,ae.atime,ae.mtime,function(hn){return hn?ft(hn):rt()}):rt()})})}function oe(ae,ke){es.unlink(ae,function(X){return X?ft(X):ke()})}function G(ae){var ke=ae.name.replace(o,s.replace("$","$$$$"));ct(ke,function(X){if(X)return ue(ae,ke);pe(ae.name)})}function ue(ae,ke){es.mkdir(ke,ae.mode,function(X){if(X)return ft(X);es.chmod(ke,ae.mode,function(ye){if(ye)return ft(ye);pe(ae.name)})})}function pe(ae){es.readdir(ae,function(ke,X){return ke?ft(ke):(X.forEach(function(ye){E(qx.join(ae,ye))}),rt())})}function te(ae){var ke=ae.replace(o,s);es.readlink(ae,function(X,ye){if(X)return ft(X);Ce(ye,ke)})}function Ce(ae,ke){p&&(ae=qx.resolve(i,ae)),ct(ke,function(X){if(X)return Le(ae,ke);es.readlink(ke,function(ye,qe){return ye?ft(ye):(p&&(qe=qx.resolve(i,qe)),qe===ae?rt():oe(ke,function(){Le(ae,ke)}))})})}function Le(ae,ke){es.symlink(ae,ke,function(X){return X?ft(X):rt()})}function ct(ae,ke){es.lstat(ae,function(X){return X&&X.code==="ENOENT"?ke(!0):ke(!1)})}function ft(ae){if(!x&&n!==void 0)return x=!0,n(ae)}function rt(ae){if(ae||y--,g++,h===g&&y===0&&n!==void 0)return n(null)}}tq.exports=gde});var DO=M((EAe,nq)=>{"use strict";var kO=require("path");function rq(r){return r=kO.normalize(kO.resolve(r)).split(kO.sep),r.length>0?r[0]:null}var vde=/[<>:"|?*]/;function yde(r){let e=rq(r);return r=r.replace(e,""),vde.test(r)}nq.exports={getRootPath:rq,invalidWin32Path:yde}});var oq=M((PAe,iq)=>{"use strict";var bde=Ln(),_O=require("path"),Ide=DO().invalidWin32Path,Sde=parseInt("0777",8);function TO(r,e,t,n){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&Ide(r)){let s=new Error(r+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||bde;i===void 0&&(i=Sde&~process.umask()),n||(n=null),t=t||function(){},r=_O.resolve(r),o.mkdir(r,i,s=>{if(!s)return n=n||r,t(null,n);switch(s.code){case"ENOENT":if(_O.dirname(r)===r)return t(s);TO(_O.dirname(r),e,(a,c)=>{a?t(a,c):TO(r,e,t,c)});break;default:o.stat(r,(a,c)=>{a||!c.isDirectory()?t(s,n):t(null,n)});break}})}iq.exports=TO});var aq=M((kAe,sq)=>{"use strict";var xde=Ln(),RO=require("path"),Cde=DO().invalidWin32Path,wde=parseInt("0777",8);function AO(r,e,t){(!e||typeof e!="object")&&(e={mode:e});let n=e.mode,i=e.fs||xde;if(process.platform==="win32"&&Cde(r)){let o=new Error(r+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}n===void 0&&(n=wde&~process.umask()),t||(t=null),r=RO.resolve(r);try{i.mkdirSync(r,n),t=t||r}catch(o){switch(o.code){case"ENOENT":if(RO.dirname(r)===r)throw o;t=AO(RO.dirname(r),e,t),AO(r,e,t);break;default:let s;try{s=i.statSync(r)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}sq.exports=AO});var ts=M((DAe,cq)=>{"use strict";var Ede=ko().fromCallback,NO=Ede(oq()),MO=aq();cq.exports={mkdirs:NO,mkdirsSync:MO,mkdirp:NO,mkdirpSync:MO,ensureDir:NO,ensureDirSync:MO}});var Zl=M((_Ae,uq)=>{"use strict";var Pde=ko().fromPromise,lq=EO();function kde(r){return lq.access(r).then(()=>!0).catch(()=>!1)}uq.exports={pathExists:Pde(kde),pathExistsSync:lq.existsSync}});var mq=M((TAe,dq)=>{"use strict";var Dde=Ln(),Jx=require("path"),pq=PO(),_de=ts(),Tde=Zl().pathExists;function Rde(r,e,t,n){typeof t=="function"&&!n?(n=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),n=n||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=Jx.resolve(i,r),s=Jx.resolve(i,e);if(o===s)return n(new Error("Source and destination must not be the same."));Dde.lstat(r,(a,c)=>{if(a)return n(a);let l=null;if(c.isDirectory()){let u=e.split(Jx.sep);u.pop(),l=u.join(Jx.sep)}else l=Jx.dirname(e);Tde(l,(u,p)=>{if(u)return n(u);if(p)return pq(r,e,t,n);_de.mkdirs(l,m=>{if(m)return n(m);pq(r,e,t,n)})})})}dq.exports=Rde});var hq=M((RAe,fq)=>{var Ade=ko().fromCallback;fq.exports={copy:Ade(mq())}});var OO=M((AAe,gq)=>{gq.exports=function(r){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(r)}catch{return new Buffer(r)}return new Buffer(r)}});var Iq=M((NAe,bq)=>{"use strict";var $c=Ln(),yq=64*1024,vq=OO()(yq);function Nde(r,e,t){let n=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if($c.existsSync(e))if(n)$c.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=$c.openSync(r,"r"),a=$c.fstatSync(s),c=$c.openSync(e,"w",a.mode),l=1,u=0;for(;l>0;)l=$c.readSync(s,vq,0,yq,u),$c.writeSync(c,vq,0,l),u+=l;o&&$c.futimesSync(c,a.atime,a.mtime),$c.closeSync(s),$c.closeSync(c)}bq.exports=Nde});var wq=M((MAe,Cq)=>{"use strict";var Om=Ln(),KO=require("path"),Mde=Iq(),Sq=ts();function xq(r,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let n=t.recursive&&!t.dereference?Om.lstatSync(r):Om.statSync(r),i=KO.dirname(e),o=Om.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(r)):typeof t.filter=="function"&&(s=t.filter(r,e)),n.isFile()&&s)o||Sq.mkdirsSync(i),Mde(r,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(n.isDirectory()&&s)Om.existsSync(e)||Sq.mkdirsSync(e),Om.readdirSync(r).forEach(c=>{let l=t;l.recursive=!0,xq(KO.join(r,c),KO.join(e,c),l)});else if(t.recursive&&n.isSymbolicLink()&&s){let a=Om.readlinkSync(r);Om.symlinkSync(a,e)}}Cq.exports=xq});var FO=M((OAe,Eq)=>{Eq.exports={copySync:wq()}});var Mq=M((KAe,Nq)=>{"use strict";var Pq=Ln(),Tq=require("path"),pr=require("assert"),$x=process.platform==="win32";function Rq(r){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{r[t]=r[t]||Pq[t],t=t+"Sync",r[t]=r[t]||Pq[t]}),r.maxBusyTries=r.maxBusyTries||3}function LO(r,e,t){let n=0;typeof e=="function"&&(t=e,e={}),pr(r,"rimraf: missing path"),pr.equal(typeof r,"string","rimraf: path should be a string"),pr.equal(typeof t,"function","rimraf: callback function required"),pr(e,"rimraf: invalid options argument provided"),pr.equal(typeof e,"object","rimraf: options should be object"),Rq(e),kq(r,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&n<e.maxBusyTries){n++;let s=n*100;return setTimeout(()=>kq(r,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function kq(r,e,t){pr(r),pr(e),pr(typeof t=="function"),e.lstat(r,(n,i)=>{if(n&&n.code==="ENOENT")return t(null);if(n&&n.code==="EPERM"&&$x)return Dq(r,e,n,t);if(i&&i.isDirectory())return $k(r,e,n,t);e.unlink(r,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return $x?Dq(r,e,o,t):$k(r,e,o,t);if(o.code==="EISDIR")return $k(r,e,o,t)}return t(o)})})}function Dq(r,e,t,n){pr(r),pr(e),pr(typeof n=="function"),t&&pr(t instanceof Error),e.chmod(r,438,i=>{i?n(i.code==="ENOENT"?null:t):e.stat(r,(o,s)=>{o?n(o.code==="ENOENT"?null:t):s.isDirectory()?$k(r,e,t,n):e.unlink(r,n)})})}function _q(r,e,t){let n;pr(r),pr(e),t&&pr(t instanceof Error);try{e.chmodSync(r,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{n=e.statSync(r)}catch(i){if(i.code==="ENOENT")return;throw t}n.isDirectory()?Hk(r,e,t):e.unlinkSync(r)}function $k(r,e,t,n){pr(r),pr(e),t&&pr(t instanceof Error),pr(typeof n=="function"),e.rmdir(r,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Ode(r,e,n):i&&i.code==="ENOTDIR"?n(t):n(i)})}function Ode(r,e,t){pr(r),pr(e),pr(typeof t=="function"),e.readdir(r,(n,i)=>{if(n)return t(n);let o=i.length,s;if(o===0)return e.rmdir(r,t);i.forEach(a=>{LO(Tq.join(r,a),e,c=>{if(!s){if(c)return t(s=c);--o===0&&e.rmdir(r,t)}})})})}function Aq(r,e){let t;e=e||{},Rq(e),pr(r,"rimraf: missing path"),pr.equal(typeof r,"string","rimraf: path should be a string"),pr(e,"rimraf: missing options"),pr.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(r)}catch(n){if(n.code==="ENOENT")return;n.code==="EPERM"&&$x&&_q(r,e,n)}try{t&&t.isDirectory()?Hk(r,e,null):e.unlinkSync(r)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return $x?_q(r,e,n):Hk(r,e,n);if(n.code!=="EISDIR")throw n;Hk(r,e,n)}}function Hk(r,e,t){pr(r),pr(e),t&&pr(t instanceof Error);try{e.rmdirSync(r)}catch(n){if(n.code==="ENOTDIR")throw t;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")Kde(r,e);else if(n.code!=="ENOENT")throw n}}function Kde(r,e){pr(r),pr(e),e.readdirSync(r).forEach(i=>Aq(Tq.join(r,i),e));let t=$x?100:1,n=0;do{let i=!0;try{let o=e.rmdirSync(r,e);return i=!1,o}finally{if(++n<t&&i)continue}}while(!0)}Nq.exports=LO;LO.sync=Aq});var Hx=M((FAe,Kq)=>{"use strict";var Fde=ko().fromCallback,Oq=Mq();Kq.exports={remove:Fde(Oq),removeSync:Oq.sync}});var jq=M((LAe,Uq)=>{var iv;try{iv=Ln()}catch{iv=require("fs")}function Lde(r,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var n=e.fs||iv,i=!0;"throws"in e&&(i=e.throws),n.readFile(r,e,function(o,s){if(o)return t(o);s=Lq(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(c){return i?(c.message=r+": "+c.message,t(c)):t(null,null)}t(null,a)})}function Ude(r,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||iv,n=!0;"throws"in e&&(n=e.throws);try{var i=t.readFileSync(r,e);return i=Lq(i),JSON.parse(i,e.reviver)}catch(o){if(n)throw o.message=r+": "+o.message,o;return null}}function Fq(r,e){var t,n=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(n=e.EOL));var i=JSON.stringify(r,e?e.replacer:null,t);return i.replace(/\n/g,n)+n}function jde(r,e,t,n){n==null&&(n=t,t={}),t=t||{};var i=t.fs||iv,o="";try{o=Fq(e,t)}catch(s){n&&n(s,null);return}i.writeFile(r,o,t,n)}function Wde(r,e,t){t=t||{};var n=t.fs||iv,i=Fq(e,t);return n.writeFileSync(r,i,t)}function Lq(r){return Buffer.isBuffer(r)&&(r=r.toString("utf8")),r=r.replace(/^\uFEFF/,""),r}var Vde={readFile:Lde,readFileSync:Ude,writeFile:jde,writeFileSync:Wde};Uq.exports=Vde});var zk=M((UAe,Vq)=>{"use strict";var Wq=ko().fromCallback,Gk=jq();Vq.exports={readJson:Wq(Gk.readFile),readJsonSync:Gk.readFileSync,writeJson:Wq(Gk.writeFile),writeJsonSync:Gk.writeFileSync}});var Jq=M((jAe,qq)=>{"use strict";var Bde=require("path"),qde=ts(),Jde=Zl().pathExists,Bq=zk();function $de(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=Bde.dirname(r);Jde(i,(o,s)=>{if(o)return n(o);if(s)return Bq.writeJson(r,e,t,n);qde.mkdirs(i,a=>{if(a)return n(a);Bq.writeJson(r,e,t,n)})})}qq.exports=$de});var Hq=M((WAe,$q)=>{"use strict";var Hde=Ln(),Gde=require("path"),zde=ts(),Qde=zk();function Yde(r,e,t){let n=Gde.dirname(r);Hde.existsSync(n)||zde.mkdirsSync(n),Qde.writeJsonSync(r,e,t)}$q.exports=Yde});var zq=M((VAe,Gq)=>{"use strict";var Xde=ko().fromCallback,io=zk();io.outputJson=Xde(Jq());io.outputJsonSync=Hq();io.outputJSON=io.outputJson;io.outputJSONSync=io.outputJsonSync;io.writeJSON=io.writeJson;io.writeJSONSync=io.writeJsonSync;io.readJSON=io.readJson;io.readJSONSync=io.readJsonSync;Gq.exports=io});var Zq=M((BAe,Xq)=>{"use strict";var Zde=ko().fromCallback,Hc=Ln(),eme=PO(),Km=require("path"),Qk=Hx().remove,tme=ts().mkdirs;function UO(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=t.overwrite||t.clobber||!1;nme(r,e,(s,a)=>{if(s)return n(s);if(a)return n(new Error(`Cannot move '${r}' to a subdirectory of itself, '${e}'.`));tme(Km.dirname(e),c=>{if(c)return n(c);o()})});function o(){Km.resolve(r)===Km.resolve(e)?Hc.access(r,n):i?Hc.rename(r,e,s=>{if(!s)return n();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){Qk(e,a=>{if(a)return n(a);t.overwrite=!1,UO(r,e,t,n)});return}if(s.code==="EPERM"){setTimeout(()=>{Qk(e,a=>{if(a)return n(a);t.overwrite=!1,UO(r,e,t,n)})},200);return}if(s.code!=="EXDEV")return n(s);Qq(r,e,i,n)}):Hc.link(r,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?Qq(r,e,i,n):n(s):Hc.unlink(r,n))}}function Qq(r,e,t,n){Hc.stat(r,(i,o)=>{if(i)return n(i);o.isDirectory()?Yq(r,e,t,n):rme(r,e,t,n)})}function rme(r,e,t,n){let i=t?"w":"wx",o=Hc.createReadStream(r),s=Hc.createWriteStream(e,{flags:i});o.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),Hc.unlink(e,()=>{c.code==="EISDIR"||c.code==="EPERM"?Yq(r,e,t,n):n(c)})}),s.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),n(c)}),s.once("close",a),o.pipe(s);function a(){Hc.unlink(r,n)}}function Yq(r,e,t,n){let i={overwrite:!1};t?Qk(e,s=>{if(s)return n(s);o()}):o();function o(){eme(r,e,i,s=>{if(s)return n(s);Qk(r,n)})}}function nme(r,e,t){Hc.stat(r,(n,i)=>{if(n)return t(n);if(i.isDirectory()){let o=e.split(Km.dirname(r)+Km.sep)[1];if(o){let s=o.split(Km.sep)[0];return s?t(null,r!==e&&e.indexOf(r)>-1&&s===Km.basename(r)):t(null,!1)}return t(null,!1)}return t(null,!1)})}Xq.exports={move:Zde(UO)}});var nJ=M((qAe,rJ)=>{"use strict";var Do=Ln(),Fm=require("path"),ime=FO().copySync,jO=Hx().removeSync,ome=ts().mkdirsSync,sme=OO();function tJ(r,e,t){t=t||{};let n=t.overwrite||t.clobber||!1;if(r=Fm.resolve(r),e=Fm.resolve(e),r===e)return Do.accessSync(r);if(lme(r,e))throw new Error(`Cannot move '${r}' into itself '${e}'.`);ome(Fm.dirname(e)),i();function i(){if(n)try{return Do.renameSync(r,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return jO(e),t.overwrite=!1,tJ(r,e,t);if(o.code!=="EXDEV")throw o;return eJ(r,e,n)}else try{return Do.linkSync(r,e),Do.unlinkSync(r)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return eJ(r,e,n);throw o}}}function eJ(r,e,t){return Do.statSync(r).isDirectory()?cme(r,e,t):ame(r,e,t)}function ame(r,e,t){let i=sme(65536),o=t?"w":"wx",s=Do.openSync(r,"r"),a=Do.fstatSync(s),c=Do.openSync(e,o,a.mode),l=1,u=0;for(;l>0;)l=Do.readSync(s,i,0,65536,u),Do.writeSync(c,i,0,l),u+=l;return Do.closeSync(s),Do.closeSync(c),Do.unlinkSync(r)}function cme(r,e,t){let n={overwrite:!1};t&&jO(e),i();function i(){return ime(r,e,n),jO(r)}}function lme(r,e){try{return Do.statSync(r).isDirectory()&&r!==e&&e.indexOf(r)>-1&&e.split(Fm.dirname(r)+Fm.sep)[1].split(Fm.sep)[0]===Fm.basename(r)}catch{return!1}}rJ.exports={moveSync:tJ}});var pJ=M((JAe,uJ)=>{"use strict";var ume=ko().fromCallback,sJ=require("fs"),aJ=require("path"),cJ=ts(),lJ=Hx(),iJ=ume(function(e,t){t=t||function(){},sJ.readdir(e,(n,i)=>{if(n)return cJ.mkdirs(e,t);i=i.map(s=>aJ.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();lJ.remove(s,a=>{if(a)return t(a);o()})}})});function oJ(r){let e;try{e=sJ.readdirSync(r)}catch{return cJ.mkdirsSync(r)}e.forEach(t=>{t=aJ.join(r,t),lJ.removeSync(t)})}uJ.exports={emptyDirSync:oJ,emptydirSync:oJ,emptyDir:iJ,emptydir:iJ}});var hJ=M(($Ae,fJ)=>{"use strict";var pme=ko().fromCallback,dJ=require("path"),Gx=Ln(),mJ=ts(),dme=Zl().pathExists;function mme(r,e){function t(){Gx.writeFile(r,"",n=>{if(n)return e(n);e()})}Gx.stat(r,(n,i)=>{if(!n&&i.isFile())return e();let o=dJ.dirname(r);dme(o,(s,a)=>{if(s)return e(s);if(a)return t();mJ.mkdirs(o,c=>{if(c)return e(c);t()})})})}function fme(r){let e;try{e=Gx.statSync(r)}catch{}if(e&&e.isFile())return;let t=dJ.dirname(r);Gx.existsSync(t)||mJ.mkdirsSync(t),Gx.writeFileSync(r,"")}fJ.exports={createFile:pme(mme),createFileSync:fme}});var IJ=M((HAe,bJ)=>{"use strict";var hme=ko().fromCallback,vJ=require("path"),Lm=Ln(),yJ=ts(),gJ=Zl().pathExists;function gme(r,e,t){function n(i,o){Lm.link(i,o,s=>{if(s)return t(s);t(null)})}gJ(e,(i,o)=>{if(i)return t(i);if(o)return t(null);Lm.lstat(r,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let c=vJ.dirname(e);gJ(c,(l,u)=>{if(l)return t(l);if(u)return n(r,e);yJ.mkdirs(c,p=>{if(p)return t(p);n(r,e)})})})})}function vme(r,e,t){if(Lm.existsSync(e))return;try{Lm.lstatSync(r)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=vJ.dirname(e);return Lm.existsSync(i)||yJ.mkdirsSync(i),Lm.linkSync(r,e)}bJ.exports={createLink:hme(gme),createLinkSync:vme}});var xJ=M((GAe,SJ)=>{"use strict";var jp=require("path"),zx=Ln(),yme=Zl().pathExists;function bme(r,e,t){if(jp.isAbsolute(r))return zx.lstat(r,(n,i)=>n?(n.message=n.message.replace("lstat","ensureSymlink"),t(n)):t(null,{toCwd:r,toDst:r}));{let n=jp.dirname(e),i=jp.join(n,r);return yme(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:r}):zx.lstat(r,(a,c)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:r,toDst:jp.relative(n,r)})))}}function Ime(r,e){let t;if(jp.isAbsolute(r)){if(t=zx.existsSync(r),!t)throw new Error("absolute srcpath does not exist");return{toCwd:r,toDst:r}}else{let n=jp.dirname(e),i=jp.join(n,r);if(t=zx.existsSync(i),t)return{toCwd:i,toDst:r};if(t=zx.existsSync(r),!t)throw new Error("relative srcpath does not exist");return{toCwd:r,toDst:jp.relative(n,r)}}}SJ.exports={symlinkPaths:bme,symlinkPathsSync:Ime}});var EJ=M((zAe,wJ)=>{"use strict";var CJ=Ln();function Sme(r,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);CJ.lstat(r,(n,i)=>{if(n)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function xme(r,e){let t;if(e)return e;try{t=CJ.lstatSync(r)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}wJ.exports={symlinkType:Sme,symlinkTypeSync:xme}});var AJ=M((QAe,RJ)=>{"use strict";var Cme=ko().fromCallback,kJ=require("path"),ov=Ln(),DJ=ts(),wme=DJ.mkdirs,Eme=DJ.mkdirsSync,_J=xJ(),Pme=_J.symlinkPaths,kme=_J.symlinkPathsSync,TJ=EJ(),Dme=TJ.symlinkType,_me=TJ.symlinkTypeSync,PJ=Zl().pathExists;function Tme(r,e,t,n){n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,PJ(e,(i,o)=>{if(i)return n(i);if(o)return n(null);Pme(r,e,(s,a)=>{if(s)return n(s);r=a.toDst,Dme(a.toCwd,t,(c,l)=>{if(c)return n(c);let u=kJ.dirname(e);PJ(u,(p,m)=>{if(p)return n(p);if(m)return ov.symlink(r,e,l,n);wme(u,h=>{if(h)return n(h);ov.symlink(r,e,l,n)})})})})})}function Rme(r,e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,ov.existsSync(e))return;let o=kme(r,e);r=o.toDst,t=_me(o.toCwd,t);let s=kJ.dirname(e);return ov.existsSync(s)||Eme(s),ov.symlinkSync(r,e,t)}RJ.exports={createSymlink:Cme(Tme),createSymlinkSync:Rme}});var MJ=M((YAe,NJ)=>{"use strict";var Yk=hJ(),Xk=IJ(),Zk=AJ();NJ.exports={createFile:Yk.createFile,createFileSync:Yk.createFileSync,ensureFile:Yk.createFile,ensureFileSync:Yk.createFileSync,createLink:Xk.createLink,createLinkSync:Xk.createLinkSync,ensureLink:Xk.createLink,ensureLinkSync:Xk.createLinkSync,createSymlink:Zk.createSymlink,createSymlinkSync:Zk.createSymlinkSync,ensureSymlink:Zk.createSymlink,ensureSymlinkSync:Zk.createSymlinkSync}});var LJ=M((XAe,FJ)=>{"use strict";var Ame=ko().fromCallback,Um=Ln(),OJ=require("path"),KJ=ts(),Nme=Zl().pathExists;function Mme(r,e,t,n){typeof t=="function"&&(n=t,t="utf8");let i=OJ.dirname(r);Nme(i,(o,s)=>{if(o)return n(o);if(s)return Um.writeFile(r,e,t,n);KJ.mkdirs(i,a=>{if(a)return n(a);Um.writeFile(r,e,t,n)})})}function Ome(r,e,t){let n=OJ.dirname(r);if(Um.existsSync(n))return Um.writeFileSync.apply(Um,arguments);KJ.mkdirsSync(n),Um.writeFileSync.apply(Um,arguments)}FJ.exports={outputFile:Ame(Mme),outputFileSync:Ome}});var Gc=M((ZAe,UJ)=>{"use strict";var Js=W6(),rs={};Js(rs,EO());Js(rs,hq());Js(rs,FO());Js(rs,ts());Js(rs,Hx());Js(rs,zq());Js(rs,Zq());Js(rs,nJ());Js(rs,pJ());Js(rs,MJ());Js(rs,LJ());Js(rs,Zl());UJ.exports=rs});var mD=M((cKe,eK)=>{"use strict";function Hme(r){var e=void 0;typeof r=="string"?e=[r]:e=r.raw;for(var t="",n=0;n<e.length;n++)t+=e[n].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),n<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=n+1?void 0:arguments[n+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var c=a[1].length;o?o=Math.min(o,c):o=c}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof eK<"u"&&(eK.exports=Hme)});var i7=M((s2e,n7)=>{n7.exports=function(r,e){for(var t=[],n=0;n<r.length;n++){var i=e(r[n],n);sfe(i)?t.push.apply(t,i):t.push(i)}return t};var sfe=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"}});var l7=M((a2e,c7)=>{"use strict";c7.exports=s7;function s7(r,e,t){r instanceof RegExp&&(r=o7(r,t)),e instanceof RegExp&&(e=o7(e,t));var n=a7(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function o7(r,e){var t=e.match(r);return t?t[0]:null}s7.range=a7;function a7(r,e,t){var n,i,o,s,a,c=t.indexOf(r),l=t.indexOf(e,c+1),u=c;if(c>=0&&l>0){if(r===e)return[c,l];for(n=[],o=t.length;u>=0&&!a;)u==c?(n.push(u),c=t.indexOf(r,u+1)):n.length==1?a=[n.pop(),l]:(i=n.pop(),i<o&&(o=i,s=l),l=t.indexOf(e,u+1)),u=c<l&&c>=0?c:l;n.length&&(a=[o,s])}return a}});var v7=M((c2e,g7)=>{var afe=i7(),u7=l7();g7.exports=ufe;var p7="\0SLASH"+Math.random()+"\0",d7="\0OPEN"+Math.random()+"\0",yK="\0CLOSE"+Math.random()+"\0",m7="\0COMMA"+Math.random()+"\0",f7="\0PERIOD"+Math.random()+"\0";function vK(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function cfe(r){return r.split("\\\\").join(p7).split("\\{").join(d7).split("\\}").join(yK).split("\\,").join(m7).split("\\.").join(f7)}function lfe(r){return r.split(p7).join("\\").split(d7).join("{").split(yK).join("}").split(m7).join(",").split(f7).join(".")}function h7(r){if(!r)return[""];var e=[],t=u7("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,o=t.post,s=n.split(",");s[s.length-1]+="{"+i+"}";var a=h7(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function ufe(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Nv(cfe(r),!0).map(lfe)):[]}function pfe(r){return"{"+r+"}"}function dfe(r){return/^-?0\d/.test(r)}function mfe(r,e){return r<=e}function ffe(r,e){return r>=e}function Nv(r,e){var t=[],n=u7("{","}",r);if(!n||/\$$/.test(n.pre))return[r];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),s=i||o,a=n.body.indexOf(",")>=0;if(!s&&!a)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+yK+n.post,Nv(r)):[r];var c;if(s)c=n.body.split(/\.\./);else if(c=h7(n.body),c.length===1&&(c=Nv(c[0],!1).map(pfe),c.length===1)){var u=n.post.length?Nv(n.post,!1):[""];return u.map(function(Le){return n.pre+c[0]+Le})}var l=n.pre,u=n.post.length?Nv(n.post,!1):[""],p;if(s){var m=vK(c[0]),h=vK(c[1]),g=Math.max(c[0].length,c[1].length),y=c.length==3?Math.abs(vK(c[2])):1,x=mfe,E=h<m;E&&(y*=-1,x=ffe);var A=c.some(dfe);p=[];for(var T=m;x(T,h);T+=y){var j;if(o)j=String.fromCharCode(T),j==="\\"&&(j="");else if(j=String(T),A){var oe=g-j.length;if(oe>0){var G=new Array(oe+1).join("0");T<0?j="-"+G+j.slice(1):j=G+j}}p.push(j)}}else p=afe(c,function(Ce){return Nv(Ce,!1)});for(var ue=0;ue<p.length;ue++)for(var pe=0;pe<u.length;pe++){var te=l+p[ue]+u[pe];(!e||s||te)&&t.push(te)}return t}});var aC=M((l2e,x7)=>{x7.exports=is;is.Minimatch=vi;var sC=function(){try{return require("path")}catch{}}()||{sep:"/"};is.sep=sC.sep;var SK=is.GLOBSTAR=vi.GLOBSTAR={},hfe=v7(),y7={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},bK="[^/]",IK=bK+"*?",gfe="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",vfe="(?:(?!(?:\\/|^)\\.).)*?",b7=yfe("().*{}+?[]^$\\!");function yfe(r){return r.split("").reduce(function(e,t){return e[t]=!0,e},{})}var I7=/\/+/;is.filter=bfe;function bfe(r,e){return e=e||{},function(t,n,i){return is(t,r,e)}}function zp(r,e){e=e||{};var t={};return Object.keys(r).forEach(function(n){t[n]=r[n]}),Object.keys(e).forEach(function(n){t[n]=e[n]}),t}is.defaults=function(r){if(!r||typeof r!="object"||!Object.keys(r).length)return is;var e=is,t=function(i,o,s){return e(i,o,zp(r,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,zp(r,o))},t.Minimatch.defaults=function(i){return e.defaults(zp(r,i)).Minimatch},t.filter=function(i,o){return e.filter(i,zp(r,o))},t.defaults=function(i){return e.defaults(zp(r,i))},t.makeRe=function(i,o){return e.makeRe(i,zp(r,o))},t.braceExpand=function(i,o){return e.braceExpand(i,zp(r,o))},t.match=function(n,i,o){return e.match(n,i,zp(r,o))},t};vi.defaults=function(r){return is.defaults(r).Minimatch};function is(r,e,t){return UD(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new vi(e,t).match(r)}function vi(r,e){if(!(this instanceof vi))return new vi(r,e);UD(r),e||(e={}),r=r.trim(),!e.allowWindowsEscape&&sC.sep!=="/"&&(r=r.split(sC.sep).join("/")),this.options=e,this.set=[],this.pattern=r,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}vi.prototype.debug=function(){};vi.prototype.make=Ife;function Ife(){var r=this.pattern,e=this.options;if(!e.nocomment&&r.charAt(0)==="#"){this.comment=!0;return}if(!r){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(n){return n.split(I7)}),this.debug(this.pattern,t),t=t.map(function(n,i,o){return n.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}vi.prototype.parseNegate=Sfe;function Sfe(){var r=this.pattern,e=!1,t=this.options,n=0;if(!t.nonegate){for(var i=0,o=r.length;i<o&&r.charAt(i)==="!";i++)e=!e,n++;n&&(this.pattern=r.substr(n)),this.negate=e}}is.braceExpand=function(r,e){return S7(r,e)};vi.prototype.braceExpand=S7;function S7(r,e){return e||(this instanceof vi?e=this.options:e={}),r=typeof r>"u"?this.pattern:r,UD(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:hfe(r)}var xfe=1024*64,UD=function(r){if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>xfe)throw new TypeError("pattern is too long")};vi.prototype.parse=Cfe;var LD={};function Cfe(r,e){UD(r);var t=this.options;if(r==="**")if(t.noglobstar)r="*";else return SK;if(r==="")return"";var n="",i=!!t.nocase,o=!1,s=[],a=[],c,l=!1,u=-1,p=-1,m=r.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",h=this;function g(){if(c){switch(c){case"*":n+=IK,i=!0;break;case"?":n+=bK,i=!0;break;default:n+="\\"+c;break}h.debug("clearStateChar %j %j",c,n),c=!1}}for(var y=0,x=r.length,E;y<x&&(E=r.charAt(y));y++){if(this.debug("%s	%s %s %j",r,y,n,E),o&&b7[E]){n+="\\"+E,o=!1;continue}switch(E){case"/":return!1;case"\\":g(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",r,y,n,E),l){this.debug("  in class"),E==="!"&&y===p+1&&(E="^"),n+=E;continue}h.debug("call clearStateChar %j",c),g(),c=E,t.noext&&g();continue;case"(":if(l){n+="(";continue}if(!c){n+="\\(";continue}s.push({type:c,start:y-1,reStart:n.length,open:y7[c].open,close:y7[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(l||!s.length){n+="\\)";continue}g(),i=!0;var A=s.pop();n+=A.close,A.type==="!"&&a.push(A),A.reEnd=n.length;continue;case"|":if(l||!s.length||o){n+="\\|",o=!1;continue}g(),n+="|";continue;case"[":if(g(),l){n+="\\"+E;continue}l=!0,p=y,u=n.length,n+=E;continue;case"]":if(y===p+1||!l){n+="\\"+E,o=!1;continue}var T=r.substring(p+1,y);try{RegExp("["+T+"]")}catch{var j=this.parse(T,LD);n=n.substr(0,u)+"\\["+j[0]+"\\]",i=i||j[1],l=!1;continue}i=!0,l=!1,n+=E;continue;default:g(),o?o=!1:b7[E]&&!(E==="^"&&l)&&(n+="\\"),n+=E}}for(l&&(T=r.substr(p+1),j=this.parse(T,LD),n=n.substr(0,u)+"\\["+j[0],i=i||j[1]),A=s.pop();A;A=s.pop()){var oe=n.slice(A.reStart+A.open.length);this.debug("setting tail",n,A),oe=oe.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(hn,Pt,Hr){return Hr||(Hr="\\"),Pt+Pt+Hr+"|"}),this.debug(`tail=%j
   %s`,oe,oe,A,n);var G=A.type==="*"?IK:A.type==="?"?bK:"\\"+A.type;i=!0,n=n.slice(0,A.reStart)+G+"\\("+oe}g(),o&&(n+="\\\\");var ue=!1;switch(n.charAt(0)){case"[":case".":case"(":ue=!0}for(var pe=a.length-1;pe>-1;pe--){var te=a[pe],Ce=n.slice(0,te.reStart),Le=n.slice(te.reStart,te.reEnd-8),ct=n.slice(te.reEnd-8,te.reEnd),ft=n.slice(te.reEnd);ct+=ft;var rt=Ce.split("(").length-1,ae=ft;for(y=0;y<rt;y++)ae=ae.replace(/\)[+*?]?/,"");ft=ae;var ke="";ft===""&&e!==LD&&(ke="$");var X=Ce+Le+ft+ke+ct;n=X}if(n!==""&&i&&(n="(?=.)"+n),ue&&(n=m+n),e===LD)return[n,i];if(!i)return Efe(r);var ye=t.nocase?"i":"";try{var qe=new RegExp("^"+n+"$",ye)}catch{return new RegExp("$.")}return qe._glob=r,qe._src=n,qe}is.makeRe=function(r,e){return new vi(r,e||{}).makeRe()};vi.prototype.makeRe=wfe;function wfe(){if(this.regexp||this.regexp===!1)return this.regexp;var r=this.set;if(!r.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?IK:e.dot?gfe:vfe,n=e.nocase?"i":"",i=r.map(function(o){return o.map(function(s){return s===SK?t:typeof s=="string"?Pfe(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch{this.regexp=!1}return this.regexp}is.match=function(r,e,t){t=t||{};var n=new vi(e,t);return r=r.filter(function(i){return n.match(i)}),n.options.nonull&&!r.length&&r.push(e),r};vi.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var n=this.options;sC.sep!=="/"&&(e=e.split(sC.sep).join("/")),e=e.split(I7),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],c=e;n.matchBase&&a.length===1&&(c=[o]);var l=this.matchOne(c,a,t);if(l)return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate};vi.prototype.matchOne=function(r,e,t){var n=this.options;this.debug("matchOne",{this:this,file:r,pattern:e}),this.debug("matchOne",r.length,e.length);for(var i=0,o=0,s=r.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var c=e[o],l=r[i];if(this.debug(e,c,l),c===!1)return!1;if(c===SK){this.debug("GLOBSTAR",[e,c,l]);var u=i,p=o+1;if(p===a){for(this.debug("** at the end");i<s;i++)if(r[i]==="."||r[i]===".."||!n.dot&&r[i].charAt(0)===".")return!1;return!0}for(;u<s;){var m=r[u];if(this.debug(`
globstar while`,r,u,e,p,m),this.matchOne(r.slice(u),e.slice(p),t))return this.debug("globstar found match!",u,s,m),!0;if(m==="."||m===".."||!n.dot&&m.charAt(0)==="."){this.debug("dot detected!",r,u,e,p);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,r,u,e,p),u===s))}var h;if(typeof c=="string"?(h=l===c,this.debug("string match",c,l,h)):(h=l.match(c),this.debug("pattern match",c,l,h)),!h)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&r[i]==="";throw new Error("wtf?")};function Efe(r){return r.replace(/\\(.)/g,"$1")}function Pfe(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var T7=M(EK=>{var $m=require("path"),Yp=process.platform==="win32",Qp=require("fs"),Tfe=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Rfe(){var r;if(Tfe){var e=new Error;r=t}else r=n;return r;function t(i){i&&(e.message=i.message,i=e,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function Afe(r){return typeof r=="function"?r:Rfe()}var ZWe=$m.normalize;Yp?su=/(.*?)(?:[\/\\]+|$)/g:su=/(.*?)(?:[\/]+|$)/g;var su;Yp?pC=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:pC=/^[\/]*/;var pC;EK.realpathSync=function(e,t){if(e=$m.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var n=e,i={},o={},s,a,c,l;u();function u(){var x=pC.exec(e);s=x[0].length,a=x[0],c=x[0],l="",Yp&&!o[c]&&(Qp.lstatSync(c),o[c]=!0)}for(;s<e.length;){su.lastIndex=s;var p=su.exec(e);if(l=a,a+=p[0],c=l+p[1],s=su.lastIndex,!(o[c]||t&&t[c]===c)){var m;if(t&&Object.prototype.hasOwnProperty.call(t,c))m=t[c];else{var h=Qp.lstatSync(c);if(!h.isSymbolicLink()){o[c]=!0,t&&(t[c]=c);continue}var g=null;if(!Yp){var y=h.dev.toString(32)+":"+h.ino.toString(32);i.hasOwnProperty(y)&&(g=i[y])}g===null&&(Qp.statSync(c),g=Qp.readlinkSync(c)),m=$m.resolve(l,g),t&&(t[c]=m),Yp||(i[y]=g)}e=$m.resolve(m,e.slice(s)),u()}}return t&&(t[n]=e),e};EK.realpath=function(e,t,n){if(typeof n!="function"&&(n=Afe(t),t=null),e=$m.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(n.bind(null,null,t[e]));var i=e,o={},s={},a,c,l,u;p();function p(){var x=pC.exec(e);a=x[0].length,c=x[0],l=x[0],u="",Yp&&!s[l]?Qp.lstat(l,function(E){if(E)return n(E);s[l]=!0,m()}):process.nextTick(m)}function m(){if(a>=e.length)return t&&(t[i]=e),n(null,e);su.lastIndex=a;var x=su.exec(e);return u=c,c+=x[0],l=u+x[1],a=su.lastIndex,s[l]||t&&t[l]===l?process.nextTick(m):t&&Object.prototype.hasOwnProperty.call(t,l)?y(t[l]):Qp.lstat(l,h)}function h(x,E){if(x)return n(x);if(!E.isSymbolicLink())return s[l]=!0,t&&(t[l]=l),process.nextTick(m);if(!Yp){var A=E.dev.toString(32)+":"+E.ino.toString(32);if(o.hasOwnProperty(A))return g(null,o[A],l)}Qp.stat(l,function(T){if(T)return n(T);Qp.readlink(l,function(j,oe){Yp||(o[A]=oe),g(j,oe)})})}function g(x,E,A){if(x)return n(x);var T=$m.resolve(u,E);t&&(t[A]=T),y(T)}function y(x){e=$m.resolve(x,e.slice(a)),p()}}});var _K=M((tVe,M7)=>{M7.exports=Xp;Xp.realpath=Xp;Xp.sync=DK;Xp.realpathSync=DK;Xp.monkeypatch=Mfe;Xp.unmonkeypatch=Ofe;var Jv=require("fs"),PK=Jv.realpath,kK=Jv.realpathSync,Nfe=process.version,R7=/^v[0-5]\./.test(Nfe),A7=T7();function N7(r){return r&&r.syscall==="realpath"&&(r.code==="ELOOP"||r.code==="ENOMEM"||r.code==="ENAMETOOLONG")}function Xp(r,e,t){if(R7)return PK(r,e,t);typeof e=="function"&&(t=e,e=null),PK(r,e,function(n,i){N7(n)?A7.realpath(r,e,t):t(n,i)})}function DK(r,e){if(R7)return kK(r,e);try{return kK(r,e)}catch(t){if(N7(t))return A7.realpathSync(r,e);throw t}}function Mfe(){Jv.realpath=Xp,Jv.realpathSync=DK}function Ofe(){Jv.realpath=PK,Jv.realpathSync=kK}});var O7=M((rVe,TK)=>{typeof Object.create=="function"?TK.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:TK.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}});var K7=M((nVe,AK)=>{try{if(RK=require("util"),typeof RK.inherits!="function")throw"";AK.exports=RK.inherits}catch{AK.exports=O7()}var RK});var VD=M((iVe,WD)=>{"use strict";function F7(r){return r.charAt(0)==="/"}function L7(r){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(r),n=t[1]||"",i=!!(n&&n.charAt(1)!==":");return!!(t[2]||i)}WD.exports=process.platform==="win32"?L7:F7;WD.exports.posix=F7;WD.exports.win32=L7});var MK=M(Zp=>{Zp.setopts=Wfe;Zp.ownProp=U7;Zp.makeAbs=dC;Zp.finish=Vfe;Zp.mark=Bfe;Zp.isIgnored=W7;Zp.childrenIgnored=qfe;function U7(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var Kfe=require("fs"),$v=require("path"),Ffe=aC(),j7=VD(),NK=Ffe.Minimatch;function Lfe(r,e){return r.localeCompare(e,"en")}function Ufe(r,e){r.ignore=e.ignore||[],Array.isArray(r.ignore)||(r.ignore=[r.ignore]),r.ignore.length&&(r.ignore=r.ignore.map(jfe))}function jfe(r){var e=null;if(r.slice(-3)==="/**"){var t=r.replace(/(\/\*\*)+$/,"");e=new NK(t,{dot:!0})}return{matcher:new NK(r,{dot:!0}),gmatcher:e}}function Wfe(r,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}r.silent=!!t.silent,r.pattern=e,r.strict=t.strict!==!1,r.realpath=!!t.realpath,r.realpathCache=t.realpathCache||Object.create(null),r.follow=!!t.follow,r.dot=!!t.dot,r.mark=!!t.mark,r.nodir=!!t.nodir,r.nodir&&(r.mark=!0),r.sync=!!t.sync,r.nounique=!!t.nounique,r.nonull=!!t.nonull,r.nosort=!!t.nosort,r.nocase=!!t.nocase,r.stat=!!t.stat,r.noprocess=!!t.noprocess,r.absolute=!!t.absolute,r.fs=t.fs||Kfe,r.maxLength=t.maxLength||1/0,r.cache=t.cache||Object.create(null),r.statCache=t.statCache||Object.create(null),r.symlinks=t.symlinks||Object.create(null),Ufe(r,t),r.changedCwd=!1;var n=process.cwd();U7(t,"cwd")?(r.cwd=$v.resolve(t.cwd),r.changedCwd=r.cwd!==n):r.cwd=n,r.root=t.root||$v.resolve(r.cwd,"/"),r.root=$v.resolve(r.root),process.platform==="win32"&&(r.root=r.root.replace(/\\/g,"/")),r.cwdAbs=j7(r.cwd)?r.cwd:dC(r,r.cwd),process.platform==="win32"&&(r.cwdAbs=r.cwdAbs.replace(/\\/g,"/")),r.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,r.minimatch=new NK(e,t),r.options=r.minimatch.options}function Vfe(r){for(var e=r.nounique,t=e?[]:Object.create(null),n=0,i=r.matches.length;n<i;n++){var o=r.matches[n];if(!o||Object.keys(o).length===0){if(r.nonull){var s=r.minimatch.globSet[n];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(c){t[c]=!0})}}if(e||(t=Object.keys(t)),r.nosort||(t=t.sort(Lfe)),r.mark){for(var n=0;n<t.length;n++)t[n]=r._mark(t[n]);r.nodir&&(t=t.filter(function(c){var l=!/\/$/.test(c),u=r.cache[c]||r.cache[dC(r,c)];return l&&u&&(l=u!=="DIR"&&!Array.isArray(u)),l}))}r.ignore.length&&(t=t.filter(function(c){return!W7(r,c)})),r.found=t}function Bfe(r,e){var t=dC(r,e),n=r.cache[t],i=e;if(n){var o=n==="DIR"||Array.isArray(n),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=dC(r,i);r.statCache[a]=r.statCache[t],r.cache[a]=r.cache[t]}}return i}function dC(r,e){var t=e;return e.charAt(0)==="/"?t=$v.join(r.root,e):j7(e)||e===""?t=e:r.changedCwd?t=$v.resolve(r.cwd,e):t=$v.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function W7(r,e){return r.ignore.length?r.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function qfe(r,e){return r.ignore.length?r.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var $7=M((lVe,J7)=>{J7.exports=q7;q7.GlobSync=$n;var Jfe=_K(),V7=aC(),sVe=V7.Minimatch,aVe=FK().Glob,cVe=require("util"),OK=require("path"),B7=require("assert"),BD=VD(),Hm=MK(),$fe=Hm.setopts,KK=Hm.ownProp,Hfe=Hm.childrenIgnored,Gfe=Hm.isIgnored;function q7(r,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new $n(r,e).found}function $n(r,e){if(!r)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof $n))return new $n(r,e);if($fe(this,r,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var n=0;n<t;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}$n.prototype._finish=function(){if(B7(this instanceof $n),this.realpath){var r=this;this.matches.forEach(function(e,t){var n=r.matches[t]=Object.create(null);for(var i in e)try{i=r._makeAbs(i);var o=Jfe.realpathSync(i,r.realpathCache);n[o]=!0}catch(s){if(s.syscall==="stat")n[r._makeAbs(i)]=!0;else throw s}})}Hm.finish(this)};$n.prototype._process=function(r,e,t){B7(this instanceof $n);for(var n=0;typeof r[n]=="string";)n++;var i;switch(n){case r.length:this._processSimple(r.join("/"),e);return;case 0:i=null;break;default:i=r.slice(0,n).join("/");break}var o=r.slice(n),s;i===null?s=".":((BD(i)||BD(r.join("/")))&&(!i||!BD(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!Hfe(this,s)){var c=o[0]===V7.GLOBSTAR;c?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};$n.prototype._processReaddir=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){for(var a=n[0],c=!!this.minimatch.negate,l=a._glob,u=this.dot||l.charAt(0)===".",p=[],m=0;m<s.length;m++){var h=s[m];if(h.charAt(0)!=="."||u){var g;c&&!r?g=!h.match(a):g=h.match(a),g&&p.push(h)}}var y=p.length;if(y!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var m=0;m<y;m++){var h=p[m];r&&(r.slice(-1)!=="/"?h=r+"/"+h:h=r+h),h.charAt(0)==="/"&&!this.nomount&&(h=OK.join(this.root,h)),this._emitMatch(i,h)}return}n.shift();for(var m=0;m<y;m++){var h=p[m],x;r?x=[r,h]:x=[h],this._process(x.concat(n),i,o)}}}};$n.prototype._emitMatch=function(r,e){if(!Gfe(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0,this.stat&&this._stat(e)}}};$n.prototype._readdirInGlobStar=function(r){if(this.follow)return this._readdir(r,!1);var e,t,n;try{t=this.fs.lstatSync(r)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[r]=i,!i&&t&&!t.isDirectory()?this.cache[r]="FILE":e=this._readdir(r,!1),e};$n.prototype._readdir=function(r,e){var t;if(e&&!KK(this.symlinks,r))return this._readdirInGlobStar(r);if(KK(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(r,this.fs.readdirSync(r))}catch(i){return this._readdirError(r,i),null}};$n.prototype._readdirEntries=function(r,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var n=e[t];r==="/"?n=r+n:n=r+"/"+n,this.cache[n]=!0}return this.cache[r]=e,e};$n.prototype._readdirError=function(r,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(r);if(this.cache[t]="FILE",t===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=e.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:if(this.cache[this._makeAbs(r)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};$n.prototype._processGlobStar=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){var a=n.slice(1),c=r?[r]:[],l=c.concat(a);this._process(l,i,!1);var u=s.length,p=this.symlinks[t];if(!(p&&o))for(var m=0;m<u;m++){var h=s[m];if(!(h.charAt(0)==="."&&!this.dot)){var g=c.concat(s[m],a);this._process(g,i,!0);var y=c.concat(s[m],n);this._process(y,i,!0)}}}};$n.prototype._processSimple=function(r,e){var t=this._stat(r);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(r&&BD(r)&&!this.nomount){var n=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=OK.join(this.root,r):(r=OK.resolve(this.root,r),n&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r)}};$n.prototype._stat=function(r){var e=this._makeAbs(r),t=r.slice(-1)==="/";if(r.length>this.maxLength)return!1;if(!this.stat&&KK(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var n,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};$n.prototype._mark=function(r){return Hm.mark(this,r)};$n.prototype._makeAbs=function(r){return Hm.makeAbs(this,r)}});var LK=M((uVe,G7)=>{G7.exports=H7;function H7(r,e){if(r&&e)return H7(r)(e);if(typeof r!="function")throw new TypeError("need wrapper function");return Object.keys(r).forEach(function(n){t[n]=r[n]}),t;function t(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=r.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var jK=M((pVe,UK)=>{var z7=LK();UK.exports=z7(qD);UK.exports.strict=z7(Q7);qD.proto=qD(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return qD(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return Q7(this)},configurable:!0})});function qD(r){var e=function(){return e.called?e.value:(e.called=!0,e.value=r.apply(this,arguments))};return e.called=!1,e}function Q7(r){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=r.apply(this,arguments)},t=r.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var X7=M((dVe,Y7)=>{var zfe=LK(),mC=Object.create(null),Qfe=jK();Y7.exports=zfe(Yfe);function Yfe(r,e){return mC[r]?(mC[r].push(e),null):(mC[r]=[e],Xfe(r))}function Xfe(r){return Qfe(function e(){var t=mC[r],n=t.length,i=Zfe(arguments);try{for(var o=0;o<n;o++)t[o].apply(null,i)}finally{t.length>n?(t.splice(0,n),process.nextTick(function(){e.apply(null,i)})):delete mC[r]}})}function Zfe(r){for(var e=r.length,t=[],n=0;n<e;n++)t[n]=r[n];return t}});var FK=M((hVe,e$)=>{e$.exports=Gm;var ehe=_K(),Z7=aC(),mVe=Z7.Minimatch,the=K7(),rhe=require("events").EventEmitter,WK=require("path"),VK=require("assert"),fC=VD(),qK=$7(),zm=MK(),nhe=zm.setopts,BK=zm.ownProp,JK=X7(),fVe=require("util"),ihe=zm.childrenIgnored,ohe=zm.isIgnored,she=jK();function Gm(r,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return qK(r,e)}return new vr(r,e,t)}Gm.sync=qK;var ahe=Gm.GlobSync=qK.GlobSync;Gm.glob=Gm;function che(r,e){if(e===null||typeof e!="object")return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r}Gm.hasMagic=function(r,e){var t=che({},e);t.noprocess=!0;var n=new vr(r,t),i=n.minimatch.set;if(!r)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Gm.Glob=vr;the(vr,rhe);function vr(r,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new ahe(r,e)}if(!(this instanceof vr))return new vr(r,e,t);nhe(this,r,e),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof t=="function"&&(t=she(t),this.on("error",t),this.on("end",function(c){t(null,c)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var o=!0,s=0;s<n;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}vr.prototype._finish=function(){if(VK(this instanceof vr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();zm.finish(this),this.emit("end",this.found)}};vr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var r=this.matches.length;if(r===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,n);function n(){--r===0&&e._finish()}};vr.prototype._realpathSet=function(r,e){var t=this.matches[r];if(!t)return e();var n=Object.keys(t),i=this,o=n.length;if(o===0)return e();var s=this.matches[r]=Object.create(null);n.forEach(function(a,c){a=i._makeAbs(a),ehe.realpath(a,i.realpathCache,function(l,u){l?l.syscall==="stat"?s[a]=!0:i.emit("error",l):s[u]=!0,--o===0&&(i.matches[r]=s,e())})})};vr.prototype._mark=function(r){return zm.mark(this,r)};vr.prototype._makeAbs=function(r){return zm.makeAbs(this,r)};vr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};vr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};vr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var r=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<r.length;e++){var t=r[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<n.length;e++){var i=n[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};vr.prototype._process=function(r,e,t,n){if(VK(this instanceof vr),VK(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([r,e,t,n]);return}for(var i=0;typeof r[i]=="string";)i++;var o;switch(i){case r.length:this._processSimple(r.join("/"),e,n);return;case 0:o=null;break;default:o=r.slice(0,i).join("/");break}var s=r.slice(i),a;o===null?a=".":((fC(o)||fC(r.join("/")))&&(!o||!fC(o))&&(o="/"+o),a=o);var c=this._makeAbs(a);if(ihe(this,a))return n();var l=s[0]===Z7.GLOBSTAR;l?this._processGlobStar(o,a,c,s,e,t,n):this._processReaddir(o,a,c,s,e,t,n)}};vr.prototype._processReaddir=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){return a._processReaddir2(r,e,t,n,i,o,l,s)})};vr.prototype._processReaddir2=function(r,e,t,n,i,o,s,a){if(!s)return a();for(var c=n[0],l=!!this.minimatch.negate,u=c._glob,p=this.dot||u.charAt(0)===".",m=[],h=0;h<s.length;h++){var g=s[h];if(g.charAt(0)!=="."||p){var y;l&&!r?y=!g.match(c):y=g.match(c),y&&m.push(g)}}var x=m.length;if(x===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var h=0;h<x;h++){var g=m[h];r&&(r!=="/"?g=r+"/"+g:g=r+g),g.charAt(0)==="/"&&!this.nomount&&(g=WK.join(this.root,g)),this._emitMatch(i,g)}return a()}n.shift();for(var h=0;h<x;h++){var g=m[h],E;r&&(r!=="/"?g=r+"/"+g:g=r+g),this._process([g].concat(n),i,o,a)}a()};vr.prototype._emitMatch=function(r,e){if(!this.aborted&&!ohe(this,e)){if(this.paused){this._emitQueue.push([r,e]);return}var t=fC(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};vr.prototype._readdirInGlobStar=function(r,e){if(this.aborted)return;if(this.follow)return this._readdir(r,!1,e);var t="lstat\0"+r,n=this,i=JK(t,o);i&&n.fs.lstat(r,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var c=a&&a.isSymbolicLink();n.symlinks[r]=c,!c&&a&&!a.isDirectory()?(n.cache[r]="FILE",e()):n._readdir(r,!1,e)}};vr.prototype._readdir=function(r,e,t){if(!this.aborted&&(t=JK("readdir\0"+r+"\0"+e,t),!!t)){if(e&&!BK(this.symlinks,r))return this._readdirInGlobStar(r,t);if(BK(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return t();if(Array.isArray(n))return t(null,n)}var i=this;i.fs.readdir(r,lhe(this,r,t))}};function lhe(r,e,t){return function(n,i){n?r._readdirError(e,n,t):r._readdirEntries(e,i,t)}}vr.prototype._readdirEntries=function(r,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var i=e[n];r==="/"?i=r+i:i=r+"/"+i,this.cache[i]=!0}return this.cache[r]=e,t(null,e)}};vr.prototype._readdirError=function(r,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(r);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:this.cache[this._makeAbs(r)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};vr.prototype._processGlobStar=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){a._processGlobStar2(r,e,t,n,i,o,l,s)})};vr.prototype._processGlobStar2=function(r,e,t,n,i,o,s,a){if(!s)return a();var c=n.slice(1),l=r?[r]:[],u=l.concat(c);this._process(u,i,!1,a);var p=this.symlinks[t],m=s.length;if(p&&o)return a();for(var h=0;h<m;h++){var g=s[h];if(!(g.charAt(0)==="."&&!this.dot)){var y=l.concat(s[h],c);this._process(y,i,!0,a);var x=l.concat(s[h],n);this._process(x,i,!0,a)}}a()};vr.prototype._processSimple=function(r,e,t){var n=this;this._stat(r,function(i,o){n._processSimple2(r,e,i,o,t)})};vr.prototype._processSimple2=function(r,e,t,n,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!n)return i();if(r&&fC(r)&&!this.nomount){var o=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=WK.join(this.root,r):(r=WK.resolve(this.root,r),o&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r),i()};vr.prototype._stat=function(r,e){var t=this._makeAbs(r),n=r.slice(-1)==="/";if(r.length>this.maxLength)return e();if(!this.stat&&BK(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return e(null,i);if(n&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?e():e(null,a,s)}var c=this,l=JK("stat\0"+t,u);l&&c.fs.lstat(t,l);function u(p,m){if(m&&m.isSymbolicLink())return c.fs.stat(t,function(h,g){h?c._stat2(r,t,null,m,e):c._stat2(r,t,h,g,e)});c._stat2(r,t,p,m,e)}};vr.prototype._stat2=function(r,e,t,n,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=r.slice(-1)==="/";if(this.statCache[e]=n,e.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var s=!0;return n&&(s=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,n)}});var n$=M((gVe,r$)=>{"use strict";var t$=process.platform==="win32",uhe=t$?/[^:]\\$/:/.\/$/;r$.exports=function(){var r;return t$?r=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":r=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",uhe.test(r)&&(r=r.slice(0,-1)),r}});var v$=M((vVe,au)=>{var Ro=require("fs"),$K=require("path"),i$=require("crypto"),phe=n$(),hC=require("constants"),HK=phe(),o$="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",GK=/XXXXXX/,a$=3,c$=hC.O_CREAT|hC.O_EXCL|hC.O_RDWR,l$=448,u$=384,Hv=[],p$=!1,zK=!1;function s$(r){var e=[],t=null;try{t=i$.randomBytes(r)}catch{t=i$.pseudoRandomBytes(r)}for(var n=0;n<r;n++)e.push(o$[t[n]%o$.length]);return e.join("")}function dhe(r){return typeof r>"u"}function Gv(r,e){if(typeof r=="function"){var t=r;r=e||{},e=t}else typeof r>"u"&&(r={});return[r,e]}function d$(r){if(r.name)return $K.join(r.dir||HK,r.name);if(r.template)return r.template.replace(GK,s$(6));var e=[r.prefix||"tmp-",process.pid,s$(12),r.postfix||""].join("");return $K.join(r.dir||HK,e)}function QK(r,e){var t=Gv(r,e),n=t[0],i=t[1],o=n.tries||a$;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(GK))return i(new Error("Invalid template provided"));(function s(){var a=d$(n);Ro.stat(a,function(c){if(!c)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function YK(r){var e=Gv(r),t=e[0],n=t.tries||a$;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(GK))throw new Error("Invalid template provided");do{var i=d$(t);try{Ro.statSync(i)}catch{return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function mhe(r,e){var t=Gv(r,e),n=t[0],i=t[1];n.postfix=dhe(n.postfix)?".tmp":n.postfix,QK(n,function(s,a){if(s)return i(s);Ro.open(a,c$,n.mode||u$,function(l,u){if(l)return i(l);i(null,a,u,m$(a,u,n))})})}function fhe(r){var e=Gv(r),t=e[0];t.postfix=t.postfix||".tmp";var n=YK(t),i=Ro.openSync(n,c$,t.mode||u$);return{name:n,fd:i,removeCallback:m$(n,i,t)}}function hhe(r){var e=[r];do{for(var t=e.pop(),n=!1,i=Ro.readdirSync(t),o=0,s=i.length;o<s;o++){var a=$K.join(t,i[o]),c=Ro.lstatSync(a);c.isDirectory()?(n||(n=!0,e.push(t)),e.push(a)):Ro.unlinkSync(a)}n||Ro.rmdirSync(t)}while(e.length!==0)}function ghe(r,e){var t=Gv(r,e),n=t[0],i=t[1];QK(n,function(s,a){if(s)return i(s);Ro.mkdir(a,n.mode||l$,function(l){if(l)return i(l);i(null,a,f$(a,n))})})}function vhe(r){var e=Gv(r),t=e[0],n=YK(t);return Ro.mkdirSync(n,t.mode||l$),{name:n,removeCallback:f$(n,t)}}function m$(r,e,t){var n=h$(function(o){try{Ro.closeSync(o[0])}catch(s){if(s.errno!=-hC.EBADF&&s.errno!=-hC.ENOENT)throw s}Ro.unlinkSync(o[1])},[e,r]);return t.keep||Hv.unshift(n),n}function f$(r,e){var t=e.unsafeCleanup?hhe:Ro.rmdirSync.bind(Ro),n=h$(t,r);return e.keep||Hv.unshift(n),n}function h$(r,e){var t=!1;return function n(){if(!t){var i=Hv.indexOf(n);i>=0&&Hv.splice(i,1),t=!0,r(e)}}}function g$(){if(!(zK&&!p$))for(var r=0,e=Hv.length;r<e;r++)try{Hv[r].call(null)}catch{}}function yhe(){p$=!0}var JD=process.versions.node.split(".").map(function(r){return parseInt(r,10)});JD[0]===0&&(JD[1]<9||JD[1]===9&&JD[2]<5)&&process.addListener("uncaughtException",function(e){throw zK=!0,g$(),e});process.addListener("exit",function(e){e&&(zK=!0),g$()});au.exports.tmpdir=HK;au.exports.dir=ghe;au.exports.dirSync=vhe;au.exports.file=mhe;au.exports.fileSync=fhe;au.exports.tmpName=QK;au.exports.tmpNameSync=YK;au.exports.setGracefulCleanup=yhe});var b$=M((Qm,y$)=>{var gC=require("node-fetch"),bhe=gC.default||gC,$D=function(r,e){return/^\/\//.test(r)&&(r="https:"+r),bhe.call(this,r,e)};$D.ponyfill=!0;y$.exports=Qm=$D;Qm.fetch=$D;Qm.Headers=gC.Headers;Qm.Request=gC.Request;Qm.Response=gC.Response;Qm.default=$D});var i5=M((n7e,n5)=>{var Ahe=require("crypto");n5.exports=function(){return Ahe.randomBytes(16)}});var a5=M((i7e,s5)=>{var o5=[];for(PC=0;PC<256;++PC)o5[PC]=(PC+256).toString(16).substr(1);var PC;function Nhe(r,e){var t=e||0,n=o5;return[n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]]].join("")}s5.exports=Nhe});var No=M((o7e,c5)=>{var Mhe=i5(),Ohe=a5();function Khe(r,e,t){var n=e&&t||0;typeof r=="string"&&(e=r==="binary"?new Array(16):null,r=null),r=r||{};var i=r.random||(r.rng||Mhe)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[n+o]=i[o];return e||Ohe(i)}c5.exports=Khe});var f5=M((s5e,m5)=>{"use strict";function pf(r){if(!(this instanceof pf))return new pf(r);r=r||{},this.concurrency=r.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=Uhe.bind(this)}var Lhe=["push","unshift","splice"];Lhe.forEach(function(r){pf.prototype[r]=function(){var e=Array.prototype[r].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(pf.prototype,"length",{get:function(){return this.pending+this.jobs.length}});pf.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var r=this.jobs.shift();this.pending++,r(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};pf.prototype.onDone=function(r){typeof r=="function"&&(this.cbs.push(r),this._run())};function Uhe(){this.pending--,this._run()}m5.exports=pf});var df=M((a5e,h5)=>{"use strict";h5.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var R5=M((c5e,T5)=>{var b5=require("fs"),mu=require("path"),I5=require("os"),S5=typeof __webpack_require__=="function"?__non_webpack_require__:require,jhe=process.config&&process.config.variables||{},Whe=!!process.env.PREBUILDS_ONLY,g5=process.versions.modules,uF=qhe()?"electron":Bhe()?"node-webkit":"node",pF=process.env.npm_config_arch||I5.arch(),dF=process.env.npm_config_platform||I5.platform(),x5=process.env.LIBC||(Jhe(dF)?"musl":"glibc"),mF=process.env.ARM_VERSION||(pF==="arm64"?"8":jhe.arm_version)||"",C5=(process.versions.uv||"").split(".")[0];T5.exports=sl;function sl(r){return S5(sl.resolve(r))}sl.resolve=sl.path=function(r){r=mu.resolve(r||".");try{var e=S5(mu.join(r,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(r=process.env[e+"_PREBUILD"])}catch{}if(!Whe){var t=v5(mu.join(r,"build/Release"),y5);if(t)return t;var n=v5(mu.join(r,"build/Debug"),y5);if(n)return n}var i=a(r);if(i)return i;var o=a(mu.dirname(process.execPath));if(o)return o;var s=["platform="+dF,"arch="+pF,"runtime="+uF,"abi="+g5,"uv="+C5,mF?"armv="+mF:"","libc="+x5,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+r+`
`);function a(c){var l=fF(mu.join(c,"prebuilds")).map(w5),u=l.filter(E5(dF,pF)).sort(P5)[0];if(u){var p=mu.join(c,"prebuilds",u.name),m=fF(p).map(k5),h=m.filter(D5(uF,g5)),g=h.sort(_5(uF))[0];if(g)return mu.join(p,g.file)}}};function fF(r){try{return b5.readdirSync(r)}catch{return[]}}function v5(r,e){var t=fF(r).filter(e);return t[0]&&mu.join(r,t[0])}function y5(r){return/\.node$/.test(r)}function w5(r){var e=r.split("-");if(e.length===2){var t=e[0],n=e[1].split("+");if(t&&n.length&&n.every(Boolean))return{name:r,platform:t,architectures:n}}}function E5(r,e){return function(t){return t==null||t.platform!==r?!1:t.architectures.includes(e)}}function P5(r,e){return r.architectures.length-e.architectures.length}function k5(r){var e=r.split("."),t=e.pop(),n={file:r,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")n.runtime=o;else if(o==="napi")n.napi=!0;else if(o.slice(0,3)==="abi")n.abi=o.slice(3);else if(o.slice(0,2)==="uv")n.uv=o.slice(2);else if(o.slice(0,4)==="armv")n.armv=o.slice(4);else if(o==="glibc"||o==="musl")n.libc=o;else continue;n.specificity++}return n}}function D5(r,e){return function(t){return!(t==null||t.runtime!==r&&!Vhe(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==C5||t.armv&&t.armv!==mF||t.libc&&t.libc!==x5)}}function Vhe(r){return r.runtime==="node"&&r.napi}function _5(r){return function(e,t){return e.runtime!==t.runtime?e.runtime===r?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function Bhe(){return!!(process.versions&&process.versions.nw)}function qhe(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Jhe(r){return r==="linux"&&b5.existsSync("/etc/alpine-release")}sl.parseTags=k5;sl.matchTags=D5;sl.compareTags=_5;sl.parseTuple=w5;sl.matchTuple=E5;sl.compareTuples=P5});var gF=M((l5e,hF)=>{typeof process.addon=="function"?hF.exports=process.addon.bind(process):hF.exports=R5()});var N5=M((u5e,A5)=>{"use strict";var $he=(r,e,t,n,i)=>{for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]},Hhe=(r,e)=>{let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]};A5.exports={mask:$he,unmask:Hhe}});var M5=M((p5e,vF)=>{"use strict";try{vF.exports=gF()(__dirname)}catch{vF.exports=N5()}});var b_=M((d5e,yF)=>{"use strict";var{EMPTY_BUFFER:Ghe}=df();function O5(r,e){if(r.length===0)return Ghe;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e);for(var n=0,i=0;i<r.length;i++){let o=r[i];o.copy(t,n),n+=o.length}return t}function K5(r,e,t,n,i){for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]}function F5(r,e){let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]}function L5(r){return r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function y_(r){if(y_.readOnly=!0,Buffer.isBuffer(r))return r;var e;return r instanceof ArrayBuffer?e=Buffer.from(r):ArrayBuffer.isView(r)?e=zhe(r):(e=Buffer.from(r),y_.readOnly=!1),e}function zhe(r){let e=Buffer.from(r.buffer);return r.byteLength!==r.buffer.byteLength?e.slice(r.byteOffset,r.byteOffset+r.byteLength):e}try{let r=M5(),e=r.BufferUtil||r;yF.exports={concat:O5,mask(t,n,i,o,s){s<48?K5(t,n,i,o,s):e.mask(t,n,i,o,s)},toArrayBuffer:L5,toBuffer:y_,unmask(t,n){t.length<32?F5(t,n):e.unmask(t,n)}}}catch{yF.exports={concat:O5,mask:K5,toArrayBuffer:L5,toBuffer:y_,unmask:F5}}});var TC=M((m5e,B5)=>{"use strict";var Qhe=f5(),_C=require("zlib"),U5=b_(),{kStatusCode:j5,NOOP:Yhe}=df(),Xhe=Buffer.from([0,0,255,255]),Zhe=Buffer.from([0]),S_=Symbol("permessage-deflate"),fu=Symbol("total-length"),W5=Symbol("callback"),ld=Symbol("buffers"),bF=Symbol("error"),I_,IF=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!I_){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;I_=new Qhe({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,n=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{var i=t[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=i})}),e}decompress(e,t,n){I_.push(i=>{this._decompress(e,t,(o,s)=>{i(),n(o,s)})})}compress(e,t,n){I_.push(i=>{this._compress(e,t,(o,s)=>{i(),n(o,s)})})}_decompress(e,t,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?_C.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=_C.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[S_]=this,this._inflate[fu]=0,this._inflate[ld]=[],this._inflate.on("error",tge),this._inflate.on("data",V5)}this._inflate[W5]=n,this._inflate.write(e),t&&this._inflate.write(Xhe),this._inflate.flush(()=>{let o=this._inflate[bF];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=U5.concat(this._inflate[ld],this._inflate[fu]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[fu]=0,this._inflate[ld]=[]),n(null,s)})}_compress(e,t,n){if(!e||e.length===0){process.nextTick(n,null,Zhe);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?_C.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=_C.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[fu]=0,this._deflate[ld]=[],this._deflate.on("error",Yhe),this._deflate.on("data",ege)}this._deflate.write(e),this._deflate.flush(_C.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=U5.concat(this._deflate[ld],this._deflate[fu]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[fu]=0,this._deflate[ld]=[]),n(null,o)}})}};B5.exports=IF;function ege(r){this[ld].push(r),this[fu]+=r.length}function V5(r){if(this[fu]+=r.length,this[S_]._maxPayload<1||this[fu]<=this[S_]._maxPayload){this[ld].push(r);return}this[bF]=new RangeError("Max payload size exceeded"),this[bF][j5]=1009,this.removeListener("data",V5),this.reset()}function tge(r){this[S_]._inflate=null,r[j5]=1007,this[W5](r)}});var J5=M((f5e,q5)=>{"use strict";var Dy=class{constructor(e,t){this.target=t,this.type=e}},SF=class extends Dy{constructor(e,t){super("message",t),this.data=e}},xF=class extends Dy{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}},CF=class extends Dy{constructor(e){super("open",e)}},wF=class extends Dy{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},rge={addEventListener(r,e){if(typeof e!="function")return;function t(s){e.call(this,new SF(s,this))}function n(s,a){e.call(this,new xF(s,a,this))}function i(s){e.call(this,new wF(s,this))}function o(){e.call(this,new CF(this))}r==="message"?(t._listener=e,this.on(r,t)):r==="close"?(n._listener=e,this.on(r,n)):r==="error"?(i._listener=e,this.on(r,i)):r==="open"?(o._listener=e,this.on(r,o)):this.on(r,e)},removeEventListener(r,e){let t=this.listeners(r);for(var n=0;n<t.length;n++)(t[n]===e||t[n]._listener===e)&&this.removeListener(r,t[n])}};q5.exports=rge});var EF=M((h5e,$5)=>{"use strict";var RC=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function al(r,e,t){Object.prototype.hasOwnProperty.call(r,e)?r[e].push(t):r[e]=[t]}function nge(r){let e={};if(r===void 0||r==="")return e;for(var t={},n=!1,i=!1,o=!1,s,a,c=-1,l=-1,u=0;u<r.length;u++){let h=r.charCodeAt(u);if(s===void 0)if(l===-1&&RC[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);let g=r.slice(c,l);h===44?(al(e,g,t),t={}):s=g,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(l===-1&&RC[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u),al(t,r.slice(c,l),!0),h===44&&(al(e,s,t),t={},s=void 0),c=l=-1}else if(h===61&&c!==-1&&l===-1)a=r.slice(c,u),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(RC[h]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1?c=u:n||(n=!0),i=!1}else if(o)if(RC[h]===1)c===-1&&(c=u);else if(h===34&&c!==-1)o=!1,l=u;else if(h===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(h===34&&r.charCodeAt(u-1)===61)o=!0;else if(l===-1&&RC[h]===1)c===-1&&(c=u);else if(c!==-1&&(h===32||h===9))l===-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);var p=r.slice(c,l);n&&(p=p.replace(/\\/g,""),n=!1),al(t,a,p),h===44&&(al(e,s,t),t={},s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(c===-1||o)throw new SyntaxError("Unexpected end of input");l===-1&&(l=u);let m=r.slice(c,l);return s===void 0?al(e,m,{}):(a===void 0?al(t,m,!0):n?al(t,a,m.replace(/\\/g,"")):al(t,a,m),al(e,s,t)),e}function ige(r){return Object.keys(r).map(e=>{var t=r[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(i=>{var o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}$5.exports={format:ige,parse:nge}});var G5=M((g5e,H5)=>{"use strict";function oge(r){let e=r.length,t=0;for(;t<e;)if(!(r[t]&128))t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}H5.exports=oge});var z5=M((v5e,PF)=>{"use strict";try{PF.exports=gF()(__dirname)}catch{PF.exports=G5()}});var kF=M(x_=>{"use strict";try{let r=z5();x_.isValidUTF8=typeof r=="object"?r.Validation.isValidUTF8:r}catch{x_.isValidUTF8=()=>!0}x_.isValidStatusCode=r=>r>=1e3&&r<=1013&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999});var RF=M((b5e,tH)=>{"use strict";var{Writable:sge}=require("stream"),Q5=TC(),{BINARY_TYPES:age,EMPTY_BUFFER:cge,kStatusCode:lge,kWebSocket:uge}=df(),{concat:DF,toArrayBuffer:pge,unmask:dge}=b_(),{isValidStatusCode:mge,isValidUTF8:Y5}=kF(),AC=0,X5=1,Z5=2,eH=3,_F=4,fge=5,TF=class extends sge{constructor(e,t,n){super(),this._binaryType=e||age[0],this[uge]=void 0,this._extensions=t||{},this._maxPayload=n|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=AC,this._loop=!1}_write(e,t,n){if(this._opcode===8&&this._state==AC)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=n.slice(e),n.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case AC:t=this.getInfo();break;case X5:t=this.getPayloadLength16();break;case Z5:t=this.getPayloadLength64();break;case eH:this.getMask();break;case _F:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,Ii(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[Q5.extensionName])return this._loop=!1,Ii(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,Ii(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,Ii(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,Ii(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,Ii(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,Ii(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,Ii(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,Ii(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=X5;else if(this._payloadLength===127)this._state=Z5;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,Ii(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,Ii(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=eH:this._state=_F}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=_F}getData(e){var t=cge;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&dge(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=fge,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[Q5.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(Ii(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=DF(n,t):this._binaryType==="arraybuffer"?e=pge(DF(n,t)):e=n,this.emit("message",e)}else{let i=DF(n,t);if(!Y5(i))return this._loop=!1,Ii(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=AC}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return Ii(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!mge(t))return Ii(RangeError,`invalid status code ${t}`,!0,1002);let n=e.slice(2);if(!Y5(n))return Ii(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=AC}};tH.exports=TF;function Ii(r,e,t,n){let i=new r(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,Ii),i[lge]=n,i}});var NF=M((I5e,iH)=>{"use strict";var{randomBytes:hge}=require("crypto"),rH=TC(),{EMPTY_BUFFER:gge}=df(),{isValidStatusCode:vge}=kF(),{mask:nH,toBuffer:hu}=b_(),AF=class r{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let n=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(n?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=hge(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],n?(nH(e,a,s,i,e.length),[s]):(nH(e,a,e,0,e.length),[s,e])}close(e,t,n,i){var o;if(e===void 0)o=gge;else{if(typeof e!="number"||!vge(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,n,i]):this.doClose(o,n,i)}doClose(e,t,n){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){let i=hu(e);this._deflating?this.enqueue([this.doPing,i,t,hu.readOnly,n]):this.doPing(i,t,hu.readOnly,n)}doPing(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),i)}pong(e,t,n){let i=hu(e);this._deflating?this.enqueue([this.doPong,i,t,hu.readOnly,n]):this.doPong(i,t,hu.readOnly,n)}doPong(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),i)}send(e,t,n){let i=hu(e),o=this._extensions[rH.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let c={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:hu.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,c,n]):this.dispatch(i,this._compress,c,n)}else this.sendFrame(r.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:hu.readOnly}),n)}dispatch(e,t,n,i){if(!t){this.sendFrame(r.frame(e,n),i);return}let o=this._extensions[rH.extensionName];this._deflating=!0,o.compress(e,n.fin,(s,a)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(r.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};iH.exports=AF});var KF=M((S5e,hH)=>{"use strict";var yge=require("events"),oH=require("crypto"),bge=require("https"),Ige=require("http"),Sge=require("net"),xge=require("tls"),_y=require("url"),ud=TC(),lH=J5(),sH=EF(),Cge=RF(),wge=NF(),{BINARY_TYPES:aH,EMPTY_BUFFER:MF,GUID:Ege,kStatusCode:Pge,kWebSocket:Mo,NOOP:uH}=df(),C_=["CONNECTING","OPEN","CLOSING","CLOSED"],OF=[8,13],kge=30*1e3,Oo=class r extends yge{constructor(e,t,n){super(),this.readyState=r.CONNECTING,this.protocol="",this._binaryType=aH[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(n=t,t=void 0),pH(this,e,t,n)):this._isServer=!0}get CONNECTING(){return r.CONNECTING}get CLOSING(){return r.CLOSING}get CLOSED(){return r.CLOSED}get OPEN(){return r.OPEN}get binaryType(){return this._binaryType}set binaryType(e){aH.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){let i=new Cge(this._binaryType,this._extensions,n);this._sender=new wge(e,this._extensions),this._receiver=i,this._socket=e,i[Mo]=this,e[Mo]=this,i.on("conclude",Tge),i.on("drain",Rge),i.on("error",Age),i.on("message",Nge),i.on("ping",Mge),i.on("pong",Oge),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",dH),e.on("data",w_),e.on("end",mH),e.on("error",fH),this.readyState=r.OPEN,this.emit("open")}emitClose(){if(this.readyState=r.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ud.extensionName]&&this._extensions[ud.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let n="WebSocket was closed before the connection was established";return gu(this,this._req,n)}if(this.readyState===r.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),kge)}}ping(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${C_[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||MF,t,n)}pong(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${C_[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||MF,t,n)}send(e,t,n){if(typeof t=="function"&&(n=t,t={}),this.readyState!==r.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${C_[this.readyState]})`);if(n)return n(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[ud.extensionName]||(i.compress=!1),this._sender.send(e||MF,i,n)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let e="WebSocket was closed before the connection was established";return gu(this,this._req,e)}this._socket&&(this.readyState=r.CLOSING,this._socket.destroy())}}};C_.forEach((r,e)=>{Oo[r]=e});["open","error","close","message"].forEach(r=>{Object.defineProperty(Oo.prototype,`on${r}`,{get(){let e=this.listeners(r);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(r);for(var n=0;n<t.length;n++)t[n]._listener&&this.removeListener(r,t[n]);this.addEventListener(r,e)}})});Oo.prototype.addEventListener=lH.addEventListener;Oo.prototype.removeEventListener=lH.removeEventListener;hH.exports=Oo;function pH(r,e,t,n){let i=Object.assign({protocolVersion:OF[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!OF.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${OF.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,r.url=e.href):(o=_y.URL?new _y.URL(e):_y.parse(e),r.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${r.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",c=a?443:80,l=oH.randomBytes(16).toString("base64"),u=a?bge.get:Ige.get,p=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var m;if(i.createConnection=a?_ge:Dge,i.defaultPort=i.defaultPort||c,i.port=o.port||c,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=p,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new ud(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=sH.format({[ud.extensionName]:m.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let g=p.split(":");i.socketPath=g[0],i.path=g[1]}var h=r._req=u(i);i.timeout&&h.on("timeout",()=>{gu(r,h,"Opening handshake has timed out")}),h.on("error",g=>{r._req.aborted||(h=r._req=null,r.readyState=Oo.CLOSING,r.emit("error",g),r.emitClose())}),h.on("response",g=>{let y=g.headers.location,x=g.statusCode;if(y&&i.followRedirects&&x>=300&&x<400){if(++r._redirects>i.maxRedirects){gu(r,h,"Maximum redirects exceeded");return}h.abort();let E=_y.URL?new _y.URL(y,e):_y.resolve(e,y);pH(r,E,t,n)}else r.emit("unexpected-response",h,g)||gu(r,h,`Unexpected server response: ${g.statusCode}`)}),h.on("upgrade",(g,y,x)=>{if(r.emit("upgrade",g),r.readyState!==Oo.CONNECTING)return;h=r._req=null;let E=oH.createHash("sha1").update(l+Ege).digest("base64");if(g.headers["sec-websocket-accept"]!==E){gu(r,y,"Invalid Sec-WebSocket-Accept header");return}let A=g.headers["sec-websocket-protocol"],T=(t||"").split(/, */);var j;if(!t&&A?j="Server sent a subprotocol but none was requested":t&&!A?j="Server sent no subprotocol":A&&!T.includes(A)&&(j="Server sent an invalid subprotocol"),j){gu(r,y,j);return}if(A&&(r.protocol=A),m)try{let oe=sH.parse(g.headers["sec-websocket-extensions"]);oe[ud.extensionName]&&(m.accept(oe[ud.extensionName]),r._extensions[ud.extensionName]=m)}catch{gu(r,y,"Invalid Sec-WebSocket-Extensions header");return}r.setSocket(y,x,i.maxPayload)})}function Dge(r){return r.protocolVersion&&(r.path=r.socketPath),Sge.connect(r)}function _ge(r){return r.path=void 0,r.servername=r.servername||r.host,xge.connect(r)}function gu(r,e,t){r.readyState=Oo.CLOSING;let n=new Error(t);Error.captureStackTrace(n,gu),e.setHeader?(e.abort(),e.once("abort",r.emitClose.bind(r)),r.emit("error",n)):(e.destroy(n),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function Tge(r,e){let t=this[Mo];t._socket.removeListener("data",w_),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,r===1005?t.close():t.close(r,e)}function Rge(){this[Mo]._socket.resume()}function Age(r){let e=this[Mo];e._socket.removeListener("data",w_),e.readyState=Oo.CLOSING,e._closeCode=r[Pge],e.emit("error",r),e._socket.destroy()}function cH(){this[Mo].emitClose()}function Nge(r){this[Mo].emit("message",r)}function Mge(r){let e=this[Mo];e.pong(r,!e._isServer,uH),e.emit("ping",r)}function Oge(r){this[Mo].emit("pong",r)}function dH(){let r=this[Mo];this.removeListener("close",dH),this.removeListener("end",mH),r.readyState=Oo.CLOSING,r._socket.read(),r._receiver.end(),this.removeListener("data",w_),this[Mo]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",cH),r._receiver.on("finish",cH))}function w_(r){this[Mo]._receiver.write(r)||this.pause()}function mH(){let r=this[Mo];r.readyState=Oo.CLOSING,r._receiver.end(),this.end()}function fH(){let r=this[Mo];this.removeListener("error",fH),this.on("error",uH),r.readyState=Oo.CLOSING,this.destroy()}});var yH=M((x5e,vH)=>{"use strict";var Kge=require("events"),Fge=require("crypto"),P_=require("http"),mf=TC(),gH=EF(),Lge=KF(),{GUID:Uge}=df(),jge=/^[+/0-9A-Za-z]{22}==$/,FF=class extends Kge{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=P_.createServer((n,i)=>{let o=P_.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=Wge(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s=>{this.emit("connection",s,n)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let n of this.clients)n.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(Vge,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",LF);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=+e.headers["sec-websocket-version"],a={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!o||!jge.test(o)||s!==8&&s!==13||!this.shouldHandle(e))return E_(t,400);if(this.options.perMessageDeflate){let c=new mf(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let l=gH.parse(e.headers["sec-websocket-extensions"]);l[mf.extensionName]&&(c.accept(l[mf.extensionName]),a[mf.extensionName]=c)}catch{return E_(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${s===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(l,u,p,m)=>{if(!l)return E_(t,u||401,p,m);this.completeUpgrade(o,a,e,t,n,i)});return}if(!this.options.verifyClient(c))return E_(t,401)}this.completeUpgrade(o,a,e,t,n,i)}completeUpgrade(e,t,n,i,o,s){if(!i.readable||!i.writable)return i.destroy();let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Fge.createHash("sha1").update(e+Uge).digest("base64")}`],l=new Lge(null);var u=n.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(Bge),this.options.handleProtocols?u=this.options.handleProtocols(u,n):u=u[0],u&&(c.push(`Sec-WebSocket-Protocol: ${u}`),l.protocol=u)),t[mf.extensionName]){let p=t[mf.extensionName].params,m=gH.format({[mf.extensionName]:[p]});c.push(`Sec-WebSocket-Extensions: ${m}`),l._extensions=t}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",LF),l.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(l),l.on("close",()=>this.clients.delete(l))),s(l)}};vH.exports=FF;function Wge(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let n of Object.keys(e))r.removeListener(n,e[n])}}function Vge(r){r.emit("close")}function LF(){this.destroy()}function E_(r,e,t,n){r.writable&&(t=t||P_.STATUS_CODES[e],n=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},n),r.write(`HTTP/1.1 ${e} ${P_.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+t)),r.removeListener("error",LF),r.destroy()}function Bge(r){return r.trim()}});var IH=M((C5e,bH)=>{"use strict";var k_=KF();k_.Server=yH();k_.Receiver=RF();k_.Sender=NF();bH.exports=k_});var xH=M((w5e,SH)=>{"use strict";SH.exports=IH()});var _H=M((A_,DH)=>{(function(r,e){typeof A_=="object"&&typeof DH<"u"?e(A_):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_algorithm={}))})(A_,function(r){"use strict";r.ArrayExt=void 0,function(L){function V(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var De;J<q?De=J+1+(re-q):De=J-q+1;for(var Fe=0;Fe<De;++Fe){var dr=(q+Fe)%re;if(se[dr]===fe)return dr}return-1}L.firstIndexOf=V;function be(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var De;q<J?De=q+1+(re-J):De=q-J+1;for(var Fe=0;Fe<De;++Fe){var dr=(q-Fe+re)%re;if(se[dr]===fe)return dr}return-1}L.lastIndexOf=be;function Oe(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var De;J<q?De=J+1+(re-q):De=J-q+1;for(var Fe=0;Fe<De;++Fe){var dr=(q+Fe)%re;if(fe(se[dr],dr))return dr}return-1}L.findFirstIndex=Oe;function nt(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=se.length;if(re===0)return-1;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var De;q<J?De=q+1+(re-J):De=q-J+1;for(var Fe=0;Fe<De;++Fe){var dr=(q-Fe+re)%re;if(fe(se[dr],dr))return dr}return-1}L.findLastIndex=nt;function on(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=Oe(se,fe,q,J);return re!==-1?se[re]:void 0}L.findFirstValue=on;function Ht(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=nt(se,fe,q,J);return re!==-1?se[re]:void 0}L.findLastValue=Ht;function Wt(se,fe,q,J,re){J===void 0&&(J=0),re===void 0&&(re=-1);var De=se.length;if(De===0)return 0;J<0?J=Math.max(0,J+De):J=Math.min(J,De-1),re<0?re=Math.max(0,re+De):re=Math.min(re,De-1);for(var Fe=J,dr=re-J+1;dr>0;){var Pi=dr>>1,Ol=Fe+Pi;q(se[Ol],fe)<0?(Fe=Ol+1,dr-=Pi+1):dr=Pi}return Fe}L.lowerBound=Wt;function Ot(se,fe,q,J,re){J===void 0&&(J=0),re===void 0&&(re=-1);var De=se.length;if(De===0)return 0;J<0?J=Math.max(0,J+De):J=Math.min(J,De-1),re<0?re=Math.max(0,re+De):re=Math.min(re,De-1);for(var Fe=J,dr=re-J+1;dr>0;){var Pi=dr>>1,Ol=Fe+Pi;q(se[Ol],fe)>0?dr=Pi:(Fe=Ol+1,dr-=Pi+1)}return Fe}L.upperBound=Ot;function kr(se,fe,q){if(se===fe)return!0;if(se.length!==fe.length)return!1;for(var J=0,re=se.length;J<re;++J)if(q?!q(se[J],fe[J]):se[J]!==fe[J])return!1;return!0}L.shallowEqual=kr;function Gr(se,fe){fe===void 0&&(fe={});var q=fe.start,J=fe.stop,re=fe.step;if(re===void 0&&(re=1),re===0)throw new Error("Slice `step` cannot be zero.");var De=se.length;q===void 0?q=re<0?De-1:0:q<0?q=Math.max(q+De,re<0?-1:0):q>=De&&(q=re<0?De-1:De),J===void 0?J=re<0?-1:De:J<0?J=Math.max(J+De,re<0?-1:0):J>=De&&(J=re<0?De-1:De);var Fe;re<0&&J>=q||re>0&&q>=J?Fe=0:re<0?Fe=Math.floor((J-q+1)/re+1):Fe=Math.floor((J-q-1)/re+1);for(var dr=[],Pi=0;Pi<Fe;++Pi)dr[Pi]=se[q+Pi*re];return dr}L.slice=Gr;function Ar(se,fe,q){var J=se.length;if(!(J<=1)&&(fe<0?fe=Math.max(0,fe+J):fe=Math.min(fe,J-1),q<0?q=Math.max(0,q+J):q=Math.min(q,J-1),fe!==q)){for(var re=se[fe],De=fe<q?1:-1,Fe=fe;Fe!==q;Fe+=De)se[Fe]=se[Fe+De];se[q]=re}}L.move=Ar;function sn(se,fe,q){fe===void 0&&(fe=0),q===void 0&&(q=-1);var J=se.length;if(!(J<=1))for(fe<0?fe=Math.max(0,fe+J):fe=Math.min(fe,J-1),q<0?q=Math.max(0,q+J):q=Math.min(q,J-1);fe<q;){var re=se[fe],De=se[q];se[fe++]=De,se[q--]=re}}L.reverse=sn;function H(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(!(re<=1)&&(q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1),!(q>=J))){var De=J-q+1;if(fe>0?fe=fe%De:fe<0&&(fe=(fe%De+De)%De),fe!==0){var Fe=q+fe;sn(se,q,Fe-1),sn(se,Fe,J),sn(se,q,J)}}}L.rotate=H;function ie(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re!==0){q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);var De;J<q?De=J+1+(re-q):De=J-q+1;for(var Fe=0;Fe<De;++Fe)se[(q+Fe)%re]=fe}}L.fill=ie;function ge(se,fe,q){var J=se.length;fe<0?fe=Math.max(0,fe+J):fe=Math.min(fe,J);for(var re=J;re>fe;--re)se[re]=se[re-1];se[fe]=q}L.insert=ge;function Ee(se,fe){var q=se.length;if(fe<0&&(fe+=q),!(fe<0||fe>=q)){for(var J=se[fe],re=fe+1;re<q;++re)se[re-1]=se[re];return se.length=q-1,J}}L.removeAt=Ee;function ze(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=V(se,fe,q,J);return re!==-1&&Ee(se,re),re}L.removeFirstOf=ze;function an(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re=be(se,fe,q,J);return re!==-1&&Ee(se,re),re}L.removeLastOf=an;function kt(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return 0;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);for(var De=0,Fe=0;Fe<re;++Fe)q<=J&&Fe>=q&&Fe<=J&&se[Fe]===fe||J<q&&(Fe<=J||Fe>=q)&&se[Fe]===fe?De++:De>0&&(se[Fe-De]=se[Fe]);return De>0&&(se.length=re-De),De}L.removeAllOf=kt;function Rt(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re,De=Oe(se,fe,q,J);return De!==-1&&(re=Ee(se,De)),{index:De,value:re}}L.removeFirstWhere=Rt;function it(se,fe,q,J){q===void 0&&(q=-1),J===void 0&&(J=0);var re,De=nt(se,fe,q,J);return De!==-1&&(re=Ee(se,De)),{index:De,value:re}}L.removeLastWhere=it;function jt(se,fe,q,J){q===void 0&&(q=0),J===void 0&&(J=-1);var re=se.length;if(re===0)return 0;q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),J<0?J=Math.max(0,J+re):J=Math.min(J,re-1);for(var De=0,Fe=0;Fe<re;++Fe)q<=J&&Fe>=q&&Fe<=J&&fe(se[Fe],Fe)||J<q&&(Fe<=J||Fe>=q)&&fe(se[Fe],Fe)?De++:De>0&&(se[Fe-De]=se[Fe]);return De>0&&(se.length=re-De),De}L.removeAllWhere=jt}(r.ArrayExt||(r.ArrayExt={}));function e(L){var V;return typeof L.iter=="function"?V=L.iter():V=new p(L),V}function t(L){return new m(L)}function n(L){return new h(L)}function i(L){return new g(L)}function o(L){return new y(L)}function s(L,V){for(var be=0,Oe=e(L),nt;(nt=Oe.next())!==void 0;)if(V(nt,be++)===!1)return}function a(L,V){for(var be=0,Oe=e(L),nt;(nt=Oe.next())!==void 0;)if(!V(nt,be++))return!1;return!0}function c(L,V){for(var be=0,Oe=e(L),nt;(nt=Oe.next())!==void 0;)if(V(nt,be++))return!0;return!1}function l(L){for(var V=0,be=[],Oe=e(L),nt;(nt=Oe.next())!==void 0;)be[V++]=nt;return be}function u(L){for(var V=e(L),be,Oe={};(be=V.next())!==void 0;)Oe[be[0]]=be[1];return Oe}var p=function(){function L(V){this._index=0,this._source=V}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},L}(),m=function(){function L(V,be){be===void 0&&(be=Object.keys(V)),this._index=0,this._source=V,this._keys=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source,this._keys);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var V=this._keys[this._index++];return V in this._source?V:this.next()}},L}(),h=function(){function L(V,be){be===void 0&&(be=Object.keys(V)),this._index=0,this._source=V,this._keys=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source,this._keys);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var V=this._keys[this._index++];return V in this._source?this._source[V]:this.next()}},L}(),g=function(){function L(V,be){be===void 0&&(be=Object.keys(V)),this._index=0,this._source=V,this._keys=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source,this._keys);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var V=this._keys[this._index++];return V in this._source?[V,this._source[V]]:this.next()}},L}(),y=function(){function L(V){this._fn=V}return L.prototype.iter=function(){return this},L.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},L.prototype.next=function(){return this._fn.call(void 0)},L}();function x(){for(var L=[],V=0;V<arguments.length;V++)L[V]=arguments[V];return new E(e(L.map(e)))}var E=function(){function L(V){this._cloned=!1,this._source=V,this._active=void 0}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source.clone());return V._active=this._active&&this._active.clone(),V._cloned=!0,this._cloned=!0,V},L.prototype.next=function(){if(this._active===void 0){var V=this._source.next();if(V===void 0)return;this._active=this._cloned?V.clone():V}var be=this._active.next();return be!==void 0?be:(this._active=void 0,this.next())},L}();function A(){return new T}var T=function(){function L(){}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L},L.prototype.next=function(){},L}();function j(L,V){return V===void 0&&(V=0),new oe(e(L),V)}var oe=function(){function L(V,be){this._source=V,this._index=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._index)},L.prototype.next=function(){var V=this._source.next();if(V!==void 0)return[this._index++,V]},L}();function G(L,V){return new ue(e(L),V)}var ue=function(){function L(V,be){this._index=0,this._source=V,this._fn=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source.clone(),this._fn);return V._index=this._index,V},L.prototype.next=function(){for(var V=this._fn,be=this._source,Oe;(Oe=be.next())!==void 0;)if(V(Oe,this._index++))return Oe},L}();function pe(L,V){for(var be=0,Oe=e(L),nt;(nt=Oe.next())!==void 0;)if(V(nt,be++))return nt}function te(L,V){for(var be=0,Oe=e(L),nt;(nt=Oe.next())!==void 0;)if(V(nt,be++))return be-1;return-1}function Ce(L,V){var be=e(L),Oe=be.next();if(Oe!==void 0){for(var nt=Oe;(Oe=be.next())!==void 0;)V(Oe,nt)<0&&(nt=Oe);return nt}}function Le(L,V){var be=e(L),Oe=be.next();if(Oe!==void 0){for(var nt=Oe;(Oe=be.next())!==void 0;)V(Oe,nt)>0&&(nt=Oe);return nt}}function ct(L,V){var be=e(L),Oe=be.next();if(Oe!==void 0){for(var nt=Oe,on=Oe;(Oe=be.next())!==void 0;)V(Oe,nt)<0?nt=Oe:V(Oe,on)>0&&(on=Oe);return[nt,on]}}function ft(L,V){return new rt(e(L),V)}var rt=function(){function L(V,be){this._index=0,this._source=V,this._fn=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source.clone(),this._fn);return V._index=this._index,V},L.prototype.next=function(){var V=this._source.next();if(V!==void 0)return this._fn.call(void 0,V,this._index++)},L}();function ae(L,V,be){return V===void 0?new ke(0,L,1):be===void 0?new ke(L,V,1):new ke(L,V,be)}var ke=function(){function L(V,be,Oe){this._index=0,this._start=V,this._stop=be,this._step=Oe,this._length=X.rangeLength(V,be,Oe)}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._start,this._stop,this._step);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},L}(),X;(function(L){function V(be,Oe,nt){return nt===0?1/0:be>Oe&&nt>0||be<Oe&&nt<0?0:Math.ceil((Oe-be)/nt)}L.rangeLength=V})(X||(X={}));function ye(L,V,be){var Oe=0,nt=e(L),on=nt.next();if(on===void 0&&be===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(on===void 0)return be;var Ht=nt.next();if(Ht===void 0&&be===void 0)return on;if(Ht===void 0)return V(be,on,Oe++);var Wt;be===void 0?Wt=V(on,Ht,Oe++):Wt=V(V(be,on,Oe++),Ht,Oe++);for(var Ot;(Ot=nt.next())!==void 0;)Wt=V(Wt,Ot,Oe++);return Wt}function qe(L,V){return new Pt(L,V)}function hn(L){return new Pt(L,1)}var Pt=function(){function L(V,be){this._value=V,this._count=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._value,this._count)},L.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},L}();function Hr(L){var V;return typeof L.retro=="function"?V=L.retro():V=new xs(L),V}var xs=function(){function L(V){this._source=V,this._index=V.length-1}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},L}();function Bt(L){var V=[],be=new Set,Oe=new Map;return s(L,nt),Oe.forEach(function(Ht,Wt){on(Wt)}),V;function nt(Ht){var Wt=Ht[0],Ot=Ht[1],kr=Oe.get(Ot);kr?kr.push(Wt):Oe.set(Ot,[Wt])}function on(Ht){if(!be.has(Ht)){be.add(Ht);var Wt=Oe.get(Ht);Wt&&Wt.forEach(on),V.push(Ht)}}}function nn(L,V){return new Gi(e(L),V)}var Gi=function(){function L(V,be){this._source=V,this._step=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._step)},L.prototype.next=function(){for(var V=this._source.next(),be=this._step-1;be>0;--be)this._source.next();return V},L}();r.StringExt=void 0,function(L){function V(Ht,Wt,Ot){Ot===void 0&&(Ot=0);for(var kr=new Array(Wt.length),Gr=0,Ar=Ot,sn=Wt.length;Gr<sn;++Gr,++Ar){if(Ar=Ht.indexOf(Wt[Gr],Ar),Ar===-1)return null;kr[Gr]=Ar}return kr}L.findIndices=V;function be(Ht,Wt,Ot){Ot===void 0&&(Ot=0);var kr=V(Ht,Wt,Ot);if(!kr)return null;for(var Gr=0,Ar=0,sn=kr.length;Ar<sn;++Ar){var H=kr[Ar]-Ot;Gr+=H*H}return{score:Gr,indices:kr}}L.matchSumOfSquares=be;function Oe(Ht,Wt,Ot){Ot===void 0&&(Ot=0);var kr=V(Ht,Wt,Ot);if(!kr)return null;for(var Gr=0,Ar=Ot-1,sn=0,H=kr.length;sn<H;++sn){var ie=kr[sn];Gr+=ie-Ar-1,Ar=ie}return{score:Gr,indices:kr}}L.matchSumOfDeltas=Oe;function nt(Ht,Wt,Ot){for(var kr=[],Gr=0,Ar=0,sn=Wt.length;Gr<sn;){for(var H=Wt[Gr],ie=Wt[Gr];++Gr<sn&&Wt[Gr]===ie+1;)ie++;Ar<H&&kr.push(Ht.slice(Ar,H)),H<ie+1&&kr.push(Ot(Ht.slice(H,ie+1))),Ar=ie+1}return Ar<Ht.length&&kr.push(Ht.slice(Ar)),kr}L.highlight=nt;function on(Ht,Wt){return Ht<Wt?-1:Ht>Wt?1:0}L.cmp=on}(r.StringExt||(r.StringExt={}));function Mt(L,V){return new ur(e(L),V)}var ur=function(){function L(V,be){this._source=V,this._count=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._count)},L.prototype.next=function(){if(!(this._count<=0)){var V=this._source.next();if(V!==void 0)return this._count--,V}},L}();function si(){for(var L=[],V=0;V<arguments.length;V++)L[V]=arguments[V];return new Ml(L.map(e))}var Ml=function(){function L(V){this._source=V}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.map(function(V){return V.clone()}))},L.prototype.next=function(){for(var V=new Array(this._source.length),be=0,Oe=this._source.length;be<Oe;++be){var nt=this._source[be].next();if(nt===void 0)return;V[be]=nt}return V},L}();r.ArrayIterator=p,r.ChainIterator=E,r.EmptyIterator=T,r.EnumerateIterator=oe,r.FilterIterator=ue,r.FnIterator=y,r.ItemIterator=g,r.KeyIterator=m,r.MapIterator=rt,r.RangeIterator=ke,r.RepeatIterator=Pt,r.RetroArrayIterator=xs,r.StrideIterator=Gi,r.TakeIterator=ur,r.ValueIterator=h,r.ZipIterator=Ml,r.chain=x,r.each=s,r.empty=A,r.enumerate=j,r.every=a,r.filter=G,r.find=pe,r.findIndex=te,r.iter=e,r.iterFn=o,r.iterItems=i,r.iterKeys=t,r.iterValues=n,r.map=ft,r.max=Le,r.min=Ce,r.minmax=ct,r.once=hn,r.range=ae,r.reduce=ye,r.repeat=qe,r.retro=Hr,r.some=c,r.stride=nn,r.take=Mt,r.toArray=l,r.toObject=u,r.topologicSort=Bt,r.zip=si,Object.defineProperty(r,"__esModule",{value:!0})})});var RH=M((N_,TH)=>{(function(r,e){typeof N_=="object"&&typeof TH<"u"?e(N_):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_properties={}))})(N_,function(r){"use strict";r.AttachedProperty=function(){function t(n){this._pid=e.nextPID(),this.name=n.name,this._create=n.create,this._coerce=n.coerce||null,this._compare=n.compare||null,this._changed=n.changed||null}return t.prototype.get=function(n){var i,o=e.ensureMap(n);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n),i},t.prototype.set=function(n,i){var o,s=e.ensureMap(n);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(n);var a=this._coerceValue(n,i);this._maybeNotify(n,o,s[this._pid]=a)},t.prototype.coerce=function(n){var i,o=e.ensureMap(n);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n);var s=this._coerceValue(n,i);this._maybeNotify(n,i,o[this._pid]=s)},t.prototype._createValue=function(n){var i=this._create;return i(n)},t.prototype._coerceValue=function(n,i){var o=this._coerce;return o?o(n,i):i},t.prototype._compareValue=function(n,i){var o=this._compare;return o?o(n,i):n===i},t.prototype._maybeNotify=function(n,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(n,i,o)},t}(),function(t){function n(i){e.ownerData.delete(i)}t.clearData=n}(r.AttachedProperty||(r.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function n(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=n})(e||(e={})),Object.defineProperty(r,"__esModule",{value:!0})})});var O_=M((M_,AH)=>{(function(r,e){typeof M_=="object"&&typeof AH<"u"?e(M_,_H(),RH()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_signaling={},r.lumino_algorithm,r.lumino_properties))})(M_,function(r,e,t){"use strict";r.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return n.connect(this,o,s)},i.prototype.disconnect=function(o,s){return n.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||n.emit(this,o)},i}(),function(i){function o(h,g){var y=n.blockedProperty;y.set(h,y.get(h)+1);try{g()}finally{y.set(h,y.get(h)-1)}}i.blockAll=o;function s(h,g){n.disconnectBetween(h,g)}i.disconnectBetween=s;function a(h){n.disconnectSender(h)}i.disconnectSender=a;function c(h){n.disconnectReceiver(h)}i.disconnectReceiver=c;function l(h){n.disconnectAll(h)}i.disconnectAll=l;function u(h){n.disconnectAll(h)}i.clearData=u;function p(){return n.exceptionHandler}i.getExceptionHandler=p;function m(h){var g=n.exceptionHandler;return n.exceptionHandler=h,g}i.setExceptionHandler=m}(r.Signal||(r.Signal={}));var n;(function(i){i.exceptionHandler=function(G){console.error(G)};function o(G,ue,pe){pe=pe||void 0;var te=m.get(G.sender);if(te||(te=[],m.set(G.sender,te)),x(te,G,ue,pe))return!1;var Ce=pe||ue,Le=h.get(Ce);Le||(Le=[],h.set(Ce,Le));var ct={signal:G,slot:ue,thisArg:pe};return te.push(ct),Le.push(ct),!0}i.connect=o;function s(G,ue,pe){pe=pe||void 0;var te=m.get(G.sender);if(!te||te.length===0)return!1;var Ce=x(te,G,ue,pe);if(!Ce)return!1;var Le=pe||ue,ct=h.get(Le);return Ce.signal=null,A(te),A(ct),!0}i.disconnect=s;function a(G,ue){var pe=m.get(G);if(!(!pe||pe.length===0)){var te=h.get(ue);!te||te.length===0||(e.each(te,function(Ce){Ce.signal&&Ce.signal.sender===G&&(Ce.signal=null)}),A(pe),A(te))}}i.disconnectBetween=a;function c(G){var ue=m.get(G);!ue||ue.length===0||(e.each(ue,function(pe){if(pe.signal){var te=pe.thisArg||pe.slot;pe.signal=null,A(h.get(te))}}),A(ue))}i.disconnectSender=c;function l(G){var ue=h.get(G);!ue||ue.length===0||(e.each(ue,function(pe){if(pe.signal){var te=pe.signal.sender;pe.signal=null,A(m.get(te))}}),A(ue))}i.disconnectReceiver=l;function u(G){c(G),l(G)}i.disconnectAll=u;function p(G,ue){if(!(i.blockedProperty.get(G.sender)>0)){var pe=m.get(G.sender);if(!(!pe||pe.length===0))for(var te=0,Ce=pe.length;te<Ce;++te){var Le=pe[te];Le.signal===G&&E(Le,ue)}}}i.emit=p;var m=new WeakMap,h=new WeakMap,g=new Set,y=function(){var G=typeof requestAnimationFrame=="function";return G?requestAnimationFrame:setImmediate}();function x(G,ue,pe,te){return e.find(G,function(Ce){return Ce.signal===ue&&Ce.slot===pe&&Ce.thisArg===te})}function E(G,ue){var pe=G.signal,te=G.slot,Ce=G.thisArg;try{te.call(Ce,pe.sender,ue)}catch(Le){i.exceptionHandler(Le)}}function A(G){g.size===0&&y(T),g.add(G)}function T(){g.forEach(j),g.clear()}function j(G){e.ArrayExt.removeAllWhere(G,oe)}function oe(G){return G.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(n||(n={})),Object.defineProperty(r,"__esModule",{value:!0})})});var QF=M((art,HH)=>{"use strict";var tve=require("child_process").spawn;function rve(r){if(r){r=r.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return r=r.replace(e,""),r.trim()}}function nve(r,e,t,n){typeof t=="function"&&(n=t,t=void 0);var i=!1,o=tve(r,e,t),s="",a="";o.stdout.on("data",function(c){s+=c.toString()}),o.stderr.on("data",function(c){a+=c.toString()}),o.on("error",function(c){i||(i=!0,n(new Error(c)))}),o.on("close",function(c){if(!i){if(i=!0,a=rve(a),a)return n(new Error(a));n(null,s,c)}})}HH.exports=nve});var zH=M((crt,GH)=>{"use strict";var ive=require("os"),ove=QF();function sve(r){var e=["-A","-o","ppid,pid"];ove("ps",e,function(t,n,i){if(t)return r(t);if(i!==0)return r(new Error("pidtree ps command exited with code "+i));try{n=n.split(ive.EOL);for(var o=[],s=1;s<n.length;s++)n[s]=n[s].trim(),n[s]&&(n[s]=n[s].split(/\s+/),n[s][0]=parseInt(n[s][0],10),n[s][1]=parseInt(n[s][1],10),o.push(n[s]));r(null,o)}catch(a){r(a)}})}GH.exports=sve});var YH=M((lrt,QH)=>{"use strict";var ave=require("os"),cve=QF();function lve(r){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};cve("wmic",e,t,function(n,i,o){if(n){r(n);return}if(o!==0){r(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(ave.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));r(null,s)}catch(c){r(c)}})}QH.exports=lve});var t4=M((urt,e4)=>{"use strict";var ZH=require("os"),uve={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},pve={ps:()=>zH(),wmic:()=>YH()},YF=ZH.platform();YF.startsWith("win")&&(YF="win");var XH=uve[YF];function dve(r){XH===void 0&&r(new Error(ZH.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=pve[XH]();e(r)}e4.exports=dve});var n4=M((prt,r4)=>{"use strict";var mve=t4();function fve(r,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),r=parseInt(r,10),isNaN(r)||r<-1){t(new TypeError("The pid provided is invalid"));return}mve(function(n,i){if(n){t(n);return}if(r===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===r){s=e.advanced?{ppid:i[a][0],pid:r}:r;break}i[a][0]===r&&(s=e.advanced?{pid:r}:r)}if(!s){t(new Error("No matching pid found"));return}for(var c={};i.length>0;){var l=i.pop();c[l[0]]?c[l[0]].push(l[1]):c[l[0]]=[l[1]]}for(var u=0,p=[s];u<p.length;){var m=e.advanced?p[u++].pid:p[u++];if(c[m]){for(var h=c[m].length,g=0;g<h;g++)p.push(e.advanced?{ppid:m,pid:c[m][g]}:c[m][g]);delete c[m]}}e.root||p.shift(),t(null,p)})}r4.exports=fve});var s4=M((drt,o4)=>{"use strict";function hve(r,e,t){return new Promise(function(n,i){r(e,t,function(o,s){if(o)return i(o);n(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(r){return this.substring(0,r.length)===r});var i4=n4();function gve(r,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){i4(r,e,t);return}return hve(i4,r,e)}o4.exports=gve});var f4=M((mrt,m4)=>{var a4=Array.prototype.slice,c4=typeof Object.keys=="function"?Object.keys:function(r){var e=[];for(var t in r)e.push(t);return e},l4=m4.exports=function(r,e){return r===0&&e===0?vve(r,e):r===e?!0:r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():d4(r)?d4(e):typeof r!="object"&&typeof e!="object"?r==e:yve(r,e)};function u4(r){return r==null}function p4(r){return Object.prototype.toString.call(r)=="[object Arguments]"}function d4(r){return typeof r=="number"&&r!==r}function vve(r,e){return 1/r===1/e}function yve(r,e){if(u4(r)||u4(e)||r.prototype!==e.prototype)return!1;if(p4(r))return p4(e)?(r=a4.call(r),e=a4.call(e),l4(r,e)):!1;try{var t=c4(r),n=c4(e),i,o}catch{return!1}if(t.length!=n.length)return!1;for(t.sort(),n.sort(),o=t.length-1;o>=0;o--)if(t[o]!=n[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!l4(r[i],e[i]))return!1;return!0}});var v4=M((frt,g4)=>{"use strict";var h4="[a-fA-F\\d:]",vd=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${h4})|(?<=${h4})(?=\\s|$))`:"",Wa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Un="[a-fA-F\\d]{1,4}",oT=`
(?:
(?:${Un}:){7}(?:${Un}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Un}:){6}(?:${Wa}|:${Un}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Un}:){5}(?::${Wa}|(?::${Un}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Un}:){4}(?:(?::${Un}){0,1}:${Wa}|(?::${Un}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Un}:){3}(?:(?::${Un}){0,2}:${Wa}|(?::${Un}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Un}:){2}(?:(?::${Un}){0,3}:${Wa}|(?::${Un}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Un}:){1}(?:(?::${Un}){0,4}:${Wa}|(?::${Un}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Un}){0,5}:${Wa}|(?::${Un}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),bve=new RegExp(`(?:^${Wa}$)|(?:^${oT}$)`),Ive=new RegExp(`^${Wa}$`),Sve=new RegExp(`^${oT}$`),XF=r=>r&&r.exact?bve:new RegExp(`(?:${vd(r)}${Wa}${vd(r)})|(?:${vd(r)}${oT}${vd(r)})`,"g");XF.v4=r=>r&&r.exact?Ive:new RegExp(`${vd(r)}${Wa}${vd(r)}`,"g");XF.v6=r=>r&&r.exact?Sve:new RegExp(`${vd(r)}${oT}${vd(r)}`,"g");g4.exports=XF});var y4=M((hrt,xve)=>{xve.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var I4=M((grt,b4)=>{b4.exports=Pve;var Cve=/^(?:\w+:)?\/\/(\S+)$/,wve=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Eve=/^[^\s\.]+\.\S{2,}$/;function Pve(r){if(typeof r!="string")return!1;var e=r.match(Cve);if(!e)return!1;var t=e[1];return t?!!(wve.test(t)||Eve.test(t)):!1}});var C4=M(x4=>{"use strict";var S4={}.hasOwnProperty,yr={}.toString,S=x4,kve=f4(),Dve=v4();S.version=y4().version;S.browser=function(){return!S.node()&&typeof window<"u"&&yr.call(window)==="[object global]"};S.defined=function(r){return typeof r<"u"};S.def=S.defined;S.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};S.node=S.nodejs;S.undefined=function(r){return r===void 0};S.udef=S.undef=S.undefined;S.array=function(r){return yr.call(r)==="[object Array]"};S.arr=S.ary=S.arry=S.array;S.arrayLike=function(r){return S.nullOrUndef(r)?!1:r!==void 0&&S4.call(r,"length")&&isFinite(r.length)};S.arrLike=S.arryLike=S.aryLike=S.arraylike=S.arrayLike;S.arguments=function(r){return yr.call(r)==="[object Arguments]"};S.args=S.arguments;S.boolean=function(r){return yr.call(r)==="[object Boolean]"};S.bool=S.boolean;S.buffer=function(r){return S.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(r)};S.buff=S.buf=S.buffer;S.date=function(r){return yr.call(r)==="[object Date]"};S.error=function(r){return yr.call(r)==="[object Error]"};S.err=S.error;S.false=function(r){return r===!1};S.function=function(r){return S.syncFunction(r)||S.asyncFunction(r)};S.fun=S.func=S.function;S.asyncFunction=function(r){return yr.call(r)==="[object AsyncFunction]"};S.asyncFun=S.asyncFunc=S.asyncFunction;S.syncFunction=function(r){return yr.call(r)==="[object Function]"};S.syncFun=S.syncFunc=S.syncFunction;S.null=function(r){return r===null};S.nullOrUndefined=function(r){return r===null||typeof r>"u"};S.nullOrUndef=S.nullOrUndefined;S.number=function(r){return yr.call(r)==="[object Number]"};S.num=S.number;S.object=function(r){return yr.call(r)==="[object Object]"};S.obj=S.object;S.regExp=function(r){return yr.call(r)==="[object RegExp]"};S.re=S.regexp=S.regExp;S.string=function(r){return yr.call(r)==="[object String]"};S.str=S.string;S.true=function(r){return r===!0};var _ve=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");S.uuid=function(r){return _ve.test(r)};S.equal=function(r,e){var t=yr.call(r);return typeof r!=typeof e||t!==yr.call(e)?!1:t==="[object Object]"||t==="[object Array]"?kve(r,e):t==="[object Function]"?r.prototype===e.prototype:t==="[object Date]"?r.getTime()===e.getTime():r===e};S.objEquals=S.eq=S.equal;var Tve={boolean:1,number:1,string:1,undefined:1};S.hosted=function(r,e){if(S.nullOrUndef(r))return!1;var t=typeof e[r];return t==="object"?!!e[r]:!Tve[t]};S.instanceOf=function(r,e){return S.nullOrUndef(r)||S.nullOrUndef(e)?!1:r instanceof e};S.instOf=S.instanceof=S.instanceOf;S.objectInstanceOf=function(r,e){try{return yr.call(r)==="[object Object]"&&r instanceof e}catch{return!1}};S.instOf=S.instanceOf=S.objInstOf=S.objectInstanceOf;S.type=function(r,e){return typeof r===e};S.a=S.type;S.empty=function(r){var e=yr.call(r);if(e==="[object Array]"||e==="[object Arguments]")return r.length===0;if(e==="[object Object]"){for(var t in r)if(S4.call(r,t))return!1;return!0}return e==="[object String]"?r==="":!1};S.emptyArguments=function(r){return yr.call(r)==="[object Arguments]"&&r.length===0};S.noArgs=S.emptyArgs=S.emptyArguments;S.emptyArray=function(r){return yr.call(r)==="[object Array]"&&r.length===0};S.emptyArry=S.emptyAry=S.emptyArray;S.emptyArrayLike=function(r){return r.length===0};S.emptyArrLike=S.emptyArrayLike;S.emptyString=function(r){return S.string(r)&&r.length===0};S.emptyStr=S.emptyString;S.nonEmptyArray=function(r){return yr.call(r)==="[object Array]"&&r.length>0};S.nonEmptyArr=S.nonEmptyArry=S.nonEmptyAry=S.nonEmptyArray;S.nonEmptyObject=function(r){return yr.call(r)==="[object Object]"&&Object.keys(r).length>0};S.nonEmptyObj=S.nonEmptyObject;S.emptyObject=function(r){return yr.call(r)==="[object Object]"&&Object.keys(r).length===0};S.emptyObj=S.emptyObject;S.nonEmptyString=function(r){return S.string(r)&&r.length>0};S.nonEmptyStr=S.nonEmptyString;S.even=function(r){return yr.call(r)==="[object Number]"&&r%2===0};S.decimal=function(r){return yr.call(r)==="[object Number]"&&r%1!==0};S.dec=S.decNum=S.decimal;S.integer=function(r){return yr.call(r)==="[object Number]"&&r%1===0};S.int=S.integer;S.notANumber=function(r){return!S.num(r)||r!==r};S.nan=S.notANum=S.notANumber;S.odd=function(r){return!S.decimal(r)&&yr.call(r)==="[object Number]"&&r%2!==0};S.oddNumber=S.oddNum=S.odd;S.positiveNumber=function(r){return yr.call(r)==="[object Number]"&&r>0};S.pos=S.positive=S.posNum=S.positiveNum=S.positiveNumber;S.negativeNumber=function(r){return yr.call(r)==="[object Number]"&&r<0};S.neg=S.negNum=S.negativeNum=S.negativeNumber;S.negativeInteger=function(r){return yr.call(r)==="[object Number]"&&r%1===0&&r<0};S.negativeInt=S.negInt=S.negativeInteger;S.positiveInteger=function(r){return yr.call(r)==="[object Number]"&&r%1===0&&r>0};S.posInt=S.positiveInt=S.positiveInteger;S.divisibleBy=function(r,e){return r===0?!1:yr.call(r)==="[object Number]"&&e!==0&&r%e===0};S.divBy=S.divisBy=S.divisibleBy;S.greaterOrEqualTo=function(r,e){return r>=e};S.greaterOrEqual=S.ge=S.greaterOrEqualTo;S.greaterThan=function(r,e){return r>e};S.gt=S.greaterThan;S.lessThanOrEqualTo=function(r,e){return r<=e};S.lessThanOrEq=S.lessThanOrEqual=S.le=S.lessThanOrEqualTo;S.lessThan=function(r,e){return r<e};S.lt=S.lessThan;S.maximum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r<e[t])return!1;return!0};S.max=S.maximum;S.minimum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r>e[t])return!1;return!0};S.min=S.minimum;S.within=function(r,e,t){return r>=e&&r<=t};S.withIn=S.within;S.prettyClose=function(r,e,t){return!S.number(r)||!S.number(e)||S.defined(t)&&!S.posInt(t)?!1:(S.undefined(t)&&(t=2),r.toFixed(t)===e.toFixed(t))};S.closish=S.near=S.prettyClose;S.dnsAddress=function(r){return!(!S.nonEmptyStr(r)||r.length>255||Ave.test(r)||!Rve.test(r))};S.dnsAddr=S.dns=S.dnsAddress;var Rve=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,Ave=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;S.emailAddress=function(r){return S.nonEmptyStr(r)?Nve.test(r):!1};S.email=S.emailAddr=S.emailAddress;var Nve=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;S.ipv4Address=function(r){if(!S.nonEmptyStr(r)||r.length>15)return!1;var e=r.split(".");if(!S.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var n=parseInt(e[t],10);if(isNaN(n)||n<0||n>255)return!1}return!0};S.ipv4=S.ipv4Addr=S.ipv4Address;S.ipv6Address=function(r){return S.nonEmptyStr(r)?Dve.v6({extract:!0}).test(r):!1};S.ipv6=S.ipv6Addr=S.ipv6Address;S.ipAddress=function(r){return S.nonEmptyStr(r)?S.ipv4Address(r)||S.ipv6Address(r):!1};S.ip=S.ipAddr=S.ipAddress;S.hostAddress=function(r){return S.nonEmptyStr(r)?S.dns(r)||S.ipv4(r)||S.ipv6(r):!1};S.host=S.hostIp=S.hostAddr=S.hostAddress;S.port=function(r){return!(!S.num(r)||S.negativeInt(r)||r>65535)};S.systemPort=function(r){return!!(S.port(r)&&r<1024)};S.sysPort=S.systemPort;S.userPort=function(r){return!!(S.port(r)&&r>1023)};S.creditCardNumber=function(r){if(!S.str(r))return!1;var e=r.split(""),t,n;for(t=e.length-1,n=1;t>-1;t--,n++)n%2===0&&(e[t]*=2);r=e.join("");var i=0;for(t=0;t<r.length;t++)i+=Math.floor(r[t]);return i%10===0};S.creditCard=S.creditCardNum=S.creditCardNumber;S.americanExpressCardNumber=function(r){if(!S.str(r)||r.length!==15)return!1;var e=Math.floor(r.slice(0,2));return!(e!==34&&e!==37||!S.creditCardNumber(r))};S.amexCard=S.amexCardNum=S.americanExpressCardNumber;S.chinaUnionPayCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,2));return!(e!==62&&e!==88)};S.chinaUnion=S.chinaUnionPayCard=S.chinaUnionPayCardNumber;S.dinersClubCarteBlancheCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3));return!(e<300||e>305||!S.creditCardNumber(r))};S.dinersClubCB=S.dinersClubCarteBlancheCard=S.dinersClubCarteBlancheCardNumber;S.dinersClubInternationalCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3)),t=Math.floor(r.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!S.creditCardNumber(r))};S.dinersClubInt=S.dinersClubInternationalCard=S.dinersClubInternationalCardNumber;S.dinersClubUSACanadaCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e!==54&&e!==55||!S.creditCardNumber(r))};S.dinersClub=S.dinersClubUSACanCard=S.dinersClubUSACanadaCardNumber;S.discoverCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,6)),t=Math.floor(r.slice(0,3));return!(r.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&r.slice(0,2)!=="65"||!S.creditCardNumber(r))};S.discover=S.discoverCard=S.discoverCardNumber;S.instaPaymentCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,3));return!(e<637||e>639||!S.creditCardNumber(r))};S.instaPayment=S.instaPaymentCardNumber;S.jcbCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4));return!(e<3528||e>3589||!S.creditCardNumber(r))};S.jcb=S.jcbCard=S.jcbCardNumber;S.laserCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.laser=S.laserCard=S.laserCardNumber;S.maestroCardNumber=function(r){if(!S.str(r)||r.length<12||r.length>19)return!1;var e=r.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.maestro=S.maestroCard=S.maestroCardNumber;S.dankortCardNumber=function(r){return!(!S.str(r)||r.length!==16||r.slice(0,4)!=="5019"||!S.creditCardNumber(r))};S.dankort=S.dankortCard=S.dankortCardNumber;S.masterCardCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e<50||e>55||!S.creditCardNumber(r))};S.masterCard=S.masterCardCard=S.masterCardCardNumber;S.visaCardNumber=function(r){return!(!S.str(r)||r.length!==13&&r.length!==16||r.slice(0,1)!=="4"||!S.creditCardNumber(r))};S.visa=S.visaCard=S.visaCardNumber;S.visaElectronCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return r.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!S.creditCardNumber(r),!1};S.visaElectron=S.visaElectronCard=S.visaElectronCardNumber;var Mve=/^[0-9a-fA-F]{24}$/;S.mongoId=S.objectId=S.objId=function(r){return!!r&&!Array.isArray(r)&&Mve.test(String(r))};S.matching=S.match=S.inArgs=function(r){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var n=S.equal(r,arguments[t]);e=e||n}return e};S.streetAddress=function(r){if(!S.str(r))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(r)};S.street=S.address=S.streetAddress;S.zipCode=function(r){if(S.undefined(r)||!(S.string(r)||S.number(r)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(r)};S.zip=S.zipCode;S.phoneNumber=function(r){if(!S.string(r))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]‌​)\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-‌​9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(r)};S.phone=S.phoneNumber;var Ove=I4();S.url=function(r){return Ove(r)};S.uri=S.url;S.enumerator=function(r,e){var t=!1;if(!S.defined(r)||!S.defined(e)||!S.arrayLike(e))return t;for(var n=0,i=e.length;n<i;n++)if(S.equal(r,e[n])){t=!0;break}return t};S.enum=S.inArray=S.enumerator});var ZF=M((yrt,w4)=>{function Kve(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=mk(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null;function h(...g){if(!h.enabled)return;let y=h,x=Number(new Date),E=x-(p||x);y.diff=E,y.prev=p,y.curr=x,p=x,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let A=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(j,oe)=>{if(j==="%%")return"%";A++;let G=t.formatters[oe];if(typeof G=="function"){let ue=g[A];j=G.call(y,ue),g.splice(A,1),A--}return j}),t.formatArgs.call(y,g),(y.log||t.log).apply(y,g)}return h.namespace=u,h.useColors=t.useColors(),h.color=t.selectColor(u),h.extend=n,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>m===null?t.enabled(u):m,set:g=>{m=g}}),typeof t.init=="function"&&t.init(h),h}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}w4.exports=Kve});var E4=M((hs,sT)=>{hs.formatArgs=Lve;hs.save=Uve;hs.load=jve;hs.useColors=Fve;hs.storage=Wve();hs.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();hs.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Fve(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Lve(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+sT.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}hs.log=console.debug||console.log||(()=>{});function Uve(r){try{r?hs.storage.setItem("debug",r):hs.storage.removeItem("debug")}catch{}}function jve(){let r;try{r=hs.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Wve(){try{return localStorage}catch{}}sT.exports=ZF()(hs);var{formatters:Vve}=sT.exports;Vve.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var k4=M((xi,cT)=>{var Bve=require("tty"),aT=require("util");xi.init=Qve;xi.log=Hve;xi.formatArgs=Jve;xi.save=Gve;xi.load=zve;xi.useColors=qve;xi.destroy=aT.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");xi.colors=[6,2,3,4,5,1];try{let r=hk();r&&(r.stderr||r).level>=2&&(xi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}xi.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function qve(){return"colors"in xi.inspectOpts?!!xi.inspectOpts.colors:Bve.isatty(process.stderr.fd)}function Jve(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+cT.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=$ve()+e+" "+r[0]}function $ve(){return xi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Hve(...r){return process.stderr.write(aT.format(...r)+`
`)}function Gve(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function zve(){return process.env.DEBUG}function Qve(r){r.inspectOpts={};let e=Object.keys(xi.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=xi.inspectOpts[e[t]]}cT.exports=ZF()(xi);var{formatters:P4}=cT.exports;P4.o=function(r){return this.inspectOpts.colors=this.useColors,aT.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};P4.O=function(r){return this.inspectOpts.colors=this.useColors,aT.inspect(r,this.inspectOpts)}});var D4=M((brt,eL)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?eL.exports=E4():eL.exports=k4()});var O4=M(If=>{"use strict";If.check=N4;If.waitUntilFreeOnHost=Xve;If.waitUntilFree=Zve;If.waitUntilUsedOnHost=M4;If.waitUntilUsed=eye;If.waitForStatus=uT;var Va=C4(),Yve=require("net"),_4=require("util"),lT=D4()("tcp-port-used"),T4=2e3,R4=250;function A4(){var r,e,t=new Promise(function(n,i){r=n,e=i});return{resolve:r,reject:e,promise:t}}function Zy(r,e,t,n,i){var o={};return o.port=r,o.host=e,o.inUse=t,o.retryTimeMs=n,o.timeOutMs=i,o}function N4(r,e){var t=A4(),n=!0,i,o;if(Va.obj(r)?o=r:o=Zy(r,e),!Va.port(o.port))return lT("Error invalid port: "+_4.inspect(o.port)),t.reject(new Error("invalid port: "+_4.inspect(o.port))),t.promise;Va.nullOrUndefined(o.host)&&(lT("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(n),s()}function c(l){l.code!=="ECONNREFUSED"?t.reject(l):(n=!1,t.resolve(n)),s()}return i=new Yve.Socket,i.once("connect",a),i.once("error",c),i.connect({port:o.port,host:o.host},function(){}),t.promise}function uT(r,e,t,n,i){var o=A4(),s,a=!1,c,l;if(Va.obj(r)?l=r:l=Zy(r,e,t,n,i),!Va.bool(l.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;Va.positiveInt(l.retryTimeMs)||(l.retryTimeMs=R4,lT("set retryTime to default "+R4+"ms")),Va.positiveInt(l.timeOutMs)||(l.timeOutMs=T4,lT("set timeOutMs to default "+T4+"ms"));function u(){s&&clearTimeout(s),c&&clearTimeout(c)}function p(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(p,l.timeOutMs);function m(){N4(l.port,l.host).then(function(h){if(!a)if(h===l.inUse){o.resolve(),u();return}else{c=setTimeout(function(){m()},l.retryTimeMs);return}},function(h){a||(o.reject(h),u())})}return m(),o.promise}function Xve(r,e,t,n){var i;return Va.obj(r)?(i=r,i.inUse=!1):i=Zy(r,e,!1,t,n),uT(i)}function Zve(r,e,t){var n;return Va.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!1):n=Zy(r,"127.0.0.1",!1,e,t),uT(n)}function M4(r,e,t,n){var i;return Va.obj(r)?(i=r,i.inUse=!0):i=Zy(r,e,!0,t,n),uT(i)}function eye(r,e,t){var n;return Va.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!0):n=Zy(r,"127.0.0.1",!0,e,t),M4(n)}});var V4=M((pT,ml)=>{(function(r,e){typeof pT=="object"&&typeof ml<"u"?e(pT):typeof define=="function"&&define.amd?define(["exports"],e):e(r.async=r.async||{})})(pT,function(r){"use strict";function e(I,k){k=k|0;for(var R=Math.max(I.length-k,0),K=Array(R),Y=0;Y<R;Y++)K[Y]=I[k+Y];return K}var t=function(I){var k=e(arguments,1);return function(){var R=e(arguments);return I.apply(null,k.concat(R))}},n=function(I){return function(){var k=e(arguments),R=k.pop();I.call(this,k,R)}};function i(I){var k=typeof I;return I!=null&&(k=="object"||k=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(I){setTimeout(I,0)}function c(I){return function(k){var R=e(arguments,1);I(function(){k.apply(null,R)})}}var l;o?l=setImmediate:s?l=process.nextTick:l=a;var u=c(l);function p(I){return n(function(k,R){var K;try{K=I.apply(this,k)}catch(Y){return R(Y)}i(K)&&typeof K.then=="function"?K.then(function(Y){m(R,null,Y)},function(Y){m(R,Y.message?Y:new Error(Y))}):R(null,K)})}function m(I,k,R){try{I(k,R)}catch(K){u(h,K)}}function h(I){throw I}var g=typeof Symbol=="function";function y(I){return g&&I[Symbol.toStringTag]==="AsyncFunction"}function x(I){return y(I)?p(I):I}function E(I){return function(k){var R=e(arguments,1),K=n(function(Y,Q){var ce=this;return I(k,function(me,Te){x(me).apply(ce,Y.concat(Te))},Q)});return R.length?K.apply(this,R):K}}var A=typeof global=="object"&&global&&global.Object===Object&&global,T=typeof self=="object"&&self&&self.Object===Object&&self,j=A||T||Function("return this")(),oe=j.Symbol,G=Object.prototype,ue=G.hasOwnProperty,pe=G.toString,te=oe?oe.toStringTag:void 0;function Ce(I){var k=ue.call(I,te),R=I[te];try{I[te]=void 0;var K=!0}catch{}var Y=pe.call(I);return K&&(k?I[te]=R:delete I[te]),Y}var Le=Object.prototype,ct=Le.toString;function ft(I){return ct.call(I)}var rt="[object Null]",ae="[object Undefined]",ke=oe?oe.toStringTag:void 0;function X(I){return I==null?I===void 0?ae:rt:ke&&ke in Object(I)?Ce(I):ft(I)}var ye="[object AsyncFunction]",qe="[object Function]",hn="[object GeneratorFunction]",Pt="[object Proxy]";function Hr(I){if(!i(I))return!1;var k=X(I);return k==qe||k==hn||k==ye||k==Pt}var xs=9007199254740991;function Bt(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=xs}function nn(I){return I!=null&&Bt(I.length)&&!Hr(I)}var Gi={};function Mt(){}function ur(I){return function(){if(I!==null){var k=I;I=null,k.apply(this,arguments)}}}var si=typeof Symbol=="function"&&Symbol.iterator,Ml=function(I){return si&&I[si]&&I[si]()};function L(I,k){for(var R=-1,K=Array(I);++R<I;)K[R]=k(R);return K}function V(I){return I!=null&&typeof I=="object"}var be="[object Arguments]";function Oe(I){return V(I)&&X(I)==be}var nt=Object.prototype,on=nt.hasOwnProperty,Ht=nt.propertyIsEnumerable,Wt=Oe(function(){return arguments}())?Oe:function(I){return V(I)&&on.call(I,"callee")&&!Ht.call(I,"callee")},Ot=Array.isArray;function kr(){return!1}var Gr=typeof r=="object"&&r&&!r.nodeType&&r,Ar=Gr&&typeof ml=="object"&&ml&&!ml.nodeType&&ml,sn=Ar&&Ar.exports===Gr,H=sn?j.Buffer:void 0,ie=H?H.isBuffer:void 0,ge=ie||kr,Ee=9007199254740991,ze=/^(?:0|[1-9]\d*)$/;function an(I,k){var R=typeof I;return k=k??Ee,!!k&&(R=="number"||R!="symbol"&&ze.test(I))&&I>-1&&I%1==0&&I<k}var kt="[object Arguments]",Rt="[object Array]",it="[object Boolean]",jt="[object Date]",se="[object Error]",fe="[object Function]",q="[object Map]",J="[object Number]",re="[object Object]",De="[object RegExp]",Fe="[object Set]",dr="[object String]",Pi="[object WeakMap]",Ol="[object ArrayBuffer]",aR="[object DataView]",we="[object Float32Array]",uU="[object Float64Array]",pU="[object Int8Array]",dU="[object Int16Array]",mU="[object Int32Array]",fU="[object Uint8Array]",hU="[object Uint8ClampedArray]",gU="[object Uint16Array]",vU="[object Uint32Array]",Lr={};Lr[we]=Lr[uU]=Lr[pU]=Lr[dU]=Lr[mU]=Lr[fU]=Lr[hU]=Lr[gU]=Lr[vU]=!0,Lr[kt]=Lr[Rt]=Lr[Ol]=Lr[it]=Lr[aR]=Lr[jt]=Lr[se]=Lr[fe]=Lr[q]=Lr[J]=Lr[re]=Lr[De]=Lr[Fe]=Lr[dr]=Lr[Pi]=!1;function yU(I){return V(I)&&Bt(I.length)&&!!Lr[X(I)]}function bU(I){return function(k){return I(k)}}var cR=typeof r=="object"&&r&&!r.nodeType&&r,ah=cR&&typeof ml=="object"&&ml&&!ml.nodeType&&ml,IU=ah&&ah.exports===cR,Aw=IU&&A.process,lR=function(){try{var I=ah&&ah.require&&ah.require("util").types;return I||Aw&&Aw.binding&&Aw.binding("util")}catch{}}(),uR=lR&&lR.isTypedArray,SU=uR?bU(uR):yU,xU=Object.prototype,CU=xU.hasOwnProperty;function wU(I,k){var R=Ot(I),K=!R&&Wt(I),Y=!R&&!K&&ge(I),Q=!R&&!K&&!Y&&SU(I),ce=R||K||Y||Q,me=ce?L(I.length,String):[],Te=me.length;for(var tt in I)(k||CU.call(I,tt))&&!(ce&&(tt=="length"||Y&&(tt=="offset"||tt=="parent")||Q&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||an(tt,Te)))&&me.push(tt);return me}var EU=Object.prototype;function PU(I){var k=I&&I.constructor,R=typeof k=="function"&&k.prototype||EU;return I===R}function kU(I,k){return function(R){return I(k(R))}}var DU=kU(Object.keys,Object),_U=Object.prototype,TU=_U.hasOwnProperty;function RU(I){if(!PU(I))return DU(I);var k=[];for(var R in Object(I))TU.call(I,R)&&R!="constructor"&&k.push(R);return k}function Nw(I){return nn(I)?wU(I):RU(I)}function AU(I){var k=-1,R=I.length;return function(){return++k<R?{value:I[k],key:k}:null}}function NU(I){var k=-1;return function(){var K=I.next();return K.done?null:(k++,{value:K.value,key:k})}}function MU(I){var k=Nw(I),R=-1,K=k.length;return function Y(){var Q=k[++R];return Q==="__proto__"?Y():R<K?{value:I[Q],key:Q}:null}}function OU(I){if(nn(I))return AU(I);var k=Ml(I);return k?NU(k):MU(I)}function ya(I){return function(){if(I===null)throw new Error("Callback was already called.");var k=I;I=null,k.apply(this,arguments)}}function dS(I){return function(k,R,K){if(K=ur(K||Mt),I<=0||!k)return K(null);var Y=OU(k),Q=!1,ce=0,me=!1;function Te(Re,Ct){if(ce-=1,Re)Q=!0,K(Re);else{if(Ct===Gi||Q&&ce<=0)return Q=!0,K(null);me||tt()}}function tt(){for(me=!0;ce<I&&!Q;){var Re=Y();if(Re===null){Q=!0,ce<=0&&K(null);return}ce+=1,R(Re.value,Re.key,ya(Te))}me=!1}tt()}}function Gu(I,k,R,K){dS(k)(I,x(R),K)}function Qn(I,k){return function(R,K,Y){return I(R,k,K,Y)}}function KU(I,k,R){R=ur(R||Mt);var K=0,Y=0,Q=I.length;Q===0&&R(null);function ce(me,Te){me?R(me):(++Y===Q||Te===Gi)&&R(null)}for(;K<Q;K++)k(I[K],K,ya(ce))}var FU=Qn(Gu,1/0),Kl=function(I,k,R){var K=nn(I)?KU:FU;K(I,x(k),R)};function Zd(I){return function(k,R,K){return I(Kl,k,x(R),K)}}function pR(I,k,R,K){K=K||Mt,k=k||[];var Y=[],Q=0,ce=x(R);I(k,function(me,Te,tt){var Re=Q++;ce(me,function(Ct,zr){Y[Re]=zr,tt(Ct)})},function(me){K(me,Y)})}var mS=Zd(pR),dR=E(mS);function em(I){return function(k,R,K,Y){return I(dS(R),k,x(K),Y)}}var tm=em(pR),Mw=Qn(tm,1),mR=E(Mw);function fS(I,k){for(var R=-1,K=I==null?0:I.length;++R<K&&k(I[R],R,I)!==!1;);return I}function LU(I){return function(k,R,K){for(var Y=-1,Q=Object(k),ce=K(k),me=ce.length;me--;){var Te=ce[I?me:++Y];if(R(Q[Te],Te,Q)===!1)break}return k}}var UU=LU();function ch(I,k){return I&&UU(I,k,Nw)}function jU(I,k,R,K){for(var Y=I.length,Q=R+(K?1:-1);K?Q--:++Q<Y;)if(k(I[Q],Q,I))return Q;return-1}function WU(I){return I!==I}function VU(I,k,R){for(var K=R-1,Y=I.length;++K<Y;)if(I[K]===k)return K;return-1}function hS(I,k,R){return k===k?VU(I,k,R):jU(I,WU,R)}var Ow=function(I,k,R){typeof k=="function"&&(R=k,k=null),R=ur(R||Mt);var K=Nw(I),Y=K.length;if(!Y)return R(null);k||(k=Y);var Q={},ce=0,me=!1,Te=Object.create(null),tt=[],Re=[],Ct={};ch(I,function(Yr,cn){if(!Ot(Yr)){zr(cn,[Yr]),Re.push(cn);return}var Yn=Yr.slice(0,Yr.length-1),Ll=Yn.length;if(Ll===0){zr(cn,Yr),Re.push(cn);return}Ct[cn]=Ll,fS(Yn,function(gh){if(!I[gh])throw new Error("async.auto task `"+cn+"` has a non-existent dependency `"+gh+"` in "+Yn.join(", "));ec(gh,function(){Ll--,Ll===0&&zr(cn,Yr)})})}),JY(),ki();function zr(Yr,cn){tt.push(function(){tc(Yr,cn)})}function ki(){if(tt.length===0&&ce===0)return R(null,Q);for(;tt.length&&ce<k;){var Yr=tt.shift();Yr()}}function ec(Yr,cn){var Yn=Te[Yr];Yn||(Yn=Te[Yr]=[]),Yn.push(cn)}function ws(Yr){var cn=Te[Yr]||[];fS(cn,function(Yn){Yn()}),ki()}function tc(Yr,cn){if(!me){var Yn=ya(function(gh,cA){if(ce--,arguments.length>2&&(cA=e(arguments,1)),gh){var lA={};ch(Q,function(HY,GY){lA[GY]=HY}),lA[Yr]=cA,me=!0,Te=Object.create(null),R(gh,lA)}else Q[Yr]=cA,ws(Yr)});ce++;var Ll=x(cn[cn.length-1]);cn.length>1?Ll(Q,Yn):Ll(Yn)}}function JY(){for(var Yr,cn=0;Re.length;)Yr=Re.pop(),cn++,fS($Y(Yr),function(Yn){--Ct[Yn]===0&&Re.push(Yn)});if(cn!==Y)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function $Y(Yr){var cn=[];return ch(I,function(Yn,Ll){Ot(Yn)&&hS(Yn,Yr,0)>=0&&cn.push(Ll)}),cn}};function rm(I,k){for(var R=-1,K=I==null?0:I.length,Y=Array(K);++R<K;)Y[R]=k(I[R],R,I);return Y}var BU="[object Symbol]";function qU(I){return typeof I=="symbol"||V(I)&&X(I)==BU}var JU=1/0,fR=oe?oe.prototype:void 0,hR=fR?fR.toString:void 0;function Kw(I){if(typeof I=="string")return I;if(Ot(I))return rm(I,Kw)+"";if(qU(I))return hR?hR.call(I):"";var k=I+"";return k=="0"&&1/I==-JU?"-0":k}function $U(I,k,R){var K=-1,Y=I.length;k<0&&(k=-k>Y?0:Y+k),R=R>Y?Y:R,R<0&&(R+=Y),Y=k>R?0:R-k>>>0,k>>>=0;for(var Q=Array(Y);++K<Y;)Q[K]=I[K+k];return Q}function HU(I,k,R){var K=I.length;return R=R===void 0?K:R,!k&&R>=K?I:$U(I,k,R)}function GU(I,k){for(var R=I.length;R--&&hS(k,I[R],0)>-1;);return R}function zU(I,k){for(var R=-1,K=I.length;++R<K&&hS(k,I[R],0)>-1;);return R}function QU(I){return I.split("")}var YU="\\ud800-\\udfff",XU="\\u0300-\\u036f",ZU="\\ufe20-\\ufe2f",ej="\\u20d0-\\u20ff",tj=XU+ZU+ej,rj="\\ufe0e\\ufe0f",nj="\\u200d",ij=RegExp("["+nj+YU+tj+rj+"]");function oj(I){return ij.test(I)}var gR="\\ud800-\\udfff",sj="\\u0300-\\u036f",aj="\\ufe20-\\ufe2f",cj="\\u20d0-\\u20ff",lj=sj+aj+cj,uj="\\ufe0e\\ufe0f",pj="["+gR+"]",Fw="["+lj+"]",Lw="\\ud83c[\\udffb-\\udfff]",dj="(?:"+Fw+"|"+Lw+")",vR="[^"+gR+"]",yR="(?:\\ud83c[\\udde6-\\uddff]){2}",bR="[\\ud800-\\udbff][\\udc00-\\udfff]",mj="\\u200d",IR=dj+"?",SR="["+uj+"]?",fj="(?:"+mj+"(?:"+[vR,yR,bR].join("|")+")"+SR+IR+")*",hj=SR+IR+fj,gj="(?:"+[vR+Fw+"?",Fw,yR,bR,pj].join("|")+")",vj=RegExp(Lw+"(?="+Lw+")|"+gj+hj,"g");function yj(I){return I.match(vj)||[]}function xR(I){return oj(I)?yj(I):QU(I)}function bj(I){return I==null?"":Kw(I)}var Ij=/^\s+|\s+$/g;function Sj(I,k,R){if(I=bj(I),I&&(R||k===void 0))return I.replace(Ij,"");if(!I||!(k=Kw(k)))return I;var K=xR(I),Y=xR(k),Q=zU(K,Y),ce=GU(K,Y)+1;return HU(K,Q,ce).join("")}var xj=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,Cj=/,/,wj=/(=.+)?(\s*)$/,Ej=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function Pj(I){return I=I.toString().replace(Ej,""),I=I.match(xj)[2].replace(" ",""),I=I?I.split(Cj):[],I=I.map(function(k){return Sj(k.replace(wj,""))}),I}function CR(I,k){var R={};ch(I,function(K,Y){var Q,ce=y(K),me=!ce&&K.length===1||ce&&K.length===0;if(Ot(K))Q=K.slice(0,-1),K=K[K.length-1],R[Y]=Q.concat(Q.length>0?Te:K);else if(me)R[Y]=K;else{if(Q=Pj(K),K.length===0&&!ce&&Q.length===0)throw new Error("autoInject task functions require explicit parameters.");ce||Q.pop(),R[Y]=Q.concat(Te)}function Te(tt,Re){var Ct=rm(Q,function(zr){return tt[zr]});Ct.push(Re),x(K).apply(null,Ct)}}),Ow(R,k)}function Cs(){this.head=this.tail=null,this.length=0}function wR(I,k){I.length=1,I.head=I.tail=k}Cs.prototype.removeLink=function(I){return I.prev?I.prev.next=I.next:this.head=I.next,I.next?I.next.prev=I.prev:this.tail=I.prev,I.prev=I.next=null,this.length-=1,I},Cs.prototype.empty=function(){for(;this.head;)this.shift();return this},Cs.prototype.insertAfter=function(I,k){k.prev=I,k.next=I.next,I.next?I.next.prev=k:this.tail=k,I.next=k,this.length+=1},Cs.prototype.insertBefore=function(I,k){k.prev=I.prev,k.next=I,I.prev?I.prev.next=k:this.head=k,I.prev=k,this.length+=1},Cs.prototype.unshift=function(I){this.head?this.insertBefore(this.head,I):wR(this,I)},Cs.prototype.push=function(I){this.tail?this.insertAfter(this.tail,I):wR(this,I)},Cs.prototype.shift=function(){return this.head&&this.removeLink(this.head)},Cs.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},Cs.prototype.toArray=function(){for(var I=Array(this.length),k=this.head,R=0;R<this.length;R++)I[R]=k.data,k=k.next;return I},Cs.prototype.remove=function(I){for(var k=this.head;k;){var R=k.next;I(k)&&this.removeLink(k),k=R}return this};function ER(I,k,R){if(k==null)k=1;else if(k===0)throw new Error("Concurrency must not be zero");var K=x(I),Y=0,Q=[],ce=!1;function me(Ct,zr,ki){if(ki!=null&&typeof ki!="function")throw new Error("task callback must be a function");if(Re.started=!0,Ot(Ct)||(Ct=[Ct]),Ct.length===0&&Re.idle())return u(function(){Re.drain()});for(var ec=0,ws=Ct.length;ec<ws;ec++){var tc={data:Ct[ec],callback:ki||Mt};zr?Re._tasks.unshift(tc):Re._tasks.push(tc)}ce||(ce=!0,u(function(){ce=!1,Re.process()}))}function Te(Ct){return function(zr){Y-=1;for(var ki=0,ec=Ct.length;ki<ec;ki++){var ws=Ct[ki],tc=hS(Q,ws,0);tc===0?Q.shift():tc>0&&Q.splice(tc,1),ws.callback.apply(ws,arguments),zr!=null&&Re.error(zr,ws.data)}Y<=Re.concurrency-Re.buffer&&Re.unsaturated(),Re.idle()&&Re.drain(),Re.process()}}var tt=!1,Re={_tasks:new Cs,concurrency:k,payload:R,saturated:Mt,unsaturated:Mt,buffer:k/4,empty:Mt,drain:Mt,error:Mt,started:!1,paused:!1,push:function(Ct,zr){me(Ct,!1,zr)},kill:function(){Re.drain=Mt,Re._tasks.empty()},unshift:function(Ct,zr){me(Ct,!0,zr)},remove:function(Ct){Re._tasks.remove(Ct)},process:function(){if(!tt){for(tt=!0;!Re.paused&&Y<Re.concurrency&&Re._tasks.length;){var Ct=[],zr=[],ki=Re._tasks.length;Re.payload&&(ki=Math.min(ki,Re.payload));for(var ec=0;ec<ki;ec++){var ws=Re._tasks.shift();Ct.push(ws),Q.push(ws),zr.push(ws.data)}Y+=1,Re._tasks.length===0&&Re.empty(),Y===Re.concurrency&&Re.saturated();var tc=ya(Te(Ct));K(zr,tc)}tt=!1}},length:function(){return Re._tasks.length},running:function(){return Y},workersList:function(){return Q},idle:function(){return Re._tasks.length+Y===0},pause:function(){Re.paused=!0},resume:function(){Re.paused!==!1&&(Re.paused=!1,u(Re.process))}};return Re}function PR(I,k){return ER(I,1,k)}var nm=Qn(Gu,1);function Fl(I,k,R,K){K=ur(K||Mt);var Y=x(R);nm(I,function(Q,ce,me){Y(k,Q,function(Te,tt){k=tt,me(Te)})},function(Q){K(Q,k)})}function Uw(){var I=rm(arguments,x);return function(){var k=e(arguments),R=this,K=k[k.length-1];typeof K=="function"?k.pop():K=Mt,Fl(I,k,function(Y,Q,ce){Q.apply(R,Y.concat(function(me){var Te=e(arguments,1);ce(me,Te)}))},function(Y,Q){K.apply(R,[Y].concat(Q))})}}var kR=function(){return Uw.apply(null,e(arguments).reverse())},kj=Array.prototype.concat,gS=function(I,k,R,K){K=K||Mt;var Y=x(R);tm(I,k,function(Q,ce){Y(Q,function(me){return me?ce(me):ce(null,e(arguments,1))})},function(Q,ce){for(var me=[],Te=0;Te<ce.length;Te++)ce[Te]&&(me=kj.apply(me,ce[Te]));return K(Q,me)})},DR=Qn(gS,1/0),_R=Qn(gS,1),TR=function(){var I=e(arguments),k=[null].concat(I);return function(){var R=arguments[arguments.length-1];return R.apply(this,k)}};function lh(I){return I}function im(I,k){return function(R,K,Y,Q){Q=Q||Mt;var ce=!1,me;R(K,function(Te,tt,Re){Y(Te,function(Ct,zr){Ct?Re(Ct):I(zr)&&!me?(ce=!0,me=k(!0,Te),Re(null,Gi)):Re()})},function(Te){Te?Q(Te):Q(null,ce?me:k(!1))})}}function RR(I,k){return k}var vS=Zd(im(lh,RR)),uh=em(im(lh,RR)),yS=Qn(uh,1);function AR(I){return function(k){var R=e(arguments,1);R.push(function(K){var Y=e(arguments,1);typeof console=="object"&&(K?console.error&&console.error(K):console[I]&&fS(Y,function(Q){console[I](Q)}))}),x(k).apply(null,R)}}var NR=AR("dir");function MR(I,k,R){R=ya(R||Mt);var K=x(I),Y=x(k);function Q(me){if(me)return R(me);var Te=e(arguments,1);Te.push(ce),Y.apply(this,Te)}function ce(me,Te){if(me)return R(me);if(!Te)return R(null);K(Q)}ce(null,!0)}function jw(I,k,R){R=ya(R||Mt);var K=x(I),Y=function(Q){if(Q)return R(Q);var ce=e(arguments,1);if(k.apply(this,ce))return K(Y);R.apply(null,[null].concat(ce))};K(Y)}function OR(I,k,R){jw(I,function(){return!k.apply(this,arguments)},R)}function KR(I,k,R){R=ya(R||Mt);var K=x(k),Y=x(I);function Q(me){if(me)return R(me);Y(ce)}function ce(me,Te){if(me)return R(me);if(!Te)return R(null);K(Q)}Y(ce)}function FR(I){return function(k,R,K){return I(k,K)}}function bS(I,k,R){Kl(I,FR(x(k)),R)}function ph(I,k,R,K){dS(k)(I,FR(x(R)),K)}var dh=Qn(ph,1);function Ww(I){return y(I)?I:n(function(k,R){var K=!0;k.push(function(){var Y=arguments;K?u(function(){R.apply(null,Y)}):R.apply(null,Y)}),I.apply(this,k),K=!1})}function IS(I){return!I}var SS=Zd(im(IS,IS)),mh=em(im(IS,IS)),xS=Qn(mh,1);function LR(I){return function(k){return k?.[I]}}function Dj(I,k,R,K){var Y=new Array(k.length);I(k,function(Q,ce,me){R(Q,function(Te,tt){Y[ce]=!!tt,me(Te)})},function(Q){if(Q)return K(Q);for(var ce=[],me=0;me<k.length;me++)Y[me]&&ce.push(k[me]);K(null,ce)})}function _j(I,k,R,K){var Y=[];I(k,function(Q,ce,me){R(Q,function(Te,tt){Te?me(Te):(tt&&Y.push({index:ce,value:Q}),me())})},function(Q){Q?K(Q):K(null,rm(Y.sort(function(ce,me){return ce.index-me.index}),LR("value")))})}function Vw(I,k,R,K){var Y=nn(k)?Dj:_j;Y(I,k,x(R),K||Mt)}var CS=Zd(Vw),fh=em(Vw),wS=Qn(fh,1);function UR(I,k){var R=ya(k||Mt),K=x(Ww(I));function Y(Q){if(Q)return R(Q);K(Y)}Y()}var ES=function(I,k,R,K){K=K||Mt;var Y=x(R);tm(I,k,function(Q,ce){Y(Q,function(me,Te){return me?ce(me):ce(null,{key:Te,val:Q})})},function(Q,ce){for(var me={},Te=Object.prototype.hasOwnProperty,tt=0;tt<ce.length;tt++)if(ce[tt]){var Re=ce[tt].key,Ct=ce[tt].val;Te.call(me,Re)?me[Re].push(Ct):me[Re]=[Ct]}return K(Q,me)})},jR=Qn(ES,1/0),WR=Qn(ES,1),VR=AR("log");function PS(I,k,R,K){K=ur(K||Mt);var Y={},Q=x(R);Gu(I,k,function(ce,me,Te){Q(ce,me,function(tt,Re){if(tt)return Te(tt);Y[me]=Re,Te()})},function(ce){K(ce,Y)})}var BR=Qn(PS,1/0),qR=Qn(PS,1);function JR(I,k){return k in I}function $R(I,k){var R=Object.create(null),K=Object.create(null);k=k||lh;var Y=x(I),Q=n(function(me,Te){var tt=k.apply(null,me);JR(R,tt)?u(function(){Te.apply(null,R[tt])}):JR(K,tt)?K[tt].push(Te):(K[tt]=[Te],Y.apply(null,me.concat(function(){var Re=e(arguments);R[tt]=Re;var Ct=K[tt];delete K[tt];for(var zr=0,ki=Ct.length;zr<ki;zr++)Ct[zr].apply(null,Re)})))});return Q.memo=R,Q.unmemoized=I,Q}var kS;s?kS=process.nextTick:o?kS=setImmediate:kS=a;var HR=c(kS);function Bw(I,k,R){R=R||Mt;var K=nn(k)?[]:{};I(k,function(Y,Q,ce){x(Y)(function(me,Te){arguments.length>2&&(Te=e(arguments,1)),K[Q]=Te,ce(me)})},function(Y){R(Y,K)})}function GR(I,k){Bw(Kl,I,k)}function zR(I,k,R){Bw(dS(k),I,R)}var qw=function(I,k){var R=x(I);return ER(function(K,Y){R(K[0],Y)},k,1)},QR=function(I,k){var R=qw(I,k);return R.push=function(K,Y,Q){if(Q==null&&(Q=Mt),typeof Q!="function")throw new Error("task callback must be a function");if(R.started=!0,Ot(K)||(K=[K]),K.length===0)return u(function(){R.drain()});Y=Y||0;for(var ce=R._tasks.head;ce&&Y>=ce.priority;)ce=ce.next;for(var me=0,Te=K.length;me<Te;me++){var tt={data:K[me],priority:Y,callback:Q};ce?R._tasks.insertBefore(ce,tt):R._tasks.push(tt)}u(R.process)},delete R.unshift,R};function YR(I,k){if(k=ur(k||Mt),!Ot(I))return k(new TypeError("First argument to race must be an array of functions"));if(!I.length)return k();for(var R=0,K=I.length;R<K;R++)x(I[R])(k)}function DS(I,k,R,K){var Y=e(I).reverse();Fl(Y,k,R,K)}function _S(I){var k=x(I);return n(function(K,Y){return K.push(function(ce,me){if(ce)Y(null,{error:ce});else{var Te;arguments.length<=2?Te=me:Te=e(arguments,1),Y(null,{value:Te})}}),k.apply(this,K)})}function XR(I){var k;return Ot(I)?k=rm(I,_S):(k={},ch(I,function(R,K){k[K]=_S.call(this,R)})),k}function ZR(I,k,R,K){Vw(I,k,function(Y,Q){R(Y,function(ce,me){Q(ce,!me)})},K)}var eA=Zd(ZR),Jw=em(ZR),tA=Qn(Jw,1);function rA(I){return function(){return I}}function TS(I,k,R){var K=5,Y=0,Q={times:K,intervalFunc:rA(Y)};function ce(Re,Ct){if(typeof Ct=="object")Re.times=+Ct.times||K,Re.intervalFunc=typeof Ct.interval=="function"?Ct.interval:rA(+Ct.interval||Y),Re.errorFilter=Ct.errorFilter;else if(typeof Ct=="number"||typeof Ct=="string")Re.times=+Ct||K;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof I=="function"?(R=k||Mt,k=I):(ce(Q,I),R=R||Mt),typeof k!="function")throw new Error("Invalid arguments for async.retry");var me=x(k),Te=1;function tt(){me(function(Re){Re&&Te++<Q.times&&(typeof Q.errorFilter!="function"||Q.errorFilter(Re))?setTimeout(tt,Q.intervalFunc(Te)):R.apply(null,arguments)})}tt()}var nA=function(I,k){k||(k=I,I=null);var R=x(k);return n(function(K,Y){function Q(ce){R.apply(null,K.concat(ce))}I?TS(I,Q,Y):TS(Q,Y)})};function iA(I,k){Bw(nm,I,k)}var RS=Zd(im(Boolean,lh)),hh=em(im(Boolean,lh)),AS=Qn(hh,1);function oA(I,k,R){var K=x(k);mS(I,function(Q,ce){K(Q,function(me,Te){if(me)return ce(me);ce(null,{value:Q,criteria:Te})})},function(Q,ce){if(Q)return R(Q);R(null,rm(ce.sort(Y),LR("value")))});function Y(Q,ce){var me=Q.criteria,Te=ce.criteria;return me<Te?-1:me>Te?1:0}}function sA(I,k,R){var K=x(I);return n(function(Y,Q){var ce=!1,me;function Te(){var tt=I.name||"anonymous",Re=new Error('Callback function "'+tt+'" timed out.');Re.code="ETIMEDOUT",R&&(Re.info=R),ce=!0,Q(Re)}Y.push(function(){ce||(Q.apply(null,arguments),clearTimeout(me))}),me=setTimeout(Te,k),K.apply(null,Y)})}var Tj=Math.ceil,Rj=Math.max;function _(I,k,R,K){for(var Y=-1,Q=Rj(Tj((k-I)/(R||1)),0),ce=Array(Q);Q--;)ce[K?Q:++Y]=I,I+=R;return ce}function W(I,k,R,K){var Y=x(R);tm(_(0,I,1),k,Y,K)}var Ze=Qn(W,1/0),$w=Qn(W,1);function Aj(I,k,R,K){arguments.length<=3&&(K=R,R=k,k=Ot(I)?[]:{}),K=ur(K||Mt);var Y=x(R);Kl(I,function(Q,ce,me){Y(k,Q,ce,me)},function(Q){K(Q,k)})}function Nj(I,k){var R=null,K;k=k||Mt,dh(I,function(Y,Q){x(Y)(function(ce,me){arguments.length>2?K=e(arguments,1):K=me,R=ce,Q(!ce)})},function(){k(R,K)})}function Mj(I){return function(){return(I.unmemoized||I).apply(null,arguments)}}function aA(I,k,R){R=ya(R||Mt);var K=x(k);if(!I())return R(null);var Y=function(Q){if(Q)return R(Q);if(I())return K(Y);var ce=e(arguments,1);R.apply(null,[null].concat(ce))};K(Y)}function Oj(I,k,R){aA(function(){return!I.apply(this,arguments)},k,R)}var Kj=function(I,k){if(k=ur(k||Mt),!Ot(I))return k(new Error("First argument to waterfall must be an array of functions"));if(!I.length)return k();var R=0;function K(Q){var ce=x(I[R++]);Q.push(ya(Y)),ce.apply(null,Q)}function Y(Q){if(Q||R===I.length)return k.apply(null,arguments);K(e(arguments,1))}K([])},qY={apply:t,applyEach:dR,applyEachSeries:mR,asyncify:p,auto:Ow,autoInject:CR,cargo:PR,compose:kR,concat:DR,concatLimit:gS,concatSeries:_R,constant:TR,detect:vS,detectLimit:uh,detectSeries:yS,dir:NR,doDuring:MR,doUntil:OR,doWhilst:jw,during:KR,each:bS,eachLimit:ph,eachOf:Kl,eachOfLimit:Gu,eachOfSeries:nm,eachSeries:dh,ensureAsync:Ww,every:SS,everyLimit:mh,everySeries:xS,filter:CS,filterLimit:fh,filterSeries:wS,forever:UR,groupBy:jR,groupByLimit:ES,groupBySeries:WR,log:VR,map:mS,mapLimit:tm,mapSeries:Mw,mapValues:BR,mapValuesLimit:PS,mapValuesSeries:qR,memoize:$R,nextTick:HR,parallel:GR,parallelLimit:zR,priorityQueue:QR,queue:qw,race:YR,reduce:Fl,reduceRight:DS,reflect:_S,reflectAll:XR,reject:eA,rejectLimit:Jw,rejectSeries:tA,retry:TS,retryable:nA,seq:Uw,series:iA,setImmediate:u,some:RS,someLimit:hh,someSeries:AS,sortBy:oA,timeout:sA,times:Ze,timesLimit:W,timesSeries:$w,transform:Aj,tryEach:Nj,unmemoize:Mj,until:Oj,waterfall:Kj,whilst:aA,all:SS,allLimit:mh,allSeries:xS,any:RS,anyLimit:hh,anySeries:AS,find:vS,findLimit:uh,findSeries:yS,forEach:bS,forEachSeries:dh,forEachLimit:ph,forEachOf:Kl,forEachOfSeries:nm,forEachOfLimit:Gu,inject:Fl,foldl:Fl,foldr:DS,select:CS,selectLimit:fh,selectSeries:wS,wrapSync:p};r.default=qY,r.apply=t,r.applyEach=dR,r.applyEachSeries=mR,r.asyncify=p,r.auto=Ow,r.autoInject=CR,r.cargo=PR,r.compose=kR,r.concat=DR,r.concatLimit=gS,r.concatSeries=_R,r.constant=TR,r.detect=vS,r.detectLimit=uh,r.detectSeries=yS,r.dir=NR,r.doDuring=MR,r.doUntil=OR,r.doWhilst=jw,r.during=KR,r.each=bS,r.eachLimit=ph,r.eachOf=Kl,r.eachOfLimit=Gu,r.eachOfSeries=nm,r.eachSeries=dh,r.ensureAsync=Ww,r.every=SS,r.everyLimit=mh,r.everySeries=xS,r.filter=CS,r.filterLimit=fh,r.filterSeries=wS,r.forever=UR,r.groupBy=jR,r.groupByLimit=ES,r.groupBySeries=WR,r.log=VR,r.map=mS,r.mapLimit=tm,r.mapSeries=Mw,r.mapValues=BR,r.mapValuesLimit=PS,r.mapValuesSeries=qR,r.memoize=$R,r.nextTick=HR,r.parallel=GR,r.parallelLimit=zR,r.priorityQueue=QR,r.queue=qw,r.race=YR,r.reduce=Fl,r.reduceRight=DS,r.reflect=_S,r.reflectAll=XR,r.reject=eA,r.rejectLimit=Jw,r.rejectSeries=tA,r.retry=TS,r.retryable=nA,r.seq=Uw,r.series=iA,r.setImmediate=u,r.some=RS,r.someLimit=hh,r.someSeries=AS,r.sortBy=oA,r.timeout=sA,r.times=Ze,r.timesLimit=W,r.timesSeries=$w,r.transform=Aj,r.tryEach=Nj,r.unmemoize=Mj,r.until=Oj,r.waterfall=Kj,r.whilst=aA,r.all=SS,r.allLimit=mh,r.allSeries=xS,r.any=RS,r.anyLimit=hh,r.anySeries=AS,r.find=vS,r.findLimit=uh,r.findSeries=yS,r.forEach=bS,r.forEachSeries=dh,r.forEachLimit=ph,r.forEachOf=Kl,r.forEachOfSeries=nm,r.forEachOfLimit=Gu,r.inject=Fl,r.foldl=Fl,r.foldr=DS,r.select=CS,r.selectLimit=fh,r.selectSeries=wS,r.wrapSync=p,Object.defineProperty(r,"__esModule",{value:!0})})});var tL=M((zrt,B4)=>{"use strict";function tye(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=o,t.enabled=a,t.humanize=mk(),Object.keys(r).forEach(function(l){t[l]=r[l]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(l){for(var u=0,p=0;p<l.length;p++)u=(u<<5)-u+l.charCodeAt(p),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(l){var u;function p(){if(p.enabled){for(var m=arguments.length,h=new Array(m),g=0;g<m;g++)h[g]=arguments[g];var y=p,x=Number(new Date),E=x-(u||x);y.diff=E,y.prev=u,y.curr=x,u=x,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");var A=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(j,oe){if(j==="%%")return j;A++;var G=t.formatters[oe];if(typeof G=="function"){var ue=h[A];j=G.call(y,ue),h.splice(A,1),A--}return j}),t.formatArgs.call(y,h);var T=y.log||t.log;T.apply(y,h)}}return p.namespace=l,p.enabled=t.enabled(l),p.useColors=t.useColors(),p.color=e(l),p.destroy=n,p.extend=i,typeof t.init=="function"&&t.init(p),t.instances.push(p),p}function n(){var l=t.instances.indexOf(this);return l!==-1?(t.instances.splice(l,1),!0):!1}function i(l,u){return t(this.namespace+(typeof u>"u"?":":u)+l)}function o(l){t.save(l),t.names=[],t.skips=[];var u,p=(typeof l=="string"?l:"").split(/[\s,]+/),m=p.length;for(u=0;u<m;u++)p[u]&&(l=p[u].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.substr(1)+"$")):t.names.push(new RegExp("^"+l+"$")));for(u=0;u<t.instances.length;u++){var h=t.instances[u];h.enabled=t.enabled(h.namespace)}}function s(){t.enable("")}function a(l){if(l[l.length-1]==="*")return!0;var u,p;for(u=0,p=t.skips.length;u<p;u++)if(t.skips[u].test(l))return!1;for(u=0,p=t.names.length;u<p;u++)if(t.names[u].test(l))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}return t.enable(t.load()),t}B4.exports=tye});var q4=M((na,mT)=>{"use strict";function dT(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dT=function(t){return typeof t}:dT=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dT(r)}na.log=iye;na.formatArgs=nye;na.save=oye;na.load=sye;na.useColors=rye;na.storage=aye();na.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function rye(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function nye(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+mT.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;r.splice(1,0,e,"color: inherit");var t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}}function iye(){var r;return(typeof console>"u"?"undefined":dT(console))==="object"&&console.log&&(r=console).log.apply(r,arguments)}function oye(r){try{r?na.storage.setItem("debug",r):na.storage.removeItem("debug")}catch{}}function sye(){var r;try{r=na.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function aye(){try{return localStorage}catch{}}mT.exports=tL()(na);var cye=mT.exports.formatters;cye.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var $4=M((Ji,gT)=>{"use strict";var lye=require("tty"),hT=require("util");Ji.init=gye;Ji.log=mye;Ji.formatArgs=pye;Ji.save=fye;Ji.load=hye;Ji.useColors=uye;Ji.colors=[6,2,3,4,5,1];try{fT=hk(),fT&&(fT.stderr||fT).level>=2&&(Ji.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var fT;Ji.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function uye(){return"colors"in Ji.inspectOpts?!!Ji.inspectOpts.colors:lye.isatty(process.stderr.fd)}function pye(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o="  ".concat(i,";1m").concat(e," \x1B[0m");r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+gT.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=dye()+e+" "+r[0]}function dye(){return Ji.inspectOpts.hideDate?"":new Date().toISOString()+" "}function mye(){return process.stderr.write(hT.format.apply(hT,arguments)+`
`)}function fye(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function hye(){return process.env.DEBUG}function gye(r){r.inspectOpts={};for(var e=Object.keys(Ji.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=Ji.inspectOpts[e[t]]}gT.exports=tL()(Ji);var J4=gT.exports.formatters;J4.o=function(r){return this.inspectOpts.colors=this.useColors,hT.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};J4.O=function(r){return this.inspectOpts.colors=this.useColors,hT.inspect(r,this.inspectOpts)}});var H4=M((Qrt,rL)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?rL.exports=q4():rL.exports=$4()});var Y4=M((Yrt,Q4)=>{var qC=require("path"),G4=require("fs"),z4=parseInt("0777",8);Q4.exports=nb.mkdirp=nb.mkdirP=nb;function nb(r,e,t,n){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||G4;i===void 0&&(i=z4),n||(n=null);var s=t||function(){};r=qC.resolve(r),o.mkdir(r,i,function(a){if(!a)return n=n||r,s(null,n);switch(a.code){case"ENOENT":if(qC.dirname(r)===r)return s(a);nb(qC.dirname(r),e,function(c,l){c?s(c,l):nb(r,e,s,l)});break;default:o.stat(r,function(c,l){c||!l.isDirectory()?s(a,n):s(null,n)});break}})}nb.sync=function r(e,t,n){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||G4;i===void 0&&(i=z4),n||(n=null),e=qC.resolve(e);try{o.mkdirSync(e,i),n=n||e}catch(a){switch(a.code){case"ENOENT":n=r(qC.dirname(e),t,n),r(e,t,n);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return n}});var eG=M(Pr=>{"use strict";var X4=require("fs"),vye=require("os"),yye=require("net"),vT=require("path"),Z4=V4(),oL=H4(),bye=Y4().mkdirp,nL=oL("portfinder:testPort"),JC=oL("portfinder:getPort"),Iye=oL("portfinder:defaultHosts"),iL={};iL.testPort=function(r,e){e||(e=r,r={}),r.server=r.server||yye.createServer(function(){}),nL("entered testPort(): trying",r.host,"port",r.port);function t(){nL("done w/ testPort(): OK",r.host,"port",r.port),r.server.removeListener("error",n),r.server.close(),e(null,r.port)}function n(i){if(nL("done w/ testPort(): failed",r.host,"w/ port",r.port,"with error",i.code),r.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Pr.nextPort(r.port);if(o>Pr.highestPort)return e(new Error("No open ports available"));iL.testPort({port:o,host:r.host,server:r.server},e)}r.server.once("error",n),r.server.once("listening",t),r.host?r.server.listen(r.port,r.host):r.server.listen(r.port)};Pr.basePort=8e3;Pr.highestPort=65535;Pr.basePath="/tmp/portfinder";Pr.getPort=function(r,e){if(e||(e=r,r={}),r.port=Number(r.port)||Number(Pr.basePort),r.host=r.host||null,r.stopPort=Number(r.stopPort)||Number(Pr.highestPort),!r.startPort){if(r.startPort=Number(r.port),r.startPort<0)throw Error("Provided options.startPort("+r.startPort+") is less than 0, which are cannot be bound.");if(r.stopPort<r.startPort)throw Error("Provided options.stopPort("+r.stopPort+"is less than options.startPort ("+r.startPort+")")}if(r.host){for(var t,n=0;n<Pr._defaultHosts.length;n++)if(Pr._defaultHosts[n]===r.host){t=!0;break}t||Pr._defaultHosts.push(r.host)}var i=[],o;return Z4.eachSeries(Pr._defaultHosts,function(s,a){return JC("in eachSeries() iteration callback: host is",s),iL.testPort({host:s,port:r.port},function(c,l){return c?(JC("in eachSeries() iteration callback testPort() callback","with an err:",c.code),o=s,a(c)):(JC("in eachSeries() iteration callback testPort() callback","with a success for port",l),i.push(l),a())})},function(s){if(s)if(JC("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(r.host===o){var a="Provided host "+r.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var c=Pr._defaultHosts.indexOf(o);return Pr._defaultHosts.splice(c,1),Pr.getPort(r,e)}else return e(s);if(i.sort(function(l,u){return l-u}),JC("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=r.stopPort)return e(null,i[0]);var a="No open ports found in between "+r.startPort+" and "+r.stopPort;return e(Error(a))}else return Pr.getPort({port:i.pop(),host:r.host,startPort:r.startPort,stopPort:r.stopPort},e)})};Pr.getPortPromise=function(r){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return r||(r={}),new Promise(function(e,t){Pr.getPort(r,function(n,i){if(n)return t(n);e(i)})})};Pr.getPorts=function(r,e,t){t||(t=e,e={});var n=null;Z4.timesSeries(r,function(i,o){n&&(e.port=Pr.nextPort(n)),Pr.getPort(e,function(s,a){s?o(s):(n=a,o(null,a))})},t)};Pr.getSocket=function(r,e){e||(e=r,r={}),r.mod=r.mod||parseInt(755,8),r.path=r.path||Pr.basePath+".sock";function t(){X4.stat(r.path,function(o){o?o.code=="ENOENT"?e(null,r.path):e(o):(r.path=Pr.nextSocket(r.path),Pr.getSocket(r,e))})}function n(o){bye(o,r.mod,function(s){if(s)return e(s);r.exists=!0,t()})}function i(){var o=vT.dirname(r.path);X4.stat(o,function(s,a){if(s||!a.isDirectory())return n(o);r.exists=!0,t()})}return r.exists?t():i()};Pr.nextPort=function(r){return r+1};Pr.nextSocket=function(r){var e=vT.dirname(r),t=vT.basename(r,".sock"),n=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(n[2]),o=n[1];return isNaN(i)&&(i=0),i+=1,vT.join(e,o+i+".sock")};Pr._defaultHosts=function(){var r={};try{r=vye.networkInterfaces()}catch(c){if(c.syscall!=="uv_interface_addresses")throw c}for(var e=Object.keys(r),t="0.0.0.0",n=[t],i=0;i<e.length;i++)for(var o=r[e[i]],s=0;s<o.length;s++){var a=o[s];n.push(a.address)}return n.push(null),Iye("exports._defaultHosts is: %o",n),n}()});var aG=M(ib=>{"use strict";Object.defineProperty(ib,"__esModule",{value:!0});ib.encode=ib.decode=void 0;var iG=require("crypto"),aL="<IDS|MSG>",Sye=5;function ST(r){return JSON.parse(r.toString())}function oG(r){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},r)}function sG(r){let e=r;switch(r){case"hmac-sha256":e="sha256";break}return e}function xye(r,e,t="sha256"){var n=0;let i=[];for(n=0;n<r.length;n++){var o=r[n];if(o.toString()===aL)break;i.push(o)}if(r.length-n<Sye)throw new Error("Message Decoding: Not enough message frames");if(r[n].toString()!==aL)throw new Error("Message Decoding: Missing delimiter");if(e){let u=sG(t);var s=r[n+1].toString(),a=iG.createHmac(u,e);a.update(r[n+2]),a.update(r[n+3]),a.update(r[n+4]),a.update(r[n+5]);var c=a.digest("hex");if(c!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${c}"`)}var l=oG({idents:i,header:ST(r[n+2]),parent_header:ST(r[n+3]),content:ST(r[n+5]),metadata:ST(r[n+4]),buffers:Array.prototype.slice.apply(r,[n+6])});return l}ib.decode=xye;function Cye(r,e,t="sha256"){let n=oG(r),i=sG(t),o=n.idents,s=Buffer.from(JSON.stringify(n.header),"utf-8"),a=Buffer.from(JSON.stringify(n.parent_header),"utf-8"),c=Buffer.from(JSON.stringify(n.metadata),"utf-8"),l=Buffer.from(JSON.stringify(n.content),"utf-8"),u="";if(e){let m=iG.createHmac(i,e);m.update(s),m.update(a),m.update(c),m.update(l),u=m.digest("hex")}var p=o.concat([Buffer.from(aL),Buffer.from(u),s,a,c,l]).concat(n.buffers);return p}ib.encode=Cye});var vG=M((vot,gG)=>{"use strict";gG.exports=({onlyFirst:r=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")}});var zG=M((jmt,GG)=>{"use strict";var Qye=(r,e={})=>{let t=e.safe===!0||e.keepProtected===!0,n=!1,i=(o,s)=>{let a="",c,l;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&n===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){c=i(u,o),l=c.split(`
`),a+=`
`.repeat(l.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}n=!0;break;case"line":if(e.first&&n===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),n=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(r)};GG.exports=Qye});var YG=M((Wmt,QG)=>{"use strict";var r0=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},vL=class extends r0{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};QG.exports={Node:r0,Block:vL}});var ZG=M(XG=>{"use strict";XG.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var rz=M((Bmt,tz)=>{"use strict";var{Node:Pd,Block:ez}=YG(),Yye=ZG(),yL={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},Xye=(r,e={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");let t=new ez({type:"root",nodes:[]}),n=[t],i=(e.language||"javascript").toLowerCase(),o=Yye[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:c}=o,l=t,u=r,p,m,h=[a,c].filter(Boolean),g=!1;h.every(T=>T.source==='^"""')&&(g=!0);let y=(T=u[0]||"")=>(u=u.slice(T.length),T),x=(T,j="text")=>{let oe=T.exec(u);if(oe)return y(oe[0]),{type:j,value:oe[0],match:oe}},E=T=>{if(m&&m.type==="text"&&T.type==="text"){m.value+=T.value;return}l.push(T),T.nodes&&(n.push(T),l=T),m=T},A=()=>{if(l.type==="root")throw new SyntaxError("Unclosed block comment");n.pop(),l=n[n.length-1]};for(;u!=="";){if(p=x(yL.ESCAPED_CHAR_REGEX,"text")){E(new Pd(p));continue}if(l.type!=="block"&&(!m||!/\w$/.test(m.value))&&!(g&&u.startsWith('"""'))&&(p=x(yL.QUOTED_STRING_REGEX,"text"))){E(new Pd(p));continue}if(p=x(yL.NEWLINE_REGEX,"newline")){E(new Pd(p));continue}if(a&&e.block&&!(g&&l.type==="block")&&(p=x(a,"open"))){E(new ez({type:"block"})),E(new Pd(p));continue}if(c&&l.type==="block"&&e.block&&(p=x(c,"close"))){p.newline=p.match[1]||"",E(new Pd(p)),A();continue}if(s&&l.type!=="block"&&e.line&&(p=x(s,"line"))){E(new Pd(p));continue}if(p=x(/^[a-zABD-Z0-9\t ]+/,"text")){E(new Pd(p));continue}E(new Pd({type:"text",value:y(u[0])}))}return t};tz.exports=Xye});var iz=M((qmt,nz)=>{"use strict";var n0=zG(),QC=rz(),i0=nz.exports=(r,e)=>{let t={...e,block:!0,line:!0};return n0(QC(r,t),t)};i0.block=(r,e)=>{let t={...e,block:!0};return n0(QC(r,t),t)};i0.line=(r,e)=>{let t={...e,line:!0};return n0(QC(r,t),t)};i0.first=(r,e)=>{let t={...e,block:!0,line:!0,first:!0};return n0(QC(r,t),t)};i0.parse=QC});var $z=M((n0t,Jz)=>{var Pbe=typeof global=="object"&&global&&global.Object===Object&&global;Jz.exports=Pbe});var Gz=M((i0t,Hz)=>{var kbe=$z(),Dbe=typeof self=="object"&&self&&self.Object===Object&&self,_be=kbe||Dbe||Function("return this")();Hz.exports=_be});var X0=M((o0t,zz)=>{var Tbe=Gz(),Rbe=Tbe.Symbol;zz.exports=Rbe});var Yz=M((s0t,Qz)=>{function Abe(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}Qz.exports=Abe});var Zz=M((a0t,Xz)=>{var Nbe=Array.isArray;Xz.exports=Nbe});var nQ=M((c0t,rQ)=>{var eQ=X0(),tQ=Object.prototype,Mbe=tQ.hasOwnProperty,Obe=tQ.toString,fw=eQ?eQ.toStringTag:void 0;function Kbe(r){var e=Mbe.call(r,fw),t=r[fw];try{r[fw]=void 0;var n=!0}catch{}var i=Obe.call(r);return n&&(e?r[fw]=t:delete r[fw]),i}rQ.exports=Kbe});var oQ=M((l0t,iQ)=>{var Fbe=Object.prototype,Lbe=Fbe.toString;function Ube(r){return Lbe.call(r)}iQ.exports=Ube});var lQ=M((u0t,cQ)=>{var sQ=X0(),jbe=nQ(),Wbe=oQ(),Vbe="[object Null]",Bbe="[object Undefined]",aQ=sQ?sQ.toStringTag:void 0;function qbe(r){return r==null?r===void 0?Bbe:Vbe:aQ&&aQ in Object(r)?jbe(r):Wbe(r)}cQ.exports=qbe});var pQ=M((p0t,uQ)=>{function Jbe(r){return r!=null&&typeof r=="object"}uQ.exports=Jbe});var mQ=M((d0t,dQ)=>{var $be=lQ(),Hbe=pQ(),Gbe="[object Symbol]";function zbe(r){return typeof r=="symbol"||Hbe(r)&&$be(r)==Gbe}dQ.exports=zbe});var bQ=M((m0t,yQ)=>{var fQ=X0(),Qbe=Yz(),Ybe=Zz(),Xbe=mQ(),Zbe=1/0,hQ=fQ?fQ.prototype:void 0,gQ=hQ?hQ.toString:void 0;function vQ(r){if(typeof r=="string")return r;if(Ybe(r))return Qbe(r,vQ)+"";if(Xbe(r))return gQ?gQ.call(r):"";var e=r+"";return e=="0"&&1/r==-Zbe?"-0":e}yQ.exports=vQ});var SQ=M((f0t,IQ)=>{var eIe=bQ();function tIe(r){return r==null?"":eIe(r)}IQ.exports=tIe});var wQ=M((h0t,CQ)=>{var rIe=SQ(),xQ=/[\\^$.*+?()[\]{}|]/g,nIe=RegExp(xQ.source);function iIe(r){return r=rIe(r),r&&nIe.test(r)?r.replace(xQ,"\\$&"):r}CQ.exports=iIe});var nU=M((n3t,EY)=>{EY.exports=require("util").format});var fSe={};Lj(fSe,{activate:()=>sSe,deactivate:()=>aSe});module.exports=jj(fSe);Reflect.metadata===void 0&&Vj();function vh(){try{return(qj(),jj(Bj)).isPreRelesVersionOfJupyterExtension===!0}catch{return!0}}var MS={isExiting:!1},Hw="_builtin.JupyterServerSelectorForTesting",uA="_builtin.jupyterServerUrlProvider";var Jj=!1;function $j(r){Jj=r}function om(){return Jj}var Hj=!1;function Gj(r){Hj=r}function ln(){return Hj}var xe="python",OS="markdown",Ul="vscode-notebook-cell",tX={scheme:"untitled",language:xe},rX={scheme:"file",language:xe},Gw={language:xe},nX={scheme:Ul,language:xe},zj=[tX,rX,nX],zw="vscode-interactive-input",_t="jupyter-notebook",xt="interactive";var rc="GitHub.codespaces",Je="ms-toolsai.jupyter",Qj="ms-toolsai.vscode-jupyter-powertoys",yh="ms-toolsai.jupyter-hub",Yj="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",zu="STANDARD_OUTPUT_CHANNEL",KS;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(KS||={});var ai;(o=>(o.JupyterServerRemoteLaunchNameSeparator=`
`,o.JupyterServerRemoteLaunchService=Je,o.JupyterServerUriListMax=10,o.IntellisenseTimeout=2e3,o.IntellisenseResolveTimeout=5e3))(ai||={});var ci=!1;var iX=!1;function Nr(){return iX||FS()}var oX=!1;function FS(){return oX}var Qe;(y=>(y.GeneratedThemeName="ipython-theme",y.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",y.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",y.DefaultCodeCellMarker="# %%",y.DefaultCommTarget="jupyter.widget",y.ALL_VARIABLES="ALL_VARIABLES",y.KERNEL_VARIABLES="KERNEL_VARIABLES",y.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",y.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",y.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",y.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",y.REMOTE_URI="https://remote/",y.REMOTE_URI_ID_PARAM="id",y.REMOTE_URI_HANDLE_PARAM="uriHandle",y.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Qe||={});var bh;(n=>(n.ImportIPython=`{0}
from IPython import get_ipython

{1}`,n.MatplotLibInit=`import matplotlib
%matplotlib inline
${Qe.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,n.DisableJedi="%config Completer.use_jedi = False"))(bh||={});var Ih="JUPYTER_OUTPUT_CHANNEL",pA="Default Light+",li="ms-python.python",Sh="ms-toolsai.jupyter-renderers",sm="ms-python.vscode-pylance",Xj=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],Zj=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),LS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var $;(we=>(we.RunAllCells="jupyter.runallcells",we.RunAllCellsAbove="jupyter.runallcellsabove",we.RunCellAndAllBelow="jupyter.runcellandallbelow",we.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",we.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",we.RunToLine="jupyter.runtoline",we.RunFromLine="jupyter.runfromline",we.RunCell="jupyter.runcell",we.RunCurrentCell="jupyter.runcurrentcell",we.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",we.CreateNewInteractive="jupyter.createnewinteractive",we.ImportNotebook="jupyter.importnotebook",we.ImportNotebookFile="jupyter.importnotebookfile",we.ExportFileAsNotebook="jupyter.exportfileasnotebook",we.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",we.InterruptKernel="jupyter.interruptkernel",we.RestartKernel="jupyter.restartkernel",we.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",we.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",we.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",we.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",we.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",we.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",we.ExpandAllCells="jupyter.expandallcells",we.CollapseAllCells="jupyter.collapseallcells",we.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",we.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",we.RunFileInInteractiveWindows="jupyter.runFileInteractive",we.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",we.AddCellBelow="jupyter.addcellbelow",we.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",we.DebugCell="jupyter.debugcell",we.DebugStepOver="jupyter.debugstepover",we.DebugContinue="jupyter.debugcontinue",we.DebugStop="jupyter.debugstop",we.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",we.InsertCellBelowPosition="jupyter.insertCellBelowPosition",we.InsertCellBelow="jupyter.insertCellBelow",we.InsertCellAbove="jupyter.insertCellAbove",we.DeleteCells="jupyter.deleteCells",we.SelectCell="jupyter.selectCell",we.SelectCellContents="jupyter.selectCellContents",we.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",we.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",we.MoveCellsUp="jupyter.moveCellsUp",we.MoveCellsDown="jupyter.moveCellsDown",we.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",we.ChangeCellToCode="jupyter.changeCellToCode",we.GotoNextCellInFile="jupyter.gotoNextCellInFile",we.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",we.ScrollToCell="jupyter.scrolltocell",we.CreateNewNotebook="jupyter.createnewnotebook",we.ViewJupyterOutput="jupyter.viewOutput",we.ExportAsPythonScript="jupyter.exportAsPythonScript",we.ExportToHTML="jupyter.exportToHTML",we.ExportToPDF="jupyter.exportToPDF",we.Export="jupyter.export",we.NativeNotebookExport="jupyter.notebookeditor.export",we.LatestExtension="jupyter.latestExtension",we.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",we.EnableDebugLogging="jupyter.enableDebugLogging",we.ResetLoggingLevel="jupyter.resetLoggingLevel",we.ShowDataViewer="jupyter.showDataViewer",we.RefreshDataViewer="jupyter.refreshDataViewer",we.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",we.OpenVariableView="jupyter.openVariableView",we.OpenOutlineView="jupyter.openOutlineView",we.InteractiveClearAll="jupyter.interactive.clearAllCells",we.InteractiveGoToCode="jupyter.interactive.goToCode",we.InteractiveCopyCell="jupyter.interactive.copyCell",we.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",we.InteractiveExportAs="jupyter.interactive.exportas",we.RunByLine="jupyter.runByLine",we.RunAndDebugCell="jupyter.runAndDebugCell",we.RunByLineNext="jupyter.runByLineNext",we.RunByLineStop="jupyter.runByLineStop",we.ReplayPylanceLog="jupyter.replayPylanceLog",we.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",we.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",we.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",we.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))($||={});var Qu;(n=>(n.DefaultDesignLenses=[$.RunCurrentCell,$.RunAllCellsAbove,$.DebugCell],n.DefaultDebuggingLenses=[$.DebugContinue,$.DebugStop,$.DebugStepOver],n.DebuggerCommands=[$.DebugContinue,$.DebugStop,$.DebugStepOver]))(Qu||={});var Sr;(pe=>(pe.HasCodeCells="jupyter.hascodecells",pe.IsInteractiveActive="jupyter.isinteractiveactive",pe.OwnsSelection="jupyter.ownsSelection",pe.HaveNativeCells="jupyter.havenativecells",pe.HaveNative="jupyter.havenative",pe.IsNativeActive="jupyter.isnativeactive",pe.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",pe.IsPythonOrNativeActive="jupyter.ispythonornativeactive",pe.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",pe.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",pe.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",pe.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",pe.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",pe.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",pe.RunByLineCells="jupyter.notebookeditor.runByLineCells",pe.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",pe.DebugDocuments="jupyter.notebookeditor.debugDocuments",pe.IsPythonNotebook="jupyter.ispythonnotebook",pe.IsJupyterKernelSelected="jupyter.kernel.isjupyter",pe.IsDataViewerActive="jupyter.dataViewerActive",pe.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",pe.ZmqAvailable="jupyter.zmqavailable",pe.ReplayLogLoaded="jupyter.replayLogLoaded",pe.KernelSource="jupyter.kernelSource"))(Sr||={});var am;(c=>(c.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,c.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,c.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",c.HttpPattern=/https?:\/\//,c.ShapeSplitterRegEx=/.*,\s*(\d+).*/,c.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,c.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,c.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(am||={});var e2=Symbol("DataScienceStartupTime"),US={major:4,minor:2},zi="application/vnd.jupyter.widget-view+json";var jS=7,xh="unknown";var VS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},WS=new Map;function t2(){return WS}function r2(r,e){let t=e.map(n=>`${JSON.stringify(n)}`).join("-Arg-Separator-");return`KeyPrefix=${r}-Args=${t}`}var cm=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=WS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?WS.get(this.cacheKey)?.data:void 0}set data(e){let t=new VS(this.expiryDurationMs,e);WS.set(this.cacheKey,t)}clear(){WS.delete(this.cacheKey)}};var n2=Symbol("MicrotaskDelay");async function Di(r){return new Promise(e=>{setTimeout(()=>e(r),r)})}async function Yw(r,e,t){return new Promise(n=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{r().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),n(a)}})}function xr(r,e,...t){let n=Qw(e)?void 0:e;Qw(e)&&t.push(e);let i,o=setTimeout(()=>i?.(n),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function wh(r,e,...t){let n,i=setTimeout(()=>n?.(e),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>n=s)])}function lm(r){return typeof r?.then=="function"&&typeof r?.catch=="function"}function Qw(r){return typeof r?.then=="function"}var dA=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function le(r=null){return new dA(r)}function Es(r){let e=le();return r.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var Ch=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=le(),n=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await n,t.promise}chainFinally(e){let t=le();return this.currentPromise=this.currentPromise.finally(()=>e().then(n=>t.resolve(n)).catch(n=>t.reject(n))),t.promise}};var sX=(r,e)=>{let t=!0,n=setTimeout(()=>{t=!1,e()},r);return{isTriggered:()=>t,dispose:()=>{clearTimeout(n),t=!1}}},aX=r=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,r())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},nc=class{constructor(e){this.defaultDelay=e;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,t=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}));let n=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=t===n2?aX(n):sX(t,n),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new Error("Canceled")),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}};var Ge=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};function f(){}function Wn(r){try{let e=r();lm(e)&&e.catch(f)}catch{}}function mA(r,e,t){let n=new Ge;try{t&&r(void 0);let i=e();return lm(i)?i.then(o=>(r({elapsed:n.elapsedTime,returnValue:o}),o)).catch(o=>{r({elapsed:n.elapsedTime,err:o})}):r({elapsed:n.elapsedTime,returnValue:i}),i}catch(i){throw r({elapsed:n.elapsedTime,err:i}),i}}function Yu(r){if(!r)return!0;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function Cn(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function o2(r){let e=Cn(r)?r:r.uri;return e.scheme.includes(Ul)||e.path.endsWith(".interactive")}function Xu(){return process.platform.toString()==="web"}function i2(r,e){return Cn(e)?e.toString():e}function ba(r,e){return r===e?!0:r&&!e||!r&&e?!1:JSON.stringify(r,i2)===JSON.stringify(e,i2)}var s2=t2();function fA(r){return function(e,t,n){let i=n.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;n.value=async function(...a){if(Nr())return i.apply(this,a);let c=r2(s,a),l=s2.get(c);if(l&&!l.expired)return P(`Cached data exists ${c}`),Promise.resolve(l.data);let u=i.apply(this,a);return u.then(p=>s2.set(c,new VS(r,p))).catch(f),u}}}function Ur(r){return function(e,t,n){let i=n.value,o=`Jupyter Extension (Error in ${r||t}, method:${t}):`;n.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(c=>{Nr()||C(o,c)})}catch(a){if(Nr())return;C(o,a)}}}}function a2(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:n,target:t},c=this;return mA(l=>r(a,l),()=>o.apply(c,s),e)},i}}function Eh(){return function(r,e,t){let n=t.value;return t.value=function(...i){if(!Nr())throw new Error(`Function: ${e} can only be called from test code`);return n.apply(this,i)},t}}function hA(){return function(r,e,t){let n=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>n.apply(this,o)):s=n.apply(this,o),this[i]=s;let a=s.then(c=>c).catch(c=>{throw this[i]=void 0,c});return a.catch(f),a},t}}function gA(r,e){if(Array.isArray(r))return r.map(t=>gA(t,e)).join(", ");if(r===void 0)return"undefined";if(r===null)return"null";try{return r&&r.path?`<Uri:${r.path}>`:JSON.stringify(r)}catch{return`<${e} cannot be serialized for logging>`}}function vA(r){if(!r)return"";try{return r.map((t,n)=>{let i=gA(t,"argument");return`Arg ${n+1}: ${i}`}).join(", ")}catch{return""}}function c2(r){return`Return Value: ${gA(r,"Return value")}`}function Xw(){let r=new Date,e=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0"),n=String(r.getSeconds()).padStart(2,"0"),i=String(r.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${n}.${i}`}function We(r,e={removeEmptyEntries:!0,trim:!0}){r=r||"";let t=r.split(/\r?\n/g);return e&&e.trim&&(t=t.map(n=>n.trim())),e&&e.removeEmptyEntries&&(t=t.filter(n=>n.length>0)),t}function BS(r){return r&&(r.indexOf(" ")>=0&&!r.startsWith('"')&&!r.endsWith('"')?`"${r}"`:r.toString())}function qS(r){return r&&BS(r).replace(/\\/g,"/")}function um(r){return r&&r.replace(/(^['"])|(['"]$)/g,"")}function Ph(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}function kh(r){return r?r.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():r||""}function Dh(r){let e=r.split(`
`),t=e.find(n=>n.trim().length>0&&!n.trim().startsWith("#"));if(t){let n=t.match(/^\s*/)[0];return e.map(i=>i.startsWith(n)?i.replace(n,""):i).join(`
`)}return r}var PA=require("vscode");var eE="en",rE=!1,nE=!1,JS=!1,cX=!1,lX=!1,bA=!1,uX=!1,pX=!1,dX=!1,Zw,tE=eE,mX,ep,Ps=typeof self=="object"?self:typeof global=="object"?global:{},po;typeof Ps.vscode<"u"&&typeof Ps.vscode.process<"u"?po=Ps.vscode.process:typeof process<"u"&&(po=process);var l2=typeof po?.versions?.electron=="string",u2=l2&&po?.type==="renderer",USe=u2&&po?.sandboxed;if(typeof navigator=="object"&&!u2)ep=navigator.userAgent,rE=ep.indexOf("Windows")>=0,nE=ep.indexOf("Macintosh")>=0,pX=(ep.indexOf("Macintosh")>=0||ep.indexOf("iPad")>=0||ep.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,JS=ep.indexOf("Linux")>=0,bA=!0,Zw=navigator.language,tE=Zw;else if(typeof po=="object"){rE=po.platform==="win32",nE=po.platform==="darwin",JS=po.platform==="linux",cX=JS&&!!po.env.SNAP&&!!po.env.SNAP_REVISION,uX=l2,dX=!!po.env.CI||!!po.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Zw=eE,tE=eE;let r=po.env.VSCODE_NLS_CONFIG;if(r)try{let e=JSON.parse(r),t=e.availableLanguages["*"];Zw=e.locale,tE=t||eE,mX=e._translationsConfigFile}catch{}lX=!0}else console.error("Unable to resolve platform.");var yA=0;nE?yA=1:rE?yA=3:JS&&(yA=2);var $S=rE,p2=nE,d2=JS;var iE=bA,jSe=bA&&typeof Ps.importScripts=="function";var ic=ep,Zu=tE,fX;(n=>{function r(){return Zu}n.value=r;function e(){return Zu.length===2?Zu==="en":Zu.length>=3?Zu[0]==="e"&&Zu[1]==="n"&&Zu[2]==="-":!1}n.isDefaultVariant=e;function t(){return Zu==="en"}n.isDefault=t})(fX||={});var WSe=(()=>{if(typeof Ps.postMessage=="function"&&!Ps.importScripts){let r=[];Ps.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let n=0,i=r.length;n<i;n++){let o=r[n];if(o.id===t.data.vscodeScheduleAsyncWork){r.splice(n,1),o.callback();return}}});let e=0;return t=>{let n=++e;r.push({id:n,callback:t}),Ps.postMessage({vscodeScheduleAsyncWork:n},"*")}}return r=>setTimeout(r)})();var hX=!!(ic&&ic.indexOf("Chrome")>=0),VSe=!!(ic&&ic.indexOf("Firefox")>=0),BSe=!!(!hX&&ic&&ic.indexOf("Safari")>=0),qSe=!!(ic&&ic.indexOf("Edg/")>=0),JSe=!!(ic&&ic.indexOf("Android")>=0);var pm;if(typeof Ps.vscode<"u"&&typeof Ps.vscode.process<"u"){let r=Ps.vscode.process;pm={get platform(){return r.platform},get arch(){return r.arch},get env(){return r.env},cwd(){return r.cwd()}}}else typeof process<"u"?pm={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:pm={get platform(){return $S?"win32":p2?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var oE=pm.cwd,m2=pm.env,mo=pm.platform,zSe=pm.arch;var vX=65,yX=97,bX=90,IX=122,np=46,Xn=47,fo=92,tp=58,SX=63,sE=class extends Error{constructor(t,n,i){let o;typeof n=="string"&&n.indexOf("not ")===0?(o="must not be",n=n.replace(/^not /,"")):o="must be";let s=t.indexOf(".")!==-1?"property":"argument",a=`The "${t}" ${s} ${o} of type ${n}`;a+=`. Received type ${typeof i}`;super(a);this.code="ERR_INVALID_ARG_TYPE"}};function gn(r,e){if(typeof r!="string")throw new sE(e,"string",r)}function Kt(r){return r===Xn||r===fo}function IA(r){return r===Xn}function rp(r){return r>=vX&&r<=bX||r>=yX&&r<=IX}function aE(r,e,t,n){let i="",o=0,s=-1,a=0,c=0;for(let l=0;l<=r.length;++l){if(l<r.length)c=r.charCodeAt(l);else{if(n(c))break;c=Xn}if(n(c)){if(!(s===l-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==np||i.charCodeAt(i.length-2)!==np){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=l,a=0;continue}else if(i.length!==0){i="",o=0,s=l,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${r.slice(s+1,l)}`:i=r.slice(s+1,l),o=l-s-1;s=l,a=0}else c===np&&a!==-1?++a:a=-1}return i}function f2(r,e){if(e===null||typeof e!="object")throw new sE("pathObject","Object",e);let t=e.dir||e.root,n=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${n}`:`${t}${r}${n}`:n}var Tn={resolve(...r){let e="",t="",n=!1;for(let i=r.length-1;i>=-1;i--){let o;if(i>=0){if(o=r[i],gn(o,"path"),o.length===0)continue}else e.length===0?o=oE():(o=m2[`=${e}`]||oE(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===fo)&&(o=`${e}\\`));let s=o.length,a=0,c="",l=!1,u=o.charCodeAt(0);if(s===1)Kt(u)&&(a=1,l=!0);else if(Kt(u))if(l=!0,Kt(o.charCodeAt(1))){let p=2,m=p;for(;p<s&&!Kt(o.charCodeAt(p));)p++;if(p<s&&p!==m){let h=o.slice(m,p);for(m=p;p<s&&Kt(o.charCodeAt(p));)p++;if(p<s&&p!==m){for(m=p;p<s&&!Kt(o.charCodeAt(p));)p++;(p===s||p!==m)&&(c=`\\\\${h}\\${o.slice(m,p)}`,a=p)}}}else a=1;else rp(u)&&o.charCodeAt(1)===tp&&(c=o.slice(0,2),a=2,s>2&&Kt(o.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(e.length>0){if(c.toLowerCase()!==e.toLowerCase())continue}else e=c;if(n){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,n=l,l&&e.length>0)break}return t=aE(t,!n,"\\",Kt),n?`${e}\\${t}`:`${e}${t}`||"."},normalize(r){gn(r,"path");let e=r.length;if(e===0)return".";let t=0,n,i=!1,o=r.charCodeAt(0);if(e===1)return IA(o)?"\\":r;if(Kt(o))if(i=!0,Kt(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){let l=r.slice(c,a);for(c=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return`\\\\${l}\\${r.slice(c)}\\`;a!==c&&(n=`\\\\${l}\\${r.slice(c,a)}`,t=a)}}}else t=1;else rp(o)&&r.charCodeAt(1)===tp&&(n=r.slice(0,2),t=2,e>2&&Kt(r.charCodeAt(2))&&(i=!0,t=3));let s=t<e?aE(r.slice(t),!i,"\\",Kt):"";return s.length===0&&!i&&(s="."),s.length>0&&Kt(r.charCodeAt(e-1))&&(s+="\\"),n===void 0?i?`\\${s}`:s:i?`${n}\\${s}`:`${n}${s}`},isAbsolute(r){gn(r,"path");let e=r.length;if(e===0)return!1;let t=r.charCodeAt(0);return Kt(t)||e>2&&rp(t)&&r.charCodeAt(1)===tp&&Kt(r.charCodeAt(2))},join(...r){if(r.length===0)return".";let e,t;for(let o=0;o<r.length;++o){let s=r[o];gn(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let n=!0,i=0;if(typeof t=="string"&&Kt(t.charCodeAt(0))){++i;let o=t.length;o>1&&Kt(t.charCodeAt(1))&&(++i,o>2&&(Kt(t.charCodeAt(2))?++i:n=!1))}if(n){for(;i<e.length&&Kt(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return Tn.normalize(e)},relative(r,e){if(gn(r,"from"),gn(e,"to"),r===e)return"";let t=Tn.resolve(r),n=Tn.resolve(e);if(t===n||(r=t.toLowerCase(),e=n.toLowerCase(),r===e))return"";let i=0;for(;i<r.length&&r.charCodeAt(i)===fo;)i++;let o=r.length;for(;o-1>i&&r.charCodeAt(o-1)===fo;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===fo;)a++;let c=e.length;for(;c-1>a&&e.charCodeAt(c-1)===fo;)c--;let l=c-a,u=s<l?s:l,p=-1,m=0;for(;m<u;m++){let g=r.charCodeAt(i+m);if(g!==e.charCodeAt(a+m))break;g===fo&&(p=m)}if(m!==u){if(p===-1)return n}else{if(l>u){if(e.charCodeAt(a+m)===fo)return n.slice(a+m+1);if(m===2)return n.slice(a+m)}s>u&&(r.charCodeAt(i+m)===fo?p=m:m===2&&(p=3)),p===-1&&(p=0)}let h="";for(m=i+p+1;m<=o;++m)(m===o||r.charCodeAt(m)===fo)&&(h+=h.length===0?"..":"\\..");return a+=p,h.length>0?`${h}${n.slice(a,c)}`:(n.charCodeAt(a)===fo&&++a,n.slice(a,c))},toNamespacedPath(r){if(typeof r!="string")return r;if(r.length===0)return"";let e=Tn.resolve(r);if(e.length<=2)return r;if(e.charCodeAt(0)===fo){if(e.charCodeAt(1)===fo){let t=e.charCodeAt(2);if(t!==SX&&t!==np)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(rp(e.charCodeAt(0))&&e.charCodeAt(1)===tp&&e.charCodeAt(2)===fo)return`\\\\?\\${e}`;return r},dirname(r){gn(r,"path");let e=r.length;if(e===0)return".";let t=-1,n=0,i=r.charCodeAt(0);if(e===1)return Kt(i)?r:".";if(Kt(i)){if(t=n=1,Kt(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return r;a!==c&&(t=n=a+1)}}}}else rp(i)&&r.charCodeAt(1)===tp&&(t=e>2&&Kt(r.charCodeAt(2))?3:2,n=t);let o=-1,s=!0;for(let a=e-1;a>=n;--a)if(Kt(r.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return r.slice(0,o)},basename(r,e){e!==void 0&&gn(e,"ext"),gn(r,"path");let t=0,n=-1,i=!0,o;if(r.length>=2&&rp(r.charCodeAt(0))&&r.charCodeAt(1)===tp&&(t=2),e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=t;--o){let c=r.charCodeAt(o);if(Kt(c)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=t;--o)if(Kt(r.charCodeAt(o))){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){gn(r,"path");let e=0,t=-1,n=0,i=-1,o=!0,s=0;r.length>=2&&r.charCodeAt(1)===tp&&rp(r.charCodeAt(0))&&(e=n=2);for(let a=r.length-1;a>=e;--a){let c=r.charCodeAt(a);if(Kt(c)){if(!o){n=a+1;break}continue}i===-1&&(o=!1,i=a+1),c===np?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===n+1?"":r.slice(t,i)},format:f2.bind(null,"\\"),parse(r){gn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.length,n=0,i=r.charCodeAt(0);if(t===1)return Kt(i)?(e.root=e.dir=r,e):(e.base=e.name=r,e);if(Kt(i)){if(n=1,Kt(r.charCodeAt(1))){let p=2,m=p;for(;p<t&&!Kt(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&Kt(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&!Kt(r.charCodeAt(p));)p++;p===t?n=p:p!==m&&(n=p+1)}}}}else if(rp(i)&&r.charCodeAt(1)===tp){if(t<=2)return e.root=e.dir=r,e;if(n=2,Kt(r.charCodeAt(2))){if(t===3)return e.root=e.dir=r,e;n=3}}n>0&&(e.root=r.slice(0,n));let o=-1,s=n,a=-1,c=!0,l=r.length-1,u=0;for(;l>=n;--l){if(i=r.charCodeAt(l),Kt(i)){if(!c){s=l+1;break}continue}a===-1&&(c=!1,a=l+1),i===np?o===-1?o=l:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=r.slice(s,a):(e.name=r.slice(s,o),e.base=r.slice(s,a),e.ext=r.slice(o,a))),s>0&&s!==n?e.dir=r.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Cr={resolve(...r){let e="",t=!1;for(let n=r.length-1;n>=-1&&!t;n--){let i=n>=0?r[n]:oE();gn(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===Xn)}return e=aE(e,!t,"/",IA),t?`/${e}`:e.length>0?e:"."},normalize(r){if(gn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===Xn,t=r.charCodeAt(r.length-1)===Xn;return r=aE(r,!e,"/",IA),r.length===0?e?"/":t?"./":".":(t&&(r+="/"),e?`/${r}`:r)},isAbsolute(r){return gn(r,"path"),r.length>0&&r.charCodeAt(0)===Xn},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){let n=r[t];gn(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":Cr.normalize(e)},relative(r,e){if(gn(r,"from"),gn(e,"to"),r===e||(r=Cr.resolve(r),e=Cr.resolve(e),r===e))return"";let t=1,n=r.length,i=n-t,o=1,s=e.length-o,a=i<s?i:s,c=-1,l=0;for(;l<a;l++){let p=r.charCodeAt(t+l);if(p!==e.charCodeAt(o+l))break;p===Xn&&(c=l)}if(l===a)if(s>a){if(e.charCodeAt(o+l)===Xn)return e.slice(o+l+1);if(l===0)return e.slice(o+l)}else i>a&&(r.charCodeAt(t+l)===Xn?c=l:l===0&&(c=0));let u="";for(l=t+c+1;l<=n;++l)(l===n||r.charCodeAt(l)===Xn)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+c)}`},toNamespacedPath(r){return r},dirname(r){if(gn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===Xn,t=-1,n=!0;for(let i=r.length-1;i>=1;--i)if(r.charCodeAt(i)===Xn){if(!n){t=i;break}}else n=!1;return t===-1?e?"/":".":e&&t===1?"//":r.slice(0,t)},basename(r,e){e!==void 0&&gn(e,"ext"),gn(r,"path");let t=0,n=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=0;--o){let c=r.charCodeAt(o);if(c===Xn){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===Xn){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){gn(r,"path");let e=-1,t=0,n=-1,i=!0,o=0;for(let s=r.length-1;s>=0;--s){let a=r.charCodeAt(s);if(a===Xn){if(!i){t=s+1;break}continue}n===-1&&(i=!1,n=s+1),a===np?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||n===-1||o===0||o===1&&e===n-1&&e===t+1?"":r.slice(e,n)},format:f2.bind(null,"/"),parse(r){gn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.charCodeAt(0)===Xn,n;t?(e.root="/",n=1):n=0;let i=-1,o=0,s=-1,a=!0,c=r.length-1,l=0;for(;c>=n;--c){let u=r.charCodeAt(c);if(u===Xn){if(!a){o=c+1;break}continue}s===-1&&(a=!1,s=c+1),u===np?i===-1?i=c:l!==1&&(l=1):i!==-1&&(l=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||l===0||l===1&&i===s-1&&i===o+1?e.base=e.name=r.slice(u,s):(e.name=r.slice(u,i),e.base=r.slice(u,s),e.ext=r.slice(i,s))}return o>0?e.dir=r.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Cr.win32=Tn.win32=Tn;Cr.posix=Tn.posix=Cr;var wn=mo==="win32"?Tn.normalize:Cr.normalize,cE=mo==="win32"?Tn.isAbsolute:Cr.isAbsolute,Ve=mo==="win32"?Tn.join:Cr.join,h2=mo==="win32"?Tn.resolve:Cr.resolve,lE=mo==="win32"?Tn.relative:Cr.relative,dt=mo==="win32"?Tn.dirname:Cr.dirname,_e=mo==="win32"?Tn.basename:Cr.basename,Qi=mo==="win32"?Tn.extname:Cr.extname,QSe=mo==="win32"?Tn.format:Cr.format,g2=mo==="win32"?Tn.parse:Cr.parse,YSe=mo==="win32"?Tn.toNamespacedPath:Cr.toNamespacedPath,Vn=mo==="win32"?Tn.sep:Cr.sep,Zn=mo==="win32"?Tn.delimiter:Cr.delimiter;var GS=require("vscode");var xX=require("vscode");var uE=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var HS=class r{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new r(()=>e(this.getValue()))}};function S2(r,e){return r<e?-1:r>e?1:0}function CX(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c<l)return-1;if(c>l)return 1}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function x2(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c===l)continue;if(c>=128||l>=128)return CX(r.toLowerCase(),e.toLowerCase(),t,n,i,o);v2(c)&&(c-=32),v2(l)&&(l-=32);let u=c-l;if(u!==0)return u}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function v2(r){return r>=97&&r<=122}function C2(r,e){return r.length===e.length&&x2(r,e)===0}function w2(r,e){let t=e.length;return e.length>r.length?!1:x2(r,e,0,t)===0}var y2=class r{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new HS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new uE(e=>{function t(u){let p=new Map;for(let m=0;m<u.length;m+=2)p.set(u[m],u[m+1]);return p}function n(u,p){let m=new Map(u);for(let[h,g]of p)m.set(h,g);return m}function i(u,p){if(!u)return p;let m=new Map;for(let[h,g]of u)p.has(h)&&m.set(h,g);return m}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let p=t(o[u]);a=i(a,p)}let c=t(o._common),l=n(c,a);return new r(l)})}static getInstance(e){return r.cache.get(Array.from(e))}static{this._locales=new HS(()=>Object.keys(r.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return r._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},b2=class r{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(r.getRawData())),this._data}static isInvisibleCharacter(e){return r.getData().has(e)}static get codePoints(){return r.getData()}};function ip(r){return r===47||r===92}function SA(r){return r.replace(/[\\/]/g,Cr.sep)}function E2(r){return r.indexOf("/")===-1&&(r=SA(r)),/^[a-zA-Z]:(\/|$)/.test(r)&&(r="/"+r),r}function xA(r,e=Cr.sep){if(!r)return"";let t=r.length,n=r.charCodeAt(0);if(ip(n)){if(ip(r.charCodeAt(1))&&!ip(r.charCodeAt(2))){let o=3,s=o;for(;o<t&&!ip(r.charCodeAt(o));o++);if(s!==o&&!ip(r.charCodeAt(o+1))){for(o+=1;o<t;o++)if(ip(r.charCodeAt(o)))return r.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(wX(n)&&r.charCodeAt(1)===58)return ip(r.charCodeAt(2))?r.slice(0,2)+e:r.slice(0,2);let i=r.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(ip(r.charCodeAt(i)))return r.slice(0,i+1)}return""}function CA(r,e,t,n=Vn){if(r===e)return!0;if(!r||!e||e.length>r.length)return!1;if(t){if(!w2(r,e))return!1;if(e.length===r.length)return!0;let o=e.length;return e.charAt(e.length-1)===n&&o--,r.charAt(o)===n}return e.charAt(e.length-1)!==n&&(e+=n),r.indexOf(e)===0}function wX(r){return r>=65&&r<=90||r>=97&&r<=122}var oc;(ae=>(ae.inMemory="inmemory",ae.vscode="vscode",ae.internal="private",ae.walkThrough="walkThrough",ae.walkThroughSnippet="walkThroughSnippet",ae.http="http",ae.https="https",ae.file="file",ae.mailto="mailto",ae.untitled="untitled",ae.data="data",ae.command="command",ae.vscodeRemote="vscode-remote",ae.vscodeRemoteResource="vscode-remote-resource",ae.vscodeUserData="vscode-userdata",ae.vscodeCustomEditor="vscode-custom-editor",ae.vscodeNotebook="vscode-notebook",ae.vscodeNotebookCell="vscode-notebook-cell",ae.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",ae.vscodeNotebookCellOutput="vscode-notebook-cell-output",ae.vscodeInteractive="vscode-interactive",ae.vscodeInteractiveInput="vscode-interactive-input",ae.vscodeSettings="vscode-settings",ae.vscodeWorkspaceTrust="vscode-workspace-trust",ae.vscodeTerminal="vscode-terminal",ae.webviewPanel="webview-panel",ae.vscodeWebview="vscode-webview",ae.extension="extension",ae.vscodeFileResource="vscode-file",ae.tmp="tmp",ae.vsls="vsls"))(oc||={});function Ia(r){return iE?r?.path||"":r?.fsPath||""}var zS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,n=!1){return e===t?0:S2(this.getComparisonKey(e,n),this.getComparisonKey(t,n))}isEqual(e,t,n=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,n)===this.getComparisonKey(t,n)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,n=!1,i=$S?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===oc.file)return CA(Ia(e),Ia(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(n||e.fragment===t.fragment);if(P2(e.authority,t.authority))return CA(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(n||e.fragment===t.fragment)}return!1}joinPath(e,...t){return GS.Uri.joinPath(e,...t)}basenameOrAuthority(e){return yn(e)||e.authority}basename(e,t){return Cr.basename(e.path,t)}extname(e){return Cr.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===oc.file?t=GS.Uri.file(dt(Ia(e))).path:(t=Cr.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===oc.file?t=GS.Uri.file(wn(Ia(e))).path:t=Cr.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!P2(e.authority,t.authority))return;if(e.scheme===oc.file){let o=lE(Ia(e),Ia(t));return $S?SA(o):o}let n=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(n.length,i.length);o<s&&!(n.charCodeAt(o)!==i.charCodeAt(o)&&n.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return Cr.relative(n,i)}resolvePath(e,t){if(e.scheme===oc.file){let n=GS.Uri.file(h2(Ia(e),t));return e.with({authority:n.authority,path:n.path})}return t=E2(t),e.with({path:Cr.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&C2(e,t)}hasTrailingPathSeparator(e,t=Vn){if(e.scheme===oc.file){let n=Ia(e);return n.length>xA(n).length&&n[n.length-1]===t}else{let n=e.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=Vn){return k2(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=Vn){let n=!1;if(e.scheme===oc.file){let i=Ia(e);n=i!==void 0&&i.length===xA(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;n=i.length===1&&i.charCodeAt(i.length-1)===47}return!n&&!k2(e,t)?e.with({path:e.path+"/"}):e}},nr=new zS(()=>!1),hxe=new zS(r=>r.scheme===oc.file?!d2:!0),gxe=new zS(r=>!0),_i=nr.isEqual.bind(nr),_h=nr.isEqualOrParent.bind(nr),vn=nr.getComparisonKey.bind(nr),vxe=nr.basenameOrAuthority.bind(nr),yn=nr.basename.bind(nr),op=nr.extname.bind(nr),Ti=nr.dirname.bind(nr),ir=nr.joinPath.bind(nr),yxe=nr.normalizePath.bind(nr),wA=nr.relativePath.bind(nr),bxe=nr.resolvePath.bind(nr),Ixe=nr.isAbsolutePath.bind(nr),P2=nr.isEqualAuthority.bind(nr),k2=nr.hasTrailingPathSeparator.bind(nr),Sxe=nr.removeTrailingPathSeparator.bind(nr),xxe=nr.addTrailingPathSeparator.bind(nr),PX;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[p,m]=u.split(":");p&&m&&a.set(p,m)});let l=s.path.substring(0,s.path.indexOf(";"));return l&&a.set(o.META_DATA_MIME,l),a}o.parseMetaData=i})(PX||={});function jr(r=process.platform){return/^win/.test(r)?"Windows":/^darwin/.test(r)?"OSX":/^linux/.test(r)?"Linux":"Unknown"}function Th(r,e){return r.replace(/^~(?=$|\/|\\)/,e)}function kX(){if(!Xu())return PA.Uri.file(require("os").homedir())}function Ae(r){let e=jr()==="Windows";if(r){let t=Ia(r);return t&&t.startsWith(Vn)&&t.length>1&&t[1]!==Vn&&e?t.slice(1):t||""}return""}function B(r,e=[],t){t=t||kX();let n;typeof r=="string"&&(n=PA.Uri.file(r)),typeof r!="string"&&(n=r);let i=EA(n,void 0,t),o=e.find(c=>n&&_h(n,c.uri,!0));if(e.length>1&&o)return`${o.name}${Vn}${EA(n,o.uri,t)}`;let s=o?[EA(n,o.uri,t)]:[],a=i;return[i,...s].forEach(c=>{c.length<a.length&&(a=c)}),a}function EA(r,e,t){let n=jr()==="Windows";if(r&&e&&_h(r,e,!0)){let i=wA(e,r);if(i)return n?i.replace(/\//g,"\\"):i}if(r&&t&&_h(r,t,!0)){let i=wA(t,r);if(i)return i=n?i.replace(/\//g,"\\"):i,`~${Vn}${i}`}return Ae(r)}var dE="",D2=3,dm=[];function mE(r){return dm.push(r),{dispose:()=>{dm=dm.filter(e=>e!==r)}}}var _X=new Map([["error",40],["warn",30],["info",20],["debug",10],["none",100],["off",100],[void 0,40]]),Ah=10;function DA(r){Ah=typeof r=="number"?r:_X.get(r)??40}function _2(r){dE=r.toLowerCase()}function T2(...r){return Ah<=5?r:r.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let n=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(n.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&n.push(`Interpreter Id = ${B(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=We(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?n.push(o[0]):o.length>1&&s?.length?n.push(s):n.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>n.push(`${o} = ${String(t[o]).trim()}`)),n.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function C(r,...e){Ah<=40&&(e=T2(...e),dm.forEach(t=>t.traceError(r,...e)))}function U(r,...e){Ah<=30&&(e=T2(...e),dm.forEach(t=>t.traceWarn(r,...e)))}function ee(r,...e){Ah<=20&&dm.forEach(t=>t.traceInfo(r,...e))}function P(r,...e){Ah<=5&&dm.forEach(t=>t.traceVerbose(r,...e))}function ne(r,...e){if(ci)if(typeof r=="function"){let n=r(),i="",o=[];typeof n=="string"?i=n:(i=n.shift(),o=n),ee(i,...o)}else ee(r,...e)}function ui(r,e=D2){return R2({message:r,opts:e,level:5})}function Nh(r){return R2({message:r,opts:D2,level:40})}var jl=new WeakMap;function Wl(r){return(e,t,n)=>{jl.has(e)||jl.set(e,new Map);let i=jl.get(e);i||jl.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:n,propertyOfParameterToLog:r})}}function sp(){return(r,e,t)=>{jl.has(r)||jl.set(r,new Map);let n=jl.get(r);n||jl.set(r,n=new Map),n.has(e)||n.set(e,[]),n.get(e).push({parameterIndex:t,ignore:!0})}}function R2(r){return a2((e,t)=>MX(r,t,e),(r.opts&4)>0)}function TX(r){let{kind:e,name:t,args:n}=r;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),n||(n=[]),{kind:e,name:t,args:n,methodName:r.methodName||"",target:r.target||void 0}}function RX(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function kA(r){let e=dE?r.toLowerCase().indexOf(dE):-1;return e===-1?r:`~${r.substring(e+dE.length)}`}function AX(r,e,t,n){if(RX(t))return kA(t.path);if(!t)return t;let o=jl.get(r)?.get(e)?.find(a=>a.parameterIndex===n);if(!o)return typeof t=="string"?kA(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?kA(s):s}function NX(r,e,t){t=TX(t);let n=[r.message];return n.push(`${t.kind} name = ${t.name}`.trim()),e?(n.push(`completed in ${e.elapsed}ms`),n.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):n[n.length-1]=`${n[n.length-1]} (started execution)`,(r.opts&1)===1&&(r.level===5?n.push(vA(t.args.map((i,o)=>t?AX(t.target,t.methodName,i,o):i))):n.push(vA(t.args))),e&&(r.opts&2)===2&&n.push(c2(e.returnValue)),n.join(", ")}function MX(r,e,t){let n=NX(r,e,t);e?e.err===void 0?r.level&&r.level===40||(r.level?pE(r.level,n):pE(20,n)):pE(40,n,e.err):r.level&&r.level!==40&&pE(r.level,n)}function pE(r,e,...t){switch(r){case 40:C(e,...t);break;case 30:U(e,...t);break;case 20:ee(e,...t);break;case 10:P(e,...t);break;case 5:P(e,...t);break;default:break}}var va=require("vscode");var sM=require("vscode");var A2=Symbol("IsDevMode"),$o=Symbol("IOutputChannel"),N2=Symbol("IS_WINDOWS"),F=Symbol("IDisposableRegistry"),$e=Symbol("IGlobalMemento"),gt=Symbol("IGlobalMemento"),pi=Symbol("IWorkspaceMemento");var sc=Symbol("IPersistentStateFactory"),Wxe=Symbol("IRandom"),de=Symbol("IConfigurationService"),lt=Symbol("ExtensionContext"),Sa=Symbol("IExtensions"),M2=Symbol("IJupyterExtensionBanner"),fE=Symbol("IFeaturesManager"),Mh=Symbol("ICryptoUtils"),di=Symbol("IAsyncDisposableRegistry");var ac=Symbol("IExperimentService"),Oh=Symbol("IDataScienceCommandListener"),Kh=Symbol("IVariableScriptGenerator"),Fh=Symbol("IDataFrameScriptGenerator");var e3=require("vscode");var sV=require("events"),tx=D(O());try{(0,tx.decorate)((0,tx.injectable)(),sV.EventEmitter)}catch(r){U("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",r)}var Pe=class{constructor(e){this.container=e;Pe._instance=this}static get instance(){return Pe._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};Pe=v([(0,tx.injectable)()],Pe);var Dt=require("vscode");var tr=Symbol("IPythonApi"),Ye=Symbol("IPythonExtensionChecker");var w=require("vscode");var at=require("vscode"),aN=60,cN=aN*60,rx=cN*24,aV=rx*7,cV=rx*30,lV=rx*365;function Jh(r,e,t,n){typeof r!="number"&&(r=r.getTime());let i=Math.round((new Date().getTime()-r)/1e3);if(i<-30)return at.l10n.t("in {0}",Jh(new Date().getTime()+i*1e3,!1));if(!n&&i<30)return at.l10n.t("now");let o;return i<aN?(o=i,e?o===1?t?at.l10n.t("{0} second ago",o):at.l10n.t("{0} sec ago",o):t?at.l10n.t("{0} seconds ago",o):at.l10n.t("{0} secs ago",o):o===1?t?at.l10n.t("{0} second",o):at.l10n.t("{0} sec",o):t?at.l10n.t("{0} seconds",o):at.l10n.t("{0} secs",o)):i<cN?(o=Math.floor(i/aN),e?o===1?t?at.l10n.t("{0} minute ago",o):at.l10n.t("{0} min ago",o):t?at.l10n.t("{0} minutes ago",o):at.l10n.t("{0} mins ago",o):o===1?t?at.l10n.t("{0} minute",o):at.l10n.t("{0} min",o):t?at.l10n.t("{0} minutes",o):at.l10n.t("{0} mins",o)):i<rx?(o=Math.floor(i/cN),e?o===1?t?at.l10n.t("{0} hour ago",o):at.l10n.t("{0} hr ago",o):t?at.l10n.t("{0} hours ago",o):at.l10n.t("{0} hrs ago",o):o===1?t?at.l10n.t("{0} hour",o):at.l10n.t("{0} hr",o):t?at.l10n.t("{0} hours",o):at.l10n.t("{0} hrs",o)):i<aV?(o=Math.floor(i/rx),e?o===1?at.l10n.t("{0} day ago",o):at.l10n.t("{0} days ago",o):o===1?at.l10n.t("{0} day",o):at.l10n.t("{0} days",o)):i<cV?(o=Math.floor(i/aV),e?o===1?t?at.l10n.t("{0} week ago",o):at.l10n.t("{0} wk ago",o):t?at.l10n.t("{0} weeks ago",o):at.l10n.t("{0} wks ago",o):o===1?t?at.l10n.t("{0} week",o):at.l10n.t("{0} wk",o):t?at.l10n.t("{0} weeks",o):at.l10n.t("{0} wks",o)):i<lV?(o=Math.floor(i/cV),e?o===1?t?at.l10n.t("{0} month ago",o):at.l10n.t("{0} mo ago",o):t?at.l10n.t("{0} months ago",o):at.l10n.t("{0} mos ago",o):o===1?t?at.l10n.t("{0} month",o):at.l10n.t("{0} mo",o):t?at.l10n.t("{0} months",o):at.l10n.t("{0} mos",o)):(o=Math.floor(i/lV),e?o===1?t?at.l10n.t("{0} year ago",o):at.l10n.t("{0} yr ago",o):t?at.l10n.t("{0} years ago",o):at.l10n.t("{0} yrs ago",o):o===1?t?at.l10n.t("{0} year",o):at.l10n.t("{0} yr",o):t?at.l10n.t("{0} years",o):at.l10n.t("{0} yrs",o))}var pV=D(O());var $h=class{async createHash(e,t="SHA-256"){return Ea(e,t)}};$h=v([(0,pV.injectable)()],$h);var $E={},uV=!1,HE;typeof window=="object"?HE=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?HE=self.crypto:HE=require("node:crypto").webcrypto;async function Ea(r,e){let t=r.includes("/")||r.includes("\\")||r.endsWith(".interactive");if(t&&$E[r])return $E[r];let n=await Ine(r,e);return t&&!uV&&(Object.keys($E).length>1e4&&(uV=!0),$E[r]=n),n}async function Ine(r,e){let t=new TextEncoder().encode(r),n=await HE.subtle.digest({name:e},t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}function lp(r){if(typeof r=="string")try{let[e,t,n]=`${r.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?"":isNaN(t)?e.toString():isNaN(n)?`${e}.${t}`:`${e}.${t}.${n}`}catch(e){return C(`Failed to parse version ${r}`,e),""}return r?`${r.major}.${r.minor}.${r.micro}`:""}async function vt(r){return Ea(r,"SHA-256")}var lN=D(dV());var nx=require("vscode");function Wr(r){let e=Mr(r);if(e){let c=[];typeof e.version?.major=="number"&&(c.push(e.version.major.toString()),typeof e.version.minor=="number"&&(c.push(e.version.minor.toString()),typeof e.version.micro=="number"&&c.push(e.version.micro.toString())));let l=c.length?c.join("."):"",u=e.environment?.name||(e.environment?yn(e.environment?.folderUri):""),p=l?`Python ${l}`:"Python";return wr(r)&&u?u:u?`${u} (${p})`:p}if(Object.keys(r).length===1&&r.id)return r.id;let t=lp(Zi(r)||"").trim(),n=wr(r),i=t?`Python ${t}`:"Python",o=Ho(r);if(n&&o)return o;let s=[];o&&s.push(o);let a=Be(r);return a&&a!=="Unknown"&&s.push(a),[i,s.length?`(${s.join(": ")})`:""].join(" ").trim()}function Ho(r){let e=Mr(r),t=e?.environment?.name;return!t&&e?.environment?.folderUri&&Be(r)==="Conda"&&(t=yn(e?.environment?.folderUri)),t}var Cne=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Be(r){let e=Mr(r);return e?wne(e):"Unknown"}function wne(r){if(r.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,n]of e)if(r.tools.includes(t))return n;if(r.environment?.type==="VirtualEnvironment")return"VirtualEnv";for(let t of Cne)if(r.tools.some(n=>n.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}var yo;function mV(r){yo=r}function wr(r){if(!r||!yo)return!1;let e=Mr(r);return e&&Be(e)==="Conda"&&!e.executable.uri}function Mr(r){if(r){if(!yo)throw new Error("Python API not initialized");return yo.environments.known.find(e=>e.id===r.id)}}async function Pa(r){if(!r?.id)return;if(yo){let n=yo.environments.known.find(i=>i.id===r.id);if(n?.executable?.sysPrefix)return n.executable.sysPrefix}let t=await(await lN.PythonExtension.api()).environments.resolveEnvironment(r.id).then(n=>n?.executable?.sysPrefix);return t||U(`Unable to find sysPrefix for interpreter ${B(r.id)}`),t}function Hh(r){if(!r?.id)return;if(!yo)throw new Error("Python API not initialized");return yo.environments.known.find(t=>t.id===r.id)?.executable?.sysPrefix}async function pp(r,e=!1){if(!r?.id)return;if(yo&&!e){let i=yo.environments.known.find(o=>o.id===r.id);if(i?.version)return i.version}let n=await(await lN.PythonExtension.api()).environments.resolveEnvironment(r.id);return n?.version||U(`Unable to find Version for interpreter ${B(r.id)}`),n?.version}function Zi(r){if(!r?.id)return;if(!yo)throw new Error("Python API not initialized");return yo.environments.known.find(t=>t.id===r.id)?.version}function bo(){return yo?yo.environments.known:[]}function Oi(r){if(!r)return;let e,t=r.id;if(r.executable.uri)e=r.executable.uri;else if(Be(r)==="Conda")e=jr()==="Windows"?nx.Uri.joinPath(r.environment?.folderUri||nx.Uri.file(r.path),"python.exe"):nx.Uri.joinPath(r.environment?.folderUri||nx.Uri.file(r.path),"bin","python");else{U(`Python environment ${B(r.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Ene(r){return Wr(r)}var ve;(E=>(E.bannerLabelYes=w.l10n.t("Yes"),E.bannerLabelNo=w.l10n.t("No"),E.canceled=w.l10n.t("Canceled"),E.cancel=w.l10n.t("Cancel"),E.ok=w.l10n.t("Ok"),E.refresh=w.l10n.t("Refresh"),E.refreshing=w.l10n.t("Refreshing..."),E.install=w.l10n.t("Install"),E.loadingExtension=w.l10n.t("Jupyter Extension loading..."),E.handleExtensionActivationError=w.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),E.doNotShowAgain=w.l10n.t("Do not show again"),E.reload=w.l10n.t("Reload"),E.moreInfo=w.l10n.t("More Info"),E.learnMore=w.l10n.t("Learn more"),E.and=w.l10n.t("and"),E.reportThisIssue=w.l10n.t("Report this issue"),E.clickHereForMoreInfoWithHtml=A=>w.l10n.t("Click <a href='{0}'>here</a> for more info.",A)))(ve||={});var gm;(t=>(t.notInGroup=n=>w.l10n.t("User does not belong to experiment group '{0}'",n),t.inGroup=n=>w.l10n.t("User belongs to experiment group '{0}'",n)))(gm||={});var uN;(e=>e.jupyter=w.l10n.t("Jupyter"))(uN||={});var pN;(e=>e.currentWorkingDirectory="cwd:")(pN||={});var dN;(e=>e.bannerMessage=w.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(dN||={});var mN;(e=>e.bannerMessage=w.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(mN||={});var GE;(t=>(t.bannerLabelYes=w.l10n.t("Yes, take survey now"),t.bannerLabelNo=w.l10n.t("No, thanks")))(GE||={});var b;(_=>(_.warnWhenSelectingKernelWithUnSupportedPythonVersion=w.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),_.installingPythonExtension=w.l10n.t("Installing Python extension and locating kernels."),_.pythonExtensionRequired=w.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),_.rendererExtensionRequired=w.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),_.rendererExtension1015Required=w.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),_.pythonExtensionInstalled=w.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),_.unknownPackage=w.l10n.t("unknown"),_.interactiveWindowTitleFormat=W=>w.l10n.t("Interactive - {0}",W),_.interactiveWindowModeBannerTitle=w.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),_.interactiveWindowModeBannerSwitchYes=w.l10n.t("Yes"),_.interactiveWindowModeBannerSwitchNo=w.l10n.t("No"),_.dataExplorerTitle=w.l10n.t("Data Viewer"),_.badWebPanelFormatString=W=>w.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[W],comment:["Only translate the text within the HTML tags"]}),_.installingMissingDependencies=w.l10n.t("Installing missing dependencies"),_.validatingKernelDependencies=w.l10n.t("Validating kernel dependencies"),_.performingExport=w.l10n.t("Performing Export"),_.exportNotebookToPython=w.l10n.t("Exporting Notebook to Python"),_.sessionDisposed=w.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),_.passwordFailure=w.l10n.t("Failed to connect to password protected server. Check that password is correct."),_.incorrectPassword=w.l10n.t("Incorrect Password."),_.exportDialogFilter=w.l10n.t("Jupyter Notebooks"),_.exportDialogComplete=W=>w.l10n.t("Notebook written to {0}",W),_.exportDialogFailed=W=>w.l10n.t("Failed to export notebook. {0}",W),_.exportOpenQuestion1=w.l10n.t("Open in editor"),_.runCellLensCommandTitle=w.l10n.t("Run Cell"),_.importDialogTitle=w.l10n.t("Import Jupyter Notebook"),_.importDialogFilter="Jupyter Notebooks",_.notebookCheckForImportNo=w.l10n.t("Later"),_.libraryRequiredToLaunchJupyterNotInstalled=W=>w.l10n.t("Running cells requires {0} package.",W),_.librariesRequiredToLaunchJupyterNotInstalled=W=>w.l10n.t("Running cells requires {0} package.",W),_.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(W,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package.",W,Ze),_.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(W,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package.",W,Ze),_.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(W,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",W,Ze),_.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(W,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package.",W,Ze),_.installPackageInstructions=(W,Ze)=>w.l10n.t(`Run the following command to install '{0}' into the Python environment. 
Command: '{1}'`,W,Ze),_.pythonCondaKernelsWithoutPython=w.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),_.selectJupyterInterpreter=w.l10n.t("Select an Interpreter to start Jupyter"),_.jupyterInstall=w.l10n.t("Install"),_.currentlySelectedJupyterInterpreterForPlaceholder=W=>w.l10n.t("Selected Environment {0}",W),_.jupyterNotSupported=W=>w.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",W),_.jupyterNotebookNotInstalledOrNotFound=W=>{if(W){let Ze=Ene(W);return w.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",Ze)}else return w.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},_.jupyterNotSupportedBecauseOfEnvironment=(W,Ze)=>w.l10n.t("Activating {0} to run Jupyter failed with {1}",W,Ze),_.jupyterNbConvertNotSupported=w.l10n.t("Jupyter nbconvert is not installed"),_.jupyterLaunchTimedOut=w.l10n.t("The Jupyter notebook server failed to launch in time"),_.jupyterLaunchNoURL=w.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),_.jupyterSelfCertFail=W=>w.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,W),_.jupyterExpiredCertFail=W=>w.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,W),_.jupyterSelfCertFailErrorMessageOnly=w.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),_.jupyterSelfCertExpiredErrorMessageOnly=w.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),_.jupyterSelfCertEnable=w.l10n.t("Yes, connect anyways"),_.jupyterSelfCertClose=w.l10n.t("No, close the connection"),_.pythonInteractiveHelpLink=w.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),_.importingFormat=W=>w.l10n.t("Importing {0}",W),_.startingJupyter=w.l10n.t("Starting Jupyter Server"),_.connectingToKernel=W=>w.l10n.t("Connecting to kernel: {0}",W),_.connectingToJupyter=w.l10n.t("Connecting to Jupyter Server"),_.exportingFormat=W=>w.l10n.t("Exporting {0}",W),_.runAllCellsLensCommandTitle=w.l10n.t("Run All Cells"),_.runAllCellsAboveLensCommandTitle=w.l10n.t("Run Above"),_.runCellAndAllBelowLensCommandTitle=w.l10n.t("Run Below"),_.restartKernelMessage=w.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),_.restartKernelMessageYes=w.l10n.t("Restart"),_.restartKernelMessageDontAskAgain=w.l10n.t("Don't Ask Again"),_.automaticallyReconnectingToAKernelProgressMessage=W=>w.l10n.t("Reconnecting to the kernel {0}",W),_.restartingKernelStatus=W=>w.l10n.t("Restarting Kernel {0}",W),_.interruptingKernelFailed=w.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),_.sessionStartFailedWithKernel=W=>w.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyter=W=>w.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyterWithErrorInfo=(W,Ze)=>w.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[W,Ze],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyterDueToOutdatedTraitlets=(W,Ze)=>w.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[W,Ze],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),_.failedToStartKernel=w.l10n.t("Failed to start the Kernel."),_.failedToRestartKernel=w.l10n.t("Failed to restart the Kernel."),_.failedToInterruptKernel=w.l10n.t("Failed to interrupt the Kernel."),_.rawKernelStartFailedDueToTimeout=W=>w.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.rawKernelStartFailedDueToTimeoutWaitingForPort=W=>w.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.viewJupyterLogForFurtherInfo=w.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.kernelDied=W=>w.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.kernelDiedWithoutError=W=>w.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.failedToStartAnUntrustedKernelSpec=(W,Ze)=>w.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[W,Ze],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),_.kernelDiedWithoutErrorAndAutoRestarting=W=>w.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[W],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.kernelCrashedDueToCodeInCurrentOrPreviousCell=w.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.kernelDisconnected=W=>w.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",W),_.cannotRunCellKernelIsDead=W=>w.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",W),_.showJupyterLogs=w.l10n.t("Show Jupyter Logs."),_.restartKernel=w.l10n.t("Restart Kernel"),_.reloadRequired=w.l10n.t("Please reload the window for new settings to take effect."),_.restartedKernelHeader=W=>w.l10n.t("Restarted {0}",W),_.connectedKernelHeader=W=>w.l10n.t("Connected to {0}",W),_.restartingKernelCustomHeader=W=>w.l10n.t("_Restarting {0}..._",W),_.restartingKernelHeader=w.l10n.t("_Restarting kernel..._"),_.startingNewKernelHeader=w.l10n.t("_Connecting to kernel..._"),_.startingNewKernelCustomHeader=W=>w.l10n.t("_Connecting to {0}..._",W),_.noKernelConnected=w.l10n.t("No kernel connected"),_.jupyterSelectUriCommandLabel=w.l10n.t("Enter the URL of the running Jupyter Server..."),_.jupyterSelectUriInputTitle=w.l10n.t("Enter the URL of the running Jupyter Server"),_.jupyterSelectUriInputPlaceholder=w.l10n.t("Enter the url of the running Jupyter Server"),_.connectToToTheJupyterServer=W=>w.l10n.t("Connect to the Jupyter Server {0}",W),_.enterOrSelectRemoteJupyterPlaceholder=w.l10n.t("Enter a remote url, or select a remote server"),_.selectRemoteJupyterPlaceholder=w.l10n.t("Select a remote server"),_.jupyterServerLastConnectionForQuickPickDescription=W=>w.l10n.t("Last connected {0}",Jh(W,!0,!1,!1)),_.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=w.l10n.t("Jupyter Servers"),_.jupyterSelectURIInvalidURI=w.l10n.t("Invalid URL specified"),_.jupyterSelectURIMustBeHttpOrHttps=w.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),_.jupyterSelectLiveRemoteKernelDescription=(W,Ze)=>W?Ze===0?w.l10n.t("Last activity {0}",Jh(W,!0,!1,!1)):Ze===1?w.l10n.t("Last activity {0}, 1 connection",Jh(W,!0,!1,!1)):w.l10n.t("Last activity {0}, {1} connections",Jh(W,!0,!1,!1),Ze.toString()):Ze===0?"":Ze===1?w.l10n.t("1 connection"):w.l10n.t("{0} connections",Ze.toString()),_.installJupyterHub=w.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),_.useJupyterHubExtension=w.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),_.useJupyterHubExtensionDetail=w.l10n.t("Use this option when connecting to JupyterHub servers"),_.installJupyterHubDetail=w.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),_.jupyterSelectUserAndPasswordTitle=w.l10n.t("Enter your user name and password to connect to Jupyter Hub"),_.jupyterRenameServer=w.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),_.jupyterServerUriDisplayNameInputPlaceholder=w.l10n.t("Enter a display name"),_.jupyterSelectUserPrompt=w.l10n.t("Enter your user name"),_.jupyterSelectPasswordPrompt=w.l10n.t("Enter your password"),_.jupyterSelectPasswordTitle=w.l10n.t("Enter your password for the Jupyter Server"),_.pythonNotInstalled=w.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),_.pleaseReloadVSCodeOncePythonHasBeenInstalled=w.l10n.t("Upon installing Python please reload VS Code."),_.jupyterNotebookFailure=W=>w.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,W),_.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=W=>w.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",W),_.remoteJupyterConnectionFailedWithServerWithError=(W,Ze)=>w.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",W,Ze),_.remoteJupyterConnectionFailedWithServer=W=>w.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",W),_.remoteJupyterConnectionFailedWithoutServerWithError=W=>w.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",W),_.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=W=>w.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,W),_.removeRemoteJupyterConnectionButtonText=w.l10n.t("Forget Connection"),_.jupyterNotebookRemoteConnectFailedWeb=W=>w.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,W),_.packageNotInstalledWindowsLongPathNotEnabledError=(W,Ze)=>w.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,W,Ze),_.changeRemoteJupyterConnectionButtonText=w.l10n.t("Manage Connections"),_.rawConnectionBrokenError=w.l10n.t("Direct kernel connection broken"),_.jupyterServerCrashed=W=>w.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,W.toString()),_.jupyterKernelSpecModuleNotFound=W=>w.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,W),_.interruptKernelStatus=W=>w.l10n.t("Interrupting Kernel {0}",W),_.exportPythonQuickPickLabel=w.l10n.t("Python Script"),_.exportHTMLQuickPickLabel=w.l10n.t("HTML"),_.exportPDFQuickPickLabel=w.l10n.t("PDF"),_.restartKernelAfterInterruptMessage=W=>w.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",W),_.documentMismatch=W=>w.l10n.t("Cannot run cells, duplicate documents for {0} found.",W),_.jupyterGetVariablesBadResults=w.l10n.t("Failed to fetch variable info from the Jupyter Server."),w.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),_.jupyterGetVariablesExecutionError=W=>w.l10n.t(`Failure during variable extraction: \r
{0}`,W),_.selectKernel=w.l10n.t("Change Kernel"),_.selectDifferentKernel=w.l10n.t("Select a different Kernel"),_.kernelFilterPlaceholder=w.l10n.t("Choose the kernels that are available in the kernel picker."),_.recommendedItemCategoryInQuickPick=w.l10n.t("Recommended"),_.selectedKernelCategoryInQuickPick=w.l10n.t("Selected"),_.createPythonEnvironmentInQuickPick=w.l10n.t("Create Python Environment"),_.createPythonEnvironmentInQuickPickTooltip=w.l10n.t("Create an isolated Python Environment per workspace folder"),_.selectDifferentJupyterInterpreter=w.l10n.t("Change Interpreter"),_.pandasTooOldForViewingFormat=(W,Ze)=>w.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[W,Ze],comment:["Do not translate 'pandas' as that is a Python module name"]}),_.pandasRequiredForViewing=W=>w.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[W],comment:["Do not translate 'pandas' as that is a Python module name"]}),_.tooManyColumnsMessage=w.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),_.tooManyColumnsYes=w.l10n.t("Yes"),_.tooManyColumnsNo=w.l10n.t("No"),_.tooManyColumnsDontAskAgain=w.l10n.t("Don't Ask Again"),_.plotViewerTitle=w.l10n.t("Plots"),_.exportPlotTitle=w.l10n.t("Save plot image"),_.pdfFilter="PDF",_.pngFilter="PNG",_.svgFilter="SVG",_.exportImageFailed=W=>w.l10n.t("Error exporting image: {0}",W),_.jupyterDataRateExceeded=w.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),_.addCellBelowCommandTitle=w.l10n.t("Add cell"),_.debugCellCommandTitle=w.l10n.t("Debug Cell"),_.debugStepOverCommandTitle=w.l10n.t("Step over"),_.debugContinueCommandTitle=w.l10n.t("Continue"),_.debugStopCommandTitle=w.l10n.t("Stop"),_.runCurrentCellAndAddBelow=w.l10n.t("Run current cell and add empty cell below"),_.jupyterDebuggerNotInstalledError=W=>w.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",W),_.jupyterDebuggerOutputParseError=W=>w.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",W),_.cellStopOnErrorMessage=w.l10n.t("Cell was canceled due to an error in a previous cell."),_.scrollToCellTitleFormatMessage=W=>w.l10n.t("Go to [{0}]",W.toString()),_.instructionComments=W=>w.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,W),_.exportButtonTitle=w.l10n.t("Export"),_.exportAsQuickPickPlaceholder=w.l10n.t("Export As..."),_.openExportedFileMessage=w.l10n.t("Would you like to open the exported file?"),_.openExportFileYes=w.l10n.t("Yes"),_.openExportFileNo=w.l10n.t("No"),_.exportFailedGeneralMessage=w.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.exportToPDFDependencyMessage=w.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),_.failedExportMessage=w.l10n.t("Export failed."),_.startingJupyterLogMessage=(W,Ze)=>w.l10n.t("Starting Jupyter from {0} with arguments {1}",W,Ze),_.waitingForJupyterSessionToBeIdle=w.l10n.t("Waiting for Jupyter Session to be idle"),_.gettingListOfKernelsForRemoteConnection=w.l10n.t("Fetching Kernels"),_.gettingListOfKernelSpecs=w.l10n.t("Fetching Kernel specs"),_.startingJupyterNotebook=w.l10n.t("Starting Jupyter Notebook"),_.registeringKernel=w.l10n.t("Registering Kernel"),_.jupyterCommandLineReloadQuestion=w.l10n.t("Please reload the window when changing the Jupyter command line."),_.jupyterCommandLineReloadAnswer=w.l10n.t("Reload"),_.createdNewKernel=(W,Ze)=>w.l10n.t("{0}: Kernel started: {1}",W,Ze),_.kernelInvalid=W=>w.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",W),_.removeRemoteJupyterServerEntryInQuickPick=w.l10n.t("Remove"),_.loadClassFailedWithNoInternet=(W,Ze)=>w.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",W,Ze),_.useCDNForWidgetsNoInformation=w.l10n.t("Widgets require us to download supporting files from a 3rd party website."),_.enableCDNForWidgetsSetting=(W,Ze)=>w.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",W,Ze),_.enableCDNForWidgetsButton=w.l10n.t("Enable Downloads"),_.unhandledMessage=(W,Ze)=>w.l10n.t("Unhandled kernel message from a widget: {0} : {1}",W,Ze),_.cdnWidgetScriptNotAccessibleWarningMessage=(W,Ze)=>w.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",W,Ze),_.widgetScriptNotFoundOnCDNWidgetMightNotWork=(W,Ze,$w)=>w.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",W,Ze,$w),_.insecureSessionMessage=w.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),_.insecureSessionDenied=w.l10n.t("Denied connection to insecure server."),_.selectKernelForEditor=w.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),_.needIpykernel6=w.l10n.t("Ipykernel setup required for this feature"),_.setup=w.l10n.t("Setup"),_.showDataViewerFail=w.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),_.defaultNotebookName=w.l10n.t("default"),_.recommendExtensionForNotebookLanguage=(W,Ze)=>w.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",W,Ze),_.kernelWasNotStarted=w.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),_.noNotebookToDebug=w.l10n.t("No active notebook document to debug."),_.cantStartDebugging=w.l10n.t("Can't start debugging."),_.restartNotSupported=w.l10n.t("Restarting is not supported in the interactive window."),_.importingIpynb=w.l10n.t("Importing notebook file"),_.exportingToFormat=W=>w.l10n.t("Exporting to {0}",W),_.kernelCategoryForJupyterSession=w.l10n.t("Jupyter Session"),_.kernelDefaultRemoteDisplayName=w.l10n.t("Remote"),_.kernelCategoryForJupyterKernel=w.l10n.t("Jupyter Kernel"),_.kernelCategoryForRemoteJupyterKernel=w.l10n.t("Jupyter Kernel"),_.kernelCategoryForConda=w.l10n.t("Conda Env"),_.kernelCategoryForCondaWithoutPython=w.l10n.t("Conda Env Without Python"),_.kernelCategoryForPoetry=w.l10n.t("Poetry Env"),_.kernelCategoryForPipEnv=w.l10n.t("Pipenv Env"),_.kernelCategoryForPyEnv=w.l10n.t("PyEnv Env"),_.kernelCategoryForGlobal=w.l10n.t("Global Env"),_.kernelCategoryForVirtual=w.l10n.t("Virtual Env"),_.fileSeemsToBeInterferingWithKernelStartup=W=>w.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",W),_.moduleSeemsToBeInterferingWithKernelStartup=W=>w.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",W),_.pipCondaInstallHoverWarning=(W,Ze)=>w.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",W,Ze),_.percentPipCondaInstallInsteadOfBang=W=>w.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[W],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),_.replacePipCondaInstallCodeAction=W=>w.l10n.t("Replace with '%{0} install'",W),_.failedToStartKernelDueToMissingModule=W=>w.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",W),_.failedToStartKernelDueToImportFailure=W=>w.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",W),_.failedToStartKernelDueToImportFailureFromFile=(W,Ze)=>w.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",W,Ze),_.failedToStartKernelDueToUnknownDllLoadFailure=w.l10n.t("The kernel failed to start as a dll could not be loaded."),_.failedToStartKernelDueToDllLoadFailure=W=>w.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",W),_.failedToStartKernelDueToWin32APIFailure=w.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),_.failedToStartKernelDueToPyZmqFailure=w.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),_.failedToStartKernelDueToOldIPython=w.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),_.failedToStartKernelDueToOldIPyKernel=w.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),_.failedToStartKernelDueToMissingPythonEnv=W=>w.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",W),_.matplotlibWidgetInsteadOfOther=w.l10n.t("'%matplotlib' widget works best inside of VS Code"),_.matplotlibWidgetCodeActionTitle=w.l10n.t("More info"),_.allowExtensionToUseJupyterKernelApi=(W,Ze)=>w.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",W,Ze),_.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=W=>w.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",W),_.activatingPythonEnvironment=W=>w.l10n.t("Activating Python Environment '{0}'",W),_.runningKernelStartupHooksFor=W=>w.l10n.t("Running Kernel startup hooks in '{0}'",W),_.cellAtFormat=(W,Ze)=>w.l10n.t("{0} Cell {1}",W,Ze),_.jupyterServerConsoleOutputChannel=w.l10n.t("Jupyter Server Console"),_.kernelConsoleOutputChannel=W=>w.l10n.t("{0} Kernel Console Output",W),_.webNotSupported=w.l10n.t("Operation not supported in web version of Jupyter Extension."),_.failedToInstallPythonExtension=w.l10n.t("Failed to install the Python Extension."),_.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=W=>w.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",W),_.listOfFilesWithLinksThatMightNeedToBeRenamed=W=>w.l10n.t("File(s): {0} might need to be renamed.",W),_.failedToGetVersionOfPandas=w.l10n.t("Failed to get version of Pandas to use the Data Viewer."),_.failedToInstallPandas=w.l10n.t("Failed to install Pandas to use the Data Viewer."),_.localKernelSpecs=w.l10n.t("Jupyter Kernel..."),_.localPythonEnvironments=w.l10n.t("Python Environments..."),_.quickPickTitleForSelectionOfJupyterServer=w.l10n.t("Select a Jupyter Server"),_.UserJupyterServerUrlProviderDisplayName=w.l10n.t("Existing Jupyter Server..."),_.UserJupyterServerUrlProviderDetail=w.l10n.t("Connect to an existing Jupyter Server"),_.kernelPickerSelectKernelTitle=w.l10n.t("Select Kernel"),_.kernelPickerSelectLocalKernelSpecTitle=w.l10n.t("Select a Jupyter Kernel"),_.quickPickSelectPythonEnvironmentTitle=w.l10n.t("Select a Python Environment"),_.kernelPickerSelectKernelFromRemoteTitle=W=>w.l10n.t("Select a Kernel from {0}",W),_.kernelPickerSelectKernelFromRemoteTitleWithoutName=w.l10n.t("Select a Jupyter Kernel"),_.installPythonExtensionViaKernelPickerTitle=w.l10n.t("Install Python Extension"),_.installPythonExtensionViaKernelPickerToolTip=w.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),_.installPythonQuickPickTitle=w.l10n.t("Install Python"),_.installPythonQuickPickToolTip=w.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),_.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=w.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),_.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=w.l10n.t("Ensure the server is running and reachable."),_.dataViewerDeprecationMessage=w.l10n.t("The built-in data viewer will be deprecated soon. Please install other data viewing extensions to keep the ability to inspect data."),_.dataViewerDeprecationRecommendationActionMessage=w.l10n.t("See Recommended Extensions")))(b||={});var qt;(X=>(X.collapseSingle=w.l10n.t("Collapse"),X.expandSingle=w.l10n.t("Expand"),X.noRowsInDataViewer=w.l10n.t("No rows match current filter"),X.sliceIndexError=w.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),X.sliceMismatchedAxesError=w.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),X.fetchingDataViewer=w.l10n.t("Fetching data ..."),X.dataViewerHideFilters=w.l10n.t("Hide filters"),X.dataViewerShowFilters=w.l10n.t("Show filters"),X.refreshDataViewer=w.l10n.t("Refresh data viewer"),X.sliceSummaryTitle=w.l10n.t("SLICING"),X.sliceData=w.l10n.t("Slice Data"),X.sliceSubmitButton=w.l10n.t("Apply"),X.sliceDropdownAxisLabel=w.l10n.t("Axis"),X.sliceDropdownIndexLabel=w.l10n.t("Index"),X.variableExplorerNameColumn=w.l10n.t("Name"),X.variableExplorerTypeColumn=w.l10n.t("Type"),X.variableExplorerCountColumn=w.l10n.t("Size"),X.variableExplorerValueColumn=w.l10n.t("Value"),X.collapseVariableExplorerLabel=w.l10n.t("Variables"),X.variableLoadingValue=w.l10n.t("Loading..."),X.showDataExplorerTooltip=w.l10n.t("Show variable snapshot in data viewer"),X.noRowsInVariableExplorer=w.l10n.t("No variables defined"),X.loadingRowsInVariableExplorer=w.l10n.t("Loading variables"),X.previousPlot=w.l10n.t("Previous"),X.nextPlot=w.l10n.t("Next"),X.panPlot=w.l10n.t("Pan"),X.zoomInPlot=w.l10n.t("Zoom in"),X.zoomOutPlot=w.l10n.t("Zoom out"),X.exportPlot=w.l10n.t("Export to different formats"),X.deletePlot=w.l10n.t("Remove"),X.selectedImageListLabel=w.l10n.t("Selected Image"),X.selectedImageLabel=w.l10n.t("Image"),X.errorOutputExceedsLinkToOpenFormatString=w.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']})))(qt||={});var ix;(n=>(n.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=w.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=w.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=w.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(ix||={});var Gh;(n=>(n.noCondaOrPipInstaller=w.l10n.t("There is no Conda or Pip installer available in the selected environment."),n.noPipInstaller=w.l10n.t("There is no Pip installer available in the selected environment."),n.searchForHelp=w.l10n.t("Search for help")))(Gh||={});var fN;(e=>e.installingModule=t=>w.l10n.t("Installing {0}",t))(fN||={});var Ks=D(O());var ox="Python Kernel Debug Adapter",sx="Python Interactive Window Debug Adapter";var YE=require("node-fetch"),lx=D(fV());var zh=require("vscode");var et=class extends Error{constructor(t,n){super(n);this.category=t;this.isJupyterError=!0}},un=class r extends et{constructor(t,n,i){super(i||hN(n),t);this.originalException=n;n&&(this.stack=`${new Error("").stack}

${n.stack}`)}static from(t,n){return n instanceof et?n:new r(t,n)}static unwrap(t){return t&&(t instanceof r&&t.originalException&&t.originalException instanceof et&&(t=t.originalException),t)}};function hN(r){return r&&r instanceof et?r.category:"unknown"}var Rs=class extends et{constructor(t,n,i){super("jupyterconnection",t+(n?`
${n}`:""));this.interpreter=i}};var bn=class extends et{constructor(){super("sessionDisposed",b.sessionDisposed)}};var zE=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function Qh(r=""){if(!r)return;let e=/\S+Error: /g,t=`${r.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let n=t[0],o=((n.match(e)?n:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function QE(r=""){let e=gV(r);return e?e[1]:void 0}function gV(r=""){if(!r)return;let e=r.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function vV(r){if(!r)return;let t=(Array.isArray(r)?r[0]:r).split(`
`).map(c=>c.trim().toLowerCase()).filter(c=>c.length).reverse().find(c=>c.startsWith("file ")&&c.includes(", line ")&&c.includes(".py")&&c.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function vm(r,e,t,n="",i=[]){let o=e instanceof et?e.stdErr||e.stack||"":e.toString(),s=gV(o),a=o.toLowerCase();if(e instanceof bn)return{reason:"sessionDisposed",message:b.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:b.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:b.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?b.failedToStartKernelDueToDllLoadFailure(u):b.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:b.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:b.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:b.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=hV(s[1]);if(u&&n){let p=Dne(u.moduleName,u.fileName,r,n);return p||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?b.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):b.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let c="No module named".toLowerCase(),l="is not a package".toLowerCase();if(a.includes(c)&&!l){let u=We(o).map(m=>m.trim()).filter(m=>m.length).find(m=>m.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:p,message:b.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(c)&&l){let u=We(o).map(y=>y.trim()).filter(y=>y.length).find(y=>y.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"",m="",h="";p.split("'").length>2&&(m=p.split("'").slice(-2)[0]||"",m=m?`${m}.py`:"",h=m||"",p=p.split("'")[1]||p);let g=i.filter(y=>yn(y).toLowerCase()==="__init__.py").map(y=>yn(Ti(y)));return p&&m&&p!==m&&i.some(y=>yn(y).toLowerCase()===m.toLowerCase())?{reason:"overridingBuiltinModules",fileName:m,moduleName:p,message:b.fileSeemsToBeInterferingWithKernelStartup(m),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:p&&g&&p!==h&&g.some(y=>y.toLowerCase()===h.toLowerCase())?{reason:"overridingBuiltinModules",folderName:h,moduleName:p,message:b.moduleSeemsToBeInterferingWithKernelStartup(h),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:p,message:b.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof et&&e.category==="invalidkernel"&&i.length){let u=yn(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:yn(i[0],".py"),message:b.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=hV(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:b.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof Rs){let u=We(o).map(x=>x.trim()).reverse().find(x=>x.toLowerCase().includes("error: ")),p="AttributeError: 'Namespace' object has no attribute '_flags'",m=["jupyter.startup.failure"],h,g="jupyterStartFailure",y=We(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(x=>x.toLowerCase().includes("error: "));if(y=y||We(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(x=>x.toLowerCase().includes("error: ")),a.includes(p.toLowerCase())?(g="jupyterStartFailureOutdatedTraitlets",u=b.failedToStartJupyterDueToOutdatedTraitlets(t||"",y||""),m.push("outdated.traitlets"),h="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=y?b.failedToStartJupyterWithErrorInfo(t||"",y):b.failedToStartJupyter(t||""),h=void 0),u)return{reason:g,message:u,pythonError:y,moreInfoLink:h,telemetrySafeTags:m}}}function hV(r){r=r.replace(/"/g,"'");let e=r.match(/'[^\\']*(\\'[^\\']*)*'/g),t=r.match(/\((.*?)\)/g),n,i;return e&&e[0].length>2&&(n=e[0],n=n.substring(1,n.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),n?{moduleName:n,fileName:i}:void 0}function Dne(r,e,t,n){if(n&&t.length!==0&&e&&!e.toLowerCase().startsWith(n)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:r,message:b.fileSeemsToBeInterferingWithKernelStartup(B(zh.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function Yh(r){if(!r)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(r))!==null;)t.length===3&&(r=r.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let n=We(r,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new zh.NotebookCellOutput([zh.NotebookCellOutputItem.error({message:"",name:"",stack:n})])}var _ne=[Tne,Rne];function yV(r){let e=[],t=Array.isArray(r)?r[0].toLowerCase():r.toLowerCase();_ne.forEach(i=>i(t,e));let n=vm([],t,void 0);return n?.telemetrySafeTags.length&&e.push(...n.telemetrySafeTags),Array.from(new Set(e)).join(",")}function Tne(r,e=[]){r.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function Rne(r,e=[]){r.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function bV(){return(new Error().stack||"").split(`
`).filter(r=>r.includes(Je))}async function IV(r,e){r.failed=!0,r.failureCategory=r.failureCategory||hN(e);let t=!YE.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||YE.FetchError!==void 0)&&Mne(e,t?TypeError:YE.FetchError);r.failureCategory==="unknown"&&i&&(r.failureCategory="fetcherror"),r.stackTrace=Ane(e),typeof e=="string"&&(r.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;r.failureSubCategory=r.failureSubCategory||yV(o);let s=vV(o);s&&([r.pythonErrorFile,r.pythonErrorFolder,r.pythonErrorPackage]=await Promise.all([Promise.resolve(r.pythonErrorFile||vt(s.fileName)),Promise.resolve(r.pythonErrorFolder||vt(s.folderName)),Promise.resolve(r.pythonErrorPackage||vt(s.packageName))]))}function gN(r){if(r.stack&&Array.isArray(r.stack)){let e={...r,stack:r.stack.join(`
`)};return lx.parse.call(lx,e)}return lx.parse.call(lx,r)}function Ane(r){let e="";for(let t of gN(r)){let n=t.getFileName();if(n){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${Nne(t)} ${n}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function Nne(r){let e=[];return typeof r.getTypeName()=="string"&&r.getTypeName().length>0&&e.push(r.getTypeName()),typeof r.getMethodName()=="string"&&r.getMethodName().length>0&&e.push(r.getMethodName()),typeof r.getFunctionName()=="string"&&r.getFunctionName().length>0&&(e.length!==2||e.join(".")!==r.getFunctionName())&&e.push(r.getFunctionName()),e.join(".")}function Mne(r,e){return e?r instanceof e||r instanceof un&&r.originalException instanceof e:(console.error("Error type is not defined",r),!1)}var XE=require("vscode");function One(){try{return require("vscode")===void 0?!1:CV()!==void 0}catch{return!1}}function eP(){return XE.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}function tP(r){return XE.workspace.onDidChangeConfiguration(e=>{if(!e.affectsConfiguration("telemetry"))return;let n=XE.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1;r(n)})}var ZE={};function Xh(r,e){let t=r;FS()&&t.startsWith("ds_")||(e===void 0?delete ZE[t]:ZE[t]=e)}var vN;function CV(){if(vN)return vN;let r=require("@vscode/extension-telemetry").default;return vN=new r(Yj)}function SV(r,e){let t={};return Object.getOwnPropertyNames(e).forEach(n=>{if(!(e[n]===void 0||e[n]===null))try{t[n]=typeof e[n]=="string"?e[n]:typeof e[n]=="object"?"object":e[n].toString()}catch(i){C(`Failed to serialize ${n} for ${r}`,i)}}),t}function N(r,e,t,n){Nr()||!One()||Kne(r,e,t,n)}function Kne(r,e,t,n){let i=CV(),o={},s=r;n?(o={},Object.assign(o,ZE),Object.assign(o,t||{}),IV(o,n).then(()=>{o=SV(s,o),i.sendTelemetryEvent(s,o,e)}).catch(f)):(t&&(o=SV(s,t)),Object.assign(o,ZE),i.sendTelemetryEvent(s,o,e))}var xV=new Set;function mr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a=e||{},c=new Ge,l=`${r.toString()}${JSON.stringify(a)}`,u=!xV.has(l);xV.add(l);let p=o.apply(this,s);return p&&typeof p.then=="function"&&typeof p.catch=="function"?p.then(m=>{let h={...a};return u&&(h.firstTime=u),N(r,c?{duration:c?.elapsedTime}:void 0,h),m}).catch(m=>{let h={...a};h.failed=!0,N(r,c?{duration:c?.elapsedTime}:{},h,m)}):N(r,c?{duration:c?.elapsedTime}:void 0,a),p},i}}function Zr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){return N(r,void 0,e),o.apply(this,s)},i}}function Fne(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function At(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function eo(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function wc(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function mi(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...eo()}}}var nEe={...At(),...wc(),...Fne()};var Lne,Une,jne,Wne,Vne,Bne,qne,Jne,$ne,Hne,Gne,zne,Qne,Yne,Xne,Zne,eie,tie,rie,nie,iie,oie,sie,aie,cie,lie,uie,pie,die,mie,fie,hie,gie,vie,yie,bie,Iie,Sie,xie,Cie,wie,Eie,Pie,kie,Die,_ie,Tie,Rie,Aie,Nie,Mie,Oie,Kie,Fie,Lie,Uie,jie,Wie,Vie,Bie,qie,Jie,$ie,Hie,Gie,zie,Qie,Yie,Xie,Zie,eoe,toe,roe,noe,ioe,ooe,soe,aoe,coe,loe,uoe,poe,doe,moe,foe,hoe,goe,voe,yoe,boe,Ioe,Soe,xoe,Coe,woe,Eoe,Poe,koe,Doe,_oe,Toe,Roe,Aoe,Noe,Moe,Ooe,Koe,Foe,Loe,Uoe,joe,Woe,Voe,Boe,qoe,Joe,$oe,Hoe,Goe,zoe,Qoe,Yoe,Xoe,Zoe,ese,tse,rse,nse,ise,ose,sse,ase,cse,lse,use,pse,dse,mse,fse,hse,gse,vse,yse,bse,Ise,Sse,xse,Cse,wse,Ese,Pse,kse,Dse,_se,Tse,Rse,Ase,Nse,Mse,Ose,Kse,Fse,wV=class{constructor(){this[Lne]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Une]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:At()};this[jne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Wne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Vne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...eo()}};this[Bne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:At()};this[qne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...eo()}};this[Jne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:At()};this[$ne]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[Hne]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[Gne]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[zne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:At()};this[Qne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:At()};this[Yne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Xne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Zne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[eie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[tie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[rie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[nie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...wc(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:At()};this[iie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[oie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[sie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[aie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[cie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:mi().properties,measures:{...At()}};this[lie]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[uie]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[pie]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[die]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[mie]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[fie]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[hie]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[gie]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[vie]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[yie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[bie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Iie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Sie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[xie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Cie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[wie]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[Eie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Pie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[kie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Die]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[_ie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Tie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Rie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Aie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Nie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Mie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Oie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Kie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Fie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Lie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Uie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[jie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Wie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Vie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Bie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[qie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Jie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[$ie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Hie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[Gie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:At()};this[zie]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Qie]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Yie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[Xie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Zie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[eoe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[toe]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[roe]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[noe]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ioe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...eo()},measures:At()};this[ooe]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[soe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:At()};this[aoe]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[coe]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[loe]={owner:"IanMatthewHuff",feature:["DataFrameViewer","VariableViewer"],source:"N/A"};this[uoe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[poe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failedWithoutBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},failedWithBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},localHost:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[doe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[moe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[foe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:At()};this[hoe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[goe]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[voe]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...wc(),...eo()},measures:{...At()}};this[yoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[boe]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Ioe]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[Soe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[xoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:At()};this[Coe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[woe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Eoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Poe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[koe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Doe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[_oe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",measures:{totalOverheadInMs:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfMessagesWaitedOn:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},averageWaitTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfRegisteredHooks:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Toe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Roe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Aoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...At(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...mi().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Noe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:At()};this[Moe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...At()},properties:{...mi().properties,...wc()}};this[Ooe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:At(),properties:{...mi().properties,...wc(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Koe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...mi().properties,...wc()}};this[Foe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...mi().properties,...wc()}};this[Loe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:mi().properties};this[Uoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...eo(),...wc(),...mi().properties},measures:{...At()}};this[joe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...eo(),...wc(),...mi().properties},measures:At()};this[Woe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...eo(),...wc(),...mi().properties,envMissingReason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isEmptyCondaEnv:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},pythonEnvType:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},fileExists:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Voe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...eo(),...mi().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[Boe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...eo(),...mi().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[qoe]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...eo(),...mi().properties,manuallySelectedKernel:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...At(),computeCwd:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},duration:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},envVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},executeCell:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},getConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},interruptHandle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelIdle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInfo:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelReady:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},portUsage:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},postKernelStart:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},preExecuteCellTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},pythonEnvVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},sessionTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},spawn:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startupCode:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},updateConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputsByteSize:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Joe]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...eo(),...mi().properties,wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...At(),callPythonApi:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},activatePython:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},discoverEnv:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},createController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},selectController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[$oe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...eo(),...mi().properties}};this[Hoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...eo(),...mi().properties}};this[Goe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[zoe]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Qoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Yoe]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:At(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Xoe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:At()};this[Zoe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[ese]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:At()};this[tse]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:At()};this[rse]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[nse]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ise]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[ose]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[sse]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ase]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[cse]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[lse]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[use]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[pse]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[dse]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[mse]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[fse]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[hse]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[gse]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[vse]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...At(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},timesExceededTimeout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[yse]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[bse]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Ise]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Sse]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[xse]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...At()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[Cse]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[wse]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ese]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:At()};this[Pse]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[kse]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[Dse]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...mi().properties,...eo()}};this[_se]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[Tse]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[Rse]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Ase]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Nse]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Mse]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:At()};this[Ose]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[Kse]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Fse]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"}}static{Lne="EXTENSION.LOAD",Une="DS_INTERNAL.EXPERIMENT_LOAD",jne="ENVFILE_VARIABLE_SUBSTITUTION",Wne="ENVFILE_WORKSPACE",Vne="HASHED_PACKAGE_NAME",Bne="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",qne="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",Jne="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",$ne="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",Hne="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",Gne="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",zne="DATASCIENCE.ADD_CELL_BELOW",Qne="DS_INTERNAL.CODE_LENS_ACQ_TIME",Yne="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",Xne="DATASCIENCE.DEBUG_CONTINUE",Zne="DATASCIENCE.DEBUG_CURRENT_CELL",eie="DATASCIENCE.DEBUG_STEP_OVER",tie="DATASCIENCE.DEBUG_STOP",rie="DATASCIENCE.DEBUG_FILE_INTERACTIVE",nie="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",iie="DS_INTERNAL.JUPYTER_KERNEL_SPEC",oie="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",sie="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",aie="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",cie="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",lie="DATASCIENCE.EXPORT_PYTHON_FILE",uie="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",pie="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",die="DATASCIENCE.EXPORT_NOTEBOOK_AS",mie="DATASCIENCE.IMPORT_NOTEBOOK",fie="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",hie="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",gie="DS_INTERNAL.GET_PASSWORD_FAILURE",vie="DS_INTERNAL.GET_PASSWORD_SUCCESS",yie="DS_INTERNAL.JUPYTER_HUB_PASSWORD",bie="DS_INTERNAL.SHOW_DATA_NO_PANDAS",Iie="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",Sie="DS_INTERNAL.SHOW_DATA_PANDAS_OK",xie="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",Cie="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",wie="DATASCIENCE.OPEN_PLOT_VIEWER",Eie="DATASCIENCE.RUN_ALL_CELLS",Pie="DATASCIENCE.RUN_SELECTION_OR_LINE",kie="DATASCIENCE.RUN_CURRENT_CELL",Die="DATASCIENCE.RUN_ALL_CELLS_ABOVE",_ie="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",Tie="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",Rie="DATASCIENCE.RUN_FILE_INTERACTIVE",Aie="DATASCIENCE.RUN_TO_LINE",Nie="DATASCIENCE.RUN_FROM_LINE",Mie="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",Oie="DATASCIENCE.RUN_INSERT_CELL_BELOW",Kie="DATASCIENCE.RUN_INSERT_CELL_ABOVE",Fie="DATASCIENCE.RUN_DELETE_CELLS",Lie="DATASCIENCE.RUN_SELECT_CELL",Uie="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",jie="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",Wie="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",Vie="DATASCIENCE.RUN_MOVE_CELLS_UP",Bie="DATASCIENCE.RUN_MOVE_CELLS_DOWN",qie="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",Jie="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",$ie="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",Hie="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",Gie="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",zie="DATASCIENCE.SELFCERTSMESSAGECLOSE",Qie="DATASCIENCE.SELFCERTSMESSAGEENABLED",Yie="DATASCIENCE.USER_INSTALLED_JUPYTER",Xie="DATASCIENCE.USER_INSTALLED_PANDAS",Zie="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",eoe="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",toe="DS_INTERNAL.PYTHON_NOT_INSTALLED",roe="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",noe="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",ioe="DS_INTERNAL.PYTHON_MODULE_INSTALL",ooe="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",soe="DATASCIENCE.START_SHOW_DATA_EXPLORER",aoe="DATASCIENCE.SHOW_DATA_EXPLORER",coe="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",loe="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",uoe="DATASCIENCE.REFRESH_DATA_VIEWER",poe="DS_INTERNAL.JUPYTER_STARTED_SESSION_WITH_BACKING_FILE",doe="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",moe="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",foe="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",hoe="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",goe="DATASCIENCE.KERNEL_SPEC_LANGUAGE",voe="DS_INTERNAL.KERNEL_LAUNCHER_PERF",yoe="GLOBAL_PYTHON_KERNELSPEC",boe="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",Ioe="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",Soe="DS_INTERNAL.IPYWIDGET_USED_BY_USER",xoe="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",Coe="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",woe="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",Eoe="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",Poe="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",koe="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",Doe="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",_oe="DS_INTERNAL.IPYWIDGET_OVERHEAD",Toe="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",Roe="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",Aoe="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",Noe="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",Moe="DATASCIENCE.EXECUTE_CELL",Ooe="DATASCIENCE.EXECUTE_CODE",Koe="DATASCIENCE.RESUME_EXECUTE_CELL",Foe="DATASCIENCE.NOTEBOOK_START",Loe="DS_INTERNAL.SWITCH_KERNEL",Uoe="DATASCIENCE.NOTEBOOK_INTERRUPT",joe="DATASCIENCE.NOTEBOOK_RESTART",Woe="DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",Voe="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",Boe="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",qoe="DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",Joe="DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",$oe="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",Hoe="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",Goe="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",zoe="DS_INTERNAL.KERNEL_COUNT",Qoe="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",Yoe="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",Xoe="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",Zoe="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",ese="DATAVIEWER.WEBVIEW_LOADED",tse="PLOTVIEWER.WEBVIEW_LOADED",rse="DS_INTERNAL.COMMAND_EXECUTED",nse="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",ise="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",ose="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",sse="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",ase="DATASCIENCE.RECOMMENT_EXTENSION",cse="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",lse="DATASCIENCE.DEBUGGING.CLOSED_MODAL",use="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",pse="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",dse="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",mse="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",fse="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",hse="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",gse="DATASCIENCE.DEBUGGING.ENDED_SESSION",vse="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",yse="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",bse="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",Ise="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",Sse="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",xse="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",Cse="DATASCIENCE.JUPYTER_API_USAGE",wse="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",Ese="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",Pse="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",kse="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",Dse="DATASCIENCE.KERNEL_CRASH",_se="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",Tse="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",Rse="DS_INTERNAL.RUNTEST",Ase="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",Nse="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",Mse="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",Ose="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",Kse="DATAVIEWER.USING_INTERPRETER",Fse="DATAVIEWER.USING_KERNEL"}};var dp=require("vscode");function Pc(r){let e=Ec(r.uri);return vt(e.path)}function Go(r=dp.Uri.file(""),e=dp.Uri.file(""),t=jr(),n=!1){let i=Ec(r,t,t=="Windows"||n),o=Ec(e,t,t=="Windows"||n);return i===o||_i(i,o,!0)}function Ec(r=dp.Uri.file(""),e=jr(),t=!1){let n=Ae(r);return t&&(n=n.toLowerCase()),n.endsWith("/bin/python")?["Linux","OSX"].includes(e)?n.endsWith("/bin/python")&&n.split("/").length>4?dp.Uri.file(n.replace("/bin/python","/python")):dp.Uri.file(n):dp.Uri.file(n):dp.Uri.file(n)}var EV=require("vscode");var Io=class{constructor(){this.promises=new Set;this._onStateChange=new EV.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(f)}};var rP=class extends un{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var nP=class extends et{constructor(){super("pythonExtension","Python Extension API not exported")}};var c9=D(sg());var xm=require("vscode");var mP=class{};function Ns(r,e=""){let t=r?xm.workspace.getWorkspaceFolder(r):xm.workspace.workspaceFolders?xm.workspace.workspaceFolders[0]:void 0;return t?wn(jr()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function Dc(){return(Array.isArray(xm.workspace.workspaceFolders)&&xm.workspace.workspaceFolders.length>0?xm.workspace.workspaceFolders[0]:void 0)?.uri}var wm=require("vscode");var qV=D(VV());function zt(r){let e=this,t=!1,n;return function(){return t||(t=!0,n=r.apply(e,arguments)),n}}var LN;(x=>{function r(E){return E&&typeof E=="object"&&typeof E[Symbol.iterator]=="function"}x.is=r;let e=Object.freeze([]);function t(){return e}x.empty=t;function*n(E){yield E}x.single=n;function i(E){return r(E)?E:n(E)}x.wrap=i;function o(E){return E||e}x.from=o;function s(E){return!E||E[Symbol.iterator]().next().done===!0}x.isEmpty=s;function a(E){return E[Symbol.iterator]().next().value}x.first=a;function c(E,A){for(let T of E)if(A(T))return!0;return!1}x.some=c;function l(E,A){for(let T of E)if(A(T))return T}x.find=l;function*u(E,A){for(let T of E)A(T)&&(yield T)}x.filter=u;function*p(E,A){let T=0;for(let j of E)yield A(j,T++)}x.map=p;function*m(...E){for(let A of E)for(let T of A)yield T}x.concat=m;function h(E,A,T){let j=T;for(let oe of E)j=A(j,oe);return j}x.reduce=h;function*g(E,A,T=E.length){for(A<0&&(A+=E.length),T<0?T+=E.length:T>E.length&&(T=E.length);A<T;A++)yield E[A]}x.slice=g;function y(E,A=Number.POSITIVE_INFINITY){let T=[];if(A===0)return[T,E];let j=E[Symbol.iterator]();for(let oe=0;oe<A;oe++){let G=j.next();if(G.done)return[T,x.empty()];T.push(G.value)}return[T,{[Symbol.iterator](){return j}}]}x.consume=y})(LN||={});var JV;function $V(r){JV=r}function ag(r){return JV?.push(r),r}function z(r){if(LN.is(r)){for(let e of r)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(r)?[]:r}else if(r)return r.dispose(),r}var En=class r{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),ag(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{z(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?r.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},or=class{constructor(...e){this._store=new En;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),ag(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Ms=class extends or{constructor(){super();this._onDidDispose=new qV.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var BV=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{z(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var HV=D(sg());var ka=require("vscode");var xae={output_type:"stream",name:"stdout",text:""},Cae={output_type:"error",ename:"",evalue:"",traceback:[""]},wae={output_type:"display_data",data:{},metadata:{}},Eae={output_type:"execute_result",execution_count:0,data:{},metadata:{}},MEe={stream:new Set(Object.keys(xae)),error:new Set(Object.keys(Cae)),display_data:new Set(Object.keys(wae)),execute_result:new Set(Object.keys(Eae))};function ro(r){return r&&op(r).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function Tc(r){return r=r.toLowerCase(),r.length===2&&r.endsWith("#")?`${r.substring(0,1)}sharp`:Zj.get(r)||r}function Nt(r){return typeof r=="string"?r===_t||r===xt:r.notebookType===_t||r.notebookType===xt}function So(r){if(mp()){let e=r.metadata?.custom;return JSON.parse(JSON.stringify(e?.metadata||{}))}else{let e=r.metadata;return JSON.parse(JSON.stringify(e?.metadata||{}))}}function GV(r){if(mp()){let e=r.metadata?.custom;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}else{let e=r.metadata;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}}async function zV(r,e){let t=new ka.WorkspaceEdit;if(mp()){let n=JSON.parse(JSON.stringify(r.metadata||{custom:{}}));n.custom=n.custom||{},n.custom.metadata=e,t.set(r.uri,[ka.NotebookEdit.updateNotebookMetadata(gP({...r.metadata||{},custom:n.custom}))])}else t.set(r.uri,[ka.NotebookEdit.updateNotebookMetadata(gP({...r.metadata||{},metadata:e}))]);await ka.workspace.applyEdit(t)}function cg(r){return ka.workspace.notebookDocuments.find(e=>Nt(e)&&e.getCells().some(t=>t.document===r))}function Os(r){if(Array.isArray(r)){let e="";for(let t=0;t<r.length;t+=1){let n=r[t];t<r.length-1&&!n.endsWith(`
`)?e=e.concat(`${n}
`):e=e.concat(n)}return e}return r.toString()}function lg(r){if(Array.isArray(r))return r;let e=r.toString();if(e.length>0){let t=e.split(`
`);return t.map((n,i)=>i<t.length-1?`${n}
`:n).filter(n=>n.length>0)}return[]}function Pae(r){let e=r;do r=e,e=r.replace(/[^\n]\x08/gm,"");while(e.length<r.length);return r}function kae(r){for(r=r.replace(/\r+\n/gm,`
`);r.search(/\r[^$]/g)>-1;){var e=r.match(/^(.*)\r+/m)[1],t=r.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),r=r.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return r}function QV(r){return kae(Pae(r))}var fP="'''",hP='"""';function Cm(r,e,t){let n,i,o=0;for(let s of r){let a=s.trim(),c=a.startsWith(fP)?fP:a.startsWith(hP)?hP:void 0,l=a.includes(fP)?fP:a.includes(hP)?hP:void 0;if(i)i===l&&(i=void 0),t(s,o);else if(n)n===c&&(n=void 0),n&&e(s,o);else if(l&&!c){let u=a.indexOf(l);i=a.lastIndexOf(l)!==u?void 0:l,t(s,o)}else if(c){let u=a.indexOf(c,3);n=u>=0?void 0:c,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function ug(r,e=`
`,t){return r.map((n,i)=>{let o=t?t(n):n;return i===r.length-1?`${o}`:`${o}${e}`})}function Dae(r){let e=[];return Cm(r,t=>e.push(t),t=>{}),e}function vP(r){return ug(Dae(r.slice(r.length>1?1:0)))}function YV(r){let e=r.length,t=-1;return r.forEach((n,i)=>{n.trim()&&(e=i,t<0&&(t=i))}),t>=0?r.slice(t,e+1):[]}function yP(r){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(r);if(e&&e.length>2){let t=parseInt(e[1],10),n=parseInt(e[2],10),i=parseInt(e[3],10);return(0,HV.parse)(`${t}.${n}.${i}`,!0)??void 0}}function Jl(r){if(mp()){let e=JSON.parse(JSON.stringify(r.metadata.custom||{}))||{},t=e;return t.metadata=t.metadata||{},e}else{let e=JSON.parse(JSON.stringify(r.metadata||{}))||{metadata:{}};return e.metadata=e.metadata||{},e}}function mp(){try{let r=ka.extensions.getExtension("vscode.ipynb");if(r&&typeof r.exports.dropCustomMetadata=="boolean")return!r.exports.dropCustomMetadata}catch{return!0}try{return!ka.workspace.getConfiguration("jupyter",void 0).get("experimental.dropCustomMetadata",!1)}catch{return!0}}function gP(r){return _ae(r)}function _ae(r){return Array.isArray(r)?r.map(gP):r!=null&&typeof r=="object"&&Object.keys(r).length>0?Object.keys(r).sort().reduce((e,t)=>(e[t]=gP(r[t]),e),{}):r}var bP=new Map,jN=new Map,UN;function XV(r){UN=r}function WN(r,e){if(!r.pythonEnvironmentPath)return;let t=le();Tae({interpreterHash:r.pythonEnvironmentPath}).then(n=>{r.pythonEnvironmentPackages=n||r.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=n||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function Tae(r){if(!UN)return C("Python package provider is not initialized."),"{}";let e;if("interpreter"in r?e=r.interpreter:e=jN.get(r.interpreterHash),!e)return"{}";let t=await UN(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function ZV(r){if(!r)return{};let e=bP.get(vn(r)),t=ro(r);if(!e&&t)return{resourceType:t,resourceHash:r?await vt(r.toString()):void 0};if(!e)return{};let n=JSON.parse(JSON.stringify(e[0]));return WN(e[0],n),n}function wt(r,e,t,n,i){ZV(r).then(o=>{Object.assign(o,n||{}),N(e,t,o,i)}).catch(f)}var Mn=!1,pg=new WeakMap,IP=new Map,dg,t9=0;function On(r){if(!r)return;if(Cn(r)&&!IP.has(r.toString())){let t=wm.workspace.notebookDocuments.find(n=>n.uri.toString()===r.toString());t&&IP.set(r.toString(),new WeakRef(t))}let e=Cn(r)?IP.get(r.toString())?.deref():r;if(e)return pg.get(e)?.tracker}function r9(r){let e=new En;return dg=r,t9=r.elapsedTime,wm.workspace.notebookDocuments.forEach(t=>pg.set(t,e9(t,!0,r))),e.add(wm.workspace.onDidOpenNotebookDocument(t=>{!pg.has(t)&&!Mn&&pg.set(t,e9(t,!1,r))})),e.add(wm.workspace.onDidCloseNotebookDocument(t=>{pg.delete(t),IP.delete(t.uri.toString())})),e}function n9(r){pg.get(r)?.tracker.kernelManuallySelected()}var SP={starAfter:-1,completedAfter:-1},VN=new Map,i9=new Map,Rae=new Map,o9=zt(()=>(SP.starAfter=dg?.elapsedTime,{stop:zt(()=>{SP.completedAfter=dg.elapsedTime})}));function s9(r,e){VN.set(r,dg?.elapsedTime),Rae.set(r,e||"")}function a9(r){r.executable.uri&&i9.set(r.id,dg?.elapsedTime)}function e9(r,e,t){let n=dg.elapsedTime,i=t.elapsedTime,o={openedAfter:i},s=l=>(l==="executeCell"&&(Mn=!0),o[`${l}StartedAfter`]=t.elapsedTime,{stop:zt(()=>{o[`${l}CompletedAfter`]=t.elapsedTime})}),a={wasAlreadyOpen:e},c=()=>{};return{measures:o,info:a,tracker:{kernelSelected:zt((l,u)=>{let p=VN.get(l);typeof p=="number"&&(a.wasAlreadyOpen?o.controllerCreatedAfter=VN.get(l):o.controllerCreatedAfter=n-p),o.interpreterDiscoveredAfter=i9.get(u||""),o.kernelSelectedAfter=t.elapsedTime,a.manuallySelectedKernel||Mae(r,{wasAlreadyOpen:a.wasAlreadyOpen},{controllerCreatedAfter:o.controllerCreatedAfter,kernelSelectedAfter:o.kernelSelectedAfter,openedAfter:i,interpreterDiscoveredAfter:o.interpreterDiscoveredAfter})}),kernelManuallySelected:zt(()=>a.manuallySelectedKernel=!0),cellExecutionCount:Mn?c:zt(l=>o.executeCellCount=l),preExecuteCellTelemetry:Mn?c:zt(()=>s("preExecuteCellTelemetry")),startKernel:Mn?c:zt(()=>s("startKernel")),executeCell:Mn?c:zt(()=>s("executeCell")),executeCellAcknowledged:Mn?c:zt(()=>{o.executeCellAcknowledgedAfter=t.elapsedTime,Aae(r,a,o)}),jupyterSessionTelemetry:Mn?c:zt(()=>s("sessionTelemetry")),postKernelStartup:Mn?c:zt(()=>s("postKernelStart")),computeCwd:Mn?c:zt(()=>s("computeCwd")),getConnection:Mn?c:zt(()=>s("getConnection")),updateConnection:Mn?c:zt(()=>s("updateConnection")),kernelReady:Mn?c:zt(()=>s("kernelReady")),portUsage:Mn?c:zt(()=>s("portUsage")),spawn:Mn?c:zt(()=>s("spawn")),pythonEnvVars:Mn?c:zt(()=>s("pythonEnvVars")),envVars:Mn?c:zt(()=>s("envVars")),interruptHandle:Mn?c:zt(()=>s("interruptHandle")),kernelInfo:Mn?c:zt(()=>s("kernelInfo")),kernelIdle:Mn?c:zt(()=>s("kernelIdle"))}}}var Aae=zt(function(r,e,t){if(typeof t.preExecuteCellTelemetryStartedAfter!="number"||typeof t.preExecuteCellTelemetryCompletedAfter!="number"||typeof t.executeCellAcknowledgedAfter!="number"||typeof t.startKernelStartedAfter!="number"||typeof t.startKernelCompletedAfter!="number"||typeof t.executeCellStartedAfter!="number"||typeof t.sessionTelemetryStartedAfter!="number"||typeof t.sessionTelemetryCompletedAfter!="number"||typeof t.postKernelStartStartedAfter!="number"||typeof t.postKernelStartCompletedAfter!="number"||typeof t.kernelInfoStartedAfter!="number"||typeof t.kernelInfoCompletedAfter!="number"||typeof t.kernelIdleStartedAfter!="number"||typeof t.kernelIdleCompletedAfter!="number"||typeof t.computeCwdStartedAfter!="number"||typeof t.computeCwdCompletedAfter!="number"||typeof t.kernelReadyStartedAfter!="number"||typeof t.kernelReadyCompletedAfter!="number"||typeof t.getConnectionStartedAfter!="number"||typeof t.getConnectionCompletedAfter!="number"||typeof t.updateConnectionStartedAfter!="number"||typeof t.updateConnectionCompletedAfter!="number"||typeof t.portUsageStartedAfter!="number"||typeof t.portUsageCompletedAfter!="number"||typeof t.spawnStartedAfter!="number"||typeof t.spawnCompletedAfter!="number"||typeof t.pythonEnvVarsStartedAfter!="number"||typeof t.pythonEnvVarsCompletedAfter!="number"||typeof t.envVarsStartedAfter!="number"||typeof t.envVarsCompletedAfter!="number")return;let n={duration:0,preExecuteCellTelemetry:0,startKernel:0,executeCell:0};{let l=[{name:"preExecuteCellTelemetry",start:t.preExecuteCellTelemetryStartedAfter,end:t.preExecuteCellTelemetryCompletedAfter},{name:"startKernel",start:t.startKernelStartedAfter,end:t.startKernelCompletedAfter},{name:"executeCell",start:t.executeCellStartedAfter,end:t.executeCellAcknowledgedAfter}],u=t.executeCellAcknowledgedAfter-t.preExecuteCellTelemetryStartedAfter;n.duration=u,gx(n,l,u,t.openedAfter)}let i={sessionTelemetry:0,postKernelStart:0,computeCwd:0,getConnection:0,updateConnection:0,kernelReady:0,portUsage:0,spawn:0};{let l=[{name:"sessionTelemetry",start:t.sessionTelemetryStartedAfter,end:t.sessionTelemetryCompletedAfter},{name:"postKernelStart",start:t.postKernelStartStartedAfter,end:t.postKernelStartCompletedAfter},{name:"computeCwd",start:t.computeCwdStartedAfter,end:t.computeCwdCompletedAfter},{name:"getConnection",start:t.getConnectionStartedAfter,end:t.getConnectionCompletedAfter},{name:"updateConnection",start:t.updateConnectionStartedAfter,end:t.updateConnectionCompletedAfter},{name:"spawn",start:t.spawnStartedAfter,end:t.spawnCompletedAfter},{name:"portUsage",start:t.portUsageStartedAfter,end:t.portUsageCompletedAfter},{name:"kernelReady",start:t.kernelReadyStartedAfter,end:t.kernelReadyCompletedAfter}],u=t.startKernelCompletedAfter-t.startKernelStartedAfter;gx(i,l,u,t.openedAfter)}let o={startupCode:0,kernelInfo:0,kernelIdle:0};{let l=[{name:"startupCode",start:t.postKernelStartStartedAfter,end:t.kernelInfoStartedAfter},{name:"kernelInfo",start:t.kernelInfoStartedAfter,end:t.kernelInfoCompletedAfter},{name:"kernelIdle",start:t.kernelIdleStartedAfter,end:t.kernelIdleCompletedAfter}],u=t.postKernelStartCompletedAfter-t.postKernelStartStartedAfter;gx(o,l,u,t.openedAfter)}let s={pythonEnvVars:0,envVars:0,interruptHandle:0};{let l=[{name:"pythonEnvVars",start:t.pythonEnvVarsStartedAfter,end:t.pythonEnvVarsCompletedAfter},{name:"envVars",start:t.envVarsStartedAfter,end:t.envVarsCompletedAfter},{name:"interruptHandle",start:t.interruptHandleStartedAfter||0,end:t.interruptHandleCompletedAfter||0}],u=t.spawnCompletedAfter-t.spawnStartedAfter;gx(s,l,u,t.openedAfter)}let a=Nae(r),c={...n,...i,...o,...s,...a};wt(r.uri,"DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",c,e)});function Nae(r){let e={attachmentCharLength:0,attachmentCount:0,codeCellCharLength:0,codeCellCount:0,mdCellCharLength:0,mdCellCount:0,outputCount:0,outputsByteSize:0};return r.getCells().forEach(t=>{let n=t.document.lineAt(t.document.lineCount-1).range.end,i=t.document.offsetAt(n);if(t.kind===wm.NotebookCellKind.Markup){e.mdCellCount+=1,e.mdCellCharLength+=i;try{let s=Jl(t).attachments||{};Object.keys(s).forEach(a=>{e.attachmentCount+=1;let c=s[a];typeof c=="object"&&Object.keys(c).forEach(l=>{let u=c[l];u&&typeof u=="string"&&(e.attachmentCharLength+=u.length)})})}catch(o){U("Error parsing attachments in cell metadata",o)}}else e.codeCellCount+=1,e.codeCellCharLength+=i,e.outputCount+=t.outputs.length,e.outputsByteSize+=t.outputs.reduce((o,s)=>o+s.items.reduce((a,c)=>a+c.data.byteLength,0),0)}),e}var Mae=zt(function(r,e,t){if(t.pythonExtensionActivationStartedAfter=SP.starAfter,t.pythonExtensionActivationCompletedAfter=SP.completedAfter,typeof t.controllerCreatedAfter>"u"||typeof t.interpreterDiscoveredAfter>"u"||typeof t.pythonExtensionActivationCompletedAfter>"u"||typeof t.pythonExtensionActivationStartedAfter>"u")return;let n=[{name:"callPythonApi",start:t9,end:t.pythonExtensionActivationStartedAfter},{name:"activatePython",start:t.pythonExtensionActivationStartedAfter,end:t.pythonExtensionActivationCompletedAfter},{name:"discoverEnv",start:t.pythonExtensionActivationCompletedAfter,end:t.interpreterDiscoveredAfter},{name:"createController",start:t.interpreterDiscoveredAfter,end:t.controllerCreatedAfter},{name:"selectController",start:t.controllerCreatedAfter,end:t.kernelSelectedAfter}],i=t.kernelSelectedAfter-t.openedAfter,o={duration:i};gx(o,n,i,t.openedAfter),wt(r.uri,"DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",o,e)});function gx(r,e,t,n){e.sort((i,o)=>i.start-o.start).forEach(i=>{typeof n=="number"&&n>=i.start&&n<=i.end?r[i.name]=(i.end-n)*100/t:typeof n=="number"&&n>i.end?r[i.name]=0:(typeof n=="number"&&n<i.start||typeof n!="number")&&(r[i.name]=(i.end-i.start)*100/t)})}function vx(r,e){if(r){let t={...r,uri:Dt.Uri.file(r.path||""),id:e||r.id};return delete t.path,t}}function l9(r){let e,t=r.id;if(r.executable.uri)e=r.executable.uri;else if(Be(r)==="Conda")e=jr()==="Windows"?Dt.Uri.joinPath(r.environment?.folderUri||Dt.Uri.file(r.path),"python.exe"):Dt.Uri.joinPath(r.environment?.folderUri||Dt.Uri.file(r.path),"bin","python");else{U(`Python environment ${B(r.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Em(r){if(r){let e=Object.assign({},r,{path:Ae(r.uri)});return delete e.uri,e}}var mg=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=le();this.didActivatePython=new Dt.EventEmitter;this._pythonExtensionHooked=le();this.extensionChecker.isPythonExtensionInstalled||Dt.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(f),this.api.promise}async getNewApi(){await this.init();let e=Dt.extensions.getExtension(li);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new c9.SemVer(e?.packageJSON?.version)),e?.exports&&(mV(e.exports),e.exports.environments.known.forEach(t=>{a9(t)})),e?.exports}setApi(e){this.api.resolved||!Dt.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;Dt.extensions.getExtension(li)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=Dt.extensions.getExtension(li);if(!e)return;let t=!1;if(!e.isActive){let n=o9();try{let i=e.activate();i.then(()=>n.stop(),()=>n.stop()),await i,t=!0}catch(i){C("Failed activating the python extension: ",i),this.api.reject(new rP(i));return}}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(C("Python extension is not exporting the jupyter API"),this.api.reject(new nP)),this._pythonExtensionHooked.resolve())}};mg=v([(0,Ks.injectable)(),d(0,(0,Ks.inject)(F)),d(1,(0,Ks.inject)(Ye))],mg);var fp=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new Dt.EventEmitter;Dt.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return Dt.extensions.getExtension(li)!==void 0}get isPythonExtensionActive(){return Dt.extensions.getExtension(li)?.isActive===!0}async directlyInstallPythonExtension(){return Dt.commands.executeCommand("workbench.extensions.installExtension",li,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!Dt.workspace.isTrusted)return;fp.promptDisplayed=!0;let e=ve.bannerLabelYes;N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await Dt.window.showInformationMessage(b.pythonExtensionRequired,{modal:!0},e)===e?(N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){Dt.commands.executeCommand("extension.open",li).then(f,f)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};fp=v([(0,Ks.injectable)(),d(0,(0,Ks.inject)(F))],fp);var fg=class{constructor(e,t,n,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=n;this.context=i;this.didChangeInterpreter=new Dt.EventEmitter;this.didChangeInterpreters=new Dt.EventEmitter;this._onDidEnvironmentVariablesChange=new Dt.EventEmitter;this._onDidRemoveInterpreter=new Dt.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this._status="idle";this._onDidChangeStatus=new Dt.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new Io;this.onResumeEnvDetection=new Dt.EventEmitter;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&!this.extensionChecker.isPythonExtensionActive&&this.apiProvider.onDidActivatePythonExtension(()=>{this.hookupOnDidChangeInterpreterEvent()},this,this.disposables),Dt.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"})}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}initialize(){this.hookupOnDidChangeInterpreterEvent()}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let n=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(n||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}async refreshInterpreters(e=!1){let t=(async()=>{let n=await this.getApi();if(n)try{await n.environments.refreshEnvironments({forceRefresh:e}),this.hookupOnDidChangeInterpreterEvent(),P("Refreshed Environments")}catch{C("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>Di(1e3))),await t}async getActiveInterpreter(e){if(!Dt.workspace.isTrusted)return;let t=new Ge;this.hookupOnDidChangeInterpreterEvent(),!e&&Dt.workspace.workspaceFolders?.length===1&&(e=Dt.workspace.workspaceFolders[0].uri),Dt.workspace.workspaceFolders?.length&&(e=(e?Dt.workspace.getWorkspaceFolder(e)?.uri:void 0)||Dt.workspace.workspaceFolders[0].uri);let n=Ns(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(n)||(this.workspaceCachedActiveInterpreter.add(n),N("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{U(`Failed to get active interpreter from Python for workspace ${n}`,o)}),(ci||[Dt.ExtensionMode.Development,Dt.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${B(e)}'-${B(o?.id)}`;if(this.lastLoggedResourceAndInterpreterId===s)return;this.lastLoggedResourceAndInterpreterId=s;let a=Zi(o);ee(`Active Interpreter ${e?`for '${B(e)}' `:""}is ${B(o?.id)} (${o&&Be(o)}, '${o?Ho(o):""}', ${a?.major}.${a?.minor}.${a?.micro})`)}).catch(f),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!Dt.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async n=>{if(!n||t?.isCancellationRequested)return;let i=n.environments.known.find(c=>Cn(e)?Go(c.executable.uri,e):typeof e=="string"?c.id===e:Go(Dt.Uri.file(c.path),Dt.Uri.file(e.path))),o=Cn(e)?B(e):typeof e=="string"?e:B(Dt.Uri.file(e.path));if(i){let c=await n.environments.resolveEnvironment(i),l=this.trackResolvedEnvironment(c);return ne(`Interpreter details for ${o} from Python is ${JSON.stringify(c)} and our mapping is ${JSON.stringify(l)}`),l}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),U(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await n.environments.resolveEnvironment(Cn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(n){U(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:B(Cn(e)?e:Dt.Uri.file(e.path))}`,n);return}}trackResolvedEnvironment(e){if(e){let t=Oi(e);return t?(Pc(t).then(n=>{this.pythonEnvHashes.set(t.id,n)}).catch(f),this.triggerEventIfAllowed("interpretersChangeEvent",t),t):void 0}}triggerEventIfAllowed(e,t){e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),this.triggerPendingEvents()}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(n=>!!n);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi()),this.apiPromise}hookupOnDidChangeInterpreterEvent(){this.eventHandlerAdded||this.getApi().then(e=>{!this.eventHandlerAdded&&e&&(this.eventHandlerAdded=!0,e.environments.onDidEnvironmentVariablesChange(t=>{P(`Detected changes to env file ${t.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),e.environments.onDidChangeActiveEnvironmentPath(()=>{P("Detected change in Active Python environment via Python API"),this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),e.environments.onDidChangeEnvironments(async t=>{if(P(`Python API env change detected, ${t.type} => '${t.env.id}'`),t.type==="remove"){this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:t.env.id});return}let n=Oi(Mr(t.env));n&&(this.triggerEventIfAllowed("interpreterChangeEvent",n),this.triggerEventIfAllowed("interpretersChangeEvent",n))},this,this.disposables),this.didChangeInterpreters.fire(bo().map(Oi).filter(t=>!!t).map(t=>t)))}).catch(f)}};fg=v([(0,Ks.injectable)(),d(0,(0,Ks.inject)(tr)),d(1,(0,Ks.inject)(Ye)),d(2,(0,Ks.inject)(F)),d(3,(0,Ks.inject)(lt))],fg);var hg=require("vscode");function xP(r,e){let t=r.length>0?`?token=${r}`:"";return`${e}${t}`}function CP(r,e,t){return r?t.createSystemVariables(e).resolve(r):e?dt(Ae(e)):process.cwd()}async function wP(r,e){let t=b.jupyterSelfCertEnable,n=b.jupyterSelfCertClose,i=await hg.window.showErrorMessage(b.jupyterSelfCertFail(e),{modal:!0},t,n);return i===t?(N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,hg.ConfigurationTarget.Workspace),!0):(i===n&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function EP(r,e){let t=b.jupyterSelfCertEnable,n=b.jupyterSelfCertClose,i=await hg.window.showErrorMessage(b.jupyterExpiredCertFail(e),{modal:!0},t,n);return i===t?(N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,hg.ConfigurationTarget.Workspace),!0):(i===n&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function yx(r,e,t,n,i,o,s){let a=e.baseUrl,c=e.token,l=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0,p=u?()=>u:void 0,m={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},h=t.getRequestInit();(!(c===""||c==="null")||p)&&(m={...m,token:c,appendToken:!0});let y=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&y&&n){let A=n.createHttpRequestAgent();h={...h,agent:A}}let{ServerConnection:x}=require("@jupyterlab/services");return m={...m,init:h,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,y,p),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,y,p),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:r.id,serverProviderHandle:r,token:c,hostName:l,displayName:e&&e.displayName?e.displayName:xP(c,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:p,settings:x.makeSettings(m)}}async function u9(r){let e=Vt(r);return Ea(e,"SHA-256")}var Oae=new Set([Je,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(r=>r.toLowerCase()));function Vt(r){return Oae.has(r.extensionId.toLowerCase())?`${Qe.REMOTE_URI}?${Qe.REMOTE_URI_ID_PARAM}=${r.id}&${Qe.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}`:`${Qe.REMOTE_URI}?${Qe.REMOTE_URI_ID_PARAM}=${r.id}&${Qe.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}&${Qe.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(r.extensionId)}`}async function PP(r){if(!Xu()&&r.interpreter?.uri){let e=r.interpreter.uri.fsPath,t=Ec(r.interpreter.uri).fsPath,n=r.id.replace(e,t);return vt(n)}return vt(r.id)}var Fs=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=vx(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return hp.create(t);case"connectToLiveRemoteKernel":return bx.create(t);case"startUsingRemoteKernelSpec":return Ix.create(t);case"startUsingPythonInterpreter":return zo.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},bx=class r{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,DP(this)}static create(e){return new r(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return PP(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:Em(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Fs.fromJSON(e)}},hp=class r{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,DP(this)}static create(e){return new r(e)}getHashId(){return PP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Em(this.interpreter),kind:this.kind}}static fromJSON(e){return Fs.fromJSON(e)}},Ix=class r{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,DP(this)}static create(e){return new r(e)}getHashId(){return PP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Em(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Fs.fromJSON(e)}},zo=class r{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,DP(this)}static create(e){return new r(e)}getHashId(){return PP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Em(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return Fs.fromJSON(e)}};function yt(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"}function Ft(r){return!yt(r)}var Ke=Symbol("IKernelProvider"),Pm=Symbol("IThirdPartyKernelProvider");var kP=Symbol("IJupyterServerConnector"),Sx=Symbol("IKernelSessionFactory");var Ls=Symbol("IKernelDependencyService"),Or=Symbol("IKernelFinder"),gg=Symbol("ITracebackFormatter");var $l=Symbol("IStartupCodeProviders"),p9=new Set;function DP(r){if(p9.has(r.id))return;p9.add(r.id);let e="kernelSpec"in r?r.kernelSpec:void 0,t=e?.language||(r.kind==="startUsingPythonInterpreter"?xe:void 0),n="",i="",o="interpreter"in r?r.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(n=e.argv[0],a=n.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),_e(n)!==n&&(n=`<P>${_e(n)}`),i=e.argv.map(h=>h.includes("/")||h.includes("\\")?`<P>${_e(h)}`:h).join(s));let c="kernelSpec"in r&&r.kernelSpec.specFile?vt(r.kernelSpec.specFile):Promise.resolve(""),l=vt(r.id),u=Ft(r)?vt(Vt(r.serverProviderHandle)):Promise.resolve(""),p=Ft(r)?r.serverProviderHandle.extensionId:Je,m=Ft(r)?vt(r.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([c,l,u,m]).then(([h,g,y,x])=>N("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:g,serverIdHash:y,kernelSpecHash:h,baseUrlHash:x,providerExtensionId:p,kernelConnectionType:r.kind,kernelLanguage:t,envType:o&&Be(o),isArgv0SameAsInterpreter:a,argv0:n,argv:i})).catch(f)}var kn=require("vscode");var ece=D(w9()),Gl=require("vscode");var gp=class{constructor(e,t,n,i){this.specFile=t;this.interpreterPath=n;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var qn=require("vscode"),A9=D($N());var HN=class{constructor(e,t,n,i=!1){this._impl=e;this.controllerId=t;this._endCallback=n;this.clearOutputOnStartWithTime=i;this.started=!1}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){e&&On(this._impl.cell.notebook)?.executeCellAcknowledged(),this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this.started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(P(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(f,f)):P(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t,this.errorInfo),ee(`Cell ${this.cell.index} completed in ${((t||0)-(this._startTime||0))/1e3}s (start: ${this._startTime}, end: ${t})`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},Ki=class r{static{this._map=new WeakMap}static getOrCreate(e,t,n=!1){let i,o=e.document;if(i=this.get(e),!i)i=r.create(o,e,t,n);else if(i.controllerId!==t.id){let s=i;s.end(void 0),i=r.create(o,e,t,n),s.started&&i.start(new Date().getTime())}return i}static get(e){let t=e.document;return r._map.get(t)}static create(e,t,n,i=!1){let o=new HN(n.createNotebookCellExecution(t),n.id,()=>{r._map.delete(e)},i);return r._map.set(e,o),o}};function vg(r){return typeof Buffer<"u"&&typeof Buffer.from=="function"?Buffer.from(r,"base64"):Uint8Array.from(atob(r),e=>e.charCodeAt(0))}var Gae=new TextDecoder;function TP(r){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(r).toString("base64");{let e=Gae.decode(r);return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,n){return String.fromCharCode(Number.parseInt("0x"+n))}))}}var D9=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function _9(r){if(r.mime.startsWith("application/vnd."))try{return new TextDecoder().decode(r.data).length===0}catch{}return!1}function zae(r){return r.sort((e,t)=>{let n=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=D9.findIndex(s=>n(s,e.mime)),o=D9.findIndex(s=>n(s,t.mime));return _9(e)&&(i=-1),_9(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var Hl=class r{static{this.cellStates=new WeakMap}static getCellState(e){return r.cellStates.get(e)?.state}static getCellStatus(e){return(r.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let n=r.cellStates.get(e)?.start||new Ge,i=r.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${n.elapsedTime}ms`}`),r.cellStates.set(e,{stateTransition:i,state:t,start:n})}};function bt(r,e){let t=typeof e=="string"?()=>e:e;ne(()=>`Cell Index:${r.index}, of document ${yn(r.notebook.uri)} with state:${Hl.getCellStatus(r)}, exec: ${r.executionSummary?.executionOrder}. ${t()}. called from ${bV()}`)}var bg=new Map;bg.set("display_data",AP);bg.set("error",Zae);bg.set("execute_result",AP);bg.set("stream",Qae);bg.set("update_display_data",AP);function xo(r){let e=bg.get(r.output_type),t;return e?t=e(r):(U(`Unable to translate cell from ${r.output_type} to NotebookCellData for VS Code.`),t=AP(r)),t}function GN(r){let e={outputType:r.output_type};switch(r.transient&&(e.transient=r.transient),r.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=r.execution_count,e.metadata=r.metadata?JSON.parse(JSON.stringify(r.metadata)):{};break}default:break}return e}function km(r){return r.metadata}function AP(r){let e=GN(r);("image/svg+xml"in r.data||"image/png"in r.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(r.data)for(let n in r.data)t.push(Xae(n,r.data[n]));return new qn.NotebookCellOutput(zae(t),e)}function Qae(r){let e=Os(r.text),t=r.name==="stderr"?qn.NotebookCellOutputItem.stderr:qn.NotebookCellOutputItem.stdout;return new qn.NotebookCellOutput([t(e)],GN(r))}function Yae(r){if(r.items.length>0)return r.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function T9(r){let e=r.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=r.metadata?.originalError,n=JSON.parse(new TextDecoder().decode(e.data));return{output_type:"error",ename:n.name,evalue:n.message,traceback:t?.traceback||lg(n.stack||n.message||"")}}var yg=new TextDecoder,N9=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function RP(r,e){if(!e)return"";try{if(r==="application/vnd.code.notebook.error"){let t=yg.decode(e);return JSON.parse(t)}else if(r.startsWith("text/")||N9.includes(r)){let t=yg.decode(e);return lg(t)}else{if(r.startsWith("image/")&&r!=="image/svg+xml")return TP(e);if(r.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&r.toLowerCase().endsWith("+json")){let t=yg.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(r.toLowerCase().includes("json")){let t=yg.decode(e);return t.length>0?JSON.parse(t):t}else return yg.decode(e)}}catch(t){return C(`Failed to convert ${r} output from a buffer ${typeof e}, ${e}`,t),""}}function Xae(r,e){if(!e)return qn.NotebookCellOutputItem.text("",r);try{if((r.startsWith("text/")||N9.includes(r))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?Os(e):e;return qn.NotebookCellOutputItem.text(t,r)}else return r.startsWith("image/")&&typeof e=="string"&&r!=="image/svg+xml"?new qn.NotebookCellOutputItem(vg(e),r):typeof e=="object"&&e!==null&&!Array.isArray(e)?qn.NotebookCellOutputItem.text(JSON.stringify(e),r):(e=Array.isArray(e)?Os(e):e,qn.NotebookCellOutputItem.text(e,r))}catch(t){return C(`Failed to convert ${r} output to a buffer ${typeof e}, ${e}`,t),qn.NotebookCellOutputItem.text("")}}function R9(r){let e=[];r.items.filter(n=>n.mime==="application/vnd.code.notebook.stderr"||n.mime==="application/vnd.code.notebook.stdout").map(n=>yg.decode(n.data)).forEach(n=>{let i=n.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let n=0;n<e.length-1;n++)e[n]=`${e[n]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:Yae(r)||"stdout",text:e}}function zN(r){let e=r.metadata,t;switch(e?.outputType){case"error":{t=T9(r);break}case"stream":{t=R9(r);break}case"display_data":{t={output_type:"display_data",data:r.items.reduce((i,o)=>(i[o.mime]=RP(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:r.items.reduce((i,o)=>(i[o.mime]=RP(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:r.items.reduce((i,o)=>(i[o.mime]=RP(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=r.items.length===1&&r.items.every(c=>c.mime==="application/vnd.code.notebook.error"),o=r.items.every(c=>c.mime==="application/vnd.code.notebook.stderr"||c.mime==="application/vnd.code.notebook.stdout");if(i)return T9(r);let s=e?.outputType||(o?"stream":"display_data");N("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=R9(r):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),r.items.length>0&&(a.data=r.items.reduce((c,l)=>(c[l.mime]=RP(l.mime,l.data),c),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function Zae(r){return r=r||{output_type:"error",ename:"",evalue:"",traceback:[]},new qn.NotebookCellOutput([qn.NotebookCellOutputItem.error({name:r?.ename||"",message:r?.evalue||"",stack:(r?.traceback||[]).join(`
`)})],{...GN(r),originalError:r})}async function M9(r,e,t){let n=!1,i;if(!r)return{changed:n,kernelId:i};r?.language_info?.name||(r.language_info=r.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=xe;break;default:break}if(r.language_info.name!==o&&o&&(r.language_info.name=o,n=!0),t&&"language_info"in t&&t.language_info)(0,A9.default)(r.language_info,t.language_info)||(r.language_info=JSON.parse(JSON.stringify(t.language_info)),n=!0);else{let a=It(e),c=a?K9(e):void 0,l=await pp(c),u=l?`${l.major}.${l.minor}.${l.micro}`:"";c&&l&&r&&r.language_info&&r.language_info.version!==u?(r.language_info.version=u,n=!0):!c&&r?.language_info&&a&&(r.language_info=void 0,n=!0)}let s=e&&Ig(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,c=a.display_name||Mr(e.interpreter)?.environment?.name||"",l="";switch(Jn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":l="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{l=(a.metadata?.vscode?.originalSpecFile?_e(dt(a.metadata.vscode.originalSpecFile)):void 0)||a.name,c=a.metadata?.vscode?.originalDisplayName||c;break}default:l=a.name;break}r.kernelspec?.name!==l&&(n=!0,r.kernelspec={name:l,language:xe,display_name:c},"vscode"in r&&delete r.vscode,"interpreter"in r&&delete r.interpreter)}else if(s&&!r.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?_e(dt(s.metadata.vscode.originalSpecFile)):void 0;r.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(r.kernelspec.language=s.language),i=s.id,n=!0}else if(s&&r.kernelspec){let c=(s.metadata?.vscode?.originalSpecFile?_e(dt(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",l=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(r.kernelspec.name!==c||r.kernelspec.language!==u||r.kernelspec.display_name!==l||i!==s.id)&&(n=!0,r.kernelspec.name=c,r.kernelspec.display_name=l,r.kernelspec.language=u,i=s.id);try{delete r.kernelspec.metadata}catch{}}return{changed:n,kernelId:i}}async function vp(r,e,t,n){let i=Yh(t);if(!i){let s=Ki.get(r);n&&s?.started&&s.end(n?void 0:!1,r.executionSummary?.timing?.endTime);return}Ki.get(r)||(n=!0);let o=Ki.getOrCreate(r,e);o.started||(o.start(r.executionSummary?.timing?.endTime),o.executionOrder=r.executionSummary?.executionOrder),await o.appendOutput(i),o.end(n?void 0:!1,r.executionSummary?.timing?.endTime)}function O9(r,e){let t=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,n=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\][^<]*<cell line:\s?(?<lineNumber>\d+)>.*/,i;for(let s of r){let a=t.exec(s)??n.exec(s);if(a&&a.groups){i=parseInt(a.groups.lineNumber);break}}let o;if(i&&i>0&&i<=e.document.lineCount){let s=e.document.lineAt(i-1),a=s.text.split("#")[0].trimEnd().length;o=new qn.Range(new qn.Position(s.lineNumber,s.firstNonWhitespaceCharacterIndex),new qn.Position(s.lineNumber,a))}return o}function xx(r){if(r.hasOwnProperty("text/html")){let e=r["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(r["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return r}var Dm="{connection_file}";function F9(r){return r.argv.findIndex(e=>e.includes(Dm))}var Sg="-jvsc-",tce=/^python\d*.?\d*$/;async function Us(r,e){return rce(await ZN(r),r,e)}function rce(r,e,t){let n=e?{path:Ae(e.uri)}:{},i={name:r,language:"python",display_name:(e?Mr(e)?.environment?.name:"")||"Python 3",metadata:{interpreter:n},argv:["python","-m","ipykernel_launcher","-f",Dm],env:{},resources:{}},o=t&&i.name?ir(t,i.name,"kernel.json"):void 0;return new gp(i,o?Ae(o):void 0,Ae(e?.uri),"registeredByNewVersionOfExt")}function L9(r){let e=JSON.parse(JSON.stringify(r));return e.env&&Object.keys(e.env).forEach(n=>{if(e.env){let i=e.env[n];i!=null&&(e.env[n]=i.toString())}}),e}function NP(r){let e=r?.kernelspec;return r?.language_info?.name&&r.language_info.name!==xe?!1:e?.name?.includes(xe)?!0:e?.language===xe||r?.language_info?.name===xe}function wx(r){let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?_e(dt(e)):r.name||"",n=r.metadata?.vscode?.originalDisplayName||r.display_name||"";return!!(t.toLowerCase().match(tce)||n.toLowerCase()==="python 3 (ipykernel)"||n.toLowerCase()==="python 3")}function nce(r){if(r.includes(Sg)){let e=/[a-f0-9]$/;if(r.substring(r.lastIndexOf(Sg)+Sg.length).search(e)!==-1){let t=r.substring(0,r.lastIndexOf(Sg));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return r}function MP(r){return r.kind!=="connectToLiveRemoteKernel"}function Ig(r){return r.kind==="connectToLiveRemoteKernel"}function Fi(r,e,t){e=QN(r)?e:void 0;let n=r.name,i=Jn(r);if(i&&n.includes(Cx)&&(n=n.substring(n.indexOf(Cx)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let l=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile;l&&(n=`${n}#${_e(dt(l))}`)}let o="";QN(r)?o=r.argv.slice(1).filter(l=>!["-f","{connection_file}"].includes(l)).join("#").toLowerCase():o=r.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Ae(Ec(r.interpreterPath?Gl.Uri.file(r.interpreterPath):Gl.Uri.file(r.executable))),c=Ae(Ec(e?.uri))||"";return`${s}${r.id||""}.${n}.${a}.${c}.${o}`}function mt(r){let e=ice(r);if(!r)return e;switch(r.kind){case"connectToLiveRemoteKernel":{let n=nce(r.kernelModel?.notebook?.path||r.kernelModel?.model?.path||"");return n?`${e} (${n})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(r.interpreter&&Be(r.interpreter)!=="Unknown"){let n=Ho(r.interpreter);if(r.kernelSpec.language===xe){let i=`Python ${lp(Zi(r.interpreter))||""}`.trim();return n?`${e} (${i})`:e}else return n?`${e} (${n})`:e}else return e;case"startUsingPythonInterpreter":let t=(lp(Zi(r.interpreter))||"").trim();if(r.interpreter&&Be(r.interpreter)!=="Unknown"){if(r.kernelSpec.display_name&&Jn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return r.kernelSpec.display_name;let n=wr(r.interpreter),i=t.trim()?`Python ${t}`:"Python",o=Ho(r.interpreter);return n&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function ice(r){if(!r)return"";let e=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.display_name:r.kernelSpec?.display_name,t=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name,n=r.kind==="startUsingPythonInterpreter"?Wr(r.interpreter):void 0;return[e,t,n,""].find(i=>typeof i=="string"&&i.length>0)||""}function xg(r,e=""){return r?r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name:e}function oce(r){if(!r)return;let e=Ig(r)?r.kernelModel:void 0,t=MP(r)?r.kernelSpec:void 0;if(r.kind==="startUsingPythonInterpreter"||(r.kind==="startUsingRemoteKernelSpec"||r.kind==="startUsingLocalKernelSpec")&&r.kernelSpec.language===xe){let n=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;if(n==="/python"||n==="python"){let i=Mr(r.interpreter);return i?.environment?.folderUri||(i?Gl.Uri.file(i.path):void 0)}return n?Gl.Uri.file(n):void 0}else{let n=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return n?Gl.Uri.file(n):void 0}}function YN(r,e=""){if(r?.kind==="connectToLiveRemoteKernel"){let t;if(typeof r.kernelModel.lastActivityTime=="string")try{t=new Date(r.kernelModel.lastActivityTime)}catch(n){P(`Error parsing date ${n}`)}else t=r.kernelModel.lastActivityTime;return b.jupyterSelectLiveRemoteKernelDescription(t,r.kernelModel.numberOfConnections)}return e}function XN(r,e){if(r?.kind==="connectToLiveRemoteKernel")return;let t=oce(r),n=Gl.workspace.workspaceFolders?Gl.workspace.workspaceFolders:[];return t?B(t,n,e.homeDir):""}function K9(r){if(!r)return;if(r.interpreter)return r.interpreter;let e=Ig(r)?r.kernelModel:void 0;if(e?.metadata?.interpreter)return vx(e?.metadata?.interpreter,"");let t=MP(r)?r.kernelSpec:void 0;return vx(t?.metadata?.interpreter,"")}function Cg(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"&&r.kernelSpec&&Jn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function It(r){if(!r)return!1;if(r.kind==="startUsingPythonInterpreter")return!0;let e=Ig(r)?r.kernelModel:void 0,t=MP(r)?r.kernelSpec:void 0;return e?.language===xe||QN(t)}function QN(r){return(r?.language||"").toLowerCase()===xe}function Co(r){if(!r)return;if(r.kind==="startUsingPythonInterpreter")return xe;let e=Ig(r)?r.kernelModel:void 0,t=MP(r)?r.kernelSpec:void 0;return e?.language||U9(t)}function OP(r){if(!r)return;let e=r.kernelspec;return U9(e)||r.language_info?.name}function U9(r){return r?.language}var Cx="jvsc74a57bd0";async function ZN(r){let t=(lp(Zi(r))||"3").replace(/\./g,""),n=r?`python${t}`:"";return r?`${n}${Cx}${await Pc(r)}`:"python3"}function Jn(r){if(r.isRegisteredByVSC)return r.isRegisteredByVSC;if(!r.name)return;let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?_e(dt(e)):r.name,n=wx({...r,name:t})?Object.keys(r.env||{}).length>0:typeof e=="string"&&!e.includes(Cx);if(r.name.includes(Cx))return n?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(r.metadata?.interpreter&&r.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function j9(r,e){return!r&&!e?!0:!r&&e||r&&!e?!1:r?.id===e?.id}async function In(r,e,t){P(`Executing silently Code (${r.status}) = ${We(e.substring(0,100)).join("\\n")}`);let n=require("@jupyterlab/services"),i=r.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(n.KernelMessage.isStreamMsg(a))if(ne(`Got io pub message (stream), ${We(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let c=o[o.length-1];c.text+=a.content.text}else{let c={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(c)}else if(n.KernelMessage.isExecuteResultMsg(a)){ne("Got io pub message (execresult)}");let c={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(c)}else if(n.KernelMessage.isDisplayDataMsg(a)){ne("Got io pub message (displaydata)}");let c={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(c)}else if(n.KernelMessage.isErrorMsg(a)){if(ne(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let l=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;C(`${l} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let c={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(c)}else ne(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=We(e.substring(0,100)).join("\\n");return t&&sce(o,t,s),P(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function W9(r,e,t,n){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=r.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=zt(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?n(xo({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?n(xo({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?n(xo({output_type:"display_data",data:xx(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isUpdateDisplayDataMsg(a)?n(xo({output_type:"display_data",data:xx(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?n(xo({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||U(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function sce(r,e,t){r.filter(n=>n.output_type==="error").forEach(n=>{let i=n,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?C(s):U(s),e.telemetryName&&N(e.telemetryName)})}function Da(r){return(e,t=null,n)=>{let i=!1,o;return o=r(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,n),i&&o.dispose(),o}}function eM(r,e=null,t){return new Promise(n=>Da(r)(n,e,t))}var KP="application/vnd.vscode.chat_message",V9=`
def __VSCODE_inject_module():

    def __VSCODE_call_function(function, callback, data=None):
        __VSCODE_send_chat_message__(function, data, callback=callback)

    def __VSCODE_send_chat_message__(function, data, callback):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        import uuid as __VSCODE_send_chat_message__uuid
        import IPython.display as __VSCODE_send_chat_message__ipython_display

        id = str(__VSCODE_send_chat_message__uuid.uuid4())
        requests[id] = callback
        data_is_none = data is None
        __VSCODE_send_chat_message__ipython_display.display({"${KP}": data}, metadata={"id":id, "function": function, "dataIsNone": data_is_none}, raw=True)

        del __VSCODE_send_chat_message__ipython_display
        del __VSCODE_send_chat_message__uuid

    def __VSCODE_on_chat_message(id, data):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        if id in requests:
            requests[id](data)
            del requests[id]
        else:
            raise NotImplementedError(f"Callback not found for message {id}")

    import sys as __VSCODE_send_chat_message__sys
    import IPython as __VSCODE_send_chat_message__IPython
    chat = type(__VSCODE_send_chat_message__IPython)("chat")
    chat.send_message = __VSCODE_send_chat_message__
    chat.call_function = __VSCODE_call_function
    chat.__on_message = __VSCODE_on_chat_message
    __VSCODE_send_chat_message__sys.modules["vscode"] = type(__VSCODE_send_chat_message__IPython)("vscode")
    __VSCODE_send_chat_message__sys.modules["vscode"].chat = chat
    del __VSCODE_send_chat_message__sys
    del __VSCODE_send_chat_message__IPython


__VSCODE_inject_module()
del __VSCODE_inject_module
`,ace=[[new RegExp("\\\\","g"),"\\\\"],[new RegExp('"',"g"),'\\"'],[new RegExp("'","g"),"'"],[new RegExp("\\\b","g"),"\\b"],[new RegExp("\\f","g"),"\\f"],[new RegExp("\\n","g"),"\\n"],[new RegExp("\\r","g"),"\\r"],[new RegExp("\\t","g"),"\\t"]];function B9(r,e){let t=Ex(e),n=typeof t=="string"?`"${t}"`:"None";return`
import vscode as __vscode
try:
    __vscode.chat.__on_message('${r}', ${n})
finally:
    del __vscode
`}function Ex(r){if(typeof r!="string")return r;for(let[e,t]of ace)r=r.replace(e,t);return r}var Px=new WeakMap;function FP(r,e,t){let i=km(t)?.transient?.display_id;if(t.metadata?.outputType!=="display_data"||!i)return;let o=Px.get(e)||new Map;Px.set(e,o);let s=o.get(r)||[];o.set(r,s),s.push(i),s.length>1e3&&s.shift()}function q9(r,e){let t=Px.get(r)||new Map;for(let n of t.values())if(n.includes(e))return!0;return!1}function J9(r,e,t){return((Px.get(e)||new Map).get(r)||[]).includes(t)}function $9(r,e){let t=Px.get(r)||new Map;for(let n of t.values()){let i=n.indexOf(e);i>=0&&n.splice(i,1)}}var Pn=require("vscode");var wg=new Map,H9=new Set,jP=new Pn.EventEmitter;ag(jP);function G9(r){return jP.event(r)}async function z9(r){if(!Pn.workspace.isTrusted)return{accessAllowed:!1};if(r===Je)return{accessAllowed:!0};let e=wg.get(r);return e||(e=cce(r),wg.set(r,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&wg.get(r)===e&&(wg.delete(r),H9.add(r))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function cce(r){let e=await tM();if(e.get(r)===!0)return{result:"allowed"};if(e.get(r)===!1)return{result:"denied"};let t=Pn.extensions.getExtension(r)?.packageJSON?.displayName;if(!t)return C(`Kernel API access revoked, as extension ${r} does not exist!`),{result:"denied"};let n=Pn.l10n.t("Allow"),i=Pn.l10n.t("Deny"),o=await Pn.window.showInformationMessage(Pn.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,r),{modal:!0,detail:Pn.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},n,ve.learnMore,i);switch(o===ve.learnMore?Pn.env.openExternal(Pn.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(f,f):(o===n||o===i)&&await lce(r,o===n),o){case n:return{result:"allowed"};case ve.learnMore:return{result:"learnMore"};case i:return{result:"denied"};default:return{result:"cancelled"}}}async function Q9(){let r=new Set,[e]=await Promise.all([tM().then(t=>new Map(t)),...Array.from(wg.entries()).map(async([t,n])=>{(await n).result!=="allowed"&&r.add(t)})]);return r.forEach(t=>e.set(t,!1)),H9.forEach(t=>e.set(t,e.get(t)===!0)),e}var LP="API.Access",yp;async function tM(r=!1){let e=Pe.instance.get(lt);if(e.extensionMode===Pn.ExtensionMode.Test)return new Map;if(zt(()=>{Pe.instance.get(F).push(e.secrets.onDidChange(i=>{i.key===LP&&(yp=void 0)}))})(),yp&&!r)return yp;let t="";try{return t=await e.secrets.get(LP),!t||t.length===0?new Map:(yp=new Map(Object.entries(JSON.parse(t))),yp)}catch(n){return C(`Failed to parse API access information ${t}`,n),new Map}}var UP=Promise.resolve();async function Y9(r){return UP=UP.then(async()=>{await Promise.all(Array.from(wg.entries()).map(async([t,n])=>{let i=await n;i.result=r.includes(t)===!0?"allowed":"denied"})),yp=new Map(r.map(t=>[t,!0]));let e=Pe.instance.get(lt);if(e.extensionMode!==Pn.ExtensionMode.Test)try{await e.secrets.store(LP,JSON.stringify(Object.fromEntries(yp))),jP.fire()}catch(t){C(`Failed to update API access information ${JSON.stringify(Object.fromEntries(yp))}`,t)}})}async function lce(r,e){return UP=UP.then(async()=>{let t=Pe.instance.get(lt);if(t.extensionMode===Pn.ExtensionMode.Test)return;let n=await tM(!0);if(e!==n.get(r)){n.set(r,e);try{await t.secrets.store(LP,JSON.stringify(Object.fromEntries(n))),jP.fire()}catch(i){C(`Failed to store API access information ${JSON.stringify(Object.fromEntries(n))}`,i)}}})}var nM=class{constructor(e,t){let n=kn.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=kn.workspace.notebookDocuments.find(i=>i.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=mt(t.kernelConnectionMetadata),this.title=kn.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,n),this.eventHandler=kn.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}dispose(){this.eventHandler.dispose(),this.disposable?.dispose()}show(){if(this.deferred&&!this.deferred.completed){let e=this.deferred;return this.deferred=le(),e.resolve(),this.disposable=new kn.Disposable(()=>this.deferred?.resolve())}return this.deferred=le(),this.showProgress().catch(f),this.disposable=new kn.Disposable(()=>this.deferred?.resolve())}async showProgress(){await Di(500),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){!this.notebook||!this.shouldDisplayProgress||kn.window.visibleNotebookEditors.some(e=>e.notebook===this.notebook)&&(this.displayInProgress=!0,await kn.window.withProgress({location:kn.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1)}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}},iM=class r extends or{constructor(t,n,i){super();this.extensionId=t;this.kernel=n;this.execution=i;this._onDidChangeStatus=this._register(new kn.EventEmitter);this._onDidReceiveDisplayUpdate=this._register(new kn.EventEmitter);this.progress=this._register(new nM(t,n)),this._register(Da(n.onDisposed)(()=>this.progress.dispose())),this.language=n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?xe:n.kernelConnectionMetadata.kernelSpec.language||xe,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status))),this._register(i.onDidReceiveDisplayUpdate(s=>{let a=this.kernel.session,c=km(s);c?.outputType==="display_data"&&c?.transient?.display_id&&a&&J9(this.extensionId,a,c?.transient?.display_id)&&this._onDidReceiveDisplayUpdate.fire(s)}));let o=this;this._api=Object.freeze({language:this.language,get status(){return o.kernel.status},onDidChangeStatus:o.onDidChangeStatus.bind(this),get onDidReceiveDisplayUpdate(){if(![Je,Qj].includes(t))throw new Error(`Proposed API is not supported for extension ${t}`);return o.onDidReceiveDisplayUpdate.bind(this)},executeCode:(s,a)=>this.executeCode(s,a),executeChatCode:(s,a,c)=>this.executeChatCode(s,a,c)})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}get onDidReceiveDisplayUpdate(){return this._onDidReceiveDisplayUpdate.event}static createApiKernel(t,n,i){let o=new r(t,n,i);return Pe.instance.get(F).push(o),o._api}async checkAccess(){if(this.extensionId===Je)return;if(this.accessAllowed||(this.accessAllowed=this.doCheckAccess(),this._register(G9(()=>this.accessAllowed=void 0))),!await this.accessAllowed)throw new Error(kn.l10n.t("Access to Jupyter Kernel has been revoked"))}async doCheckAccess(){let n=(await z9(this.extensionId)).accessAllowed;return N("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:this.extensionId,pemUsed:"getKernel",accessAllowed:n}),n}async*executeCode(t,n){await this.checkAccess();for await(let i of this.executeCodeInternal(t,void 0,n))yield i}async*executeChatCode(t,n,i){if(await this.checkAccess(),!["ms-vscode.dscopilot-agent",Je].includes(this.extensionId.toLowerCase()))throw new Error(`Proposed API is not supported for extension ${this.extensionId}`);if(!It(this.kernel.kernelConnectionMetadata))throw new Error("Chat code execution is only supported for Python kernels");for await(let s of this.executeCodeInternal(t,n,i))yield s}async*executeCodeInternal(t,n={},i){this.previousProgress?.dispose();let o=!1,s={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},a={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},c=new Ge,l=new Set;if(uce(this.extensionId,this.kernel,"executeCode",s.executionCount).catch(f),this.kernel.disposed)throw a.failed=!0,rM(this.kernel,s,a).catch(f),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw a.failed=!0,rM(this.kernel,s,a).catch(f),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let u=[];u.push({dispose:()=>{s.duration=c.elapsedTime,a.mimeTypes=Array.from(l).join(","),o=!0,rM(this.kernel,s,a).catch(f)}});let p=Pe.instance.get(Ke).getKernelExecution(this.kernel),m={started:new kn.EventEmitter,executionAcknowledged:new kn.EventEmitter};m.started.event(()=>{if(a.requestSent=!0,s.requestSentAfter=c.elapsedTime,!i.isCancellationRequested&&this.extensionId!==Je){let h=this.previousProgress=this.progress.show();u.push(h)}},this,u),m.executionAcknowledged.event(()=>{a.requestAcknowledged=!0,s.requestAcknowledgedAfter=c.elapsedTime},this,u),i.onCancellationRequested(()=>{o||(a.cancelled=!0,s.cancelledAfter=c.elapsedTime,a.cancelledBeforeRequestSent=!a.requestSent,a.cancelledBeforeRequestAcknowledged=!a.requestAcknowledged,P(`Code execution cancelled by extension ${this.extensionId}`))},this,u);try{for await(let h of p.executeCode(t,this.extensionId,m,i))if(FP(this.extensionId,this.kernel.session,h),h.items.forEach(g=>l.add(g.mime)),n&&X9(h))for await(let g of this.handleChatOutput(h,p,m,l,n,i))yield g;else yield h}finally{z(u)}}async*handleChatOutput(t,n,i,o,s={},a){let c=t.items.find(x=>x.mime===KP);if(!c)return;let l=(t.metadata||{}).metadata,u=l.function,p=l.id,m=l.dataIsNone?void 0:new TextDecoder().decode(c.data),h=s[u];if(!h)throw new Error(`Chat Function ${u} not found`);let g=await h(m),y=B9(p,g);for await(let x of n.executeCode(y,this.extensionId,i,a))if(x.items.forEach(E=>o.add(E.mime)),X9(x))for await(let E of this.handleChatOutput(x,n,i,o,s,a))yield E;else yield x}};function X9(r){return r.items.some(e=>e.mime===KP)}async function uce(r,e,t,n){let i=await vt(e.id);N("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:n},{kernelId:i,pemUsed:t,extensionId:r})}async function rM(r,e,t){t.kernelId=await vt(r.id),N("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function WP(r,e){let t=Pe.instance.get(Ke);return iM.createApiKernel(r,e,t.getKernelExecution(e))}var Z9=new WeakMap;function t3(r){return{async getKernel(e){let t,n=Pe.instance.get(Ke),i=e3.workspace.notebookDocuments.find(c=>c.uri.toString()===e.toString()),o=n.get(i||e);if(!o||!o.startedAtLeastOnce){N("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let s=n.getKernelExecution(o);if(!Ft(o.kernelConnectionMetadata)&&s.executionCount===0){N("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let a=Z9.get(o)||WP(r,o);return Z9.set(o,a),a}}}var bp=Symbol("JupyterServerHelper"),VP=Symbol("INotebookImporter"),Eg=Symbol("INotebookExporter"),Ip=Symbol("IJupyterInterpreterDependencyManager"),Pg=Symbol("INbConvertInterpreterDependencyChecker"),BP=Symbol("INbConvertExportToPythonService"),kg=Symbol("IJupyterServerProvider"),Zt=Symbol("IJupyterServerUriStorage"),qP=Symbol("IJupyterKernelService"),Sp=Symbol("IJupyterRequestAgentCreator"),zl=Symbol("IJupyterRequestCreator"),JP=Symbol("INotebookStarter"),_m=Symbol("ILiveRemoteKernelConnectionUsageTracker"),$P=Symbol("IJupyterRemoteCachedKernelValidator"),Qt=Symbol("IJupyterServerProviderRegistry"),HP=Symbol("IBackgroundThreadService");function GP(r,e,t,n,i){N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n,pemUsed:"createJupyterServerCollection"});let s=i.get(Qt).createJupyterServerCollection(n,r,kh(e),t);return{dispose:()=>{s?.dispose()},get id(){return r},set label(c){s.label=kh(c)},get label(){return s.label},set documentation(c){s.documentation=c},get documentation(){return s.documentation},set commandProvider(c){s.commandProvider=c},get commandProvider(){return s.commandProvider}}}var r3=!1;function n3(r,e){if(r3)return;r3=!0,e.get(tr).setApi(r)}var Pp=require("vscode");var Dg=D(O());var Oc=D(O());var xp=class extends et{constructor(t,n){super("remotejupyterserveruriprovider",n.message||n.toString());this.serverProviderHandle=t;this.originalError=n}};var Qo=class extends et{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){return e.message.indexOf("reason: self signed certificate")>=0}};var Nc=class extends et{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var en=Symbol("IDataScienceErrorHandler"),Kn=class extends et{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}},Mc=class extends un{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}};var Li=class extends et{constructor(t,n,i){super("remotejupyterserverconnection",b.remoteJupyterConnectionFailedWithServerWithError(i3(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=n;this.originalError=i;this.baseUrl=i3(t)}};function i3(r){let e=new URL(r);return`${e.protocol}//${e.host}/`}var kx=require("vscode");var o3=require("vscode");var Cp=class r{constructor(e){this.serverSettings=e;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get isDisposed(){return this.disposed===!0}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(e){return new r(e)}async dispose(){if(!this.disposed){this.disposed=!0,P("Disposing Jupyter Lab Helper");try{this.contentsManager&&(P("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(P("ShutdownSessionAndConnection - dispose session manager"),await xr(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(e){C("Exception on Jupyter Lab Helper shutdown: ",e)}finally{P("Finished disposing Jupyter Lab Helper")}}}async getRunningSessions(){if(!this.sessionManager)return[];await xr(1e4,this.sessionManager.ready).catch(f),await this.sessionManager.refreshRunning();let e=[],t=this.sessionManager.running(),n=t.next();for(;n;)e.push(n),n=t.next();return e}async getRunningKernels(){let e=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),t=new Set;return e.map(n=>{let i=n;return{id:n.id,name:n.name,lastActivityTime:i.last_activity?new Date(Date.parse(i.last_activity.toString())):new Date,numberOfConnections:i.connections?parseInt(i.connections.toString(),10):0}}).filter(n=>t.has(n.id)?!1:(t.add(n.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new bn;try{let e=new Ge,t=this.kernelSpecManager;if(!t)return C(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await Us()];let n={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:t.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,waitedForChangeEvent:!1},i=(c={})=>t.specs&&Object.keys(t.specs.kernelspecs).length?t.specs.kernelspecs:c,o=i();await xr(1e4,this.sessionManager.ready),n.sessionManagerReady=this.sessionManager.isReady,await xr(1e4,t.refreshSpecs()),n.specsManagerReady=t.isReady;let s=!1;if(t&&Object.keys(t.specs?.kernelspecs||{}).length===0){let c=[],l=le(),u=l.resolve.bind(l);t.specsChanged.connect(u),c.push(new o3.Disposable(()=>t.specsChanged.disconnect(u)));let p=Promise.all([l.promise,t.ready,t.refreshSpecs(),this.sessionManager.ready]);await xr(1e4,p),n.waitedForChangeEvent=!0,l.completed||(s=!0,N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,reason:t.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),z(c)}let a=i(o);if(Object.keys(a||{}).length){let c=[];return Object.entries(a).forEach(([l,u])=>{u&&c.push(new gp(u))}),N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:e.elapsedTime},n),c}else return C(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(a)}.`),s||N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await Us()]}catch(e){return C("Jupyter Lab Helper:getKernelSpecs failure: ",e),[]}}};var dn=class{constructor(e,t,n,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=n;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let n={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return yx(e,n,this.requestCreator,this.requestAgentCreator,this.configService,kx.Uri.file(""))}async validateRemoteUri(e,t,n){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=yx(e,t,this.requestCreator,this.requestAgentCreator,this.configService,kx.Uri.file(""));try{i=Cp.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(Qo.isSelfCertsError(s)){if(!await wP(this.configService,s.message))throw s}else if(Nc.isSelfCertsExpiredError(s)){if(!await EP(this.configService,s.message))throw s}else throw t&&!n&&await this.errorHandler.handleError(new Li(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose().catch(f)}}async getJupyterServerUri(e){let t=new kx.CancellationTokenSource;try{let n=this.jupyterPickerRegistration.jupyterCollections.find(c=>c.extensionId===e.extensionId&&c.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!n)return;let i=await Promise.resolve(n.serverProvider.provideJupyterServers(t.token)),o=i?.find(c=>c.id===e.handle);if(!o&&i?.length===0)try{o=await n.serverProvider.resolveJupyterServer({id:e.handle,label:""},t.token)}catch{}if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(n.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(n){throw n instanceof et?n:new xp(e,n)}finally{t.dispose()}}};dn=v([(0,Oc.injectable)(),d(0,(0,Oc.inject)(Qt)),d(1,(0,Oc.inject)(de)),d(2,(0,Oc.inject)(en)),d(3,(0,Oc.inject)(Sp)),d(3,(0,Oc.optional)()),d(4,(0,Oc.inject)(zl))],dn);var _a=class{constructor(e,t,n){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=n}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=rc.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){C(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};_a=v([(0,Dg.injectable)(),d(0,(0,Dg.inject)(Zt)),d(1,(0,Dg.inject)(dn)),d(2,(0,Dg.inject)(Qt))],_a);var s3=" (Interactive)",St=Symbol("IControllerRegistration");var zP=Symbol("IRemoteNotebookKernelSourceSelector"),QP=Symbol("ILocalNotebookKernelSourceSelector"),Tm=Symbol("ILocalPythonNotebookKernelSourceSelector"),wp=Symbol("IConnectionDisplayData");var a3=D(O()),Kc=require("vscode");var Ep=require("vscode");function fr(r,e=!1){return typeof r!="object"||!r?!1:!!(r instanceof Ep.CancellationError||e&&(r.message.includes("Canceled")||r.message.includes(ve.canceled)))}async function sr(r,e,...t){let n;return Qw(e)?(t.push(e),n=void 0):n=e,r?r.isCancellationRequested?n:new Promise((i,o)=>{if(r.isCancellationRequested)return i(n);let s=r.onCancellationRequested(()=>{s.dispose(),i(n)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function ar(r,...e){if(!r)return Promise.race(e);if(r.isCancellationRequested)throw new Ep.CancellationError;return new Promise((t,n)=>{if(r.isCancellationRequested)return n(new Ep.CancellationError);let i=r.onCancellationRequested(()=>{i.dispose(),n(new Ep.CancellationError)});Promise.race(e).then(t,n).finally(()=>i.dispose())})}function _g(...r){let e=new Ep.CancellationTokenSource,t=[];for(let i of r)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let n=e.dispose.bind(e);return e.dispose=()=>{n(),z(t)},e}var Sn;(e=>{function r(t){if(t?.isCancellationRequested)throw new Ep.CancellationError}e.throwIfCanceled=r})(Sn||={});function c3(r){let e=new Map,t=(a,c)=>{if(!e.has(a)){let l={id:a,label:c.displayName,connectionInformation:{baseUrl:Kc.Uri.parse(c.baseUrl),token:c.token,fetch:c.fetch,headers:c.authorizationHeader,WebSocket:c.WebSocket}};e.set(a,{serverUri:c,server:l})}return e.get(a).server},n=new Kc.EventEmitter,i={async provideJupyterServers(a){let c=r.getHandles?await ar(a,r.getHandles()):[];return!c||c.length===0?[]:ar(a,Promise.all(c.map(l=>r.getServerUri(l).then(u=>t(l,u)))))},resolveJupyterServer(a,c){return a},onDidChangeServers:n.event};if(!r.handleQuickPick||!r.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,c){let l=o.get(a.label);if(!l||!r.handleQuickPick)return;let u=await ar(c,r.handleQuickPick(l,!0));if(u==="back")return;if(!u)throw new Kc.CancellationError;let p=await r.getServerUri(u);return t(u,p)},async provideCommands(a,c){return r.getQuickPickEntryItems?(await ar(c,Promise.resolve(r.getQuickPickEntryItems()))).map(u=>{let p={label:kh(u.label),canBeAutoSelected:u.default,description:kh(u.description)};return o.set(p.label,u),p}):[]}}}}var oM=class extends Ms{constructor(t,n,i,o){super();this.extensionId=t;this.id=n;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Kc.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},Tg=class extends or{constructor(){super();this._onDidChangeCollections=new Kc.EventEmitter;this._collections=new Map;Pe.instance.get(F).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,n){return await this.loadExtension(t,n).catch(f),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===n)}async loadExtension(t,n){if(t===Je)return;let i=Kc.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${n}' not found`);i.isActive||await i.activate().then(f,f)}createJupyterServerCollection(t,n,i,o){let s=`${t}#${n}`;if(this._collections.has(s)&&t!==Je)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new oM(t,n,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};Tg=v([(0,a3.injectable)()],Tg);var YP=Symbol("IExportedKernelServiceFactory");function pce(r,e){return new Promise(t=>{e.onDidChange(n=>{for(let i of n.added)Ft(i.connection)&&i.connection.serverProviderHandle.id===r.id&&i.connection.serverProviderHandle.handle===r.handle&&t()})})}function l3(r,e){let t=e.get(Sa),n=r.id.startsWith("_builtin")?Je:t.determineExtensionFromCallStack().extensionId;if(C(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${n}).`),n.toLowerCase()!=rc.toLowerCase())throw new Error("Deprecated API");N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n,pemUsed:"registerRemoteServerProvider"});let{serverProvider:i,commandProvider:o}=c3(r),s=GP(r.id,r.displayName||r.detail||r.id,i,n,e);return o&&(s.commandProvider=o),{dispose:()=>{s.dispose()}}}function u3(r){return r.then(()=>void 0).catch(e=>(C("Failure during activation.",e),Promise.reject(e)))}function p3(r){let e=r.get(Sa);return N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:e.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),r.get(YP).getService()}async function d3(r,e,t){let n=t.get(Sa);C("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let i=n.determineExtensionFromCallStack().extensionId;if(i.toLowerCase()!=rc.toLowerCase())throw new Error("Deprecated API");N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:i,pemUsed:"addRemoteJupyterServer"});let o=t.get(_a),s=t.get(St),a=pce({id:r,handle:e},s);await o.addJupyterServer({id:r,handle:e,extensionId:i}),await a}async function m3(r,e,t){let n=t.get(Sa);N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let i=t.get(St),o=typeof e=="string"?e:void 0,s=typeof e=="string"?void 0:e,a=o&&i.all.find(l=>l.id===e)?.id;if(!a&&s&&!Xu()&&(a=i.all.find(l=>l.kind==="startUsingPythonInterpreter"&&l.interpreter.id===s.id)?.id,!a)){let u=await t.get(Tm).getKernelConnection(s);a=u&&i.all.find(p=>p.id===u?.id)?.id}if(!a)throw new Error(`Kernel ${e} not found.`);let c=Pp.window.activeNotebookEditor?.notebook?.uri?.toString()===r.toString()?Pp.window.activeNotebookEditor:await Pp.window.showNotebookDocument(await Pp.workspace.openNotebookDocument(r));return await Pp.commands.executeCommand("notebook.selectKernel",{notebookEditor:c,id:a,extension:Je}),c.notebook}function f3(r,e,t,n){let i=t.get(Sa),o={ready:u3(r),registerPythonApi:s=>n3(s,t),registerRemoteServerProvider:s=>l3(s,t),getKernelService:()=>p3(t),addRemoteJupyterServer:(s,a)=>d3(s,a,t),openNotebook:async(s,a)=>m3(s,a,t),createJupyterServerCollection:(s,a,c)=>GP(s,a,c,i.determineExtensionFromCallStack().extensionId,t),get kernels(){return t3(i.determineExtensionFromCallStack().extensionId)}};return(Nr()||n.extensionMode===sM.ExtensionMode.Development||n.extensionMode===sM.ExtensionMode.Test)&&(o.serviceContainer=t,o.serviceManager=e),o}var h3=require("vscode"),g3={codeLoadingTime:0,endActivateTime:0,startActivateTime:0,totalActivateTime:0,workspaceFolderCount:0};function v3(r,e){if(!Nr())try{r.endActivateTime=e.elapsedTime,r.totalActivateTime=e.elapsedTime,Object.assign(g3,r),b3(r),N("EXTENSION.LOAD",r)}catch(t){C("sendStartupTelemetry() failed.",t)}}function y3(r,e,t){try{let n={};e.endActivateTime=t.elapsedTime,e.totalActivateTime=t.elapsedTime,Object.assign(g3,e),b3(e),N("EXTENSION.LOAD",e,n,r)}catch(n){C("sendErrorTelemetry() failed.",n)}}function b3(r){let e=h3.workspace.workspaceFolders?.length??0;r.workspaceFolderCount=e}var XP=Symbol("IExtensionActivationManager"),Ie=Symbol("IExtensionSyncActivationService");var Ql=D(O());var Fc=Symbol("IEnvironmentVariablesService"),Lc=Symbol("ICustomEnvironmentVariablesProvider");var st=Symbol("IInterpreterService");var tk=D(O()),Uc=require("vscode");var dce={JupyterSessionWaitForIdleSession:b.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:b.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:b.gettingListOfKernelSpecs,KernelsRegisterKernel:b.registeringKernel,NotebookConnect:b.connectingToJupyter,NotebookStart:b.startingJupyterNotebook,InstallingMissingDependencies:b.installingMissingDependencies,ExportNotebookToPython:b.exportNotebookToPython,PerformingExport:b.performingExport};function ek(r){return dce[r]}var ht=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),ht.instance=this}activate(){}dispose(){z(Array.from(ht.disposables))}static createProgressReporter(e,t,n){if(!ht.instance)return new Uc.Disposable(f);let i=e?vn(e):"";return ht.instance.kernelResourceProgressReporter.has(i)?ht.reportProgress(e,t):ht.createProgressReporterInternal(i,t,n)}static wrapAndReportProgress(e,t,n){let i=e?vn(e):"";if(!ht.instance)return n();let o=ht.reportProgressInternal(i,t);return n().finally(()=>o?.dispose())}static reportProgress(e,t){let n=ek(t)||t,i=e?vn(e):"";return n?ht.reportProgressInternal(i,n||""):new Uc.Disposable(()=>f)}static reportProgressInternal(e,t){if(!ht.instance)return new Uc.Disposable(f);let n=ht.instance.kernelResourceProgressReporter.get(e);if(n||(n={title:t,pendingProgress:[],progressList:[],dispose:f},ht.instance.kernelResourceProgressReporter.set(e,n)),n.reporter)n.progressList.push(t),n.reporter.report({message:t});else{if(n.progressList.includes(t))return new Uc.Disposable(f);n.pendingProgress.push(t)}return{dispose:()=>{try{if(!n)return;let i=n.progressList.findIndex(o=>o===t);if(i>=0&&n.progressList.splice(i),n.progressList.length>0){let o=n.progressList[n.progressList.length-1];n.reporter&&n.reporter.report({message:o===n.title&&n.reporter?"":o})}else ht.instance.kernelResourceProgressReporter.delete(e),n.dispose()}catch(i){C(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,n){let i=le(),o=new Uc.Disposable(()=>i.resolve()),s=ht.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,c=()=>{a||(a=!0,Uc.window.withProgress({location:Uc.ProgressLocation.Notification,title:t},async(l,u)=>{let p=ht.instance.kernelResourceProgressReporter.get(e);if(p){for(p.reporter=l;p.pendingProgress.length>0;){let m=p.pendingProgress.shift();m===t?p.progressList.push(m):m!==t&&m&&(p.progressList.push(m),l.report({message:m}))}await sr(u,i.promise),ht.instance.kernelResourceProgressReporter.get(e)===p&&ht.instance.kernelResourceProgressReporter.delete(e),ht.disposables.delete(o)}}).then(f,f))};return ht.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:c}),ht.disposables.add(o),s.pendingProgress.push(t),n||c(),{dispose:()=>o.dispose(),show:c}}};ht.disposables=new Set,ht=v([(0,tk.injectable)(),d(0,(0,tk.inject)(F))],ht);var Rg=D(O()),rk=require("vscode");var Dr=Symbol("IPlatformService"),ut=Symbol("IFileSystem");var zTe=Symbol("IBufferDecoder"),Ui=Symbol("IProcessServiceFactory"),Dx=class extends et{constructor(e){super("unknown",e)}};var aM=class{constructor(e,t){this.uri=e;this.value=t}};function mce(r){return Array.isArray(r)}var fce,wo=class r{constructor(e,t){this[fce]="ResourceMap";if(e instanceof r)this.map=new Map(e.map),this.toKey=t??r.defaultToKey;else if(mce(e)){this.map=new Map,this.toKey=t??r.defaultToKey;for(let[n,i]of e)this.set(n,i)}else this.map=new Map,this.toKey=e??r.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new aM(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,n]of this.map)e(n.value,n.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(fce=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},hce,jc=class{constructor(e,t){this[hce]="ResourceSet";!e||typeof e=="function"?this._map=new wo(e):(this._map=new wo(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((n,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(hce=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var gce,I3=class{constructor(){this[gce]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let n=this._map.get(e);if(n)return t!==0&&this.touch(n,t),n.value}set(e,t,n=0){let i=this._map.get(e);if(i)i.value=t,n!==0&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.key,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.value,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:[n.key,n.value],done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}[(gce=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};var Wc=class{constructor(e,t,n){this.processFactory=e;this.platform=t;this.fs=n;this.userSitePaths=new wo}async getExecutablesPath(e){let t=e.executable.uri;if(!(Be(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let n=this.getUserSitePathImpl(t);n.catch(()=>{this.userSitePaths.get(t)===n&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,n)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),n="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${n}");print(site.${i});print("${n}");`]);if(o.includes(n)){let s=o.substring(o.indexOf(n)+n.length,o.lastIndexOf(n)).trim(),a=rk.Uri.file(s),c;if(this.platform.isWindows?c=rk.Uri.joinPath(Ti(a),"Scripts"):c=rk.Uri.joinPath(a,"bin"),!c||!this.fs.exists(c))throw new Error(`USER_SITE ${c.fsPath} dir does not exist for the interpreter ${B(e)}`);return P(`USER_SITE for ${B(e)} is ${c.fsPath}`),c}else throw new Error(`USER_SITE not found for the interpreter ${B(e)}. Stdout: ${o}`)}};v([Ur()],Wc.prototype,"getExecutablesPath",1),Wc=v([(0,Rg.injectable)(),d(0,(0,Rg.inject)(Ui)),d(1,(0,Rg.inject)(Dr)),d(2,(0,Rg.inject)(ut))],Wc);var cM=require("vscode");var S3=6e4,kp=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=n;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,n){let i=b.activatingPythonEnvironment(Wr(t));return ht.wrapAndReportProgress(e,i,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,t.id,n))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,n){let i=await this.interpreterService.resolveEnvironment(t);if(!i){U(`Failed to resolve environment for ${t}`);return}let o=`${e?.toString()||""}${t}`,s=this.activatedEnvVariablesCache.get(o);if(s&&s.time.elapsedTime>=S3&&this.activatedEnvVariablesCache.delete(o),!this.activatedEnvVariablesCache.has(o)){let c=this.getActivatedEnvironmentVariablesImpl(e,i,n);c.catch(f),this.activatedEnvVariablesCache.set(o,{promise:c,time:new Ge})}let a=this.activatedEnvVariablesCache.get(o).promise;return n?a:sr(n,a)}async getActivatedEnvironmentVariablesImpl(e,t,n){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new Ge;return this.getActivatedEnvironmentVariablesFromPython(e,t,n).then(o=>{if(!n?.isCancellationRequested)return o}).catch(o=>{C(`Failed to get env vars with python ${B(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,n){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>S3&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,n);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new Ge})}return sr(n,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,n){e=e||(cM.workspace.workspaceFolders?.length?cM.workspace.workspaceFolders[0].uri:void 0);let i=new Ge,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,c=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,t,!1).catch(p=>{C(`Failed to get activated env variables from Python Extension for ${B(t.path)}`,p),s="failedToGetActivatedEnvVariablesFromPython"}));if(n?.isCancellationRequested)return;let l=Be(t);if(N("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:l,source:"python",failed:Object.keys(c||{}).length===0,reason:s},a),c?P(`Got env vars from Python Ext in ${i.elapsedTime}ms for ${B(t.path)}, with env var count ${Object.keys(c||{}).length}. 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`):l==="Conda"?C(`Failed to get activated conda env vars for ${B(t.path)}
                 in ${i.elapsedTime}ms`):U(`Failed to get activated env vars for ${B(t.path)} in ${i.elapsedTime}ms`),!c){let u=await o;if(c={},Be(t)==="Conda"){let y=await Pa(t);y?c.CONDA_PREFIX=y:U(`Failed to get the SysPrefix for the Conda Environment ${B(t.path)}}`)}this.envVarsService.mergeVariables(process.env,c),this.envVarsService.mergeVariables(u,c),this.envVarsService.mergePaths(process.env,c),process.env.PYTHONPATH&&(c.PYTHONPATH=process.env.PYTHONPATH);let p=u?Object.keys(u).find(y=>y.toLowerCase()=="path"):void 0;p&&u[p]&&this.envVarsService.appendPath(c,u[p]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(c,u.PYTHONPATH);let m=await this.globalExecPaths.getExecutablesPath(t).catch(f);if(n?.isCancellationRequested)return;let h=c.PATH||c.Path,g=h?h.split(Zn):[];m&&g[1]!==m.fsPath?(P(`Prepend PATH with user site path for ${B(t.path)}, user site ${m.fsPath}`),this.envVarsService.prependPath(c,m.fsPath)):wr(t)||C(`Unable to determine site packages path for python ${B(t.path)} (${Be(t)})`),!c.PATH&&c.Path&&(c.PATH=c.Path)}return t.executable.uri&&(P(`Prepend PATH with python bin for ${B(t.path)}`),this.envVarsService.prependPath(c,dt(t.executable.uri.fsPath))),P(`Activated Env Variables for ${B(t.path)}, 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`),c}};v([ui("Getting activated env variables",1),d(1,Wl("id"))],kp.prototype,"getActivatedEnvironmentVariablesImpl",1),v([d(1,Wl("id")),d(2,sp())],kp.prototype,"getActivatedEnvironmentVariablesFromPython",1),kp=v([(0,Ql.injectable)(),d(0,(0,Ql.inject)(st)),d(1,(0,Ql.inject)(Lc)),d(2,(0,Ql.inject)(tr)),d(3,(0,Ql.inject)(Ye)),d(4,(0,Ql.inject)(Fc)),d(5,(0,Ql.inject)(Wc))],kp);var js=Symbol("IEnvironmentActivationService");var Ng=D(O()),Mg=require("vscode");var Ag=class{constructor(e,t,n){this.disposables=e;this.extensionChecker=t;this.pythonApi=n;this._changed=new Mg.EventEmitter;this._registered=!1;Mg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(Mg.window.activeNotebookEditor&&Nt(Mg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(f))}};Ag=v([(0,Ng.injectable)(),d(0,(0,Ng.inject)(F)),d(1,(0,Ng.inject)(Ye)),d(2,(0,Ng.inject)(tr))],Ag);function x3(r){r.addSingleton(tr,mg),r.addSingleton(Ye,fp),r.addSingleton(st,fg),r.addSingleton(Ie,Ag),r.addSingleton(js,kp)}var C3=D(O());var _x=require("vscode");var Og=class{activate(){_x.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await _x.window.showInformationMessage(e,ve.reload)===ve.reload&&_x.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};Og=v([(0,C3.injectable)()],Og);var w3=D(O()),no=require("vscode");var Yl=class{get activeDebugConsole(){return no.debug.activeDebugConsole}get activeDebugSession(){return ne(`Getting active debug session, ${no.debug.activeDebugSession?.name}`),no.debug.activeDebugSession}get breakpoints(){return no.debug.breakpoints}get onDidChangeActiveDebugSession(){return no.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return no.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return no.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return no.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return no.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return no.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return no.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,n){return no.debug.startDebugging(e,t,n)}addBreakpoints(e){no.debug.addBreakpoints(e)}removeBreakpoints(e){no.debug.removeBreakpoints(e)}};Yl.instance=new Yl,Yl=v([(0,w3.injectable)()],Yl);var nk=D(O()),lM=require("vscode");var Kg=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,n){if(ci&&this.extensionContext.extensionMode!==lM.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,n||"");return}if(n)await this.extensionContext.secrets.store(`${e}.${t}`,n);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){C(i)}}async retrieve(e,t){if(ci&&this.extensionContext.extensionMode!==lM.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){C(i)}}}};Kg=v([(0,nk.injectable)(),d(0,(0,nk.inject)(lt))],Kg);var ik=D(O()),Tx=require("vscode");var Fg=class{constructor(e){this._extensions=[];e.push(Tx.extensions.onDidChange(()=>this._extensions=Tx.extensions.all)),this._extensions=Tx.extensions.all}get extensions(){return this._extensions}determineExtensionFromCallStack(e){e=e||new Error().stack;try{let t=Tx.extensions.getExtension(Je).extensionUri.toString().toLowerCase(),n=[];if(e){n=e.split(`
`).map(c=>{let l=/\((.*)\)/.exec(c),u=l?l[1]:void 0;try{let p=/\((.*)\:\d*\:\d*\)/.exec(c);if(!p)return u;if(!u||u.startsWith(p[1]))return p[1]}catch{}return u}).filter(c=>c&&!c.toLowerCase().startsWith(t));let i=t.split(/[\\/]/),o=i.findIndex(c=>c.startsWith(Je)),s=o===-1?void 0:i[o-1];gN(new Error("Ex")).forEach(c=>{let l=c.getFileName();l&&!l.toLowerCase().startsWith(t)&&n.push(l)});for(let c of n){let l=this.extensions.find(u=>u.id!==Je&&(c.toLowerCase().startsWith(u.extensionUri.fsPath.toLowerCase())||c.toLowerCase().startsWith(u.extensionUri.path.toLowerCase())));if(l)return{extensionId:l.id,displayName:l.packageJSON.displayName}}let a=n.find(c=>c.includes(Je));if(a&&(a=a.substring(0,a.indexOf(Je)-1)),!s||!a)return{extensionId:xh,displayName:b.unknownPackage};for(let c of n.filter(l=>l.startsWith(a)&&!l.includes(Je))){let l=c.substring(a.length).substring(1).split(/[\\/]/)[0];l.includes("-")&&(l=l.substring(0,l.lastIndexOf("-")));let u=this.extensions.find(p=>p.id===l);if(u)return{extensionId:u.id,displayName:u.packageJSON.displayName}}}return C("Unable to determine the caller of the extension API for trace stack",e),C("Jupyter Root",t),C("Frames",n),{extensionId:xh,displayName:b.unknownPackage}}catch(t){return C("Unable to determine the caller of the extension API for trace stack.",e),C("Failure error",t),{extensionId:xh,displayName:b.unknownPackage}}}};Fg=v([(0,ik.injectable)(),d(0,(0,ik.inject)(F))],Fg);var ok=Symbol("IWorkspaceService"),ji=Symbol("IDebugManager"),Vc=Symbol("IApplicationEnvironment"),b1e=Symbol("IWebviewPanelMessageListener"),I1e=Symbol("IWebviewViewMessageListener"),S1e=Symbol("IWebview"),x1e=Symbol("IWebviewView"),C1e=Symbol("IWebviewPanel"),Dp=Symbol("IWebviewPanelProvider"),sk=Symbol("IWebviewViewProvider"),Rx=Symbol("IEncryptedStorage");var E3=D(O());var Lg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};Lg=v([(0,E3.injectable)()],Lg);var Kp=D(O()),A6=require("vscode"),Vx=D(R6());var Kk=class{setSharedProperty(e,t){Xh(e,t)}postEvent(e,t){let n={};t.forEach((i,o)=>{n[o]=i}),N(e,void 0,n)}};var vO=D(require("vscode")),Fk=D(O());var zg=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};zg=v([(0,Fk.injectable)(),d(0,(0,Fk.inject)(lt))],zg);function qs(){return vO.env.appName.indexOf("Insider")>0||vO.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var Qpe="VSCode.ABExp.FeatureData",yO="vscode",Qg=class{constructor(e,t,n){this.configurationService=e;this.appEnvironment=t;this.globalState=n;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(c=>!c.endsWith("control")),this._optOutFrom=o.filter(c=>!c.endsWith("control")),!this.enabled)return;let s;qs()==="insiders"?s=Vx.TargetPopulation.Insiders:s=Vx.TargetPopulation.Public;let a=new Kk;this.experimentationService=(0,Vx.getExperimentationService)(Je,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(P(`Experimentation service retrieved: ${this.experimentationService}`),await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(yO,e),!0):e==="DoNotWaitForZmqPortsToBeUsed"&&(qs()==="insiders"||vh())||e==="DataViewerContribution"&&(qs()==="insiders"||vh())?!0:this.experimentationService.getTreatmentVariable(yO,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(yO,e)}getFeatures(){return this.globalState.get(Qpe,{features:[]}).features}logExperiments(){let e=A6.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(ee("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(ee("Telemetry level is off"),t=!0),t&&ee("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){ee(gm.inGroup("All"));return}let n=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{ee(gm.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),ee(gm.inGroup(o))}),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(qs()==="insiders"||vh())&&ee(gm.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(n.add(o),ee(gm.inGroup(o)))})}};Qg=v([(0,Kp.injectable)(),d(0,(0,Kp.inject)(de)),d(1,(0,Kp.inject)(Vc)),d(2,(0,Kp.inject)($e)),d(2,(0,Kp.named)(gt))],Qg);var Uk=D(O()),Xo=require("vscode");var Lk=require("vscode");function Fp(r){Lk.env.openExternal(typeof r=="string"?Lk.Uri.parse(r):r).then(f,f)}var Ype=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:ix.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:ix.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:ix.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Yg=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Xo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Xo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){Ype.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Xo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let n="Learn more",i="Never show again",o=await Xo.window.showInformationMessage(e.message,n,i);if(o)switch(o){case n:{Fp(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Xo.workspace.workspaceFolders)&&Xo.workspace.workspaceFolders.length>0?Xo.workspace.workspaceFolders.forEach(n=>{t||(t=this.isDeprecatedSettingAndValueUsed(Xo.workspace.getConfiguration("jupyter",n.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Xo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(n=>P("Jupyter Extension: notifyDeprecation",n))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let n=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(n)?n.length>0:!0:!Array.isArray(t.values)||t.values.length===0?n===void 0?!1:Array.isArray(n)?n.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Yg=v([(0,Uk.injectable)(),d(0,(0,Uk.inject)(sc))],Yg);var Lp=D(O());var jk=class{constructor(e,t,n,i){this.storage=e;this.key=t;this.defaultValue=n;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},Xg=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,n){return new jk(this.globalState,e,t,n)}createWorkspacePersistentState(e,t,n){return new jk(this.workspaceState,e,t,n)}};Xg=v([(0,Lp.injectable)(),d(0,(0,Lp.inject)($e)),d(0,(0,Lp.named)(gt)),d(1,(0,Lp.inject)($e)),d(1,(0,Lp.named)(pi))],Xg);var N6="Path",M6="PATH",O6=/^win/.test(process.platform);var K6=D(O()),Jc=require("vscode");var Ne=class r extends Error{static{this.back=new r("back")}static{this.cancel=new r("cancel")}static{this.resume=new r("resume")}},Bx=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:n,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:c,matchOnDescription:l,matchOnDetail:u,acceptFilterBoxTextAsSelection:p,startBusy:m,stopBusy:h,validate:g,onDidTriggerItemButton:y,onDidTriggerButton:x,supportBackInFirstStep:E,onDidChangeItems:A,ignoreFocusOut:T}){let j=[],oe=le(),G=Jc.window.createQuickPick();return G.title=e,G.step=t,G.totalSteps=n,G.placeholder=s,G.ignoreFocusOut=T??!0,G.items=i,h&&(G.busy=m??!1,h(()=>{G.enabled&&(G.busy=!1)},this,j)),A&&(G.keepScrollPosition=!0,A(ue=>{G.items=ue},this,j)),y&&G.onDidTriggerItemButton(ue=>y(ue),void 0,j),G.matchOnDescription=l||!1,G.matchOnDetail=u||!1,o?G.activeItems=[o]:G.activeItems=[],G.buttons=[...this.steps.length>1||E?[Jc.QuickInputButtons.Back]:[],...a||[]],j.push(G.onDidTriggerButton(ue=>{ue===Jc.QuickInputButtons.Back?oe.reject(Ne.back):x?x(ue):oe.resolve(ue)}),G.onDidChangeSelection(async ue=>{let pe=ue.length?ue[0].label:"",te=!!pe;if(pe&&g&&ue.length){G.enabled=!1,G.busy=!0;let Ce=await g(ue[0]);Ce&&(te=!1,await Jc.window.showErrorMessage(Ce,{modal:!0})),G.enabled=!0,G.busy=!1}te&&oe.resolve(ue[0])}),G.onDidHide(()=>{(async()=>{oe.reject(c&&await c()?Ne.resume:Ne.cancel)})().catch(oe.reject)})),p&&j.push(G.onDidAccept(async()=>{if(!G.busy){let ue=g?await g(G):void 0;ue?(G.enabled=!1,G.busy=!0,await Jc.window.showErrorMessage(ue),G.enabled=!0,G.busy=!1):oe.resolve(G.value)}})),this.current&&this.current.dispose(),this.current=G,this.current.show(),oe.promise.finally(()=>z(j)).catch(f),{quickPick:G,selection:oe.promise}}async showInputBox({title:e,step:t,totalSteps:n,value:i,prompt:o,validate:s,password:a,buttons:c,shouldResume:l,validationMessage:u}){let p=[];try{return await new Promise((m,h)=>{let g=Jc.window.createInputBox();g.title=e,g.step=t,g.totalSteps=n,g.password=!!a,g.value=i||"",g.prompt=o,g.validationMessage=u||"",g.ignoreFocusOut=!0,g.validationMessage=u||"",g.buttons=[...this.steps.length>1?[Jc.QuickInputButtons.Back]:[],...c||[]],p.push(g.onDidTriggerButton(y=>{y===Jc.QuickInputButtons.Back?h(Ne.back):m(y)}),g.onDidAccept(async()=>{let y=g.value;g.enabled=!1,g.busy=!0;let x=await s(y);x?(g.validationMessage=x,g.show()):(g.validationMessage="",m(y)),g.enabled=!0,g.busy=!1}),g.onDidChangeValue(async()=>{g.validationMessage=""}),g.onDidHide(()=>{(async()=>{g.busy||h(l&&await l()?Ne.resume:Ne.cancel)})().catch(h)})),this.current&&this.current.dispose(),this.current=g,this.current.show()})}finally{p.forEach(m=>m.dispose())}}async stepThrough(e,t){let n=e;for(;n;){this.steps.push(n),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{n=await n(this,t)}catch(i){if(i===Ne.back)this.steps.pop(),n=this.steps.pop();else if(i===Ne.resume)n=this.steps.pop();else if(i===Ne.cancel)n=void 0;else throw i;if(!n)return i}}this.current&&this.current.dispose()}},ev=Symbol("IMultiStepInputFactory"),Zg=class{create(){return new Bx}};Zg=v([(0,K6.injectable)()],Zg);var F6=D(O()),L6=require("vscode");var tv=class{activate(){L6.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{LS.includes(t)||LS.push(t)})},f)}};tv=v([(0,F6.injectable)()],tv);var U6=Symbol("IServiceManager"),pt=Symbol("IServiceContainer");var eu=D(Gc());function Wp(r){return jr()==="Windows"?wn(r).toUpperCase():wn(r)}function Vp(r,e){return Wp(r)===Wp(e)}function sv(r,e){return e.endsWith(Vn)||(e+=Vn),r.endsWith(Vn)||(r+=Vn),Wp(r).startsWith(Wp(e))}var jJ=require("os"),WO;function WJ(r){WO=r}async function VJ(r,e={}){return(await WO.get(Ui).create(void 0)).shellExec(r,e)}function av(r){return eu.pathExists(r)}function VO(r){return eu.pathExistsSync(r)}function BJ(r){return eu.readFile(r,"utf-8")}function qJ(r){return eu.readFileSync(r,"utf-8")}var JJ=r=>Th(r,(0,jJ.homedir)());function $J(r){return WO.get(de).getSettings()[r]}var QJ=D(O()),Wm=D(require("os")),YJ=D(sg()),qO=require("vscode");var BO=require("vscode"),GJ=D(require("os"));var HJ=GJ.homedir();function jm(r){return process.env[r]}function cv(){if(jr()==="Windows")return BO.Uri.file(jm("USERPROFILE")||HJ);let r=jm("HOME")||jm("HOMEPATH")||HJ;return BO.Uri.file(r.replace(/\\/g,"/"))}var lv=D(sg());function zJ(r){r=r.replace(/\.00*(?=[1-9]|0\.)/,".");let e=lv.coerce(r);return e===null||!lv.valid(e)?new lv.SemVer("0.0.0"):e}var zc=class{constructor(){this._homeDir=cv()||qO.Uri.file(Wm.homedir());this._tempDir=qO.Uri.file(Wm.tmpdir());this.osType=jr();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?N6:M6}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,YJ.coerce)(Wm.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return zJ(Wm.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};zc=v([(0,QJ.injectable)()],zc);function XJ(r){r.addSingleton(Dr,zc),WJ(r.get(pt))}var nD=D(O()),t8=require("vscode");var Vm=require("child_process"),rD=require("vscode");var JO="utf8";var eD=require("vscode"),ZJ=require("os"),tD=eD.Uri.file((0,ZJ.homedir)());function e8(r,e){let t=e?[{uri:eD.Uri.file(e),name:"",index:0}]:[];return B(r?eD.Uri.file(r):void 0,t,tD)}function tn(r,e=[]){return B(r,e,tD)}function $O(r,e,t){let n=e.reduce((o,s,a)=>{let c=BS(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(c=`${s[0]}${tn(s.substr(1))}`),a===0?c:`${o} ${c}`},""),i=[`Process Execution: ${tn(r)} ${n}`];t&&t.cwd&&i.push(`    > ${pN.currentWorkingDirectory} ${tn(t.cwd.toString())}`),ee(i.join(`
`))}var HO=class{decode(e){return Buffer.concat(e).toString(JO)}},Bp=class Bp{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new HO}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Vm.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Vm.spawn)(e,t,i),s=!1;ne(`Exec observable ${e}, ${t.join(" ")}`);let a=[],c={dispose:function(){o&&!o.killed&&!s&&Bp.kill(o.pid),o&&o.unref(),z(a)}};this.processesToKill.add(c);let l=Kme();a.push(l);let u=(m,h,g)=>{m.on(h,g),a.push({dispose:()=>m.removeListener(h,g)})};n.token&&a.push(n.token.onCancellationRequested(()=>{!s&&!o.killed&&(Bp.kill(o.pid),s=!0)}));let p=(m,h)=>{let g=this.decoder.decode([h]);m==="stderr"&&n.throwOnStdErr?l.reject(new Dx(g)):l.fire({source:m,out:g})};return u(o.stdout,"data",m=>p("stdout",m)),u(o.stderr,"data",m=>p("stderr",m)),o.once("close",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("exit",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("error",m=>{s=!0,l.reject(m),a.forEach(h=>h.dispose())}),$O(e,t,n),{proc:o,out:l,dispose:c.dispose}}exec(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Vm.spawn)(e,t,i),s=le(),a={dispose:()=>{!o.killed&&!s.completed&&Bp.kill(o.pid)}};this.processesToKill.add(a);let c=[],l=(m,h,g)=>{m.on(h,g),c.push({dispose:()=>m.removeListener(h,g)})};n.token&&c.push(n.token.onCancellationRequested(a.dispose));let u=[];l(o.stdout,"data",m=>u.push(m));let p=[];return l(o.stderr,"data",m=>{n.mergeStdOutErr&&u.push(m),p.push(m)}),o.once("close",()=>{if(s.completed)return;let m=p.length===0?void 0:this.decoder.decode(p);if(m&&m.length>0&&n.throwOnStdErr)s.reject(new Dx(m));else{let h=this.decoder.decode(u);s.resolve({stdout:h,stderr:m})}c.forEach(h=>h.dispose())}),o.once("error",m=>{s.reject(m),c.forEach(h=>h.dispose())}),$O(e,t,n),s.promise}shellExec(e,t={}){let n=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Vm.exec)(e,n,(l,u,p)=>{s?.dispose(),l&&l!==null?o(l):n.throwOnStdErr&&p&&p.length?o(new Error(p)):i({stderr:p&&p.length>0?p:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new rD.CancellationError),Bp.kill(a.pid))}));let c={dispose:()=>{a.killed||Bp.kill(a.pid)}};this.processesToKill.add(c)})}getDefaultOptions(e){let t={...e},n=t;if(n){let i=n.encoding=typeof n.encoding=="string"&&n.encoding.length>0?n.encoding:JO;delete n.encoding,n.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t.env.PYTHON_FROZEN_MODULES||(t.env.PYTHON_FROZEN_MODULES="on"),t}};v([ui("Execing shell command",5),d(1,sp())],Bp.prototype,"shellExec",1);var Qc=Bp;function Kme(){let r=new rD.EventEmitter,e=le();return e.promise.catch(f),{get onDidChange(){return r.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:r.fire.bind(r),dispose:()=>{r.dispose()}}}var Bm=class{constructor(e){this.envVarsService=e}async create(e,t){if(!t8.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return ag(new Qc(n))}};v([ui("Create ProcessService",5)],Bm.prototype,"create",1),Bm=v([(0,nD.injectable)(),d(0,(0,nD.inject)(Lc))],Bm);function r8(r){r.addSingleton(Ui,Bm)}var i8=D(require("os")),oD=D(O());var uv=D(require("vscode")),n8;(c=>{let r=uv.FileSystemError.FileNotFound().name,e=uv.FileSystemError.FileExists().name,t=uv.FileSystemError.FileIsADirectory().name,n=uv.FileSystemError.FileNotADirectory().name,i=uv.FileSystemError.NoPermissions().name,o=[r,e,t,n,i];function s(l,u){if(o.includes(l.name))return l.name===u}function a(l){return s(l,r)}c.isFileNotFound=a})(n8||={});function Fme(r,e){let t=r.code;if(t)return t===e}function iD(r){let e=n8.isFileNotFound(r);return e!==void 0?e:Fme(r,"ENOENT")}var o8=require("vscode");var pv=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return Lme(await this.fs.readFile(o8.Uri.file(e)),t)}catch(n){iD(n)||C(`Failed to parse env file ${e}`,n)}}mergeVariables(e,t){t&&Object.keys(e).forEach(n=>{let i=n.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||n;t[o]=e[n]})}mergePaths(e,t){let n=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||n;n&&i&&(t[i]=e[n])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,n,...i){let o=i.filter(m=>typeof m=="string"&&m.trim().length>0).map(m=>m.trim()).join(Zn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(m=>m.toLowerCase()==s):void 0,c=e&&a?e[a]:void 0,l=a||t;c&&typeof c=="string"&&c.length>0?n&&!(e[l]||"").endsWith(Zn+o)?e[l]=c+Zn+o:!n&&!(e[l]||"").startsWith(o+Zn)&&(e[l]=o+Zn+c):e[l]=o;let p=["Path","PATH"].find(m=>m!==l);if(i8.platform()==="win32"&&p&&p in e&&typeof e[p]=="string"){let m=e[p],h=p;m&&typeof m=="string"&&m.length>0?n&&!(e[h]||"").endsWith(Zn+o)?e[h]=m+Zn+o:!n&&!(e[h]||"").startsWith(o+Zn)&&(e[h]=o+Zn+m):e[h]=o}return e}};pv=v([(0,oD.injectable)(),d(0,(0,oD.inject)(ut))],pv);function Lme(r,e){let t=e||{},n={};return r.toString().split(`
`).forEach((i,o)=>{let[s,a]=Ume(i);s!==""&&(n[s]=Wme(a,n,t))}),n}function Ume(r){let e=r.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],n=e[2];return n&&n!==""?n[0]==="'"&&n[n.length-1]==="'"?(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n[0]==='"'&&n[n.length-1]==='"'&&(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n="",[t,n]}var jme=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Wme(r,e,t,n=""){let i=!1,o=r;return o=o.replace(jme,(s,a,c,l,u)=>l>0&&u[l-1]==="\\"?s:c&&c!==""||!a||a===""?(i=!0,s):e[a]||t[a]||n),!i&&o!==r&&(r=o,N("ENVFILE_VARIABLE_SUBSTITUTION")),r.replace(/\\\$/g,"$")}var Yc=D(O());var _o=require("vscode");var Na=require("vscode");var GO={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function zO(r){return Array.isArray?Array.isArray(r):!!(r&&typeof r.length===GO.number&&r.constructor===Array)}function sD(r){return typeof r===GO.string||r instanceof String}function QO(r){return typeof r===GO.object&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}var aD=class{resolve(e){return sD(e)?this.__resolveString(e):zO(e)?this.__resolveArray(e):QO(e)?this.__resolveLiteral(e):e}resolveAny(e){return sD(e)?this.__resolveString(e):zO(e)?this.__resolveAnyArray(e):QO(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(n,i)=>{let o=this[i];return sD(o)?o:n&&(n.indexOf("env.")>0||n.indexOf("env:")>0)?"":n})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var dv=class extends aD{constructor(t,n){super();let i=t?Na.workspace.getWorkspaceFolder(t):void 0;this._workspaceFolder=i?i.uri.fsPath:n?.fsPath||__dirname,this._workspaceFolderName=_e(this._workspaceFolder),this._filePath=t?t.fsPath:void 0,Na.window&&Na.window.activeTextEditor&&(this._lineNumber=Na.window.activeTextEditor.selection.anchor.line+1,this._selectedText=Na.window.activeTextEditor.document.getText(new Na.Range(Na.window.activeTextEditor.selection.start,Na.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(o=>{this[`env:${o}`]=this[`env.${o}`]=process.env[o]})}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?lE(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?dt(this.relativeFile):void 0}get fileBasename(){return this.file?_e(this.file):void 0}get fileBasenameNoExtension(){return this.file?g2(this.file).name:void 0}get fileDirname(){return this.file?dt(this.file):void 0}get fileExtname(){return this.file?Qi(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var lD=require("vscode"),Qx,cD=!1;function s8(){l8()&&c8()}async function a8(r,e){if(l8()){let n=new dv(e,void 0).resolveAny(u8());await r.exists(lD.Uri.file(n))&&c8()}}function c8(){N("ENVFILE_WORKSPACE"),cD=!0}function l8(){return!cD}function u8(){return Qx||(Qx=lD.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),Qx}var Bme;(t=>{function r({telemetrySent:n,defaultSetting:i}){n!==void 0&&(cD=n),u8!==void 0&&(Qx=i)}t.setState=r;function e(){Qx=void 0,cD=!1}t.resetState=e})(Bme||={});var qme=60*1e3,qm=class{constructor(e,t,n,i,o=qme){this.envVarsService=e;this.extensionChecker=n;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new _o.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),z(this.disposables)}async getEnvironmentVariables(e,t,n){if(e=e||(_o.workspace.workspaceFolders?.length?_o.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,n);let i=new cm(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return P(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,n);return o.then(s=>{n?.isCancellationRequested||(i.data=s)}).catch(f),o}async getCustomEnvironmentVariables(e,t,n){e=e||(_o.workspace.workspaceFolders?.length?_o.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){ne(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let c=await this.pythonApi.getNewApi();if(c&&!n?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,c.environments.onDidEnvironmentVariablesChange(l=>{P(`Python env vars changed ${l.resource?.uri?.path}`),this.onEnvironmentFileChanged(l.resource?.uri),this.changeEventEmitter.fire(l.resource?.uri)},this,this.disposables)),c.environments.getEnvironmentVariables(i)}let o=new cm(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return P(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(n?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(c=>{n?.isCancellationRequested||(o.data=c)}).catch(f),a}createFileWatcher(e,t){let n=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(n))return;let i=new _o.RelativePattern(_o.Uri.file(dt(e)),_e(e)),o=_o.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(n),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):C("Failed to create file watcher for environment file")}getEnvFile(e){return Ve(e.fsPath,".env")}async _getEnvironmentVariables(e,t,n){let i=await this.getCustomEnvironmentVariables(e,t,n);if(n?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=_o.workspace.workspaceFolders||[],n=t.length===1?t[0].uri:void 0;return e&&_o.workspace.getWorkspaceFolder(e)?.uri||n}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),s8()}onEnvironmentFileChanged(e){new cm(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new cm(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${Ns(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${Ns(e)}:RunNonPythonCode:CustomVars`}};v([ui("Get Custom Env Variables",1)],qm.prototype,"getEnvironmentVariables",1),qm=v([(0,Yc.injectable)(),d(0,(0,Yc.inject)(Fc)),d(1,(0,Yc.inject)(F)),d(2,(0,Yc.inject)(Ye)),d(3,(0,Yc.inject)(tr)),d(4,(0,Yc.inject)("number")),d(4,(0,Yc.optional)())],qm);function p8(r){r.addSingleton(Fc,pv),r.addSingleton(Lc,qm)}var d8=D(O()),qp=require("vscode");var YO=require("vscode");var mv=class{activate(){qp.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=YO.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let n=t+1,i={"ms-toolsai.jupyter":n,"ms-toolsai.jupyter-renderers":n};qp.extensions.getExtension(li)&&(i[li]=n),qp.extensions.getExtension(sm)&&(i[sm]=n),await YO.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},qp.ConfigurationTarget.Global),qp.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};mv=v([(0,d8.injectable)()],mv);var Yx=require("vscode");var Xc=D(O());var m8=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList"],fv=class{constructor(e,t,n,i){this.globalState=e;this.crypto=t;this.workspaceState=n;this.extensionContext=i}activate(){this.removeOldCachedItems().then(f,f)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(m8).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(f,f)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(m8.map(t=>this.globalState.keys().filter(n=>n.startsWith(t)).map(n=>this.globalState.update(n,void 0).then(f,f))).flat()),await this.extensionContext.secrets.delete(`${ai.JupyterServerRemoteLaunchService}.remote-uri-list`).then(f,f)}async getUriAccountKey(){let e=Dc();return e?this.crypto.createHash(Ae(e),"SHA-512"):Yx.workspace.workspaceFile?this.crypto.createHash(Ae(Yx.workspace.workspaceFile),"SHA-512"):Yx.env.machineId}};fv=v([(0,Xc.injectable)(),d(0,(0,Xc.inject)($e)),d(0,(0,Xc.named)(gt)),d(1,(0,Xc.inject)(Mh)),d(2,(0,Xc.inject)($e)),d(2,(0,Xc.named)(pi)),d(3,(0,Xc.inject)(lt))],fv);function f8(r){r.addSingletonInstance(N2,O6),r.addSingleton(Sa,Fg),r.addSingleton(sc,Xg),r.addSingleton(ji,Yl),r.addSingleton(Vc,zg),r.addSingleton(Rx,Kg),r.addSingleton(Mh,$h),r.addSingleton(ac,Qg),r.addSingleton(fE,Yg),r.addSingleton(di,Lg),r.addSingleton(ev,Zg),r.addSingleton(Ie,tv),r.addSingleton(Ie,fv),r.addSingleton(Ie,Og),r.addSingleton(Ie,mv),XJ(r),r8(r),p8(r)}var pD=D(O());var ns=Ve(__dirname,"..");var XO=Ve(ns,"pythonFiles"),Jme=XO;function h8(){let e=[Ve(Jme,"normalizeSelection.py")];function t(n){return n}return[e,t]}var Vi=require("vscode");var uD=class{async normalizeLines(e,t){return e}async getFileToExecute(){let e=Vi.window.activeTextEditor;if(!e){Vi.window.showErrorMessage("No open file to run in terminal").then(f,f);return}if(e.document.isUntitled){Vi.window.showErrorMessage("The active file needs to be saved before it can be run").then(f,f);return}if(e.document.languageId!==xe){Vi.window.showErrorMessage("The active file is not a Python source file").then(f,f);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,n;return t.isEmpty?n=e.document.lineAt(t.start.line).text:t.isSingleLine?n=this.getSingleLineSelectionText(e):n=this.getMultiLineSelectionText(e),Dh(n.trimEnd())}async saveFileIfDirty(e){let t=Vi.workspace.textDocuments.filter(n=>n.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}getSingleLineSelectionText(e){let t=e.selection,n=new Vi.Range(t.start,t.end),i=e.document.getText(n),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,n=new Vi.Range(t.start,t.end),i=e.document.getText(n),o=new Vi.Range(new Vi.Position(t.start.line,0),new Vi.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,c=new Vi.Range(t.start,new Vi.Position(t.start.line,a.length)),l=e.document.getText(c);return l.trimStart()===a.trimStart()?a+i.substring(l.length):i}};var hv=class extends uD{constructor(t){super();this.processServiceFactory=t.get(Ui),this.interpreterService=t.get(st)}async normalizeLines(t,n){let i=[];try{let o=t.trim();if(o.length===0)return"";if(t=t.replace(new RegExp("\\r","g"),""),o.indexOf(`
`)===-1)return o+`
`;let s=await this.interpreterService.getActiveInterpreter(n),a=await this.processServiceFactory.create(n),[c,l]=h8(),u=a.execObservable(Ae(s?.uri)||"python",c,{throwOnStdErr:!0}),p="";u.out.onDidChange(A=>{A.source==="stdout"&&(p+=A.out)},this,i);let m=JSON.stringify({code:t});u.proc?.stdin?.write(m),u.proc?.stdin?.end(),await u.out.done;let g=JSON.parse(p),y=l(g.normalized),x=We(t,{trim:!0,removeEmptyEntries:!1}).findIndex(A=>A.length),E=We(y,{trim:!0,removeEmptyEntries:!1}).findIndex(A=>A.length);if(x>E){let A=x-E;return`${`
`.repeat(A)}${y}`}return y}catch(o){return C(o,"Python: Failed to normalize code for execution in Interactive Window"),t}finally{z(i)}}};hv=v([(0,pD.injectable)(),d(0,(0,pD.inject)(pt))],hv);var dD=Symbol("ICodeExecutionHelper");function g8(r){r.addSingleton(dD,hv)}var Jp=D(O()),y8=D(sg()),Xx=require("vscode");var v8="CONDA_INFORMATION_CACHE";function ZO(r){return r&&cE(r.fsPath)&&r.fsPath.startsWith(Vn)&&`${Vn}${_e(r.fsPath)}`===r.fsPath?_e(r.fsPath):r?.fsPath}var $s=class{constructor(e,t,n){this.pythonApi=e;this.globalState=t;this.fs=n}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(f)}).catch(f);let n=Es(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.version?this._version=n.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return ZO(this._file);if(this._previousFileCall)return this._previousFileCall.then(ZO);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{P(`Conda file is ${i}`),this._file=i?Xx.Uri.file(i):void 0,this.updateCache().catch(f)}).catch(f);let n=Es(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.file?this._file=n.value.file:t.then(i=>i?Xx.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(ZO)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(v8,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(v8,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(Xx.Uri.file(e.file));if(e.fileHash===t)return{version:new y8.SemVer(e.version),file:Xx.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};$s=v([(0,Jp.injectable)(),d(0,(0,Jp.inject)(tr)),d(1,(0,Jp.inject)($e)),d(1,(0,Jp.named)(gt)),d(2,(0,Jp.inject)(ut))],$s);var Zx=D(O());var I8=D(mD());var b8="_VSCODE_getDataFrame",fD=I8.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Zc=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${b8}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:fD}:{code:`${t}

${i}

${fD}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${b8}("rows", ${n}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:fD}:{code:`${t}

${i}

${fD}`}}async getContentsOfDataFrameScript(){if(Zc.contentsOfDataFrameScript)return Zc.contentsOfDataFrameScript;let e=ir(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Zc.contentsOfDataFrameScript=t,t}};Zc=v([(0,Zx.injectable)(),d(0,(0,Zx.inject)(ut)),d(1,(0,Zx.inject)(lt))],Zc);var tC=D(O());function hD(r,e){e===void 0&&(e=!1);var t=r.length,n=0,i="",o=0,s=16,a=0,c=0,l=0,u=0,p=0;function m(T,j){for(var oe=0,G=0;oe<T||!j;){var ue=r.charCodeAt(n);if(ue>=48&&ue<=57)G=G*16+ue-48;else if(ue>=65&&ue<=70)G=G*16+ue-65+10;else if(ue>=97&&ue<=102)G=G*16+ue-97+10;else break;n++,oe++}return oe<T&&(G=-1),G}function h(T){n=T,i="",o=0,s=16,p=0}function g(){var T=n;if(r.charCodeAt(n)===48)n++;else for(n++;n<r.length&&gv(r.charCodeAt(n));)n++;if(n<r.length&&r.charCodeAt(n)===46)if(n++,n<r.length&&gv(r.charCodeAt(n)))for(n++;n<r.length&&gv(r.charCodeAt(n));)n++;else return p=3,r.substring(T,n);var j=n;if(n<r.length&&(r.charCodeAt(n)===69||r.charCodeAt(n)===101))if(n++,(n<r.length&&r.charCodeAt(n)===43||r.charCodeAt(n)===45)&&n++,n<r.length&&gv(r.charCodeAt(n))){for(n++;n<r.length&&gv(r.charCodeAt(n));)n++;j=n}else p=3;return r.substring(T,j)}function y(){for(var T="",j=n;;){if(n>=t){T+=r.substring(j,n),p=2;break}var oe=r.charCodeAt(n);if(oe===34){T+=r.substring(j,n),n++;break}if(oe===92){if(T+=r.substring(j,n),n++,n>=t){p=2;break}var G=r.charCodeAt(n++);switch(G){case 34:T+='"';break;case 92:T+="\\";break;case 47:T+="/";break;case 98:T+="\b";break;case 102:T+="\f";break;case 110:T+=`
`;break;case 114:T+="\r";break;case 116:T+="	";break;case 117:var ue=m(4,!0);ue>=0?T+=String.fromCharCode(ue):p=4;break;default:p=5}j=n;continue}if(oe>=0&&oe<=31)if(eC(oe)){T+=r.substring(j,n),p=2;break}else p=6;n++}return T}function x(){if(i="",p=0,o=n,c=a,u=l,n>=t)return o=t,s=17;var T=r.charCodeAt(n);if(tK(T)){do n++,i+=String.fromCharCode(T),T=r.charCodeAt(n);while(tK(T));return s=15}if(eC(T))return n++,i+=String.fromCharCode(T),T===13&&r.charCodeAt(n)===10&&(n++,i+=`
`),a++,l=n,s=14;switch(T){case 123:return n++,s=1;case 125:return n++,s=2;case 91:return n++,s=3;case 93:return n++,s=4;case 58:return n++,s=6;case 44:return n++,s=5;case 34:return n++,i=y(),s=10;case 47:var j=n-1;if(r.charCodeAt(n+1)===47){for(n+=2;n<t&&!eC(r.charCodeAt(n));)n++;return i=r.substring(j,n),s=12}if(r.charCodeAt(n+1)===42){n+=2;for(var oe=t-1,G=!1;n<oe;){var ue=r.charCodeAt(n);if(ue===42&&r.charCodeAt(n+1)===47){n+=2,G=!0;break}n++,eC(ue)&&(ue===13&&r.charCodeAt(n)===10&&n++,a++,l=n)}return G||(n++,p=1),i=r.substring(j,n),s=13}return i+=String.fromCharCode(T),n++,s=16;case 45:if(i+=String.fromCharCode(T),n++,n===t||!gv(r.charCodeAt(n)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=g(),s=11;default:for(;n<t&&E(T);)n++,T=r.charCodeAt(n);if(o!==n){switch(i=r.substring(o,n),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(T),n++,s=16}}function E(T){if(tK(T)||eC(T))return!1;switch(T){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function A(){var T;do T=x();while(T>=12&&T<=15);return T}return{setPosition:h,getPosition:function(){return n},scan:e?A:x,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return n-o},getTokenStartLine:function(){return c},getTokenStartCharacter:function(){return o-u},getTokenError:function(){return p}}}function tK(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function eC(r){return r===10||r===13||r===8232||r===8233}function gv(r){return r>=48&&r<=57}var gD;(function(r){r.DEFAULT={allowTrailingComma:!1}})(gD||(gD={}));function S8(r,e){var t=[],n=new Object,i=void 0,o={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(c,l,u,p){o.value=c,o.offset=l,o.length=u,o.type=p,o.colonOffset=void 0,i=o}try{iK(r,{onObjectBegin:function(c,l){if(e<=c)throw n;i=void 0,s=e>c,t.push("")},onObjectProperty:function(c,l,u){if(e<l||(a(c,l,u,"property"),t[t.length-1]=c,e<=l+u))throw n},onObjectEnd:function(c,l){if(e<=c)throw n;i=void 0,t.pop()},onArrayBegin:function(c,l){if(e<=c)throw n;i=void 0,t.push(0)},onArrayEnd:function(c,l){if(e<=c)throw n;i=void 0,t.pop()},onLiteralValue:function(c,l,u){if(e<l||(a(c,l,u,x8(c)),e<=l+u))throw n},onSeparator:function(c,l,u){if(e<=l)throw n;if(c===":"&&i&&i.type==="property")i.colonOffset=l,s=!1,i=void 0;else if(c===","){var p=t[t.length-1];typeof p=="number"?t[t.length-1]=p+1:(s=!0,t[t.length-1]=""),i=void 0}}})}catch(c){if(c!==n)throw c}return{path:t,previousNode:i,isAtPropertyKey:s,matches:function(c){for(var l=0,u=0;l<c.length&&u<t.length;u++)if(c[l]===t[u]||c[l]==="*")l++;else if(c[l]!=="**")return!1;return l===c.length}}}function rK(r,e,t){e===void 0&&(e=[]),t===void 0&&(t=gD.DEFAULT);var n={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(c){n.type==="property"&&(n.length=c-n.offset,n=n.parent)}function o(c){return n.children.push(c),c}var s={onObjectBegin:function(c){n=o({type:"object",offset:c,length:-1,parent:n,children:[]})},onObjectProperty:function(c,l,u){n=o({type:"property",offset:l,length:-1,parent:n,children:[]}),n.children.push({type:"string",value:c,offset:l,length:u,parent:n})},onObjectEnd:function(c,l){i(c+l),n.length=c+l-n.offset,n=n.parent,i(c+l)},onArrayBegin:function(c,l){n=o({type:"array",offset:c,length:-1,parent:n,children:[]})},onArrayEnd:function(c,l){n.length=c+l-n.offset,n=n.parent,i(c+l)},onLiteralValue:function(c,l,u){o({type:x8(c),offset:l,length:u,parent:n,value:c}),i(l+u)},onSeparator:function(c,l,u){n.type==="property"&&(c===":"?n.colonOffset=l:c===","&&i(l))},onError:function(c,l,u){e.push({error:c,offset:l,length:u})}};iK(r,s,t);var a=n.children[0];return a&&delete a.parent,a}function nK(r,e){if(r){for(var t=r,n=0,i=e;n<i.length;n++){var o=i[n];if(typeof o=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;for(var s=!1,a=0,c=t.children;a<c.length;a++){var l=c[a];if(Array.isArray(l.children)&&l.children[0].value===o){t=l.children[1],s=!0;break}}if(!s)return}else{var u=o;if(t.type!=="array"||u<0||!Array.isArray(t.children)||u>=t.children.length)return;t=t.children[u]}}return t}}function vD(r){switch(r.type){case"array":return r.children.map(vD);case"object":for(var e=Object.create(null),t=0,n=r.children;t<n.length;t++){var i=n[t],o=i.children[1];o&&(e[i.children[0].value]=vD(o))}return e;case"null":case"string":case"number":case"boolean":return r.value;default:return}}function iK(r,e,t){t===void 0&&(t=gD.DEFAULT);var n=hD(r,!1);function i(te){return te?function(){return te(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:function(){return!0}}function o(te){return te?function(Ce){return te(Ce,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:function(){return!0}}var s=i(e.onObjectBegin),a=o(e.onObjectProperty),c=i(e.onObjectEnd),l=i(e.onArrayBegin),u=i(e.onArrayEnd),p=o(e.onLiteralValue),m=o(e.onSeparator),h=i(e.onComment),g=o(e.onError),y=t&&t.disallowComments,x=t&&t.allowTrailingComma;function E(){for(;;){var te=n.scan();switch(n.getTokenError()){case 4:A(14);break;case 5:A(15);break;case 3:A(13);break;case 1:y||A(11);break;case 2:A(12);break;case 6:A(16);break}switch(te){case 12:case 13:y?A(10):h();break;case 16:A(1);break;case 15:case 14:break;default:return te}}}function A(te,Ce,Le){if(Ce===void 0&&(Ce=[]),Le===void 0&&(Le=[]),g(te),Ce.length+Le.length>0)for(var ct=n.getToken();ct!==17;){if(Ce.indexOf(ct)!==-1){E();break}else if(Le.indexOf(ct)!==-1)break;ct=E()}}function T(te){var Ce=n.getTokenValue();return te?p(Ce):a(Ce),E(),!0}function j(){switch(n.getToken()){case 11:var te=n.getTokenValue(),Ce=Number(te);isNaN(Ce)&&(A(2),Ce=0),p(Ce);break;case 7:p(null);break;case 8:p(!0);break;case 9:p(!1);break;default:return!1}return E(),!0}function oe(){return n.getToken()!==10?(A(3,[],[2,5]),!1):(T(!1),n.getToken()===6?(m(":"),E(),pe()||A(4,[],[2,5])):A(5,[],[2,5]),!0)}function G(){s(),E();for(var te=!1;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(te||A(4,[],[]),m(","),E(),n.getToken()===2&&x)break}else te&&A(6,[],[]);oe()||A(4,[],[2,5]),te=!0}return c(),n.getToken()!==2?A(7,[2],[]):E(),!0}function ue(){l(),E();for(var te=!1;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(te||A(4,[],[]),m(","),E(),n.getToken()===4&&x)break}else te&&A(6,[],[]);pe()||A(4,[],[4,5]),te=!0}return u(),n.getToken()!==4?A(8,[4],[]):E(),!0}function pe(){switch(n.getToken()){case 3:return ue();case 1:return G();case 10:return T(!0);default:return j()}}return E(),n.getToken()===17?t.allowEmptyContent?!0:(A(4,[],[]),!1):pe()?(n.getToken()!==17&&A(9,[],[]),!0):(A(4,[],[]),!1)}function x8(r){switch(typeof r){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(r){if(Array.isArray(r))return"array"}else return"null";return"object"}default:return"null"}}var oK=S8;var C8=rK,w8=nK;var E8=vD;var aK=require("vscode");var yD=D(O()),tu=require("vscode");var gi=class{constructor(e){this.disposables=[];this._onDidChange=new tu.EventEmitter;e.push(this),ln()||tu.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),z(this.disposables)}isPythonEnvironmentExcluded(e){if(ln())return!1;let t=this.getExcludedPythonEnvironments(),n=sK(e,t),i="uri"in e?e.uri:e.executable.uri;return n&&(N("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),P(`Python Env hidden via filter: ${B(i)}`)),n}getExcludedPythonEnvironments(){if(!tu.workspace.workspaceFolders||tu.workspace.workspaceFolders.length===0)return tu.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return tu.workspace.workspaceFolders.forEach(t=>{e.push(...tu.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};gi=v([(0,yD.injectable)(),d(0,(0,yD.inject)(F))],gi);function sK(r,e){let t="uri"in r?r.envPath:r.environment?.folderUri,n="uri"in r?r.uri:r.executable.uri;return!n&&!t?!1:e.some(o=>{let s=B(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=B(n).toLowerCase().replace(/\\/g,"/"),c=n?n.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===c||s===c)return!0;let l=B(t||"").toLowerCase().replace(/\\/g,"/"),u=B(t||"").toLowerCase().replace(/\\/g,"/");return o===l||s===l||o===u||s===u})}var $p=class{constructor(e,t){this.disposableRegistry=e;this.pythonExtChecker=t;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(aK.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(aK.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,n){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||bo().length===0||!$p.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return bo().filter(o=>!sK(o,i)).map(o=>{let s=Wr(o),a=B(o.executable.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(_e(e.uri.fsPath)!=="settings.json")return!1;let n=oK(e.getText(),e.offsetAt(t));return n.path[0]==="jupyter.kernels.excludePythonEnvironments"&&n.path.length===2}getCurrentItemsInList(e,t){try{let n=e.getText(),i=oK(n,e.offsetAt(t)),o=C8(n),s=w8(o,[i.path[0]]);if(!s)return[];let a=E8(s);return Array.isArray(a)?a:[]}catch(n){return U("Failed to provide completions for python env filter",n),[]}}};$p=v([(0,tC.injectable)(),d(0,(0,tC.inject)(F)),d(1,(0,tC.inject)(Ye))],$p);var P8=D(O()),Bi=require("vscode");var vv=class{activate(){this.migrateFilters().catch(f)}async migrateFilters(){let e=Array.isArray(Bi.workspace.workspaceFolders)?Bi.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Bi.workspace.getConfiguration("jupyter",void 0),Bi.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Bi.workspace.getConfiguration("jupyter",void 0),Bi.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Bi.workspace.getConfiguration("jupyter",e[0].uri),Bi.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Bi.workspace.getConfiguration("jupyter",void 0),Bi.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Bi.workspace.getConfiguration("jupyter",t.uri),Bi.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let n=e.inspect("kernels.filter"),i=[];switch(t){case Bi.ConfigurationTarget.Global:i=n?.globalValue||[];break;case Bi.ConfigurationTarget.Workspace:i=n?.workspaceValue||[];break;default:i=n?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};vv=v([(0,P8.injectable)()],vv);var bD=D(O());var cK=require("vscode");var yv=class{constructor(e){this.disposables=e}activate(){this.disposables.push(cK.commands.registerCommand("jupyter.filterKernels",()=>cK.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(f,f),this))}};yv=v([(0,bD.injectable)(),d(0,(0,bD.inject)(F))],yv);var SD=D(O());var Jm=Symbol("IModuleInstaller"),oFe=Symbol("IPythonInstallation"),ID=Symbol("IInstallationChannelManager"),rC=Symbol("IProductService"),nC=Symbol("IProductPathService");var qi=Symbol("IInstaller");var Iv=require("vscode");var bv=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let n=await this.getInstallationChannels(t);if(n.length>=1)return n[0];if(n.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Jm),n=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(n.length>0)break;i=o.priority}await o.isSupported(e)&&n.push(o)}return n}async showNoInstallersMessage(e){let t=Be(e);if(await Iv.window.showErrorMessage(t==="Conda"?Gh.noCondaOrPipInstaller:Gh.noPipInstaller,{modal:!0},Gh.searchForHelp)===Gh.searchForHelp){let i=this.serviceContainer.get(Dr),o=i.isWindows?"Windows":i.isMac?"MacOS":"Linux";Iv.env.openExternal(Iv.Uri.parse(`https://www.bing.com/search?q=Install Pip ${o} ${t==="Conda"?"Conda":""}`))}}};bv=v([(0,SD.injectable)(),d(0,(0,SD.inject)(pt))],bv);var wD=D(O());var xD=require("vscode");function oo(r){switch(r){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${r} cannot be installed as a Python Module.`)}}var k8=require("os");var Sv=class extends et{constructor(t,n,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=n;this.originalMessage=i}};var Br=Symbol("IPythonExecutionFactory"),xFe=Symbol("IPythonExecutionService");var el=class{constructor(e){this.serviceContainer=e}async installModule(e,t,n,i){let o=typeof e=="string"?e:oo(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Br),c=this.serviceContainer.get(Ui),l=this.serviceContainer.get(js),u=this.serviceContainer.get(Fc);if(n.token.isCancellationRequested)return;let p=async(h,g)=>{let y=le(),x=[];g.onCancellationRequested(()=>{n.cancel(),y.resolve()},this,x);let E;if(s.useShellExec){let G=await c.create(void 0);if(n.token.isCancellationRequested)return;try{let ue=await G.shellExec(s.args.join(" "),{cwd:s.cwd});P(ue.stdout),y.resolve()}catch(ue){y.reject(ue)}}else if(s.exe){let G=await l.getActivatedEnvironmentVariables(void 0,t);if(n.token.isCancellationRequested)return;let ue={...process.env};u.mergeVariables(G||{},ue),u.mergePaths(G||{},ue);let pe=await c.create(void 0);if(n.token.isCancellationRequested)return;E=pe.execObservable(s.exe,s.args,{encoding:"utf-8",token:g,env:ue,cwd:s.cwd})}else{let G=await a.createActivatedEnvironment({interpreter:t});if(n.token.isCancellationRequested)return;E=G.execObservable(s.args,{encoding:"utf-8",token:g,cwd:s.cwd})}let A,T,j=[".","..","..."],oe=0;return E&&(E.out.onDidChange(G=>{let ue=j[oe%3],pe=G.out.trim();oe+=1;let te=pe.length>28?`${pe.substring(0,28)}${ue}`:pe;h.report({message:te}),P(G.out),G.source==="stderr"&&(T?T+=G.out:!T&&G.out.includes("ERROR: Could not install packages")&&(T=G.out.substring(G.out.indexOf("ERROR: Could not install packages"))),A=G.out)},this,x),E.out.done.then(()=>{E?.proc?.exitCode!==0?T&&T.includes("https://pip.pypa.io/warnings/enable-long-paths")?(T=We(T,{trim:!0,removeEmptyEntries:!0}).filter(G=>!G.startsWith("[notice]")).join(k8.EOL),y.reject(new Sv(e,t,T))):y.reject(A||E?.proc?.exitCode):y.resolve()},G=>{y.reject(G)}).finally(()=>z(x))),y.promise},m={location:xD.ProgressLocation.Notification,cancellable:!0,title:fN.installingModule(o)};await xD.window.withProgress(m,async(h,g)=>p(h,g))}};var Zme=[oo(18),oo(20)];function CD(r,e){return Zme.includes(e)?r==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var D8=require("vscode");var xv=class extends el{constructor(t){super(t)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(t){if(this._isCondaAvailable===!1)return!1;let n=this.serviceContainer.get($s);return this._isCondaAvailable=await n.isCondaAvailable(),this._isCondaAvailable?Be(t)==="Conda":!1}async installModule(t,n,i,o){if(await super.installModule(t,n,i,o),wr(n)){if(!this.serviceContainer.get(Ye).isPythonExtensionActive)return;let c=await this.serviceContainer.get(st).getInterpreterDetails(n.id);c&&!wr(c)&&Object.assign(n,c)}}async getExecutionArgs(t,n,i=0){let s=await this.serviceContainer.get($s).getCondaFile(),a=Mr(n)?.environment?.name,c=this.getEnvironmentPath(n),l=[i&1?"update":"install"];return[19,23,22,18,20].map(oo).includes(t)&&l.push("-c","conda-forge"),a?(l.push("--name"),l.push(BS(a))):c&&(l.push("--prefix"),l.push(qS(c))),i&2&&l.push("--update-deps"),i&4&&l.push("--force-reinstall"),l.push(t),l.push(...CD("conda",t)),l.push("-y"),{exe:s,args:l}}getEnvironmentPath(t){let n,i=Mr(t);if(i?.environment?.folderUri)return i.environment.folderUri.fsPath;n=i?.executable.uri||D8.Uri.file(t.id);let o=dt(n.fsPath),s=_e(o);return["BIN","SCRIPTS"].indexOf(s.toUpperCase())!==-1?Ve(o,".."):o}};xv=v([(0,wD.injectable)(),d(0,(0,wD.inject)(pt))],xv);var PD=D(O());function efe(){let r=jm("PIPENV_MAX_DEPTH");if(r===void 0)return 3;let e=parseInt(r,10);return isNaN(e)?(C(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${r}' to number results in NaN`),1):e}async function _8(r,e){let t=jm("PIPENV_PIPFILE")||"Pipfile",n=e.lookIntoParentDirectories?efe():1;for(;n>0&&!Vp(r,dt(r));){let i=Ve(r,t);if(await av(i))return i;r=dt(r),n-=1}}async function tfe(r){let e=Ve(r,".project");if(!await av(e))return;let t=await BJ(e);if(!await av(t)){C(`The .project file inside environment folder: ${r} doesn't contain a valid path to the project`);return}return t}async function rfe(r){let e=dt(dt(r.fsPath)),t=await tfe(e);if(!(t===void 0||!_e(Wp(e)).startsWith(`${_e(Wp(t))}-`)))return _8(t,{lookIntoParentDirectories:!1})}async function T8(r,e){let t=await rfe(r);if(!t)return!1;let n=jm("PIPENV_NO_INHERIT")===void 0,i=await _8(e.fsPath,{lookIntoParentDirectories:n});return i?Vp(t,i):!1}var ED=require("vscode");function iC(r){let e="executable"in r?r.executable.uri||ED.Uri.file(r.path):r.uri;return ED.workspace.getWorkspaceFolder(e)?.uri||Dc()}var A8=require("vscode");var R8="pipenv",Cv=class extends el{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return R8}get priority(){return 10}async isSupported(e){if(Yu(e)){let t=await this.serviceContainer.get(st).getActiveInterpreter(e),n=e?A8.workspace.getWorkspaceFolder(e):void 0;return!t||!n||Be(t)!=="PipEnv"?!1:T8(t.uri,n.uri)}else return Be(e)==="PipEnv"}async getExecutionArgs(e,t,n=0){let o=[n&4||n&2||n&1?"update":"install",e,"--dev"],s=iC(t);return{args:o,exe:R8,cwd:s?Ae(s):void 0}}};Cv=v([(0,PD.injectable)(),d(0,(0,PD.inject)(pt))],Cv);var kD=D(O());var N8=require("vscode");var wv=class extends el{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch(Be(e)){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,n=0){if(e===oo(27))return await this.serviceContainer.get(qi).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[Ve(XO,"get-pip.py")]};let i=[],o=N8.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),n&4&&i.push("--force-reinstall"),Be(t)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(CD("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Br).create({resource:void 0,interpreter:e}).then(n=>n.isModuleInstalled("pip")).catch(()=>!1)}};wv=v([(0,kD.injectable)(),d(0,(0,kD.inject)(pt))],wv);var oC=D(O());var nfe=5e4,ru=class ru{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(ife(e))return(ru.poetryPromise.get(e)===void 0||Nr())&&ru.poetryPromise.set(e,ru.locate(e)),ru.poetryPromise.get(e)}static async locate(e){P(`Getting poetry for cwd ${e}`);function*t(){let n=$J("poetryPath");n&&n!=="poetry"&&(yield n),yield"poetry";let i=cv();if(i){let o=Ve(i.fsPath,".poetry","bin","poetry");VO(o)&&(yield o)}}for(let n of t()){P(`Probing poetry binary for ${e}: ${n}`);let i=new ru(n,e);if(await i.getEnvList()!==void 0)return P(`Found poetry via filesystem probing for ${e}: ${n}`),i;P(`Failed to find poetry for ${e}: ${n}`)}P(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let n=await this.safeShellExecute(`${e} env list --full-path`);if(!n)return;let i="(Activated)";return(await Promise.all(We(n.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await av(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(jr()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let n=new Ge,i=await VJ(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:nfe}).catch(o=>{t?P(o):C(o)});return P(`Time taken to run ${e} in ms`,n.elapsedTime),i}};v([fA(3e4)],ru.prototype,"getEnvListCached",1),v([fA(2e4)],ru.prototype,"getActiveEnvPathCached",1);var DD=ru;async function M8(r,e,t){let i=await(t?new DD(t,e):await DD.getPoetry(e))?.getActiveEnvPath();return i?sv(r,i):!1}function ife(r){let e=Ve(r,"pyproject.toml");return!(!VO(e)||!qJ(e).includes("[tool.poetry]"))}var O8=require("vscode");var ofe="poetry",Ev=class extends el{constructor(t,n){super(t);this.configurationService=n}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return ofe}get priority(){return 10}async isSupported(t){if(Be(t)!=="Poetry")return!1;let n=iC(t);if(n){let i="executable"in t?t.executable.uri||O8.Uri.file(t.path):t.uri;return M8(i.fsPath,n.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,n){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=iC(n)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};Ev=v([(0,oC.injectable)(),d(0,(0,oC.inject)(pt)),d(1,(0,oC.inject)(de))],Ev);var tl=D(O()),W8=require("vscode");var hr=new Map;hr.set(18,"jupyter");hr.set(20,"notebook");hr.set(19,"ipykernel");hr.set(22,"nbconvert");hr.set(21,"kernelspec");hr.set(23,"pandas");hr.set(27,"pip");hr.set(28,"ensurepip");var Hp=D(O());var K8=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(r=>r.toLowerCase())),F8="NOT INSTALLED",Hs=class{constructor(e,t,n,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=n;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;Hs._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return Hs._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=vn(e.uri),n=this.interpreterInformation.get(t);return n||(n=le(),this.interpreterInformation.set(t,n),this.trackInterpreterPackages(e).catch(f)),n.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let n=await this.getPackageVersions(e),i=await vt(t.toLocaleLowerCase());if(!n.has(i))return;let o=n.get(i);if(o)return o===F8?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(f)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=Ns(e);if(!this.interpreterPackages.has(t)){let n=this.listPackagesImpl(e);this.interpreterPackages.set(t,n),n.catch(i=>{this.interpreterPackages.get(t)===n&&this.interpreterPackages.delete(t),U(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(n=>Array.from(n))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let n=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await n.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(c=>c.toLowerCase())))}else return C(`Failed to get list of installed packages for ${tn(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let n;if(Yu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;n=i}else n=e;this.trackInterpreterPackages(n,t).catch(f)}async trackInterpreterPackages(e,t){let n=vn(e.uri);if(this.pendingInterpreterInformation.has(n)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(n)===i&&this.pendingInterpreterInformation.delete(n)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(f),this.pendingInterpreterInformation.set(n,i)}async getPackageInformation({interpreter:e}){if(wr(e))return;let n=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(K8).map(async a=>{i.set(await vt(a),F8)})),await Promise.all(n.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let c=a.split(" ").filter(m=>m.trim().length);if(c.length<2)return;let[l,u]=c;if(!K8.has(l.toLowerCase().trim()))return;let p=lp(u);i.set(await vt(l),p||"")}));let o=vn(e.uri),s=this.interpreterInformation.get(o);s||(s=le(),this.interpreterInformation.set(o,s)),s.resolve(i)}};Hs=v([(0,Hp.injectable)(),d(0,(0,Hp.inject)(Ye)),d(1,(0,Hp.inject)(st)),d(2,(0,Hp.inject)(Br)),d(3,(0,Hp.inject)(tr)),d(4,(0,Hp.inject)(F))],Hs);async function _D(r,e,t){if(Yu(t))return;let n=`${await Pc(t)}#${hr.get(e)}`;await r.update(n,!0)}async function L8(r,e,t){let n=`${await Pc({uri:t})}#${hr.get(e)}`;await r.update(n,void 0)}async function U8(r,e,t){let n=`${await Pc(t)}#${hr.get(e)}`;return r.get(n,!1)}var TD=Symbol("IReservedPythonNamedProvider"),Gp=Symbol("IInterpreterPackages"),RD=Symbol("IWorkspaceInterpreterTracker");async function V8(r,e,t){let n=`${await Pc(t)}#${hr.get(e)}`;if(r.get(n,!1))return!0;let i=oo(e),o=Hs.instance?Hs.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{C("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await xr(500,o);if(typeof s=="string")return s==="found"}catch{C(`Failed to check if package exists ${hr.get(e)}`)}}var AD=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(de),this.productService=e.get(rC),this.persistentStateFactory=e.get(sc)}async install(e,t,n,i,o){let a=await this.serviceContainer.get(ID).getInstallationChannel(e,t);if(!a)return 2;if(n.token.isCancellationRequested)return 3;let c=i===!0?6:void 0;return o===!0&&(c=c?c|8:8),await a.installModule(e,t,n,c),n.token.isCancellationRequested?3:this.isInstalled(e,t).then(l=>l?0:2)}async isInstalled(e,t){let n=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Br).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(n):(await this.serviceContainer.get(Ui).create(void 0)).exec(n,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(nC,n).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(nC,n).isExecutableAModule(e,t)}};v([ui("Checking if product is installed"),d(1,Wl("path"))],AD.prototype,"isInstalled",1);var Pv=class{constructor(e,t,n,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=n;this.output=i;this._onInstalled=new W8.EventEmitter;this.productService=e.get(rC)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,n,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,n,i,o);switch(_D(this.memento,e,t).catch(f),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{N("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:hr.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return oo(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new AD(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};Pv=v([(0,tl.injectable)(),d(0,(0,tl.inject)(pt)),d(1,(0,tl.inject)(Gp)),d(2,(0,tl.inject)($e)),d(2,(0,tl.named)(gt)),d(3,(0,tl.inject)($o)),d(3,(0,tl.named)(zu))],Pv);var ND=D(O());var dK=class{constructor(e){this.serviceContainer=e;this.configService=e.get(de),this.productInstaller=e.get(qi)}isExecutableAModule(e,t){if(e===21)return!1;let n;try{n=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof n=="string"&&n.length>0&&_e(i)===i}},kv=class extends dK{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};kv=v([(0,ND.injectable)(),d(0,(0,ND.inject)(pt))],kv);var B8=D(O());var Dv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};Dv=v([(0,B8.injectable)()],Dv);var MD=D(O());var _v=class{constructor(e){this.interpreterService=e}activate(){this.interpreterService.initialize()}};_v=v([(0,MD.injectable)(),d(0,(0,MD.inject)(st))],_v);var mK=require("vscode"),Tv=D(O());var Gs=class{constructor(e,t,n){this.title=b.localPythonEnvironments;this._onDidChange=new mK.EventEmitter;this._onDidChangeStatus=new mK.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new Io;this._status="idle";n.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>C("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(f)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){z(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(f)}withFilter(e){return new Proxy(this,{get(t,n){switch(n){case"items":return t.items.filter(e);case"dispose":return f;default:return t[n]}}})}};Gs=v([(0,Tv.injectable)(),d(0,(0,Tv.inject)(tr)),d(1,(0,Tv.inject)(Ye)),d(2,(0,Tv.inject)(F))],Gs);var Av=D(O());function fK(r,e){if(Array.isArray(r)){let t=r.slice(1);return e&&t.push(...e),{args:t,command:r[0],python:[...r],pythonExecutable:r[r.length-1]}}return{command:r,args:e||[],python:[r],pythonExecutable:r}}function q8(r,e){let t={command:r.command,args:[...r.args],python:[...r.python],pythonExecutable:r.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var G8=require("vscode");function hK(r,e){return["-m",r,...e]}function J8(){let r=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[r,e]}function $8(r){let e=["-c",`import ${r};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(n){return n.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(P(`Module ${r} is not installed. Output ${n}`),!1)}return[e,t]}async function z8(r,e){let[t,n]=J8(),i=q8(r,t),o=await e(i.command,i.args);return G8.Uri.file(n(o.stdout))}var OD=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return fK(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return fK(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return z8(e,this.deps.exec)}async isModuleInstalled(e){let[t,n]=$8(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return n(o.stdout)}catch(o){return U(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function Q8(r,e,t,n,i){return{getPythonArgv:o=>e||[Ae(o)],getObservablePythonArgv:o=>t||[Ae(o)],isValidExecutable:r,exec:async(o,s,a)=>n(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function Y8(r,e,t){let n=Q8(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new OD(r,n)}function X8(r,e,t,n,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[r,...o,"python"],a=Q8(async c=>i.exists(c),s,void 0,(c,l,u)=>n.exec(c,l,u),(c,l)=>n.shellExec(c,l));return new OD(t,a)}var KD=class extends et{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var gK=class{constructor(e){this.deps=e}execObservable(e,t){let n={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,n)}execModuleObservable(e,t,n){let i=hK(e,t),o={...n},s=this.deps.getExecutionObservableInfo(i),a={...n};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let n={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,n)}async execModule(e,t,n){let i=hK(e,t),o={...n},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&zE.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new KD(e);return a}};function Z8(r,e){let t={isModuleInstalled:async n=>e.isModuleInstalled(n),getExecutionInfo:n=>e.getExecutionInfo(n),getExecutionObservableInfo:n=>e.getExecutionObservableInfo(n),exec:async(n,i,o)=>r.exec(n,i,o),execObservable:(n,i,o)=>r.execObservable(n,i,o)};return new gK(t)}var FD=require("vscode");var Rv=class{constructor(e,t,n){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=n;this.disposables=this.serviceContainer.get(F),this.fileSystem=this.serviceContainer.get(ut)}async create(e){let t=await this.processServiceFactory.create(e.resource);return e7(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:FD.workspace.workspaceFolders?.length?FD.workspace.workspaceFolders[0].uri:void 0,!FD.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new Qc({...t});return this.disposables.push(i),e7(e.interpreter,i,this.fileSystem)}};Rv=v([(0,Av.injectable)(),d(0,(0,Av.inject)(pt)),d(1,(0,Av.inject)(js)),d(2,(0,Av.inject)(Ui))],Rv);function e7(r,e,t,n){let i=Y8(r,e,t);if(n){let[s,a]=n;i=X8(s,a,r,e,t)}let o=Z8(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,c)=>o.execModuleObservable(s,a,c),exec:(s,a)=>o.exec(s,a),execModule:(s,a,c)=>o.execModule(s,a,c)}}var nu=D(O()),iu=require("vscode");var t7="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",r7=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var C7=D(aC());var gr=Symbol("IFileSystemNode");var kfe="jupyter.pythonPackages",xK="diagnostics.reservedPythonNames.exclude",Mv=class{constructor(e,t,n,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];n.push(this),this.cachedModules=new Set(this.cache.get(kfe,r7).map(o=>o.toLowerCase())),iu.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${xK}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){z(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,n]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>iu.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(n.map(a=>iu.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,C7.default)(t,o,{dot:!0}))return!0}))return!1;let n=yn(e,op(e)).toLowerCase(),i=n==="__init__"?yn(Ti(e)).toLowerCase():n;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=iu.workspace.getConfiguration("jupyter"),n=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(n),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(xK,Array.from(this.ignoredFiles),iu.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=iu.workspace.getConfiguration("jupyter").get(xK,[]);this.platform.isWindows&&(t=t.map(n=>n.toLowerCase())),this.ignoredFiles=new Set(t)}};Mv=v([(0,nu.injectable)(),d(0,(0,nu.inject)($e)),d(0,(0,nu.named)(gt)),d(1,(0,nu.inject)(Dr)),d(2,(0,nu.inject)(F)),d(3,(0,nu.inject)(gr))],Mv);var cC=D(O());var wK=D(mD());var CK="_VSCODE_getVariable",Ov=wK.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,os=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${CK}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Ov}:{code:`${t}

${i}

${Ov}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${CK}("properties", ${n}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Ov}:{code:`${t}

${i}

${Ov}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfVariablesScript();return e?t=t+`

return _VSCODE_getAllChildrenDescriptions('${e.root}', ${JSON.stringify(e.propertyChain)}, ${e.startIndex})`:t=t+`

variables= %who_ls
return _VSCODE_getVariableDescriptions(variables)`,t}async generateCodeToGetVariableTypes(e){let n=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=wK.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${CK}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:n,code:s,cleanupCode:`${Ov}
${o}`}:{code:`${n}${s}

${Ov}
${o}`}}async generateCodeToGetVariableValueSummary(e){let t=await this.getContentsOfVariablesScript();return t=t+`

variables= %who_ls
return _VSCODE_getVariableSummary(${e})`,t}async getContentsOfScript(){if(os.contentsOfScript)return os.contentsOfScript;let e=ir(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return os.contentsOfScript=t,t}async getContentsOfVariablesScript(){if(os.contentsOfVariablesScript)return os.contentsOfVariablesScript;let e=ir(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariablesForProvider.py"),t=await this.fs.readFile(e);return os.contentsOfVariablesScript=t,t}};os=v([(0,cC.injectable)(),d(0,(0,cC.inject)(ut)),d(1,(0,cC.inject)(lt))],os);var Kv=D(O());var Ma=class{constructor(e){this.workspaceInterpreterTracker=e;Ma.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};Ma.isActiveWorkspaceInterpreter=()=>!1,Ma=v([(0,Kv.injectable)(),d(0,(0,Kv.inject)(RD)),d(0,(0,Kv.optional)())],Ma);var lC=require("vscode");var Lv=D(O());var Fv=class{constructor(e,t,n){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=n;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),lC.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let n=Ns(e),i=this.workspaceInterpreters.get(n);return i?Go(i,t.uri):!1}trackActiveInterpreters(){ln()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(lC.workspace.workspaceFolders)?lC.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let n=Ns(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(n,i?.uri)}catch{}}))},this,this.disposables))}};Fv=v([(0,Lv.injectable)(),d(0,(0,Lv.inject)(Ye)),d(1,(0,Lv.inject)(F)),d(2,(0,Lv.inject)(st))],Fv);function w7(r){r.addSingleton(Br,Rv),r.addSingleton($s,$s),r.addSingleton(Wc,Wc),r.addSingleton(Gp,Hs),r.addSingleton(Ie,Ma),r.addSingleton(Ie,_v),r.addSingleton(RD,Fv),r.addSingleton(Ie,vv),r.addSingleton(Ie,yv),r.addSingleton(Ie,$p),r.addSingleton(gi,gi),r.addSingleton(TD,Mv),r.addSingleton(Kh,os),r.addSingleton(Fh,Zc),r.addSingleton(Jm,xv),r.addSingleton(Jm,wv),r.addSingleton(Jm,Cv),r.addSingleton(Jm,Ev),r.addSingleton(ID,bv),r.addSingleton(rC,Dv),r.addSingleton(qi,Pv),r.addSingleton(nC,kv,"DataScience"),r.addSingleton(Gs,Gs),r.addBinding(Gs,Ie)}var D7=D(O()),jv=require("vscode");var P7=new Set;function k7(r){P7.add(r)}function E7(r){try{P7.forEach(e=>e.report(r))}catch(e){C("Failed to report progress",e)}}function Uv(r){return function(e,t,n){let i=n.value;n.value=async function(...o){return E7({action:r,phase:"started"}),i.apply(this,o).finally(()=>{E7({action:r,phase:"completed"})})}}}var ss=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];k7(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let n=new jv.CancellationTokenSource,i=le(),o={location:jv.ProgressLocation.Notification,cancellable:t,title:e};return jv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&n.cancel(),i.resolve()}),n.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(f,f),{token:n.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=ek(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};ss=v([(0,D7.injectable)()],ss);var _7=D(O());var ni=require("vscode");var ou=require("vscode");var uC=class r{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLes.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(r.migratedSettings))e.push(...this.migrateSetting(t,r.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){Wv(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(n?.globalValue===n?.defaultValue||!i||i?.globalValue&&i.globalValue[xe])return;if(typeof n?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[xe]=n.globalValue.split(""),await this.jupyterConfig.update(t,o,ou.ConfigurationTarget.Global).then(f,Wv)}}finally{n?.globalValue&&await this.jupyterConfig.update(e,void 0,ou.ConfigurationTarget.Global).then(f,Wv)}}migrateSetting(e,t){let n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(n?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceValue,ou.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,ou.ConfigurationTarget.Workspace),Wv))}if(n?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceFolderValue,ou.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,ou.ConfigurationTarget.WorkspaceFolder),Wv))}if(n?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,n.globalValue,ou.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,ou.ConfigurationTarget.Global),Wv))}return o}};function Wv(r){U("Error migrating Jupyter configuration",r)}function Dfe(r){return(e,t,n)=>{let i=null,o=null;if(typeof n.value=="function"?(i="value",o=n.value):typeof n.get=="function"&&(i="get",o=n.get),!o)throw new Error("not supported");n[i]=r(o,t)}}function Vv(r,e,t){return Dfe((n,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{n.apply(this,a),this[s]=t?t():void 0},r)}})}var Oa=class Oa{constructor(e,t,n){this._systemVariablesCtor=t;this._type=n;this.logging={level:"error"};this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.normalizeSelectionForInteractiveWindow=!0;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this._changeEmitter=new ni.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),ni.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,n){let i=Oa.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=Oa.jupyterSettings.get(o);return s?s._type==="web"&&n==="node"&&(s._systemVariablesCtor=t,s._type=n):(s=new Oa(i,t,n),Oa.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?ni.workspace.getWorkspaceFolder(e):void 0,n=t?t.uri:void 0;!n&&Array.isArray(ni.workspace.workspaceFolders)&&ni.workspace.workspaceFolders.length>0&&(n=ni.workspace.workspaceFolders[0].uri);let i=n?ni.ConfigurationTarget.WorkspaceFolder:ni.ConfigurationTarget.Global;return{uri:n,target:i}}static dispose(){if(!Nr())throw new Error("Dispose can only be called from unit tests");Oa.jupyterSettings.forEach(e=>e&&e.dispose()),Oa.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(n=>e[n]=this[n]),e}update(e,t){let n=this.createSystemVariables(void 0),i=n.resolveAny(e.get("logging"));i&&(i.level=_fe(i.level),this.logging?Object.assign(this.logging,i):this.logging=i);let o=n.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,o):this.experiments=o,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let s=(c,l)=>{let u=uC.fullSettingIds[c],p=u&&l.get(u)!==void 0?l.get(u):l.get(c),m=n.resolveAny(p);m!==void 0&&(this[c]=m)};this.getSerializableKeys().filter(c=>c!=="experiments"&&c!=="logging"&&c!=="kernelPickerType").forEach(c=>s(c,e)),t&&s("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(ni.workspace.workspaceFolders||[]).map(i=>i.uri.path),n=Array.from(Oa.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)Oa.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=ni.workspace.getConfiguration("jupyter",this._workspaceRoot),o=ni.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(ni.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(ni.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=ni.workspace.getConfiguration("jupyter",this._workspaceRoot),n=ni.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,n),this.migrateSettings(t).catch(f))}async migrateSettings(e){await new uC(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};v([Vv(1)],Oa.prototype,"debounceChangeNotification",1);var Bv=Oa;function _fe(r){switch(r){case"info":return 20;case"warn":return 30;case"off":return"off";case"debug":return 10;case"verbose":return 5;default:return 40}}var rl=require("vscode");var jD=class{async updateSectionSetting(e,t,n,i,o){let a={uri:i,target:o||rl.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==rl.ConfigurationTarget.Global&&(a=Bv.getSettingsUriAndTarget(i));let c=rl.workspace.getConfiguration(e,a.uri),l=c.inspect(t);l!==void 0&&(o===rl.ConfigurationTarget.Global&&l.globalValue===n||o===rl.ConfigurationTarget.Workspace&&l.workspaceValue===n||o===rl.ConfigurationTarget.WorkspaceFolder&&l.workspaceFolderValue===n)||(await c.update(t,n,o),o&&await this.verifySetting(c,o,t,n))}async updateSetting(e,t,n,i){return this.updateSectionSetting("jupyter",e,t,n,i)}async verifySetting(e,t,n,i){if(Nr()&&!FS()){let o=0;do{let s=e.inspect(n);if(!s&&i===void 0||s&&i!==void 0&&(t===rl.ConfigurationTarget.Global?s.globalValue:t===rl.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var qv=class extends jD{getSettings(e){return Bv.getInstance(e,dv,"node")}};qv=v([(0,_7.injectable)()],qv);var Hn=D(Gc()),w$=D(FK()),E$=D(O()),P$=D(v$()),k$=require("util");var x$=D(O()),ed=D(require("vscode"));var I$=D(b$()),S$=require("vscode"),nl=class{constructor(e=I$.fetch){this.fetchImplementation=e;this.requestOptions={};let t=S$.workspace.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return this.fetchImplementation(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return P(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var C$="utf8",zv=class{constructor(){this.vscfs=ed.workspace.fs}arePathsSame(e,t){return _i(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(n=>n[1]===ed.FileType.File).map(n=>ed.Uri.file(n[0]))}async copy(e,t,n){await this.vscfs.copy(e,t,n)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return new TextDecoder().decode(t)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){return this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new nl().exists(e.toString());let n;try{n=await this.stat(e)}catch(i){return iD(i)||C(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===ed.FileType.Unknown?n.type===ed.FileType.Unknown:(n.type&t)===t}async getFileHash(e){let t=await this.stat(e),n=`${t.ctime}-${t.mtime}`;return Ea(n,"SHA-512")}};zv=v([(0,x$.injectable)()],zv);var D$=require("vscode");var cu=class extends zv{constructor(){super();this.globFiles=(0,k$.promisify)(w$.default)}createLocalWriteStream(t){return Hn.createWriteStream(t)}async createTemporaryLocalFile(t){let n=typeof t=="string"?t:t.fileExtension,i=t&&typeof t=="object"?t.prefix:void 0,o={postfix:n,prefix:i};return new Promise((s,a)=>{P$.file(o,(c,l,u,p)=>{if(c)return a(c);s({filePath:l,dispose:p})})})}async searchLocal(t,n,i){let o;n&&(o={...o,cwd:n}),i&&(o={...o,dot:i});let s=await this.globFiles(t,o);return Array.isArray(s)?s:[]}async writeLocalFile(t,n){return await Hn.ensureDir(dt(t)),Hn.writeFile(t,n)}async readFile(t){if(Ym(t)){let n=await Hn.readFile(Ae(t));return Buffer.from(n).toString(C$)}else return super.readFile(t)}async delete(t){Ym(t)?await this.exists(t)&&((await this.stat(t)).type===D$.FileType.Directory?await new Promise(i=>Hn.rm(Ae(t),{force:!0,recursive:!0},i)):await Hn.unlink(Ae(t))):await super.delete(t)}async exists(t,n){return Ym(t)?Hn.pathExists(Ae(t)):super.exists(t,n)}async createDirectory(t){Ym(t)?await Hn.ensureDir(Ae(t)):await this.vscfs.createDirectory(t)}async writeFile(t,n){if(Ym(t)){let i=Ae(t);return await Hn.ensureDir(dt(i)),Hn.writeFile(i,typeof n=="string"?Buffer.from(n):n)}else await this.vscfs.writeFile(t,typeof n=="string"?new TextEncoder().encode(n):n)}async copy(t,n,i){if(Ym(t)&&Ym(n)){let o=typeof i===void 0||typeof i?.overwrite==null?!0:i?.overwrite;await Hn.copy(Ae(t),Ae(n),{overwrite:o})}else await super.copy(t,n,i)}};cu=v([(0,E$.injectable)()],cu);function Ym(r){return r.scheme==="file"}var vC=D(Gc());var _$=D(O()),T$=require("vscode");var Qv=class extends mP{async computeWorkingDirectory(e){return yC(e)}};Qv=v([(0,_$.injectable)()],Qv);async function yC(r){let e=r&&r.scheme==="file"?await vC.pathExists(r.fsPath):!1;return(r&&r.scheme==="file"?await vC.pathExists(dt(r.fsPath)):!1)&&r&&r.fsPath.includes(".")?dt(r.fsPath):e&&r&&(await vC.stat(r.fsPath)).isDirectory()?r.fsPath:r&&T$.workspace.getWorkspaceFolder(r)?.uri.fsPath||Dc()?.fsPath||process.cwd()}var Xm=D(O());var R$=require("vscode");var Yv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(R$.commands.registerCommand($.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};Yv=v([(0,Xm.injectable)(),d(0,(0,Xm.inject)($o)),d(0,(0,Xm.named)(zu)),d(1,(0,Xm.inject)(F))],Yv);var bC=D(O()),N$=require("vscode");var A$=require("vscode");var Xv=class{constructor(e,t,n,i=[]){this.fs=e;this.disposableRegistry=t;this.options=n;this.loadFailedEmitter=new A$.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};n.webviewHost?(this.webviewHost=n.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),n=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString(),i="false";return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Qe.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${n}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return ${i};
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=b.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){C(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var XK=class extends Xv{constructor(t,n,i,o=[]){super(t,n,i,o);this.panelOptions=i;this._onDidChangeVisibility=new N$.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(n=>{this.panelOptions.listener.onMessage(n.type,n.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},Zv=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new XK(this.fs,this.disposableRegistry,e)}};Zv=v([(0,bC.injectable)(),d(0,(0,bC.inject)(F)),d(1,(0,bC.inject)(ut))],Zv);var ty=D(O()),HD=require("vscode");var ZK=class extends Xv{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,n,i=[]){super(e,t,n,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return HD.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},ey=class{constructor(e,t,n){this.disposableRegistry=e;this.fs=t;this.context=n}async create(e){let t=[HD.Uri.file(Ve(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new ZK(this.fs,this.disposableRegistry,e,t)}};ey=v([(0,ty.injectable)(),d(0,(0,ty.inject)(F)),d(1,(0,ty.inject)(ut)),d(2,(0,ty.inject)(lt))],ey);function M$(r){r.addSingleton(cu,cu),r.addBinding(cu,gr),r.addBinding(cu,ut),r.addSingleton(ok,Qv),r.addSingleton(de,qv),x3(r),f8(r),g8(r),w7(r),r.addSingletonInstance(e2,Date.now()),r.addSingleton(ss,ss),r.addSingleton(Ie,ht),r.addSingleton(Oh,Yv),r.add(sk,Zv),r.add(Dp,ey)}var Zm=D(O()),j$=require("vscode");var nd=D(O()),iy=require("vscode");var IC=D(O()),lu=require("vscode");var ry=Symbol("IJupyterCommandFactory"),td=Symbol("IJupyterSubCommandExecutionService");function Ihe(r){r.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function eF(r,e){let t=Wr(e)||Wr(e)||Mr(e)?.environment?.folderUri?.fsPath||e.uri.fsPath,n=r.map(i=>hr.get(i)).filter(i=>!!i).map(i=>i);switch(n.length){case 0:return"";case 1:return t?b.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,n[0]):b.libraryRequiredToLaunchJupyterNotInstalled(n[0]);default:{let i=n.pop();return t?b.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${n.join(", ")} ${ve.and} ${i}`):b.librariesRequiredToLaunchJupyterNotInstalled(`${n.join(", ")} ${ve.and} ${i}`)}}}var zs=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let n=new lu.CancellationTokenSource;try{let i=Be(e)==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=eF(s===!1?[27].concat(o):o,e);switch(N("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:hr.get(18),pythonEnvType:Be(e)}),await lu.window.showErrorMessage(a,{modal:!0},b.jupyterInstall,b.selectDifferentJupyterInterpreter)){case b.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let l=o.filter(p=>p!==21);Ihe(l);let u=l.shift();for(;u;)if(await sr(n.token,2,this.installer.install(u,e,n,void 0,s===!1))===0){u=l.shift();continue}else return 2;return N("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case b.selectDifferentJupyterInterpreter:return N("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case b.pythonInteractiveHelpLink:return lu.env.openExternal(lu.Uri.parse(KS.PythonInteractiveHelpLink)),N("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return N("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{n.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(n=>n.length===0)}async getDependenciesNotInstalled(e,t){let n=vn(e.uri);if(this.dependenciesInstalledInInterpreter.has(n))return[];let i=[];if(await sr(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(n),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(C("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await lu.window.showErrorMessage(b.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},b.selectDifferentJupyterInterpreter)===b.selectDifferentJupyterInterpreter?1:2}};v([Uv("InstallingMissingDependencies")],zs.prototype,"installMissingDependencies",1),zs=v([(0,IC.injectable)(),d(0,(0,IC.inject)(qi)),d(1,(0,IC.inject)(ry))],zs);var XD=D(O());var ZD=require("vscode");var K$=require("vscode");function GD(r,e){let t=Wr(r),i={label:`${r.id===e.recommended?.id?"$(star-full) ":wr(r)?"$(warning) ":""}${t}`};return i.description=B(r.executable.uri||r.path,K$.workspace.workspaceFolders||[],new zc().homeDir),i.tooltip=wr(r)?b.pythonCondaKernelsWithoutPython:"",i}function zD(r){switch(Be(r)){case"Conda":return wr(r)?{label:b.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:b.kernelCategoryForConda};case"PipEnv":return{label:b.kernelCategoryForPipEnv};case"Poetry":return{label:b.kernelCategoryForPoetry};case"Pyenv":return{label:b.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:b.kernelCategoryForVirtual};default:return{label:b.kernelCategoryForGlobal}}}var Qs=D(O()),F$=require("vscode");var QD="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",tF="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",Ka=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(tF,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(QD,void 0);if(e)return F$.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(QD,e?.toString()).then(f,f),this.memento.update(tF,!0).then(f,f)}};Ka=v([(0,Qs.injectable)(),d(0,(0,Qs.inject)($e)),d(0,(0,Qs.named)(gt))],Ka);var ny=class{constructor(e,t,n,i){this.api=e;this.memento=t;this.checker=n;this.disposables=i}activate(){this.activateBackground().catch(f),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(QD)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(QD,t),await this.memento.update(tF,!0)}};ny=v([(0,Qs.injectable)(),d(0,(0,Qs.inject)(tr)),d(1,(0,Qs.inject)($e)),d(1,(0,Qs.named)(gt)),d(2,(0,Qs.inject)(Ye)),d(3,(0,Qs.inject)(F))],ny);var as=require("vscode");var rF=class{constructor(e){this.label=e}},YD=class extends rF{constructor(t,n){super(t);this.sortKey=n;this.kind=as.QuickPickItemKind.Separator}},rd=class extends or{constructor(t,n,i,o,s,a){super();this.provider=t;this.createQuickPickItem=n;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=new Set;this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let n=this._recommended?.id!==t?.id;this._recommended=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let n=this._selected!==t;this._selected=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],n={iconPath:new as.ThemeIcon("refresh"),tooltip:ve.refresh},i=this.quickPick=as.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.matchOnDescription=!0,i.buttons=this.options.supportsBack?[as.QuickInputButtons.Back,n]:[n],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>z(t),this,t),i.title=this._title||b.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=b.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===n&&(i.busy=!0,await o.refresh().catch(f),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new as.Disposable(()=>s&&clearTimeout(s)));break}},this,t),L$(o.items.map(a=>this.toQuickPickItem(a)),(a,c)=>U$(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{let c=this.connectionToCategory(a[0].item);this.quickPickItems.push(c),a.sort((l,u)=>l.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(c,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>C(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.has(t)}addCommand(t,n){let i=t;return i.execute=n,this.commands.add(i),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{this.commands.delete(i)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:n,disposables:i}=this.createQuickPick();n.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{n.onDidChangeSelection(c=>{if(c.length){let l=c[0];this.isSelectorQuickPickItem(l)?s(l.item):this.isCommandQuickPickItem(l)?s(l):this.isErrorQuickPickItem(l)}}),n.onDidTriggerButton(c=>c===as.QuickInputButtons.Back?s(Ne.back):void 0,this,i),n.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof Ne)return o===Ne.back?Ne.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===Ne.back)continue;return s instanceof Ne,s}return o||void 0}finally{z(i)}}}updateQuickPickItems(t,n){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(n.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let c=i.get(a.item.id);if(c&&c!==a.item)return this.toQuickPickItem(c);let l=o.get(a.item.id);if(l){let u=this.toQuickPickItem(l);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(l)}}return a});let s=n.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,n),L$(s,(a,c)=>U$(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{a.sort((u,p)=>u.label.localeCompare(p.label));let c=this.connectionToCategory(a[0].item),l=this.quickPickItems.find(u=>u.kind===as.QuickPickItemKind.Separator&&u.label===c.label);if(l){let u=this.quickPickItems.indexOf(l),p=this.categories.get(l),m=new Map(Array.from(p).map(y=>[y.item.id,y])),h=p.size;a.forEach(y=>{let x=m.get(y.item.id);x&&p.delete(x),p.add(y)});let g=Array.from(p);g.sort((y,x)=>y.label.localeCompare(x.label)),this.quickPickItems.splice(u+1,h,...g)}else{let u=this.quickPickItems.filter(h=>h instanceof YD).map((h,g)=>[h,g]);u.push([c,-1]),u.sort((h,g)=>h[0].sortKey.localeCompare(g[0].sortKey));let p=u.findIndex(h=>h[1]===-1),m=0;p>0&&(m=u.length===p+1?this.quickPickItems.length:u[p+1][1]),a.sort((h,g)=>h.label.localeCompare(g.label)),this.quickPickItems.splice(m,0,c,...a),this.categories.set(c,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];n&&i.push({label:b.recommendedItemCategoryInQuickPick,kind:as.QuickPickItemKind.Separator},n);let o=n;o=this.selected?this.quickPickItems.filter(p=>this.isSelectorQuickPickItem(p)).map(p=>p).find(p=>p.item.id===this.selected?.id):o;let s=this.quickPickItems.filter(p=>!this.isSelectorQuickPickItem(p)||p.item.id!==n?.item?.id),a=t.activeItems.length?t.activeItems[0]:void 0;o&&a&&(this.isSelectorQuickPickItem(a)?a.item.id!==o.item.id&&(o=void 0):o=void 0);let c=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,l=[].concat(Array.from(this.commands.values())).concat(i).concat(s).concat(c?[c]:[]),u=o?[o]:t.activeItems.length?[t.activeItems[0]]:[];if(u.length&&!l.includes(u[0])){let p=u[0],m=this.isSelectorQuickPickItem(p)&&l.find(h=>this.isSelectorQuickPickItem(h)&&h.item.id===p.item.id);m?u[0]=m:u.length=0}t.items=l,t.activeItems=u,!t.activeItems.length&&this.previouslySelectedItem&&l.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let n=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(n),n}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let n=this.createQuickPickItem(t,this);return n.item=t,this.quickPickItemMap.add(n),n}removeOutdatedQuickPickItems(t,n){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(n.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((c,l)=>{c.forEach(u=>{s.includes(u.item.id)&&(c.delete(u),a.push(u))}),c.size||(a.push(l),this.categories.delete(l))}),this.quickPickItems=this.quickPickItems.filter(c=>!a.includes(c)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let n=this.getCategory(t,this);return new YD(n.label,n.sortKey||n.label)}};function L$(r,e){let t=[],n;for(let i of r.slice(0).sort(e))!n||e(n[0],i)!==0?(n=[i],t.push(n)):n.push(i);return t}function U$(r,e){return(r.sortKey||r.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var uu=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(st).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new ZD.CancellationTokenSource,t=new zc,n=this.serviceContainer.get(Ka).selectedPythonPath,i=Pe.instance.get(gi),o=Pe.instance.get(Gs).withFilter(u=>!wr(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Go(u.executable.uri,n,t.osType)),a=n?b.currentlySelectedJupyterInterpreterForPlaceholder(B(n,ZD.workspace.workspaceFolders||[],t.homeDir)):"",c=[],l=new rd(Promise.resolve(o),GD,zD,{supportsBack:!1},void 0,b.quickPickSelectPythonEnvironmentTitle);l.placeholder=a,l.selected=s(),c.push(l),c.push(e);try{if(!l.selected&&n){let p=o.onDidChange(()=>{l.selected=s(),l.selected&&p.dispose()});c.push(p)}let u=await l.selectItem(e.token);return!u||u instanceof Ne?void 0:u}catch(u){C("Failed to select a Python Environment to start Jupyter",u)}finally{z(c)}}};uu=v([(0,XD.injectable)(),d(0,(0,XD.inject)(pt))],uu);var yi=class{constructor(e,t,n,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=n;this.interpreterService=i;this._onDidChangeInterpreter=new iy.EventEmitter;iy.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),n=t;if(!n&&(n=await this.interpreterService.getActiveInterpreter(void 0),!n))return e&&await iy.window.showErrorMessage(e.message,{modal:!0},b.selectDifferentJupyterInterpreter)!==b.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(n,e);return i===1?(n=await this.selectInterpreter(),n?0:2):(i===0&&n!==t&&await this.setAsSelectedInterpreter(n),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let n=await sr(t,this.interpreterService.getInterpreterDetails(e));if(n&&await this.interpreterConfiguration.areDependenciesInstalled(n,t))return n}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let n=await this.interpreterService.getActiveInterpreter(void 0);n&&await this.interpreterConfiguration.areDependenciesInstalled(n,e)&&(t=n)}return t}};yi=v([(0,nd.injectable)(),d(0,(0,nd.inject)(Ka)),d(1,(0,nd.inject)(uu)),d(2,(0,nd.inject)(zs)),d(3,(0,nd.inject)(st)),d(4,(0,nd.inject)(F))],yi);var e_=Symbol("IKernelLauncher"),bi=Symbol("IRawNotebookSupportedService"),t_=Symbol("IRawKernelSessionFactory");var oy=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=n;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(j$.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){Nt(e)&&(this.notebookOpened=!0,N("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",GV(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f)}};oy=v([(0,Zm.injectable)(),d(0,(0,Zm.inject)(yi)),d(1,(0,Zm.inject)(F)),d(2,(0,Zm.inject)(bi)),d(3,(0,Zm.inject)(Ye))],oy);var r_=D(O()),W$=require("vscode");var rn=class{static dispose(){z(rn.disposables)}constructor(e){e.push({dispose:()=>{rn.dispose()}})}activate(){W$.workspace.onDidChangeNotebookDocument(e=>{Nt(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let n=rn.cellToDisplayIdMapping.get(t.cell);n&&(rn.cellToDisplayIdMapping.delete(t.cell),rn.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(n))})})}static trackOutputByDisplayId(e,t,n,i){let o=rn.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,rn.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:n,cell:e,outputItems:i}),rn.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let n=rn.displayIdCellOutputMappingPerDocument.get(e);if(!n)return;let i=n.get(t);return i?.cell.document.isClosed?void 0:i}};rn.displayIdCellOutputMappingPerDocument=new WeakMap,rn.cellToDisplayIdMapping=new WeakMap,rn.disposables=[],rn=v([(0,r_.injectable)(),d(0,(0,r_.inject)(F))],rn);var ef=D(O());var nF="Active_Kernel_Id_List",She=100,cs=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(nF,[]);if(t.length){let n=e.uri,i=await this.crypto.createHash(n.toString()),o=t.find(s=>s.fileHash===i);return P(`Preferred Remote kernel for ${B(n)} is ${o?.kernelId}`),o?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let n=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(nF,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(n=!0,i.splice(s,1)),t&&(n=!0,i.push({fileHash:o,kernelId:t}),P(`Storing Preferred remote kernel for ${B(e)} is ${t}`));i.length>She;)n=!0,i.shift();n&&await this.globalMemento.update(nF,i)}};cs=v([(0,ef.injectable)(),d(0,(0,ef.inject)($e)),d(0,(0,ef.named)(gt)),d(1,(0,ef.inject)(Mh))],cs);var ay=D(O()),iF=require("vscode");var xhe=1e3,sy=class{constructor(e,t,n){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.monitoredKernels=new WeakSet;this.timeouts=new Set;n.push(this)}dispose(){z(this.disposables),z(Array.from(this.timeouts.values()))}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.kernelProvider.onDidRestartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){let t=e.kernelConnectionMetadata;if(!Ft(t)||this.monitoredKernels.has(e))return;this.monitoredKernels.add(e);let n=[];this.disposables.push(new iF.Disposable(()=>z(n)));let i=()=>{if(z(n),e.disposed||e.disposing)return;let o=setTimeout(()=>{this.serverStorage.update(t.serverProviderHandle).catch(f)},xhe);n.push(new iF.Disposable(()=>clearTimeout(o)))};this.kernelProvider.getKernelExecution(e).onPreExecute(i,this,this.disposables),i()}};sy=v([(0,ay.injectable)(),d(0,(0,ay.inject)(Zt)),d(1,(0,ay.inject)(Ke)),d(2,(0,ay.inject)(F))],sy);var Fa=D(O()),SC=require("vscode");var V$=require("vscode"),Yt=class{constructor(e){this._event=new V$.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}};var Che="last-python-notebook-created",B$="last-notebook-created",cy=class{constructor(e,t,n,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=n;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;SC.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,n)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(B$);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(f)}shouldAutoStartStartServer(e){if(!e)return!1;let n=new Date().getTime()-e.getTime();return Math.floor(n/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!SC.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new SC.CancellationTokenSource,t=new Yt(!0);try{ee("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(n){C("Error starting server in serverPreload: ",n)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){Nt(e)&&this.createServerIfNecessary().catch(f)}kernelStarted(e){let t=Co(e.kernelConnectionMetadata);this.mementoStorage.update(B$,Date.now()).then(f,f),t===xe&&this.mementoStorage.update(Che,Date.now()).then(f,f)}};cy=v([(0,Fa.injectable)(),d(0,(0,Fa.inject)(de)),d(1,(0,Fa.inject)(kP)),d(2,(0,Fa.inject)(F)),d(3,(0,Fa.inject)(bi)),d(4,(0,Fa.inject)($e)),d(4,(0,Fa.named)(pi)),d(5,(0,Fa.inject)(Ke))],cy);var Ao=D(O());var Ys=D(O());var so=class extends et{constructor(e){super("jupyterinstall",e)}};var Kr=require("vscode");var tf=class extends Kn{constructor(e){super("timeout",b.rawKernelStartFailedDueToTimeout(mt(e)),e)}};var id=class extends Mc{constructor(t,n,i,o){super(t,i,o);this.stdErr=n}};var ly=class extends Kn{constructor(e){super("timeout",b.rawKernelStartFailedDueToTimeoutWaitingForPort(mt(e)),e)}};var il=class extends Kn{constructor(t=-1,n,i){super("kerneldied",b.kernelDied(n.trim()),i);this.exitCode=t;this.stdErr=n}};var rf=class extends Kn{constructor(t,n){super("noipykernel",b.kernelInvalid(mt(n)),n);this.reason=t}};var od=class extends Mc{constructor(e){super(b.kernelDiedWithoutError(mt(e)),void 0,e)}};var n_=class extends et{constructor(e){super("jupyterexpiredcert",e)}};var sd=class extends et{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var pu=class extends et{constructor(t,n,i){super("jupyternotebooknotinstalled",t+(n?`
${n}`:""));this.interpreter=i}};var q$=new Map;function i_(r,e){q$.set(Vt(r),e)}function uy(r,e,t){let n=e.jupyterCollections.find(i=>i.extensionId===r.extensionId&&i.id===r.id);return q$.get(Vt(r))||n?.label||t||`${r.id}:${r.handle}`}var dy=class{constructor(e,t,n,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=n;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(U("DataScience Error",e),e=un.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof so)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof Qo)await wP(this.configuration,e.message);else if(e instanceof n_)await EP(this.configuration,e.message);else if(!fr(e))if(e instanceof tf||e instanceof ly)Kr.window.showErrorMessage(e.message).then(f,f);else if(e instanceof id||e instanceof il||e instanceof pu||e instanceof Rs)Kr.window.showErrorMessage(py(e)).then(f,f);else if(e instanceof Li&&ln())Kr.window.showErrorMessage(b.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(f,f);else if(e instanceof Li){let t=await this.handleJupyterServerConnectionError(e,void 0);Kr.window.showErrorMessage(t).then(f,f)}else if(e instanceof xp){let t=await this.handleJupyterServerUriProviderError(e,void 0);Kr.window.showErrorMessage(t).then(f,f)}else{let t=J$(e.message||e.toString());Kr.window.showErrorMessage(t).then(f,f)}}}async getErrorMessageForDisplayInCell(e,t,n){if(e=un.unwrap(e),fr(e)||C("Error in execution (get message for cell)",e),e instanceof od)return"";if(e instanceof rf)return oF(e.kernelConnectionMetadata)||e.message;if(e instanceof so)return Phe(e)||e.message;if(e instanceof Li&&!ln())return e.message;if(e instanceof Li&&ln())return b.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(fr(e))return"";if(e instanceof Sv){let i=typeof e.product=="string"?e.product:hr.get(e.product)||`${e.product}`,o=Wr(e.interpreter)||e.interpreter.id||"",s=Mr(e.interpreter),a=B(s?.executable.uri),c=o?` ${o} (${a})`:a;return b.packageNotInstalledWindowsLongPathNotEnabledError(i,c)}else{if((e instanceof id||e instanceof il)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return b.failedToStartKernelDueToMissingPythonEnv(Wr(e.kernelConnectionMetadata.interpreter)||Ho(e.kernelConnectionMetadata.interpreter)||B(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof id||e instanceof il)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0))return oF(e.kernelConnectionMetadata)||e.message;if(e instanceof Kn||e instanceof Mc){let[i,o]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n),Pa(e.kernelConnectionMetadata.interpreter)]),s=vm(Kr.workspace.workspaceFolders||[],e,mt(e.kernelConnectionMetadata),o,i.map(a=>a.uri));if(s){if(s.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(s.moduleName))return oF(e.kernelConnectionMetadata)||e.message;let a=[s.message];return s.moreInfoLink&&a.push(ve.clickHereForMoreInfoWithHtml(s.moreInfoLink)),yt(e.kernelConnectionMetadata)&&s.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(s.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(a,n),a.join(`
`)}}else{if(e instanceof Li)return this.handleJupyterServerConnectionError(e,t);if(e instanceof xp)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof sd){let i=Kr.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return py(b.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(i),t)}}}return py(e,t)}async handleJupyterServerUriProviderError(e,t){let n=await uy(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return py(b.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerConnectionError(e,t){let n=await uy(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return py(b.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerProviderConnectionError(e,t){let n=new Kr.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(f)),!0}catch{return!1}finally{n.dispose()}}async handleKernelError(e,t,n,i,o){if(fr(e)||U(`Kernel Error, context = ${t}`,e),e=un.unwrap(e),fr(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof rf)if(U(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new Kr.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof so)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof Li||e instanceof xp||e instanceof sd){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof sd?"":e instanceof Li?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,c=e.serverProviderHandle.id,l=this.jupyterUriProviderRegistration.jupyterCollections.find(y=>y.extensionId===a&&y.id==c);if(!l||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,l))return 3;let u=e instanceof Li?e.baseUrl:"",p=uy(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),m=e instanceof sd?Kr.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",h=o==="jupyterExtension"?[b.selectDifferentKernel]:[];switch(await Kr.window.showErrorMessage(e instanceof sd?b.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(m):b.remoteJupyterConnectionFailedWithServer(p),{detail:s,modal:!0},b.removeRemoteJupyterConnectionButtonText,b.changeRemoteJupyterConnectionButtonText,...h)){case b.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(f),1;case b.changeRemoteJupyterConnectionButtonText:return 1;case b.selectDifferentKernel:return 3}return 1}else if(e instanceof Qo){this.sendKernelTelemetry(e,t,i,e.category);let s=b.jupyterSelfCertEnable,a=b.jupyterSelfCertClose;return Kr.window.showErrorMessage(b.jupyterSelfCertFail(e.message),s,a).then(c=>{c===s?(N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Kr.ConfigurationTarget.Workspace).catch(f)):c===a&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(f,f),2}else{if((t==="start"||t==="restart")&&n.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(n.interpreter.uri))return this.interpreterService.getInterpreterDetails(n.interpreter.id).then(async s=>{let a=await this.fs.exists(n.interpreter.uri);s?wt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"Unknown",isEmptyCondaEnv:wr(s),pythonEnvType:Be(s),fileExists:a}):wt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"EmptyEnvDetailsFromPython",isEmptyCondaEnv:wr(n.interpreter),pythonEnvType:Be(n.interpreter),fileExists:a})}).catch(async()=>{let s=await this.fs.exists(n.interpreter.uri);wt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"FailedToGetEnvDetailsFromPython",isEmptyCondaEnv:wr(n.interpreter),pythonEnvType:Be(n.interpreter),fileExists:s})}).catch(f),this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),Kr.window.showErrorMessage(b.failedToStartKernelDueToMissingPythonEnv(Wr(n.interpreter)||Ho(n.interpreter)||B(n.interpreter.uri))).then(f,f),this.interpreterService.refreshInterpreters(!0).catch(f),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(n,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new Kr.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let[s,a]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),Pa(n.interpreter)]),c=vm(Kr.workspace.workspaceFolders||[],e,mt(n),a,s.map(l=>l.uri));return this.sendKernelTelemetry(e,t,i,c?.reason),c?this.showMessageWithMoreInfo(c.message,c?.moreInfoLink).catch(f):this.showMessageWithMoreInfo(py(e,t)).catch(f),2}}}}sendKernelTelemetry(e,t,n,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&wt(n,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes($.ViewJupyterOutput)||(e=`${e} 
${b.viewJupyterLogForFurtherInfo}`);let n=t?[ve.learnMore]:[];await Kr.window.showErrorMessage(e,...n).then(i=>{i===ve.learnMore&&t&&Kr.env.openExternal(Kr.Uri.parse(t))})}};dy=v([d(0,(0,Ys.inject)(Ip)),d(0,(0,Ys.optional)()),d(1,(0,Ys.inject)(de)),d(2,(0,Ys.inject)(Ls)),d(2,(0,Ys.optional)()),d(3,(0,Ys.inject)(Zt)),d(4,(0,Ys.inject)(Qt)),d(5,(0,Ys.inject)(ut)),d(6,(0,Ys.inject)(st)),d(6,(0,Ys.optional)())],dy);var whe={restart:b.failedToRestartKernel,start:b.failedToStartKernel,interrupt:b.failedToInterruptKernel,execution:""};function py(r,e){r=typeof r=="string"?r:un.unwrap(r);let t=e?whe[e]:"",n="";return r instanceof pu?n=b.jupyterNotebookNotInstalledOrNotFound(r.interpreter):r instanceof et?n=QE(r.stdErr)||r.stdErr||r.message:n=typeof r=="string"?r:r.message,J$(t,n)}function Ehe(r){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(r)?.length??0)>0}function J$(r="",e=""){r&&e.startsWith(r.substring(0,r.length-1))&&(r="");let t=[r,e].map(n=>n.trim()).filter(n=>n.length>0).join(` 
`);return!Ehe(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${b.viewJupyterLogForFurtherInfo}`:t}function oF(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"||!r.interpreter)return;let e=Wr(r.interpreter)||Ae(r.interpreter.uri),t=hr.get(19),n=oo(19),i=`${qS(Ae(r.interpreter.uri))} -m pip install ${n} -U --force-reinstall`;if(r.interpreter&&Be(r.interpreter)==="Conda"){let a=Mr(r.interpreter);a?.environment?.name?i=`conda install -n ${a?.environment?.name} ${n} --update-deps --force-reinstall`:a?.environment?.folderUri&&(i=`conda install -p ${Ae(a?.environment?.folderUri)} ${n} --update-deps --force-reinstall`)}else r.interpreter&&Be(r.interpreter)==="Unknown"&&(i=`${qS(Ae(r.interpreter.uri))} -m pip install ${n} -U --user --force-reinstall`);let o=b.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(e,hr.get(19)),s=b.installPackageInstructions(t,i);return o+`
`+s}function Phe(r){let e=`${hr.get(18)} ${ve.and} ${hr.get(20)}`,t=[18,20].map(oo).join(" "),n=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=b.installPackageInstructions(e,n);return r.message+`
`+i+`
`+ve.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var my=class extends dy{constructor(t,n,i,o,s,a,c,l){super(t,n,i,o,s,c,l);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,n){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n);if(i.length>0){let o=n?Ti(n):void 0,s=i.map(c=>{if(c.type==="file"){let l=n?B(c.uri,[],o):yn(c.uri);return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}else{let l=n?B(c.uri,[],o):`${yn(Ti(c.uri))}/__init__.py`;return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${ve.and} ${s.slice(-1)}`,t.push(b.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(b.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(ve.clickHereForMoreInfoWithHtml(t7))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(Ti(t)):[]}};my=v([(0,Ao.injectable)(),d(0,(0,Ao.inject)(Ip)),d(0,(0,Ao.optional)()),d(1,(0,Ao.inject)(de)),d(2,(0,Ao.inject)(Ls)),d(2,(0,Ao.optional)()),d(3,(0,Ao.inject)(Zt)),d(4,(0,Ao.inject)(Qt)),d(5,(0,Ao.inject)(TD)),d(6,(0,Ao.inject)(ut)),d(7,(0,Ao.inject)(st))],my);var s_=D(O());var xC=class{constructor(e,t,n,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=n;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>n.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let n={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,n)}},sF=class extends xC{constructor(e,t,n,i){super(e,t,n,i)}},aF=class extends xC{constructor(e,t,n,i){super(e,t,n,i)}async exec(e,t){let n,i={stdout:""};try{i=await super.exec(e,t)}catch(a){n=a}if(!i.stderr&&!n)return i;let o=()=>{if(n)throw C("Exception attempting to enumerate kernelspecs: ",n),n;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){C("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve(ns,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve(ns,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},fy=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,n,i){return e==="notebook"?new sF(t,n,this.executionFactory,i):e==="kernelspec"?new aF(t,n,this.executionFactory,i):new xC(t,n,this.executionFactory,i)}};fy=v([(0,s_.injectable)(),d(0,(0,s_.inject)(Br))],fy);var CC=D(O());var $$=require("vscode");var hy=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push($$.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(f)}))}};hy=v([(0,CC.injectable)(),d(0,(0,CC.inject)(yi)),d(1,(0,CC.inject)(F))],hy);var Zs=D(O());var Xs=D(O());var _r=require("vscode");var H$=D(Gc()),G$=require("vscode");async function a_(r){try{let e=await H$.realpath(r.fsPath);return jr()!="Windows"&&(e=e.replace(/\\/g,"/")),G$.Uri.file(e)}catch{return r}}var khe=Ve("AppData","Roaming","jupyter","kernels"),z$=Ve(".local","share","jupyter","kernels"),Q$=Ve("Library","Jupyter","kernels"),Dhe=Ve("AppData","Roaming","jupyter","runtime"),_he=Ve("Library","Jupyter","runtime"),Y$=Ve("share","jupyter","kernels"),c_="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",cF="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",qr=class{constructor(e,t,n,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,n)}async getKernelSpecTempRegistrationFolder(){let e=ir(this.context.extensionUri,"temp","jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?a_(ir(t,khe)):this.platformService.isMac?ir(t,Q$):ir(t,z$)})(),this.cachedKernelSpecRootPath.then(t=>{P(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(f),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e,t=this.platformService.homeDir;if(t&&(this.platformService.isWindows?e=await a_(ir(t,Dhe)):this.platformService.isMac?e=ir(t,_he):e=process.env.$XDG_RUNTIME_DIR?_r.Uri.file(Ve(process.env.$XDG_RUNTIME_DIR,"jupyter","runtime")):ir(t,".local","share","jupyter","runtime")),!e){C("Failed to determine Jupyter runtime directory");return}try{return await this.fs.createDirectory(e),e}catch(n){C(`Failed to create runtime directory, reverting to temp directory ${e}`,n)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let n=new wo,i=await this.getJupyterPaths();for(let m of i)m&&!n.has(m)&&n.set(m,n.size);if(t)try{ne(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let m=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),h=_r.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),g=await m.exec([h.fsPath],{});if(g.stdout.trim().length){let y=_r.Uri.file(g.stdout.trim());await this.fs.exists(y)?n.has(y)||n.set(y,n.size):U(`Got a non-existent Jupyter Data Dir ${y}`)}else U(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${g.stderr}`)}catch(m){C(`Failed to get DataDir based on ENABLE_USER_SITE for ${Wr(t)}`,m)}let o;t&&(o=await Pa(t));let s=o?_r.Uri.joinPath(_r.Uri.file(o),"share","jupyter"):void 0,a=this.getSystemJupyterPaths(),c=s?new jc(a).has(s)?void 0:s:void 0,l=this.getJupyterDataDir(),u=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(u)?[l,c].forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}):[c,l].forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}),a.forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}),Array.from(n.entries()).sort((m,h)=>m[1]-h[1]).map(m=>m[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?_r.Uri.file(wn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?_r.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?wn(process.env.PROGRAMDATA):void 0;return e?[_r.Uri.joinPath(_r.Uri.file(e),"jupyter")]:[]}else return[_r.Uri.file("/usr/local/share/jupyter"),_r.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return _r.Uri.file(wn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return _r.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?_r.Uri.file(wn(process.env.APPDATA)):"";if(e)return _r.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?_r.Uri.joinPath(t,"data"):_r.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let n=process.env.XDG_DATA_HOME?_r.Uri.file(wn(process.env.XDG_DATA_HOME)):_r.Uri.joinPath(this.platformService.homeDir,".local","share");return _r.Uri.joinPath(n,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new Ge,n=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:n,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===n&&(this.cachedKernelSpecRootPaths=void 0)},this);return n.finally(()=>i.dispose()).catch(f),n}async getKernelSpecRootPathsImpl(e){let t=new jc(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let n=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];n&&t.add(n),process.env.PROGRAMDATA&&t.add(_r.Uri.file(Ve(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let n=this.platformService.isMac?Q$:z$;t.add(_r.Uri.file(Ve("/","usr","share","jupyter","kernels"))),t.add(_r.Uri.file(Ve("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(ir(this.platformService.homeDir,n))}return P(`Kernel Spec Root Paths, ${Array.from(t).map(n=>B(n)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(f,f)},f),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let n=new jc,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(Zn).map(s=>t?Ve(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>a_(_r.Uri.file(a))))).forEach(a=>{a&&n.add(a)}),P(`Jupyter Paths ${B(t)}: ${Array.from(n).map(s=>B(s))}`),Array.from(n)}getCachedPaths(){return this.globalState.get(cF,[]).map(e=>_r.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(cF,[]),n=e.map(_r.Uri.toString);t.join(",")!==n.join(",")&&await this.globalState.update(cF,n)}getCachedRootPath(){if(this.globalState.get(c_)){let e=this.globalState.get(c_);if(e)return _r.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(c_,e.toString()).then(f,f):this.globalState.update(c_,void 0).then(f,f)}};v([ui("getDataDirsImpl",7),d(1,Wl("id"))],qr.prototype,"getDataDirsImpl",1),v([d(0,sp())],qr.prototype,"getJupyterPathKernelPaths",1),qr=v([(0,Xs.injectable)(),d(0,(0,Xs.inject)(Dr)),d(1,(0,Xs.inject)(Lc)),d(2,(0,Xs.inject)(F)),d(3,(0,Xs.inject)($e)),d(3,(0,Xs.named)(gt)),d(4,(0,Xs.inject)(gr)),d(5,(0,Xs.inject)(lt)),d(6,(0,Xs.inject)(Br))],qr);var nf=class{constructor(e,t,n,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=n;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return b.selectJupyterInterpreter;let n=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return n.length===0?"":n.length===1&&n[0]===21?b.jupyterKernelSpecModuleNotFound(t.uri.fsPath):eF(n,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let n=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(b.startingJupyterLogMessage(tn(n.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:n}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,n)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(Zn).filter(l=>l.trim().length);a.push(Ti(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(Zn)},P(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(Zn)}`),P(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let c=Object.keys(s).filter(l=>l.toLowerCase()==="path");if(c.length){let l=c.map(u=>`${u}=${s[u]}`).join(",");P(`Start Jupyter Notebook with PATH variable. ${l}`)}else C("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),n=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=Ve(ns,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await n.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(c){U("Failed to parse JSON when getting server info out from getServerInfo.py",c);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let n=await this.getReasonForJupyterNotebookNotBeingSupported();throw new so(n)}return t}};nf=v([(0,Zs.injectable)(),d(0,(0,Zs.inject)(yi)),d(1,(0,Zs.inject)(st)),d(2,(0,Zs.inject)(zs)),d(3,(0,Zs.inject)(Br)),d(4,(0,Zs.inject)($o)),d(4,(0,Zs.named)(Ih)),d(5,(0,Zs.inject)(qr)),d(6,(0,Zs.inject)(js))],nf);var l_=D(O());var of=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,n,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=n?[e.fsPath,"--to","python","--stdout","--template",n]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw C("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};v([Uv("ExportNotebookToPython")],of.prototype,"exportNotebookToPython",1),of=v([(0,l_.injectable)(),d(0,(0,l_.inject)(Br))],of);var wC=D(O());var gy=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new jc}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let n=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return n===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),n}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return yP(i.stdout)}};gy=v([(0,wC.injectable)(),d(0,(0,wC.inject)(qi)),d(1,(0,wC.inject)(ry))],gy);var cf=D(O());var vy=require("vscode");var ad=D(O());var Z$=require("vscode");async function ao(r,e){if(!r)return;let t=vn(r),[n,i]=bP.get(t)||[{resourceType:ro(r),resourceHash:r?await vt(r.toString()):void 0,kernelSessionId:await vt(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(n.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(n.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(n.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(n.userExecutedCell=e.userExecutedCell,n.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(n.kernelSessionId=await vt(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=xe;break;default:break}let c="kernelSpec"in o&&o.kernelSpec.specFile?vt(o.kernelSpec.specFile):Promise.resolve("");n.kernelLanguage=a,[n.kernelId,n.kernelSpecHash]=await Promise.all([vt(o.id),c]),i.previouslySelectedKernelConnectionId=o.id;let l=o.interpreter;if(l){n.isUsingActiveInterpreter=Ma.isActiveWorkspaceInterpreter(r,l),n.pythonEnvironmentType=Be(l);let[u,p]=await Promise.all([vt(Ae(Ec(l.uri))),pp(l)]);n.pythonEnvironmentPath=u,jN.set(n.pythonEnvironmentPath,l),p?n.pythonEnvironmentVersion=`${p.major}.${p.minor}.${p.micro}`:n.pythonEnvironmentVersion=void 0,WN(n)}n.kernelConnectionType=n.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";bP.set(t,[n,i])}async function ea(r,e){await ao(r,{kernelConnection:e,userExecutedCell:!0})}var La=class{constructor(e,t,n,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=n;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,n,i){let o=n.env&&Object.keys(n.env).length>0?n.env:void 0,s=(n.language||"").toLowerCase()===xe;if(!t&&n.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(Z$.Uri.file(n.interpreterPath),i).catch(p=>{C("Failed to fetch interpreter information for interpreter that owns a kernel",p)})),i?.isCancellationRequested)return;let[a,c]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(f),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(p=>{C("Failed to get env variables for interpreter, hence no variables for Kernel",p)}):void 0]);if(i?.isCancellationRequested)return;await ao(e,{capturedEnvVars:Object.keys(c||{}).length>0}),!c&&Object.keys(a||{}).length===0&&P("No custom variables nor do we have a conda environment");let l={...process.env};process.platform==="win32"&&(l={},Object.keys(process.env).forEach(p=>{l[p.toUpperCase()]=process.env[p]})),o=o||{},a=a||{};let u={};for(let[p,m]of Object.entries(o||{}))typeof m=="string"&&X$(p,m,process.env)!==m&&(u[p]=m,delete o[p]);s||t?(c=c||a,Object.assign(l,c,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(ee(`Adding env Variable PYTHONNOUSERSITE to ${B(t?.uri)}`),l.PYTHONNOUSERSITE="True"),s&&(l.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,l),this.envVarsService.mergeVariables(a,l)),P(`Kernel Env Variables for ${n.specFile||n.name}, PATH value is ${l.PATH}`);for(let[p,m]of Object.entries(u))l[p]=X$(p,m,l);return l}};La=v([(0,ad.injectable)(),d(0,(0,ad.inject)(st)),d(1,(0,ad.inject)(js)),d(2,(0,ad.inject)(Fc)),d(3,(0,ad.inject)(Lc)),d(4,(0,ad.inject)(de))],La);var The=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function X$(r,e,t){if(!e.includes("$"))return e;let n=!1,i=e;return i=i.replace(The,(o,s,a,c,l)=>c>0&&l[c-1]==="\\"?o:a&&a!==""||!s||s===""?(n=!0,o):t[s]||""),!n&&i!==e&&(P(`${r} value in kernelSpec updated from ${e} to ${i}`),e=i),e.replace(/\\\$/g,"$")}var e5=require("vscode");async function t5(r,e,t){if(!t.interpreter||!It(t)||!r.kernel||r.kernel.status==="dead"||r.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let n=new Ge;try{let i=await In(r.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=Os(o.text).trim().toLowerCase(),a=Go(t.interpreter.uri,e5.Uri.file(s));await ao(e,{interpreterMatchesKernel:a})}catch(i){C(`Failed to compare interpreters after ${n.elapsedTime}ms`,i)}}function Rhe(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!yt(e))return!1;let t=e?e.kernelSpec:r;return u_(t.argv[0])}function sf(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!yt(e))return!1;let t=e?e.kernelSpec:r;if(t.language&&t.language.toLowerCase()!==xe||!Rhe(r))return!1;let n=t.argv.indexOf("-m");if(n===-1)return!1;let i=t.argv.length-1>=n?t.argv[n+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function u_(r){return r=_e(r).trim().toLowerCase(),r==="python"||r==="python3"||r==="python.exe"||r==="python3.exe"}var af=class{constructor(e,t,n,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=n;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,n,i,o){if(P(`Check if a kernel ${t.id} is usable`),sf(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new rf(a,t);default:break}}var s=void 0;yt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(vy.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&_e(dt(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(P(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):P(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let n=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=ir(n,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return ee(`Kernel spec file for ${e.id} already exists ${B(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!Vp(Ae(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:Em(e.interpreter)}),ee(`RegisterKernel for ${e.id} into ${B(i)}`),P(`RegisterKernel for ${e.id} into ${B(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=dt(s),c=dt(i.fsPath),l=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(l.map(async u=>{let p=Ve(a,u),m=Ve(c,u);await this.fs.copy(vy.Uri.file(p),vy.Uri.file(m))}))}return i.fsPath}async updateKernelEnvironment(e,t,n,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),c=s;if(n&&a){let l=_e(n).toLowerCase()===s.name.toLowerCase()?n:ir(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(vy.Uri.file(l))){U(`Spec file for ${t.id} does not exist ${l} hence not updating env vars.`);return}let u=vy.Uri.file(l);try{let p=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(p.metadata?.interpreter?(sf(s)&&(P(`Python KernelSpec argv[0] updated for ${t.id} from '${p.argv[0]}' to '${B(o.uri)}'`),p.argv[0]=o.uri.fsPath),p.metadata=p.metadata||{},p.metadata.interpreter=o):P(`KernelSpec argv[0] not updated for ${t.id} ('${p.argv[0]}')`),p.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,c),p=L9(p),await this.fs.writeFile(u,JSON.stringify(p,void 0,2)),P(`Updated kernel spec for ${t.id} with environment variables for ${B(u)}`),i?.isCancellationRequested))return;c.metadata=p.metadata}catch(p){if(i?.isCancellationRequested)return;throw C(`Failed to update kernel spec for ${t.id} with environment variables for ${B(u)}`,p),p}}else U(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};v([Nh("Failed to register an interpreter as a kernel")],af.prototype,"registerKernel",1),af=v([(0,cf.injectable)(),d(0,(0,cf.inject)(Ls)),d(1,(0,cf.inject)(gr)),d(2,(0,cf.inject)(qr)),d(3,(0,cf.inject)(La))],af);var EC=D(O());var r5=require("vscode");var yy=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return U(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let n=new r5.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(U(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return U(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{n.dispose()}}};yy=v([(0,EC.injectable)(),d(0,(0,EC.inject)(_m)),d(1,(0,EC.inject)(Qt))],yy);var l5=D(No()),p_=require("vscode"),ta=D(O());var by=class extends Kn{constructor(e){super("timeout",b.jupyterLaunchTimedOut,e)}};var Iy=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.disposableRegistry=t;this.configuration=i;this.notebookStarter=o;this.jupyterInterpreterService=s;this.disposed=!1;this._disposed=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),p_.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),n.push(this)}async dispose(){ee("Disposing HostJupyterExecution"),this._disposed||(this._disposed=!0,P("Disposing super HostJupyterExecution"),this.disposed=!0,P("Cleaning up server cache"),await this.cache?.then(e=>e.dispose()).catch(f)),P("Finished disposing HostJupyterExecution")}async startServer(e,t){if(this._disposed)throw new Error("Notebook server is disposed");if(!this.cache){let n=this.cache=this.startJupyterWithRetry(e,t);n.catch(i=>{C("Failed to start the Jupyter Server",i),this.cache===n&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(e){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(e):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():b.webNotSupported}async getUsableJupyterPython(e){return!this.usablePythonInterpreter&&!this.disposed&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await ar(e,this.jupyterInterpreterService.getSelectedInterpreter(e))),this.usablePythonInterpreter}startJupyterWithRetry(e,t){return ar(t,(async()=>{let i,o=1,s=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),a;for(;o<=s&&!this.disposed;){try{return i=await this.startImpl(e,t),P("Connection complete server"),i}catch(c){if(a=c,c instanceof by&&o<s)ee("Retry because of wait for idle problem."),i?.dispose(),o+=1;else throw i&&this.disposed,c}throw a}throw new Error("Max number of attempts reached")})())}async startImpl(e,t){ee("Launching server");let n=this.configuration.getSettings(e),i=n.useDefaultConfigForJupyter,o=await yC(e),s=Dc(),a=CP(o,s?ir(s,`${(0,l5.default)()}.txt`):void 0,n);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(e,i,this.configuration.getSettings(void 0).jupyterCommandLineArguments,p_.Uri.file(a),t)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};Iy=v([(0,ta.injectable)(),d(0,(0,ta.inject)(st)),d(1,(0,ta.inject)(F)),d(2,(0,ta.inject)(di)),d(3,(0,ta.inject)(de)),d(4,(0,ta.inject)(JP)),d(4,(0,ta.optional)()),d(5,(0,ta.inject)(td)),d(5,(0,ta.optional)())],Iy);var kC=D(O());var d_=class extends un{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var Sy=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Yt(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new d_}};Sy=v([(0,kC.injectable)(),d(0,(0,kC.inject)(kg)),d(1,(0,kC.inject)(Ye))],Sy);var lf=D(O());var m_=class extends et{constructor(){super("nodeonly",b.webNotSupported)}};var xy=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new m_;try{if(P("Checking for server usability."),!await this.checkUsable())throw P("Server not usable (should ask for install now)"),new so(b.jupyterNotSupported(await t.getJupyterServerError()));P("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return Sn.throwIfCanceled(e.token),i}catch(n){throw e.token?.isCancellationRequested&&fr(n)||await t.refreshCommands(),n}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let n=Wr(t)||Ae(t.uri);throw new Error(b.jupyterNotSupportedBecauseOfEnvironment(n,e.toString()))}else throw new so(b.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};xy=v([(0,lf.injectable)(),d(0,(0,lf.inject)(bp)),d(0,(0,lf.optional)()),d(1,(0,lf.inject)(st))],xy);var u5=D(require("child_process")),du=D(O()),p5=D(require("os"));var d5=D(No()),DC=require("vscode");var h_=require("vscode");var Cy=class extends et{constructor(t,n,i){super("jupytercannotbelaunchedwitheroot",t+(n?`
${n}`:""));this.interpreter=i}};var Fhe=new RegExp(am.UrlPatternRegEx),f_=class{constructor(e,t,n,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=n;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=le();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let c=o.get(de).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(b.jupyterLaunchTimedOut)},c);let l=0;e.proc&&e.proc.on("exit",u=>l=u||0),this.subscriptions.push(e.out.onDidChange(u=>{P(u.out),this.output+=u.out,am.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(p=>this.getJupyterURL(p,this.output)).catch(p=>U("Failed to get server info",p))})),e.out.done.then(()=>this.rejectStartPromise(b.jupyterServerCrashed(l))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),z(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let n=e.find(i=>Vp(Ae(this.notebookDir),Ae(h_.Uri.file(i.notebook_dir))));if(n){let i=n.url,o=n.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Fhe.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(l){C(`Failed to parse ${s}`,l),this.rejectStartPromise(b.jupyterLaunchNoURL);return}let c=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${c}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let n=this.serviceContainer.get(de),i=this.serviceContainer.get(zl),o=this.serviceContainer.get(Sp),s=yx({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:Je},{baseUrl:e,token:t,displayName:xP(t,e)},i,o,n,this.rootDir,new h_.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,n=this.output;n.includes("Jupyter command `jupyter-notebook` not found")?t=new pu(e,n,this.interpreter):n.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new Cy(e,n,this.interpreter):t=new Rs(e,n,this.interpreter),this.startPromise.reject(t)}}};var wy=require("vscode");var ra=new Set;function g_(...r){let e=new En;try{let t=new class{async providePortAttributes(n,i){if(r.includes(n.port))return new wy.PortAttributes(wy.PortAutoForwardAction.Ignore)}};for(let n of r){let i={portRange:n};e.add(wy.workspace.registerPortAttributesProvider(i,t))}}catch(t){C("Failure in registering port attributes",t)}return e}var Ey=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=n;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,n,i,o){ee("Starting Notebook");let s=0,a,c=[],l=ht.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(x=>this.disposables.push(x)).catch(f);let p=await this.generateArguments(t,n,u,i.fsPath);Sn.throwIfCanceled(o),P("Starting Jupyter Notebook");let[m,h,g]=await Promise.all([this.jupyterInterpreterService.startNotebook(p||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);m.proc&&(m.proc.on("exit",x=>s=x),m.out.onDidChange(x=>this.jupyterOutputChannel.append(x.out))),m&&o.onCancellationRequested(()=>{m.dispose()},this,c),P("Waiting for Jupyter Notebook"),a=new f_(m,DC.Uri.file(h.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,g),Sn.throwIfCanceled(o);let y=await ar(o,a.ready);try{let x=parseInt(new URL(y.baseUrl).port||"0",10);if(x&&!isNaN(x)){let E=g_(x);m.proc&&m.proc.on("exit",()=>{ra.delete(x),E.dispose()}),ra.add(x)}}catch(x){C(`Parsing failed ${y.baseUrl}`,x)}return z(c),y}catch(u){throw z(c),fr(u)||u instanceof Rs||u instanceof Cy||u instanceof pu?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(b.jupyterServerCrashed(s)):un.from(b.jupyterNotebookFailure(u),u):new so(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{l.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,n){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(n))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,n,i){return!t||t.length===0?this.generateDefaultArguments(e,n,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,n=Ve(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(DC.Uri.file(n),""),ee(`Generating custom default config at ${n}`),`--config=${n}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(DC.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(n=>{u5.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),n(e)})}))}catch{return e}}async generateTempDir(){let e=DC.Uri.file(Ve(p5.tmpdir(),(0,d5.default)()));return await this.fs.createDirectory(e),{path:Ae(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};Ey=v([(0,du.injectable)(),d(0,(0,du.inject)(td)),d(1,(0,du.inject)(ut)),d(2,(0,du.inject)(pt)),d(3,(0,du.inject)($o)),d(3,(0,du.named)(Ih))],Ey);var ol=require("vscode"),uf=D(O());var Py=class extends or{constructor(t,n){super();this._onDidLoad=this._register(new ol.EventEmitter);this._onDidChangeUri=this._register(new ol.EventEmitter);this._onDidRemoveUris=this._register(new ol.EventEmitter);this._onDidAddUri=this._register(new ol.EventEmitter);this._all=[];n.push(this),this.newStorage=this._register(new lF(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,n){this.hookupStorageEvents(),ne(`setUri: ${t.id}.${t.handle}`);let i={time:n?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};Py=v([(0,uf.injectable)(),d(0,(0,uf.inject)($e)),d(0,(0,uf.named)(gt)),d(1,(0,uf.inject)(F))],Py);var lF=class{constructor(e){this.memento=e;this._onDidChangeUri=new ol.EventEmitter;this._onDidRemoveUris=new ol.EventEmitter;this._onDidAddUri=new ol.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${ol.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),n=t.find(a=>Vt(a.provider)===Vt(e.provider)),o=[{displayName:e.displayName||n?.displayName||Vt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,c)=>c.time-a.time).filter(a=>Vt(a.provider)!==Vt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(ai.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),n||this._onDidAddUri.fire(e),s.length){let a=s.map(c=>({provider:c.serverHandle,time:c.time,displayName:c.displayName||""}));this._onDidRemoveUris.fire(a.map(c=>c.provider))}this._onDidChangeUri.fire()}).catch(f)}async update(e){let n=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:n?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let n=this.getAll();if(n.length===0)return;let i=n.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=n.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>C(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async n=>{let i=Vt(n.serverHandle),o={time:n.time,displayName:n.displayName||i,provider:n.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var cd=D(O());var v_="removeKernelUrisAndSessionsUsedByResources",ky=class{constructor(e,t,n){this.disposables=e;this.uriStorage=t;this.memento=n;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(v_,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Vt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,n){let i=Vt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][n]=this.usedRemoteKernelServerIdsAndSessions[i][n]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][n];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(v_,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}trackKernelIdAsNotUsed(e,t,n){let i=Vt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(n in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][n];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][n],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(v_,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}onDidRemoveServers(e){e.forEach(t=>{let n=Vt(t);delete this.usedRemoteKernelServerIdsAndSessions[n],this.memento.update(v_,this.usedRemoteKernelServerIdsAndSessions).then(f,f)})}};ky=v([(0,cd.injectable)(),d(0,(0,cd.inject)(F)),d(1,(0,cd.inject)(Zt)),d(2,(0,cd.inject)($e)),d(2,(0,cd.named)(gt))],ky);var ff=D(require("node-fetch")),wH=D(xH());var CH=require("vscode");function UF(r){return class extends r{constructor(...n){super(...n);this._onAnyMessage=new CH.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(n){super.emit=n}send(n,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(n,i)))).then(()=>super.send(n,i)):super.send(n,i)}handleEvent(n,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>n(i,...o)).catch(s=>C(`Exception while handling messages: ${s}`)),!0):n(i,...o)}emit(n,...i){return this.handleEvent((o,...s)=>super.emit(o,...s),n,...i)}addReceiveHook(n){this.receiveHooks.push(n)}removeReceiveHook(n){this.receiveHooks=this.receiveHooks.filter(i=>i!==n)}addSendHook(n){this.sendHooks.push(n)}removeSendHook(n){this.sendHooks=this.sendHooks.filter(i=>i!==n)}}}var EH=D(O());var co=new Map;var Ty=class{getRequestCtor(e,t,n){class i extends ff.Request{constructor(s,a){super(s,a);let c=this.headers,l=n();Object.keys(l).forEach(m=>c.append(m,l[m].toString())),c.set("Content-Type","application/json");let p=c.append.bind(c);c.append=(m,h)=>{m.toLowerCase()!=="authorization"&&p(m,h)}}}return n&&Object.keys(n()||{}).length?i:ff.Request}getWebsocketCtor(e,t,n){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),n){let c=n();a=a?{...a,...c}:c}return a&&(s={...s,headers:a}),s};class o extends UF(wH.default){constructor(c,l){super(c,l,i());let u,p=/.*\/kernels\/(.*)\/.*/.exec(c);p&&p.length>1&&(this.kernelId=p[1]),this.kernelId?(co.set(this.kernelId,this),this.on("close",()=>{u&&this.timer!==u&&clearInterval(u),co.get(this.kernelId)===this&&co.delete(this.kernelId)})):C("KernelId not extracted from Kernel WebSocket URL"),u=this.timer=setInterval(()=>this.ping(f),3e4)}}return o}wrapWebSocketCtor(e){class t extends UF(e){constructor(o,s,a){super(o,s,a);let c,l=/.*\/kernels\/(.*)\/.*/.exec(o);l&&l.length>1&&(this.kernelId=l[1]),this.kernelId?(co.set(this.kernelId,this),this.on("close",()=>{c&&this.timer!==c&&clearInterval(c),co.get(this.kernelId)===this&&co.delete(this.kernelId)})):C("KernelId not extracted from Kernel WebSocket URL"),c=this.timer=setInterval(()=>this.ping(f),3e4)}}return t}getFetchMethod(){return ff.default}getHeadersCtor(){return ff.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};Ty=v([(0,EH.injectable)()],Ty);var PH=require("https"),kH=D(O());var Ry=class{createHttpRequestAgent(){return new PH.Agent({rejectUnauthorized:!1})}};Ry=v([(0,kH.injectable)()],Ry);var us=D(O());var ls=require("vscode");var qge=["/bin/sh","/bin/bash","/bin/zsh"];function D_(r,e){let t=(r.argv||[]).some(n=>(n=n.toLowerCase(),qge.some(i=>n.includes(i))));N("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:r.language,kind:e,usesShell:t})}var Ay="remoteKernelSpecCache.json";var Jge=2e3,__=class extends Ms{constructor(t,n,i,o,s,a,c,l,u,p){super();this.id=t;this.displayName=n;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=c;this.jupyterConnection=l;this.fs=u;this.context=p;this._status="idle";this._onDidChangeStatus=new ls.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new Io;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new ls.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new ls.EventEmitter;this.onDidChange=this._onDidChange.event;this.cacheFile=ls.Uri.joinPath(p.globalStorageUri,Ay),this.cacheKey=Vt(c),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(f,f),this._register(this.kernelProvider.onDidStartKernel(t=>{Ft(t.kernelConnectionMetadata)&&this.updateCache().then(f,f)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&Ft(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let n=setTimeout(()=>{this.updateCache().then(f,f)},Jge);return this.kernelDisposeDelayTimer=new ls.Disposable(()=>clearTimeout(n)),n}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,n=!1){return(!this.cachedConnection||n)&&(this.cachedConnection=this.getRemoteConnectionInfo(t)),this.cachedConnection.then(i=>i?(this.cachedConnection=Promise.resolve(i),this.listKernelsFromConnection(i)):Promise.resolve([])).catch(i=>this.isDisposed?Promise.reject(i):n?(this.cachedConnection=void 0,Promise.reject(i)):this.getListOfKernelsWithCachedConnection(t,!0))}async loadCache(t=!1,n=!1){ne(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(f,f),this.loadCache(!0).then(f,f);else try{s=await this.getListOfKernelsWithCachedConnection(n),this._lastError=void 0}catch(a){a instanceof ls.CancellationError||(C("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let n=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new ls.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{n=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){U(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),n=await this.getFromCache(i.token),n=n.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(n)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let n=[];return t&&n.push(ht.createProgressReporter(void 0,b.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>z(n))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new ls.CancellationError;let n=this.cache;(!n||n.length===0)&&(n=await this.getCacheContents());let i=[],o=Promise.all(n.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await sr(t,o),i}catch(n){C("UniversalRemoteKernelFinder: Failed to get from cache",n)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),n=JSON.parse(t);if(n.extensionVersion!==this.env.extensionVersion)return[];let i=n.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>Fs.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let n=[];try{let i=Cp.create(t.settings);n.push(i);let[o,s,a,c]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),u9(t.serverProviderHandle)]),l=s.map(m=>(D_(m,"remote"),Ix.create({kernelSpec:m,id:Fi(m,void 0,c),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(m=>{let h=m.kernel,g=h.last_activity?new Date(Date.parse(h.last_activity.toString())):new Date,y=h.connections?parseInt(h.connections.toString(),10):0,x=o.find(T=>T.id===m.kernel?.id)||{},E=s.find(T=>T.name===m.kernel?.name)||{};return bx.create({kernelModel:{...m.kernel,...E,...x,name:m.kernel?.name||"",lastActivityTime:g,numberOfConnections:y,model:m},baseUrl:t.baseUrl,id:m.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(m=>!this.kernelIdsToHide.has(m.kernelModel.id||"")),...l]}catch(i){throw C(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(n.map(i=>i.dispose().catch(f)))}}async writeToCache(t){try{P(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let n=this.cache,i=new Map(n.map(m=>[m.id,m])),o=new Map(t.map(m=>[m.id,m])),s=t.filter(m=>!i.has(m.id)),a=t.filter(m=>i.has(m.id)&&!ba(m,i.get(m.id))),c=n.filter(m=>!o.has(m.id)),l=this.cacheKey;this.cache=n.filter(m=>o.has(m.id)).concat(s),this.cache.forEach(m=>{let h=o.get(m.id);m!==h&&h.kind==="connectToLiveRemoteKernel"&&m.kind==="connectToLiveRemoteKernel"&&m.updateModel(h.kernelModel)});let u=t.map(m=>m.toJSON()),p={extensionVersion:this.env.extensionVersion,data:{}};try{let m=await this.fs.readFile(this.cacheFile),h=JSON.parse(m);h.extensionVersion===this.env.extensionVersion&&(p=h)}catch{}p.data[l]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(p))).catch(m=>{C("Failed to cache the remote kernels.",m)}),(s.length||a.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}catch(n){C("UniversalRemoteKernelFinder: Failed to write to cache",n)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var T_=require("vscode");var vu=class{constructor(e,t,n,i,o,s,a,c,l,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=n;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=c;this.context=l;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(f)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(f))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new T_.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let n=t.serverProvider;if(!(!n||this.mappedProviders.has(n)))return this.mappedProviders.add(n),n?.onDidChangeServers&&n?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(f)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Vt(o.provider))),n=e.serverProvider;if(!n)return;let i=new T_.CancellationTokenSource;try{let o=await Promise.resolve(n.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let c={extensionId:e.extensionId,handle:a.id,id:e.id},l=Vt(c);s.add(l),i_(c,a.label),!(this.mappedServers.has(l)||!t.has(l))&&(this.mappedServers.add(l),this.createRemoteKernelFinder(c,a.label))}),this.serverFinderMapping.forEach((a,c)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Vt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(c))})}catch(o){C(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Vt(e.provider);if(this.serverFinderMapping.has(t))return;let n=new T_.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(l=>l.extensionId===e.provider.extensionId&&l.id===e.provider.id);if(!s||!s.serverProvider)return;let c=(await Promise.resolve(s.serverProvider.provideJupyterServers(n.token)))?.find(l=>l.id===e.provider.handle)?.label;c&&this.createRemoteKernelFinder(e.provider,c)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===rc&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(f),o().catch(f)]),n.dispose()}getOrCreateRemoteKernelFinder(e,t){let n=Vt(e);if(!this.serverFinderMapping.has(n)){let i=new __(`remote-${n}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(n,i),i.activate().then(f,f)}return this.serverFinderMapping.get(n)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let n=Vt(t),i=this.serverFinderMapping.get(n);i&&i.dispose(),this.serverFinderMapping.delete(n)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};v([Ur("Handle Jupyter Provider Changes")],vu.prototype,"handleProviderChanges",1),v([Ur("Check Servers in Jupyter Server Provider")],vu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),v([Ur("Failed to create a Remote Kernel Finder")],vu.prototype,"validateAndCreateFinder",1),vu=v([(0,us.injectable)(),d(0,(0,us.inject)(Zt)),d(1,(0,us.inject)(Vc)),d(2,(0,us.inject)($P)),d(3,(0,us.inject)(Or)),d(4,(0,us.inject)(Ke)),d(5,(0,us.inject)(dn)),d(6,(0,us.inject)(F)),d(7,(0,us.inject)(ut)),d(8,(0,us.inject)(lt)),d(9,(0,us.inject)(Qt))],vu);var pd=D(O());var Fy=require("vscode");var U_=D(No());var ul=D(O());var R_=class extends et{constructor(t){super("localjupyterserverconnection",b.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function My(r){if(Nr()){let e=r;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(n=>{n._status!==void 0&&(n._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var Ny=class extends un{constructor(e){super(e.message,e)}};var NC=require("vscode");var hf=class extends Kn{constructor(e){super("invalidkernel",b.kernelInvalid(mt(e)),e)}};async function Oy(r,e,t,n,i){if(!t.kernel)throw new hf(r);let o=ht.reportProgress(e,b.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{P(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=le();i.onCancellationRequested(()=>a.reject(new NC.CancellationError),void 0,s);let c=(m,h)=>{P(`Got status ${h} in waitForIdleOnSession`),h=="idle"&&a.resolve(h)};t.kernel.statusChanged?.connect(c),s.push(new NC.Disposable(()=>Wn(()=>t.kernel?.statusChanged?.disconnect(c)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let l=le(),u=()=>l.resolve("");t.disposed.connect(u,l),s.push(new NC.Disposable(()=>Wn(()=>t.disposed.disconnect(u,l)))),l.promise.catch(f),a.promise.catch(f);let p=await xr(n,"",a.promise,l.promise);if(t.isDisposed)throw C("Session disposed while waiting for session to be idle."),new hf(r);if(P(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),p=="idle")return;throw C(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new by(r)}catch(a){throw ne("Error waiting for idle",a),a}finally{z(s)}}var L_=require("vscode");var ll=D(O_()),K_=require("vscode");var Ky=class{constructor(e,t){this.kind=e;this.session=t;this.propertyChanged=new ll.Signal(this);this.kernelChanged=new ll.Signal(this);this.statusChanged=new ll.Signal(this);this.connectionStatusChanged=new ll.Signal(this);this.iopubMessage=new ll.Signal(this);this.unhandledMessage=new ll.Signal(this);this.anyMessage=new ll.Signal(this);this.disposables=[];this.disposed=new ll.Signal(this);this._disposed=new K_.EventEmitter;this.didShutdown=new K_.EventEmitter;this._onDidKernelSocketChange=new K_.EventEmitter;t.propertyChanged.connect(this.onPropertyChanged,this),t.kernelChanged.connect(this.onKernelChanged,this),t.statusChanged.connect(this.onStatusChanged,this),t.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.anyMessage.connect(this.onAnyMessage,this),this.disposables.push({dispose:()=>{this.didShutdown.dispose(),this._disposed.dispose(),this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get isDisposed(){return this._isDisposed===!0}get onDidDispose(){return this._disposed.event}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}async disposeAsync(){this.dispose()}dispose(){this.disposeInvoked||(this.statusChanged.emit("dead"),this._disposed.fire(),this.disposed.emit(),this.previousAnyMessageHandler?.dispose(),z(this.disposables),ll.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),ee(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let e={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:co.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(e.kernel.model)&&this.previousKernelSocketInformation?.kernel===e.kernel&&this.previousKernelSocketInformation?.kernel.id===e.kernel.id&&this.previousKernelSocketInformation?.socket===e.socket||(this.previousKernelSocketInformation=e,this.previousAnyMessageHandler?.dispose(),this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(e,t){this.propertyChanged.emit(t)}onKernelChanged(e,t){this.kernelChanged.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t);let n=this.status;ne(`Server Status = ${n}`)}onConnectionStatusChanged(e,t){this.connectionStatusChanged.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){U(`Unhandled message found: ${t.header.msg_type}`),this.unhandledMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}setPath(e){return this.session.setPath(e)}setName(e){return this.session.setName(e)}setType(e){return this.session.setType(e)}changeKernel(e){return this.session.changeKernel(e)}onKernelConnectionStatusHandler(e,t){ne(`Server Kernel Status = ${t}`)}};var F_=class extends Ky{constructor(t,n,i,o,s){super(yt(i)?"localJupyter":"remoteJupyter",t);this.resource=n;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(ne(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).catch(f)}async disposeAsync(){await this.shutdownImplementation(!1).catch(f),await super.disposeAsync()}async waitForIdle(t,n){try{await Oy(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw ne("Error waiting for idle",i),await this.shutdown().catch(f),i}}async restart(){let t=[],n=new L_.CancellationTokenSource;this.restartToken=n;let i=new Yt(!1);t.push(i),t.push(n);try{await this.validateLocalKernelDependencies(n.token,i),await super.restart()}finally{z(t)}}async validateLocalKernelDependencies(t,n){if(!(!this.kernelConnectionMetadata?.interpreter||!yt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new L_.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,n,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this._isDisposed)return;this._isDisposed=!0;let n=(new Error().stack||"").split(`
`).filter(o=>o.includes(Je));P(`Shutdown session - current session, called from 
 ${n.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;P(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{P(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),My(this.session.kernel),this.session.isDisposed||await xr(1e3,this.session.shutdown().catch(f))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){U("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else P(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){U("Failures in disposing the session",o)}super.dispose(),P("Shutdown session -- complete")}catch(o){U("Failures in disposing the session",o)}P(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return yt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&ro(this.resource)==="interactive"?!0:!(this.resource&&ro(this.resource)==="notebook"&&Ft(this.kernelConnectionMetadata))}};var yu=class{constructor(e,t,n,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=n;this.kernelService=i;this.configService=o}async create(e){let t=[],n,i=()=>{e.ui.disableUI||n||(n=ht.createProgressReporter(e.resource,Ft(e.kernelConnection)?b.connectingToJupyter:b.startingJupyter),t.push(n))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=Ft(e.kernelConnection)?await ar(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await ar(e.token,this.validateLocalKernelDependencies(e));let c=Cp.create(o.settings);this.asyncDisposables.push(c),s.push(new Fy.Disposable(()=>c.dispose().catch(f))),await ar(e.token,this.validateRemoteServer(e,c));let l=await this.connectToOrCreateSession({...e,contentsManager:c.contentsManager,sessionManager:c.sessionManager,kernelManager:c.kernelManager,kernelSpecManager:c.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await l.shutdown().catch(f),Wn(()=>l.dispose())),Sn.throwIfCanceled(e.token),ee(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new F_(l,e.resource,e.kernelConnection,this.kernelService,e.creator),p=l.disposed,m=()=>{c.dispose().catch(f),p.disconnect(m)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),l.disposed.connect(m);let h=u.onDidDispose(m);return this.asyncDisposables.push(h),u}catch(c){throw z(s),Ft(e.kernelConnection)?o?Qo.isSelfCertsError(c)?new Qo(o.baseUrl):Nc.isSelfCertsExpiredError(c)?new Nc(o.baseUrl):new Li(o.baseUrl,e.kernelConnection.serverProviderHandle,c):c:c instanceof et?c:new R_(c)}finally{z(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new bn;if(!yt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(n){throw C("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",n),new Li(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,n)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new Fy.CancellationError;e.kernelConnection?.interpreter&&yt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new Fy.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await ar(e.token,Yw(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else P(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await Oy(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(f);if(e.token.isCancellationRequested)throw new Fy.CancellationError;return t}catch(n){let i=e.ui.disableUI?P:C;throw n instanceof et?(i("Failed to change kernel, re-throwing",n),n):(i("Failed to change kernel",n),new hf(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),n=t?.path,i=xg(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?op(e.resource):"";o=`${e.resource?yn(e.resource,a):""}-${(0,U_.default)()}${a}`}let s={path:n||Gge(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await ar(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new Ny(new Error("No kernel created"));return ee(b.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof Ny?a:new Ny(a)}}};yu=v([(0,ul.injectable)(),d(0,(0,ul.inject)(kg)),d(1,(0,ul.inject)(dn)),d(2,(0,ul.inject)(di)),d(3,(0,ul.inject)(qP)),d(3,(0,ul.optional)()),d(4,(0,ul.inject)(de))],yu);function Hge(){return`${Sg}${(0,U_.default)()}`}function Gge(r){let e=`${Hge()}${(0,U_.default)()}.ipynb`;return r?`${yn(r,".ipynb")}${e}`:`${b.defaultNotebookName}${e}`}var Ly=class{constructor(e,t,n){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=n}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&yt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};Ly=v([(0,pd.injectable)(),d(0,(0,pd.inject)(bi)),d(1,(0,pd.inject)(t_)),d(1,(0,pd.optional)()),d(2,(0,pd.inject)(yu))],Ly);var MC=Symbol("RemoteKernelFinderController");function NH(r,e){r.add(ry,fy),r.addSingleton(Ie,hy),r.addSingleton(Ie,ny),r.addSingleton(bp,Iy),r.addSingleton(zs,zs),r.addSingleton(Pg,gy),r.addSingleton(BP,of),r.addSingleton(uu,uu),r.addSingleton(yi,yi),r.addSingleton(Ka,Ka),r.addSingleton(_a,_a),r.addSingleton(qP,af),r.addSingleton(kg,xy),r.addSingleton(Ip,nf),r.addSingleton(td,nf),r.addSingleton(Zt,Py),r.addSingleton(JP,Ey),r.addSingleton(kP,Sy),r.addSingleton(Sx,Ly),r.addSingleton(yu,yu),r.addSingleton(zl,Ty),r.addSingleton(Sp,Ry),r.addSingleton(dn,dn),r.addSingleton(_m,ky),r.addBinding(_m,Ie),r.addSingleton($P,yy),r.addSingleton(en,my),r.addSingleton(MC,vu),r.addBinding(MC,Ie),r.addSingleton(Qt,Tg)}var gf=D(O()),ps=require("vscode");var Uy=class{constructor(e,t,n,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=n;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(ps.notebooks.onDidChangeNotebookCellExecutionState(e=>{if(!Nt(e.cell.notebook)||e.state!==ps.NotebookCellExecutionState.Idle)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}onDidStartKernel(e){if(!this.kernelsStartedSuccessfully.has(e)){if(this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry),!e.session?.kernel)return;this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),e.onDisposed(()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this,this.disposableRegistry),e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this,this.disposableRegistry),e.onRestarted(()=>this.kernelsRestarting.delete(e),this,this.disposableRegistry)}}onKernelStatusChanged(e,t){let n=this.kernelConnectionToKernelMapping.get(e);if(n&&!this.kernelsRestarting.has(n))switch(t){case"connected":{this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n);return}case"disconnected":{this.kernelReconnectProgress.has(n)&&(this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n),this.onKernelDisconnected(n)?.catch(f));return}case"connecting":this.kernelReconnectProgress.has(n)||this.onKernelConnecting(n)?.catch(f);return;default:return}}async onKernelConnecting(e){let t=le(),n=new ps.Disposable(()=>t.resolve());if(this.kernelReconnectProgress.set(e,n),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let i=b.automaticallyReconnectingToAKernelProgressMessage(mt(e.kernelConnectionMetadata));ps.window.withProgress({location:ps.ProgressLocation.Notification,title:i},async()=>t.promise).then(f,f),this.disposableRegistry.push(n)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(wt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=yt(e.kernelConnectionMetadata)?b.kernelDisconnected(mt(e.kernelConnectionMetadata)):b.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);ps.window.showErrorMessage(t).then(f,f);try{let n=this.lastExecutedCellPerKernel.get(e);if(!n||n.document.isClosed||n.notebook.isClosed||n.executionSummary?.success===!1)return;await vp(n,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let n=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!n)return!1;let i=new ps.CancellationTokenSource;try{return(await Promise.resolve(n.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};Uy=v([(0,gf.injectable)(),d(0,(0,gf.inject)(F)),d(1,(0,gf.inject)(Ke)),d(2,(0,gf.inject)(Zt)),d(3,(0,gf.inject)(Qt))],Uy);var OC=D(O());var jy=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=ht.createProgressReporter(e.resourceUri,b.restartingKernelStatus(mt(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};jy=v([(0,OC.injectable)(),d(0,(0,OC.inject)(F)),d(1,(0,OC.inject)(Ke))],jy);var KC=D(O()),jF=require("vscode");var vf=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry)}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(jF.window.showErrorMessage(b.kernelDiedWithoutError(mt(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(jF.window.showErrorMessage(b.kernelDiedWithoutErrorAndAutoRestarting(mt(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(wt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return vp(t,e.controller,b.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};v([Ur()],vf.prototype,"onKernelStatusChanged",1),vf=v([(0,KC.injectable)(),d(0,(0,KC.inject)(F)),d(1,(0,KC.inject)(Ke))],vf);var bu=D(O()),md=require("vscode");var dd=class{constructor(e,t,n,i){this.installer=e;this.memento=t;this.rawSupport=n;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!yt(t)||!It(t)||!t.interpreter)return 0;ee(`Check & install missing Kernel dependencies for ${B(t.interpreter?.uri)}, ui.disabled=${n.disableUI} for resource '${B(e)}'`);let c=async()=>{if(await ht.wrapAndReportProgress(e,b.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let h=await c();if(h===0||h===1)return h}let l=vn(t.interpreter.uri),u=this.installPromises.get(l),p;if(!u){let h=new md.CancellationTokenSource,g=i.onCancellationRequested(()=>{h.cancel(),g.dispose()});u=ht.wrapAndReportProgress(e,b.installingMissingDependencies,async()=>{if(a){let y=await c();if(y===0||y===1)return y}return this.runInstaller(e,t.interpreter,n,h,s,a)}),u.finally(()=>{g.dispose(),h.dispose()}).catch(f),this.installPromises.set(l,u)}let m=2;try{m=await u,(p?.token?.isCancellationRequested||i.isCancellationRequested)&&(m=1)}catch(h){ne("Failed to install kernel dependency",h),m=2}finally{this.installPromises.delete(l)}return m}async areDependenciesInstalled(e,t,n){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!n&&this.rawSupport.isSupported&&await U8(this.memento,19,e.interpreter))return ee(`IPyKernel found previously in this environment ${B(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&_D(this.memento,19,e.interpreter).catch(f)},f),sr(t,!1,i)}async runInstaller(e,t,n,i,o,s){if(ne(`Run Installer for ${B(e)} ui.disableUI=${n.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),n.disableUI)return 4;let a=Be(t),[c,l]=await Promise.all([V8(this.memento,19,t),a==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let u=c?b.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:b.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,p=l===!1?[19,27]:[19],m=u(Wr(t)||t.uri.fsPath,p.map(j=>hr.get(j)).join(` ${ve.and} `)),h=p.map(j=>hr.get(j)).join(", "),g=e?ro(e):void 0,y=e?await vt(e.toString()):void 0;wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a});let x=ve.install,E=b.selectKernel,A=ve.moreInfo,T=[x];e&&!o&&T.push(E),T.push(A);try{(!om()||!s)&&wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a});let j;do j=om()||s?x:await sr(i.token,md.window.showInformationMessage(m,{modal:!0},...T)),j===A&&(wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),md.env.openExternal(md.Uri.parse("https://aka.ms/AAhi594")));while(j===A);if(i.token.isCancellationRequested)return wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),1;if(j===E)return wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),3;if(j===x){wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a});let oe=await sr(i.token,3,this.installer.install(19,t,i,c===!0,l===!1));if(oe===0)return wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),0;if(oe===2)return wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),2}return wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),1}catch(j){throw C(`Failed to install ${h}`,j),wt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),j}}};v([ui("Install Missing Dependencies")],dd.prototype,"installMissingDependencies",1),v([ui("Are Dependencies Installed"),d(0,Wl("id"))],dd.prototype,"areDependenciesInstalled",1),dd=v([(0,bu.injectable)(),d(0,(0,bu.inject)(qi)),d(1,(0,bu.inject)($e)),d(1,(0,bu.named)(gt)),d(2,(0,bu.inject)(bi)),d(3,(0,bu.inject)(pt))],dd);var j_=D(O()),Vy=require("vscode");var Wy=class extends or{constructor(t){super();this._onDidChangeRegistrations=this._register(new Vy.EventEmitter);this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=this._register(new Vy.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=this._register(new Vy.EventEmitter);t.push(this),this._register(this._onDidChangeStatus),this._register(this._onDidChangeRegistrations)}get status(){return this._status}set status(t){this._status!=t&&(this._status=t,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(t){this._finders.push(t);let n=()=>{this.status=this._finders.every(s=>s.status==="idle")?"idle":"discovering"};n();let i=this._register(new En),o=()=>{let s=this._finders.findIndex(a=>a===t);s>=0&&this._finders.splice(s,1),i.dispose(),n(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[t]})};return i.add(t.onDidChangeStatus(n,this)),i.add(t.onDidChangeKernels(()=>this._onDidChangeKernels.fire())),i.add(t.onDidDispose(()=>o())),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[t],removed:[]}),new Vy.Disposable(()=>o())}get kernels(){let t=[];this.connectionFinderMapping.clear();let n=new Set;this._finders.filter(o=>o.kind==="localPythonEnvironment").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&n.add(s.kernelSpec.specFile),t.push(s),this.connectionFinderMapping.set(s.id,o)})}),this._finders.filter(o=>o.kind==="localKernelSpec").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&n.has(s.kernelSpec.specFile)||(t.push(s),this.connectionFinderMapping.set(s.id,o))})});let i=this._finders.filter(o=>o.kind==="remote");for(let o of i){let s=o.kernels;s.forEach(a=>{this.connectionFinderMapping.set(a.id,o)}),t.push(...s)}return t}getFinderForConnection(t){return this.connectionFinderMapping.get(t.id)}get registered(){return this._finders}};Wy=v([(0,j_.injectable)(),d(0,(0,j_.inject)(F))],Wy);var fn=D(O());var Si=require("vscode");var W_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new Si.EventEmitter;this._onDidStartKernel=new Si.EventEmitter;this._onDidCreateKernel=new Si.EventEmitter;this._onDidDisposeKernel=new Si.EventEmitter;this._onKernelStatusChanged=new Si.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),Si.workspace.onDidCloseNotebookDocument(n=>this.disposeOldKernel(n),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){let e=new Set;return Si.workspace.notebookDocuments.forEach(t=>{let n=this.get(t);n&&e.add(n)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){if(Cn(e)){let t=Si.workspace.notebookDocuments.find(n=>n.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){ne("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByNotebook.set(e,{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),P(`Kernel got disposed, hence there is no longer a kernel associated with ${B(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByNotebook.get(e);t&&(P(`Disposing kernel associated with ${B(e.uri)}, isClosed=${e.isClosed}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>U("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){Si.workspace.notebookDocuments.forEach(t=>{let n=this.kernelsByNotebook.get(t);if(n){let i=n.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(n.kernel.id))}})}},V_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new Si.EventEmitter;this._onDidStartKernel=new Si.EventEmitter;this._onDidCreateKernel=new Si.EventEmitter;this._onDidDisposeKernel=new Si.EventEmitter;this._onKernelStatusChanged=new Si.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),Si.workspace.onDidCloseNotebookDocument(n=>{P(`Notebook document ${B(n.uri)} got closed`),this.disposeOldKernel(n.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){ne("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByUri.set(e.toString(),{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),P(`Kernel got disposed, hence there is no longer a kernel associated with ${B(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(ne(`Disposing kernel associated with ${B(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>U("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByUri.delete(e.toString())}};var VF=D(No()),Tr=require("vscode");var KH=D(mD());var WF="KERNEL_INFO",zge=1e3*60*60*24*2;async function OH(r,e,t){let n=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!r.kernel)return;r.kernel?.info&&(n.push(r.kernel.info),r.kernel.info.then(a=>MH(t,e,a)).catch(f));let o=r.kernel.requestKernelInfo().then(a=>a?.content);if(n.push(o),o.then(a=>MH(t,e,a)).catch(f),e.kind==="connectToLiveRemoteKernel"){let a=Qge(t,e);a?n.push(Promise.resolve(a)):n.push(Di(5e3).then(()=>i))}let s=await Promise.race(n);return s===i?U("Failed to Kernel info in a timely manner, defaulting to empty info!"):P("Got Kernel info"),s}async function MH(r,e,t){if(!t||!Ft(e))return;let n=r.get(WF,[]).filter(i=>Date.now()-i.age<zge).filter(i=>i.id!==e.id);n.push({id:e.id,age:Date.now(),info:t}),await r.update(WF,n)}function Qge(r,e){if(Ft(e))return r.get(WF,[]).find(t=>t.id===e.id)?.info}var B_=class extends Kn{constructor(e){super("kernelpromisetimeout",b.interruptingKernelFailed,e)}};var q_="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function G_(r){let e=typeof r=="string"?r:"";return typeof r!="string"&&"content"in r&&"code"in r.content&&typeof r.content.code=="string"&&(e=r.content.code),!e.includes(q_)}function z_(r){return r.status==="dead"||r.status==="terminating"&&!r.disposed&&!r.disposing||!r.disposed&&!r.disposing&&(r.session?.status=="unknown"||r.session?.kernel?.status=="unknown")&&(r.session.kernel?.isDisposed||r.session.isDisposed)}function FH(r){return r.status==="dead"||r.status==="terminating"&&!r.isDisposed||!r.isDisposed&&(r.status=="unknown"||r.kernel?.status=="unknown")&&(r.kernel?.isDisposed||r.isDisposed)}var J_=class{constructor(e,t,n,i,o,s,a,c,l){this.id=e;this.uri=t;this.resourceUri=n;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=c;this.workspaceMemento=l;this.disposables=[];this._onIPyWidgetVersionResolved=new Tr.EventEmitter;this._onDidKernelSocketChange=new Tr.EventEmitter;this._onStatusChanged=new Tr.EventEmitter;this._onRestarted=new Tr.EventEmitter;this._onStarted=new Tr.EventEmitter;this._onDisposed=new Tr.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new Tr.CancellationTokenSource;this.startupUI=new Yt(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),ao(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(f),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||ao(this.resourceUri,{disableUI:!1}).catch(f)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,n,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=n?t.bind(n):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){return this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new Tr.CancellationTokenSource),this.startJupyterSession(e)}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(n=>n()));ee(`Interrupt requested ${B(this.resourceUri||this.uri)}`);let t;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;ee("Interrupt kernel execution"),n?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(n,e)),this._interruptPromise=void 0):(ee("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(n=>n())).catch(f)}if(ee(`Interrupt requested & sent for ${B(this.uri)} in notebookEditor.`),t==="timeout"){let n=b.restartKernelAfterInterruptMessage(mt(this.kernelConnectionMetadata)),i=b.restartKernelMessageYes;await Tr.window.showInformationMessage(n,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(ee(`Dispose Kernel '${B(this.uri)}' associated with '${B(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(n=>n())).then(f).catch(f)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._session&&(t.push(this._session.disposeAsync().catch(f)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),z(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=ro(this.resourceUri);ee(`Restart requested ${B(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(n=>n(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new Ge;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;n?(this._restartPromise||(this._restartPromise=n.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(f)),await this._restartPromise,this.startCancellation=new Tr.CancellationTokenSource):await this.start(new Yt(!1)),wt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(n){C(`Restart failed ${B(this.uri)}`,n),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,wt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,n),await i?.disposeAsync().catch(f),this._ignoreJupyterSessionDisposedErrors=!1,n}await this.initializeAfterStart(this._session),this._onRestarted.fire()}catch(e){throw C(`Failed to restart kernel ${B(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(f)}}async startJupyterSession(e=new Yt(!1)){this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)});let t=Tr.workspace.notebookDocuments.find(n=>n.uri.toString()===this.uri.toString());if(this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||ea(this.resourceUri,this.kernelConnectionMetadata).catch(f)},this,this.disposables),this.disposing)throw new Tr.CancellationError;if(Sn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let n=new Ge,i=async()=>{let o=t?On(t)?.jupyterSessionTelemetry():void 0;if(await ao(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,userExecutedCell:!this.startupUI.disableUI}),this.disposing)throw new Tr.CancellationError;o?.stop(),Sn.throwIfCanceled(this.startCancellation.token)};this._jupyterSessionPromise=i().then(()=>this.createJupyterSession()).then(o=>(wt(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:n.elapsedTime}),o)).catch(o=>{throw ne(`Failed to create Jupyter Session in Kernel.startNotebook for ${B(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,o})}return this._jupyterSessionPromise.finally(()=>this.sendKernelStartedTelemetry()).catch(f),this._jupyterSessionPromise}async interruptExecution(e,t){let n=le(),i=new Ge,o=[],s=l=>{(l==="restarting"||l==="autorestarting")&&(U("Kernel restarting during interrupt"),n.resolve(!0))},a=(l,u)=>s(u);return e.statusChanged.connect(a),o.push(new Tr.Disposable(()=>Wn(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(ee(`Interrupting kernel: ${e.kernel.name}`),await wh(this.kernelSettings.interruptTimeout,new B_(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(l=>{U(`Error during interrupt: ${l}`),n.resolve(!0)})),(async()=>{let l=le();this.status==="busy"&&(this.onDisposed(()=>l.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?l.resolve("dead"):void 0,this,o));try{return await xr(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),n.promise.then(()=>"restart"),l.promise)}catch(u){if(n.completed)return"restart";throw wt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{z(o)}})().then(l=>(wt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:l}),l))}async createJupyterSession(){if(this.disposing)throw new Tr.CancellationError;Sn.throwIfCanceled(this.startCancellation.token);let e=[];try{let t="",n=this.kernelConnectionMetadata.interpreter;if(n){let o=[];o.push(`Python Path: ${B(n.uri)}`),o.push(n?Be(n):""),o.push(Wr(n)||"");let s=Zi(n);s&&o.push(`${s.major}.${s.minor}.${s.micro}`),t=` (${o.filter(a=>a).join(", ")})`}ee(`Starting Kernel ${this.kernelConnectionMetadata.kind}, ${this.kernelConnectionMetadata.id} ${t} for '${B(this.uri)}' (disableUI=${this.startupUI.disableUI})`),this.createProgressIndicator(e),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new Tr.CancellationError;if(Sn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new Tr.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),i}catch(t){if(this.startupUI.disableUI?P(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t):!this.startCancellation.token&&!fr(t)&&C(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t),Sn.throwIfCanceled(this.startCancellation.token),t instanceof Rs)throw t;let n=b.sessionStartFailedWithKernel(mt(this.kernelConnectionMetadata));throw un.from(n+" "+("message"in t?t.message:t.toString()),t)}finally{z(e)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,wt(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=ht.createProgressReporter(this.resourceUri,b.connectingToKernel(mt(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){let t=Tr.workspace.notebookDocuments.find(o=>o.uri.toString()===this.uri.toString()),n=On(t),i=t?n?.postKernelStartup():void 0;try{if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(a=>a(e,this.startCancellation.token).catch(f))),P(`Started running kernel initialization for ${B(this.uri)}`),!e){P("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(c=>this._onDidKernelSocketChange.fire(c)),e.onDidDispose(()=>{if(ne(`Kernel got disposed as a result of session.onDisposed (1) ${B(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){ee(`Kernel got disposed as a result of session.onDisposed ${B(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let c=this._session===e;this._jupyterSessionPromise=void 0,this._session=void 0,c&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let a=(c,l)=>this._onStatusChanged.fire(l);e.statusChanged.connect(a),this.disposables.push(new Tr.Disposable(()=>Wn(()=>e.statusChanged.disconnect(a))))}if(e.kernel?.registerCommTarget(Qe.DefaultCommTarget,f),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(a=>C("Failed to determine IPyWidget version",a)),this.gatherInternalStartupCode().then(a=>this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(a=>C("Failed to execute internal startup code",a));else{await this.determineVersionOfIPyWidgets(e);let a=await this.gatherInternalStartupCode();await this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}i?.stop();let o=n?.kernelInfo();try{P("Requesting Kernel info"),this._info=await OH(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(a){U("Failed to request KernelInfo",a)}o?.stop();let s=n?.kernelIdle();this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(P("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),P("End running kernel initialization, session is idle")),s?.stop()}finally{i?.stop()}}async determineVersionOfIPyWidgets(e){if(!It(this.kernelConnectionMetadata)){this._ipywidgetsVersion==jS,this._onIPyWidgetVersionResolved.fire(jS);return}let t=async()=>{let n=KH.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${q_}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[n]).catch(o=>C("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(c=>(c.text||"")?.toString().includes(`${q_}8.`)),s=i.some(c=>(c.text||"")?.toString().includes(`${q_}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;P(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else U("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let n=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[zi]||"target_name"in s.content&&s.content.target_name===Qe.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(f),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(n,this)))};this.session.kernel.anyMessage.connect(n,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((n,i)=>i.priority-n.priority).map(n=>n.getCode(this)));for(let n of t)e.push(...n);if(It(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let n=Ae(this.resourceUri);n&&e.push(`__vsc_ipynb_file__ = "${n.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(bh.DisableJedi),e.push(...Yge(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){ne(`Initialize config for plots for ${B(this.resourceUri||this.uri)}`);let t=bh.MatplotLibInit;P(`Initialize matplotlib for ${B(this.resourceUri||this.uri)}`),e.push(...We(t,{trim:!1}));let n=Tr.window.activeColorTheme.kind===Tr.ColorThemeKind.Dark;e.push(n?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Qe.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return We(t,{trim:!1})}return[]}async executeSilently(e,t,n){if(t.join("").trim().length!==0){if(!e.kernel){P(`Not executing startup as there is no session, code: ${t}`);return}return In(e.kernel,t.join(`
`),n)}}},$_=class extends J_{get creator(){return"3rdPartyExtension"}constructor(e,t,n,i,o,s,a){super(`3rdPartyKernel_${(0,VF.default)()}`,e,t,n,i,o,s,"3rdPartyExtension",a)}},H_=class extends J_{constructor(t,n,i,o,s,a,c,l){super((0,VF.default)(),n.uri,t,i,o,s,c,"jupyterExtension",l);this.notebook=n;this.controller=a}get creator(){return"jupyterExtension"}};function Yge(r,e){return!r||r.length===0||(r=r.map(t=>`    ${t}`),r.unshift("try:"),r.push("except:",`    print('${e}')`)),r}function Q_(r){if(r.length>0){let e=r[0].data;if(e&&e.hasOwnProperty("text/plain"))return Os(e["text/plain"]);if(r[0].output_type==="stream"){let t=r[0];return Os(t.text)}}}function BF(r,e){return{get enableExtendedPythonKernelCompletions(){return r.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return r.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return r.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return r.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return r.getSettings(e).themeMatplotlibPlots}}}var ds=require("vscode");var Ua=require("vscode");var qF=D($N()),Rr=require("vscode");var By=new WeakMap;function Iu(r){if(r.parent_header&&"msg_id"in r.parent_header)return r.parent_header.msg_id}var fd=class fd{constructor(e,t,n,i,o,s,a,c){this.cell=e;this.controller=t;this.context=n;this.formatters=i;this.kernel=o;this.request=s;this._onErrorHandlingIOPubMessage=new Rr.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=le();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(f),this.executeRequestMessageId=c,this.ownedRequestMsgIds.add(c),Rr.workspace.onDidChangeNotebookDocument(l=>{if(!Nt(l.notebook))return;let u=l.cellChanges.find(({cell:p})=>p===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=l=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(l)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(f))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,bt(this.cell,"Execution Message Handler disposed"),z(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:n}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=Iu(n);i.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),n.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(n)&&n.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,c=typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type==="interrupt_request",l=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],p="msg_type"in n&&typeof n.msg_type=="string"&&u.includes(n.msg_type);if(!this.completedExecution&&l)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(p||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),c?1e3:100),this.disposables.push(new Rr.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(n)&&this.ownedCommIds.has(n.content.comm_id)&&this.ownedRequestMsgIds.add(n.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(n){C("Failed to handle iopub message as a result of some comm message",t,n),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(n)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(){if(this.cell.document.isClosed)return;let e=By.get(this.cell.notebook);return e||(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=Ki.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),P(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let n=e;this.handleStatusMessage(n)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||U(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Qe.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let n="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||n&&this.ownedRequestMsgIds.has(n.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let n="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return U("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(n))return U(`Came across a comm update message a child that start start with ${n}`,i);let o=i.substring(n.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(bt(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(f,f),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&zi in e.data){let c=e.data[zi];if(c&&this.context.extensionMode===Rr.ExtensionMode.Test&&(c._vsc_test_cellIndex=this.cell.index),c&&"model_id"in c){let l=fd.modelIdsOwnedByCells.get(this.cell)||new Set;l.add(c.model_id),fd.modelIdsOwnedByCells.set(this.cell,l)}}let n=xo(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;bt(this.cell,()=>`Update output with mimes ${n.items.map(c=>c.mime).toString()}`);let o=this.execution||this.createTemporaryTask();this.clearOutputIfNecessary(o),i&&rn.trackOutputByDisplayId(this.cell,i,n,n.items),this.clearLastUsedStreamOutput(),bt(this.cell,"Append output in addToCellData");let s=!0,a=Iu(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&n.items.every(c=>this.canMimeTypeBeRenderedByWidgetManager(c))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:n},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([n]).then(f,f),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===zi){let n=JSON.parse(new TextDecoder().decode(e.data));return!(typeof n.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(n.model_id))}return!t.startsWith("application/vnd")}updateJupyterOutputWidgetWithOutput(e,t){let n=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:n;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(x=>fd.modelIdsOwnedByCells.get(x)?.has(s));if(!a){U(`Unable to find a cell that owns the model ${s}`);return}let c=a.outputs.find(x=>x.items.find(E=>{if(E.mime!==zi)return!1;try{return JSON.parse(new TextDecoder().decode(E.data)).model_id===s}catch(A){U("Failed to deserialize the widget data",A)}return!1}));if(!c)return;let l=fd.outputsOwnedByWidgetModel.get(s)||new Set,p=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let m=a.outputs.slice().filter(x=>p?!l.has(x.id):!0),h=m.slice(0,m.indexOf(c)+1),g=m.slice(m.indexOf(c)+1);fd.outputsOwnedByWidgetModel.set(s,l),o&&l.add(o.id);let y=o?h.concat(o).concat(g):h.concat(g);return g.length===0&&o?t?.appendOutput(o,a).then(f,f):p&&!o&&g.length===0||t?.replaceOutput(y,a).then(f,f),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new Rr.CancellationTokenSource;this.prompts.add(t);let n=e.content.password!==null&&e.content.password;await Rr.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:n},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"})},f),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(n=>{n.source&&n.source==="set_next_input"&&"text"in n&&"replace"in n&&this.handleSetNextInput(n),n.data&&n.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:n.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new Rr.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new Rr.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{bt(this.cell,"Create new cell after current");let n=new Rr.NotebookCellData(Rr.NotebookCellKind.Code,e.text,this.cell.document.languageId);n.outputs=[],n.metadata={};let i=Rr.NotebookEdit.insertCells(this.cell.index+1,[n]);t.set(this.cell.notebook.uri,[i])}Rr.workspace.applyEdit(t).then(f,f)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){bt(this.cell,`Kernel switching to ${e.content.execution_state}`)}handleStreamMessage(e){if(Iu(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==Iu(e))return;bt(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.execution||this.createTemporaryTask(),n=e.content.name==="stdout"?Rr.NotebookCellOutputItem.stdout("").mime:Rr.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===n)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=xo({output_type:"stream",name:e.content.name,text:e.content.text});bt(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(f,f)}else if(i){let o=Os(e.content.text),s=xo({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},bt(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(f,f)}else{let o=QV(Os(e.content.text)),s=xo({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},bt(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(f,f)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:xx(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===Iu(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.execution||this.createTemporaryTask();this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.execution||this.createTemporaryTask();this.clearLastUsedStreamOutput(),t?.clearOutput().then(f,f),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;ne(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),ne(`Traceback for error after formatting ${t}`);let n={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};if(this.cell.notebook.notebookType!=="interactive"){let i=Ki.get(this.cell);i&&e.content.ename!=="KeyboardInterrupt"&&(i.errorInfo={message:`${e.content.ename}: ${e.content.evalue}`,location:O9(e.content.traceback,this.cell),uri:this.cell.document.uri,stack:e.content.traceback.join(`
`)})}this.addToCellData(n,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){U("Update display data message received, but no display id",e.content);return}let n=rn.getMappedOutput(this.cell.notebook,t);if(!n){P("Update display data message received, but no output found to update",e.content);return}if(n.cell.document.isClosed){U("Update display data message received, but output cell is closed",e.content);return}let i=zN(new Rr.NotebookCellOutput(n.outputItems,n.outputContainer.metadata)),o=xo({...i,data:e.content.data,metadata:e.content.metadata});if(n.outputItems.length===0&&o.items.length===0){P("Update display data message received, but no output to update",e.content);return}let s=!1;if(n.outputItems.length===o.items.length){let c=!0;if((0,qF.default)(n.outputContainer.metadata||{},o.metadata||{})||(s=!0,c=!1),c){for(let l=0;l<n.outputItems.length;l++)if(!(0,qF.default)(n.outputItems[l],o.items[l])){c=!1;break}}if(c){P("Update display data message received, but no output to update (data is the same)",e.content);return}}let a=this.execution||this.createTemporaryTask();if(bt(this.cell,`Replace output items in display data ${o.items.length}`),s){let c=n.cell.outputs.map(l=>{let u=zN(l);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:l});a?.replaceOutput(c,n.cell).then(f,f),rn.trackOutputByDisplayId(n.cell,t,o,o.items)}else a?.replaceOutputItems(o.items,n.outputContainer).then(f,f),rn.trackOutputByDisplayId(n.cell,t,n.outputContainer,o.items);this.endTemporaryTask()}};v([Ur()],fd.prototype,"handleReply",1);var FC=fd;var hd=class extends Error{constructor(t){super(t.evalue||t.ename);this.ename=t.ename,this.evalue=t.evalue,this.traceback=t.traceback}};var Y_=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,n,i){return JF.fromCell(e,t,n,this.controller,this.requestListener,i)}},JF=class r{constructor(e,t,n,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=n;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=le();this.cancelHandled=!1;this.disposables=[];this._preExecuteEmitter=new Ua.EventEmitter;if(Ua.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){ee(`Disposing request as the cell (${this.cell.index}) was deleted ${B(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(c){C(`Error during cell execution dispose: ${c}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),Hl.setCellState(e,Ua.NotebookCellExecutionState.Idle),this.canExecuteCell())this.execution=Ki.getOrCreate(e,this.controller,!s?.msg_id),Hl.setCellState(e,Ua.NotebookCellExecutionState.Pending);else{let a=Ki.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get preExecute(){return this._preExecuteEmitter.event}static fromCell(e,t,n,i,o,s){return new r(e,t,n,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){bt(this.cell,"Not starting as it was cancelled");return}if(bt(this.cell,"Start execution"),ne(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(f,f),this.completedWithErrors(new bn),this.result):this.started?(bt(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),C(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,By.set(this.cell.notebook,this.execution),Hl.setCellState(this.cell,Ua.NotebookCellExecutionState.Executing),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(f),this.result)}async resume(e,t){if(this.cancelHandled){bt(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(bt(this.cell,"Start resuming execution"),ne(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(C(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,By.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),Hl.setCellState(this.cell,Ua.NotebookCellExecutionState.Executing),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(n=>{C(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,n),this.completedWithErrors(n.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(f),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){bt(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(f);return}this.cancelHandled||this._completed||(bt(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,bt(this.cell,"Execution disposed"),z(this.disposables))}completedWithErrors(e,t,n=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?U("Cell completed with errors",e):U(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),bt(this.cell,"Completed with errors"),n){let i,o;e&&!(e instanceof et)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&FH(this.session)&&(e=new bn),e&&(e instanceof et?i=vm(Ua.workspace.workspaceFolders||[],e,mt(this.kernelConnection),Hh(this.kernelConnection.interpreter))?.message:i=e.message||e.name||e.stack),o=Yh(i||""),o&&this.execution?.appendOutput(o).then(f,f)}this.endCellTask("failed",t),bt(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){bt(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),bt(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}By.get(this.cell.notebook)===this.execution&&By.set(this.cell.notebook,void 0),Hl.setCellState(this.cell,Ua.NotebookCellExecutionState.Idle),this.execution=void 0}}completedDueToCancellation(){bt(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),bt(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(bt(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(f,f)),bt(this.cell,"Empty cell execution"),this.completedSuccessfully();let n={cellId:this.cell.document.uri.toString(),...Jl(this.cell).metadata},i=t.kernel;try{this._preExecuteEmitter.fire(this.cell),P(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,n),this.request.done.then(f,f)}catch(o){return C(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{C(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{bt(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();bt(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new hd(o.content),s,!1):this.completedSuccessfully(s),bt(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&C("Error in waiting for cell to complete",o),bt(this.cell,"Some other execution error"),o&&o instanceof Error&&fr(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var LH=require("vscode");var X_=class{constructor(e,t,n,i){this.controller=e;this.context=t;this.formatters=n;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;LH.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){z(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new FC(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,n),n}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new FC(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,n),n}};var $F=require("vscode");var Z_=require("vscode");function pl(r,e,t){r!==Je&&P(`Execution Id:${e}. ${t}.`)}var UH=new Map,qy=class r{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new Z_.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new Z_.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new Z_.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=le();this.cancelHandled=!1;this.disposables=[];let n=UH.get(t)||0;n+=1,UH.set(t,n),this.executionId=`${t}-${n}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new r(e,t)}async start(e){if(this.session=e,this.cancelHandled){pl(this.extensionId,this.executionId,"Not starting as it was cancelled");return}if(pl(this.extensionId,this.executionId,"Start Code execution"),ne(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new bn);return}if(this.started)return pl(this.extensionId,this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),C(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(f)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){pl(this.extensionId,this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&this.extensionId!==Je&&await e.interrupt().catch(f),this.request?.dispose(),await this.request?.done.catch(f)}this.cancelHandled||this._completed||(pl(this.extensionId,this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||pl(this.extensionId,this.executionId,"Execution disposed"),z(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}pl(this.extensionId,this.executionId,"Send code for execution");let n=t.kernel;try{this.started=!0,this._onRequestSent.fire(),pl(this.extensionId,this.executionId,"Execution Request Sent to Kernel"),this.request=W9(n,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(f,f)}catch(i){C(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(pl(this.extensionId,this.executionId,"Executed with errors"),this._done.reject(new hd(i.content))):(pl(this.extensionId,this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&C(`Error in waiting for code ${this.executionId} to complete`,i),this._done.reject(i)}}};var eT=class{constructor(e,t,n,i){this.session=e;this.executionFactory=t;this.metadata=n;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this._onPreExecute=new $F.EventEmitter;this._onPostExecute=new $F.EventEmitter;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}get onPreExecute(){return this._onPreExecute.event}get onPostExecute(){return this._onPostExecute.event}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,n){return this.enqueue({code:e,extensionId:t,token:n})}enqueue(e){let t;if("cell"in e){let{cell:n,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===n);if(o)return bt(n,"Use existing cell execution"),o;let s=this.executionFactory.create(n,i,this.metadata);t=s,this.disposables.push(s),s.preExecute(a=>this._onPreExecute.fire(a),this,this.disposables),this.queueOfItemsToExecute.push(s),bt(n,"User queued cell for execution")}else{let{code:n,extensionId:i,token:o}=e,s=qy.fromCode(n,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(Da(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){bt(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),bt(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,P("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,P("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(n=>e===n.cell):this.queueOfItemsToExecute;await Promise.all(t.map(n=>n.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(f),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){C("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(n=>n.type==="cell"&&bt(n.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let n=this.queueOfItemsToExecute[0];this.lastCellExecution=n,n.type==="cell"&&bt(n.cell,"Before Execute individual cell");let i=!0;try{n.type==="cell"&&n.cell.notebook.isClosed?e=!0:n.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await n.start(t).then(()=>!0).catch(()=>!1))}finally{n.type==="cell"&&bt(n.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(n);s>=0&&this.queueOfItemsToExecute.splice(s,1),n.type==="cell"&&this._onPostExecute.fire(n.cell)}let o=!1;if(n.type==="cell"&&Jl(n.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){U(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)U(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){U(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,U("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var tT=class{constructor(e,t,n,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this._onPreExecute=new ds.EventEmitter;this.onPreExecute=this._onPreExecute.event;this._onPostExecute=new ds.EventEmitter;this.onPostExecute=this._onPostExecute.event;this.documentExecutions=new WeakMap;this._onDidReceiveDisplayUpdate=new ds.EventEmitter;this.onDidReceiveDisplayUpdate=this._onDidReceiveDisplayUpdate.event;this.hookedSesions=new WeakSet;let o=new X_(e.controller,t,n,i);this.disposables.push(o),this.executionFactory=new Y_(e.controller,o),ds.notebooks.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===ds.NotebookCellExecutionState.Idle&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),e.onStatusChanged(this.hookupIOPubHandler,this,this.disposables),e.onRestarted(this.hookupIOPubHandler,this,this.disposables),this.hookupIOPubHandler(),this.disposables.push(this._onPreExecute)}get executionCount(){return this._visibleExecutionCount}hookupIOPubHandler(){let e=this.kernel.session;if(!e||this.hookedSesions.has(e))return;this.hookedSesions.add(e);let t=(n,i)=>{if(i.header.msg_type!=="update_display_data"&&i.header.msg_type!=="display_data")return;let o=i,s=o.content.transient?.display_id;if(!s||!q9(e,s))return;let a=xo({output_type:"display_data",data:o.content.data,metadata:o.content.metadata,transient:o.content.transient});this._onDidReceiveDisplayUpdate.fire(a)};e.iopubMessage.connect(t),this.disposables.push({dispose:()=>{e?.iopubMessage.disconnect(t)}})}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(bt(e,`NotebookKernelExecution.resumeCellExecution (start), ${B(e.notebook.uri)}`),e.kind==ds.NotebookCellKind.Markup)return;await ea(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata),wt(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let n=this.kernel.start(new Yt(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,n);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);bt(e,`NotebookKernelExecution.resumeCellExecution (completed), ${B(e.notebook.uri)}`),P(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){bt(e,`NotebookKernelExecution.executeCell (1), ${B(e.notebook.uri)}`);let n=new Ge;if(e.kind==ds.NotebookCellKind.Markup)return;bt(e,`NotebookKernelExecution.executeCell, ${B(e.notebook.uri)}`),await ea(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let i=this.kernel.start(new Yt(!1));await this.kernel.restarting,bt(e,`NotebookKernelExecution.executeCell (2), ${B(e.notebook.uri)}`);let o=this.getOrCreateCellExecutionQueue(e.notebook,i);o.queueCell(e,t);let s=!0;try{await o.waitForCompletion(e)}catch(a){throw s=!1,a}finally{bt(e,`NotebookKernelExecution.executeCell completed (3), ${B(e.notebook.uri)}`),P(`Cell ${e.index} executed ${s?"successfully":"with an error"}`),wt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:n.elapsedTime})}}async*executeCode(e,t,n,i){let o=new Ge;await ea(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let s=this.kernel.start(new Yt(!1));await this.kernel.restarting;let a=this.getOrCreateCellExecutionQueue(this.notebook,s),c;t===Je?(c=qy.fromCode(e,t),s.then(g=>c.start(g))):c=a.queueCode(e,t,i),t!==Je&&P(`Queue code ${c.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let l=!1,u=[];c.result.finally(()=>{l=!0,!i.isCancellationRequested&&ee(`Execution of code ${c.executionId} completed in ${o.elapsedTime}ms`),t!==Je&&wt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),z(u)}).catch(f);let p=Es(c.result),m=[],h=le();for(u.push(c.onRequestSent(()=>n.started.fire())),u.push(c.onRequestAcknowledged(()=>n.executionAcknowledged.fire())),c.onDidEmitOutput(g=>{m.push(g),h.resolve(),h=le()},this,u),i.onCancellationRequested(()=>{l||P(`Code execution cancelled by extension ${t}`)},this,u);;){await Promise.race([h.promise,p.promise]),l&&(h=le());let g=this.kernel.session;for(;m.length;){let y=m.shift();g&&FP(t,g,y),yield y}if(p.completed)break}}executeHidden(e){return this.kernel.start().then(n=>n.kernel?In(n.kernel,e):Promise.reject(new bn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(ee("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(f)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),n=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(f)):Promise.resolve();n||(ee("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let n=this.documentExecutions.get(e);if(n&&!n.isEmpty&&!n.failed)return n;let i=new eT(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),ds.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(P(`Cancel executions after closing notebook ${B(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),i.onPreExecute(o=>this._onPreExecute.fire(o),this,this.disposables),i.onPostExecute(o=>this._onPostExecute.fire(o),this,this.disposables),this.documentExecutions.set(e,i),i}};var Jy=class extends W_{constructor(t,n,i,o,s,a,c,l,u){super(t,n);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=c;this.startupCodeProviders=l;this.workspaceStorage=u;n.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t.notebookType===xt?n.resourceUri:t.uri,s=BF(this.configService,o),a=t.uri.path.endsWith(".interactive")||n.resourceUri?.path.endsWith(".interactive")?xt:_t,c=new H_(o,t,n.metadata,this.sessionCreator,s,n.controller,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.executions.set(c,new tT(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(c),c}};Jy=v([(0,fn.injectable)(),d(0,(0,fn.inject)(di)),d(1,(0,fn.inject)(F)),d(2,(0,fn.inject)(Sx)),d(3,(0,fn.inject)(de)),d(4,(0,fn.inject)(lt)),d(5,(0,fn.inject)(Zt)),d(6,(0,fn.multiInject)(gg)),d(7,(0,fn.inject)($l)),d(8,(0,fn.inject)($e)),d(8,(0,fn.named)(pi))],Jy);var $y=class extends V_{constructor(t,n,i,o,s,a){super(t,n);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=BF(this.configService,o),a=o.path.endsWith(".interactive")?xt:_t,c=new $_(t,o,n.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(t,c),c}};$y=v([(0,fn.injectable)(),d(0,(0,fn.inject)(di)),d(1,(0,fn.inject)(F)),d(2,(0,fn.inject)(Sx)),d(3,(0,fn.inject)(de)),d(4,(0,fn.inject)($l)),d(5,(0,fn.inject)($e)),d(5,(0,fn.named)(pi))],$y);var yf=D(O()),Su=require("vscode");var Hy=class{constructor(e,t,n,i){this.extensionChecker=t;this.interpreterService=n;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();P(`Start refreshing Kernel Picker (${t})`);let n=Su.notebooks.createNotebookControllerDetectionTask(_t),i=Su.notebooks.createNotebookControllerDetectionTask(xt);this.disposables.push(n),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(P(`End refreshing Kernel Picker (${t})`),n.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;Su.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&Nt(o.notebook)&&(e=!0,P("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables),Su.workspace.onDidOpenNotebookDocument(o=>{!e&&Nt(o)&&(e=!0,P("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables);let t,n="",i=()=>(t&&!t.isDisposed||(n=Date.now().toString(),P(`Start refreshing Kernel Picker (${n})`),t=new En(Su.notebooks.createNotebookControllerDetectionTask(_t),Su.notebooks.createNotebookControllerDetectionTask(xt)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(P(`End refreshing Kernel Picker (${n})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(P(`End refreshing Kernel Picker (${n})`),t?.dispose()):i()},this,this.disposables)}};Hy=v([(0,yf.injectable)(),d(0,(0,yf.inject)(F)),d(1,(0,yf.inject)(Ye)),d(2,(0,yf.inject)(st)),d(3,(0,yf.inject)(Or))],Hy);var jH=D(O());var Gy=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};Gy=v([(0,jH.injectable)()],Gy);var LC=D(O());var zy=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await t5(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};zy=v([(0,LC.injectable)(),d(0,(0,LC.inject)(Ke)),d(1,(0,LC.inject)(F))],zy);var UC=D(O());var WH=require("vscode");var Qy=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=ht.createProgressReporter(e.resourceUri,b.restartingKernelStatus(`: ${mt(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new En,n=setTimeout(()=>{t.isDisposed||t.add(ht.createProgressReporter(e.resourceUri,b.interruptKernelStatus(mt(e.kernelConnectionMetadata))))},1e3);t.add(new WH.Disposable(()=>clearTimeout(n))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};Qy=v([(0,UC.injectable)(),d(0,(0,UC.inject)(Ke)),d(1,(0,UC.inject)(F))],Qy);var Cu=D(O()),WC=require("vscode");var ja=D(O()),jC=require("vscode");var ms=require("vscode");var Xge=/python\s\d*.?\d*$/,HF="__old_vscode_kernelspecs",GF=class{constructor(e,t,n){this.fs=e;this.globalState=t;this.jupyterPaths=n;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&P(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(f,f)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){z(this.disposables)}async loadKernelSpec(e,t,n){if(e.fsPath.includes(HF))return;let i=vn(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,n).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),c=s&&a&&Jn(s)&&s.specFile&&_h(ms.Uri.file(s.specFile),a);if(s&&!c)return s;s?.specFile&&c&&this.deleteOldKernelSpec(s.specFile).catch(f),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(l=>_i(l.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(f)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=_e(dt(e)),n=Ve(dt(dt(e)),HF);this.oldKernelSpecsFolder=n;let i=Ve(n,t,_e(e));await this.fs.createDirectory(ms.Uri.file(dt(i))),await this.fs.copy(ms.Uri.file(e),ms.Uri.file(i)).catch(f),await this.fs.delete(ms.Uri.file(e)),P(`Old KernelSpec '${e}' deleted and backup stored in ${n}`)}async loadKernelSpecImpl(e,t,n){return Zge(e,this.fs,t,n)}async findKernelSpecsInPaths(e,t){let n=vn(e),i=this.findKernelSpecsInPathCache.get(n);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(c=>ir(e,c)):[])();this.findKernelSpecsInPathCache.set(n,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),s.dispose()}).catch(f),o.catch(a=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),P(`Failed to search for kernels in ${B(e)} with an error`,a)}),o}},Yy=class{constructor(e,t,n,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=n;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new Io;this._onDidChangeStatus=new ms.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new ms.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.timeouts=new Map;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new GF(e,n,s),this.disposables.push(this.kernelSpecFinder),this.disposables.push(new ms.Disposable(()=>z(Array.from(this.timeouts.values()))))}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let n=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(n),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>Fs.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}writeToMementoCache(e,t){this.timeouts.get(t)?.dispose();let n=setTimeout(()=>{this.memento.update(t,JSON.stringify({kernels:e.map(i=>i.toJSON()),extensionVersion:this.env.extensionVersion}))},500);this.timeouts.set(t,{dispose:()=>zt(clearTimeout)(n)})}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(ms.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(n=>n&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function Zge(r,e,t,n){if(r.fsPath.includes(HF))return;let i;try{i=JSON.parse(await e.readFile(r))}catch(l){C(`Failed to parse kernelspec ${r}`,l);return}if(t.isCancellationRequested||(i.name=n?await ZN(n):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(Xge)&&i.language===xe&&i.argv.length>2){let l=i.argv.slice(1).map(u=>u.toLowerCase()).filter(u=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(u));l.length&&(i.name=`${i.name}.${l.join("#")}`)}i.metadata=i.metadata||{},i.metadata.vscode=i.metadata.vscode||{},i.metadata.vscode.originalSpecFile||(i.metadata.vscode.originalSpecFile=r.fsPath),i.metadata.vscode.originalDisplayName||(i.metadata.vscode.originalDisplayName=i.display_name),i.metadata.originalSpecFile&&(i.metadata.vscode.originalSpecFile=i.metadata.originalSpecFile,delete i.metadata.originalSpecFile);let s=new gp(i,r.fsPath,n?.uri.fsPath||i?.metadata?.interpreter?.path,Jn(i));s.name=i?.name||_e(dt(r.fsPath));let a=n?.uri.fsPath||i?.metadata?.interpreter?.path,c=wr(n);if(!(a&&!c&&!await e.exists(ms.Uri.file(a))))return i.isRegisteredByVSC=Jn(i),s}function VH(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${jC.env.appHost}:${jC.env.remoteName||""}`}var fs=class extends Yy{constructor(t,n,i,o,s,a){super(t,i,o,s,a,n);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(VH()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(n=>this._kernels.set(n.id,n)),this._onDidChangeKernels.fire())}).catch(f),this.refresh().then(f,f)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new jC.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),VH())}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,p)=>u.id.localeCompare(p.id)),a=o.sort((u,p)=>u.id.localeCompare(p.id)),c=new Set(o.map(u=>u.id)),l=s.filter(u=>!c.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),l.length&&(P(`Local kernel spec connection deleted ${l.map(u=>`${u.kind}:'${u.id}'`)}`),l.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||l.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let n=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(n.map(c=>this.kernelSpecFinder.findKernelSpecsInPaths(c,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async c=>{try{let l=await this.kernelSpecFinder.loadKernelSpec(c,t);if(!l||t.isCancellationRequested)return;if(D_(l,"local"),l.metadata?.originalSpecFile){if(o.has(l.metadata.originalSpecFile))return;o.add(l.metadata.originalSpecFile)}if(l.specFile){if(o.has(l.specFile))return;o.add(l.specFile)}let u=a.get(l.display_name),p=hp.create({kernelSpec:l,interpreter:void 0,id:Fi(l)});u&&u.executable!==l.executable?(s.push(p),ba(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?U(`Duplicate kernel found ${l.display_name} ${l.executable} in ${l.specFile}`):(s.push(p),a.set(l.display_name,l),ba(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(l){C(`Failed to load kernelSpec for ${c}`,l);return}})),s}};v([Vv(100)],fs.prototype,"writeKernelsToMemento",1),fs=v([(0,ja.injectable)(),d(0,(0,ja.inject)(gr)),d(1,(0,ja.inject)(qr)),d(2,(0,ja.inject)(Ye)),d(3,(0,ja.inject)($e)),d(3,(0,ja.named)(gt)),d(4,(0,ja.inject)(F)),d(5,(0,ja.inject)(Vc))],fs);var Ko=D(O()),BH=require("vscode");var gd=Symbol("ITrustedKernelPaths");var ii=require("vscode");function zF(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${ii.env.appHost}:${ii.env.remoteName||""}`}async function eve(r,e,t,n,i){let o=await Pa(r);if(!o){U(`Failed to get sysPrefix for interpreter ${tn(r.id)}`);return}let s=ii.Uri.file(Ve(o,Y$)),a=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||a.some(p=>_i(p,s)))return;let c=await n.findKernelSpecsInPaths(s,e);if(e.isCancellationRequested)return;let l=new Set,u=new Map;await Promise.all(c.map(async p=>{try{let m=await n.loadKernelSpec(p,e,r);if(e.isCancellationRequested||!m)return;if(m.metadata?.originalSpecFile){if(l.has(m.metadata.originalSpecFile))return;l.add(m.metadata.originalSpecFile)}if(m.specFile){if(l.has(m.specFile))return;l.add(m.specFile)}let h=u.get(m.display_name);h&&h.executable!==m.executable?i.fire(m):h||(u.set(m.display_name,m),i.fire(m))}catch(m){C(`Failed to load kernel spec ${p}`,m)}}))}var rT=class extends or{constructor(t,n,i,o,s){super();this.interpreter=t;this.interpreterService=n;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new ii.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new ii.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this.lastKnownInterpreterVersion=Zi(t),this.lastKnownInterpreterSysPrefix=Hh(t),this.lastKnownEnvFolder=Mr(t)?.environment?.folderUri,this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new ii.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>{switch(this._kernels.size){case 0:P(`No Kernels found in interpreter ${this.interpreter.id}`);break;case 1:break;default:P(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)}}),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=Mr({id:this.interpreter.id});if(!t)return;let n=Zi(t),i=Hh(t);(this.lastKnownEnvFolder?.fsPath!==t.environment?.folderUri?.fsPath||this.lastKnownInterpreterVersion?.sysVersion!==n?.sysVersion||Be(this.interpreter)!==Be(t)||this.lastKnownInterpreterSysPrefix!==i)&&(this.lastKnownInterpreterVersion=n,this.lastKnownInterpreterSysPrefix=i,this.listKernelSpecs(!0).catch(f))}async listKernelSpecsImpl(){let t=this.cancelToken.token;if(!Hh(this.interpreter))return;P(`Search for KernelSpecs in Interpreter ${tn(this.interpreter.uri)}`);let i=new Map,o=new ii.EventEmitter,s=o.event(m=>{if(t.isCancellationRequested)return;if(m.language===xe&&(!m.env||Object.keys(m.env).length===0)&&wx(m)){P(`Hiding default KernelSpec '${m.name}', ${tn(m.argv[0])} for interpreter ${tn(m.interpreterPath)} (KernelSpec file ${tn(m.specFile)})`);return}let h=sf(m)?zo.create({kernelSpec:m,interpreter:this.interpreter,id:Fi(m,this.interpreter)}):hp.create({kernelSpec:m,interpreter:this.interpreter,id:Fi(m,this.interpreter)});h&&!this._kernels.has(h.id)&&(this._kernels.set(h.id,h),this._onDidChangeKernels.fire({added:[h],removed:[]})),h&&!i.has(h.id)&&i.set(h.id,h)}),[a]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),eve(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,o)]);if(o.dispose(),s.dispose(),t.isCancellationRequested)return;let l=await Us(this.interpreter,a);if(t.isCancellationRequested)return;let u=zo.create({kernelSpec:l,interpreter:this.interpreter,id:Fi(l,this.interpreter)});this._kernels.has(u.id)||(this._kernels.set(u.id,u),this._onDidChangeKernels.fire({added:[u],removed:[]})),i.has(u.id)||i.set(u.id,u);let p=Array.from(this._kernels.keys()).filter(m=>!i.has(m)).map(m=>this._kernels.get(m));p.forEach(m=>this._kernels.delete(m.id)),this._onDidChangeKernels.fire({added:[],removed:p})}},nT=class r{constructor(e,t,n,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=n;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new ii.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!ba(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){z(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new ii.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,n){let i=this.extensionChecker.isPythonExtensionInstalled?bo():[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await vt(e.specFile):"",c=!!Jn(e);if(e.language&&e.language!==xe){!c&&o&&e.specFile&&u_(o)&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:_e(o)!==o,argv0:_e(o),language:s,isCreatedByUs:c});return}let l=i.find(u=>e.metadata?.interpreter?.path&&Go(ii.Uri.file(e.metadata.interpreter.path),u.executable.uri)?(P(`Kernel ${e.name} matches ${tn(u.id)} based on metadata.interpreter.`),!0):!1);if(l)return Oi(l);if(o&&_e(o)===o&&e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:_e(o),language:s,isCreatedByUs:c}),o&&_e(o)!==o){let u=ii.Uri.file(o),p=i.find(m=>Go(u,m.executable.uri)?(P(`Kernel ${e.name} matches ${tn(m.id)} based on argv.`),!0):!1);if(p)return e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"found",language:s,isCreatedByUs:c}),Oi(p);if(!e.specFile||this.trustedKernels.isTrusted(ii.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(n?.isCancellationRequested)return;if(m)return e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:c}),m;e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:c})}else e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:c})}if(e.interpreterPath){let u=ii.Uri.file(e.interpreterPath),p=i.find(m=>e.interpreterPath&&Go(u,m.executable.uri)?(P(`Kernel ${e.name} matches ${tn(m.id)} based on interpreterPath.`),!0):!1);if(p)return Oi(p);if(!e.specFile||this.trustedKernels.isTrusted(ii.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(m)return m}}if(!n?.isCancellationRequested)return Oi(i.find(u=>e.display_name===Mr(u)?.environment?.name?(P(`Kernel ${e.name} matches ${tn(u.id)} based on display name`),N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?_e(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:c}),!0):!1))}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===xe)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),U(`Kernel Spec for '${e.display_name}' (${tn(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Jn(s.kernelSpec)),n=s=>{if(s.kernelSpec.language!==xe)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),c=a.indexOf("-m");if(c===-1)return!1;let l=a.length-1>=c?a[c+1]:void 0;return l?l!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Jn(s.kernelSpec);return!a&&(n(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===xe&&!wx(s.kernelSpec)?!0:(P(`Kernel Spec for '${s.kernelSpec.display_name}' (${tn(s.kernelSpec.specFile)}) is hidden. (isDefaultKernelSpec = ${wx(s.kernelSpec)}, language = ${s.kernelSpec.language}, registrationInfo = ${a})`),!1)}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let l=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(u_(l)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let c=hp.create({kernelSpec:s.kernelSpec,interpreter:a,id:Fi(s.kernelSpec,a)});i.set(c.id,c),c.kernelSpec.specFile&&o.add(c.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var xu=class extends Yy{constructor(t,n,i,o,s,a,c,l,u){super(n,o,a,c,l,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new nT(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f)},this,this.disposables),t.onDidRemoveInterpreter(async p=>{if(await Di(1e3),Mr(p))return;P(`Interpreter removed ${p.id}`);let m=[];this._kernels.forEach(h=>{h.interpreter?.id===p.id&&(P(`Interpreter ${p.id} deleted, hence deleting corresponding kernel ${h.kind}:'${h.id}`),m.push(h),this._kernels.delete(h.id))}),m.length&&(P(`Local Python connection deleted ${m.map(h=>`${h.kind}:'${h.id}: (interpreter id=${tn(h.interpreter?.id)})'`)}`),this.updateCache().catch(f))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(zF()).then(t=>{t.length&&(t.filter(n=>!this._kernels.has(n.id)).forEach(n=>{this._kernelsFromCache.push(n),this._kernels.set(n.id,n)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,n=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==n.length||!ba(t,n))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(f))},this,this.disposables)}).catch(f)}get kernels(){return Array.from(this._kernels.values())}dispose(){z(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(f),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let n=this.refreshCancellation=new BH.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(n.token,t).catch(o=>C("Failure in listKernelsImplementation",o)),!n.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(l=>!this._kernelsExcludingCachedItems.has(l.id)),s=[];o.length&&(U(`Kernels ${o.map(l=>`${l.kind}:'${l.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(l=>`${l.kind}:'${l.id}'`).join(", ")}`),o.forEach(l=>{this._kernels.delete(l.id),s.push(l)}));let a=new Set(bo().map(l=>l.id)),c=Array.from(this._kernels.values()).filter(l=>!!(l.interpreter&&!a.has(l.interpreter.id)));c.length&&(U(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${c.map(l=>`${l.kind}:'id=${l.id}'(interpreterId='${tn(l.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),c.forEach(l=>{this._kernels.delete(l.id),s.push(l)})),s.length&&(P(`Local Python connection deleted ${s.map(l=>`${l.kind}:'${l.id}: (interpreter id=${tn(l.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>C("Failed to discover kernels in interpreters",o)).finally(()=>{n===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,zF())),this.updateCachePromise}async listKernelsImplementation(t,n){let i=this.extensionChecker.isPythonExtensionInstalled?bo():[],o=Promise.all(i.map(async a=>{let c=this.interpreterKernelSpecs.get(a.id);c||(c=new rT(Oi(a),this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(c),this.interpreterKernelSpecs.set(a.id,c),c.onDidChangeKernels(l=>{l.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(l.added),!l.added.length&&l.removed.length&&this.updateCache()},this,this.disposables)),await sr(t,[],c.listKernelSpecs(n))})),s=sr(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(n)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(n=>{yt(n)&&n.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(n.id,n),this._kernels.has(n.id)?this._kernels.set(n.id,n):this._kernels.set(n.id,n)):U(`Found a kernel ${n.kind}:'${n.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===xe).filter(i=>t?!0:!Jn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};xu=v([(0,Ko.injectable)(),d(0,(0,Ko.inject)(st)),d(1,(0,Ko.inject)(gr)),d(2,(0,Ko.inject)(qr)),d(3,(0,Ko.inject)(Ye)),d(4,(0,Ko.inject)(fs)),d(5,(0,Ko.inject)($e)),d(5,(0,Ko.named)(pi)),d(6,(0,Ko.inject)(F)),d(7,(0,Ko.inject)(Vc)),d(8,(0,Ko.inject)(gd))],xu);var bf=class extends Ms{constructor(t,n,i,o,s,a){super();this.nonPythonKernelFinder=t;this.pythonKernelFinder=n;this.disposables=o;this.extensionChecker=s;this.interpreters=a;this._status="idle";this._onDidChangeStatus=new WC.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new Io;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=b.localKernelSpecs;this._onDidChangeKernels=new WC.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];this.disposables.push(this),i.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let t,n=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?t||(t=le(),this.promiseMonitor.push(t.promise)):(t?.resolve(),t=void 0)};n(),this.nonPythonKernelFinder.onDidChangeStatus(n,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(n,this,this.disposables),this.interpreters.onDidChangeStatus(n,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),WC.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let t=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(t),await t}updateCache(){try{let t=[],n=this.nonPythonKernelFinder.kernels.filter(o=>this.extensionChecker.isPythonExtensionInstalled?o.kernelSpec.language!==xe:!0),i=this.pythonKernelFinder.kernels.filter(o=>Cg(o));t=t.concat(n).concat(i),this.writeToCache(t)}catch(t){C("Exception Saving loaded kernels",t)}}get kernels(){let t=new Set,n=[];return this.pythonKernelFinder.kernels.forEach(i=>{let o=Jn(i.kernelSpec);i.kernelSpec.specFile&&o==="registeredByNewVersionOfExtForCustomKernelSpec"&&(t.add(i.kernelSpec.specFile),n.push(i))}),this.cache.forEach(i=>{i.kernelSpec.specFile&&t.has(i.kernelSpec.specFile)||n.push(i)}),n}writeToCache(t){let n=new Set;t=t.filter(u=>n.has(u.id)?!1:(n.add(u.id),!0));let i=this.cache,o=new Map(i.map(u=>[u.id,u])),s=new Map(t.map(u=>[u.id,u])),a=t.filter(u=>!o.has(u.id)),c=t.filter(u=>o.has(u.id)&&!ba(u,o.get(u.id))),l=i.filter(u=>!s.has(u.id));this.cache=t,(a.length||c.length||l.length)&&this._onDidChangeKernels.fire({removed:l})}};v([Nh("List kernels failed")],bf.prototype,"updateCache",1),bf=v([(0,Cu.injectable)(),d(0,(0,Cu.inject)(fs)),d(1,(0,Cu.inject)(xu)),d(2,(0,Cu.inject)(Or)),d(3,(0,Cu.inject)(F)),d(4,(0,Cu.inject)(Ye)),d(5,(0,Cu.inject)(st))],bf);var Xy=D(O());var VC=require("vscode"),JH=require("os");function qH(r){let e=Be(r);return!!($H(r)&&(e==="Unknown"||e==="Pyenv"||e==="Conda"))}function $H(r){let e=Zi(r)?.major??3,t=Zi(r)?.minor??6;return e>=3&&t>=6}var wu=class{constructor(e,t,n){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.context=n;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(n){return C("Failed to create interrupter, trying again",n),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let n=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!n)throw C("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:n,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:n},e,t)},dispose:async()=>{await this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:n},e,t).catch(i=>C(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&qH(e))return e;let t=bo();return t.length===0?e:Oi(t.find(qH))||Oi(t.find($H))||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let n=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=VC.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=VC.Uri.joinPath(s,"kernel_interrupt_daemon.py"),c=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((l,u)=>{let p=!1,m=c.out.onDidChange(h=>{if(ne(`Output from interrupt daemon started = ${p}, output (${h.source}) = ${h.out} ('END)`),h.source==="stdout"&&h.out.trim().includes("DAEMON_STARTED:")&&!p)p=!0,l();else if(h.source==="stderr"&&h.out.includes("INTERRUPT:")&&h.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&p)We(h.out,{trim:!0,removeEmptyEntries:!0}).filter(g=>g.includes("INTERRUPT:")).forEach(g=>{try{let y=g.split(":"),x=parseInt(y[y.indexOf("INITIALIZE_INTERRUPT")+1],10),E=this.messages.get(x);E&&(C(`Failed to initialize interrupt daemon for ${x}, ${h.out}`),E.deferred.reject(new Error(`Failed to start interrupt daemon ${h.out}`)),this.messages.delete(x))}catch(y){C(`Failed to parse interrupt daemon response, ${h.out}`,y)}});else if(h.source==="stdout"&&h.out.includes("INTERRUPT:")&&p)We(h.out,{trim:!0,removeEmptyEntries:!0}).filter(g=>g.includes("INTERRUPT:")).forEach(g=>{try{let[y,x,E]=g.split(":"),A=this.messages.get(parseInt(x,10));A?(P(`Got a response of ${E} for ${y}:${x}`),A.deferred.resolve(E),this.messages.delete(parseInt(x,10))):C(`Got a response of ${E} for ${y}:${x} but no command entry found in ${h.out}`)}catch(y){C(`Failed to parse interrupt daemon response, ${h.out}`,y)}});else if(h.out.includes("ERROR: handling command")){if(U(`Error output in interrupt daemon response ${h.out} ('END')`),!p)return u(new Error(`Interrupt daemon failed to start, ${h.out}`));try{let g=h.out.split(":")[2],y=this.messages.get(parseInt(g,10));if(y){y.deferred.reject(new Error(h.out)),this.messages.delete(parseInt(g,10));return}}catch(g){C(`Failed to parse interrupt daemon response, ${h.out}`,g)}}});this.disposableRegistry.push(m)}),this.disposableRegistry.push(new VC.Disposable(()=>Wn(()=>c.proc?.kill()))),c.proc?.on("close",()=>{ne("Interrupt daemon closed"),this.startupPromise=void 0}),c.proc?.on("exit",()=>{ne("Interrupt daemon exited"),this.startupPromise=void 0}),c})();return n.catch(i=>C(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=n,n}async sendCommand(e,t,n){let i=le(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,n);if(!a||!a.stdin)throw C("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${JH.EOL}`),ne(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let c=await i.promise;if(ne(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(c,10)}};wu=v([(0,Xy.injectable)(),d(0,(0,Xy.inject)(Br)),d(1,(0,Xy.inject)(F)),d(2,(0,Xy.inject)(lt))],wu);var iT=D(O());var BC=require("vscode");var dl=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?BC.Uri.file(wn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return BC.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!dl.IsKernelSpecHidden.completed&&dl.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>BC.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};dl.IsKernelSpecHidden=le(),dl=v([(0,iT.injectable)(),d(0,(0,iT.inject)(Dr))],dl);var yT=D(Gc()),gs=D(O()),sL=D(require("os"));var rG=require("util"),nG=D(No()),bT=require("vscode");var U4=require("process"),j4=D(Gc()),tb=D(require("os"));var rb=require("vscode");var W4=D(s4());var K4="To connect another client to this kernel, use:",F4=["NOTE: When using the `ipython kernel` entry point, Ctrl-C will not work.","To exit, you will have to explicitly quit this process, by either sending",'"quit" from a client, or using Ctrl-\\ in UNIX-like environments.',"To read more about this, see https://github.com/ipython/ipython/issues/2049","It seems that frozen modules are being used, which may","make the debugger miss breakpoints. Please pass -Xfrozen_modules=off","to python to disable frozen modules","Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION"],eb=class extends Ms{constructor(t,n,i,o,s,a,c,l,u,p,m,h,g){super();this.processExecutionFactory=t;this._connection=n;this.fileSystem=o;this.resource=s;this.extensionChecker=a;this.kernelEnvVarsService=c;this.pythonExecFactory=l;this.outputChannel=u;this.jupyterSettings=p;this.jupyterPaths=m;this.pythonKernelInterruptDaemon=h;this.platform=g;this.exitEvent=new rb.EventEmitter;this.exitEventFired=!1;this._kernelConnectionMetadata=i}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return It(this.kernelConnectionMetadata)&&sf(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)ee("Interrupting kernel via SIGINT"),this._process.pid&&(0,U4.kill)(this._process.pid,"SIGINT");else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&It(this._kernelConnectionMetadata))return ee("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();C("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(t,n,i){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0;let o=On(this.resource),s=o?.updateConnection();await this.updateConnectionArgs(),s?.stop(),Sn.throwIfCanceled(i);let a=o?.spawn(),c=await this.launchAsObservable(t,i);a?.stop();let l=c.proc;if(i.isCancellationRequested)throw new rb.CancellationError;P(`Kernel process ${l?.pid}.`);let u="",p,m=le();if(m.promise.catch(f),l){let g=l.pid;l.on("exit",x=>{if(x=x||p,this.isDisposed){P(`KernelProcess Exited ${g}, Exit Code - ${x}`);return}P(`KernelProcess Exited ${g}, Exit Code - ${x}`,u),this.exitEventFired||(this.exitEvent.fire({exitCode:x||void 0,reason:Qh(u)||u,stderr:u}),this.exitEventFired=!0),i.isCancellationRequested||(ne("KernelProcessExitedError raised",u),m.reject(new il(x||-1,u,this.kernelConnectionMetadata)))});let y=!1;l.stdout?.on("data",x=>{let E=(x||"").toString();It(this.kernelConnectionMetadata)&&!y&&(E=L4(E),E.includes(K4)&&(E=E.trimStart())),E.includes(K4)&&(y=!0),P(`Kernel output ${g}: ${E}`),this.sendToOutput(E)}),l.stderr?.on("data",x=>{let E=L4((x||"").toString());u+=E,E.trim().length&&!E.includes("It seems that frozen modules are being used, which may")&&!E.includes("make the debugger miss breakpoints. Please pass -Xfrozen_modules=off")&&!E.includes("to python to disable frozen modules")&&!E.includes("Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION")&&(P(`KernelProcess error ${g}: ${E}`),this.sendToOutput(E))})}c.out.done.catch(g=>{if(this.isDisposed){U("Kernel died",g,u);return}C("Kernel died",g,u),m.reject(g)});let h=On(this.resource)?.portUsage();try{m.rejected&&await m.promise;let g=Pe.instance.get(ac).inExperiment("DoNotWaitForZmqPortsToBeUsed"),y=(await Promise.resolve().then(()=>D(O4()))).default,x=new Ge,E=g?Promise.resolve():Promise.all([y.waitUntilUsed(this.connection.shell_port,200,n),y.waitUntilUsed(this.connection.iopub_port,200,n)]).catch(A=>{if(!(i.isCancellationRequested||m.rejected)&&(U(`Waited ${x.elapsedTime}ms for kernel to start`,A),!g))return Promise.reject(new ly(this.kernelConnectionMetadata))});await ar(i,E,m.promise)}catch(g){let y=(u||"").trim();if(!i?.isCancellationRequested&&!fr(g)&&(C("Disposing kernel process due to an error",g),g&&g instanceof Error&&y.length&&g.message.includes(y)||C(y)),await this.dispose(),!i?.isCancellationRequested&&g instanceof et)throw g;{i?.isCancellationRequested&&P("User cancelled the kernel launch");let x=QE(y)||y.substring(0,100);throw ne("KernelDiedError raised",x,u+`
`+u+`
`),new id(b.kernelDied(x),u+`
`+u+`
`,g,this.kernelConnectionMetadata)}}finally{h?.stop()}}async dispose(){if(this._disposingPromise)return this._disposingPromise;if(this.isDisposed)return;let t=this._process?.pid;P(`Dispose Kernel process ${t}.`),this._disposingPromise=(async()=>{await xr(1e3,this.killChildProcesses(this._process?.pid).catch(f));try{this.interrupter?.dispose().catch(f),this._process?.kill(),this.exitEventFired||this.exitEvent.fire({stderr:""})}catch(n){C(`Error disposing kernel process ${t}`,n)}Wn(async()=>{this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(n=>U(`Failed to delete connection file ${this.connectionFile} for pid ${t}`,n))}),P(`Disposed Kernel process ${t}.`)})(),super.dispose()}async killChildProcesses(t){if(!(!t||!Qc.isAlive(t)))try{if(this.platform.isWindows){let n=process.env.WINDIR||"C:\\Windows",i=Ve(n,"System32","taskkill.exe");await new Qc().exec(i,["/F","/T","/PID",t.toString()])}else await new Promise(n=>{(0,W4.default)(t,(i,o)=>{i?U(`Failed to kill children for ${t}`,i):o.forEach(s=>Qc.kill(s)),n()})})}catch(n){U(`Failed to kill children for ${t}`,n)}}sendToOutput(t){this.outputChannel&&this.outputChannel.append(t)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let t=this._kernelConnectionMetadata.kernelSpec;if(!t)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(t.argv)?this._launchKernelSpec={...t,argv:[...t.argv]}:(C("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let t=F9(this.launchKernelSpec);if(t===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&t===0&&this.launchKernelSpec.argv[t-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.connectionFile=await this.createConnectionFile(),this.isPythonKernel)this.launchKernelSpec.argv.splice(t-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let n=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[t].includes("--connection-file")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Dm,n):this.launchKernelSpec.argv[t].includes(`=${Dm}`)&&!this.launchKernelSpec.argv[t].trim().startsWith("=")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Dm,n):this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Dm,this.connectionFile.fsPath)}}async createConnectionFile(){let t=await this.jupyterPaths.getRuntimeDir(),n=await this.fileSystem.createTemporaryLocalFile({fileExtension:".json",prefix:"kernel-v2-"}),i=t?Ve(t.fsPath,_e(n.filePath)):n.filePath;return await n.dispose(),rb.Uri.file(i)}addPythonConnectionArgs(t){let n=[],i=t.fsPath.includes(" ")?`"${t.fsPath}"`:t.fsPath;return n.push(`--f=${i}`),n}async launchAsObservable(t,n){let i;if(P(`Launching kernel ${this.kernelConnectionMetadata.id} for ${B(this.resource)} in ${B(t)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let o=On(this.resource),[s,a,c]=[o?.pythonEnvVars(),o?.envVars(),tb.platform()==="win32"?o?.interruptHandle():void 0],l=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),u=tb.platform()==="win32"?this.getWin32InterruptHandle().finally(()=>c?.stop()):c?.stop(),[p,m,h]=await Promise.all([l.finally(()=>s?.stop()),j4.pathExists(t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,n).finally(()=>a?.stop())]);if(Sn.throwIfCanceled(n),tb.platform()==="win32"&&u){h=h||process.env;try{let y=await u;h.JPY_INTERRUPT_EVENT=`${y}`,ne(`Got interrupt handle kernel id ${y} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(y){C(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,y)}}Sn.throwIfCanceled(n);let g=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&g.push("--debug"),i=p.execObservable(g,{cwd:m?t:process.cwd(),env:h}),Sn.throwIfCanceled(n)}else{let o=this.launchKernelSpec.argv[0];ee(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${o}`);let[s,a]=await Promise.all([this.processExecutionFactory.create(this.resource,n),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,n)]);Sn.throwIfCanceled(n);let c=this.launchKernelSpec.argv.slice(1);i=s.execObservable(o,c,{env:a,cwd:t})}if(!i.proc)throw new Error("KernelProcess failed to launch");return this._process=i.proc,this._pid=i.proc.pid,i}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};v([mr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],eb.prototype,"launch",1),v([d(1,sp())],eb.prototype,"launchAsObservable",1);function L4(r){let e=We(r,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))||e.some(t=>F4.some(n=>t.includes(n)))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")&&F4.every(n=>!t.includes(n))).join(tb.EOL).trimStart():r}var tG="kernelLauncherPortStart_{0}.tmp",Fo=class{constructor(e,t,n,i,o,s,a,c,l,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=n;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=c;this.pythonKernelInterruptDaemon=l;this.platformService=u}static async cleanupStartPort(){try{let e=await Fo.startPortPromise;P(`Cleaning up port start file : ${e}`);let t=Ve(sL.tmpdir(),Ph(tG,e.toString()));await yT.remove(t)}catch(e){U("Kernel port mutex failed to cleanup: ",e)}}static async computeStartPort(){if(Nr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let n=Ve(sL.tmpdir(),Ph(tG,e.toString()));await yT.open(n,"wx"),t=e}catch{e+=1e3}return P(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,n,i,o){let s=new Ge,a=(async()=>(this.logIPyKernelPath(n,e,o).catch(f),await this.launchProcess(e,n,i,t,o)))();return a.then(()=>N("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:ro(n)})).catch(f),a}async logIPyKernelPath(e,t,n){let i=t.interpreter;if(!yt(t)||!It(t)||!i)return;let s=await(await this.pythonExecFactory.createActivatedEnvironment({interpreter:i,resource:e})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:n});if(n.isCancellationRequested)return;let a=B(i.uri);if(s.stdout){let c=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(l=>l.trim()).filter(l=>l.length>0);c.length===2?P(`ipykernel version & path ${c[0]}, ${e8(c[1])} for ${a}`):P(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let c=We(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((l,u)=>u===0?l:`    ${l}`).join(`
`);U(`Stderr output when getting ipykernel version & path ${c} for ${a}`)}}async launchProcess(e,t,n,i,o){let s=On(t)?.getConnection(),a=await ar(o,this.getKernelConnection(e));s?.stop();let c=t?_e(t.fsPath):"",l=this.configService.getSettings(t),u=l.logKernelOutputSeparately||l.development?bT.window.createOutputChannel(b.kernelConsoleOutputChannel(c),"log"):void 0;u?.clear();let p=g_(a.control_port,a.hb_port,a.iopub_port,a.shell_port,a.stdin_port),m=new eb(this.processExecutionFactory,a,e,this.fs,t,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,u,l,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);Da(m.onDidDispose)(()=>p.dispose(),this,this.disposables),Da(m.exited)(()=>u?.dispose(),this,this.disposables);try{await ar(o,m.launch(n,i,o))}catch(g){throw await m.dispose(),Sn.throwIfCanceled(o),g}let h=Da(m.exited)(({exitCode:g,reason:y})=>{wt(t,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",g?{exitCode:g}:void 0,{exitReason:Qh(y)}),ra.delete(a.control_port),ra.delete(a.hb_port),ra.delete(a.iopub_port),ra.delete(a.shell_port),ra.delete(a.stdin_port),h.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await m.dispose(),new bT.CancellationError;return m}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let n=await(0,rG.promisify)((await Promise.resolve().then(()=>D(eG()))).getPorts)(5,{host:"127.0.0.1",port:e});if(n.some(i=>ra.has(i))){let i=Math.max(...ra,...n);return Fo.findNextFreePort(i)}return n.forEach(i=>ra.add(i)),n}async getConnectionPorts(){let e=await Fo.startPortPromise;return Fo.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,nG.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Fo.startPortPromise=Fo.computeStartPort(),v([Ur("Failed to capture IPyKernel version and path")],Fo.prototype,"logIPyKernelPath",1),Fo=v([(0,gs.injectable)(),d(0,(0,gs.inject)(Ui)),d(1,(0,gs.inject)(gr)),d(2,(0,gs.inject)(Ye)),d(3,(0,gs.inject)(La)),d(4,(0,gs.inject)(F)),d(5,(0,gs.inject)(Br)),d(6,(0,gs.inject)(de)),d(7,(0,gs.inject)(qr)),d(8,(0,gs.inject)(wu)),d(9,(0,gs.inject)(Dr))],Fo);var Pu=D(require("vscode"));var sb=D(O());var IT=class extends Ky{constructor(t,n,i){super("localRaw",t);this.resource=n;this.kernelConnectionMetadata=i;this.initializeKernelSocket()}get atleastOneCellExecutedSuccessfully(){return this.session.atleastOneCellExecutedSuccessfully}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(ne(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.disposeAsync().catch(f)}async disposeAsync(){await this.shutdown().catch(f).finally(()=>this.session.dispose()).finally(()=>super.dispose())}async waitForIdle(t,n){try{await Oy(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw ne("Error waiting for idle",i),await this.shutdown().catch(f),i}}async shutdown(){if(this._isDisposed)return;this._isDisposed=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;P(`Shutdown session ${t} - start called from ${new Error("").stack}`),My(this.session.kernel),await xr(1e3,this.session.shutdown().catch(f)),this.didShutdown.fire(),super.dispose(),P(`Shutdown session ${t} - shutdown complete`)}};var Ba=D(O_()),fG=D(No());var PT=D(No());var ET=D(aG()),mG=D(No());var Eu=D(Gc());var xT=D(require("os"));var cG=D(Gc()),cL=D(require("os"));var wye=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Eye=new RegExp(/^[0-9 .]*$/);async function lG(){let r={id:"",version_id:""};if(cL.platform()==="darwin"||cL.platform()==="win32")return r;try{let e=await cG.readFile("/etc/os-release","utf-8");We(e).forEach(t=>{let n=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(n||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(n)r.id=wye.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";r.version_id=Eye.test(o)?o:s.toString()}}})}catch(e){C("Failed to read distro info",e)}return r}var Pye="zeromq";function CT(){try{let r=require(Pye);return r.context.blocky=!1,lL(!1).catch(f),r}catch(r){try{let e=require(Ve(ns,"dist","node_modules","zeromqold"));return ee("ZMQ loaded via fallback mechanism."),lL(!1,!0,r.message||r.toString()).catch(f),e}catch(e){throw lL(!0,!0,r.message||r.toString(),e.message||e.toString()).catch(f),U("Exception while attempting zmq :",r.message||r),U("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function kye(){try{let r=Ve(ns,"dist","node_modules","zeromq","prebuilds");if(!await Eu.pathExists(Ve(ns,"dist","node_modules")))return;let e=await Eu.readdir(r).then(n=>n.map(async i=>{let o=Ve(r,i);return(await Eu.stat(o)).isDirectory()?Eu.readdir(o).then(a=>a.map(c=>Ve(o,c))):[]}));return(await Promise.all(e.flat())).flat().map(n=>n.substring(n.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(r){return U("Failed to determine local zmq binaries.",r),["Failed to determine local zmq binaries."]}}var uG=!1;async function lL(r,e=!1,t="",n=""){if(uG)return;uG=!0;let[i,o]=await Promise.all([lG().catch(()=>({id:"",version_id:""})),kye()]),s=Dye();N("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),N("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:n})}function pG(r){return r==="linux"&&Eu.existsSync("/etc/alpine-release")}function Dye(){try{let r=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||xT.arch(),n=process.env.npm_config_platform||xT.platform(),i=pG(n),o=process.env.LIBC||(pG(n)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":r.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(r){return U("Failed to determine platform information used to load zeromq binary.",r),{}}}function _ye(r,e){let t=r.transport==="tcp"?":":"-",n=r[`${e}_port`];if(!n)throw new Error(`Port not found for channel "${e}"`);return`${r.transport}://${r.ip}${t}${n}`}var wT=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=f;this.onerror=f;this.onclose=f;this.onmessage=f;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(n){C("Error during socket shutdown",n)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,n){let i=n();return i.connect(_ye(e,t)),this.processSocketMessages(t,i).catch(C.bind(`Failed to read messages from channel ${t}`)),i}async processSocketMessages(e,t){for await(let n of t){if(this.closed)break;this.onIncomingMessage(e,n)}}generateChannels(e){let t=CT(),n=(0,mG.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let n=this.closed?{}:ET.decode(t,this.connection.key,this.connection.signature_scheme);n.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(n);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(n,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(n,e))}fireOnMessage(e,t){if(!this.closed)try{Rye(e,t),this.onmessage({data:e,type:"message",target:this})}catch(n){C(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,n)}}sendMessage(e,t){let n=ET.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,f)))).then(async()=>{try{await this.postToSocket(e.channel,n)}catch(o){C(`Failed to write data to the kernel channel ${e.channel}`,n,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,n)});this.sendChain.catch(f)}postToSocket(e,t){let n=this.channels[e];n?n.send(t).catch(i=>{C("Error communicating with the kernel",i)}):C(`Attempting to send message on invalid channel: ${e}`)}},Tye=["username","version","session","msg_id","msg_type"],dG={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function Rye(r,e){let t=r.header;Tye.forEach(n=>{typeof t[n]!="string"&&(t[n]="")}),typeof r.channel!="string"&&(r.channel=e),r.content||(r.content={}),r.metadata||(r.metadata={}),r.channel==="iopub"&&Aye(r)}function Aye(r){if(r.channel!=="iopub")return;let e=r.header.msg_type;if(e in dG){let t=dG[e];if(t===void 0)return;let n=Object.keys(t),i=r.content;for(let o=0;o<n.length;o++){let s=t[n[o]];Array.isArray(s)||(s=[s]);let a=n[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var yd=D(O_()),bd=require("vscode");var uL,kT=class{constructor(e,t,n,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=n;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new yd.Signal(this);this.connectionStatusChanged=new yd.Signal(this);this.iopubMessage=new yd.Signal(this);this.unhandledMessage=new yd.Signal(this);this.anyMessage=new yd.Signal(this);this.disposed=new yd.Signal(this);this.id=(0,PT.default)();this.clientId=(0,PT.default)();this.username=(0,PT.default)();this.infoDeferred=le();this.name=xg(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new bd.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],n=_g(e);t.push(n);let i;try{let o=this.kernelProcess;this.kernelProcess=void 0,o?.dispose()?.catch(f),Wn(()=>this.socket?.dispose()),Wn(()=>this.realKernel?.dispose());let s=this.kernelProcess=await ht.wrapAndReportProgress(this.resource,b.connectingToKernel(mt(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new bd.CancellationError;this.hookupKernelProcessExitHandler(s);let a=Mye(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=a.kernelProcess,this.realKernel=a.realKernel,this.socket=a.socket,a.realKernel.info.then(l=>this.infoDeferred.resolve(l),l=>this.infoDeferred.reject(l)),zt(this.kernelProcess.exited)(l=>{i=new il(l.exitCode||-1,l.stderr,this.kernelConnectionMetadata),n.cancel()},this,t);let c=setTimeout(()=>n.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(c)}),await ht.wrapAndReportProgress(this.resource,b.waitingForJupyterSessionToBeIdle,()=>{let l=On(this.resource)?.kernelReady();return Nye(n.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,a.realKernel).finally(()=>l?.stop())}),i)throw i;if(e.isCancellationRequested)throw new bd.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(o){throw await Promise.all([this.kernelProcess?.dispose().catch(f),this.realKernel?.shutdown().catch(s=>U(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,s))]),i||(fr(o)&&n.token.isCancellationRequested&&!e.isCancellationRequested?new tf(this.kernelConnectionMetadata):(fr(o)||e.isCancellationRequested?P("Starting of raw session cancelled by user"):C(`Failed to connect raw kernel session: ${o}`),o))}finally{z(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(n=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(C(`Disposing session as kernel process died ExitCode: ${n.exitCode}, Reason: ${n.reason}`),wt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",n.exitCode?{exitCode:n.exitCode}:void 0,{exitReason:Qh(n.reason)}),this.shutdown().catch(f))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),yd.Signal.disconnectAll(this)}).catch(f))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),My(this.realKernel),await this.kernelProcess?.dispose().catch(f),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}clone(e){return this}get spec(){if(Cg(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return C("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,n){return this.realKernel.sendShellMessage(e,t,n)}sendControlMessage(e,t,n){return this.realKernel.sendControlMessage(e,t,n)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){ee("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(n=>C("Failed to interrupt via a message",n))}else C("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,n){return this.realKernel.requestExecute(e,t,n)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e){return this.realKernel.sendInputReply(e)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function Nye(r,e,t,n,i){try{P("Waiting for Raw Session to be ready in postStartRawSession"),await ar(r,Oye(i,n,e)),P("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw C("Failed waiting for Raw Session to be ready",u),fr(u)||r.isCancellationRequested?new bd.CancellationError:u}P(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=le(),s=le(),a=()=>o.resolve(!0);o.promise.catch(f),s.promise.catch(f),i.iopubMessage.connect(a);let c=()=>{let p=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(p,!0,!0).done.then(()=>s.resolve(!0)).catch(f)},l=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(f)};try{let u=new Ge,p=0;for(;u.elapsedTime<e*1e3;){p+=1;try{P("Sending request for kernelInfo"),c(),l(),await ar(r,Promise.all([o.promise,s.promise]),Di(Math.min(e,500)).then(f))}catch(m){throw C("Failed to request kernel info",m),m}if(o.completed&&s.completed){P("Got response for requestKernelInfo");break}else{P("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?P(`Successfully completed postStartRawSession after ${p} attempt(s) in ${u.elapsedTime}ms`):U(`Didn't get response for requestKernelInfo after ${p} attempt(s) in ${u.elapsedTime}ms.`),wt(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:p},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function Mye(r,e,t,n){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends wT{constructor(){super(r.connection,o.serialize),s=this}}let c=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW"});uL||(uL=require("@jupyterlab/services/lib/kernel/nonSerializingKernel"));let l=new uL.KernelConnection({serverSettings:c,clientId:e,handleComms:!0,username:t,model:n});return bd.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&l.anyMessage.connect((u,p)=>{P(`[AnyMessage Event] [${p.direction}] [${r.pid}] ${JSON.stringify(p.msg)}`)}),co.set(l.id,s),s.emit("open"),{realKernel:l,socket:s,kernelProcess:r}}async function Oye(r,e,t){P(`Waiting for Raw session to be ready, status: ${r.connectionStatus}`);let n=le(),i=(s,a)=>{a=="connected"?(P("Raw session connected"),n.resolve(a)):P(`Raw session not connected, status: ${a}`)};r.connectionStatusChanged.connect(i),r.connectionStatus==="connected"&&(P("Raw session connected"),n.resolve(r.connectionStatus)),P("Waiting for Raw session to be ready");let o=await xr(t,n.promise);if(r.connectionStatusChanged.disconnect(i),P(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new tf(e)}var DT=class{constructor(e,t,n,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new Ba.Signal(this);this.kernelChanged=new Ba.Signal(this);this.terminated=new Ba.Signal(this);this.iopubMessage=new Ba.Signal(this);this.unhandledMessage=new Ba.Signal(this);this.anyMessage=new Ba.Signal(this);this.disposed=new Ba.Signal(this);this.connectionStatusChanged=new Ba.Signal(this);this.propertyChanged=new Ba.Signal(this);this._didShutDownOnce=!1;this.id=(0,fG.default)(),this.name=xg(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new kT(e,t,n,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this)}get atleastOneCellExecutedSuccessfully(){return this.cellExecutedSuccessfully===!0}get jupyterLabServices(){return this._jupyterLabServices||(this._jupyterLabServices=require("@jupyterlab/services")),this._jupyterLabServices}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await ao(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;wt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(f).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),Ba.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>U(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){ne(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){!this.cellExecutedSuccessfully&&t.header.msg_type==="execute_result"&&t.content&&(this.jupyterLabServices.KernelMessage.isExecuteResultMsg(t)||this.jupyterLabServices.KernelMessage.isExecuteInputMsg(t))&&t.content.execution_count&&(this.cellExecutedSuccessfully=!0),this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var ob=class{constructor(e,t,n){this.configService=e;this.kernelLauncher=t;this.fs=n}async create(e){P(`Creating raw notebook for resource '${B(e.resource)}'`);let t,n=On(e.resource)?.computeCwd(),[i,o]=await Promise.all([ar(e.token,yC(e.resource).then(a=>Pu.Uri.file(a))),yt(e.kernelConnection)?ar(e.token,Kye(e.resource,this.configService,this.fs).then(a=>a?Pu.Uri.file(a):void 0)):void 0,ar(e.token,ao(e.resource,{kernelConnection:e.kernelConnection}))]);n?.stop();let s=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new DT(e.resource,this.kernelLauncher,o||i,e.kernelConnection,s,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await ar(e.token,t.startKernel(e))}catch(a){throw fr(a)||e.token.isCancellationRequested?P("Starting of raw session cancelled by user"):C(`Failed to connect raw kernel session: ${a}`),t?.shutdown().catch(c=>C(`Failed to dispose of raw session on launch error: ${c} `)).finally(()=>t?.dispose()).catch(f),a}return new IT(t,e.resource,e.kernelConnection)}};ob=v([(0,sb.injectable)(),d(0,(0,sb.inject)(de)),d(1,(0,sb.inject)(e_)),d(2,(0,sb.inject)(ut))],ob);async function Kye(r,e,t){let n=await Fye(r,e,t);if(n&&await t.exists(n))return n.fsPath;if(r&&r.scheme!=="untitled"&&await t.exists(r)&&(n=Pu.Uri.file(CP(Ae(n),r,e.getSettings(r))),n&&await t.exists(n)))return n.fsPath}async function Fye(r,e,t){let n,i=e.getSettings(r),o=JJ(i.notebookFileRoot);if(o&&Pu.workspace.workspaceFolders?.length){let s=Pu.Uri.file(o),a=Pu.workspace.workspaceFolders[0].uri;if(cE(o))await t.exists(s)?n=s:n=a;else if(o.includes("${"))n=s;else{let c=Pu.Uri.joinPath(a,o);await t.exists(c)?n=c:n=a}}return n}var _T=D(O());var ab=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{CT(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};ab=v([(0,_T.injectable)(),d(0,(0,_T.inject)(de))],ab);var ku=D(O()),hG=require("vscode");var jn=Symbol("IJupyterVariables"),TT=Symbol("IKernelVariableRequester");var Sf=class{constructor(e,t,n){this.kernelVariables=t;this.debuggerVariables=n;this.refreshEventEmitter=new hG.EventEmitter;e.push(n.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,n,i){return this.variableHandler.getAllVariableDiscriptions(e,t,n,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,n){return this.variableHandler.getMatchingVariable(e,t,n)}async getDataFrameInfo(e,t,n,i){return this.variableHandler.getDataFrameInfo(e,t,n,i)}async getVariableValueSummary(e,t,n){return this.variableHandler.getVariableValueSummary(e,t,n)}async getDataFrameRows(e,t,n,i,o){return this.variableHandler.getDataFrameRows(e,t,n,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};v([mr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],Sf.prototype,"getVariables",1),Sf=v([(0,ku.injectable)(),d(0,(0,ku.inject)(F)),d(1,(0,ku.inject)(jn)),d(1,(0,ku.named)(Qe.KERNEL_VARIABLES)),d(2,(0,ku.inject)(jn)),d(2,(0,ku.named)(Qe.DEBUGGER_VARIABLES))],Sf);var Du=D(O()),RT=require("vscode");function fl(r){if(typeof r!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof r}\``);var e=vG();let t=e;return t.default&&(t=t.default),r.replace(t(),"")}var Lye=/Type:\s*(\w+)/,Uye=/Value:\s*(.*)/,jye=/String form:\s*([\s\S]+?)\n/,Wye=/Docstring:\s*(.*)/,Vye=/Length:\s+(.*)/,Bye=/^\s+\[(\d+) rows x (\d+) columns\]/m,qye=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),cb=class{constructor(e,t,n,i){this.configService=e;this.disposables=n;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new RT.EventEmitter;this.variableRequesters.set(xe,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,n,i){let o=Co(e.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,n,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,n){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,n)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,n);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,size:0,count:0,shape:"",truncated:!0},t,n)}}}async getVariableValueSummary(e,t,n){if(!t)return;let i=Co(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);if(o)return o.getVariableValueSummary(e,t,n)}async getDataFrameInfo(e,t,n,i){if(!t)return e;let o=Co(t?.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return n&&(a=`${e.name}${n}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,n,i,o){let s=Co(i?.kernelConnectionMetadata)||xe,a=this.variableRequesters.get(s);if(a){let c=e.name;return o&&(c=`${e.name}${o}`),a.getDataFrameRows(t,n,i,c)}return{data:[]}}async getFullVariable(e,t,n){let i=Co(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,n):e}async getVariablesBasedOnKernel(e,t){let n=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!n||!i&&(n.currentExecutionCount!==t.executionCount||n.currentExecutionCount!==o.executionCount))&&(n={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(c=>({name:c.name,value:void 0,supportsDataExplorer:!1,type:c.type,size:0,shape:"",count:0,truncated:!0,fileName:e.notebook.uri}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(n){let c=t.sortColumn,l=(m,h)=>{let g=m[c]?m[c]:"",y=h[c]?h[c]:"";return t.sortAscending?g.localeCompare(y,void 0,{sensitivity:"base"}):y.localeCompare(g,void 0,{sensitivity:"base"})};n.variables.sort(l);let u=t.startIndex?t.startIndex:0,p=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let m=u;m<u+p&&m<n.variables.length;){if(s&&s.indexOf(n.variables[m].type)>=0){n.variables.splice(m,1);continue}let h=typeof n.variables[m].value=="string"?n.variables[m]:await this.getVariableValueFromKernel(n.variables[m],e);n.variables[m]=h,a.pageResponse.push(h),m+=1}this.cachedVariables.set(e.uri.toString(),n),a.totalCount=n.variables.length}return a}async getVariableProperties(e,t,n){let i=await this.getMatchingVariable(e,t,n),o=Co(t.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,n,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let n=Co(e.kernelConnectionMetadata)||xe,i=this.variableRequesters.get(n);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,n=0,i){let o=le();try{e.requestInspect({code:t,cursor_pos:n,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new RT.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,n){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,n);if(o&&o.hasOwnProperty("text/plain")){let s=fl(o["text/plain"].toString()),a=Lye.exec(s),c=Vye.exec(s),l=Bye.exec(s);a&&(i.type=a[1]),i.value=[Uye,jye,Wye].reduce((u,p)=>u||p.exec(s)?.[1]||"",""),c&&(i.count=parseInt(c[1],10)),l&&(i.shape=`(${l[1]}, ${l[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),qye.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&It(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};cb=v([(0,Du.injectable)(),d(0,(0,Du.inject)(de)),d(1,(0,Du.inject)(TT)),d(1,(0,Du.named)(Qe.PYTHON_VARIABLES_REQUESTER)),d(2,(0,Du.inject)(F)),d(3,(0,Du.inject)(Ke))],cb);var hl=D(O());var lb=class{constructor(e,t,n,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=n;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(f))),this.preWarmInterpreterVariables().catch(f),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(f),this.condaService.getCondaVersion().catch(f))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(f)}};lb=v([(0,hl.injectable)(),d(0,(0,hl.inject)(js)),d(1,(0,hl.inject)(yi)),d(2,(0,hl.inject)(F)),d(3,(0,hl.inject)(Ye)),d(4,(0,hl.inject)(tr)),d(5,(0,hl.inject)(bi)),d(6,(0,hl.inject)($s))],lb);var db=D(O());var ub=class extends et{constructor(){super("unknown",b.jupyterDataRateExceeded)}};function pL(r){let e=r.index,t=r.columns;return{data:r.data.map((o,s)=>{let a={index:e[s]};return t.forEach((c,l)=>{a[c]=o[l]}),a})}}async function AT(r,{code:e,initializeCode:t,cleanupCode:n},i){if(r.disposed||r.disposing||!r.session?.kernel||!r.session.kernel||r.session.isDisposed)return[];try{return t&&await In(r.session.kernel,t,i),await In(r.session.kernel,e,i)}catch(o){if(o instanceof bn)return[];throw o}finally{n&&await In(r.session.kernel,n,i)}}var pb=class{constructor(e,t,n){this.varScriptGenerator=e;this.dfScriptGenerator=t;this.backgroundThreadService=n}async getDataFrameInfo(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:n}),a=await AT(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),c=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:c}}async getDataFrameRows(e,t,n,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),c=await AT(n,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return c.length===0?{data:[]}:pL(this.deserializeJupyterResult(c))}async getVariableProperties(e,t,n){let i={};return n&&n.value&&(i[`${e}`]=n.value),i}async getVariableValueSummary(e,t,n){let i=await this.varScriptGenerator.generateCodeToGetVariableValueSummary(e.name);try{return(await this.backgroundThreadService.execCodeInBackgroundThread(t,i.split(/\r?\n/),n))?.summary}catch(o){U(`Exception when getting variable summary for variable "${e.name}": ${o.message}`);return}}async getAllVariableDiscriptions(e,t,n,i){if(!e.session)return[];let o=t?{root:t.root,propertyChain:t.propertyChain,startIndex:n}:void 0,s=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions(o),a=await this.backgroundThreadService.execCodeInBackgroundThread(e,s.split(/\r?\n/),i);if(e.disposed||e.disposing||i?.isCancellationRequested||!a)return[];try{return a}catch(c){return C(c),[]}}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:n,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await AT(e,{code:n,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),c=[];for(let[l,u]of Object.entries(a)){let p={name:l,value:void 0,supportsDataExplorer:!1,type:u||"",size:0,shape:"",count:0,truncated:!0};c.push(p)}return c}return[]}async getFullVariable(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await AT(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let n=t.text;if(n.includes("iopub_data_rate_limit"))throw new ub;{let i=b.jupyterGetVariablesExecutionError(n);throw C(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let n=t.data;if(n&&n.hasOwnProperty("text/plain"))return n["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(fl).join(`\r
`),o=b.jupyterGetVariablesExecutionError(i);throw C(o),new Error(o)}}throw new Error(b.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};pb=v([(0,db.injectable)(),d(0,(0,db.inject)(Kh)),d(1,(0,db.inject)(Fh)),d(2,(0,db.inject)(HP))],pb);var xf=D(O());var bG=require("vscode");var yG=1e3*60*60*24*2,qa=class extends or{constructor(t,n,i,o){super();this.serverStorage=n;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=bG.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,n){if(t.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,n){if(!Ft(n.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,c)=>{if(c.direction==="send"){let l=c.msg;if(l.header.msg_type==="execute_request"&&l.metadata&&typeof l.metadata=="object"&&l.metadata&&"cellId"in l.metadata&&typeof l.metadata.cellId=="string"&&l.metadata.cellId===t.document.uri.toString()){let u=l.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:n.session?.kernel?.id||"",cellIndex:t.index})}}else if(c.direction==="recv"){let l=c.msg,u=this.executedCells.get(t);if(u?.msg_id&&Iu(l)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(l.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in l.content&&typeof l.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==l.content.execution_count&&(u.executionCount=l.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,n,u),z(i))}}},s=()=>{let a=n.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>Wn(()=>a.anyMessage?.disconnect(o))}))};n.onStarted(()=>s(),i),n.session&&s()}deleteTrackedCellExecution(t,n){t.notebook.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,n,i){if(!i.executionCount||!i.msg_id||!i.startTime||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:n.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Vt(n.kernelConnectionMetadata.serverProviderHandle),sessionId:n.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let c=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(c.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let n={};try{let s=await this.fs.readFile(this.storageFile);n=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Vt(s)));Object.keys(n).forEach(s=>{let a=n[s];(o.has(a.serverId)||Date.now()-a.startTime>yG)&&(delete n[s],i=!0)}),i&&(this.removeOldItems(n),this.staleState=n,await this.fs.writeFile(this.storageFile,JSON.stringify(n)))}))}removeOldItems(t){Object.keys(t).forEach(n=>{let i=t[n];i&&Date.now()-i.startTime>yG&&delete t[n]})}};qa=v([(0,xf.injectable)(),d(0,(0,xf.inject)(F)),d(1,(0,xf.inject)(Zt)),d(2,(0,xf.inject)(lt)),d(3,(0,xf.inject)(ut))],qa);var fb=D(O());var $C=require("vscode");var mb=class{constructor(e,t,n){this.serverUriStorage=e;this.registrations=t;this.disposables=n}activate(){this.disposables.push($C.commands.registerCommand($.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(f),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===Je).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new $C.CancellationTokenSource,n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((n||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(f)))})).catch(f),await $C.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(f,f)},this))}};mb=v([(0,fb.injectable)(),d(0,(0,fb.inject)(Zt)),d(1,(0,fb.inject)(Qt)),d(2,(0,fb.inject)(F))],mb);var NT=D(O());var hb=class{constructor(e){this.registry=e;this.priority=0}activate(){this.registry.register(this,_t),this.registry.register(this,xt)}async getCode(e){return It(e.kernelConnectionMetadata)?[V9]:[]}};hb=v([(0,NT.injectable)(),d(0,(0,NT.inject)($l))],hb);function IG(r,e){r.addSingleton(Ie,oy),r.addSingleton(Ie,cy),r.addSingleton(bi,ab),r.addSingleton(cs,cs),r.addSingleton(t_,ob),r.addSingleton(e_,Fo),r.addSingleton(La,La),r.addSingleton(Or,Wy),r.addSingleton(Ie,bf),r.addSingleton(Ie,sy),r.addSingleton(qr,qr),r.addSingleton(gd,dl),r.addSingleton(fs,fs),r.addBinding(fs,Ie),r.addSingleton(xu,xu),r.addSingleton(Ie,Qy),r.addSingleton(Ie,lb),r.addSingleton(jn,Sf,Qe.ALL_VARIABLES),r.addSingleton(jn,cb,Qe.KERNEL_VARIABLES),r.addSingleton(TT,pb,Qe.PYTHON_VARIABLES_REQUESTER),r.addSingleton(Ls,dd),r.addSingleton(Ie,vf),r.addSingleton(Ie,Hy),r.addSingleton(Ie,Uy),r.addSingleton(Ie,jy),r.addSingleton(Ie,zy),r.addSingleton(Ke,Jy),r.addSingleton(Pm,$y),r.addSingleton(Ie,mb),r.addSingleton(qa,qa),r.addBinding(qa,Ie),NH(r,e),Xh("isInsiderExtension",vh()?"true":"false");let t=r.get(Ye);Xh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let n=r.get(bi);Xh("rawKernelSupported",n.isSupported?"true":"false"),r.addSingleton(Ie,rn),r.addSingleton($l,Gy),r.addSingleton(wu,wu),r.addSingleton(Ie,hb)}var Id=D(O()),Cf=require("vscode");var gb=class{constructor(e,t,n,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=n;this.pythonApi=i;this.errorHandler=o}activate(){this.disposables.push(Cf.commands.registerCommand($.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(Cf.commands.registerCommand($.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}async installPythonViaKernelPicker(){N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[ve.install,ve.reload]:[ve.install],t=await Cf.window.showErrorMessage(b.pythonNotInstalled,{modal:!0},...e);t===ve.install?(this.installedOnceBefore=!0,N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await Cf.commands.executeCommand("python.installPython")):t===ve.reload?(N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await Cf.commands.executeCommand("jupyter.reloadVSCode",b.reloadRequired)):N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(b.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",n=await xr(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&n===t)return P("Python Extension installed via Kernel Picker command"),N("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;C("Failed to install Python Extension via Kernel Picker command"),N("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(b.failedToInstallPythonExtension)).then(f,f)}finally{e.dispose()}}}};gb=v([(0,Id.injectable)(),d(0,(0,Id.inject)(F)),d(1,(0,Id.inject)(Ye)),d(2,(0,Id.inject)(ss)),d(3,(0,Id.inject)(tr)),d(4,(0,Id.inject)(en))],gb);var vb=D(O()),Ef=require("vscode");var wf=class{constructor(e,t,n){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=n}activate(){Ef.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),Ef.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!Nt(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e);if(!t)return;let n=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(f),!0):!1};if(n())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&n()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){P(`Using notebook.selectKernel to force remote kernel for ${B(e.uri)} to ${t.id}`),await Ef.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:Je}),await Yw(async()=>{if(Ef.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(f),!0}return!1},2e3,100)?P(`Successfully switched remote kernel for ${B(e.uri)} to ${t.id}`):U(`Failed to switch remote kernel for ${B(e.uri)} to ${t.id}`)}};v([Ur()],wf.prototype,"onDidOpenNotebook",1),wf=v([(0,vb.injectable)(),d(0,(0,vb.inject)(F)),d(1,(0,vb.inject)(St)),d(2,(0,vb.inject)(cs))],wf);var bb=D(O()),xd=require("vscode");var Uo=require("vscode");var GC=D(O()),PG=require("vscode");var dL=D(No()),CG=require("vscode");function SG(r){if(!r||!Array.isArray(r)||r.length===0)return;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=Array.apply(null,new Uint8Array(n.buffer));e.push({...n,byteLength:n.byteLength,byteOffset:n.byteOffset,buffer:i})}else e.push([...new Uint8Array(n)])}return e}function xG(r){if(!Array.isArray(r)||r.length===0)return r;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=new Uint8Array(n.buffer).buffer,o=new DataView(i,n.byteOffset,n.byteLength);e.push(o)}else{let i=new Uint8Array(n).buffer;e.push(i)}}return e}var HC=new WeakMap;function wG(r,e){let t=HC.get(r);t&&(t.targets.add(e),t.registerCommTarget(e))}function EG(r,e){HC.get(r)?.targets?.delete?.(e)}var MT=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new CG.EventEmitter;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.totalWaitTime=0;this.totalWaitedMessages=0;this.hookCount=0;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let n=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=n.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.sendOverheadTelemetry(),this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?C(`Widget Error: ${t.message}`):P(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(xG(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e))}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let n=t?co.get(t):void 0;if(n?.removeReceiveHook(this.onKernelSocketMessage),n?.removeSendHook(this.mirrorSend),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(s=>s.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(s=>s.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!co.get(e.session?.kernel?.id))return;HC.has(e.session.kernel)||HC.set(e.session.kernel,{targets:new Set,registerCommTarget:s=>{this.raisePostMessage("IPyWidgets_registerCommTarget",s)}}),this.kernelWasConnectedAtLeastOnce=!0;let i=e.session.kernel?.id,o=i?co.get(i):void 0;o?.addReceiveHook(this.onKernelSocketMessage),o?.addSendHook(this.mirrorSend),this.sendKernelOptions(),this.registerCommTargets(e),this.sendPendingMessages()}sendKernelOptions(){this.kernel?.session?.kernel&&this.raisePostMessage("IPyWidgets_kernelOptions",{id:this.kernel?.session?.kernel?.id||"",clientId:this.kernel?.session?.kernel?.clientId||"",userName:this.kernel?.session?.kernel?.username||"",model:this.kernel?.session?.kernel?.model||{id:"",name:""}})}async mirrorSend(e,t){if(typeof e=="string"&&e.includes("shell")&&e.includes("execute_request")){let n=Date.now(),i=this.deserialize(e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!G_(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o,this.totalWaitTime=Date.now()-n,this.totalWaitedMessages+=1}}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=le();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e){let t=(0,dL.default)(),n=le();if(this.waitingMessageIds.set(t,{startTime:Date.now(),resultPromise:n}),typeof e=="string"?G_(e)&&this.raisePostMessage("IPyWidgets_msg",{id:t,data:e}):this.raisePostMessage("IPyWidgets_binary_msg",{id:t,data:SG([e])}),typeof e!="string"||e.includes(zi)||e.includes(Qe.DefaultCommTarget)||e.includes("comm_open")||e.includes("comm_close")||e.includes("comm_msg")){let o=this.deserialize(e);if(!G_(o))return;o&&o.content&&o.content.data&&(o.content.data[zi]||o.content.target_name===Qe.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let s=o.header?.msg_type==="comm_open"&&o.content?.data?.state?._model_module==="@jupyter-widgets/output"&&o.content?.data?.state?._model_name==="OutputModel",a=o.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(o.content?.comm_id);s?this.outputWidgetIds.add(o.content.comm_id):a?this.outputWidgetIds.delete(o.content.comm_id):this.messageNeedsFullHandle(o)&&(this.fullHandleMessage={id:o.header.msg_id,promise:le()},await n.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),this.totalWaitTime+=Date.now()-t.startTime,this.totalWaitedMessages+=1,t.resultPromise.resolve())}sendPendingMessages(){if(this.kernel?.session?.kernel)for(;this.pendingMessages.length;)try{let e=this.pendingMessages[0],t=typeof e=="string"?JSON.parse(e):this.deserialize(e);t.buffers?.length&&(t.buffers=t.buffers.map(n=>n instanceof DataView?n.buffer:n)),t.channel==="control"?this.kernel.session.kernel.sendControlMessage(t):this.kernel.session.kernel.sendShellMessage(t),this.pendingMessages.shift()}catch(e){C("Failed to send message to Kernel",e);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let n=Array.from([...this.pendingTargetNames.values()]).shift();if(n){if(this.commTargetsRegistered.has(n))return;P(`Registering commtarget ${n}`),this.commTargetsRegistered.add(n),this.pendingTargetNames.delete(n),e.session?.kernel&&n!==Qe.DefaultCommTarget&&!HC.get(e.session.kernel)?.targets?.has(n)&&e.session.kernel.registerCommTarget(n,f)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){this.hookCount+=1;let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=le(),n=(0,dL.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(n,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:n,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}sendOverheadTelemetry(){N("DS_INTERNAL.IPYWIDGET_OVERHEAD",{totalOverheadInMs:this.totalWaitTime,numberOfMessagesWaitedOn:this.totalWaitedMessages,averageWaitTime:this.totalWaitTime/this.totalWaitedMessages,numberOfRegisteredHooks:this.hookCount})}};var mL=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new PG.EventEmitter;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},_u=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new MT(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let n=[];e&&this.messagesPerNotebook.get(e)&&(n=this.messagesPerNotebook.get(e)||[]);let i=new mL(t,n);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,n=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),n?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};_u=v([(0,GC.injectable)(),d(0,(0,GC.inject)(F)),d(1,(0,GC.inject)(Ke))],_u);var DG=require("vscode");var kG=require("vscode");var yb=class yb extends or{constructor(t,n,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=n;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(c=>this._register(c)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(n=>n.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async n=>{n.getWidgetScriptSources&&t.push(...await n.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,n){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let c=await a.getWidgetScriptSource(t,n,i);if(c.scriptUri){s=c;break}else U(`Widget Script Source not found for ${t}@${n} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,n,"",s.source).catch(f),s.scriptUri?P(`Script source for Widget ${t}@${n} was found from source ${s.source} and ${s.scriptUri}`):C(`Script source for Widget ${t}@${n} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,n,i,o){let s=`${t}.${t}@${n}`;if(yb.trackedWidgetModuleNames.has(s))return;yb.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),c=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),l=c?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=c?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;N("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await vt(t),moduleName:l,modelName:u,source:o,moduleVersion:c?n:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new kG.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,n){if(n.direction==="recv"&&n.msg.header.msg_type==="comm_open"){let o=n.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(f)}}};v([Ur()],yb.prototype,"sendTelemetryForWidgetModule",1),v([Ur()],yb.prototype,"onAnyMessage",1);var KT=yb;var FT=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var LT=class{constructor(e,t,n,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new DG.EventEmitter;this.disposables=[];this.isWebViewOnline=le();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new wo;this.uriConverter=new FT(ln(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,le()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(f),n.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let n=t;n&&this.uriTranslationRequests.has(n.request)&&this.uriTranslationRequests.get(n.request).resolve(n.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(f);else if(e==="IPyWidgets_IsOnline"){let n=t.isOnline;this.isWebViewOnline.resolve(n)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(f)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new KT(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),P("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>C("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){U("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:n,requestId:i}=e;if(ee(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,n,i).catch(o=>C("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,n,i).catch(C.bind(void 0,"Failed to send widget sources upon ready"))}}async sendWidgetSource(e,t="*",n){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:n});return}let i={moduleName:e,requestId:n};try{ee(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){C("Failed to get widget source due to an error",o),N("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{ee(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:n,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,n,i).catch(C.bind(`Failed to send WidgetScript for ${t}`))}}}};var jT=Symbol("IWidgetScriptSourceProviderFactory"),WT=Symbol("INbExtensionsPathProvider"),VT=Symbol("IIPyWidgetScriptManagerFactory"),Hct=Symbol("IIPyWidgetScriptManager");var Pf=D(O()),Lo=require("vscode");var RG="https://unpkg.com/",hL="https://cdn.jsdelivr.net/npm/",BT="IPYWidgetCDNConfigured",_G="IPYWidgetNotFoundOnCDN",TG="IPYWidgetNoNetWorkAccess";function $ye(r,e,t){let n=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),n=e.substr(0,o)),r===hL&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${r}${n}@${t}/dist/${i}`}function Hye(r){switch(r){case"unpkg.com":return RG;case"jsdelivr.com":return hL;default:break}}var Ja=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let n=(async()=>{let i=new nl,o=Es(i.exists(`${RG}${e}`)),s=Es(i.exists(`${hL}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return n.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(f,f),this.isOnCDNCache.set(t,n),n}async getWidgetScriptSource(e,t,n){if(n===!1)return ne(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(f),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(BT,!1))return ne("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,n){let i=Hye(n);if(i)return $ye(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(ee(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(ee(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(C(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(f),{moduleName:e})}async getValidUri(e,t,n){try{let i=await this.generateDownloadUri(e,t,n),o=new nl;if(i&&await o.exists(i))return i}catch{P(`Failed downloading ${e}:${t} from ${n}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(TG,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Lo.window.showWarningMessage(b.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),ve.ok,ve.doNotShowAgain,ve.moreInfo)){case ve.doNotShowAgain:return this.globalMemento.update(TG,!0);case ve.moreInfo:return Lo.env.openExternal(Lo.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(BT,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=le(),N("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await Lo.window.showInformationMessage(b.useCDNForWidgetsNoInformation,{modal:!0},ve.ok,ve.doNotShowAgain,ve.moreInfo),t="dismissed";switch(e){case ve.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(BT,!0)]);break}case ve.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(BT,!0)]);break}case ve.moreInfo:{Lo.env.openExternal(Lo.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===ve.cancel?"cancel":"dismissed";break}N("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){let t="widgetScriptSources";await this.configurationSettings.updateSetting(t,e,void 0,Lo.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(_G,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Lo.window.showWarningMessage(b.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),ve.ok,ve.doNotShowAgain,ve.reportThisIssue)){case ve.doNotShowAgain:return this.globalMemento.update(_G,!0);case ve.reportThisIssue:return Lo.env.openExternal(Lo.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};Ja=v([(0,Pf.injectable)(),d(0,(0,Pf.inject)($e)),d(0,(0,Pf.named)(gt)),d(1,(0,Pf.inject)(de))],Ja);var zC=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new Uo.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(F),this.jupyterOutput=this.serviceContainer.get($o,zu),this.configService=this.serviceContainer.get(de),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(ne(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(f,f)}},this,this.disposables);let t=le(),n=async()=>{let i=new Ge;if(!t.completed){let s=[],a=this.serviceContainer.get(Ke),c=le();a.get(this.document)?c.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&c.resolve(u)},this,s);let l=await c.promise;l&&(It(l.kernelConnectionMetadata)?l.ipywidgetsVersion?t.completed||t.resolve(l.ipywidgetsVersion):l.onIPyWidgetVersionResolved(()=>{l.ipywidgetsVersion&&(t.completed||t.resolve(l.ipywidgetsVersion),z(s))},this,s):t.completed||t.resolve(jS)),s.length&&this.disposables.push(...s)}let o=await t.promise;P(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(f,f)};e.onDidReceiveMessage(async i=>{ne(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await n(),i.type==="IPyWidgets_Window_Alert"&&Uo.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&Uo.env.openExternal(Uo.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(P("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(f,f),n().catch(f)}onMessage(e,t,n){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(n).catch(f):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,n).catch(f):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(n).catch(f):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(n):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(n),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:n}),this.getIPyWidgetScriptSource().onMessage(t,n)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(f,f)}initialize(){this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{N("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await vt(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let n=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)n=b.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),Uo.window.showErrorMessage(n).then(f,f);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=ve.moreInfo,c=b.enableCDNForWidgetsButton;n=b.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),Uo.window.showErrorMessage(n,{modal:!0},c,a).then(l=>{switch(l){case a:Uo.env.openExternal(Uo.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case c:this.enableCDNForWidgets(e).catch(f);break;default:break}},f)}C(`Widget load failure ${n}`,i,t),N("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await vt(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await Uo.commands.executeCommand($.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{N("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await vt(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{C("Error rendering a widget: ",e),N("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(fl)}ee(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(b.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),N("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(_u).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new LT(this.document,this.serviceContainer.get(Ke),this.serviceContainer.get(F),this.serviceContainer.get(de),this.serviceContainer.get(jT),this.serviceContainer.get(Ja)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){ne("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};v([Ur()],zC.prototype,"enableCDNForWidgets",1);var gL=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new xd.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){z(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},Sd=class{constructor(e,t,n){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=n;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){xd.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),xd.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),xd.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>{let i=this.notebookCommunications.get(n);this.notebookCommunications.delete(n),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(n),i&&i.dispose())}),t?.dispose()),xd.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>this.initializeNotebookCommunication(n,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!Nt(e.notebook))return;let n=e.notebook;if(!t){P(`No controller, hence notebook communications cannot be initialized for editor ${B(e.notebook.uri)}`);return}if(this.notebookCommunications.has(e))return;let i=new gL(e,t);this.addNotebookDisposables(n,[i]),this.notebookCommunications.set(e,i);let o=this.messageCoordinators.get(n);o||(o=new zC(n,this.serviceContainer),this.messageCoordinators.set(n,o)),o.attach(i)}addNotebookDisposables(e,t){let n=this.notebookDisposables.get(e)||[];n.push(...t),this.notebookDisposables.set(e,n)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let n=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,n)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];z(this.notebookDisposables.get(e)||[]),t.forEach(n=>this.notebookCommunications.get(n)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};Sd=v([(0,bb.injectable)(),d(0,(0,bb.inject)(pt)),d(1,(0,bb.inject)(F)),d(2,(0,bb.inject)(St))],Sd);var Cd=D(O());var Ib=class{constructor(e,t,n,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=n;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:n}){t.isClosed||(n.connection.kind==="connectToLiveRemoteKernel"&&n.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id)),yt(n.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(f))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let n=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(P(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(f),this.liveKernelTracker.trackKernelIdAsUsed(t,n,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};Ib=v([(0,Cd.injectable)(),d(0,(0,Cd.inject)(F)),d(1,(0,Cd.inject)(Ke)),d(2,(0,Cd.inject)(St)),d(3,(0,Cd.inject)(_m)),d(4,(0,Cd.inject)(cs))],Ib);var Df=D(O());var AG=require("vscode");var kf=class{constructor(e,t,n,i){this.disposables=e;this.uriStorage=t;this.controllers=n;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(n=>this.checkExpiredServersInJupyterCollection(n)),t.forEach(n=>this.removeControllersBelongingToDisposedProvider(n.extensionId,n.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(f),this,this.disposables));let t=new AG.CancellationTokenSource;this.disposables.push(t);try{let n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(n||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,n){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{n.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;yt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||n.includes(s.serverProviderHandle.handle)||(U(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(n=>{let i=n.connection;yt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(U(`Deleting controller ${n.id} as it is associated with a Provider Id that has been removed`),n.dispose())})}};v([Ur("Failed to check what servers were shutdown in Controller Watcher")],kf.prototype,"checkExpiredServersInJupyterCollection",1),kf=v([(0,Df.injectable)(),d(0,(0,Df.inject)(F)),d(1,(0,Df.inject)(Zt)),d(2,(0,Df.inject)(St)),d(3,(0,Df.inject)(Qt))],kf);var _f=D(O());var NG=require("vscode");var qT=class{constructor(e,t,n,i,o,s){this.label=e;this._description=t;this.detail=n;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new NG.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function MG(r){switch(r.kind){case"connectToLiveRemoteKernel":return b.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return b.kernelCategoryForRemoteJupyterKernel;default:return JT(r)}}function JT(r){switch(r.kind){case"startUsingLocalKernelSpec":return b.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Jn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return b.kernelCategoryForJupyterKernel;switch(Be(r.interpreter)){case"Conda":return wr(r.interpreter)?b.kernelCategoryForCondaWithoutPython:b.kernelCategoryForConda;case"PipEnv":return b.kernelCategoryForPipEnv;case"Poetry":return b.kernelCategoryForPoetry;case"Pyenv":return b.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return b.kernelCategoryForVirtual;default:return b.kernelCategoryForGlobal}}default:return""}}var Sb=class{constructor(e,t,n,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=n;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=mt(e),o=XN(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=YN(e));let s=JT(e),a=e.kind==="connectToLiveRemoteKernel"?()=>YN(e):void 0,c=new qT(i,o,"",s,void 0,a);if(this.disposables.push(c),this.details.set(e.id,c),e.kind==="startUsingPythonInterpreter"&&wr(e.interpreter)){let l=u=>{let p=u.find(h=>h.id===e.interpreter?.id),m=Oi(bo().find(h=>h.id===p?.id));if(e.kind==="startUsingPythonInterpreter"&&m){e.updateInterpreter(m);let h=mt(e),g=XN(e,this.platform),y=JT(e),x=!1;h!==c.label&&(c.label=h,x=!0),g!==c.description&&(c.description=g,x=!0),y!==c.category&&(c.category=y,x=!0),x&&c.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?l([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=uy(e.serverProviderHandle,this.jupyterUriProviderRegistration,b.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let n=MG(e);return t.category!==n&&(t.category=n,t.triggerChange()),t}};Sb=v([(0,_f.injectable)(),d(0,(0,_f.inject)(Dr)),d(1,(0,_f.inject)(Qt)),d(2,(0,_f.inject)(F)),d(3,(0,_f.inject)(st))],Sb);var Tu=D(O()),Ru=require("vscode");var wd=D(O()),FG=require("vscode");var OG=require("vscode");function $T(r){try{return OP(So(r))||r.getCells().find(t=>t.kind===OG.NotebookCellKind.Code)?.document.languageId}catch(e){U("Failed to determine language of first cell",e)}}var KG="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",vs=class{constructor(e,t,n){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=n}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,n=this.pythonExtensionChecker.isPythonExtensionInstalled?xe:"plaintext";return Tc(t||n)}activate(){FG.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(It(e))return Xj;{let t=Tc(Co(e)||"");return t&&LS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(KG)}async onDidSaveNotebookDocument(e){if(!Nt(e))return;let t=$T(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(KG,t)}};v([Ur("Saving last saved cell language")],vs.prototype,"onDidSaveNotebookDocument",1),vs=v([(0,wd.injectable)(),d(0,(0,wd.inject)(F)),d(1,(0,wd.inject)($e)),d(1,(0,wd.named)(gt)),d(2,(0,wd.inject)(Ye))],vs);function LG(r){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};r.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),N("DS_INTERNAL.KERNEL_COUNT",{...e})}var Lt=require("vscode");var gl=require("vscode");var Ci=Symbol("INotebookEditorProvider");var UG=require("vscode");async function jG(r,e){let t=e?.findNotebookEditor(r);return t?UG.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(C("Unable to select kernel as the Notebook document could not be identified"),!1)}var WG=require("vscode");var HT=class extends Mc{constructor(e){super(b.failedToStartAnUntrustedKernelSpec(mt(e),e.kernelSpec.specFile?B(WG.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var ia=class r{static async switchController(e,t){let i=t.get(Ci).findNotebookEditor(e),o=t.get(St),s,a=le(),c=o.onControllerSelected(u=>a.resolve(u.controller));return await jG(e,t.get(Ci))&&i&&(s=await a.promise),c.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await gl.window.showErrorMessage(b.cannotRunCellKernelIsDead(mt(e.kernelConnectionMetadata)),{modal:!0},b.showJupyterLogs,b.restartKernel),n=!1;switch(t){case b.restartKernel:{await e.restart(),n=!0;break}case b.showJupyterLogs:gl.commands.executeCommand($.ViewJupyterOutput).then(f,f)}return n}static async handleKernelError(e,t,n,i,o,s,a,c){let l=e.get($e,gt),u=e.get(en);a.interpreter&&n==="start"&&L8(l,19,a.interpreter.uri).catch(f);let p=await u.handleKernelError(t,n,a,i,c),m=yt(a);switch(e.tryGet(bi)?.isSupported&&m&&n==="start"&&wt(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:p}),o.dispose().catch(f),p){case 1:case 2:throw t;case 3:{let y=await r.switchController(i,e);if(!y)throw t;s=y.controller,a=y.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return n=>n.start(t);case"interrupt":return n=>n.interrupt();case"restart":return n=>n.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,n,i,o,s,a){let{kernel:c,deadKernelAction:l}=await i;if(z_(c)){if(this.deleteKernelInfo(t,i),l==="deadKernelWasNoRestarted")throw new od(c.kernelConnectionMetadata);return l==="deadKernelWasRestarted"?c:r.wrapKernelMethod(c.kernelConnectionMetadata,"start",o,e,t,n,a,s)}return c}static async wrapKernelMethod(e,t,n,i,o,s,a,c=()=>void 0){let l=this.getKernelInfo(o);if(!s.disableUI&&l?.options.disableUI&&(l.options.disableUI=!1),!s.disableUI&&l?.kernel.resolved&&(l?.kernel.value?.kernel?.disposed||l?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),l=void 0),l&&t!=="restart"&&t!=="interrupt")return r.verifyKernelState(i,o,s,l.kernel.promise,n,c,a);P(`${t} the kernel, options.disableUI=${s.disableUI} for ${B("notebook"in o?o.notebook.uri:o.resource)}`);let u=r.wrapKernelMethodImpl(e,t,i,o,s,n,c),p=Es(u);return p.promise.catch(f),u.then(m=>{m.kernel.onDisposed(()=>{this.deleteKernelInfo(o,p.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,p.promise)}),this.setKernelInfo(o,p,s),r.verifyKernelState(i,o,s,p.promise,n,c,a)}static getKernelInfo(e){return"notebook"in e?r.connectionsByNotebook.get(e.notebook):r.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,n){"notebook"in e?r.connectionsByNotebook.set(e.notebook,{kernel:t,options:n}):r.connectionsByUri.set(e.resource.toString(),{kernel:t,options:n})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?r.connectionsByNotebook.delete(e.notebook):r.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&r.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?r.connectionsByNotebook.delete(e.notebook):e.resource&&r.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&r.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!yt(e)||!e.kernelSpec.specFile)return;if(!t.get(gd).isTrusted(gl.Uri.file(e.kernelSpec.specFile)))throw new HT(e)}static async wrapKernelMethodImpl(e,t,n,i,o,s,a){let c=n.get(Ke),l=n.get(Pm),u,p=r.convertContextToFunction(t,o),m=t,h="controller"in i?i.controller:void 0;for(t==="start"&&r.verifyWeCanStartKernel(e,n);u===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new gl.CancellationError;u="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:h||i.controller,resourceUri:i.resource}):l.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});try{if(t!=="restart"&&z_(u)&&!o.disableUI){let g=await r.notifyAndRestartDeadKernel(u);return{kernel:u,deadKernelAction:g?"deadKernelWasRestarted":"deadKernelWasNoRestarted"}}else{if(a(m,u),await p(u),"notebook"in i&&i.notebook.isClosed)throw new gl.CancellationError;z_(u)&&!o.disableUI&&m!=="interrupt"&&await r.notifyAndRestartDeadKernel(u)}}catch(g){if(fr(g)||U(`Error occurred while trying to ${m} the kernel, options.disableUI=${o.disableUI}`,g),o.disableUI)throw g;if("notebook"in i&&i.notebook.isClosed)throw new gl.CancellationError;let y=await r.handleKernelError(n,g,m,i.resource,u,h,e,s);if(h=y.controller,e=y.metadata,p=x=>x.start(o),m="start",s==="3rdPartyExtension")throw g;u=void 0}}return{kernel:u}}static async connectToNotebookKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}static async connectToKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}};var Tf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var zT=require("vscode");var GT=class extends or{constructor(t,n,i){super();this.kernel=t;this.controller=n;this.notebook=i}initialize(){let t=this.kernel,n=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!n.createNotebookExecution)return;this._register(zT.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(n.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=n.createNotebookExecution(i);o.start(),this._register(new zT.Disposable(()=>o.end()))}};var qG=require("vscode");var QT=class{constructor(){this.cache=new Map;this.executionCount=0}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,n){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,n)}},VG=QT,BG=QT;var YT=class{constructor(e,t,n,i){this.variables=e;this.kernelProvider=t;this.controllerId=n;this.variableResultCache=new VG;this.variableSummaryCache=new BG;this.runningKernels=new Set;this._onDidChangeVariables=new qG.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event;i.push(this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this))}onKernelStatusChanged({kernel:e}){if(e.controller.id!==this.controllerId)return;let t=this.runningKernels.has(e.notebook.uri.toString());e.status==="idle"&&!t?this.runningKernels.add(e.notebook.uri.toString()):e.status!=="busy"&&e.status!=="idle"&&t&&(this.runningKernels.delete(e.notebook.uri.toString()),this._onDidChangeVariables.fire(e.notebook))}_getVariableResultCacheKey(e,t,n){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${n}`),`${e}:${i}`}async*provideVariables(e,t,n,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s||s.status==="dead"||s.status==="terminating")return;let a=this.kernelProvider.getKernelExecution(s).executionCount,c=this._getVariableResultCacheKey(e.uri.toString(),t,i),l=this.variableResultCache.getResults(a,c);if(t){let u=t;if(!l&&u.getChildren)l=(await u.getChildren(i,o)).map(m=>this.createVariableResult(m,s)),this.variableResultCache.setResults(a,c,l);else if(!l)return;for(let p of l)yield p;if(n===2&&u.count&&l.length>0&&u.count>i+l.length)for await(let p of this.provideVariables(e,t,n,i+l.length,o))yield p}else{l||(l=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(p=>this.createVariableResult(p,s)),this.variableResultCache.setResults(a,c,l));for(let u of l)yield u}}_getVariableSummaryCacheKey(e,t){return`${e}:${t.name}`}async*provideVariablesWithSummarization(e,t,n,i,o){let s=this.kernelProvider.get(e),a=this.provideVariables(e,t,n,i,o);for await(let c of a)if(s&&s.status!=="dead"&&s.status!=="terminating"){let l=this._getVariableSummaryCacheKey(e.uri.toString(),c.variable),u=this.kernelProvider.getKernelExecution(s).executionCount,p=this.variableSummaryCache.getResults(u,l);p==null&&c.variable.type==="pandas.core.frame.DataFrame"&&(p=await this.variables.getVariableValueSummary({name:c.variable.name,value:c.variable.value,supportsDataExplorer:!1,type:c.variable.type??"",size:0,count:0,shape:"",truncated:!0},s,o),this.variableSummaryCache.setResults(u,l,p??null)),yield{hasNamedChildren:c.hasNamedChildren,indexedChildrenCount:c.indexedChildrenCount,variable:{name:c.variable.name,value:c.variable.value,expression:c.variable.expression,type:c.variable.type,language:c.variable.language,summary:p??""}}}}createVariableResult(e,t){let n=e.count??0,i=!!e.hasNamedChildren,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),expression:Gye(e.root,e.propertyChain),...e};return{variable:o,hasNamedChildren:i,indexedChildrenCount:n}}async getChildren(e,t,n,i){let o=e;return await this.variables.getAllVariableDiscriptions(n,o,t,i)}};function Gye(r,e){let t=r;for(let n of e)typeof n=="string"?t+=`.${n}`:t+=`[${n}]`;return t}var XT=class r{constructor(e,t,n,i,o,s,a,c,l,u,p,m){this.kernelConnection=e;this._viewType=n;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=c;this.extensionChecker=l;this.serviceContainer=u;this.displayDataProvider=p;this._onNotebookControllerSelectionChanged=new Lt.EventEmitter;this._onConnecting=new Lt.EventEmitter;this.pendingCellAdditions=new WeakMap;this._onDidDispose=new Lt.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new WeakMap;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;s9(e.id,e.interpreter?.id),s.push(this),this._onNotebookControllerSelected=new Lt.EventEmitter,this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=Lt.notebooks.createNotebookController(t,n,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.supportedLanguages.includes("python")&&(this.controller.variableProvider=new YT(m,this.kernelProvider,this.controller.id,this.disposables)),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),Lt.workspace.onDidCloseNotebookDocument(h=>{this.associatedDocuments.delete(h)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelected(){return this._onNotebookControllerSelected.event}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,n,i,o,s,a,c,l,u,p,m){return new r(e,t,n,i,o,s,a,c,l,u,p,m)}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Yt(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new GT(t,this.controller,e);this.disposables.push(u),u.initialize()}let n=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(qa).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||n.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==Lt.NotebookCellKind.Code)return;let s=!1,a=[],c,l=(u,p)=>{if(!(p.direction==="send"||s)&&Iu(p.msg)===o.msg_id){if("msg_type"in p.msg&&p.msg.msg_type==="status"&&"execution_state"in p.msg.content&&p.msg.content.execution_state==="idle")return;s=!0,n.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(f),z(a)}};t.session.kernel.anyMessage.connect(l),c=new Lt.Disposable(()=>{Wn(()=>t.session?.kernel?.anyMessage.disconnect(l))}),a.push(c),this.disposables.push(c)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=mt(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let n=e&&"message"in e?e.message:"";return ne(`\x1B[32mPosting message to Notebook UI ${n}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==xt)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=Lt.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());P(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),ne(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelected.dispose(),this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),z(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){if(e.length<1)return;let n=On(t);n?.cellExecutionCount(e.length);let i=n?.preExecuteCellTelemetry();this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(o=>o.index<0?(U(`Attempting to run a cell with index ${o.index}, kind ${o.kind}, text = ${o.document.getText()}`),!1):!0),Lt.workspace.isTrusted&&(ee(`Handle Execution of Cells ${e.map(o=>o.index)} for ${B(t.uri)}`),await ea(t.uri,this.connection),i?.stop(),await Promise.all(e.map(o=>this.executeCell(t,o))))}async onDidChangeSelectedNotebooks(e){if(ne(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let n=this.kernelProvider.get(e.notebook);n?.kernelConnectionMetadata.id===this.kernelConnection.id&&(ee(`Disposing kernel ${this.kernelConnection.id} for notebook ${B(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),n.dispose().catch(f)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire(e);return}if(!Nt(e.notebook)&&e.notebook.notebookType!==xt||!Lt.workspace.isTrusted)return;On(e.notebook)?.kernelSelected(this.kernelConnection.id,this.kernelConnection.interpreter?.id),zye(this.kernelConnection);let t=le();ne(`Controller ${this.connection.kind}:${this.id} associated with nb ${B(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelected.fire({notebook:e.notebook,controller:this}),this._onNotebookControllerSelectionChanged.fire(e),P("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=It(this.kernelConnection)?xe:t[0];await Promise.all(e.getCells().filter(o=>o.kind===Lt.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await Lt.languages.setTextDocumentLanguage(o.document,i).then(f,f)}))}getRendererScripts(){return this.context.extensionMode===Lt.ExtensionMode.Development||this.context.extensionMode===Lt.ExtensionMode.Test?[new Lt.NotebookRendererScript(Lt.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){P(`VS Code interrupted kernel for ${B(e.uri)}`),e.getCells().forEach(t=>bt(t,"Cell cancellation requested")),Lt.commands.executeCommand($.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(f,t=>C("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let n=this.runningCellExecutions.get(e.notebook);if(!n||n.cell===e){n?.end(void 0,void 0),n=Ki.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,n);let i=n.end.bind(n);n.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return n}async executeCell(e,t,n){let i=new En,o=i.add(new Lt.CancellationTokenSource);i.add(Lt.workspace.onDidCloseNotebookDocument(m=>m===e?o.cancel():void 0));let s=this.createCellExecutionIfNecessary(t,new Tf(this.controller)),a="start",c,l=new Tf(this.controller),u=!1,p=this.serviceContainer.get(qa);try{if(c=await this.connectToKernel(e,new Yt(!1)),c.disposing)throw new Lt.CancellationError;let m=On(e)?.executeCell();m&&i.add(new Lt.Disposable(()=>m.stop())),u=!0,c&&c.controller.id!==l.id&&(l=c.controller,s=this.createCellExecutionIfNecessary(t,c.controller)),a="execution",c.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(c,e),p.trackCellExecution(t,c);let g=this.kernelProvider.getKernelExecution(c).executeCell(t,n);return g.then(()=>{if(c&&!MS.isExiting)return p.deleteTrackedCellExecution(t,c)}).catch(f),await g}catch(m){if(m instanceof hd)return;fr(m)||C("Error in execution",m),u||(s.start(),s.clearOutput(t).then(f,f));let h=this.serviceContainer.get(en);m=un.unwrap(m);let g=fr(m)||m instanceof od;await vp(t,l,await h.getErrorMessageForDisplayInCell(m,a,e.uri),g)}finally{i.dispose()}}async connectToKernel(e,t){let n=On(e)?.startKernel();return this._onConnecting.fire(),ia.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables).finally(()=>n?.stop())}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let n=[];Lt.workspace.onDidCloseNotebookDocument(s=>{s===t&&z(n)},this,n);let i=e.onDisposed(()=>z(n)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await JG(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&z(n))});n.push({dispose:()=>o.dispose()}),n.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,n=this.kernelProvider.get(e);if(n&&j9(n.kernelConnectionMetadata,t)){ee("Switch kernel did not change kernel.");return}if(wt(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),n&&Lt.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await JG(e,t),e.notebookType===xt)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(P(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),It(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(gd);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&yt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(Lt.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Yt(!0))}};async function JG(r,e,t){let n=So(r)||{},{changed:i}=await M9(n,e,t);i&&await zV(r,n)}async function zye(r){let e=await pp(r.interpreter,!0),t=e?.major||0,n=e?.minor||0;!e||t>=4||t<=0||n<=-1||r.kind!=="startUsingLocalKernelSpec"&&r.kind!=="startUsingPythonInterpreter"||(t<3||t===3&&n<=5)&&Lt.window.showWarningMessage(b.warnWhenSelectingKernelWithUnSupportedPythonVersion,ve.learnMore).then(i=>{if(i===ve.learnMore)return Fp("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},f)}var xb=class{constructor(e,t,n,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=n;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new Ru.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new Ru.EventEmitter;this.selectionChangedEmitter=new Ru.EventEmitter;this.selectedControllers=new WeakMap;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.onDidChange(({added:e})=>{e.forEach(t=>{t.onNotebookControllerSelectionChanged(n=>{!n.selected&&this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(U(`Removing controller ${t.id} for ${t.connection.kind} from kernel list`),t.dispose())},this,this.disposables)})},this,this.disposables),Ru.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),Ru.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebookDocument(e).catch(f)),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),LG(this.registered.map(e=>e.connection)),ne(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async onDidOpenNotebookDocument(e){e.notebookType!==_t&&e.notebookType!==xt||Ru.workspace.isTrusted}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(n=>{let i=e.some(o=>o.id===n.connection.id)||ci&&this._activeInterpreterControllerIds.has(n.id);return!i&&n.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(n)?(i||P(`Controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}' is no longer a valid`),!i):!1}).forEach(n=>{U(`Disposing old controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}'`),n.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[_t,xt])}catch(t){if(!fr(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:n})=>{let i=new Set((n||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{U(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(n=>{n.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(n=>{Ft(n.connection)&&n.connection.serverProviderHandle.id===t.id&&n.connection.serverProviderHandle.handle===t.handle&&(U(`Deleting controller ${n.id} as it is associated with a connection that has been removed`),n.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.filter(t=>!this.isFiltered(t)).forEach(t=>this.addOrUpdate(t,[_t,xt])),this.registered.forEach(t=>{this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(U(`Deleting controller ${t.id} as it is associated with a connection that has been hidden`),t.dispose())})}batchAdd(e,t){let n=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);n.push(...o)}),n.length&&this.changeEmitter.fire({added:n,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e)}addOrUpdate(e,t){let{added:n,existing:i}=this.addImpl(e,t,!0);return n.concat(i)}addImpl(e,t,n){let i=[],o=[];ne(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),ne(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):this.isFiltered(e)?(ne(`Existing controller '${s}' will be excluded as it is filtered`),!1):(ne(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let c=XT.create(e,s,a,this.serviceContainer.get(Ke),this.serviceContainer.get(lt),this.disposables,this.serviceContainer.get(vs),this.serviceContainer.get(de),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(wp),this.serviceContainer.get(jn,Qe.KERNEL_VARIABLES)),l=[];c.onDidDispose(()=>{ne(`Deleting controller '${c.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(c.id),l.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(c),this.registeredControllers.set(c.id,c),i.push(c),c.onNotebookControllerSelected(u=>{ne(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook,u.controller),this.selectedEmitter.fire(u)},this,l),c.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:c}),this,l)}),n&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(fr(s,!0))return{added:i,existing:o};C(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let n=this.getControllerId(e,t);return this.registeredControllers.get(n)}isFiltered(e){return!1}getControllerId(e,t){return t===_t?e.id:`${e.id}${s3}`}isControllerAttachedToADocument(e){return Ru.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};xb=v([(0,Tu.injectable)(),d(0,(0,Tu.inject)(F)),d(1,(0,Tu.inject)(gi)),d(2,(0,Tu.inject)(Ye)),d(3,(0,Tu.inject)(pt)),d(4,(0,Tu.inject)(Zt)),d(5,(0,Tu.inject)(Or))],xb);var Ed=D(O());var ZT=class{constructor(e,t,n){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=n;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var $G=require("vscode"),e0=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return $G.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let n=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!n&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return n||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async n=>({moduleName:n,scriptUri:e[n].toString(),source:"remote"}))):[]}};var Cb=class{constructor(e,t,n){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=n}getProviders(e,t){let n=[];switch(n.push(new Ja(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":n.push(new e0(e,this.widgetScriptManagerFactory));break;default:n.push(new ZT(e,t,this.widgetScriptManagerFactory))}return n}};Cb=v([(0,Ed.injectable)(),d(0,(0,Ed.inject)(de)),d(1,(0,Ed.inject)(VT)),d(2,(0,Ed.inject)($e)),d(2,(0,Ed.named)(gt))],Cb);var HG=D(O()),t0=require("vscode");var wb=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return t0.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":{let t=await Pa(e.kernelConnectionMetadata.interpreter);return t?t0.Uri.joinPath(t0.Uri.file(t),"share","jupyter"):void 0}default:return}}};wb=v([(0,HG.injectable)()],wb);var Au=D(O());var Rf=require("vscode");var bL=require("vscode");var sz=D(iz());var oz=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function Zye(r,e,t){let n=[...oz],i=await vt(e),o=0,s;for(;o<=0&&n.length&&(s=n.pop(),!!s);)o=t.indexOf(s);if(o<0){let m=[...oz].map(h=>h.substring(0,h.length-2));for(;o<=0&&m.length&&(s=m.pop(),!!s);)o=t.indexOf(s)}if(o<0){N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let c=t.indexOf("{",o),l=t.substring(c,a);l=(0,sz.default)(l,{language:"javascript"}),l=We(l,{trim:!0,removeEmptyEntries:!0}).join("");let u=l.split("{")[l.split("{").length-1].split("}")[0].split(",").map(m=>m.trim()).filter(m=>m.length&&m.includes(":")),p={};if(u.forEach(m=>{let h=m.split(":"),g=um(h[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),y=um(m.substring(m.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();p[g]=y.startsWith("http")?bL.Uri.parse(y):bL.Uri.joinPath(r,y)}),!p||!Object.keys(p).length){N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(p).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),p}var Eb=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){z(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,n){let i=await this.getWidgetScriptSource(t);try{let o=await Zye(e,n,i);if(!o){let s=`Failed to extract require.config from widget for ${n} from ${B(t)}`;ci&&(s+=`with contents ${i}`),U(s)}return o}catch(o){C(`Failed to extract require.config entry for ${n} from ${B(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new Ge,[t,n]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!n)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(n,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),N("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:yt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var o0=class extends Eb{constructor(t,n,i,o){super(t);this.context=n;this.fs=i;this.connection=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(f)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return Rf.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(Rf.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!It(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return ne("No Kernel session to get list of widget entry points"),[];let n=[];n.push(In(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!ci&&this.context.extensionMode===Rf.ExtensionMode.Production&&n.push(Di(1e4).then(()=>[])),n.forEach(s=>s.catch(f));let i=await Promise.race(n);if(i.length===0)return ne("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return ne("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return P(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>um(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:Rf.Uri.joinPath(Rf.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:dt(a)}))}catch(s){return C(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let n=this.getWidgetScriptSourceUsingHttpClient(t),i=this.getWidgetScriptSourceUsingFetch(t),o=n.catch(()=>i);return o.catch(s=>{n.catch(a=>C(`Failed to download widget script source from ${t.toString(!0)}`,a)),C(`Failed to download widget script source from ${t.toString(!0)}`,s)}),o}async getWidgetScriptSourceUsingHttpClient(t){let n=t.toString(!0),o=await new nl().downloadFile(n);if(o.status===200)return o.text();throw new Error(`Error downloading from ${n}: ${o.statusText}`)}async getWidgetScriptSourceUsingFetch(t){let n=await this.connection.createConnectionInfo(this.kernelConnection.serverProviderHandle),i=t.toString(!0),s=await new nl(n.settings.fetch).downloadFile(i);if(s.status===200)return s.text();throw new Error(`Error downloading from ${i} using custom fetch: ${s.statusText}`)}};var Pb=require("vscode");var s0=class r extends Eb{constructor(t,n,i,o,s){super(t);this.fs=n;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!r.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let n=new Ge;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){U(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await vt(this.kernel.kernelConnectionMetadata.id),o=Pb.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=Pb.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),c=a.map(l=>Pb.Uri.joinPath(l,"nbextensions"));c.reverse();for(let l of c)await this.fs.exists(l)&&await this.fs.copy(l,s,{overwrite:t});return this.overwriteExistingFiles=!1,r.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),N("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:n.elapsedTime}),o}catch(n){throw N("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,n),n}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let n=Pb.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("**/extension.js",n.fsPath,!0)).map(o=>({uri:Pb.Uri.joinPath(n,o),widgetFolderName:dt(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var kb=class{constructor(e,t,n,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=n;this.jupyterPaths=i;this.disposables=o;this.connection=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new o0(e,this.context,this.fs,this.connection);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new s0(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};kb=v([(0,Au.injectable)(),d(0,(0,Au.inject)(WT)),d(1,(0,Au.inject)(gr)),d(2,(0,Au.inject)(lt)),d(3,(0,Au.inject)(qr)),d(4,(0,Au.inject)(F)),d(5,(0,Au.inject)(dn))],kb);var a0=D(O()),$a=require("vscode");var oa=class{constructor(e){this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){let e=new nc(1e3);this.disposables.push(e),$a.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>this.onDidChangeNotebookDocument(t))},this,this.disposables)}onDidChangeNotebookDocument(e){Nt(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(n=>n.items&&n.items.some(i=>i.mime===zi)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!$a.workspace.isTrusted)return;let e=$a.extensions.getExtension(Sh);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let n=t.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){oa.messageDisplayed||(oa.messageDisplayed=!0,$a.window.showInformationMessage(b.rendererExtensionRequired,{modal:!0},ve.bannerLabelYes).then(e=>{e===ve.bannerLabelYes&&$a.commands.executeCommand("extension.open",Sh).then(f,f)}).then(f,f))}displayUpdateMessage(){oa.messageDisplayed||(oa.messageDisplayed=!0,$a.window.showInformationMessage(b.rendererExtension1015Required,{modal:!0},ve.bannerLabelYes).then(e=>{e===ve.bannerLabelYes&&$a.commands.executeCommand("extension.open",Sh).then(f,f)}).then(f,f))}};oa.messageDisplayed=!1,oa=v([(0,a0.injectable)(),d(0,(0,a0.inject)(F))],oa);function az(r,e){r.addSingleton(_u,_u),r.addSingleton(jT,Cb),r.addSingleton(VT,kb),r.addSingleton(WT,wb),r.addSingleton(Ja,Ja),r.addSingleton(Ie,oa)}var kd=D(O()),Jr=require("vscode");var Db=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=n;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){z(this.localDisposables)}activate(){if(!ln()){this.localDisposables.push(Jr.notebooks.registerKernelSourceActionProvider(_t,{provideNotebookKernelSourceActions:()=>[{label:b.localPythonEnvironments,documentation:Jr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(Jr.notebooks.registerKernelSourceActionProvider(xt,{provideNotebookKernelSourceActions:()=>[{label:b.localPythonEnvironments,documentation:Jr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],n=new Jr.EventEmitter;this.localDisposables.push(Jr.notebooks.registerKernelSourceActionProvider(_t,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(Jr.notebooks.registerKernelSourceActionProvider(xt,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>Cg(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:b.localKernelSpecs,documentation:Jr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],n.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(Jr.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(Jr.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(Jr.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),Pe.instance.get(Qt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=Pe.instance.get(Qt),t=new Set;e.jupyterCollections.map(n=>{let i=`${n.extensionId}:${n.id}`;if(n.id===Hw||(t.add(i),this.providerMappings.has(i)))return;let o=Jr.notebooks.registerKernelSourceActionProvider(_t,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]}),s=Jr.notebooks.registerKernelSourceActionProvider(xt,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:n})}),this.providerMappings.forEach(({disposables:n},i)=>{t.has(i)||(z(n),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||Jr.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await Pe.instance.get(Tm).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await Pe.instance.get(QP).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,n){if(n=n||Jr.window.activeNotebookEditor?.notebook,!n&&Jr.window.activeTextEditor&&(n=this.notebookEditorProvider.findNotebookEditor(Jr.window.activeTextEditor.document.uri)?.notebook),!n)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await Pe.instance.get(zP).selectRemoteKernel(n,o);return this.getSelectedController(n,a)}async getSelectedController(e,t){if(!t)return;let n=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(n)||n.length===0){U(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}ea(e.uri,t).finally(()=>wt(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(f),n.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,Jr.NotebookControllerAffinity.Preferred);let i=n[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(n9(e),yt(t.connection)&&It(t.connection)&&wr(t.connection.interpreter)&&!ln()){let n=[];try{let i=new Jr.CancellationTokenSource;n.push(i);let o=new Yt(!1);n.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){C(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{z(n)}}}};Db=v([(0,kd.injectable)(),d(0,(0,kd.inject)(St)),d(1,(0,kd.inject)(Or)),d(2,(0,kd.inject)(Ci)),d(3,(0,kd.inject)(Ls)),d(4,(0,kd.inject)(F))],Db);var Af=D(O()),p0=require("vscode");var vl=require("vscode");var c0=require("vscode");var Dd=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){z(this.disposables)}async findPreferredRemoteKernelConnection(e,t,n){return this.findPreferredRemoteKernelConnectionImpl(e,t,n,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,n,i){let o=await Pe.instance.get(cs).getPreferredRemoteKernelId(e),s=async()=>{let c=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(c)return c;if(t.status==="idle")return;let l=await new Promise(u=>t.onDidChangeKernels(()=>{let p=t.kernels.find(m=>m.kind==="connectToLiveRemoteKernel"&&m.id===o);p&&u(p),(t.status==="idle"||n.isCancellationRequested)&&u(void 0)},this,this.disposables));if(l)return l};if(o){let c=await s();if(c||i)return c}let a=t.kernels.find(c=>Ft(c))?.serverProviderHandle;if(a){let c=await this.jupyterConnection.createConnectionInfo(a),l=(e.uri,void 0),u=l&&t.kernels.find(p=>Ft(p)&&p.kind==="connectToLiveRemoteKernel"&&p.kernelModel.model&&p.kernelModel.model.path===l.path&&p.kernelModel.model.name===l.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,n,i)}async findPreferredLocalKernelSpecConnection(e,t,n){return this.findPreferredKernelSpecConnection(e,t,n,!1)}async findPreferredKernelSpecConnection(e,t,n,i){let s=So(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.name===s):[];if(u.length||i)return u;let p=$T(e);if(p)return t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.language&&(m.kernelSpec.language===p||Tc(m.kernelSpec.language)===Tc(p)))},c=a();if(Array.isArray(c)&&c.length)return i&&c.length>1?void 0:c[0];if(t.status==="idle")return;let l=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(n.isCancellationRequested)return u(void 0);let p=a();if(Array.isArray(p)&&p.length)return i&&p.length>1?u(void 0):u(p[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>z(l))}async findPreferredPythonKernelConnection(e,t,n){return this.findPreferredPythonKernelConnectionImpl(e,t,n)}async findPreferredPythonKernelConnectionImpl(e,t,n){t=t||Pe.instance.get(Or).registered.find(l=>l.kind==="localPythonEnvironment");let i=Pe.instance.get(st),o=IL(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!n.isCancellationRequested)return t.kernels.filter(l=>l.kind==="startUsingPythonInterpreter").map(l=>l).find(l=>l.interpreter.id===s.id)},c=a();if(c)return c;if(t.status==="discovering")return await new Promise(l=>{t.onDidChangeStatus(()=>t.status==="idle"&&l(),this,this.disposables),t.onDidChangeKernels(()=>(IL(e,t)||a())&&l(),this,this.disposables)}),IL(e,t)||a()}};function IL(r,e){let t=c0.workspace.getWorkspaceFolder(r.uri)?.uri||(c0.workspace.workspaceFolders?.length===1?c0.workspace.workspaceFolders[0].uri:void 0),n=cz(Ti(r.uri),e);if(n)return n;if(t)return cz(t,e)}function cz(r,e){let n=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>sv(Mr(a.interpreter)?.environment?.folderUri?.fsPath||a.interpreter.uri.fsPath,r.fsPath)),i=n.find(a=>Be(a.interpreter)==="Venv"&&Ho(a.interpreter)?.toLowerCase()===".venv");if(i)return i;let o=n.find(a=>Be(a.interpreter)==="Conda"&&Ho(a.interpreter)?.toLowerCase()===".venv");if(o)return o;let s=n.find(a=>Ho(a.interpreter)?.toLowerCase()===".venv");return s||(n.length?n[0]:void 0)}var l0=class{constructor(e,t,n,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new vl.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new vl.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new vl.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new vl.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new vl.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=b.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),lm(n)?n.then(s=>this.setupFinder(s)).catch(s=>C(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(n)}dispose(){z(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>C(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>C(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=b.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=b.quickPickSelectPythonEnvironmentTitle;break;default:this.title=b.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new vl.CancellationTokenSource;this.disposables.push(new vl.Disposable(()=>t.cancel())),this.disposables.push(t);let n=new Dd(this.connection);this.disposables.push(n),e.kind==="remote"?this.computePreferredRemoteKernel(e,n,t.token):this.computePreferredLocalKernel(e,n,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(n=>n.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(n.interpreter)):e}computePreferredRemoteKernel(e,t,n){t.findPreferredRemoteKernelConnection(this.notebook,e,n).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>C(`Preferred connection failure ${B(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,n){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,n).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>C(`Preferred connection failure ${B(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var _d=require("vscode");function yl(r){return"connection"in r}function ebe(r){return"command"in r}function tbe(r,e,t){let n=t?[t]:r.activeItems.length?[r.activeItems[0]]:[];if(n.length&&!e.includes(n[0])){let i=n[0],o=yl(i)&&e.find(s=>yl(s)&&s.connection.id===i.connection.id);o?n[0]=o:n.length=0}r.items=e,r.activeItems=n}var SL=class extends Error{},u0=class extends or{constructor(t,n){super();this.provider=t;this.token=n;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=Pe.instance.get(wp)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,n){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:_d.QuickPickItemKind.Separator,label:b.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,n)}async selectKernelImplInternal(t,n){let i={iconPath:new _d.ThemeIcon("refresh"),tooltip:ve.refresh},o={iconPath:new _d.ThemeIcon("loading~spin"),tooltip:ve.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let p=s.buttons;s.buttons=p.filter(m=>m!==i).concat(o),await this.provider.refresh().catch(f),s.buttons=p}}});n.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let c;this._register(this.provider.onDidChangeStatus(()=>{switch(c&&clearTimeout(c),this.provider.status){case"discovering":s.busy=!0;break;case"idle":c=setTimeout(()=>s.busy=!1,500),this._register(new _d.Disposable(()=>c&&clearTimeout(c)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let l=await a;if(!this.token.isCancellationRequested){if(ebe(l))try{let u=await l.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof SL)return{selection:"userPerformedSomeOtherAction"};if(u===Ne.back)return this.selectKernelImplInternal(t,n);throw u}if(l&&"connection"in l)return{selection:"controller",connection:l.connection};if(l&&"error"in l)throw Ne.back}}updateQuickPickItems(t){t.title=this.provider.title;let n=new Set(t.items.filter(u=>yl(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!n.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,p)=>u.label.localeCompare(p.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),c=s.size;i.forEach(u=>{let p=a.get(u.connection.id);p&&s.delete(p),s.add(u)});let l=Array.from(s);l.sort((u,p)=>u.label.localeCompare(p.label)),this.quickPickItems.splice(o+1,c,...l),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommendedItems.find(a=>yl(a)),i=new Set(this.recommendedItems.filter(yl).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!yl(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;n&&yl(n)&&s&&(yl(s)?s.connection.id!==n.connection.id&&(n=void 0):n=void 0),tbe(t,this.recommendedItems.concat(o),n)}removeMissingKernels(t){let n=t.items.filter(s=>yl(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=n.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:b.recommendedItemCategoryInQuickPick,kind:_d.QuickPickItemKind.Separator});let n=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=n:this.recommendedItems.push(n),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let n=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!yl(i)||!n.has(i.connection.id))return;let o=n.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,n=!1){let i=n?"$(star-full) ":"",o=(c,l,u)=>{c.label=`${i}${l.label}`,c.detail=l.detail,c.description=l.description,this.quickPickItems.forEach(p=>{"connection"in p&&p.connection.id===u.id&&(p.label=l.label,p.detail=l.detail,p.description=l.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:n,connection:t};return o(a,s,t),this._register(s.onDidChange(c=>o(a,c,t),this)),a}};var _b=class{constructor(e,t,n,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=n;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==_t&&e.notebookType!==xt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new p0.CancellationTokenSource;let t=this.multiStepFactory.create(),n={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,n),n)===Ne.cancel||n.selection?.type==="userPerformedSomeOtherAction")throw new p0.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(n.disposables);return}if(n.selection?.type==="connection")return n.selection.connection}finally{z(n.disposables)}}selectKernelFromKernelFinder(e,t,n,i){let o=new l0(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,n,i)}async selectKernel(e,t,n,i){if(t.isCancellationRequested)return;let o=new u0(e,t);i.disposables.push(o);let s=c=>{let{quickPick:l,selection:u}=n.showLazyLoadQuickPick({...c,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:l,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};_b=v([(0,Af.injectable)(),d(0,(0,Af.inject)(Or)),d(1,(0,Af.inject)(ev)),d(2,(0,Af.inject)(gi)),d(3,(0,Af.inject)(dn))],_b);var Nu=D(O()),Mf=require("vscode");var Nf=require("vscode");var Tb=require("vscode");var d0=class{constructor(e,t){this.notebook=e;this.disposables=[];Pe.instance.get(St).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=_g(t)}dispose(){this.cancelTokeSource.dispose(),z(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,P(`Python Environment created ${e.id}`);let n=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!n)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),P(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};P(`Python Environment ${e.id} found as a kernel ${n.kind}:${n.id}`);let o=await Pe.instance.get(Ls).installMissingDependencies({resource:this.notebook.uri,kernelConnection:n,ui:new Yt(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,U(`Dependencies not installed for new Python Env ${B(e.uri)} for notebook ${B(this.notebook.uri)}`)),N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:Be(t.interpreter)}),{kernelConnection:n}}async waitForPythonKernel(e){let n=Pe.instance.get(Or).registered.find(i=>i.kind==="localPythonEnvironment");if(n)return this.waitForPythonKernelFromFinder(e,n)}async waitForPythonKernelFromFinder(e,t){let n=t.kernels.find(i=>i.interpreter.id===e.id);return n||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return z(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{z(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||U(`New Python Environment ${B(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=Pe.instance.get(st),t=new Tb.CancellationTokenSource;try{let n=await Tb.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0});if(n?.action==="Cancel")return{action:"Cancel"};if(n?.action==="Back")return{action:"Back"};let i=n?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return U("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,P(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||U(`No interpreter details for New Python Environment ${B(Tb.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var m0=require("vscode");function uz(r,e){let t=rbe(r,e.environments.known);return t||(()=>{let i=e.environments.getActiveEnvironmentPath(r.uri);return i&&e.environments.known.find(o=>o.id===i.id)})()}function rbe(r,e){let t=m0.workspace.getWorkspaceFolder(r.uri)?.uri||(m0.workspace.workspaceFolders?.length===1?m0.workspace.workspaceFolders[0].uri:void 0),n=lz(Ti(r.uri),e);if(n)return n;if(t)return lz(t,e)}function lz(r,e){let t=e.filter(n=>sv(n.environment?.folderUri?.fsPath||n.executable.uri?.fsPath||n.path,r.fsPath));return t.find(n=>Be(n)==="Venv"&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>Be(n)==="Conda"&&n.environment?.name?.toLowerCase()===".conda")||t.find(n=>["VirtualEnv","VirtualEnvWrapper"].includes(Be(n))&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>n.environment?.name?.toLowerCase()===".venv"||n.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}var f0=class extends or{constructor(t,n){super();this.notebook=t;this.token=n;let i=Pe.instance.get(gi),o=Pe.instance.get(Ye),s=Pe.instance.get(tr);this.provider=Pe.instance.get(Gs).withFilter(h=>!i.isPythonEnvironmentExcluded(h)),this.pythonEnvPicker=this._register(new rd(Promise.resolve(this.provider),GD,zD,{supportsBack:!0},void 0,b.quickPickSelectPythonEnvironmentTitle));let a=!1,c=()=>{a||(a=!0,this.pythonEnvPicker.addCommand({label:`$(add) ${b.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this)))};this.provider.items.length&&c();let l={dispose:f},u=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),l.dispose(),u.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(l=this.pythonEnvPicker.addCommand({label:b.installPythonQuickPickTitle,tooltip:b.installPythonQuickPickToolTip,description:b.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>Nf.commands.executeCommand($.InstallPythonViaKernelPicker).then(f,f)),new Nf.CancellationError}))}).catch(f);let p=()=>{!this.pythonApi||n.isCancellationRequested||(this.pythonEnvPicker.recommended=uz(this.notebook,this.pythonApi))},m=h=>{h&&(this.pythonApi=h,p(),this._register(h.environments.onDidChangeActiveEnvironmentPath(p)),this._register(h.environments.onDidChangeEnvironments(p)))};o.isPythonExtensionInstalled?s.getNewApi().then(m).catch(f):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(m),this)),p()}async selectKernel(){let t=le();Nf.extensions.getExtension(li)||Nf.commands.executeCommand($.InstallPythonExtensionViaKernelPicker).then(c=>{c===!0?this.provider.refresh().catch(f):t.resolve()},c=>{C("Failed to install the Python extension",c),t.resolve()});let n=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!n||n instanceof Ne)return n||Ne.cancel;let i=Pe.instance.get(st),o=Pe.instance.get(qr),s=await i.getInterpreterDetails(n.path);if(!s)return Ne.cancel;let a=await Us(s,await o.getKernelSpecTempRegistrationFolder());return zo.create({kernelSpec:a,interpreter:s,id:Fi(a,s)})}async createNewEnvironment(){let t=Pe.instance.get(tr);if(!Pe.instance.get(Ye).isPythonExtensionInstalled)return;let o=await this._register(new d0(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?Ne.back:Ne.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):Ne.cancel}};var Rb=class extends Ms{constructor(t,n,i,o,s,a){super();this.pythonApi=n;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=b.localPythonEnvironments;this._onDidChangeKernels=this._register(new Mf.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new Mf.EventEmitter);this._status="idle";this.promiseMonitor=new Io;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f))},this))}async selectLocalKernel(t){let n=new Mf.CancellationTokenSource,i=[n];try{let o=new f0(t,n.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof Ne&&s===Ne.back)return;throw new Mf.CancellationError}return this.addUpdateKernel(s),s}finally{z(i)}}async getKernelConnection(t){let n=Pe.instance.get(st),i=Pe.instance.get(qr),o=await n.getInterpreterDetails(t.path);if(!o){U(`Python Env ${B(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){U(`Python Env hidden via filter: ${B(o.id)}`);return}let s=await Us(o,await i.getKernelSpecTempRegistrationFolder()),a=zo.create({kernelSpec:s,interpreter:o,id:Fi(s,o)}),c=this._kernels.get(a.id);return c||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let n=this._kernels.get(t.id);n?(n.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(n,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),z(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(f)),t.environments.known.forEach(n=>this.buildDummyEnvironment(n).catch(f)))}).catch(f)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||(this.tempDirForKernelSpecs=this.jupyterPaths.getKernelSpecTempRegistrationFolder()),this.tempDirForKernelSpecs}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();t&&(t.environments.known.map(n=>this.buildDummyEnvironment(n).catch(f)),this._register(t.environments.onDidChangeEnvironments(n=>{if(n.type==="remove"){let i=this._kernels.get(n.env.id);i&&(this._kernels.delete(n.env.id),this._onDidChangeKernels.fire({removed:[i]}))}else this.buildDummyEnvironment(n.env).catch(f)},this)))}async buildDummyEnvironment(t){let n=l9(t);if(!n||this.filter.isPythonEnvironmentExcluded(n))return;let i=await Us(n,await this.getKernelSpecsDir()),o=zo.create({kernelSpec:i,interpreter:n,id:Fi(i,n)});this._kernels.get(t.id)||(this._kernels.set(t.id,o),this._onDidChangeKernels.fire({}))}};Rb=v([(0,Nu.injectable)(),d(0,(0,Nu.inject)(F)),d(1,(0,Nu.inject)(tr)),d(2,(0,Nu.inject)(gi)),d(3,(0,Nu.inject)(qr)),d(4,(0,Nu.inject)(Ye)),d(5,(0,Nu.inject)(Or))],Rb);var bl=D(O()),Gn=require("vscode");function h0(r){return r===Je||r===yh}var Ab=class{constructor(e,t,n,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=n;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==_t&&e.notebookType!==xt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Gn.CancellationTokenSource;let n=new Bx,i={disposables:[],notebook:e};try{if(await n.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===Ne.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Gn.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{z(i.disposables)}}async getRemoteServersFromProvider(e,t,n,i){let o=this.kernelFinder.registered.filter(T=>T.kind==="remote"),s=[],a=[],c=[],l=this.jupyterServerRegistry.jupyterCollections.find(T=>T.extensionId===e.extensionId&&T.id===e.id)?.serverProvider,u=l?.provideJupyterServers?Promise.resolve(l.provideJupyterServers.bind(l)(t)).then(T=>T||[]):Promise.resolve([]),p=new Set,m=await u,h=new Set(m.map(T=>T.id));if(o.filter(T=>T.serverProviderHandle.id===e.id).filter(T=>h.has(T.serverProviderHandle.id)).map(T=>{let j=this.serverUriStorage.all.find(oe=>Vt(oe.provider)===Vt(T.serverProviderHandle));p.add(Vt(T.serverProviderHandle)),c.push({server:T,time:j?.time})}),c.sort((T,j)=>!T.time&&!j.time?T.server.displayName.localeCompare(j.server.displayName):!T.time&&j.time?1:T.time&&!j.time||(T.time||0)>(j.time||0)?-1:1),c.filter(({time:T})=>(T||0)>0).forEach(({server:T,time:j})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,description:j?b.jupyterServerLastConnectionForQuickPickDescription(new Date(j)):void 0,buttons:l?.removeJupyterServer&&h0(e.extensionId)?[{iconPath:new Gn.ThemeIcon("close"),tooltip:b.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),c.filter(({time:T})=>!T).forEach(({server:T})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,buttons:l?.removeJupyterServer&&h0(e.extensionId)?[{iconPath:new Gn.ThemeIcon("close"),tooltip:b.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),m.sort((T,j)=>T.label.localeCompare(j.label)).forEach(T=>{let j=Vt({extensionId:e.extensionId,id:e.id,handle:T.id});p.has(j)||s.push({type:"jupyterServer",label:T.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:T.id},server:T,buttons:l?.removeJupyterServer&&h0(e.extensionId)?[{iconPath:new Gn.ThemeIcon("close"),tooltip:b.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let T=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map(j=>({...j,provider:e,type:"uriProviderQuickPick",command:j}));s.length>0&&T.length&&a.push({label:"",kind:Gn.QuickPickItemKind.Separator}),a.push(...T)}let g=s.concat(a),y=new Gn.EventEmitter,x=g.length===1&&"command"in g[0]&&g[0].command.canBeAutoSelected?g[0]:void 0;if(l){let T=g.filter(j=>"type"in j);T.length===1&&T.every(j=>j.type!=="uriProviderQuickPick")?x=T[0]:T.every(j=>j.type==="uriProviderQuickPick")&&T.filter(j=>j.picked).length===1&&(x=g.filter(j=>j.picked)[0])}let E,A;if(x)A=x;else{let{quickPick:T,selection:j}=n.showLazyLoadQuickPick({items:g,placeholder:e.extensionId===Je||e.extensionId===yh?b.enterOrSelectRemoteJupyterPlaceholder:b.selectRemoteJupyterPlaceholder,title:b.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async oe=>{if("type"in oe.item&&(oe.item.type==="finder"||oe.item.type==="jupyterServer")){let G=oe.item.idAndHandle.handle,ue=m.find(pe=>pe.id===G);l?.removeJupyterServer&&ue&&h0(e.extensionId)&&(T.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:G}).catch(f),await l.removeJupyterServer(ue),T.busy=!1,g.splice(g.indexOf(oe.item),1),y.fire(g.concat([])))}},onDidChangeItems:y.event});T.onDidChangeValue(async oe=>{if(!e.commandProvider?.provideCommands)return;let G=[];s.length>0&&G.push({label:"",kind:Gn.QuickPickItemKind.Separator});let pe=(await Promise.resolve(e.commandProvider.provideCommands(oe,t))||[]).map(te=>({...te,provider:e,type:"uriProviderQuickPick",command:te}));T.items=s.concat(G).concat(pe)},this),E=T,A=await j}if(!t.isCancellationRequested&&A&&"type"in A)switch(A.type){case"finder":{let T=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(A.kernelFinderInfo),t).catch(j=>C("Failed to select a kernel",j));if(T&&T===Ne.back){if(A===x)throw Ne.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!T||T instanceof Ne)throw new Gn.CancellationError;i.selection={type:"connection",connection:T};return}case"jupyterServer":{let T=(async()=>{let oe={id:e.id,handle:A.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===rc.toLowerCase()&&await ar(t,this.serverSelector.addJupyterServer(oe)),this.kernelFinderController.getOrCreateRemoteKernelFinder(oe,A.server.label)})(),j=await this.selectRemoteKernelFromPicker(i.notebook,T,t).catch(oe=>C("Failed to select a kernel",oe));if(j&&j===Ne.back){if(A===x)throw Ne.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!j||j instanceof Ne)throw new Gn.CancellationError;i.selection={type:"connection",connection:j};return}case"uriProviderQuickPick":{let T=Gn.notebooks.createNotebookControllerDetectionTask(_t);try{E&&(E.busy=!0);let j=await this.selectRemoteServerFromRemoteKernelFinder(A,i,t);return E&&(E.busy=!1),j}catch(j){if(j===Ne.back&&!x)return this.getRemoteServersFromProvider(e,t,n,i);throw j}finally{T.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,n){if(!e.provider.commandProvider?.handleCommand||n.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,n));if(!i)throw Ne.back;if(n.isCancellationRequested)throw new Gn.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===rc.toLowerCase()&&await ar(n,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,n).catch(a=>C("Failed to select a kernel",a));if(s&&s===Ne.back)throw Ne.back;if(!s||s instanceof Ne)throw new Gn.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,n){let i,o=u=>{let p=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${p.label}`,description:p.description,detail:p.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:b.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:b.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),c=new rd(t,o,s,{supportsBack:!0},a),l=new Dd(this.jupyterConnection);return t.then(u=>l.findPreferredRemoteKernelConnection(e,u,n)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(c.recommended=u),c.selected=u}).catch(u=>C("Failed to determine preferred remote kernel",u)),c.selectItem(n)}};Ab=v([(0,bl.injectable)(),d(0,(0,bl.inject)(Or)),d(1,(0,bl.inject)(Zt)),d(2,(0,bl.inject)(_a)),d(3,(0,bl.inject)(dn)),d(4,(0,bl.inject)(wp)),d(5,(0,bl.inject)(MC)),d(6,(0,bl.inject)(Qt))],Ab);function pz(r,e){r.addSingleton(St,xb),r.addBinding(St,Ie),r.addSingleton(wp,Sb),r.addSingleton(zP,Ab),r.addSingleton(QP,_b),r.addSingleton(Tm,Rb),r.addBinding(Tm,Ie),r.addSingleton(Ie,Db),az(r,e)}var YC=D(O()),Of=require("vscode");var Ha=Symbol("IJupyterDebugService"),Td=Symbol("INotebookDebuggingManager");var g0=Symbol("IDebugLocationTrackerFactory"),v0=Symbol("IDebugLocationTracker");var Nb=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(Of.commands.registerCommand($.RunByLine,this.runByLine,this)),this.disposables.push(Of.commands.registerCommand($.RunByLineNext,this.runByLineNext,this)),this.disposables.push(Of.commands.registerCommand($.RunByLineStop,this.runByLineStop,this)),this.disposables.push(Of.commands.registerCommand($.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){N("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){N("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=Of.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};Nb=v([(0,YC.injectable)(),d(0,(0,YC.inject)(Td)),d(1,(0,YC.inject)(F))],Nb);var Mu=D(O());var Mb=class{constructor(e,t,n){this.debugService=e;this.disposables=t;this.debugVariables=n}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(xe,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(ox,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(sx,this))}createDebugAdapterTracker(e){return this.debugVariables}};Mb=v([(0,Mu.injectable)(),d(0,(0,Mu.inject)(Ha)),d(0,(0,Mu.named)(Qe.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Mu.inject)(F)),d(2,(0,Mu.inject)(jn)),d(2,(0,Mu.named)(Qe.DEBUGGER_VARIABLES))],Mb);var Ga=D(O());var XC=require("vscode");var xL=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function b0(r){return{name:r.evaluateName??r.name,type:r.type,count:0,shape:"",size:0,supportsDataExplorer:xL.has(r.type||""),value:r.value,truncated:!0,frameId:r.variablesReference}}var CL=require("vscode"),Ob=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new CL.EventEmitter;this.sessionEndedEmitter=new CL.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var nbe=new Set(["In","Out","exit","quit"]),I0=100,Kb=class extends Ob{constructor(t,n,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=n;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new XC.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,n){n&&this.watchKernel(n);let i=n&&this.kernelProvider.getKernelExecution(n),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,p)=>{let m=u[s]?u[s]:"",h=p[s]?p[s]:"";return t.sortAscending?m.localeCompare(h,void 0,{sensitivity:"base"}):h.localeCompare(m,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let c=t.startIndex?t.startIndex:0,l=t.pageSize?t.pageSize:I0;o.pageStartIndex=c;for(let u=c;u<c+l&&u<this.lastKnownVariables.length;u+=1){let p=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=p,o.pageResponse.push(p)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,n){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&n?.resourceUri&&op(n?.resourceUri).toLowerCase()===".ipynb"&&N("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getVariableValueSummary(t){}async getDataFrameInfo(t,n,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),n&&this.watchKernel(n);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:c,code:l}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:l,cleanupCode:a,initializeCode:c,frameId:t.frameId}),p=n?.notebook,m=p?_e(p.uri.path):"";return!m&&this.debugLocation?.fileName&&(m=_e(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:I0,fileName:m}:t}async getDataFrameRows(t,n,i,o,s){if(i-n>I0)throw new Error(`Debugger cannot provide more than ${I0} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:c,initializeCode:l,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:n,endIndex:i}),p=await this.evaluate({code:u,cleanupCode:c,initializeCode:l,frameId:t.frameId});return pL(JSON.parse(p.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(f);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let n=this.debugService.activeDebugSession?.id;n&&this.importedGetVariableInfoScriptsIntoKernel.delete(n)}}watchKernel(t){let n=t.notebook?.uri.toString();if(n&&!this.watchedNotebooks.has(n)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,n))),i.push(t.onDisposed(()=>{this.resetImport(n),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(n)})),this.watchedNotebooks.set(n,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:n,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};P(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;C(`Cannot evaluate ${t}`);return}finally{n&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:n})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:n,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:n,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(n=>{n.type&&xL.has(n.type)&&(n.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,n){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=n.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||nbe.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>b0(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=XC.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let n=XC.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(n){let o=this.debuggingManager.getDebugSession(n);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],c=this.debuggingManager.getDebugMode(n),l;if(c===0){let u=this.debuggingManager.getDebugCell(n);a.source&&u&&a.source.path===u.document.uri.toString()&&(l=await o.customRequest("scopes",{frameId:a.id}))}else{let u=_e(n.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(l=await o.customRequest("scopes",{frameId:a.id}))}l&&(l.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(f,f)}),this.refreshEventEmitter.fire())}}}}};Kb=v([(0,Ga.injectable)(),d(0,(0,Ga.inject)(Ha)),d(0,(0,Ga.named)(Qe.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Ga.inject)(Td)),d(2,(0,Ga.inject)(de)),d(3,(0,Ga.inject)(Kh)),d(4,(0,Ga.inject)(Fh)),d(5,(0,Ga.inject)(Ke))],Kb);var Ou=D(O()),Rd=require("vscode");var dz=require("vscode"),cr=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await dz.commands.executeCommand("setContext",this.name,this.lastValue))}};var yz=require("vscode");var ZC=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(ZC||{});async function mz(r){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,n=await r.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of n){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let c=a[1];return Number(c)>=6?1:2}}return 0}function ew(r){let e=r;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function fz(r){if(ew(r),r.__mode!==2)throw new Error("Invalid launch configuration")}function S0(r,e){switch(r.type){case"event":let t=r;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let n=r;switch(n.command){case"setBreakpoints":let o=n.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(l=>{e(l,{...o.source})});let c={source:o.source,line:a};e(c),o.source=c.source}break;case"breakpointLocations":e(n.arguments);break;case"source":e(n.arguments);break;case"gotoTargets":e(n.arguments);break;default:break}break;case"response":let i=r;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function hz(r){return/~\d+\\/.test(r)}function gz(r,e){return new RegExp(r.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function Kf(r,e){let t=`import debugpy
debugpy.debug_this_thread()`;await r.executeHidden(t),await e.dumpAllCells()}function vz(r){return!!r.header&&r.header.msg_type==="debug_event"}function tw(r){return r.includes("Frame skipped from debugging during step-in")}function wL(r){return r.event==="debugpyAttach"}var x0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;N("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){P(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return wL(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&tw(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await Kf(this.execution,this.debugAdapter),yz.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f))}};var rw=class{constructor(e,t,n,i){this.mode=e;this.debugAdapter=t;this.debugCell=n;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(Td)}trace(e,t){P(`[Debug-Restart] ${e}: ${t}`)}error(e,t){C(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var nw=require("vscode");var C0=class{constructor(e,t,n,i){this.debugAdapter=e;this.debugCell=t;this.execution=n;this.settings=i;N("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){P("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(f,f)}stop(){ne("RunbylineController::stop()"),this.execution.executeHidden("pass").then(f,f),this.debugAdapter.disconnect().then(f,f)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&tw(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){ne(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(f,f),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let n=t.stackFrames[0],i=new nw.Position(n.line,n.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!n.source&&n.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){P(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await Kf(this.execution,this.debugAdapter);let e=We(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(Cm(e,()=>void 0,(n,i)=>{n.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let n={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:_e(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[n],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&nw.commands.executeCommand($.OpenVariableView).then(f,f)}nw.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f)}};var Fb=class{constructor(e,t,n){this.document=e;this.config=t;this.session=n}};var zn=require("vscode");var Lb=class{constructor(e,t,n){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=n;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new zn.EventEmitter}activate(){this.disposables.push(zn.debug.onDidTerminateDebugSession(this.endSession.bind(this)),zn.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await zn.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){ne(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await zn.debug.startDebugging(void 0,e,t)}catch(n){C(`Can't start debugging (${n})`),zn.window.showErrorMessage(b.cantStartDebugging).then(f,f)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){ee(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,n]of this.notebookToDebugger.entries())if(n&&e.id===n.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,n]of this.notebookToDebugger.entries())if(e===t)return n}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),n=this.kernelProvider.get(e);return t&&(!n||n&&n.status==="unknown")&&(n=await ia.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Yt(!1),this.disposables,"jupyterExtension")),n}findEditorForCell(e){let t=e.notebook.uri.toString();return zn.window.visibleNotebookEditors.find(n=>n.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let n=this.findEditorForCell(e);if(!n)return zn.window.showErrorMessage(b.noNotebookToDebug).then(f,f),0;let i=await this.checkForIpykernel6(n.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(f,f);break}case 4:if(t)return await zn.commands.executeCommand("notebook.selectKernel",{notebookEditor:n}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let s=this.controllerRegistration.getSelected(e);if(!s)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:s.connection,controller:s?.controller,resourceUri:e.uri})}let n=t.kernelConnectionMetadata;if(Ft(n)){if(n.kind==="startUsingRemoteKernelSpec"&&n.kernelSpec.metadata?.debugger)return 1;if(n.kind==="connectToLiveRemoteKernel"&&n.kernelModel.metadata?.debugger)return 1}let i=this.kernelProvider.getKernelExecution(t),o=await mz(i);return N("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:o===1?"installed":"notInstalled"}),o}catch(t){C("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await zn.window.showInformationMessage(b.needIpykernel6,{modal:!0},b.setup)===b.setup?(N("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),zn.env.openExternal(zn.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):N("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var lo=require("vscode");var w0=class{constructor(e){this.debugAdapter=e}trace(e,t){P(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(n=>this.debugAdapter.continueDirect(n)))}};var Ub=class{constructor(e,t,n,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=n;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new lo.EventEmitter;this.endSession=new lo.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;ne("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;ew(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new w0(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new lo.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(lo.debug.stopDebugging(this.session).then(f,f),this.disconnect().catch(f),N("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(lo.notebooks.onDidChangeNotebookCellExecutionState(c=>{this.configuration.__cellIndex===c.cell.index&&c.state===lo.NotebookCellExecutionState.Idle&&!this.disconnected&&(N("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(f))},this,this.disposables)),this.disposables.push(lo.workspace.onDidChangeNotebookDocument(c=>{c.contentChanges.forEach(l=>{l.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(f)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(c=>{(c===this.session||c===this.session)&&this.disconnect().catch(f)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){P(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(ne(`Debug IO Pub message: ${JSON.stringify(t)}`),vz(t)){this.trace("event",JSON.stringify(t));for(let n of this.delegates??[])if(await n?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(f)}async handleClientMessageAsync(e){try{if(ne(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let n=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);n&&await this.dumpCell(n.index)}}if(e.type==="request")for(let t of this.delegates??[]){let n=await t?.willSendRequest?.(e);if(n){this.trace("response",JSON.stringify(n)),this.sendMessage.fire(n);return}}await this.sendMessageToJupyterSession(e)}catch(t){C(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new bn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session||this.debugService.activeDebugSession?.id===this.session.id)try{await Promise.all([this.deleteDumpedFiles().catch(e=>U("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){C("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===lo.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=wn(e);for(let[t,n]of this.fileToCell.entries())if(hz(t)&&gz(t,e))return n}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){ee(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){S0(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else C(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(S0(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new bn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;S0(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let n=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);n&&(t.name=_e(n.path),t.path=n.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let n=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await In(this.jupyterSession.kernel,n,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var E0=class extends Ub{constructor(){super(...arguments);this.cellToFile=new Map}async dumpCell(t){let n=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:n.document.getText().replace(/\r\n/g,`
`)}),o=wn(i.sourcePath);this.fileToCell.set(o,n.document.uri),this.cellToFile.set(n.document.uri.toString(),o)}catch(i){C(i)}}translateRealLocationToDebuggerLocation(t){let n=t.source;if(n&&n.path){let i=this.cellToFile.get(n.path);i&&(n.path=i)}}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};var jb=class extends Lb{constructor(t,n,i,o,s,a){super(t,n,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new cr(Sr.RunByLineCells),this.runByLineDocuments=new cr(Sr.RunByLineDocuments),this.debugDocuments=new cr(Sr.DebugDocuments)}activate(){super.activate(),this.disposables.push(Rd.debug.registerDebugAdapterDescriptorFactory(ox,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],n=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),n.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(f),this.runByLineDocuments.set(n).catch(f)}updateDebugContextKey(){let t=new jc;this.notebookToDebugAdapter.forEach((n,i)=>t.add(i.uri)),this.notebookInProgress.forEach(n=>t.add(n.uri)),this.debugDocuments.set(Array.from(t.values())).catch(f)}async tryToStartDebugging(t,n,i=!1){if(ee(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(n);if(o!==1){ee(`Ipykernel check failed: ${ZC[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,n)}runByLineNext(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&n.debugCell.document.uri.toString()===t.document.uri.toString()&&n.continue()}runByLineStop(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&(N("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),n.stop())}async startDebuggingCell(t,n){let i=n.notebook,o=this.configurationService.getSettings(i.uri),s={type:ox,name:_e(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:n.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let n=t.configuration;ew(n);let i=n.__notebookUri,o=Rd.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){ee(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){ee("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){ee("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new Fb(o,n,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(n,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,n,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new E0(n,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new C0(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([c,new rw(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,c),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new x0(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([c,new rw(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new Rd.DebugAdapterInlineImplementation(s)}else Rd.window.showInformationMessage(b.kernelWasNotStarted).then(f,f)}};jb=v([(0,Ou.injectable)(),d(0,(0,Ou.inject)(Ke)),d(1,(0,Ou.inject)(St)),d(2,(0,Ou.inject)(de)),d(3,(0,Ou.inject)(Dr)),d(4,(0,Ou.inject)(ji)),d(5,(0,Ou.inject)(pt))],jb);var iw=D(O()),bz=require("vscode");var Wb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.activeTrackersById=new Map;this.updatedEmitter=new bz.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new Ob(e.id);return this.activeTrackers.set(e,t),this.activeTrackersById.set(e.id,t),t.sessionEnded(()=>{this.activeTrackers.delete(e),this.activeTrackersById.delete(e.id)},this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e)||this.activeTrackersById.get(e.id);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};Wb=v([(0,iw.injectable)(),d(0,(0,iw.inject)(ji)),d(1,(0,iw.inject)(F))],Wb);var k0=D(O()),xz=D(require("net"));var Cz=D(No()),Ff=require("vscode");var Sz=require("events"),Iz=`\r
\r
`,P0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new Sz.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let n=t;typeof n.event=="string"&&this.events.emit(`${t.type}_${n.event}`,n);break}case"request":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}case"response":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(Iz);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+Iz.length);continue}}break}}};var EL=class{constructor(e,t,n){this._id=e;this._configuration=t;this.customRequestHandler=n;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},Vb=class{constructor(e){this.sequence=1;this.breakpointEmitter=new Ff.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new Ff.EventEmitter;this.sessionStartedEvent=new Ff.EventEmitter;this.sessionTerminatedEvent=new Ff.EventEmitter;this.sessionCustomEvent=new Ff.EventEmitter;this.breakpointsChangedEvent=new Ff.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new P0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(n=>n!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,n){let i=t;return i.port?(this.session=new EL((0,Cz.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=xz.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=le();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let n=t,i=n.body.stackFrames?n.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=le(),t=0;return this.protocolParser.once("response_scopes",n=>{this.sendToTrackers(n);let i=n;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(f)}),this.protocolParser.once("response_variables",n=>{this.sendToTrackers(n),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){ee("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(ee("Sending breakpoints"),await this.sendBreakpoints()),ee("Sending debugger attach...");let n=this.sendAttach(e,t);return ee("Sending configuration done"),await this.sendConfigurationDone(),ee("Session started."),n.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(n=>n),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:_e(t),path:t},lines:e.map(n=>n.location.range.start.line),breakpoints:e.map(n=>({line:n.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:ns,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let n=le(),i=this.sessionTerminatedEvent.event(()=>{n.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),ee(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),n.resolve(s.body))}),this.socket?.on("error",s=>n.reject(s)),this.emitMessage(e,t).catch(s=>{C(`Exception attempting to emit ${e} to debugger: `,s)}),n.promise}emitMessage(e,t){return new Promise((n,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);ee(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,c=>{this.sendToTrackers(o),n()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),ee(JSON.stringify(e))}onError(e){this.sendToTrackers(e),ee(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(f),this.socket.destroy(),this.socket=void 0)}};Vb=v([(0,k0.injectable)(),d(0,(0,k0.inject)(F))],Vb);var Il=D(O()),Lf=require("vscode");var Bb=class{constructor(e,t,n){this.vscodeDebugService=t;this.jupyterDebugService=n;this.sessionChangedEvent=new Lf.EventEmitter;this.sessionStartedEvent=new Lf.EventEmitter;this.sessionTerminatedEvent=new Lf.EventEmitter;this.sessionCustomEvent=new Lf.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),n&&(e.push(n.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(n.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(n.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(n.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let n=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(n,i)}return n}registerDebugAdapterTrackerFactory(e,t){let n=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(n,i)}return n}startDebugging(e,t,n){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,n)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():Lf.commands.executeCommand("workbench.action.debug.stop").then(f,f)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};Bb=v([(0,Il.injectable)(),d(0,(0,Il.inject)(F)),d(1,(0,Il.inject)(ji)),d(2,(0,Il.optional)()),d(2,(0,Il.inject)(Ha)),d(2,(0,Il.named)(Qe.RUN_BY_LINE_DEBUGSERVICE))],Bb);var Fu=D(O());var R0=require("vscode");var qb=Symbol("IFileConverter"),Ad=Symbol("IExportBase"),lxt=Symbol("IExport"),Nd=Symbol("IExportUtil");var T0=D(O()),wz=D(require("os"));var Ez=D(No());var Jb=require("vscode");var ow=require("vscode");var ibe={PDF:["pdf"]},obe={HTML:["html","htm"]},sbe={Python:["py"]},za=class{async showDialog(e,t,n){let i={},o;switch(e){case"python":i=sbe,o=".py";break;case"pdf":o=".pdf",i=ibe;break;case"html":o=".html",i=obe;break;case"ipynb":o=".ipynb";let c=b.exportDialogFilter;i[c]=["ipynb"];break;default:return}let s=n||!t?n||"":`${_e(t.path,Qi(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:b.exportButtonTitle,filters:i};return ow.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&ln())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=Pe.instance.get(ok);return ow.Uri.file(Ve(await i.computeWorkingDirectory(e),t))}let n=Ve(dt(e.path),t);return ow.Uri.parse(`${e.scheme}://${n}`).with({authority:e.authority})}};var D0=class{async getContent(e){let t=Jb.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new Jb.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new Jb.NotebookData(i);return o.metadata=JSON.parse(JSON.stringify(e.metadata)),t.exports.exportNotebook(o)}async getTargetFile(e,t,n){return await new za().showDialog(e,t,n)}};var _0=require("vscode");var $b=class extends D0{constructor(t){super();this.fs=t}async getTargetFile(t,n,i){let o;return t!=="python"?o=await new za().showDialog(t,n,i):o=_0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};$b=v([(0,T0.injectable)(),d(0,(0,T0.inject)(gr))],$b);var sw=class{async generateTempDir(){let e=_0.Uri.file(Ve(wz.tmpdir(),(0,Ez.default)())),t=Pe.instance.get(gr);return await t.createDirectory(e),{path:Ae(e),dispose:async()=>{let n=0;for(;n<10;)try{await t.delete(e),n=10}catch{await Di(3e3),n+=1}}}}async makeFileInDirectory(e,t,n){let i=Ve(n,t);return await Pe.instance.get(gr).writeFile(_0.Uri.file(i),e),i}};async function Pz(r){let e=JSON.parse(r);for(let t of e.cells){let n="outputs"in t?t.outputs:void 0;n&&Array.isArray(n)&&abe(n)}return JSON.stringify(e,void 0,4)}function abe(r){let e="image/svg+xml",t="image/png";for(let n of r)if("data"in n){let i=n.data;if(!(e in i))continue;t in i&&delete i[e]}}var Hb=D(O());var Ku=class{constructor(e,t,n){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=n}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(b.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};Ku=v([(0,Hb.injectable)(),d(0,(0,Hb.inject)(Ip)),d(1,(0,Hb.inject)(Pg)),d(2,(0,Hb.inject)(yi))],Ku);var Uf=class{constructor(e,t,n,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=n;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,n,i){}async executeCommand(e,t,n,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),n==="python"){let h=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,h);return}let s=await this.exportUtil.getContent(e);n==="pdf"&&(s=await Pz(s));let a=await new sw().generateTempDir(),c=await this.makeSourceFile(t,s,a),l=await this.getExecutionService(c,i);if(!l||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Qi(t.fsPath)),p=[c.fsPath,"--to",n,"--output",_e(u.filePath),"--output-dir",dt(u.filePath),"--debug"],m=await l.execModule("jupyter",["nbconvert"].concat(p),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(R0.Uri.file(u.filePath))).size>1)await this.fs.copy(R0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(m.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,n){let i=_e(e.fsPath,Qi(e.fsPath)),o=await new sw().makeFileInDirectory(t,`${i}.ipynb`,n.path);return R0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};v([Uv("PerformingExport")],Uf.prototype,"executeCommand",1),Uf=v([(0,Fu.injectable)(),d(0,(0,Fu.inject)(Br)),d(1,(0,Fu.inject)(td)),d(2,(0,Fu.inject)(gr)),d(3,(0,Fu.inject)(Nd)),d(4,(0,Fu.inject)(VP)),d(5,(0,Fu.inject)(Ku))],Uf);var jf=D(O());var Lu=require("vscode");var Gb=class{constructor(){this.fs=Pe.instance.get(ut)}async openFile(e,t,n=!1){if(e==="python")await this.openPythonFile(t,n),N("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,n);N("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let n;if(t)n=await Lu.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await Lu.workspace.openTextDocument({language:xe,content:i});n=await Lu.window.showTextDocument(o)}await n.edit(i=>{i.insert(new Lu.Position(n.document.lineCount,0),`
`)})}async askOpenFile(e,t){let n=b.openExportFileYes,i=b.openExportFileNo,o=[n,i];return await Lu.window.showInformationMessage(b.openExportedFileMessage,...o).then(a=>a)===n?(t?Lu.window.showTextDocument(e).then(f,f):Fp(e.toString()),!0):!1}};var K0=D(O()),F0=require("vscode");var A0=class{async export(e,t,n,i){await Pe.instance.get(Ad).executeCommand(e,t,"python",n,i)}};var N0=class{async export(e,t,n,i){await Pe.instance.get(Ad).executeCommand(e,t,"pdf",n,i)}};var M0=class{async export(e,t,n,i){await Pe.instance.get(Ad).executeCommand(e,t,"html",n,i)}};var PL=require("vscode");var O0=class{constructor(){this.fs=Pe.instance.get(ut),this.configuration=Pe.instance.get(de),this.platform=Pe.instance.get(Dr)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,n){if(n.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata?.isInteractiveWindowMessageCell).reduce((t,n)=>t+this.exportCell(n),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),n=this.getEOL();switch(e.kind){case PL.NotebookCellKind.Code:return`${t}${n}${this.exportCodeCell(e)}${n}${n}`;case PL.NotebookCellKind.Markup:return`${t} [markdown]${n}${this.exportMarkdownCell(e)}${n}${n}`}}return""}exportCodeCell(e){let t=We(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),n=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return ug(t,this.getEOL(),n?cbe:void 0).join("")}exportMarkdownCell(e){let t=We(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return ug(t,this.getEOL(),lbe).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function cbe(r){return/^\s*!/.test(r)||/^\s*%/.test(r)?`# ${r}`:r}function lbe(r){return`# ${r}`}var zb=class{constructor(e,t,n){this.exportUtil=e;this.progressReporter=t;this.configuration=n}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(b.importingIpynb,!0);try{let n=await F0.workspace.openNotebookDocument(e);await this.exportImpl("python",n,void 0,t.token)}finally{t.dispose()}}async export(e,t,n,i){let o=this.progressReporter.createProgressIndicator(b.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,n,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){N("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,n,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,n);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){C("Export failed",s),N("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&C(b.exportToPDFDependencyMessage),this.showExportFailed(b.exportFailedGeneralMessage)}}async performExport(e,t,n,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,n,i):await this.performNbConvertExport(t,e,n,o,i),n&&this.openExportedFile(e,n).catch(f)}async openExportedFile(e,t){await new Gb().openFile(e,t,!0).catch(f)}async performPlainExport(e,t,n,i){if(n)switch(e){case"python":await new O0().export(t,n,i);break}return n}async performNbConvertExport(e,t,n,i,o){try{return await this.exportToFormat(e,n,t,i,o)}finally{}}async exportToFormat(e,t,n,i,o){switch(n){case"python":return new A0().export(e,t,i,o);case"pdf":return new N0().export(e,t,i,o);case"html":return new M0().export(e,t,i,o);default:break}}showExportFailed(e){F0.window.showErrorMessage(`${b.failedExportMessage} ${e}`)}};zb=v([d(0,(0,K0.inject)(Nd)),d(1,(0,K0.inject)(ss)),d(2,(0,K0.inject)(de))],zb);var Qb=class extends zb{constructor(t,n,i,o){super(t,i,o);this.exportUtil=t;this.fs=n}async openExportedFile(t,n){await new Gb().openFile(t,n).catch(f)}};Qb=v([(0,jf.injectable)(),d(0,(0,jf.inject)(Nd)),d(1,(0,jf.inject)(gr)),d(2,(0,jf.inject)(ss)),d(3,(0,jf.inject)(de))],Qb);var cw=D(O()),Wf=require("vscode");var aw=require("vscode");var kL=new WeakMap;async function xl(r,e){let t=r;if(r.isClosed)return!0;let n=kL.has(t)?kL.get(t):Promise.resolve(),i=le(),o=n.finally(async()=>{let s=new aw.WorkspaceEdit,a=e(s);lm(a)&&await a,await aw.workspace.applyEdit(s).then(c=>i.resolve(c),c=>i.reject(c))}).catch(f);return kL.set(t,o),i.promise}var Yb=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,n=e.controller.connection;if(!Nt(t))return;let i=Wf.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===Wf.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===Wf.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,c=n.kind;switch(n.kind){case"connectToLiveRemoteKernel":{a=n.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=n.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=xe;break}default:{C(`Unsupported kernel kind encountered ${c}`);return}}if(!a)return;let l=Tc(a);xl(i.notebook,async()=>{await o.map(async u=>{if(l.toLowerCase()!==u.document.languageId)return Wf.languages.setTextDocumentLanguage(u.document,l).then(f,f)})}).then(f,f)}};Yb=v([(0,cw.injectable)(),d(0,(0,cw.inject)(F)),d(1,(0,cw.inject)(St))],Yb);var Qa=D(O()),br=require("vscode");var Xb=class{constructor(e,t,n,i,o,s,a,c){this.disposableRegistry=e;this.languageService=t;this.configurationService=n;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=c;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(){this.disposableRegistry.push(br.commands.registerCommand($.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(br.commands.registerCommand($.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(br.commands.registerCommand($.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(br.commands.registerCommand($.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(br.commands.registerCommand($.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernel(e?.notebookEditor?.notebookUri).catch(f):this.restartKernel(e).catch(f))),this.disposableRegistry.push(br.commands.registerCommand($.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push(br.commands.registerCommand($.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(f):this.restartKernelAndRunAllCells(e).catch(f)}))}runAllCells(){br.window.activeNotebookEditor&&br.commands.executeCommand("notebook.execute").then(f,f)}addCellBelow(){br.window.activeNotebookEditor&&br.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(f,f)}removeAllCells(){let e=br.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(So(e));xl(e,n=>{let i=br.NotebookEdit.replaceCells(new br.NotebookRange(0,e.cellCount),[new br.NotebookCellData(br.NotebookCellKind.Code,"",t)]);n.set(e.uri,[i])}).then(f,f)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=br.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;P(`Command interrupted kernel for ${B(n.uri)}`);let i=this.kernelProvider.get(n);if(!i){ee("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),br.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(f,f))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=br.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;let i=this.kernelProvider.get(n);if(i)if(P(`Restart kernel command handler for ${B(n.uri)}`),await this.shouldAskForRestart(n.uri)){let o=b.restartKernelMessage,s=b.restartKernelMessageYes,a=b.restartKernelMessageDontAskAgain,c=await br.window.showInformationMessage(o,{modal:!0},s,a);c===a?(await this.disableAskForRestart(n.uri),this.wrapKernelMethod("restart",i).catch(f)):c===s&&this.wrapKernelMethod("restart",i).catch(f)}else this.wrapKernelMethod("restart",i).catch(f)}async wrapKernelMethod(e,t){let n=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(n);try{if(!a)throw new Error("No kernel associated with the notebook");await ia.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:n,controller:a.controller},new Yt(!1),this.disposableRegistry)}catch(c){s?await vp(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCell(c,e,t.resourceUri),!1):br.window.showErrorMessage(c.toString()).then(f,f)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(f),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,br.ConfigurationTarget.Global).catch(f)}};Xb=v([(0,Qa.injectable)(),d(0,(0,Qa.inject)(F)),d(1,(0,Qa.inject)(vs)),d(2,(0,Qa.inject)(de)),d(3,(0,Qa.inject)(Ke)),d(4,(0,Qa.inject)(St)),d(5,(0,Qa.inject)(en)),d(6,(0,Qa.inject)(Ci)),d(7,(0,Qa.inject)(pt))],Xb);var kz=D(O()),Md=require("vscode");var Zb=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?vn(e,!0):"false",n=ro(e)==="notebook"?Md.workspace.notebookDocuments.find(o=>vn(o.uri,!0)===t):void 0,i=n&&Md.window.activeNotebookEditor?.notebook===n?Md.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(Md.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(Md.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=jr()==="Windows",n=Md.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(n)return n;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Zb=v([(0,kz.injectable)()],Zb);var L0=D(O()),Od=require("vscode");var eI=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}activate(){this.isTelemetryDisabled=eP(),Od.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Od.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Od.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Od.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.disposables.push(tP(e=>this.isTelemetryDisabled=e))}dispose(){z(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!Nt(e.cell.notebook)||this.isTelemetryDisabled||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!Nt(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===Od.NotebookCellKind.Markup||e.document.languageId==="raw")return;let n=e.notebook.notebookType===_t?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,n))}sendTelemetry(e,t,n){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),N("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:n}))}};eI=v([(0,L0.injectable)(),d(0,(0,L0.inject)(F))],eI);var U0=D(O());var ube=/(;32m[ ->]*?)(\d+)(.*)/g,tI=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==_t?t:t.map(n=>this.modifyTracebackFrameIPython(e,n))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,c,l)=>(l=l.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${c}${l}
`)),ne(`Trace frame to match: ${t}`);let n=(s,a)=>{let c=s.replace(ube,(u,p,m,h)=>{let g=parseInt(m,10);return`${p}<a href='${e.document.uri.toString()}?line=${g-1}'>${g}</a>${h}`}),l=b.cellAtFormat(Ae(e.document.uri),e.index+1);return c.replace(/.*?\n/,`\x1B[1;32m${l}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return n(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?n(t,o[2]):t}};tI=v([(0,U0.injectable)(),d(0,(0,U0.inject)(de))],tI);var Ya=D(O());var rI=class{constructor(e,t,n,i,o,s){this.packages=e;this.installer=t;this.pythonExtensionChecker=n;this.disposables=i;this.interpreterService=o;this.notebookControllerManager=s}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await ao(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(Yu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};rI=v([(0,Ya.injectable)(),d(0,(0,Ya.inject)(Gp)),d(1,(0,Ya.inject)(qi)),d(1,(0,Ya.optional)()),d(2,(0,Ya.inject)(Ye)),d(3,(0,Ya.inject)(F)),d(4,(0,Ya.inject)(st)),d(5,(0,Ya.inject)(St))],rI);function Dz(r,e){pz(r,e),r.addSingleton(Ie,wf),r.addSingleton(Oh,Xb),r.addSingleton(Ci,Zb),r.addSingleton(Ie,kf),r.addSingleton(gg,tI),r.addSingleton(Ha,Vb,Qe.RUN_BY_LINE_DEBUGSERVICE),r.addSingleton(Sd,Sd),r.addBinding(Sd,Ie),r.addSingleton(Ie,Ib),r.addSingleton(Ie,rI),r.addSingleton(Ie,gb),r.addSingleton(vs,vs),r.addBinding(vs,Ie),r.addSingleton(Ie,Yb),r.addSingleton(Td,jb,void 0,[Ie]),r.addSingleton(Ie,Mb),r.addSingleton(jn,Kb,Qe.DEBUGGER_VARIABLES),r.addSingleton(Ha,Bb,Qe.MULTIPLEXING_DEBUGSERVICE),r.addSingleton(v0,Wb,void 0,[g0]),r.addSingleton(Ie,Nb),r.addSingleton(Ie,eI),r.addSingleton(qb,Qb),r.addSingleton(Ku,Ku),r.addSingleton(Ad,Uf),r.addSingleton(Nd,$b)}var Dn=D(O()),He=require("vscode");var Kd=Symbol("IDataScienceCodeLensProvider"),j0=Symbol("ICodeWatcher"),W0=Symbol("ICodeLensFactory"),nPt=Symbol("IGeneratedCodeStore"),sa=Symbol("IGeneratedCodeStorageFactory"),nI=Symbol("ICodeGeneratorFactory");var V0=Symbol("IInteractiveWindowDebugger"),$i=Symbol("IInteractiveWindowProvider"),B0=Symbol("IInteractiveControllerHelper"),q0=Symbol("IInteractiveWindowDebuggingManager");var J0=require("vscode");async function $0(r){let e=await J0.workspace.openNotebookDocument(r);await J0.window.showNotebookDocument(e)}var aa=require("vscode");var uo=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,am.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,am.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=We(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=We(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var ys=require("vscode");function _z(r,e){let t=mt(r);return t?e==1?b.restartingKernelCustomHeader(t):b.startingNewKernelCustomHeader(t):e==1?b.restartingKernelHeader:b.startingNewKernelHeader}function Tz(r,e){let t=mt(r);return e==1?b.restartedKernelHeader(t||""):b.connectedKernelHeader(t||"")}function lw(r){return r.kind===ys.NotebookCellKind.Markup&&r.metadata?.isInteractiveWindowMessageCell===!0}var H0=class{constructor(e,t){this.notebookDocument=e;this.isDeleted=!1;if(e.cellCount){let n=e.cellAt(e.cellCount);lw(n)&&(this.sysInfoCellPromise=Promise.resolve(n),this.sysInfoCellPromise=this.updateMessage(t))}this.sysInfoCellPromise===void 0&&(this.sysInfoCellPromise=this.createCell(t))}async createCell(e){let t;return await xl(this.notebookDocument,n=>{let i=new ys.NotebookCellData(ys.NotebookCellKind.Markup,e,OS);i.metadata={isInteractiveWindowMessageCell:!0},t=this.notebookDocument.cellCount;let o=ys.NotebookEdit.insertCells(t,[i]);n.set(this.notebookDocument.uri,[o])}),t=t??this.notebookDocument.cellCount-1,this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await xl(this.notebookDocument,n=>{if(t.index>=0&&!this.isDeleted&&lw(t)){n.replace(t.document.uri,new ys.Range(0,0,t.document.lineCount,0),e),n.set(this.notebookDocument.uri,[ys.NotebookEdit.updateCellMetadata(t.index,{isInteractiveWindowMessageCell:!0})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await xl(this.notebookDocument,t=>{if(e.index>=0&&lw(e)){let n=ys.NotebookEdit.deleteCells(new ys.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[n]);return}})}};function G0(r){return/^#\s*!/.test(r)?/^#\s*!\s*%%?/.test(r)?r.replace(/^#\s*!\s*/,""):r.replace(/^#\s*/,""):r}function Rz(r){return new aa.NotebookCellData(aa.NotebookCellKind.Code,r.join(`
`),"python")}function Az(r){return new aa.NotebookCellData(aa.NotebookCellKind.Markup,vP(r).join(`
`),"markdown")}function dbe(r,e,t){let n=We(e,{trim:!1}),i=n[0];if(new uo(r).isMarkdown(i)){let s=-1;return Cm(n,(a,c)=>void 0,(a,c)=>{a&&a.length>0&&s===-1&&(s=t?c:-1)}),s>=0?[Az(n.slice(0,s)),Rz(n.slice(s))]:[Az(n)]}else return[Rz(n)]}function Nz(r,e){let t=new uo(e);for(let n=0;n<r.lineCount;n+=1){let i=r.lineAt(n);if(t.isCell(i.text))return!0}return!1}function uw(r,e){let t=new uo(e),n=[];for(let i=0;i<r.lineCount;i+=1){let o=r.lineAt(i);if(t.isCell(o.text)){if(n.length>0){let s=n[n.length-1];s.range=new aa.Range(s.range.start,r.lineAt(i-1).range.end)}n.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(n.length>=1){let i=r.lineAt(r.lineCount-1),o=n[n.length-1];o.range=new aa.Range(o.range.start,i.range.end)}return n}function DL(r,e){let t=uw(r,e);return Array.prototype.concat(...t.map(n=>{let i=r.getText(n.range);return dbe(e,i,!1)}))}function Mz(r){return r.getCells().filter(e=>!lw(e)).map(e=>{let t=We(e.document.getText(),{trim:!1,removeEmptyEntries:!1});e.metadata.interactiveWindowCellMarker!==void 0&&t.unshift(e.metadata.interactiveWindowCellMarker+`
`);let n=new aa.NotebookCellData(e.kind,t.join(`
`),e.kind===aa.NotebookCellKind.Code?e.document.languageId:"markdown");return e.kind===aa.NotebookCellKind.Code&&(n.outputs=[...e.outputs]),n.metadata=mp()?{custom:Jl(e)}:Jl(e),n})}var pw=require("vscode");var _L=class{constructor(e,t,n){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=le(),this.disposeCallback=t,n&&(this.timeout=setTimeout(this.dispose,n))}},z0=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,n){this.incrementCount();let i=new _L(e,()=>this.decrementCount(),t),o={location:n?pw.ProgressLocation.Notification:pw.ProgressLocation.Window,title:e,cancellable:n!==void 0};return pw.window.withProgress(o,(s,a)=>(a&&n&&a.onCancellationRequested(()=>{n(),i.reject()}),i.promise())).then(f,f),i}async waitWithStatus(e,t,n,i){let o=this.set(t,n,i),s;try{s=await e()}finally{o.dispose()}return s}};var jo=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=n;this.fileSystem=i;this.configuration=o;this.dataScienceCodeLensProvider=s;this.debugService=a;this.configService=c;this.interactiveWindowProvider=l;this.kernelProvider=u;this.dataScienceErrorHandler=p;this.ipynbProvider=m;this.fileConverter=h;this.statusProvider=new z0,He.workspace.isTrusted||He.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand($.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand($.InsertCellBelow,this.insertCellBelow),this.registerCommand($.InsertCellAbove,this.insertCellAbove),this.registerCommand($.DeleteCells,this.deleteCells),this.registerCommand($.SelectCell,this.selectCell),this.registerCommand($.SelectCellContents,this.selectCellContents),this.registerCommand($.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand($.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand($.MoveCellsUp,this.moveCellsUp),this.registerCommand($.MoveCellsDown,this.moveCellsDown),this.registerCommand($.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand($.ChangeCellToCode,this.changeCellToCode),this.registerCommand($.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand($.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand($.AddCellBelow,this.addCellBelow),this.registerCommand($.CreateNewNotebook,this.createNewNotebook),this.registerCommand($.LatestExtension,this.openPythonExtensionPage),this.registerCommand($.EnableDebugLogging,this.enableDebugLogging),this.registerCommand($.ResetLoggingLevel,this.resetLoggingLevel),this.registerCommand($.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand($.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand($.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand($.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),He.commands.registerCommand($.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let n=He.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFile(n.document.uri)}return Promise.resolve()})),this.registerCommand($.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let n=He.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFileAndOutput(n.document.uri)}return Promise.resolve()})),this.registerCommand($.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand($.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand($.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand($.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand($.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand($.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand($.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand($.InteractiveGoToCode,this.goToCodeInInteractiveWindow),He.commands.registerCommand($.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){He.workspace.isTrusted&&(this.registerCommand($.RunAllCells,this.runAllCells),this.registerCommand($.RunCell,this.runCell),this.registerCommand($.RunCurrentCell,this.runCurrentCell),this.registerCommand($.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand($.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(f)}),this.registerCommand($.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand($.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand($.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand($.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand($.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand($.DebugCell,this.debugCell),this.registerCommand($.DebugStepOver,this.debugStepOver),this.registerCommand($.DebugContinue,this.debugContinue),this.registerCommand($.DebugStop,this.debugStop),this.registerCommand($.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand($.OpenVariableView,this.openVariableView),this.registerCommand($.OpenOutlineView,this.openOutlineView),this.registerCommand($.RunToLine,this.runToLine),this.registerCommand($.RunFromLine,this.runFromLine),this.registerCommand($.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand($.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let n=He.commands.registerCommand(e,t,this);this.disposables.push(n)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=He.workspace.textDocuments.filter(n=>_i(n.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(b.documentMismatch(Ae(e)))}}async enableDebugLogging(){this.configService.getSettings().logging.level!=="debug"&&(await this.configService.updateSetting("logging.level","debug",void 0,He.ConfigurationTarget.Global),He.commands.executeCommand("jupyter.reloadVSCode",b.reloadRequired).then(f,f))}async resetLoggingLevel(){this.configService.getSettings().logging.level!=="error"&&(await this.configService.updateSetting("logging.level","error",void 0,He.ConfigurationTarget.Global),He.commands.executeCommand("jupyter.reloadVSCode",b.reloadRequired).then(f,f))}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,He.ConfigurationTarget.Global).catch(f)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,n,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new He.Range(t,n,i,o))}async runAllCellsAbove(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,n)}}async runCellAndAllBelow(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,n)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=He.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=He.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(He.window.activeTextEditor,Cn(e)?void 0:e)}async debugCell(e,t,n,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new He.Range(t,n,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&He.commands.executeCommand("workbench.action.debug.stepOver").then(f,f)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let n=this.kernelProvider.get(t.notebookDocument);n&&(P(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await n.interrupt())}He.commands.executeCommand("workbench.action.debug.stop").then(f,f)}}async debugContinue(){this.debugService?.activeDebugSession&&He.commands.executeCommand("workbench.action.debug.continue").then(f,f)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){He.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(f,f),await He.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=He.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(n=>n.range.end.line>=e.selection.anchor.line&&n.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=He.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){He.env.openExternal(He.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(f,f)}async openVariableView(){return He.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return He.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(n){C("listenForErrors",n),this.dataScienceErrorHandler.handleError(n).then(f,f)}return t}async exportFile(e){let t=Ae(e);if(t&&t.length>0&&this.jupyterExporter){let n=He.window.activeTextEditor;if(n&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=DL(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new za().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},b.exportingFormat,B(e)),o&&t){let s=b.exportOpenQuestion1;await He.window.showInformationMessage(b.exportDialogComplete(B(e)),s)===s&&await $0(o)}}}}}async exportFileAndOutput(e){let t=Ae(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let n=He.window.activeTextEditor;if(n&&n.document&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=DL(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new za().showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},b.exportingFormat,B(e)),await He.workspace.openNotebookDocument(o).then(s=>He.window.showNotebookDocument(s)),await He.commands.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new so(b.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);ee(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);ee(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,n,i){let o=t(n||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=b.importDialogFilter,t={};t[e]=["ipynb"];let n=await He.window.showOpenDialog({openLabel:b.importDialogTitle,filters:t});n&&n.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(n[0])},b.importingFormat,B(n[0]))}async importNotebookOnFile(e){let t=Ae(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},b.importingFormat,B(e))}async scrollToCell(e,t){if(t&&e){let n=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<n.length;i+=1)if(await n[i].hasCell(t)){n[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let n=He.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!n)return;let i=new He.WorkspaceEdit,o=He.NotebookEdit.deleteCells(new He.NotebookRange(0,n.cellCount));i.set(n.uri,[o]),await He.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=He.Uri.parse(e.metadata.interactive.uristring),n=e.metadata.interactive.lineIndex,i=await He.window.showTextDocument(t,{viewColumn:He.ViewColumn.One});i&&(i.revealRange(new He.Range(n,0,n,0)),i.selection=new He.Selection(new He.Position(n,0),new He.Position(n,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),n=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await He.env.clipboard.writeText(n)}}};v([Zr("DATASCIENCE.DEBUG_STEP_OVER")],jo.prototype,"debugStepOver",1),v([Zr("DATASCIENCE.DEBUG_STOP")],jo.prototype,"debugStop",1),v([Zr("DATASCIENCE.DEBUG_CONTINUE")],jo.prototype,"debugContinue",1),v([mr("DATASCIENCE.ADD_CELL_BELOW")],jo.prototype,"addCellBelow",1),v([Zr("DATASCIENCE.EXPORT_PYTHON_FILE")],jo.prototype,"exportFile",1),v([Zr("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],jo.prototype,"exportFileAndOutput",1),v([Zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],jo.prototype,"importNotebook",1),v([Zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],jo.prototype,"importNotebookOnFile",1),jo=v([(0,Dn.injectable)(),d(0,(0,Dn.inject)(F)),d(1,(0,Dn.inject)(Eg)),d(1,(0,Dn.optional)()),d(2,(0,Dn.inject)(bp)),d(2,(0,Dn.optional)()),d(3,(0,Dn.inject)(ut)),d(4,(0,Dn.inject)(de)),d(5,(0,Dn.inject)(Kd)),d(5,(0,Dn.optional)()),d(6,(0,Dn.inject)(ji)),d(6,(0,Dn.optional)()),d(7,(0,Dn.inject)(de)),d(8,(0,Dn.inject)($i)),d(9,(0,Dn.inject)(Ke)),d(10,(0,Dn.inject)(en)),d(11,(0,Dn.inject)(Ci)),d(12,(0,Dn.inject)(qb))],jo);var oI=D(O());var ca=require("vscode");var Q0=class{constructor(e,t,n,i){this.configService=e;this.storage=t;this.notebook=n;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),ca.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),ca.notebooks.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,n,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,n,i)}extractExecutableLines(e){let t=e.interactive.originalSource,n=this.configService.getSettings(this.notebook.uri),i=new uo(n),o=lg(t);if(n.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=G0(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0)}async generateCodeImpl(e,t,n,i){let{lineIndex:o,uristring:s}=e.interactive,a=ca.workspace.textDocuments.find(te=>te.uri.toString()===s);if(!a)return;let{stripped:c,trueStartLine:l}=this.extractStrippedLines(e),u=a.lineAt(l),p=a.lineAt(Math.min(l+c.length-1,a.lineCount-1)),m=0;for(;m<c.length&&c[m].trim().length===0;)m+=1;let h=m+l,g=a.offsetAt(new ca.Position(o,0)),y=a.offsetAt(p.rangeIncludingLineBreak.end),x=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:E,debuggerStartLine:A}=this.addHiddenLines(n,c,l,h,x,i),T=c.join(""),j=a.getText(new ca.Range(new ca.Position(o,0),p.rangeIncludingLineBreak.end)),oe=(await Ea(T,"SHA-1")).substring(0,12),G=this.getRuntimeFile(oe,t),ue=n?-1:0,pe={line:u?u.lineNumber+1:1,endLine:p?p.lineNumber+1:1,firstNonBlankLineIndex:h,debuggerStartLine:A,executionCount:t,startOffset:g,endOffset:y,deleted:!1,code:T,trimmedRightCode:c.map(te=>te.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:j,runtimeLine:E,runtimeFile:G,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:ue,hasCellMarker:x};return ee(`Generated code for ${t} = ${G} with ${c.length} lines`),this.storage.store(ca.Uri.parse(e.interactive.uristring),pe),pe}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let n=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(n,i,t)})}}extractStrippedLines(e){let t=lg(e.interactive.originalSource),{lines:n}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let c=0;c<n.length;c+=1)if(n[c]!==t[c]){i+=c+1;break}}let o=0;for(;o<n.length&&n[o].trim().length===0;)o+=1;let s=n.length-1,a=n.length-2;for(;a>0;){let c=n[s],l=n[a];if((c.length===0||c===`
`)&&(l.length===0||l===`
`))n.splice(s,1),s-=1,a-=1;else break}!n[s].endsWith(`
`)&&n[s].length>0&&(n[s]=`${n[s]}
`);for(let c=0;c<n.length;c++)n[c]=n[c].replace(/\r\n/g,`
`);return{stripped:n,trueStartLine:i}}handleContentChange(e,t,n){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;n.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,n,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:n+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:n}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var Oz=require("vscode");var iI=class{constructor(e,t,n){this.configService=e;this.storageFactory=t;this.disposables=n;this.codeGenerators=new WeakMap}activate(){Oz.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let n=new Q0(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,n),n}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};iI=v([(0,oI.injectable)(),d(0,(0,oI.inject)(de)),d(1,(0,oI.inject)(sa)),d(2,(0,oI.inject)(F))],iI);var Vf=D(O()),Cl=require("vscode");function bs(r){if(r.metadata.interactive!==void 0)return r.metadata}function Kz(r,e,t){let n=We(r,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(n),o=YV(i),s=ug(o,`
`,e.magicCommandsAsComments?G0:void 0);return Dh(s.join(""))}function dw(r){let e=r;return e&&e.input&&Cn(e.input.uri)&&Cn(e.input.inputBoxUri)}var Lz=require("vscode");var mbe=b.runCurrentCellAndAddBelow,fbe=b.addCellBelowCommandTitle,hbe=b.debugCellCommandTitle,gbe=b.debugCellCommandTitle,vbe=b.debugStepOverCommandTitle,ybe=b.debugContinueCommandTitle,bbe=b.debugStopCommandTitle,Ibe=b.runCellLensCommandTitle,Sbe=b.runAllCellsLensCommandTitle,xbe=b.runAllCellsAboveLensCommandTitle,Fz=b.runCellAndAllBelowLensCommandTitle,Cbe=b.scrollToCellTitleFormatMessage,sI=class{constructor(e,t,n,i){this.configService=e;this.generatedCodeStorageFactory=n;this.updateEvent=new Cl.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;Cl.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),Cl.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),Lz.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(o=>{this.notebookData.delete(o.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new Ge,n=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=uw(e,this.configService.getSettings(e.uri)),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(c=>!o?.cachedExecutionCounts.has(c)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){n=!0;let c=this.enumerateCommands(e.uri);P(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${c.join(", ")}`);let l=!0;o.cellRanges.forEach(u=>{c.forEach(p=>{let m=this.createCodeLens(e,u,p,l);m&&o.documentLenses.push(m)}),l=!1})}else ne(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let c=this.generatedCodeStorageFactory.get({fileUri:e.uri}),l=c?c.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;l&&l.length&&o.cellRanges.forEach(u=>{let p=this.createExecutionLens(e,u.range,l);p&&o?.gotoCellLens.push(p)})}return n&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(e.cell.notebook.notebookType!==xt||e.state!==Cl.NotebookCellExecutionState.Idle||!e.cell.executionSummary?.executionOrder)return;let t=bs(e.cell),n=this.notebookData.get(e.cell.notebook.uri.toString());n||(n={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),n)),n!==void 0&&t!==void 0&&(n.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),n.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,n=this.configService.getSettings(e).codeLenses;n?t=n.split(",").map(s=>s.trim()):t=Qu.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(Qu.DefaultDebuggingLenses);let o=[];return Cl.workspace.isTrusted||(o=[...Qu.DebuggerCommands,...Qu.DebuggerCommands,$.RunAllCells,$.RunAllCellsAbove,$.RunAllCellsAbovePalette,$.RunCellAndAllBelowPalette,$.RunCurrentCell,$.RunCurrentCellAdvance,$.RunCurrentCellAndAddBelow,$.RunFileInInteractiveWindows,$.InterruptKernel,$.RunToLine,$.RunCell,$.DebugCell,$.DebugContinue,$.DebugStepOver,$.DebugStop,$.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,n,i){let{range:o,cell_type:s}=t;switch(n){case $.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,$.RunCurrentCellAndAddBelow,mbe);case $.AddCellBelow:return this.generateCodeLens(o,$.AddCellBelow,fbe,[e.uri,o.start.line]);case $.DebugCurrentCellPalette:return this.generateCodeLens(o,$.DebugCurrentCellPalette,hbe);case $.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,$.DebugCell,gbe,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case $.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,$.DebugStepOver,vbe,[e.uri]);case $.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,$.DebugContinue,ybe,[e.uri]);case $.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,$.DebugStop,bbe,[e.uri]);case $.RunCurrentCell:case $.RunCell:return this.generateCodeLens(o,$.RunCell,Ibe,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case $.RunAllCells:return this.generateCodeLens(o,$.RunAllCells,Sbe,[e.uri,o.start.line,o.start.character]);case $.RunAllCellsAbovePalette:case $.RunAllCellsAbove:return i?this.generateCodeLens(o,$.RunCellAndAllBelow,Fz,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,$.RunAllCellsAbove,xbe,[e.uri,o.start.line,o.start.character]);case $.RunCellAndAllBelowPalette:case $.RunCellAndAllBelow:return this.generateCodeLens(o,$.RunCellAndAllBelow,Fz,[e.uri,o.start.line,o.start.character]);default:U(`Invalid command for code lens ${n}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(n=>n.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,n){if(n){let i=n.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,$.ScrollToCell,Cbe(s),[e.uri,o.id])}}}generateCodeLens(e,t,n,i){return new Cl.CodeLens(e,wbe(t,n,i))}};sI=v([(0,Vf.injectable)(),d(0,(0,Vf.inject)(de)),d(1,(0,Vf.inject)(F)),d(2,(0,Vf.inject)(sa)),d(3,(0,Vf.inject)(Ke))],sI);function wbe(r,e,t){return{arguments:t,title:e,command:r}}var wl=D(O()),Xa=D(require("vscode"));var aI=class{constructor(e,t,n,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=n;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new Xa.EventEmitter;i.push(this),i.push(Xa.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=z(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(Xa.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&N("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),z(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[Ul,zw].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(n=>n.uri&&n.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new Ge,n=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,new cr(Sr.HasCodeCells).set(n&&n.length>0).catch(f),this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,n):[]}adjustDebuggingLenses(e,t){let n=Qu.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?Xa.Uri.parse(i.fileName):void 0}catch{}if(i&&(_i(Xa.Uri.file(i.fileName),e.uri,!0)||o&&_i(o,e.uri,!0)))return t.filter(a=>{let c=new Xa.Position(i.lineNumber-1,i.column-1);return a.range.contains(c)}).filter(a=>a.command?n.includes(a.command.command):!1);ne(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!n.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(P(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let n=Xa.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(n&&n.length>0)return P(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(n[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(j0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};aI=v([(0,wl.injectable)(),d(0,(0,wl.inject)(pt)),d(1,(0,wl.inject)(v0)),d(1,(0,wl.optional)()),d(2,(0,wl.inject)(de)),d(3,(0,wl.inject)(F)),d(4,(0,wl.inject)(ji))],aI);var Fd=D(O()),Se=require("vscode");var Bf=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function Ebe(r,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return r<0&&(r+=e),r<0?0:r>=e?e-1:r}var er=class{constructor(e,t,n,i,o){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=n;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new Se.EventEmitter;this.disposables=[this.codeLensUpdatedEvent]}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.disposables.push(this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this))),this.disposables.push(Se.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))),this.disposables.push(Se.workspace.onDidCloseNotebookDocument(this.ondidCloseNotebook.bind(this)))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&N("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),z(this.disposables)}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),n=this.codeLenses.filter(s=>s.command&&s.command.command===$.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=n.length,o=Promise.resolve(!0);for(let s of n){let a=new Se.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===n.length&&(a=new Se.Range(new Se.Position(0,0),a.end));let c=this.document.getText(a);i-=1,o=this.addCode(t,c,this.document.uri,a.start.line,e)}}if(await o,n.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===$.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let c of i)if(o>0&&this.document){let l=new Se.Range(c.range.start,c.range.end);o===s&&(l=new Se.Range(new Se.Position(0,0),l.end)),o-=1;let u=this.document.getText(l);a=this.addCode(n,u,this.document.uri,c.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===$.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let c=o;c>=0&&c<i.length;c+=1)if(s>0&&this.document){let l=i[c];s-=1;let u=this.document.getText(l.range);a=this.addCode(n,u,this.document.uri,l.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&_i(e.document.uri,this.document.uri)){let n=await this.getActiveInteractiveWindow(),i;if(t===void 0||Cn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;let s=this.configService.getSettings(e.document.uri).normalizeSelectionForInteractiveWindow??!0?await this.executionHelper.normalizeLines(i):i;if(!s||s.trim().length===0)return;await this.addCode(n,s,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(e-1),i=this.document.getText(new Se.Range(0,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new Se.Range(e,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let t=e.contains(Se.window.activeTextEditor.selection.start)&&this.configService.getSettings(Se.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=Se.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let e=Se.window.activeTextEditor,t=new uo(this.configService.getSettings(e.document.uri)),n=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let c=e.selection.end.line+1;c<e.document.lineCount;c+=1)if(t.isCell(e.document.lineAt(c).text)){a=!1,n=c,s.insert(new Se.Position(c,0),`${i}

`);break}a&&(n=e.document.lineCount,s.insert(new Se.Position(e.document.lineCount,0),`
${i}
`))}).then(f,f);let o=new Se.Position(n+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new Se.Range(o,o)))}insertCellBelowPosition(){let e=Se.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let n=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,c=0;n.range.start.line>0&&(o=n.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,c=i.range.end.character);let l=new Se.Range(new Se.Position(o,s),new Se.Position(a,c));e.edit(u=>{u.replace(l,""),this.codeLensUpdatedEvent.fire()}).then(f,f)}selectCell(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let n=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new Se.Selection(n.range.start,i.range.end):e.selection=new Se.Selection(i.range.end,n.range.start)}}}selectCellContents(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let n=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let c=n;c<=i;c+=1){let l=s[c],u=l.range.start.line+1,p=0,m=l.range.end.line,h=l.range.end.character;l.range.start.line===l.range.end.line&&(u=l.range.start.line,p=e.document.lineAt(u).range.end.character,m=u,h=p),o?a.push(new Se.Selection(u,p,m,h)):a.push(new Se.Selection(m,h,u,p))}e.selections=a}extendSelectionByCellAbove(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?s<a?u=new Se.Selection(c.range.start,o[a-1].range.end):u=new Se.Selection(c.range.end,c.range.start):u=new Se.Selection(l.range.end,c.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new Se.Selection(c.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?u=new Se.Selection(c.range.start,l.range.end):s<a?u=new Se.Selection(o[s+1].range.start,l.range.end):u=new Se.Selection(l.range.start,l.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new Se.Selection(c.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);n&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);n&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=Se.window.activeTextEditor,n=this.getStartEndCellIndex(t?.selection);if(!t||!n)return;let i=this.cells,o=n[0],s=n[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,n){if(n==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===n)return;let i=new uo(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),c=n==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!c)return;let l=c[c.length-1],u=n==="markdown"?`${a} [markdown]${l}`:`${a}${l}`;e.edit(async p=>{p.replace(o.range,u),t.cell_type=n,t.range.start.line<t.range.end.line&&(e.selection=new Se.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),Se.commands.executeCommand("editor.action.removeCommentLine").then(f,f),n==="markdown"&&Se.commands.executeCommand("editor.action.addCommentLine").then(f,f))}).then(f,f)}async moveCellsDirection(e){let t=Se.window.activeTextEditor;if(!t||!t.selection)return!1;let n=this.getStartEndCellIndex(t.selection);if(!n)return!1;let i=n[0],o=n[1],s=this.cells,a=s[i],c=s[o];if(!a||!c)return!1;let l=new Se.Range(a.range.start,c.range.end),u=new Se.Range(t.selection.start.line-l.start.line,t.selection.start.character,t.selection.end.line-l.start.line,t.selection.end.character),p=t.selection.active.isBefore(t.selection.anchor),m;if(e){if(i===0)return!1;{let h=s[i-1];m=this.exchangeTextLines(t,h.range,l).then(y=>(y&&(t.selection=new Se.Selection(h.range.start.line+u.start.line,u.start.character,h.range.start.line+u.end.line,u.end.character)),y))}}else{if(o===s.length-1)return!1;{let h=s[o+1],g=this.exchangeTextLines(t,l,h.range),y=h.range.end.line-h.range.start.line,x=l.end.line-l.start.line,E=y-x;m=g.then(A=>(A&&(t.selection=new Se.Selection(h.range.start.line+E+u.start.line,u.start.character,h.range.start.line+E+u.end.line,u.end.character)),A))}}return m.then(h=>(h&&p&&(t.selection=new Se.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,n){let i=t.start.line,o=t.end.line,s=n.start.line,a=n.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let c=new Se.Range(i,0,o,e.document.lineAt(o).range.end.character),l=e.document.getText(c),u=new Se.Range(s,0,a,e.document.lineAt(a).range.end.character),p=e.document.getText(u),m="";if(o+1<s){let y=o+1,x=s-1,E=new Se.Range(y,0,x,e.document.lineAt(x).range.end.character);m=`${e.document.getText(E)}
`}let h=`${p}
${m}${l}`,g=new Se.Range(c.start,u.end);return e.edit(y=>{y.replace(g,h),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let n=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[n,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),n=t;if(e.start.line!==e.end.line&&(n=this.getCellIndex(e.end)),t===-1){if(n===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&n>=0)return[t,n]}insertCell(e,t){let n=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${n}
`:`${n}

`,o=new Se.Position(t,0),s=new Se.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(f,f),e.selection=new Se.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Qe.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&_i(e.uri,this.document.uri)&&z(this.disposables)}ondidCloseNotebook(e){e.notebookType===xt&&this.configService.getSettings(this.document?.uri).addGotoCodeLenses&&this.onCodeLensFactoryUpdated()}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,n,i,o){let s=!1;try{o?s=await e.debugCode(t,n,i):s=await e.addCode(t,n,i)}catch(a){a instanceof Bf||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,n){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=Dh(this.document.getText(i.range));if(t){let c=Se.window.activeTextEditor,{newCellOnRunLast:l}=this.configService.getSettings(this.document.uri),u=new uo(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):l&&c&&!u.isEmptyCell(s)&&this.insertCell(c,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,n)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,n=Ebe(e,t.length);return t[n]}getCellFromPosition(e){if(!e){let t=Se.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===$.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===$.RunCell);if(t>=0)return this.codeLenses.find((n,i)=>n.command!==void 0&&n.command.command===$.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===$.RunCell);if(t>=1)return this.codeLenses.find((n,i)=>n.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),n=this.document.getText();await this.addCode(t,n,this.document.uri,0,e)}}advanceToRange(e){let t=Se.window.activeTextEditor,n=new Se.Selection(e.start,e.start);t&&(t.selection=n,t.revealRange(e,Se.TextEditorRevealType.Default))}};v([Zr("DATASCIENCE.DEBUG_CURRENT_CELL")],er.prototype,"debugCurrentCell",1),v([Zr("DATASCIENCE.RUN_ALL_CELLS")],er.prototype,"runAllCells",1),v([Zr("DATASCIENCE.RUN_FILE_INTERACTIVE")],er.prototype,"runFileInteractive",1),v([Zr("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],er.prototype,"debugFileInteractive",1),v([Zr("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],er.prototype,"runAllCellsAbove",1),v([Zr("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],er.prototype,"runCellAndAllBelow",1),v([Zr("DATASCIENCE.RUN_SELECTION_OR_LINE")],er.prototype,"runSelectionOrLine",1),v([Zr("DATASCIENCE.RUN_TO_LINE")],er.prototype,"runToLine",1),v([Zr("DATASCIENCE.RUN_FROM_LINE")],er.prototype,"runFromLine",1),v([ui("CodeWatcher::runCell",4)],er.prototype,"runCell",1),v([Zr("DATASCIENCE.DEBUG_CURRENT_CELL")],er.prototype,"debugCell",1),v([Zr("DATASCIENCE.RUN_CURRENT_CELL")],er.prototype,"runCurrentCell",1),v([Zr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],er.prototype,"runCurrentCellAndAdvance",1),v([mr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],er.prototype,"runCurrentCellAndAddBelow",1),v([mr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],er.prototype,"insertCellBelowPosition",1),v([mr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],er.prototype,"insertCellBelow",1),v([mr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],er.prototype,"insertCellAbove",1),v([mr("DATASCIENCE.RUN_DELETE_CELLS")],er.prototype,"deleteCells",1),v([mr("DATASCIENCE.RUN_SELECT_CELL")],er.prototype,"selectCell",1),v([mr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],er.prototype,"selectCellContents",1),v([mr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],er.prototype,"extendSelectionByCellAbove",1),v([mr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],er.prototype,"extendSelectionByCellBelow",1),v([mr("DATASCIENCE.RUN_MOVE_CELLS_UP")],er.prototype,"moveCellsUp",1),v([mr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],er.prototype,"moveCellsDown",1),v([mr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],er.prototype,"changeCellToMarkdown",1),v([mr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],er.prototype,"changeCellToCode",1),v([mr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],er.prototype,"gotoNextCell",1),v([mr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],er.prototype,"gotoPreviousCell",1),er=v([(0,Fd.injectable)(),d(0,(0,Fd.inject)($i)),d(1,(0,Fd.inject)(de)),d(2,(0,Fd.inject)(dD)),d(3,(0,Fd.inject)(en)),d(4,(0,Fd.inject)(W0))],er);var lI=D(O()),oi=D(require("vscode"));var Ld=require("vscode");var cI=class{constructor(e,t,n){this.configuration=t;this.extensionChecker=n;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(oi.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(oi.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(oi.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){oi.window.activeTextEditor&&this.triggerUpdate(oi.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){oi.window.activeTextEditor&&e.document===oi.window.activeTextEditor.document&&this.triggerUpdate(Ld.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=Ld.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=Ld.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=Ld.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=Ld.window.createTextEditorDecorationType({borderColor:new oi.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?Ld.window.visibleTextEditors:[e];for(let n of t)if(n&&n.document&&n.document.languageId===xe&&!cg(n.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(n.document.uri);if(this.cellDecorationEnabled(i)){let o=uw(n.document,i),s=o.map(u=>u.range).filter(u=>u.contains(n.selection.anchor)),a=s.length>0?[new oi.Range(s[0].start,s[0].start)]:[],c=i.decorateCells!=="allCells"&&s.length>0?[new oi.Range(s[0].end,s[0].end)]:[],l=[];i.decorateCells==="allCells"&&o.forEach(u=>{let p=u.range.start;p!==s[0].start&&l.push(new oi.Range(p,p))}),Ld.window.activeTextEditor===n?(n.setDecorations(this.currentCellTop,a),n.setDecorations(this.currentCellBottom,c),n.setDecorations(this.currentCellTopUnfocused,l),n.setDecorations(this.currentCellBottomUnfocused,[])):(n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[...l,...a]),n.setDecorations(this.currentCellBottomUnfocused,c))}else n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[]),n.setDecorations(this.currentCellBottomUnfocused,[])}}};cI=v([(0,lI.injectable)(),d(0,(0,lI.inject)(F)),d(1,(0,lI.inject)(de)),d(2,(0,lI.inject)(Ye))],cI);var Uz=D(O()),jz=require("vscode");var Y0=class{constructor(){this.codeGeneratorsByFile=new wo}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let n=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<n.length&&!i;o+=1){let s=n[o];t.line>=s.line&&t.line<=s.endLine?(n.splice(o,1,t),i=!0):s.line>t.line&&(n.splice(o,0,t),i=!0)}i||n.push(t),this.codeGeneratorsByFile.set(e,n)}};var uI=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new Y0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=jz.workspace.notebookDocuments.find(n=>this.storages.get(n)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};uI=v([(0,Uz.injectable)()],uI);var Uu=D(O()),Ud=D(require("vscode"));var pI=class{constructor(e,t,n,i){this.variableProvider=e;this.interactiveProvider=t;this.disposables=n;this.kernelProvider=i;this.runFiles=new Set;this.stopWatch=new Ge;this.delayer=new nc(300)}activate(){this.onDidChangeNotebookCellExecutionStateHandler=Ud.notebooks.onDidChangeNotebookCellExecutionState(e=>this.delayer.trigger(()=>this.onDidChangeNotebookCellExecutionState(e)),this),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.delayer.dispose(),this.onDidChangeNotebookCellExecutionStateHandler.dispose(),this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(e.cell.notebook.notebookType!==xt)return;let t=this.runFiles.size,n=bs(e.cell);n!==void 0&&this.runFiles.add(n.interactive.uristring),t!==this.runFiles.size&&(this.initializeHoverProvider(),this.onDidChangeNotebookCellExecutionStateHandler.dispose())}catch(t){C(t)}}async provideHover(e,t,n){this.stopWatch.reset();let i=await xr(300,this.getVariableHover(e,t,n));return N("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=Ud.languages.registerHoverProvider(zj,this))}async getVariableHover(e,t,n){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await sr(n,{},...s.map(l=>this.variableProvider.getVariableProperties(o,l,n))),c=Object.entries(a||{});if(c.length>0){let l=c.reduce((p,m)=>p+`${m[0]}: ${m[1]}
`,"```\n")+"```";return{contents:[new Ud.MarkdownString(l)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let n=new Set;return Ud.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&n.add(o)}),Array.from(n)}};pI=v([(0,Uu.injectable)(),d(0,(0,Uu.inject)(jn)),d(0,(0,Uu.named)(Qe.KERNEL_VARIABLES)),d(1,(0,Uu.inject)($i)),d(2,(0,Uu.inject)(F)),d(3,(0,Uu.inject)(Ke))],pI);var Wo=D(O()),Qr=require("vscode");var Ut=require("vscode");var Wz=D(No());var qf=class{constructor(e,t,n,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=n;this.inputUri=o;this._onDidChangeViewState=new Ut.EventEmitter;this.closedEvent=new Ut.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(ut),this.configuration=this.serviceContainer.get(de),this.jupyterExporter=this.serviceContainer.get(Eg),this.interactiveWindowDebugger=this.serviceContainer.tryGet(V0),this.errorHandler=this.serviceContainer.get(en),this.codeGeneratorFactory=this.serviceContainer.get(nI),this.storageFactory=this.serviceContainer.get(sa),this.kernelProvider=this.serviceContainer.get(Ke),this.debuggingManager=this.serviceContainer.get(q0),this.notebookUri=dw(i)?i.input.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),Ut.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),Ut.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),Ut.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new uo(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=Ut.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.setInfoMessageCell(b.noKernelConnected);else{let e=Ut.workspace.onDidOpenNotebookDocument(t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(t),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(b.noKernelConnected),e.dispose())})}}initController(e){let t=this.controllerFactory.create(e,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(t.listenForControllerSelection()),t}async ensureInitialized(){if(!this.notebookDocument&&(P("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.controller?this.controller.startKernel().catch(f):(ee("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(b.selectKernelForEditor))}async showInteractiveEditor(){let e;Ut.window.tabGroups.all.find(i=>{i.tabs.find(o=>{dw(o)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o)})});let t=this.notebookDocument||await this.openNotebookDocument();return await Ut.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e?.group.viewColumn})}async openNotebookDocument(){return P(`Opening notebook document ${this.notebookUri}`),await Ut.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let n=this.controller?.controller,i=Yh(e);if(n&&i&&t){let o=Ki.getOrCreate(t,new Tf(n));try{await o.appendOutput(i)}catch(s){U(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else ee(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,n){return this.submitCode(e,t,n,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!yt(this.controller.metadata))}async debugCode(e,t,n){let i=!0,o=Ut.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...Ut.workspace.textDocuments];if(i=await o.save(),i){let c=Ut.workspace.textDocuments.filter(l=>a.indexOf(l)===-1);c&&c.length>0&&(t=(c.find(u=>u.languageId==="python")||c.find(u=>!u.fileName.endsWith(".interactive"))||c[0]).uri,await Ut.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,n,!0):s}async submitCode(e,t,n,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=We(e,{trim:!1}),s=new uo(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&Cm(o,(u,p)=>void 0,(u,p)=>{u&&u.length>0&&a===-1&&(a=p)});let l=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let p=le();this.controller.setPendingCellAdd(p.promise);let m=this.addNotebookCell(u,t,n),h=this.createExecutionPromise(m,i);return h.catch(g=>{g instanceof Bf?m.then(y=>{g.cell!==y&&this.showErrorForCell(b.cellStopOnErrorMessage,y).then(f,f)}).catch(f):m.then(y=>this.errorHandler.getErrorMessageForDisplayInCell(g,"execution",this.owningResource).then(x=>this.showErrorForCell(x,y))).catch(f)}).finally(()=>{p?.resolve()}),h});return l[l.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;ne("InteractiveWindow.ts.createExecutionPromise.start");let n=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await n;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&yt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),ne("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let c=bs(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,c?.generatedCode?.code).then(()=>!0,()=>!1),ne("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),ne("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Bf(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await Ut.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===Ut.NotebookCellKind.Code&&await Ut.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),n=t.notebook.getCells().find(i=>bs(i)?.id===e);if(n){let i=new Ut.NotebookRange(n.index,n.index+1);t.revealRange(i,Ut.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(n=>bs(n)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=Dc();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,n){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===OS,a=s?vP(We(e)).join(""):Kz(e,o,this.cellMatcher),c=this.cellMatcher.getFirstMarker(e),l=Ut.workspace.textDocuments.find(g=>g.uri.toString()===this.owner?.toString())?.languageId??xe,u=new Ut.NotebookCellData(s?Ut.NotebookCellKind.Markup:Ut.NotebookCellKind.Code,a,s?OS:l),p={uristring:t.toString(),lineIndex:n,originalSource:e},m={interactiveWindowCellMarker:c,interactive:p,id:(0,Wz.default)()};u.metadata=m,await xl(i,g=>{let y=Ut.NotebookEdit.insertCells(i.cellCount,[u]);g.set(i.uri,[y])});let h=i.cellCount-1;return i.cellAt(h)}async generateCodeAndAddMetadata(e,t,n){let i=bs(e);if(!i)return;let o=!yt(n.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},c=new Ut.WorkspaceEdit,l=Ut.NotebookEdit.updateCellMetadata(e.index,a);c.set(e.notebook.uri,[l]),await Ut.workspace.applyEdit(c)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let e=Mz(this.notebookDocument),t=await new za().showDialog("ipynb",this.owningResource);t&&await this.jupyterExporter?.exportToFile(e,Ae(t))}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value,t;if(this.submitters&&this.submitters.length){let n=this.submitters[this.submitters.length-1];t=_e(n.path,Qi(n.path))}ln()?Ut.commands.executeCommand($.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(f,f):Ut.commands.executeCommand($.Export,this.notebookDocument,t,e?.kernelConnectionMetadata.interpreter).then(f,f)}};v([hA()],qf.prototype,"showErrorForCell",1),v([hA()],qf.prototype,"createExecutionPromise",1);function Vz(r){return b.interactiveWindowTitleFormat(_e(r.path))}var TL=class{constructor(e,t,n,i,o,s,a){this.controllerService=e;this.mode=t;this.notebook=n;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.notebook&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{P("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{C("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=le();e.promise.catch(f),this.kernel=e;try{let{kernel:t,actualController:n}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.notebook,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=n,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){ne("Unable to run initialization for IW");return}let n=Ae(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(P(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(P(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):P(`Not Initializing __file__ in setFileInKernel with ${n} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.notebook&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.notebook,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.notebook||e.notebook.uri.toString()!==this.notebook?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(f):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(f)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>U(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new H0(this.notebook,e)}setInfoMessage(e,t){let n=_z(e,t);this.setInfoMessageCell(n)}finishSysInfoMessage(e,t){let n=Tz(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(n).catch(i=>U(`System info message was not updated: "${n}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(n=>U(`System info message was not updated: "${t}" because of error: ${n}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(f,f),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},mw=class{constructor(e,t,n){this.controllerService=e;this.mode=t;this.initialController=n}create(e,t,n,i){let o=this.initialController,s=this.controllerService.getSelectedController(e);return s&&(o=s),new TL(this.controllerService,this.mode,e,t,n,i,o)}};var Bz="ds_asked_per_file_interactive",qz="ds_interactive_window_cache",dI=class{constructor(e,t,n,i,o,s,a,c){this.serviceContainer=e;this.disposables=t;this.fs=n;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=c;this._onDidChangeActiveInteractiveWindow=new Qr.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Qr.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Qr.window.tabGroups.all.forEach(t=>{t.tabs.forEach(n=>{dw(n)&&n.input.uri&&e.set(n.input.uri.toString(),n)})}),this.workspaceMemento.get(qz,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let n=e.get(t.uriString);if(!n)return;let i=this.configService.getSettings(n.input.uri).interactiveWindowMode,o=new qf(this.serviceContainer,Qr.Uri.parse(t.owner),new mw(this.controllerHelper,i),n,Qr.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset(),this._windows.push(o),N("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Qr.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(f);let i=this.getExisting(e,n,t);return i||(i=await this.create(e,n,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,n){let i=le();this.pendingCreations=i.promise;try{let o=await this.controllerHelper.getInitialController(e,n);ee(`Starting interactive window for resource '${B(e)}' with controller '${o?.id}'`);let[s,a]=await this.createEditor(o,e,t);o&&o.controller.updateNotebookAffinity(a.notebook,Qr.NotebookControllerAffinity.Preferred),P(`Interactive Window Editor Created: ${a.notebook.uri.toString()} with input box: ${s.toString()}`);let c=new qf(this.serviceContainer,e,new mw(this.controllerHelper,t,o),a,s);this._windows.push(c),N("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!o,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=c;let l=c.closed(this.onInteractiveWindowClosed.bind(this,c));return this.disposables.push(c),this.disposables.push(l),this.disposables.push(c.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),c}finally{i.resolve()}}async createEditor(e,t,n){let i=e?`${Je}/${e.id}`:void 0,o=t!==void 0,s=this.getInteractiveViewColumn(t),{inputUri:a,notebookEditor:c}=await Qr.commands.executeCommand("interactive.open",{viewColumn:s,preserveFocus:o},void 0,i,t&&n==="perFile"?Vz(t):void 0);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[a,c]}getInteractiveViewColumn(e){if(e)return Qr.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Qr.ViewColumn.One:t==="active"?Qr.ViewColumn.Active:Qr.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(Bz)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(Bz,!0).then(f,f);let n=[b.interactiveWindowModeBannerSwitchYes,b.interactiveWindowModeBannerSwitchNo];await Qr.window.showInformationMessage(b.interactiveWindowModeBannerTitle,...n)===n[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Qr.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(qz,e).then(f,f)}getExisting(e,t,n){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!n?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!n||i.kernelConnectionMetadata?.id===n.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){P(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Qr.window.activeTextEditor===void 0)return;let e=Qr.window.activeTextEditor.document.uri;if(e.scheme!==Ul)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let n=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,n)?.notebookDocument}return t?Qr.window.visibleNotebookEditors.find(n=>n.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(n=>n.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(n=>this.fs.arePathsSame(e,n)))}};dI=v([(0,Wo.injectable)(),d(0,(0,Wo.inject)(pt)),d(1,(0,Wo.inject)(F)),d(2,(0,Wo.inject)(ut)),d(3,(0,Wo.inject)(de)),d(4,(0,Wo.inject)($e)),d(4,(0,Wo.named)(gt)),d(5,(0,Wo.inject)($e)),d(5,(0,Wo.named)(pi)),d(6,(0,Wo.inject)(Ci)),d(7,(0,Wo.inject)(B0))],dI);var jd=D(O());var mI=class{constructor(e,t,n,i,o){this.kernelProvider=e;this.codeGeneratorFactory=n;this.storageFactory=i;this.controllers=o;this.disposables=[];t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||t.notebookType!==xt||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};mI=v([(0,jd.injectable)(),d(0,(0,jd.inject)(Ke)),d(1,(0,jd.inject)(F)),d(2,(0,jd.inject)(nI)),d(3,(0,jd.inject)(sa)),d(4,(0,jd.inject)(St))],mI);var hI=D(O()),PQ=require("vscode");var EQ=wQ(),Z0=/(;32m[ ->]*?)(\d+)(.*)/g,fI=class{constructor(e,t,n){this.storageFactory=e;this.platformService=t;this.configurationService=n}format(e,t){if(e.notebook.notebookType!==xt)return t;let n=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!n)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,n?.all,s):s?this.modifyTracebackFrameIPython7(a,n.all):a)}modifyTracebackFrameIPython8(e,t,n){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,p,m,h)=>(h=h.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${p}${m}${h}
`)),ne(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,c=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),l=s.exec(e);if(c&&c.groups?.executionCount&&c.groups?.lineNumber?(i=parseInt(c.groups.executionCount),o=c.groups?.lineNumber):l&&l.groups?.executionCount&&l.groups?.lineNumber&&(i=parseInt(l.groups.executionCount),o=l.groups.lineNumber),t&&i){let u,p;for(let m of t)if(p=m.generatedCodes.find(h=>h.executionCount===i),p){u=m.uri;break}if(p&&u){let m=e;return n&&(m=m.replace(Z0,(h,g,y,x)=>{let E=parseInt(y,10),j=(p.hasCellMarker?p.line-1:p.line)-1+p.lineOffsetRelativeToIndexOfFirstLineInCell+E;return`${g}<a href='${u?.toString()}?line=${j-1}'>${j}</a>${x}`})),m.replace(/.*?\n/,`File \x1B[1;32m${Ae(u)}:${o}\x1B[0m
`)}}if(n){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let p=Th(u[1],Ae(this.platformService.homeDir)),m=PQ.Uri.file(p);return e.replace(Z0,(h,g,y,x)=>{let E=parseInt(y,10);return`${g}<a href='${m?.toString()}?line=${E-1}'>${E}</a>${x}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Ae(i),s=B(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${EQ(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${EQ(s)}`).test(e)){let c="",l=/(;32m[ ->]*?)(\d+)(.*)/g;for(let p=l.exec(e);p&&p.length>3;p=l.exec(e)){let m=fl(p[3]).substr(1);c=`${c}${m}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),c);u!==void 0&&(e=e.replace(Z0,(p,m,h,g)=>{let y=parseInt(h,10),x=u+y-1;return`${m}<a href='${i.toString()}?line=${x}'>${x+1}</a>${g}`}))}if(e.includes(o)){let c=this.findCellOffset(a.getFileGeneratedCode(i),e);if(c)return e.replace(Z0,(l,u,p,m)=>{let h=parseInt(p,10),g=c+h-1;return`${u}<a href='${i.toString()}?line=${g}'>${g+1}</a>${m}`})}}}),e}findCellOffset(e,t){if(e){for(let n of e)if(n.trimmedRightCode.indexOf(t)>=0)return n.firstNonBlankLineIndex}}};fI=v([(0,hI.injectable)(),d(0,(0,hI.inject)(sa)),d(1,(0,hI.inject)(Dr)),d(2,(0,hI.inject)(de))],fI);var ju=D(O());var hw=class extends Kn{constructor(e,t,n){let i=t||b.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,n)}};function e1(r){let e={source:{path:Ae(r.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=r.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var gI=class{constructor(e,t,n,i){this.apiProvider=e;this.configService=t;this.debugService=n;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),n=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:n})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(ee("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(ne("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",e1(t))})))}enable(e){e.session?.kernel&&In(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}disable(e){e.session?.kernel&&In(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}async startDebugSession(e,t,n){if(ee("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,n);if(i&&(ee("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await In(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?U(`${this.debuggerPackage} not found in path.`):ee(`import startup: ${Q_(o)}`),await this.disable(t)}}async connect(e,t){let n=e.notebook,i=n,o=this.configs.get(i);if(o)return{...o,...t};ee("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(n,o);let c=[],l=()=>{this.configs.delete(i),c.forEach(u=>u.dispose())};c.push(e.onDisposed(l)),c.push(e.onRestarted(l))}return o}async calculateDebuggerPathList(e){let t=[],n=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(n&&(this.platform.isWindows&&(n=n.replace(/\\/g,"\\\\")),t.push(n)),yt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let n=e.session?.kernel?await In(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];ee(`Appending paths: ${Q_(n)}`)}}async connectToLocal(e){let t=e.session?.kernel?await In(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0)for(let n of t){let i=Q_([n]);if(i){i=um(i);let s=/\('(.*?)', ([0-9]*)\)/.exec(i);if(s)return{port:parseInt(s[2],10),host:s[1]}}}if(t.length>0&&t[0].output_type==="error"){let n=t[0];throw new hw(this.debuggerPackage,n.ename,e.kernelConnectionMetadata)}throw new hw(b.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};gI=v([(0,ju.injectable)(),d(0,(0,ju.inject)(tr)),d(1,(0,ju.inject)(de)),d(2,(0,ju.inject)(Ha)),d(2,(0,ju.named)(Qe.MULTIPLEXING_DEBUGSERVICE)),d(3,(0,ju.inject)(Dr))],gI);var El=D(O()),Wd=require("vscode");var t1=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;this._ready=le();this.ready=this._ready.promise;N("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){P(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return wL(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&tw(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=bs(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=Kf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=Kf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var r1=class extends Fb{constructor(){super(...arguments);this._ready=le();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var RL=require("vscode");var n1=class extends Ub{constructor(t,n,i,o,s,a,c){super(t,n,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];c&&(this.debugLocationTracker=c.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(l=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(l)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return ne(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let n=this.notebookDocument.cellAt(t),i=bs(n);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||n.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=wn(s.sourcePath);this.fileToCell.set(a,RL.Uri.parse(i.interactive.uristring));let c=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(c=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:RL.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:c+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((l,u)=>u.metadata.interactive.lineIndex-l.metadata.interactive.lineIndex)}catch(o){C(`Failed to dump cell for ${n.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,n){if(n=t?.source??n,!n||!n.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===n.path);i&&(n.name=_e(i.interactiveWindow.path),n.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,n){let i=t.line;if(n=t?.source??n,!n||!n.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==n.path||(n.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let n=t.arguments;if(delete n.lines,n.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let p=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(m=>u.line>=m.metadata.generatedCode.line&&u.line<=m.metadata.generatedCode.endLine);if(p&&p.metadata.interactive.lineIndex!==i)a(),i=p.metadata.interactive.lineIndex,o=[u];else if(p)o.push(u);else{let m={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[m]}}))}}a();let c=await Promise.all(s),l=JSON.parse(JSON.stringify(c[0]));return c.slice(1).forEach(u=>{l.body.breakpoints=l.body.breakpoints.concat(u.body.breakpoints??[])}),l.command="setBreakpoints",l.type="response",l.success=!0,l.request_seq=t.seq,l}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var kQ=require("vscode");var i1=class{constructor(e){this.debugCell=e}trace(e,t){P(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),kQ.window.showWarningMessage(b.restartNotSupported,{modal:!0}).then(f,f),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var vI=class extends Lb{constructor(t,n,i,o,s,a,c){super(t,n,c);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(Wd.debug.registerDebugAdapterDescriptorFactory(sx,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,n){ne("Starting debugging IW"),await this.checkIpykernelAndPrompt(n)===1&&await this.startDebuggingCell(t,n)}async startDebuggingCell(t,n){let i=this.configService.getSettings(t.uri),o={type:sx,name:_e(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:n.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){C("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let n=t.configuration;fz(n);let i=Wd.workspace.notebookDocuments.find(s=>s.uri.toString()===n.__notebookUri);if(!i||typeof n.__cellIndex!="number"){C("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){ee("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){ee("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new r1(i,n,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(n,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,n,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){Wd.window.showInformationMessage(b.kernelWasNotStarted).then(f,f);return}let a=new n1(n,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let c=i.cellAt(t.__cellIndex),l=new t1(a,c,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([l,new i1(c)]),l.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new Wd.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,n){let i=this.getDebugSession(t.notebook);i&&(ne("Sending debug request for source map"),await Promise.all(n.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",e1(o))})))}};vI=v([(0,El.injectable)(),d(0,(0,El.inject)(Ke)),d(1,(0,El.inject)(St)),d(2,(0,El.inject)(Dr)),d(3,(0,El.inject)(g0)),d(4,(0,El.inject)(de)),d(5,(0,El.inject)(ji)),d(6,(0,El.inject)(pt))],vI);var gw=D(O()),vw=require("vscode");var DQ="InteractiveShiftEnterBanner";var Vd=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=dN.bannerMessage;this.bannerLabels=[ve.bannerLabelYes,ve.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(N("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await vw.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,vw.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,vw.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};v([Zr("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],Vd.prototype,"disableInteractiveShiftEnter",1),v([Zr("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],Vd.prototype,"enableInteractiveShiftEnter",1),Vd=v([(0,gw.injectable)(),d(0,(0,gw.inject)(sc)),d(1,(0,gw.inject)(de))],Vd);var Jf=D(O()),_Q=require("vscode");var yI=class{constructor(e,t,n,i){this.configService=e;this.fs=t;this.context=n;this.registry=i;this.priority=5}activate(){this.registry.register(this,xt)}async getCode(e){if(!It(e.kernelConnectionMetadata))return[];if(!ln()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!yt(e.kernelConnectionMetadata))return[]}if(e.notebook?.notebookType===xt){if(!yt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(_Q.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return We(t,{trim:!1})}return[]}};yI=v([(0,Jf.injectable)(),d(0,(0,Jf.inject)(de)),d(1,(0,Jf.inject)(ut)),d(2,(0,Jf.inject)(lt)),d(3,(0,Jf.inject)($l))],yI);var II=D(O()),SI=require("vscode");var bI=class{constructor(e,t,n){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=n}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(SI.languages.registerFoldingRangeProvider([Gw],this))}provideFoldingRanges(e,t,n){if([Ul,zw].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return n.isCancellationRequested||o.length==0?void 0:o.map(s=>new SI.FoldingRange(s.range.start.line,s.range.end.line,SI.FoldingRangeKind.Region))}}};bI=v([(0,II.injectable)(),d(0,(0,II.inject)(Kd)),d(1,(0,II.inject)(lt)),d(2,(0,II.inject)(de))],bI);var yw=D(O());var TQ=require("vscode");var xI=class{constructor(e,t){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(TQ.languages.registerCodeLensProvider([Gw],this.dataScienceCodeLensProvider))}};xI=v([(0,yw.injectable)(),d(0,(0,yw.inject)(Kd)),d(1,(0,yw.inject)(lt))],xI);var la=D(O());var AL="LastInteractiveKernelSelected",CI=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=n;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t){if(t){let n=this.controllerRegistration.get(t,xt);if(n)return n}if(this.workspaceMemento.get(AL)){let n=this.workspaceMemento.get(AL),i=n?this.controllerRegistration.get(n,xt):void 0;if(i)return i}if(this.interpreterService)return await oIe(xt,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,n,i,o){await ea(n,e);let s=(u,p)=>{u!=="start"&&u!=="restart"||ne(`(onStart) Looking for controller ${p.controller.id} in ${this.controllerRegistration.all.map(m=>`${m.kind}:${m.id}`).join(", ")}`)},a=await ia.connectToNotebookKernel(e,this.serviceContainer,{resource:n||i.uri,notebook:i,controller:t},new Yt(!1),o,"jupyterExtension",s),c=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!c)throw Error(`Controller ${a.controller.id} not found or not yet created`);let l=c.controller;return this.interpreterService&&sIe(a.kernelConnectionMetadata,n,this.interpreterService).then(async u=>{await this.workspaceMemento.update(AL,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{U("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:l}}};CI=v([(0,la.injectable)(),d(0,(0,la.inject)(St)),d(1,(0,la.inject)(st)),d(1,(0,la.optional)()),d(2,(0,la.inject)(F)),d(3,(0,la.inject)($e)),d(3,(0,la.named)(pi)),d(4,(0,la.inject)(pt))],CI);async function oIe(r,e,t,n){let i=await t.getActiveInterpreter(e);if(i){let o=await Us(i),s=zo.create({kernelSpec:o,interpreter:i,id:Fi(o,i)}),a=n.addOrUpdate(s,[r]),c=a[0];return n.trackActiveInterpreterControllers(a),ne(`Active Interpreter Controller ${c.connection.kind}:${c.id} created for View ${r} with resource ${B(e)}`),c}}async function sIe(r,e,t){return(await t.getActiveInterpreter(e))?.id===r.interpreter?.id}function RQ(r){r.addSingleton($i,dI),r.addSingleton(B0,CI),r.addSingleton(Ie,jo),r.addSingleton(Ie,pI),r.add(j0,er),r.addSingleton(W0,sI),r.addSingleton(Kd,aI),r.addSingleton(Ie,xI),r.addSingleton(Ie,bI),r.addSingleton(Ie,cI),r.addSingleton(Ie,mI),r.addSingleton(Ie,yI),r.addSingleton(nI,iI,void 0,[Ie]),r.addSingleton(sa,uI),r.addSingleton(gg,fI),r.addSingleton(V0,gI),r.addSingleton(q0,vI,void 0,[Ie]),r.addSingleton(M2,Vd,DQ)}var Bd=D(O()),Pl=require("vscode");var wI=class{constructor(e,t,n){this.jupyterServerHelper=e;this.fileSystem=t;this.errorHandler=n;this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython(),t=await pp(e);return e&&t&&t.major||3}}async exportToFile(e,t,n=!0){let i=await this.serialize(e);try{if(await this.fileSystem.writeFile(Pl.Uri.file(t),i||""),!n)return;let o=b.exportOpenQuestion1;Pl.window.showInformationMessage(b.exportDialogComplete(t),o).then(async s=>{try{s===o&&await $0(Pl.Uri.file(t))}catch(a){await this.errorHandler.handleError(a)}},f)}catch(o){C("Error in exporting notebook file"),Pl.window.showInformationMessage(b.exportDialogFailed(o)).then(f,f)}}async serialize(e,t){let n=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:n},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${n}`,version:n},kernelspec:t},o=Pl.extensions.getExtension("vscode.ipynb")?.exports;if(!o)throw new Error("vscode.ipynb extension not found");let s=new Pl.NotebookData(e);return s.metadata=mp()?{custom:{metadata:i,nbformat:US.major,nbformat_minor:US.minor}}:{metadata:i,nbformat:US.major,nbformat_minor:US.minor},o.exportNotebook(s)}};wI=v([(0,Bd.injectable)(),d(0,(0,Bd.inject)(bp)),d(0,(0,Bd.optional)()),d(1,(0,Bd.inject)(ut)),d(2,(0,Bd.inject)(en))],wI);var qd=D(O()),AQ=require("vscode");var EI=class{constructor(e,t,n,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=n;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>b.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>Ph(bh.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let n=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(n){let i;n.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(b.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Qe.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(AQ.Uri.file(t.filePath),Ph(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};EI=v([(0,qd.injectable)(),d(0,(0,qd.inject)(gr)),d(1,(0,qd.inject)(F)),d(2,(0,qd.inject)(de)),d(3,(0,qd.inject)(Pg)),d(4,(0,qd.inject)(BP))],EI);var ua=D(O());var Is=require("vscode");var o1=class{constructor(e,t,n,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=n;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand($.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand($.ExportToHTML,(e,t,n)=>this.export(e,"html",t,n)),this.registerCommand($.ExportToPDF,(e,t,n)=>this.export(e,"pdf",t,n)),this.registerCommand($.Export,(e,t,n)=>this.export(e,void 0,t,n)),this.registerCommand($.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let n=Is.commands.registerCommand(e,t,this);this.disposables.push(n)}async nativeNotebookExport(e){let t=Cn(e)?e:e?.notebookEditor?.notebookUri,n=t?Is.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):Is.window.activeNotebookEditor?.notebook;if(n){let i,o=this.kernelFinder.registered.find(c=>c.kind==="localPythonEnvironment"),s=new Is.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(n,o,s.token).then(c=>c?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(n)?.connection.interpreter||i;return this.export(n,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,n,i){if(!e){if(e=Is.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){ee("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&N("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,n,i);else{let o=await this.showExportQuickPickMenu(e,n,i).then(s=>s);o!==void 0?o.handler():N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,n){let i=[];return(n||e.metadata&&NP(So(e)))&&i.push({label:b.exportPythonQuickPickLabel,picked:!0,handler:()=>{N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),Is.commands.executeCommand($.ExportAsPythonScript,e,n).then(f,f)}}),i.push({label:b.exportHTMLQuickPickLabel,picked:!1,handler:()=>{N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),Is.commands.executeCommand($.ExportToHTML,e,t,n).then(f,f)}},{label:b.exportPDFQuickPickLabel,picked:!1,handler:()=>{N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),Is.commands.executeCommand($.ExportToPDF,e,t,n).then(f,f)}}),i}async showExportQuickPickMenu(e,t,n){let i=this.getExportQuickPickItems(e,t,n),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:b.exportAsQuickPickPlaceholder};return Is.window.showQuickPick(i,o)}};var s1=require("vscode");var PI=class{constructor(e,t,n,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=n;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new o1(this.fileConverter,this.fs,this.interactiveProvider,o,new Dd(a),s),s1.workspace.isTrusted||s1.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){s1.workspace.isTrusted&&this.exportCommand?.register()}};PI=v([(0,ua.injectable)(),d(0,(0,ua.inject)(F)),d(1,(0,ua.inject)(qb)),d(2,(0,ua.inject)(ut)),d(3,(0,ua.inject)($i)),d(3,(0,ua.optional)()),d(4,(0,ua.inject)(St)),d(5,(0,ua.inject)(Or)),d(6,(0,ua.inject)(dn))],PI);var Jd=D(O()),DI=require("vscode");var NQ=require("vscode");var NL="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",aIe=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),cIe=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),kI=class{constructor(e,t,n){this.controllerManager=e;this.globalMemento=n;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){z(this.disposables)}activate(){DI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!Nt(e))return;let t=OP(So(e));t&&this.recommendExtensionForLanguage(t).catch(f)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||It(e.connection))return;let t=Co(e.connection);t&&this.recommendExtensionForLanguage(t).catch(f)}async recommendExtensionForLanguage(e){let t=cIe.get(e.toLowerCase());if(!t||NQ.extensions.getExtension(t))return;let n=aIe.get(t);if(!n||this.globalMemento.get(NL,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=b.recommendExtensionForNotebookLanguage(`[${n.displayName}](${n.extensionLink})`,e);switch(N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await DI.window.showInformationMessage(i,ve.bannerLabelYes,ve.bannerLabelNo,ve.doNotShowAgain)){case ve.bannerLabelYes:{N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),DI.commands.executeCommand("extension.open",t).then(f,f);break}case ve.bannerLabelNo:{N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case ve.doNotShowAgain:{N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(NL,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(NL,s));break}default:N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};kI=v([(0,Jd.injectable)(),d(0,(0,Jd.inject)(St)),d(1,(0,Jd.inject)(F)),d(2,(0,Jd.inject)($e)),d(2,(0,Jd.named)(gt))],kI);var kl=D(O()),Hi=require("vscode");var _I=class{constructor(e,t,n,i,o){this.interactiveProvider=e;this.kernelProvider=n;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;t.push(this),this.nativeContext=new cr(Sr.IsNativeActive),this.canRestartNotebookKernelContext=new cr(Sr.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new cr(Sr.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new cr(Sr.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new cr(Sr.CanInterruptInteractiveWindowKernel),this.interactiveContext=new cr(Sr.IsInteractiveActive),this.interactiveOrNativeContext=new cr(Sr.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new cr(Sr.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new cr(Sr.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new cr(Sr.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new cr(Sr.HaveNativeCells),this.isPythonNotebook=new cr(Sr.IsPythonNotebook),this.isJupyterKernelSelected=new cr(Sr.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new cr(Sr.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new cr(Sr.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){Hi.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),Hi.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(Hi.window.activeNotebookEditor),Hi.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),Hi.window.activeTextEditor?.document.languageId===xe&&this.onDidChangeActiveTextEditor(Hi.window.activeTextEditor),Hi.window.onDidChangeNotebookEditorSelection(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Hi.workspace.onDidOpenNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Hi.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(Hi.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(f)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(f),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===_t:!1;this.nativeContext.set(t).catch(f),this.isPythonNotebook.set(e&&t?NP(So(e.notebook)):!1).catch(f),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(){this.hasNativeNotebookOrInteractiveWindowOpen.set(Hi.workspace.notebookDocuments.some(e=>e.notebookType===_t||e.notebookType===xt)).catch(f)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===_t?this.kernelProvider.get(e.notebook):void 0;if(t){let n=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||n.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(f);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(f)}else this.canRestartNotebookKernelContext.set(!1).catch(f),this.canInterruptNotebookKernelContext.set(!1).catch(f);this.updateKernelSourceContext(t).catch(f),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!Ft(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(f);return}let t=e.kernelConnectionMetadata,n=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!n){this.kernelSourceContext.set("").catch(f);return}this.kernelSourceContext.set(n.id).catch(f)}updateSelectedKernelContext(){let e=Hi.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&Nt(e)&&this.controllers.getSelected(e)?this.isJupyterKernelSelected.set(!0).catch(f):this.isJupyterKernelSelected.set(!1).catch(f)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let n=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!n).catch(f);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(f)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(f),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(f);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===xt?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===_t&&t===Hi.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(Hi.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===xe&&!o2(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(f),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(f)}};_I=v([(0,kl.injectable)(),d(0,(0,kl.inject)($i)),d(0,(0,kl.optional)()),d(1,(0,kl.inject)(F)),d(2,(0,kl.inject)(Ke)),d(3,(0,kl.inject)(St)),d(4,(0,kl.inject)(Qt))],_I);var a1=D(O()),Vo=require("vscode");var lIe=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,uIe=1e3,pIe=Nr(),TI=class{constructor(e,t=1e3){this.pendingChecks=new wo;this.disposables=new En;this.sentMatches=new Set;e.push(this.disposables),this.disposables.add(new Vo.Disposable(()=>z(this.pendingChecks.values()))),this.isTelemetryDisabled=eP(),this.disposables.add(Vo.workspace.onDidOpenNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(Vo.workspace.onDidCloseNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(Vo.workspace.onDidSaveNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave")));let n=new nc(t);this.disposables.add(Vo.notebooks.onDidChangeNotebookCellExecutionState(i=>{n.trigger(()=>{i.state==Vo.NotebookCellExecutionState.Pending&&!this.isTelemetryDisabled&&this.checkNotebookCell(i.cell,"onExecution").catch(f)})},this)),this.disposables.add(tP(i=>this.isTelemetryDisabled=i))}activate(){Vo.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let n=0;n<Math.min(uIe,e.lineCount);n++){let i=e.lineAt(n);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!Nt(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let n=this.pendingChecks.get(e);if(n&&(n.dispose(),this.pendingChecks.delete(e)),pIe)t();else{let i=setTimeout(t,5e3);this.pendingChecks.set(e,new Vo.Disposable(()=>clearTimeout(i)))}}async checkNotebookDocument(e,t){!Nt(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async n=>this.checkNotebookCell(n,t)))}async checkNotebookCell(e,t){if(!(!Nt(e.notebook)||e.kind!==Vo.NotebookCellKind.Code||e.document.languageId!==xe))try{let n=e.notebook.notebookType===_t?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),n,t)}catch(n){if(!ci)throw n}}lookForImports(e){let t=[];try{for(let n of e){if(!n.includes("import")&&!n.includes("from"))continue;let i=n?lIe.exec(n):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,n){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${n}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await vt(i);N("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:n})}))}};TI=v([(0,a1.injectable)(),d(0,(0,a1.inject)(F))],TI);var Dl=D(O());var ML=require("vscode");var RI=class{constructor(e,t,n,i){this.disposableRegistry=e;this.configuration=t;this.rawSupported=n;this.commandListeners=i;this.isDisposed=!1;this.startTime=Date.now();this.onSettingsChanged=()=>{let t=this.configuration.getSettings(void 0).sendSelectionToInteractiveWindow;new cr(Sr.OwnsSelection).set(t).catch(f)}}get activationStartTime(){return this.startTime}activate(){this.onSettingsChanged(),this.changeHandler=this.configuration.getSettings(void 0).onDidChange(this.onSettingsChanged.bind(this)),this.disposableRegistry.push(this),this.disposableRegistry.push(ML.window.onDidChangeActiveTextEditor(()=>this.onChangedActiveTextEditor())),this.onChangedActiveTextEditor(),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new cr(Sr.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(f,f)}onChangedActiveTextEditor(){let e=new cr(Sr.HasCodeCells),t=ML.window.activeTextEditor;t&&t.document.languageId===xe?e.set(Nz(t.document,this.configuration.getSettings())).catch(f):e.set(!1).catch(f)}};RI=v([(0,Dl.injectable)(),d(0,(0,Dl.inject)(F)),d(1,(0,Dl.inject)(de)),d(2,(0,Dl.inject)(bi)),d(2,(0,Dl.optional)()),d(3,(0,Dl.multiInject)(Oh))],RI);var wi=D(O()),c1=require("vscode");var Hf=D(O()),$f=require("vscode");var OQ=require("vscode");var OL="JUPYTER_API_ACCESS_INFORMATION",MQ=new Set([Je.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),KL=new Set(["rchiodo","nuant"]),Wu=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new Ch}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===xh?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===$f.ExtensionMode.Test||!t||qs()==="insiders"){if(!MQ.has(t)&&!KL.has(t)){U(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=OQ.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;$f.window.showErrorMessage(b.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(f,f)}if(!KL.has(t)||!t||this.context.extensionMode===$f.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(MQ.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!KL.has(t))return $f.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(f,f),C(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(OL)?.find(s=>s.extensionId===e.extensionId);if(i)return N("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=b.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,ve.bannerLabelYes),c=await $f.window.showInformationMessage(s,{modal:!0},ve.bannerLabelYes,ve.bannerLabelNo)===ve.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let l=[...this.globalState.get(OL,[])];return l=l.filter(u=>u.extensionId!==e.extensionId),l.push({allowed:c?"yes":"no",extensionId:e.extensionId}),this.globalState.update(OL,l)}).then(f,f),N("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:c?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:c}})();return this.extensionAccess.set(e.extensionId,o),o}};Wu=v([(0,Hf.injectable)(),d(0,(0,Hf.inject)($e)),d(0,(0,Hf.named)(gt)),d(1,(0,Hf.inject)(lt))],Wu);var KQ=new WeakMap;function FL(r){let e=KQ.get(r);return e||(e=dIe(r),KQ.set(r,e)),e}function dIe(r){return new Proxy(r,{get(e,t){return t==="kernel"?e.kernel?mIe(e.kernel):void 0:Reflect.get(e,t)}})}var FQ=new WeakMap;function mIe(r){let e=FQ.get(r);return e||(e=fIe(r),FQ.set(r,e)),e}function fIe(r){return new Proxy(r,{get(e,t){return t==="registerCommTarget"?(n,i)=>(wG(r,n),Reflect.get(e,t).apply(e,[n,i])):t==="removeCommTarget"?(n,i)=>(EG(r,n),Reflect.get(e,t).apply(e,[n,i])):Reflect.get(e,t)}})}var AI=class{constructor(e,t,n,i,o,s,a,c){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=n;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=c;this.chainedApiAccess=new Ch;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let n=new bw(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,n),n}};AI=v([(0,wi.injectable)(),d(0,(0,wi.inject)(Ke)),d(1,(0,wi.inject)(Or)),d(2,(0,wi.inject)(Pm)),d(3,(0,wi.inject)(F)),d(4,(0,wi.inject)(St)),d(5,(0,wi.inject)(Wu)),d(6,(0,wi.inject)(Sa)),d(7,(0,wi.inject)(pt))],AI);var bw=class{constructor(e,t,n,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=n;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new c1.EventEmitter;this._onDidChangeKernels=new c1.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new c1.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(c=>{ne(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(c=>{ne(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(c=>{ne(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(c=>{ne(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),P(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.kernelProvider.get(n.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.thirdPartyKernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.thirdPartyKernelProvider.get(n.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.controllerRegistration.registered.forEach(n=>{n.controller.notebookType===_t&&n.connection.kind==="connectToLiveRemoteKernel"&&(!n.connection.kernelModel.id||t.has(n.connection.kernelModel.id)||e.push({metadata:n.connection,uri:void 0,id:n.id}))}),e}getKernel(e){N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:FL(t.session)}}async startKernel(e,t){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let n=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!n)throw new Error("Not found");let i=await ia.connectToKernel(n,this.serviceContainer,{resource:t},new Yt(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return FL(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(Fs.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};bw=v([d(1,(0,wi.inject)(Ke)),d(2,(0,wi.inject)(Or)),d(3,(0,wi.inject)(Pm)),d(4,(0,wi.inject)(F)),d(5,(0,wi.inject)(St)),d(6,(0,wi.inject)(pt))],bw);var l1=D(O()),_l=require("vscode");var LQ=require("vscode");var Gf=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(f)}getActiveResource(){let e=LQ.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(_l.workspace.workspaceFolders)&&_l.workspace.workspaceFolders.length>0?_l.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await a8(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==xe)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(_l.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let n=_l.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(n?n.uri:void 0).catch(f)}addHandlers(){this.disposables.push(_l.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=_l.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(_l.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),n=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(_l.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return Ns(e,"")}};v([Nh("Failed to activate a workspace")],Gf.prototype,"activateWorkspace",1),Gf=v([(0,l1.injectable)(),d(0,(0,l1.inject)(ut))],Gf);var MI=D(O());var NI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){C(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};NI=v([(0,MI.injectable)(),d(0,(0,MI.optional)()),d(0,(0,MI.multiInject)(Ie))],NI);var Iw=D(O()),pa=require("vscode");var LL=Symbol("ISurveyBanner");var Tl=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[GE.bannerLabelYes,GE.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner");let n=setTimeout(()=>{Tl.surveyDelay=!0},10*60*1e3);this.disposables.push(new pa.Disposable(()=>clearTimeout(n)))}isEnabled(e){switch(e){case 0:if(qs()==="insiders")return this.isEnabledInternal(e);break;case 1:if(qs()==="stable")return this.isEnabledInternal(e);break;default:return C("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return pa.env.uiKind!==pa.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){this.onDidChangeNotebookCellExecutionStateHandler=pa.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){let t=this.shouldShowBanner(e);if(this.onDidChangeNotebookCellExecutionStateHandler?.dispose(),!t)return;switch(this.disabledInCurrentSession=!0,await pa.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return om()||!this.isEnabled(e)||this.disabledInCurrentSession||!Tl.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){Fp(this.getSurveyLink(e))}async disable(e,t){let n=e===0?6:4;n&&await this.showBannerState.get(t).updateValue({expiry:n*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return C("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){Nt(e.cell.notebook)&&e.state===pa.NotebookCellExecutionState.Executing&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(f),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(f))}async updateStateAndShowBanner(e,t){if(!this.shouldShowBanner(t)){this.onDidChangeNotebookCellExecutionStateHandler?.dispose();return}let n=this.persistentState.createGlobalPersistentState(e,0);await n.updateValue(n.value+1),this.showBanner(t).catch(f)}getBannerMessage(e){switch(e){case 0:case 1:return mN.bannerMessage;default:return C("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return C("Invalid Banner type"),""}}};Tl.surveyDelay=!1,Tl=v([(0,Iw.injectable)(),d(0,(0,Iw.inject)(sc)),d(1,(0,Iw.inject)(F))],Tl);var Za=require("vscode");function UQ(r,e){e&&Za.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let n of r.globalState.keys())t.push(r.globalState.update(n,void 0).then(f,f));for(let n of r.workspaceState.keys())t.push(r.workspaceState.update(n,void 0).then(f,f));t.push(Za.commands.executeCommand($.ClearSavedJupyterUris).then(f,f)),await Promise.all(t).catch(f),await Promise.all([Za.workspace.fs.delete(Za.Uri.joinPath(r.globalStorageUri,"lastExecutedRemoteCell.json")).then(f,f),Za.workspace.fs.delete(Za.Uri.joinPath(r.globalStorageUri,"remoteServersMRUList.json")).then(f,f),Za.workspace.fs.delete(Za.Uri.joinPath(r.globalStorageUri,Ay)).then(f,f)]),ee("Cache cleared")})}function jQ(r,e){UQ(r,e)}var d1=D(O()),$t=require("vscode");var u1=b.percentPipCondaInstallInsteadOfBang("pip"),UL=b.percentPipCondaInstallInsteadOfBang("conda"),WQ=b.matplotlibWidgetInsteadOfOther,p1="Jupyter",OI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=$t.languages.createDiagnosticCollection(p1),this.disposables.push(this.problems),e.push(this)}dispose(){z(this.disposables),this.problems.dispose()}activate(){this.disposables.push($t.languages.registerCodeActionsProvider(xe,this)),this.disposables.push($t.languages.registerHoverProvider(xe,this)),$t.workspace.onDidChangeTextDocument(t=>{let n=cg(t.document);if(!n)return;let i=n.getCells().find(o=>o.document===t.document);i&&this.analyzeNotebookCell(i)},this,this.disposables),$t.workspace.onDidCloseNotebookDocument(t=>{this.problems.delete(t.uri);let n=this.notebooksProcessed.get(t);this.notebooksProcessed.delete(t),n&&n.forEach((i,o)=>this.problems.delete($t.Uri.parse(o)))},this,this.disposables),$t.workspace.onDidOpenNotebookDocument(t=>this.analyzeNotebook(t),this,this.disposables);let e=new nc(300);this.disposables.push(e),$t.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>{let n=this.notebooksProcessed.get(t.notebook);t.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{n?.delete(o.document.uri.toString())}),i.addedCells.forEach(o=>this.queueCellForProcessing(o))}),t.cellChanges.forEach(i=>this.queueCellForProcessing(i.cell))})},this,this.disposables),$t.workspace.notebookDocuments.map(t=>this.analyzeNotebook(t))}provideHover(e,t,n){if(cg(e)?.notebookType!==_t)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(c=>c.message===u1||c.message===UL);if(!s||!s.range.contains(t))return;let a=s.message===u1?"pip":"conda";return new $t.Hover(b.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,n,i){if(!cg(e))return[];let o=[];return n.diagnostics.forEach(s=>{switch(s.message){case u1:o.push(this.createReplaceCodeAction(e,"pip",s));break;case UL:o.push(this.createReplaceCodeAction(e,"conda",s));break;case WQ:o.push(this.createGotoWikiAction(e,$t.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,n){let i=new $t.CodeAction(b.replacePipCondaInstallCodeAction(t),$t.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[n];let o=new $t.WorkspaceEdit;return o.replace(e.uri,new $t.Range(n.range.start,new $t.Position(n.range.start.line,n.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,n){let i=new $t.CodeAction(b.matplotlibWidgetCodeActionTitle,$t.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[n],i.command={title:b.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===_t&&e.getCells().forEach((t,n)=>n<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;this.cellsToProcess.delete(e),this.analyzeNotebookCell(e),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==$t.NotebookCellKind.Code||e.document.languageId!==xe||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let n=0;n<Math.min(e.document.lineCount,50);n++){let i=e.document.lineAt(n),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new $t.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:u1,range:c,severity:$t.DiagnosticSeverity.Error,source:p1}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new $t.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:UL,range:c,severity:$t.DiagnosticSeverity.Error,source:p1}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,c=new $t.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:WQ,range:c,severity:$t.DiagnosticSeverity.Warning,source:p1}])}}}};OI=v([(0,d1.injectable)(),d(0,(0,d1.inject)(F))],OI);var v1=D(O()),Ir=require("vscode");var VQ=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function m1(r){if(r>=300)return"ZZZZZZZ";if(r<=25)return`A${String.fromCharCode(65+r)}`;let e=String.fromCharCode(65+Math.ceil(r/25)),t=String.fromCharCode(65+r%25);return`${e}${t}`}var QQ=require("vscode");var zf=require("vscode");var gIe=new Map([["julia",IIe],["python",yIe],["r",SIe]]);function BQ(r,e){let t=gIe.get(e.toLowerCase());return t?t(r):r}var vIe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function yIe(r){let e=We(r,{trim:!1,removeEmptyEntries:!1}),t=-1,n=!1,i=!1,o=[],s=new Set,a=!1,c="",l=!1,u=!1;if(e.map((m,h)=>{if(h===0){let y=["Signature:","Init signature:"].find(x=>m.toLowerCase().startsWith(x.toLowerCase()));if(y){n=!0,m=m.substring(y.length).trim(),o.push("```python"),m.trim().length&&(o.push(m),l=!0);return}}if(m.startsWith("File:")&&h===e.length-1||m.startsWith("Type:")&&h===0)return;if(!a&&m.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let g=vIe.find(y=>m.trim().toLowerCase().startsWith(y.toLowerCase()));if(g&&!s.has(g)){c=g.toLowerCase(),s.add(g),a=!0,t=h,i=!1,n&&o.push("```","----------"),n=!1,u=!1,c!=="docstring:"&&o.push(`## ${g}`);let y=m.includes(":")?m.split(":")[1].replace("<no docstring>","").trim():"";y.length&&(o.push(y),l=!0);return}if(!i){if(t+1===h&&m.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=h,i=!1,n=!1,u=!1;return}if(c==="parameters"||c==="see also"){m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="options:"){m.startsWith("-")&&m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="returns"){m.trim().length&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="examples"&&!n&&(t+1===h||t+2===h))return i=!1,n=!0,l=l||m.trim().length>0,o.push("```python",m);if(!n&&m.startsWith("class ")&&m.trim().endsWith("):")){n=!0,u=!0,o.push("```python",m),l=l||m.trim().length>0;return}if(n&&u&&m.trim().length>0&&m.substring(0,1)!==" "&&m.substring(0,1)!=="	")return n=!1,u=!1,o.push(m,"```");l=l||m.trim().length>0,o.push(m)}}),!l)return"";let p=o.join(`  
`);return n?new zf.MarkdownString(p+"  \n```"):new zf.MarkdownString(p)}var bIe=[{section:"Examples:",header:"Examples",nextLine:/≡/g},{section:"Usage note",header:"Usage note",nextLine:/≡/g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:String.fromCharCode(9474)}];function IIe(r){let e=We(r,{trim:!1,removeEmptyEntries:!1}),t=!1,n=[],i=new Set,o="",s=!1,a=!1;e.every(l=>l.trim().length===0||l.startsWith("  "))&&e.forEach((l,u)=>e[u]=l.trim().length?l.substring(2):l),e.map((l,u)=>{if(l.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,n.push(l);if(!a)return o="signature",t=!0,a=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");o==="signature"&&l.trim()===""&&(o="",t=!1,s=!1,n.push("```"));let p=bIe.find(m=>l.trim().toLowerCase().startsWith(m.header.toLowerCase()));if(p&&(typeof p.nextLine=="string"?e[u+1].trim()===p.nextLine.trim():e[u+1].trim().replace(p.nextLine,"").length===0)){e[u+1]="",o=p.section.toLowerCase(),i.add(p.header),t&&n.push("```"),t=!1,n.push(`## ${p.section}`),o==="note:"&&!e.slice(u+1).every(m=>m.trim().length===0||m.trim().startsWith("|")||m.trim().startsWith(String.fromCharCode(9474)))&&(o="");return}if(o==="examples:"&&!t)return t=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");if(o==="note:"){n.push(l.trim()?l.trim().substring(1):"");return}t&&!s&&l.trim().length===0||n.push(l)});let c=n.join(`  
`);return t?new zf.MarkdownString(c+"  \n```"):new zf.MarkdownString(c)}function SIe(r){let e=We(r,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,c)=>e[c]=a.indexOf("     ")===0?a.substring(5):a);let n="",i=!1,o=!1;e.map(a=>{let c=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes(String.fromCharCode(8))&&a.split("_").length===a.split(String.fromCharCode(8)).length&&c){i&&t.push("```"),i=!1,n=c.trim().toLowerCase(),t.push(`## ${c}`);return}if((n==="examples"||n==="examples:"||n==="usage"||n==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(n==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new zf.MarkdownString(s+"  \n```"):new zf.MarkdownString(s)}var JQ=D(O());var KI=class{execCodeInBackgroundThread(e,t,n){return Qf(e,t,n)}};KI=v([(0,JQ.injectable)()],KI);var qQ=new WeakMap;async function Qf(r,e,t){let n=qQ.get(r)||0;qQ.set(r,n+1);let i=WP(Je,r),o=`application/vnd.vscode.bg.execution.${n}`,s=`application/vnd.vscode.bg.execution.${n}.result`,a=`application/vnd.vscode.bg.execution.${n}.error`,c="",l=`
def __jupyter_exec_background__():
    from IPython.display import display
    from threading import Thread
    from traceback import format_exc

    # First send a dummy response to get the display id.
    # Later we'll send the real response with the actual data.
    # And that can happen much later even after the execution completes,
    # as that response will be sent from a bg thread.
    output = display({"${o}": ""}, raw=True, display_id=True)

    def do_implementation():
        ${e.map((m,h)=>h===0?m:`        ${m}`).join(`
`)}

    def bg_main():
        try:
            output.update({"${s}": do_implementation()}, raw=True)
        except Exception as e:
            output.update({"${a}": format_exc()}, raw=True)


    Thread(target=bg_main, daemon=True).start()


__jupyter_exec_background__()
del __jupyter_exec_background__
`.trim(),u=new En;u.add(t.onCancellationRequested(()=>u.dispose()));let p=sr(t,new Promise((m,h)=>{u.add(i.onDidReceiveDisplayUpdate(async g=>{if(t.isCancellationRequested)return m(void 0);let y=km(g);if(!c||y?.transient?.display_id!==c)return;let x=g.items.find(E=>E.mime===s);if(x)try{return m(JSON.parse(new TextDecoder().decode(x.data)))}catch(E){return h(new Error("Failed to parse the result",E))}}))})).finally(()=>{r.session&&$9(r.session,c),u.dispose()});for await(let m of i.executeCode(l,t)){if(t.isCancellationRequested)return;let h=km(m);if(!h?.transient?.display_id)continue;if(m.items.find(y=>y.mime===o)){c=h.transient.display_id;continue}if(c===h.transient.display_id){let y=m.items.find(x=>x.mime===s||x.mime===a);if(y?.mime===s)return JSON.parse(new TextDecoder().decode(y.data));if(y?.mime===a){U(`Error in background execution:
`,new TextDecoder().decode(y.data));return}}}if(!t.isCancellationRequested){if(!c){U("Failed to get display id for completions");return}return p}}var xIe=1,$d=ai.IntellisenseResolveTimeout,$Q=5,jL=new WeakSet,f1=class extends Error{constructor(){super("Request timed out")}};async function YQ(r,e,t,n,i,o,s,a){if(!r.range||!n.session?.kernel||jL.has(n)||!It(n.kernelConnectionMetadata)&&n.status!=="idle")return r;let c=AIe(e||r,s,a),l=RIe(c,n,t),u=_g(t);try{let p=await wh($d,new f1,sr(u.token,l));if(!t.isCancellationRequested&&p?.status==="ok"&&p?.found){let m=CIe(p);r.documentation=BQ(m,o)}}catch(p){if(p instanceof QQ.CancellationError)return r;p instanceof f1&&(u.cancel(),wIe(n,o,i))}finally{u.dispose()}return r}function CIe(r){return!r||r.status!=="ok"||!r.found?";":!r.data||typeof r.data!="object"?"":"text/plain"in r.data?fl(r.data["text/plain"]):""}var HQ=new WeakSet;function wIe(r,e,t){It(r.kernelConnectionMetadata)||jL.has(r)||(jL.add(r),U(`Failed to inspect code in kernel ${mt(r.kernelConnectionMetadata)}`),HQ.has(r)||(HQ.add(r),N("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:r.kernelConnectionMetadata.kind,kernelLanguage:e})))}var WL=new WeakMap,VL=new WeakMap;async function EIe(r,e,t){let n=`return get_ipython().kernel.do_inspect("${Ex(e.code)}", ${e.cursor_pos}, ${e.detail_level})`;return{content:await Qf(r,[n],t)}}var GQ={data:{},found:!1,status:"ok",metadata:{}};function PIe(r,e){if(!r.session?.kernel)return;let t=JSON.stringify(e);return WL.get(r.session.kernel)?.get(t)}function kIe(r,e,t){if(!r.session?.kernel||t.status!=="ok"||!t.found)return;let n=JSON.stringify(e),i=WL.get(r.session.kernel)||new Map;WL.set(r.session.kernel,i),i.size>100&&i.clear(),i.set(n,t)}function DIe(r){if(!r.session?.kernel)return!1;let e=VL.get(r.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};return!It(r.kernelConnectionMetadata)&&e.maxTime>$d?(U(`Not sending inspect request as previous requests took over ${$d}s.`),!1):e.numberOfTimesMaxedOut>$Q?(U(`Not sending inspect request as there have been at least ${$Q} requests that took over ${$d}s.`),!1):e.maxTime>$d&&Date.now()-e.lastRequestTime<3e4?(U(`Not sending inspect request as previous requests took over ${$d}s.`),!1):!0}async function _Ie(r,e){if(!r.session?.kernel||!zQ(r))return;ee(`Too many pending requests ${XQ(r)} for kernel ${r.id}, waiting for it to be ready.`);let t=r.session.kernel,n=[];await sr(e,new Promise(i=>{let o=()=>{if(!zQ(r)){i(),z(n);return}setInterval(o,100)};Da(e.onCancellationRequested)(()=>{i(),t.statusChanged.disconnect(o)},void 0,n),t.statusChanged.connect(o),n.push({dispose:()=>{t.statusChanged.disconnect(o)}})})).finally(()=>z(n))}function TIe(r,e){if(!r.session?.kernel)return;let t=VL.get(r.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};t.maxTime=Math.max(t.maxTime,e),t.lastRequestTime=Date.now(),e>$d&&(t.numberOfTimesMaxedOut+=1),VL.set(r.session.kernel,t)}async function RIe(r,e,t){if(!e.session?.kernel)return;let n=PIe(e,r);if(n)return n;if(!DIe(e)||(await _Ie(e,t),t.isCancellationRequested))return GQ;let i=NIe(e),o=new Ge,s=We(r.code).reverse()[0].slice(-50);P(`Inspecting code ${s}`);let a=It(e.kernelConnectionMetadata)?EIe(e,r,t):e.session.kernel.requestInspect(r);return a.finally(()=>i.dispose()),a.then(({content:c})=>{if(!e.session?.kernel)return;kIe(e,r,c),TIe(e,o.elapsedTime);let l=o.elapsedTime>$d?U:P;return t.isCancellationRequested?l(`Inspected code ${s} in ${o.elapsedTime}ms (but cancelled)`):l(`Inspected code ${s} in ${o.elapsedTime}ms`),c})}function AIe(r,e,t){let n=e.getText(),i=(typeof r.insertText=="string"?r.insertText:r.insertText?.value)||(typeof r.label=="string"?r.label:r.label.label)||"",o=n.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}var Sw=new WeakMap;function zQ(r){return r.session?.kernel?XQ(r)>=xIe:!1}function XQ(r){return r.session?.kernel?(Sw.has(r.session?.kernel)||Sw.set(r.session?.kernel,{count:0}),Sw.get(r.session?.kernel)?.count||0):0}function NIe(r){if(!r.session?.kernel)return{dispose:f};let e=Sw.get(r.session?.kernel)||{count:0};return Sw.set(r.session?.kernel,e),e.count+=1,{dispose:()=>{e.count-=1}}}var g1=class extends Error{constructor(){super("Request timed out")}},BL=class{constructor(e,t,n){this.kernelId=e;this.kernel=t;this.monacoLanguage=n;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,n,i){if(!this.kernel.session?.kernel)return[];let o=e.version;if(this.pendingCompletionRequest.has(e))return[];this.pendingCompletionRequest.set(e,{position:t,version:o});let s=new Ir.Disposable(()=>{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===o&&this.pendingCompletionRequest.delete(e)});try{let a=Es(sr(n,Promise.resolve(Ir.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(m=>m?.items||[]))),c=new Ge;if(await Di(50),n.isCancellationRequested)return[];let l=await wh(ai.IntellisenseTimeout,new g1,this.provideCompletionItemsFromKernel(e,t,n,i));if(n.isCancellationRequested||!l||!l.length)return[];let u=await xr(0,a.promise);It(this.kernel.kernelConnectionMetadata)&&!a.completed&&c.elapsedTime<ai.IntellisenseTimeout+50&&(u=await xr(ai.IntellisenseTimeout-c.elapsedTime,a.promise));let p=new Set((u||[]).map(m=>typeof m.label=="string"?m.label:m.label.label));return l.filter(m=>!p.has(typeof m.label=="string"?m.label:m.label.label))}catch(a){if(a instanceof g1)return[];throw a instanceof Ir.CancellationError||P("Completions failed",a),a}finally{s.dispose()}}async provideCompletionItemsFromKernel(e,t,n,i){if(n.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new Ge,s={duration:0,timesExceededTimeout:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:b1(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(!It(this.kernel.kernelConnectionMetadata)&&this.kernel.status!=="idle")return[];let c=e.getText(),l=e.offsetAt(t);a.requestSent=!0;let u=await sr(n,this.getKernelCompletion(c,l,n));if(P(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=n.isCancellationRequested,a.completed=!n.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=n.isCancellationRequested?0:o.elapsedTime,n.isCancellationRequested)return[];if(u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return eY(this.kernel,s,a),[];let p={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},m=p.metadata?p.metadata._jupyter_types_experimental:[];s.completionItems=p.matches.length,eY(this.kernel,s,a);let h={code:c,cursor:p.cursor,documentRef:new WeakRef(e),position:e.positionAt(p.cursor.start)},g=new Ir.Range(e.positionAt(p.cursor.start),e.positionAt(p.cursor.end)),y=[];return Array.isArray(m)&&m.length>=p.matches.length&&m.every(x=>x&&typeof x.text=="string")?y=u.content.matches.map((x,E)=>{let A=m[E],T=A.type?VQ.get(A.type):Ir.CompletionItemKind.Field,j=new Ir.CompletionItem(x,T);return typeof A.start=="number"&&typeof A.end=="number"?j.range=new Ir.Range(e.positionAt(A.start),e.positionAt(A.end)):j.range=g,j.insertText=A.text,j.sortText=m1(E),It(this.kernel.kernelConnectionMetadata)&&(x.startsWith("%")||x.startsWith("!"))&&(j.sortText=`ZZZ${j.sortText}`),this.previousCompletionItems.set(j,{...h,originalCompletionItem:JSON.parse(JSON.stringify(j))}),j}):y=p.matches.map((x,E)=>{let A=new Ir.CompletionItem(x);return A.range=g,A.sortText=m1(E),It(this.kernel.kernelConnectionMetadata)&&(x.startsWith("%")||x.startsWith("!"))&&(A.sortText=`ZZZ${A.sortText}`),this.previousCompletionItems.set(A,{...h,originalCompletionItem:A}),A}),It(this.kernel.kernelConnectionMetadata)?FIe(i.triggerCharacter,this.allowStringFilterForPython,y,e,t):y}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let n=this.previousCompletionItems.get(e);if(!n)return e;let{documentRef:i,position:o,originalCompletionItem:s}=n,a=i.deref();return a?YQ(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o):e}async getKernelCompletion(e,t,n){if(this.kernel.session?.kernel)return It(this.kernel.kernelConnectionMetadata)?this.getPythonKernelCompletion(e,t,n):sr(n,this.kernel.session.kernel.requestComplete({code:e,cursor_pos:t}))}async getPythonKernelCompletion(e,t,n){let i=`return get_ipython().kernel.do_complete("${Ex(e)}", ${t})`;return{content:await Qf(this.kernel,[i],n)}}},ZQ=new WeakMap,h1=new WeakMap;function eY(r,e,t){let n=ZQ.get(r),i=h1.get(r)?.count||0;e.duration>=ai.IntellisenseTimeout&&h1.set(r,{count:i+1,measures:e,properties:t}),e.timesExceededTimeout=i,n?n.elapsedTime>6e4&&(N("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),n.reset(),h1.delete(r)):(N("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),n=new Ge,ZQ.set(r,new Ge),h1.delete(r))}var qL=class extends or{constructor(t,n){super();this.kernel=t;this.notebookEditorProvider=n;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=y1(this.kernel);this.registerCompletionProvider(),this._register(Ir.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(tY(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||this.registerCompletionProvider()}))}registerCompletionProvider(){if(!tY(this.kernel.notebook.uri))return;let t=MIe(this.kernel);if(t.length===0){OIe(this.kernel);return}P(`Registering Kernel Completion Provider from kernel ${mt(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider?.dispose(),this.completionProvider=void 0,this.completionProvider=Ir.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,n,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await vt(this.kernel.kernelConnectionMetadata.id);s=new BL(a,this.kernel,this.monacoLanguage),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,n,i,o).then(a=>(a.forEach(c=>this.completionItemsSent.set(c,s)),a))}async resolveCompletionItem(t,n){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,n):t}},Hd=class extends or{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=Pe.instance.get(Ke);this._register(t.onDidStartKernel(async n=>{if(n.session?.kernel&&It(n.kernelConnectionMetadata)&&n.session.kernel.requestComplete({code:"__file__.",cursor_pos:9}),!y1(n)||this.kernelCompletionProviders.has(n))return;let o=Pe.instance.get(Ci),s=this._register(new qL(n,o));this.kernelCompletionProviders.set(n,s)})),this._register(t.onDidDisposeKernel(n=>{this.kernelCompletionProviders.get(n)?.dispose()}))}};Hd=v([(0,v1.injectable)(),d(0,(0,v1.inject)(F))],Hd);function y1(r){return Tc(b1(r))}function b1(r){let e="";switch(r.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=r.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;default:e=r.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function tY(r){return Ir.workspace.getConfiguration("jupyter",r).get("enableKernelCompletions",!1)}function MIe(r){let e=Ir.workspace.getConfiguration("jupyter",r.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=b1(r),n=y1(r);return t in e?Array.isArray(e[t])?e[t]:[]:n in e?Array.isArray(e[n])?e[n]:[]:[]}function OIe(r){let e=b1(r),t=y1(r);e.toLowerCase()===t.toLowerCase()?U(Ir.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,mt(r.kernelConnectionMetadata),`{${e}`)):U(Ir.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,mt(r.kernelConnectionMetadata),`{${e}`,`{${t}`))}function KIe(r,e){let t=r.indexOf('"'),n=r.indexOf("'"),i=r.lastIndexOf('"'),o=r.lastIndexOf("'"),s=t>=0?t:n,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function FIe(r,e,t,n,i){let o=t,s=i.character===0?void 0:new Ir.Range(i.line,i.character-1,i.line,i.character),c=(s?n.getText(s):void 0)===".",l=n.getWordRangeAtPosition(c||r==="."?new Ir.Position(i.line,i.character-1):i),u=l&&s?l.union(s):void 0,p=n.lineAt(i.line).text,m=u?n.getText(u):p,h=m.endsWith(".")||c,g=e&&(r=="'"||r=='"'||KIe(p,i));return ne(`Jupyter completions filtering applied: ${g} on ${p}`),o=o.map((y,x)=>{let E=typeof y.label=="string"?y.label:y.label.label,A=typeof y.label=="string"?y.label:y.label.label;if(A.startsWith("%")||A.startsWith("!"))return{...y,sortText:`ZZZ${y.sortText}`};if(g)return y;let T=m?A.indexOf(m):-1,j,oe,G;if(m&&h&&A.includes(m)){j=A.substring(A.indexOf(m)+(h?m.length:0)),oe=A.substring(A.indexOf(m)+m.length);let ue=(typeof y.label=="string"?y.label.length:y.label.label.length)-oe.length;G=y.range&&"start"in y.range?new Ir.Range(new Ir.Position(y.range.start.line,y.range.start.character+ue),y.range.end):y.range}if(!oe&&T>0){j=A.substring(A.indexOf(m)+(h?m.length:0)),oe=A.substring(A.indexOf(m)+m.length);let ue=(typeof y.label=="string"?y.label.length:y.label.label.length)-oe.length;G=y.range&&"start"in y.range?new Ir.Range(new Ir.Position(y.range.start.line,y.range.start.character+ue),y.range.end):y.range}return j&&oe&&G&&(y.label=j,E=oe,y.insertText=oe,y.filterText=h?`.${oe}`:oe,y.range=G,y.sortText=m1(x)),E.endsWith("/")?{...y,command:{command:"editor.action.triggerSuggest",title:""}}:(E.includes(" ")&&(E=E.replace(/\\ /g," "),typeof y.label=="string"?y.label=y.label.replace(/\\ /g," "):y.label.label=y.label.label.replace(/\\ /g," ")),g||!E.includes(".")&&!E.endsWith("/")?y:void 0)}).filter(y=>y!==void 0),ne(`Jupyter completions for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${t.map(y=>y.label).join(",")}`),ne(`Jupyter results for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${o.map(y=>y.label).join(",")}`),o}var Gd=D(O()),JL=require("vscode");var nY=D(Gc());var rY=require("vscode");function I1(){let e=rY.workspace.getConfiguration("python")?.get("languageServer");return!(e!=="Pylance"&&e!=="Default")}var zd=class{constructor(e,t,n,i,o){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=n;this.controllerRegistration=i;this.kernelProvider=o;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=JL.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t))}).catch(f)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return JL.extensions.getExtension(sm)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){return this._isEnabled===void 0&&(this._isEnabled=I1()),this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let n=this.controllerRegistration.getSelected(t);if(n&&Ft(n.connection)){let o=this.kernelProvider.get(t);if(!o)return;let s=[];if(!o.startedAtLeastOnce){let g=new Promise(y=>o.onStarted(y,void 0,s));await xr(5e3,void 0,g)}if(!o.startedAtLeastOnce)return;let a=this.kernelProvider.getKernelExecution(o),c=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists("${__filename}"):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,u=(await a.executeHidden(c).catch(f)||[]).find(g=>g.output_type==="stream"&&g.name==="stdout");if(!u||!(u.text||"").toString().includes("EXECUTABLE"))return;let p=(u.text||"").toString();p=p.substring(p.indexOf("EXECUTABLE"));let m=p.split("EXECUTABLE").filter(g=>g.trim().length),h=m.length?m[0].trim():"";return!h||!await nY.pathExists(h)?void 0:(P(`Remote Interpreter for Pylance for Notebook URI "${B(t.uri)}" is ${B(h)}`),h)}let i=n?.connection?.interpreter;return i?(P(`Interpreter for Pylance for Notebook URI "${B(t.uri)}" is ${B(i.uri)}`),Ae(i.uri)):(P(`No interpreter for Pylance for Notebook URI "${B(t.uri)}"`),"")}};zd=v([(0,Gd.injectable)(),d(0,(0,Gd.inject)(tr)),d(1,(0,Gd.inject)(Ye)),d(2,(0,Gd.inject)(Ci)),d(3,(0,Gd.inject)(St)),d(4,(0,Gd.inject)(Ke))],zd);function iY(r){r.addSingleton(Ie,OI),r.addSingleton(Hd,Hd),r.addBinding(Hd,Ie),r.addSingleton(zd,zd),r.addBinding(zd,Ie)}var LI=D(O());var oY=require("vscode");var FI=class{constructor(e,t,n){this.extensionChecker=e;this.disposables=t;this.kernelProvider=n}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&oY.window.showInformationMessage(b.pythonExtensionInstalled,ve.ok).then(f,f)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};FI=v([(0,LI.injectable)(),d(0,(0,LI.inject)(Ye)),d(1,(0,LI.inject)(F)),d(2,(0,LI.inject)(Ke))],FI);var $r=D(O()),cY=D(No()),Et=require("vscode");var Rl=require("vscode");var S1=class{constructor(e,t,n,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=n;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=UI(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:n,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(U(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&z(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,n,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=Rl.window.createInputBox();e.disposables.push(a),a.title=b.jupyterSelectPasswordTitle,a.placeholder=b.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[Rl.QuickInputButtons.Back],o=await new Promise((c,l)=>{a.onDidTriggerButton(u=>{u===Rl.QuickInputButtons.Back&&l(Ne.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>c(a.value),this,e.disposables),a.onDidHide(()=>l(Ne.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new Rl.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");n=a.sessionCookieName,i=a.sessionCookieValue}else n="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${n}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&n&&(i||e.isTokenEmpty)?(N("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${n}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(N("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getXSRFToken(e,t){let n,i,o=new URL("login?",UI(e)).toString();t!=""?(o=new URL("tree",UI(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(n=a.get("_xsrf")?.split(";")[0])}return n}async needPassword(e){let t=await this.makeRequest(UI(e),{method:"get",redirect:"follow",headers:{Connection:"keep-alive"}});if(t.status===200&&t.redirected){if(t.url.toLowerCase().includes("/login?"))return!0;if(t.url.toLowerCase().includes("/lab?"))return!1}let n=new URL("tree?",UI(e)).toString();return t=await this.makeRequest(n,{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}}),t.status===404?(C(`Jupyter Server not found at ${e}, got 404 for ${n}`),!1):t.status!==200}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=b.jupyterSelfCertEnable,s=b.jupyterSelfCertClose,a=await Rl.window.showErrorMessage(b.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Rl.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,n){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",n);let a=await this.makeRequest(new URL("login?",UI(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let c=this.getCookies(a);c.size>0&&(i=c.entries().next().value[0],o=c.entries().next().value[1])}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function UI(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var C1=require("vscode");var x1=class{constructor(e,t,n,i,o,s,a){this.multiStepFactory=e;this.asyncDisposableRegistry=t;this.configService=n;this.agentCreator=i;this.requestCreator=o;this.serverUriStorage=s;this.disposables=a;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}async getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");if(!await this.isJupyterHub(e.url))throw new Error("Not a Jupyter Hub Url");let t=sY(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterHubConnectionInfo(t,e.validationErrorMessage).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(U(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&z(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",sY(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let n=await t.json();return P(`JupyterHub version is ${n&&n.version} for url ${e}`),n&&n.version}catch{}return!1}catch(t){return P(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}async getJupyterHubConnectionInfo(e,t){try{let n=await this.getUserNameAndPassword(t);if(n.username||n.password){let i=await this.getJupyterHubConnectionInfoFromLogin(e,n.username,n.password);if(i){let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromLogin":"gotResponseFromLogin";N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}else{N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"emptyResponseFromLogin"}),i=await this.getJupyterHubConnectionInfoFromApi(e,n.username,n.password);let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromApi":"gotResponseFromApi";N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}return i}return N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!1,info:"passwordNotRequired"}),{requiresPassword:!1}}catch(n){throw N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"failure"}),n}}async getJupyterHubConnectionInfoFromLogin(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=new URLSearchParams;s.append("username",t||""),s.append("password",n||"");let a=await this.makeRequest(`${o}/hub/login?next=`,{method:"POST",headers:{Connection:"keep-alive",Referer:`${o}/hub/login`,"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a&&a.status===302){let l=[...this.getCookies(a).entries()].reduce((u,p)=>`${u};${p[0]}=${p[1]}`,"");if(a=await this.makeRequest(`${o}/hub/api/users/${t}/tokens`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),a.ok&&a.status===200){let u=await a.json();if(u&&u.token&&u.id)return await this.makeRequest(`${o}/hub/api/users/${t}/server`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),this.asyncDisposableRegistry.push({dispose:async()=>{this.makeRequest(`${o}/hub/api/users/${t}/tokens/${u.id}`,{method:"DELETE",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}).catch(f)}}),{requestHeaders:{},remappedBaseUrl:`${o}/user/${t}`,remappedToken:u.token,requiresPassword:!0}}}}async getJupyterHubConnectionInfoFromApi(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=await this.makeRequest(`${o}/hub/api/authorizations/token`,{method:"POST",headers:{Connection:"keep-alive","content-type":"application/json;charset=UTF-8"},body:`{ "username": "${t||""}", "password": "${n||""}"  }`,redirect:"manual"});if(s.ok&&s.status===200){let a=await s.json();if(a&&a.user&&a.user.server&&a.token)return{requestHeaders:{},remappedBaseUrl:`${o}${a.user.server}`,remappedToken:a.token,requiresPassword:!0}}return{requiresPassword:!1}}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getUserNameAndPassword(e){let t=this.multiStepFactory.create(),n={username:"",password:"",validationMessage:e};return await t.run(this.getUserNameMultiStep.bind(this),n),n}async getUserNameMultiStep(e,t){if(t.username=await e.showInputBox({title:b.jupyterSelectUserAndPasswordTitle,prompt:b.jupyterSelectUserPrompt,validate:this.validateUserNameOrPassword,validationMessage:t.validationMessage,value:""}),t.username)return this.getPasswordMultiStep.bind(this)}async validateUserNameOrPassword(e){}async getPasswordMultiStep(e,t){t.password=await e.showInputBox({title:b.jupyterSelectUserAndPasswordTitle,prompt:b.jupyterSelectPasswordPrompt,validate:this.validateUserNameOrPassword,value:"",password:!0})}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=b.jupyterSelfCertEnable,s=b.jupyterSelfCertClose,a=await C1.window.showErrorMessage(b.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,C1.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function sY(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var w1="user-jupyter-server-uri-list-version2";var LIe="DataScienceAllowInsecureConnections",jI=class extends or{constructor(t,n,i,o,s,a,c,l,u,p,m,h,g,y=uA){super();this.jupyterConnection=n;this.context=m;this.fs=h;this.jupyterServerProviderRegistry=g;this.id=y;this.extensionId=Je;this.documentation=Et.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=b.UserJupyterServerUrlProviderDisplayName;this.detail=b.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new Et.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new Et.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new ww(i),this.secureConnectionValidator=new Cw(s),this.jupyterServerUriInput=new xw(p),this.jupyterServerUriDisplayName=new $L,this.jupyterPasswordConnect=new S1(t,u,p,o,a),this.jupyterHubPasswordConnect=new x1(c,l,t,u,p,o,a)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(Je,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(Et.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(f),this.fs.delete(Et.Uri.joinPath(this.context.globalStorageUri,Ay)).catch(f)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(f)}async resolveJupyterServer(t,n){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:Et.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?Et.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,n){let i=new Et.CancellationTokenSource;this._register(new Et.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===Ne.cancel)throw new Et.CancellationError;if(s&&s instanceof Ne)return;let c=(await this.provideJupyterServers(i.token)).find(l=>l.id===s);if(!c)throw new Error(`Server ${s} not found`);return c}catch(o){if(o instanceof Et.CancellationError)throw o;C("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,n){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:b.connectToToTheJupyterServer(i),url:i}]:[{label:b.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=le();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(f),t.resolve()})().then(()=>t.resolve(),n=>t.reject(n)).catch(f),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){if(!Et.workspace.getConfiguration("jupyter").get("bypassJupyterHubExtensionCheck"))throw Et.extensions.getExtension(yh)?Et.window.showInformationMessage(b.useJupyterHubExtension,{modal:!0,detail:b.useJupyterHubExtensionDetail}).then(()=>{Et.commands.executeCommand("notebook.selectKernel",{notebookEditor:Et.window.activeNotebookEditor}).then(f,f)},f):Et.window.showInformationMessage(b.installJupyterHub,{modal:!0,detail:b.installJupyterHubDetail},ve.install,ve.moreInfo).then(t=>{t===ve.install?Et.commands.executeCommand("workbench.extensions.installExtension",yh,{context:{skipWalkthrough:!0}}).then(f,f):t===ve.moreInfo&&Et.env.openExternal(Et.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(f,f)},f),new Et.CancellationError}async captureRemoteJupyterUrl(t,n=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,c=!1,l,u="Get Url",p="Get Url",m=n,h=!1;if(n){let g=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(n);typeof g.validationError=="string"?(s=g.validationError,u="Get Url"):(h=!0,o=g.jupyterServerUri,u="Check Passwords")}try{let g=!1,y=!1;for(;;)try{if(l=(0,cY.default)(),u==="Get Url"){h=!1,u="Check Passwords",p=void 0;let E=s;s="";let A=await this.jupyterServerUriInput.getUrlFromUser(m||n,E,i);o=A.jupyterServerUri,m=A.url}if(t.isCancellationRequested)return Ne.cancel;let x=[];if(u==="Check Passwords"){u="Check Insecure Connections",p=h&&n?void 0:"Get Url";try{let E=s;s="",g=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),g&&this.recommendInstallingJupyterHubExtension();let A=g?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:l,displayName:o.displayName,validationErrorMessage:E,disposables:x}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:l,validationErrorMessage:E,disposables:x});a=A.requiresPassword,o.authorizationHeader=A.requestHeaders,y=!1}catch(E){if(y=!1,E instanceof Et.CancellationError||E==Ne.back||E==Ne.cancel)throw E;if(!Qo.isSelfCertsError(E)){if(!Nc.isSelfCertsExpiredError(E)){Yf(l,o.baseUrl,g,"ConnectionFailure");let A=/(https?:\/\/[^\s]+)/g,T=(E.message||E.toString()).replace(A,j=>`[${j}](${j})`);if(s=(ln()?b.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:b.remoteJupyterConnectionFailedWithoutServerWithError)(T),o.token.length>0&&(E.message||"").toLowerCase()==="Failed to fetch".toLowerCase())y=!0;else{u="Get Url";continue}}}}finally{x.forEach(E=>this._register(E))}}if(t.isCancellationRequested)return Ne.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",p=a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(c=!0,z(x),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return Yf(l,o.baseUrl,g,"InsecureHTTP"),Ne.cancel;if(t.isCancellationRequested)return Ne.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:l,extensionId:Je},o,!0)}catch(E){if(U("Uri verification error",E),y&&s){u="Get Url";continue}if(E instanceof Et.CancellationError||E==Ne.back||E==Ne.cancel)throw E;if(Qo.isSelfCertsError(E)){s=b.jupyterSelfCertFailErrorMessageOnly,u="Get Url",Yf(l,o.baseUrl,g,"SelfCert");continue}else if(Nc.isSelfCertsExpiredError(E)){s=b.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",Yf(l,o.baseUrl,g,"ExpiredCert");continue}else if(a&&o.token.length===0){s=b.passwordFailure,u="Check Passwords",Yf(l,o.baseUrl,g,"AuthFailure");continue}else{Yf(l,o.baseUrl,g,"ConnectionFailure");let A=/(https?:\/\/[^\s]+)/g,T=(E.message||E.toString()).replace(A,j=>`[${j}](${j})`);s=(ln()?b.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:b.remoteJupyterConnectionFailedWithoutServerWithError)(T),u="Get Url";continue}}finally{z(x)}if(t.isCancellationRequested)return Ne.cancel;if(u==="Get Display Name"){z(x),p=c?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(l,o.displayName||new URL(o.baseUrl).hostname);break}}catch(x){if(x instanceof Et.CancellationError||x===Ne.cancel)return Ne.cancel;if(x===Ne.back){if(!p)return Ne.back;u=p;continue}throw x}return t.isCancellationRequested?Ne.cancel:(await this.addNewServer({handle:l,uri:m,serverInfo:o}),i_({extensionId:this.extensionId,id:this.id,handle:l},o.displayName),Yf(l,o.baseUrl,g),l)}catch(g){if(g instanceof Et.CancellationError)return Ne.cancel;throw g}finally{z(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),c=Object.assign({},o);try{let l=a?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:t,displayName:o.displayName}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});c=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader}),a&&l.remappedBaseUrl&&(c.baseUrl=l.remappedBaseUrl),a&&l.remappedToken&&(c.token=l.remappedToken)}catch(l){C("Failed to validate Password info",l)}return c}};jI=v([(0,$r.injectable)(),d(0,(0,$r.inject)(de)),d(1,(0,$r.inject)(dn)),d(2,(0,$r.inject)(Rx)),d(3,(0,$r.inject)(Zt)),d(4,(0,$r.inject)($e)),d(4,(0,$r.named)(gt)),d(5,(0,$r.inject)(F)),d(6,(0,$r.inject)(ev)),d(7,(0,$r.inject)(di)),d(8,(0,$r.inject)(Sp)),d(8,(0,$r.optional)()),d(9,(0,$r.inject)(zl)),d(10,(0,$r.inject)(lt)),d(11,(0,$r.inject)(ut)),d(12,(0,$r.inject)(Qt)),d(13,(0,$r.optional)()),d(13,(0,$r.inject)(Date.now().toString()))],jI);var xw=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",n){if(!e&&!iE)try{let s=await Et.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:Et.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=Et.window.createInputBox();n.push(i),i.title=b.jupyterSelectUriInputTitle,i.placeholder=b.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[Et.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=le();return i.onDidChangeValue(()=>i.validationMessage="",this,n),i.onDidHide(()=>o.reject(Ne.cancel),this,n),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(Ne.back)},this,n),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),n=HL(t,"");return n?(n.baseUrl=await UIe(t,this.requestCreator)||n.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:b.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:n,url:t,validationError:void 0}):{validationError:b.jupyterSelectURIInvalidURI}}};xw=v([d(0,(0,$r.inject)(zl))],xw);async function UIe(r,e){try{if(r=HL(r,"")?.baseUrl||r,new URL(r).pathname==="/")return r;let t=r.indexOf("token=")>0?r.substring(0,r.indexOf("token=")):r,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){P("Unable to identify the baseUrl of the Jupyter Server",t)}}function Yf(r,e,t,n){e=e.trim().toLowerCase();let i=Vt({handle:r,extensionId:Je,id:uA});Promise.all([vt(e.toLowerCase()),vt(i.toLowerCase())]).then(([o,s])=>{N("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!n,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:n})}).catch(o=>C(`Failed to hash remote url ${e}`,o))}var $L=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let n=[];try{let i=Et.window.createInputBox();n.push(i),i.ignoreFocusOut=!0,i.title=b.jupyterRenameServer,i.value=t,i.placeholder=b.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[Et.QuickInputButtons.Back],i.show();let o=le();return n.push(i.onDidHide(()=>o.reject(Ne.cancel))),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(Ne.back)},this,n),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,n),await o.promise}finally{z(n)}}},Cw=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get(LIe,!1))return!0;let e=[],t=le();try{let n=Et.window.createQuickPick();return e.push(n),n.canSelectMany=!1,n.ignoreFocusOut=!0,n.title=b.insecureSessionMessage,n.buttons=[Et.QuickInputButtons.Back],n.items=[{label:ve.bannerLabelYes},{label:ve.bannerLabelNo}],n.show(),e.push(n.onDidHide(()=>t.reject(Ne.cancel))),n.onDidTriggerButton(i=>{i===Et.QuickInputButtons.Back&&t.reject(Ne.back)},this,e),n.onDidAccept(()=>t.resolve(n.selectedItems.some(i=>i.label===ve.bannerLabelYes)),this,e),await t.promise}finally{z(e)}}};Cw=v([d(0,(0,$r.inject)($e)),d(0,(0,$r.named)(gt))],Cw);function HL(r,e){if(!r.startsWith(Qe.REMOTE_URI))try{let t=new URL(r);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){C(`Failed to parse URI ${r}`,t);return}}function aY(r){return r.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function jIe(r){let e=[];return r.forEach(t=>{let n=HL(t.uri,t.displayName);n&&e.push({handle:t.handle,uri:t.uri,serverInfo:n})}),e}var ww=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(ai.JupyterServerRemoteLaunchService,w1);if(!t||t==="[]")return[];try{return this.servers=jIe(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(ai.JupyterServerRemoteLaunchService,w1,JSON.stringify(aY(t)))}).catch(f))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(n=>n.handle!==e);return this.servers=t,this.encryptedStorage.store(ai.JupyterServerRemoteLaunchService,w1,JSON.stringify(aY(t)))}).catch(f))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(ai.JupyterServerRemoteLaunchService,w1,void 0)}).catch(f))}};ww=v([d(0,(0,$r.inject)(Rx))],ww);var Ew=D(O()),VI=require("vscode");var WI=class extends or{constructor(t,n){super();this.uriProviderRegistration=t;this.serverUriStorage=n;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new VI.EventEmitter);this.extensionId=Je;this.id=Hw;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(n=>n.server)}async resolveJupyterServer(t,n){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(Je,this.id,this.displayName,this)),this._register(VI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){ee(`Setting Jupyter Server URI to remote: ${t}`);let n=t.toString(!0),i=new URL(n),o=VI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await Ea(t.toString(!0),"SHA-1"),c={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:c}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:Je}),this._onDidChangeHandles.fire()}};WI=v([(0,Ew.injectable)(),d(0,(0,Ew.inject)(Qt)),d(1,(0,Ew.inject)(Zt))],WI);var E1=D(O());var Pw=require("vscode");var BI=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){Pw.workspace.isTrusted&&this.registerCommand($.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let n=Pw.commands.registerCommand(e,t,this);this.disposables.push(n)}async continueEditSessionInCodespace(){await Pw.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};BI=v([(0,E1.injectable)(),d(0,(0,E1.inject)(F))],BI);var lY=D(O());var uY=require("vscode");var qI=class{activate(){this.eagerlyActivateOtherExtensions().catch(f)}async eagerlyActivateOtherExtensions(){await Promise.all(uY.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(f,f)))}};qI=v([(0,lY.injectable)()],qI);var P1=D(O()),pY=require("vscode");var JI=class{constructor(e){this.uriStorage=e}activate(){pY.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(n=>{n.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(n.provider)}),e})}};JI=v([(0,P1.injectable)(),d(0,(0,P1.inject)(Zt))],JI);var Vu=require("vscode");var dY=D(O());var $I=class{activate(){let e=Pe.instance.get(F),t=new En;e.push(t),e.push(Vu.commands.registerCommand("jupyter.manageAccessToKernels",()=>WIe(t)))}};$I=v([(0,dY.injectable)()],$I);async function WIe(r){let e=await Q9(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=Vu.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let n=[];r.add({dispose:()=>{n=z(n)}});let i=Vu.window.createQuickPick();i.title=Vu.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=Vu.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;n.push(i),i.show(),await Promise.race([eM(i.onDidAccept,void 0,n).then(()=>o=!0),eM(i.onDidHide,void 0,n)]),o&&(await Y9(i.selectedItems.map(s=>s.extensionId)),n=z(n))}function mY(r,e,t){e.addSingleton(Ie,RI),e.addSingleton(Ie,Gf),e.addSingleton(Ie,kI),e.addSingleton(Ie,_I),e.addSingleton(Ie,TI),e.addSingleton(Ie,qI),e.addSingleton(Ie,WI),e.add(Eg,wI),e.add(VP,EI),e.addSingleton(Ie,PI),e.addSingleton(Ie,BI),e.addSingleton(LL,Tl),e.addBinding(LL,Ie),e.add(XP,NI),e.addSingleton(YP,AI),e.addSingleton(Wu,Wu),e.addSingleton(Ie,FI),iY(e),jQ(r,t),e.addSingleton(Ie,jI),e.addSingleton(Ie,JI),e.addSingleton(Ie,$I),e.addSingleton(HP,KI)}var Al=D(O()),ma=require("vscode");var k1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var fY=1e3,VIe;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(VIe||={});var da;(p=>(p.Started="started",p.UpdateSettings="update_settings",p.InitializeData="init",p.GetAllRowsRequest="get_all_rows_request",p.GetAllRowsResponse="get_all_rows_response",p.GetRowsRequest="get_rows_request",p.GetRowsResponse="get_rows_response",p.CompletedData="complete",p.GetSliceRequest="get_slice_request",p.RefreshDataViewer="refresh_data_viewer",p.SliceEnablementStateChanged="slice_enablement_state_changed"))(da||={});var HI=Symbol("IDataViewerFactory"),D1=Symbol("IDataViewer"),_1=Symbol("IJupyterVariableDataProvider"),T1=Symbol("IJupyterVariableDataProviderFactory"),GI=Symbol("IDataViewerDependencyService");var zL;function QL(r,e){return zL&&zL.hasOwnProperty(r)?zL[r]:e}function YL(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}var BIe=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function XL(r){let e=r.length-2;return"["+r.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function qIe(r,e){if(r.startsWith("[")&&r.endsWith("]")){let t,n=r.substring(1,r.length-1).split(",").map((i,o)=>{let s=BIe.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),c=e[o];return(a>=0&&a>=c||a<0&&a<-c)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=QL("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return YL(s,o.toString(),i.toString(),e[i].toString())}else if(n&&n.length!==e.length){let i=QL("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return YL(i,e.length.toString(),n.length.toString())}}return""}function hY(r,e){return qIe(r,e)===""}var qu=require("vscode");var Bu=class{constructor(e,t,n){this.configService=e;this.rootPath=t;this.scripts=n;this.disposed=!1;this.themeIsDarkPromise=le();this.webviewInit=le();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new qu.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(f)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let n=JSON.stringify(t);this.postMessageInternal("update_settings",n).catch(f)}}};this._disposables.push(qu.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=le(),this.postMessageInternal("get_html_by_id_request",e).catch(f);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(n=>{n(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||le(),this.webview===void 0){let n=await this.generateDataScienceExtraSettings(),i=qu.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,n,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(f),this.sendLocStrings().catch(f)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=qu.workspace.getConfiguration("editor"),n=qu.workspace.getConfiguration("workbench"),i=n?n.get("colorTheme",pA):pA,o=qu.extensions.getExtension(li);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:jr()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:qt.collapseSingle,expandSingle:qt.expandSingle,openExportFileYes:b.openExportFileYes,openExportFileNo:b.openExportFileNo,noRowsInDataViewer:qt.noRowsInDataViewer,sliceIndexError:qt.sliceIndexError,sliceMismatchedAxesError:qt.sliceMismatchedAxesError,filterRowsTooltip:qt.sliceMismatchedAxesError,fetchingDataViewer:qt.fetchingDataViewer,dataViewerHideFilters:qt.dataViewerHideFilters,dataViewerShowFilters:qt.dataViewerShowFilters,refreshDataViewer:qt.refreshDataViewer,clearFilters:qt.refreshDataViewer,sliceSummaryTitle:qt.sliceSummaryTitle,sliceData:qt.sliceData,sliceSubmitButton:qt.sliceSubmitButton,sliceDropdownAxisLabel:qt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:qt.sliceDropdownIndexLabel,variableExplorerNameColumn:qt.variableExplorerNameColumn,variableExplorerTypeColumn:qt.variableExplorerTypeColumn,variableExplorerCountColumn:qt.variableExplorerCountColumn,variableExplorerValueColumn:qt.variableExplorerValueColumn,collapseVariableExplorerLabel:qt.collapseVariableExplorerLabel,variableLoadingValue:qt.variableLoadingValue,showDataExplorerTooltip:qt.showDataExplorerTooltip,noRowsInVariableExplorer:qt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:qt.loadingRowsInVariableExplorer,previousPlot:qt.previousPlot,nextPlot:qt.nextPlot,panPlot:qt.panPlot,zoomInPlot:qt.zoomInPlot,zoomOutPlot:qt.zoomOutPlot,exportPlot:qt.exportPlot,deletePlot:qt.deletePlot,selectedImageListLabel:qt.selectedImageListLabel,selectedImageLabel:qt.selectedImageLabel};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(f)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(f),this.onDataScienceSettingsChanged().catch(f)}getValue(e,t,n){return e?e.get(t,n):n}};v([Eh()],Bu.prototype,"getHTMLById",1),v([Eh()],Bu.prototype,"addMessageListener",1),v([Eh()],Bu.prototype,"removeMessageListener",1);var zI=class extends Bu{constructor(t,n,i,o,s,a,c){super(t,o,s);this.configService=t;this.provider=n;this._title=a;this.viewColumn=c;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let n=t.isVisible(),i=t.isActive(),o={visible:n,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=n,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,n,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:n,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var gY="JupyterDataViewerPreferredViewColumn",Xf=class extends zI{constructor(t,n,i,o,s){let a=ir(s.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new k1(c,l,u),a,[ir(a,"dataExplorer.js")],b.dataExplorerTitle,i.get(gY)??ma.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new ma.EventEmitter;this._onDidChangeDataViewerViewState=new ma.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,n){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(ma.Uri.file(process.cwd())).catch(C),super.setTitle(n),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=XL(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(da.InitializeData,i).catch(f)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let n=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&n.shape!==void 0)if(hY(t,n.shape))n=await this.getDataFrameInfo(t);else{let i=XL(n.shape);n=await this.getDataFrameInfo(i)}ee(`Refreshing data viewer for variable ${n.name}`),this.postMessage(da.InitializeData,n).catch(f)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(gY,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,n){switch(t){case da.GetAllRowsRequest:this.getAllRows(n).catch(f);break;case da.GetRowsRequest:this.getRowChunk(n).catch(f);break;case da.GetSliceRequest:this.getSlice(n).catch(f);break;case da.RefreshDataViewer:this.refreshData().catch(f),N("DATASCIENCE.REFRESH_DATA_VIEWER");break;case da.SliceEnablementStateChanged:N("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:n.newState?"checked":"unchecked"});break;default:break}super.onMessage(t,n)}getDataFrameInfo(t,n){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,n):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new Ge;let t=await this.getDataFrameInfo();try{N("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(da.GetAllRowsResponse,n)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.slice);return n.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(n.shape.length),N("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(da.InitializeData,n)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,n.rowCount?n.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(da.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(n){if(n instanceof ub){C(n.message);let i=b.pythonInteractiveHelpLink;ma.window.showErrorMessage(b.jupyterDataRateExceeded,i).then(o=>{o===i&&ma.env.openExternal(ma.Uri.parse(KS.JupyterDataRateHelpLink))},f),this.dispose()}C(n),this.errorHandler.handleError(n).then(f,f)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&N("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(N("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};v([mr("DATAVIEWER.WEBVIEW_LOADED")],Xf.prototype,"showData",1),Xf=v([(0,Al.injectable)(),d(0,(0,Al.inject)(Dp)),d(1,(0,Al.inject)(de)),d(2,(0,Al.inject)($e)),d(2,(0,Al.named)(gt)),d(3,(0,Al.inject)(en)),d(4,(0,Al.inject)(lt))],Xf);var Fr=D(O()),Bo=require("vscode");var A1=require("vscode");var R1=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>fY&&await this.shouldAskForLargeData(t)){let n=b.tooManyColumnsMessage,i=b.tooManyColumnsYes,o=b.tooManyColumnsNo,s=b.tooManyColumnsDontAskAgain,a=await A1.window.showWarningMessage(n,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,A1.ConfigurationTarget.Global).catch(f))}};var vY="ds_prompt_about_deprecation",QI=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h,g){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=c;this.interpreterService=l;this.platformService=u;this.kernelProvider=p;this.interactiveWindowProvider=m;this.experimentService=h;this.globalMemento=g;this.dataViewerChecker=new R1(n),Bo.workspace.isTrusted||Bo.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){Bo.workspace.isTrusted&&this.registerCommand($.ShowDataViewer,this.onVariablePanelShowDataViewerRequest)}registerCommand(e,t){let n=Bo.commands.registerCommand(e,t,this);this.disposables.push(n)}async onVariablePanelShowDataViewerRequest(e){let t="variable"in e?e.variable:e;N("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX");let n=this.experimentService.inExperiment("DataViewerDeprecation");if(!this.globalMemento.get(vY)&&n&&(this.globalMemento.update(vY,!0).then(f,f),Bo.window.showInformationMessage(b.dataViewerDeprecationMessage,b.dataViewerDeprecationRecommendationActionMessage).then(i=>{i===b.dataViewerDeprecationRecommendationActionMessage&&Bo.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(f,f)},f)),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let l=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);l&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(l)}let i=b0(t),o=await this.variableProvider.getFullVariable(i),s=await this.jupyterVariableDataProviderFactory.create(o),c=(await s.getDataFrameInfo())?.columns?.length;if(c&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(c)){let l=`${b.dataExplorerTitle} - ${o.name}`,u=await this.dataViewerFactory.create(s,l);return N("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),u}}catch(i){N("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,i),C(i),this.errorHandler.handleError(i).then(f,f)}else try{let i=this.getActiveKernel();if(i&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let o=await this.jupyterVariableDataProviderFactory.create(t,i),s=`${b.dataExplorerTitle} - ${t.name}`;return await this.dataViewerFactory.create(o,s)}}catch(i){C(i),N("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),Bo.window.showErrorMessage(b.showDataViewerFail).then(f,f)}}getActiveKernel(){let e=Bo.window.activeNotebookEditor?.notebook,t=e?.notebookType==_t?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Bo.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){ee("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(ee("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(ee("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let n=t;return n.startsWith("~")&&this.platformService.homeDir&&(n=Th(n,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(Bo.Uri.file(n))}else return this.interpreterService.getActiveInterpreter()}};QI=v([(0,Fr.injectable)(),d(0,(0,Fr.inject)(F)),d(1,(0,Fr.inject)(ji)),d(1,(0,Fr.optional)()),d(2,(0,Fr.inject)(de)),d(3,(0,Fr.inject)(T1)),d(3,(0,Fr.optional)()),d(4,(0,Fr.inject)(HI)),d(4,(0,Fr.optional)()),d(5,(0,Fr.inject)(jn)),d(5,(0,Fr.optional)()),d(5,(0,Fr.named)(Qe.DEBUGGER_VARIABLES)),d(6,(0,Fr.inject)(en)),d(7,(0,Fr.inject)(GI)),d(7,(0,Fr.optional)()),d(8,(0,Fr.inject)(st)),d(8,(0,Fr.optional)()),d(9,(0,Fr.inject)(Dr)),d(10,(0,Fr.inject)(Ke)),d(11,(0,Fr.inject)($i)),d(12,(0,Fr.inject)(ac)),d(13,(0,Fr.inject)($e)),d(13,(0,Fr.named)(gt))],QI);var XI=D(O());var N1="0.20.0";var M1=require("vscode");var Zf=class{async getVersion(e,t){try{let n=await this._getVersion(e,t);return typeof n=="string"?yP(n):n}catch(n){U(b.failedToGetVersionOfPandas,n.message);return}}async promptInstall(e,t,n){let i=n?b.pandasTooOldForViewingFormat(n,N1):b.pandasRequiredForViewing(N1);if((om()?ve.install:await M1.window.showErrorMessage(i,{modal:!0},ve.install))===ve.install)await this._doInstall(e,t);else throw N("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new M1.CancellationTokenSource;try{let n=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){N("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(n){if(n.compare(N1)>0){N("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}N("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${n.major}.${n.minor}.${n.build}`;await this.promptInstall(e,t,i)}N("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};v([mr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:hr.get(23)})],Zf.prototype,"promptInstall",1);var ZL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",JIe=`import pandas;print(pandas.__version__);print("${ZL}")`,O1=class extends Zf{constructor(t,n,i){super();this.installer=t;this.pythonFactory=n;this.interpreterService=i}async _getVersion(t,n){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",JIe],{token:n})).stdout;if(!s?.includes(ZL))return U(b.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=We(s.trim()),c=a.indexOf(ZL);return c>=0?a[c-1]:""}async _doInstall(t,n){let i=t||await this.interpreterService.getActiveInterpreter();if(n.token.isCancellationRequested)return;await sr(n.token,2,this.installer.install(23,i,n))===0&&N("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){N("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var eU="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",$Ie=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${eU}"); del _VSCODE_pandas`;function HIe(r){return(r.kernelConnectionMetadata.interpreter&&Be(r.kernelConnectionMetadata.interpreter))==="Conda"?"%conda":"%pip"}var K1=class extends Zf{async execute(e,t){if(!t.session?.kernel)throw new bn;let n=await In(t.session.kernel,e),i=n.find(o=>o.output_type==="error");return i&&U(b.failedToGetVersionOfPandas,i.message),n.map(o=>o.text?.toString())}async _getVersion(e){let n=(await this.execute($Ie,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!n?.includes(eU))return U(b.failedToGetVersionOfPandas,`Output is ${n}`),"";let i=We(n.trim()),o=i.indexOf(eU);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${HIe(e)} install pandas`;try{await this.execute(t,e),N("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(n){throw N("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,n),new Error(b.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(N("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw N("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};var YI=class{constructor(e,t,n){this.withKernel=new K1,this.withInterpreter=new O1(e,t,n)}async checkAndInstallMissingDependencies(e){return"controller"in e?this.withKernel.checkAndInstallMissingDependencies(e):this.withInterpreter.checkAndInstallMissingDependencies(e)}};YI=v([(0,XI.injectable)(),d(0,(0,XI.inject)(qi)),d(1,(0,XI.inject)(Br)),d(2,(0,XI.inject)(st))],YI);var ZI=D(O());var yY=require("vscode");var Qd=class{constructor(e,t,n){this.serviceContainer=e;this.disposables=n;this.knownViewers=new Set;t.push(this),this.viewContext=new cr(Sr.IsDataViewerActive),this.disposables.push(yY.commands.registerCommand($.RefreshDataViewer,this.refreshDataViewer,this))}async dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let n,i=this.serviceContainer.get(D1);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),n=i}finally{n||i.dispose()}return n}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(f,f)}};v([mr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Qd.prototype,"create",1),v([Vv(1e3)],Qd.prototype,"refreshDataViewer",1),Qd=v([(0,ZI.injectable)(),d(0,(0,ZI.inject)(pt)),d(1,(0,ZI.inject)(di)),d(2,(0,ZI.inject)(F))],Qd);var $u=D(O());var Ju=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let n;switch(t.type){case"bool":n="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":n="number";break;default:n="string"}return{key:t.key,type:n}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{C(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let n={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),n={columns:i.columns?Ju.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Ju.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Ae(i.fileName)}),t&&(this.variable=i),n}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,n){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,n)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(Xu()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Ju=v([(0,$u.injectable)(),d(0,(0,$u.inject)(jn)),d(0,(0,$u.named)(Qe.ALL_VARIABLES)),d(1,(0,$u.inject)(GI)),d(1,(0,$u.optional)())],Ju);var F1=D(O());var eS=class{constructor(e){this.serviceContainer=e}async create(e,t){let n=this.serviceContainer.get(_1);return n.setDependencies(e,t),n}};eS=v([(0,F1.injectable)(),d(0,(0,F1.inject)(pt))],eS);var kw=D(O()),L1=require("vscode");var tS=class{constructor(e,t){this.kernelProvider=e;this.controllers=t;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){z(this.disposables)}activate(){let e=L1.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,n=e.session?.kernel?.iopubMessage;if(!n)return;let i=require("@jupyterlab/services"),o=(s,a)=>{s===t&&(i.KernelMessage.isDisplayDataMsg(a)||i.KernelMessage.isUpdateDisplayDataMsg(a)||i.KernelMessage.isExecuteReplyMsg(a)||i.KernelMessage.isExecuteResultMsg(a))&&this.trackModelId(e.notebook,a)};n.connect(o),this.disposables.push(new L1.Disposable(()=>n.disconnect(o)))}trackModelId(e,t){let n=t.content;if(n.data&&typeof n.data=="object"&&zi in n.data){let i=n.data[zi];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:n}){n&&typeof n=="object"&&n.command==="query-widget-state"&&this.queryWidgetState(e,t,n),n&&typeof n=="object"&&n.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,n){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(n.model_id);e.postMessage({command:"query-widget-state",model_id:n.model_id,hasWidgetState:s,kernelSelected:o},t).then(f,f)}sendWidgetVersionAndState(e,t){let n=this.kernelProvider.get(t.notebook),i=n?.ipywidgetsVersion;n?.ipywidgetsVersion&&P(`IPyWidget version in Kernel is ${n?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(f,f)}};tS=v([(0,kw.injectable)(),d(0,(0,kw.inject)(Ke)),d(1,(0,kw.inject)(St))],tS);var th=D(O());var tU=require("vscode");var eh=D(O());var Nl=require("vscode");var U1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var fa;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(fa||={});var bY=class{static{fa.Started,fa.UpdateSettings,fa.SendPlot,fa.CopyPlot,fa.ExportPlot,fa.RemovePlot}},j1=Symbol("IPlotViewerProvider"),W1=Symbol("IPlotViewer");var rS=class extends zI{constructor(t,n,i,o){let s=new Ge,a=ir(o.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new U1(c,l,u),a,[ir(a,"plotViewer.js")],b.plotViewerTitle,Nl.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new Nl.EventEmitter;this.removedEvent=new Nl.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(fa.SendPlot,t).catch(f))};super.loadWebview(Nl.Uri.file(process.cwd())).catch(C).finally(()=>{N("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,n){switch(t){case fa.CopyPlot:this.copyPlot(n.toString()).catch(f);break;case fa.ExportPlot:this.exportPlot(n).catch(f);break;case fa.RemovePlot:this.removePlot(n);break;default:break}super.onMessage(t,n)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){ee("exporting plot...");let n={};n[b.pngFilter]=["png"],n[b.svgFilter]=["svg"];let i=await Nl.window.showSaveDialog({saveLabel:b.exportPlotTitle,filters:n});try{if(i)switch(Qi(i.path).toLowerCase()){case".png":let s=vg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){C(o),Nl.window.showErrorMessage(b.exportImageFailed(o.toString())).then(f,f)}}};rS=v([(0,eh.injectable)(),d(0,(0,eh.inject)(Dp)),d(1,(0,eh.inject)(de)),d(2,(0,eh.inject)(ut)),d(3,(0,eh.inject)(lt))],rS);var nS=class extends rS{constructor(t,n,i,o){super(t,n,i,o);this.fsNode=i}async exportPlot(t){ee("exporting plot...");let n={};n[b.pdfFilter]=["pdf"],n[b.pngFilter]=["png"],n[b.svgFilter]=["svg"];let i=await tU.window.showSaveDialog({saveLabel:b.exportPlotTitle,filters:n});try{if(i)switch(Qi(i.fsPath).toLowerCase()){case".pdf":await rU(t.svg,this.fsNode,i);break;case".png":let s=vg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){C(o),tU.window.showErrorMessage(b.exportImageFailed(o)).then(f,f)}}};nS=v([(0,th.injectable)(),d(0,(0,th.inject)(Dp)),d(1,(0,th.inject)(de)),d(2,(0,th.inject)(gr)),d(3,(0,th.inject)(lt))],nS);async function rU(r,e,t){ee("Attempting pdf write...");let n=(await import("svg-to-pdfkit")).default,i=le(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);ee(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),n(s,r,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),ee(`Finishing pdf to ${t.fsPath}`),await i.promise,ee(`Completed pdf to ${t.fsPath}`)}var Dw=D(O());var iS=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}async dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,n=await this.getOrCreate();await Promise.all(t.map(n.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(W1),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),N("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};iS=v([(0,Dw.injectable)(),d(0,(0,Dw.inject)(pt)),d(1,(0,Dw.inject)(di))],iS);var J1=D(O());var B1=D(O()),Yd=require("vscode");var q1="image/svg+xml",V1={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[q1]:"svg"},oS=class{constructor(e){this.fs=e}async savePlot(e,t,n){if(e.isClosed)return;let i=GIe(e,t,n);if(!i)return C(`No plot to save ${B(e.uri)}, id: ${t} for ${n}`);if(!(n.toLowerCase()in V1))return C(`Unsupported MimeType ${B(e.uri)}, id: ${t} for ${n}`);let o=await this.getSaveTarget(i,n);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let n=V1[t.toLowerCase()],i={};e.items.find(c=>c.mime.toLowerCase()===q1)&&(i[b.pdfFilter]=["pdf"],i[b.svgFilter]=["svg"]),n==="png"&&(i[b.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[n]);let o=(Yd.workspace.workspaceFolders?.length||0)>0?Yd.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?Yd.Uri.joinPath(o,s):Yd.Uri.file(s);return Yd.window.showSaveDialog({defaultUri:a,saveLabel:b.exportPlotTitle,filters:i})}async saveAsImage(e,t){let n=Qi(t.path).substring(1),i=Object.keys(V1).find(s=>V1[s]===n),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,o.data)}async saveAsPdf(e,t){return C("Save as PDF is not yet supported on the web.")}};oS=v([(0,B1.injectable)(),d(0,(0,B1.inject)(ut))],oS);function GIe(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var sS=class extends oS{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,n){let i=Buffer.from(t.items.find(o=>o.mime===q1).data).toString();await rU(i,this.fsNode,n)}};sS=v([(0,J1.injectable)(),d(0,(0,J1.inject)(gr))],sS);var $1=D(O());var zIe="image/svg+xml",QIe="image/png",Hu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let n=IY(e,t,zIe),i;if(n)i=new TextDecoder().decode(n.data);else{let o=IY(e,t,QIe);if(!o)return C(`No SVG or PNG Plot to open ${B(e.uri)}, id: ${t}`);i=YIe(o)}i&&await this.plotViewProvider.showPlot(i)}};Hu=v([(0,$1.injectable)(),d(0,(0,$1.inject)(j1))],Hu);function IY(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function YIe(r){let e=r.data,t=TP(e),n=XIe(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${n.height}" width="${n.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function XIe(r){if(!ZIe(r))throw new Error("The buffer is not a valid png");let e=new DataView(new Uint8Array(r).buffer);return{width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}function ZIe(r){return r[0]===137&&r[1]===80&&r[2]===78&&r[3]===71&&r[4]===13&&r[5]===10&&r[6]===26&&r[7]===10&&r.length>8+21}var _w=D(O()),G1=require("vscode");var H1=Symbol("IPlotSaveHandler");var aS=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){z(this.disposables)}activate(){this.activateImpl().catch(f)}async activateImpl(){let e=G1.extensions.getExtension(Sh);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(({editor:n,message:i})=>{let o=n.notebook||G1.window.activeNotebookEditor?.notebook;o&&(i.type==="saveImageAs"?this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType).catch(f):i.type==="openImageInPlotViewer"&&this.plotViewHandler.openPlot(o,i.outputId).catch(f))},this,this.disposables)}};aS=v([(0,_w.injectable)(),d(0,(0,_w.inject)(H1)),d(1,(0,_w.inject)(Hu))],aS);var rh=D(O()),qo=require("vscode");var cS=class{constructor(e,t,n,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=n;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new qo.EventEmitter;this._onDidChangeActiveNotebook=new qo.EventEmitter;this._onDidRestartActiveNotebook=new qo.EventEmitter;this._executionCountTracker=new WeakMap;qo.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),qo.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),qo.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=qo.window.activeNotebookEditor?.notebook,t=e?.notebookType==_t?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return qo.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){Nt(e.cell.notebook)&&e.state===qo.NotebookCellExecutionState.Idle&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&Nt(e.notebook)){let n=this._executionCountTracker.get(e.notebook);n&&(t.executionCount=n)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};cS=v([(0,rh.injectable)(),d(0,(0,rh.inject)($i)),d(1,(0,rh.inject)(Ke)),d(2,(0,rh.inject)(HI)),d(3,(0,rh.inject)(F))],cS);var SY=class{static{"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel"}},z1=Symbol("INotebookWatcher"),Q1=Symbol("IVariableViewProvider");var Tw=D(O()),xY=require("vscode");var lS=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(xY.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};lS=v([(0,Tw.injectable)(),d(0,(0,Tw.inject)(lt)),d(1,(0,Tw.inject)(Q1))],lS);var ga=D(O());var ha=require("vscode");var Y1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var X1=class extends Bu{constructor(t,n,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=n(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,n,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:n,webviewHost:o})}};var CY=require("vscode");var nh=class extends X1{constructor(t,n,i,o,s,a,c){let l=ir(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,p)=>new Y1(u,p),n,l,[ir(l,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.experiments=c;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),ha.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(ha.Uri.file(process.cwd()),t).catch(C),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,n){switch(t){case"get_variables_request":this.handleMessage(t,n,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,n,this.showDataViewer);break;default:break}super.onMessage(t,n)}handleMessage(t,n,i){let o=n;i.bind(this)(o)}handleVisibilityChanged(){let t=new cr("jupyter.variableViewVisible"),n=!1;this.webviewView&&(n=this.webviewView.visible),t.set(n).catch(f),n&&(N("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(f):this.postMessage("force_variable_refresh").catch(f))}async showDataViewer(t){t.variable.fileName=t.variable.fileName??this.notebookWatcher.activeKernel?.notebook.uri;try{if(this.experiments.inExperiment("DataViewerContribution")){let n=this.getMatchingVariableViewers(t.variable);if(n.length===0){await ha.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers");return}else if(n.length===1){let i=n[0].jupyterVariableViewers.command;return ha.commands.executeCommand(i,t.variable)}else{let i=n.filter(s=>s.extension.id!==Je);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return ha.commands.executeCommand(s,t.variable)}let o=ha.window.createQuickPick();o.title="Select DataFrame Viewer",o.items=n.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(()=>{let s=o.selectedItems[0];s&&(o.hide(),ha.commands.executeCommand(s.command,t.variable).then(f,f))}),o.show()}}else return ha.commands.executeCommand($.ShowDataViewer,t.variable)}catch(n){C(n),N("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),ha.window.showErrorMessage(b.showDataViewerFail).then(f,f)}}getMatchingVariableViewers(t){return this.getVariableViewers().filter(i=>i.jupyterVariableViewers.dataTypes.includes(t.type))}getVariableViewers(){return CY.extensions.all.filter(n=>n.packageJSON?.contributes?.jupyterVariableViewers&&n.packageJSON?.contributes?.jupyterVariableViewers.length).map(n=>{let i=n.packageJSON?.contributes;return i?.jupyterVariableViewers?i.jupyterVariableViewers.map(o=>({extension:n,jupyterVariableViewers:o})):[]}).flat()}postProcessSupportsDataExplorer(t){let n=this.getVariableViewers();return t.pageResponse.forEach(i=>{this.experiments.inExperiment("DataViewerContribution")&&(i.supportsDataExplorer=n.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type)))}),t}async requestVariables(t){let n=this.notebookWatcher.activeKernel;if(n){let i=await this.variables.getVariables(t,n);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(f),N("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(f)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(f),this.postMessage("force_variable_refresh").catch(f)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(f)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(f)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(f)}};v([mr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],nh.prototype,"load",1),v([Ur()],nh.prototype,"showDataViewer",1),v([Ur()],nh.prototype,"requestVariables",1);var uS=class{constructor(e,t,n,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=n;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.experiments=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!Nr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=le(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,n){e.webview.options={enableScripts:!0},this.variableView=new nh(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.experiments),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};uS=v([(0,ga.injectable)(),d(0,(0,ga.inject)(de)),d(1,(0,ga.inject)(sk)),d(2,(0,ga.inject)(lt)),d(3,(0,ga.inject)(jn)),d(3,(0,ga.named)(Qe.ALL_VARIABLES)),d(4,(0,ga.inject)(F)),d(5,(0,ga.inject)(z1)),d(6,(0,ga.inject)(ac))],uS);function wY(r){r.addSingleton(Ie,aS),r.add(D1,Xf),r.addSingleton(HI,Qd),r.addSingleton(GI,YI),r.addSingleton(Ie,QI),r.add(W1,nS),r.addSingleton(j1,iS),r.addSingleton(H1,sS),r.addSingleton(Hu,Hu),r.addSingleton(z1,cS),r.addSingleton(Ie,lS),r.addSingleton(Ie,tS),r.addSingleton(Q1,uS),r.add(_1,Ju),r.addSingleton(T1,eS)}var iU=nU();function Z1(r,e,...t){let i=[...t].length===0?iU(e):iU(e,...t);return r?`${r} ${Xw()}: ${i}`:i}var eR=class{constructor(e){this.prefix=e}traceLog(e,...t){console.log(iU(`${this.prefix||""} ${e}`,...t))}traceError(e,...t){console.error(Z1("error",`${this.prefix||""} ${e}`,...t))}traceWarn(e,...t){console.warn(Z1("warn",`${this.prefix||""} ${e}`,...t))}traceInfo(e,...t){console.info(Z1("info",`${this.prefix||""} ${e}`,...t))}traceVerbose(e,...t){console.log(Z1("verbose",`${this.prefix||""} ${e}`,...t))}};var Xd=require("os");var Jo=D(require("vscode"));var DY=D(require("vscode"));var ih=D(require("vscode")),oU;(t=>{function r(n){return n.start.line===n.end.line&&n.start.character===n.end.character}t.isEmpty=r;function e(n,i){let o=n.start.line,s=n.start.character,a=n.end.line,c=n.end.character,l=i.start.line,u=i.start.character,p=i.end.line,m=i.end.character;return o<l?(o=l,s=u):o===l&&(s=Math.max(s,u)),a>p?(a=p,c=m):a===p&&(c=Math.min(c,m)),!(o>a||o===a&&s>c)}t.intersects=e})(oU||={});function sU(r){r.sort((t,n)=>t-n);let e=r.shift();return e===void 0?[]:r.reduce(function(t,n){return n<=t[0][1]?t[0][1]=n+1:t.unshift([n,n+1]),t},[[e,e+1]]).reverse().map(t=>new ih.NotebookRange(t[0],t[1]))}function PY(r){return r.reduce((t,n)=>{for(let i=n.start;i<n.end;i++)t.push(i);return t},[])}function eSe(r){return ih.workspace.notebookDocuments.find(e=>e.uri.authority===r.uri.authority&&e.uri.path===r.uri.path)}function Rw(r){let e=ih.workspace.textDocuments.find(o=>o.uri.toString()===r?.document.uri.toString())??ih.window.activeTextEditor?.document;if(!e)return;let t=eSe(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function aU(r,e){return r.start.line===e.start.line&&r.start.character===e.start.character&&r.end.line===e.end.line&&r.end.character===e.end.character}function Ei(){}var kY="ms-python.vscode-pylance";async function tSe(r){return await r.activate()}var cU;async function _Y(){let r=DY.extensions.getExtension(kY);if(r)return cU||new Promise((e,t)=>{tSe(r).then(async n=>{if(!n){console.error("Could not start Pylance"),t();return}n.client&&await n.client.start(),cU=n.notebook,e(n.notebook)}).then(Ei,Ei)})}var lr=D(require("vscode"));var rSe=lr.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),nSe=lr.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),tR=class{constructor(e,t,n){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=n}_getVirtualCellList(e){return this._cellExecution.findIndex(n=>n.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(n=>n.cell)}getPredecessorCells(e,t=!1){let n=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=n.length-1;i>=0&&n[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=n.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let c=new Map;for(let[p,m]of this._cellRefs.entries()){let h=m.filter(g=>g.kind==="write").map(g=>g.uri.fragment);m.forEach(g=>{let y=g.uri.fragment;c.has(y)?c.get(y)?.push(p):c.set(y,[p])}),m.forEach(g=>{let y=g.uri.fragment;c.has(y)?c.get(y)?.push(...h):c.set(y,h)})}let l=e.document.uri.fragment;this._resolveDependencies(c,a,l,s,t);let u=[];for(let p=0;p<a.length;p++)a[p]&&u.push(s[p]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),n=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(n===-1)return[];let i=new Array(t.length).fill(!1);i[n]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(c=>{if(c.kind==="write"){let l=c.uri.fragment,u=o.get(l)??[];u.push(...a.filter(p=>p!==c)),o.set(l,u)}})});for(let a=n;a<t.length;a++)if(i[a]){let c=this._cellRefs.get(t[a].document.uri.fragment)||[],l=o.get(t[a].document.uri.fragment)||[];[...c,...l].forEach(p=>{let m=t.findIndex(h=>h.document.uri.fragment===p.uri.fragment);m!==-1&&m>=a&&(i[m]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,n,i,o=!1){if(e.has(n))for(let s of e.get(n)){let a=i.findIndex(c=>c.document.uri.fragment===s);if(a===-1){if(o)continue;throw new Error(`Dependency ${s} is not in the execution list.`)}t[a]||(t[a]=!0,this._resolveDependencies(e,t,s,i,o))}}};var rR=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(n=>{this._requestCellSymbols(n,!1).then(Ei,Ei)}),this._disposables.push(lr.workspace.onDidChangeNotebookDocument(n=>{n.notebook===this._notebookEditor.notebook&&(n.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(Ei,Ei)})}),n.cellChanges.forEach(i=>{this._requestCellSymbols(i.cell,!1).then(Ei,Ei),this._updateCellStatus(i.cell,0)}))})),this._disposables.push(lr.notebooks.onDidChangeNotebookCellExecutionState(n=>{n.state===lr.NotebookCellExecutionState.Executing&&n.cell.document.languageId==="python"&&this._updateCellStatus(n.cell,1),n.state===lr.NotebookCellExecutionState.Idle&&n.cell.document.languageId==="python"&&(this._cellExecution.push({cell:n.cell,executionCount:n.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(n.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async _requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let n=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);n&&await this._requestCellSymbols(n,!0)}}async getCellSymbolRefs(e){let t=this._cellRefs.get(e.document.uri.fragment);if(t)return t}async selectPrecedentCells(e){let t=await this.getPrecedentCells(e);this._notebookEditor.selections=t}async selectSuccessorCells(e){let t=await this.getSuccessorCells(e);this._notebookEditor.selections=t}async runPrecedentCells(e){let t=await this.getPrecedentCells(e);await lr.commands.executeCommand("notebook.cell.execute",{ranges:t.map(n=>({start:n.start,end:n.end})),document:this._notebookEditor.notebook.uri}).then(Ei,Ei)}async runSuccessorCells(e){let t=await this.getSuccessorCells(e);await lr.commands.executeCommand("notebook.cell.execute",{ranges:t.map(n=>({start:n.start,end:n.end})),document:this._notebookEditor.notebook.uri}).then(Ei,Ei)}async getPrecedentCells(e){await this._requestCellSymbolsSync();let t=new tR(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),n=[];try{n=t.getPredecessorCells(e)}catch{try{n=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=n.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0);return sU((i===-1?n:n.slice(i)).map(s=>s.index))}async getSuccessorCells(e){await this._requestCellSymbolsSync();let n=new tR(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e);return sU(n.map(o=>o.index))}async debugSymbols(){let e=[];await this._requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let n of lr.window.visibleTextEditors){let i=n.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(n=>{let i=n.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(n)}),t.forEach((n,i)=>{let o=lr.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];n.reduce((l,u)=>l.find(m=>aU(m.range,u.range))?l:l.concat([u]),[]).forEach(l=>{let u=new lr.Position(l.range.end.line,l.range.end.character),p=new lr.Range(u,u);l.kind==="write"?s.push(p):l.kind==="read"&&a.push(p)}),o.setDecorations(rSe,s),o.setDecorations(nSe,a)}})}async _requestCellSymbols(e,t){let n=this._pendingRequests.get(e.document.uri.fragment);if(n&&n.cancel(),t){let o=new lr.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new lr.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(Ei,Ei))},500)}async _getDocumentSymbols(e){if(this._client.getDocumentSymbols){let t=new lr.CancellationTokenSource,n=await this._client.getDocumentSymbols(e.document,t.token);if(n&&n.length>0)return t.dispose(),n}if(e.document.lineCount>1||e.document.lineAt(0).text.length>0)return lr.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let n=await this._getDocumentSymbols(e);if(!n)return;let i=[];for(let o of n){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.filter(a=>a.uri.scheme==="vscode-notebook-cell").map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:o.uri,kind:aU(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},nR=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;lr.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new rR(t,this._client))}),this._disposables.push(lr.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(n=>{this._notebookDocumentSymbolTrackers.has(n.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(n.notebook.uri.toString(),new rR(n,this._client))}),this._notebookDocumentSymbolTrackers.forEach((n,i)=>{lr.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(n.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}getNotebookDocumentSymbolTracker(e){return this._notebookDocumentSymbolTrackers.get(e.toString())}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runSuccessorCells(t)}async runPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runPrecedentCells(t)}async selectSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},iR=class{constructor(e){this.symbolsTracker=e}async provideCodeActions(e,t,n,i){let o=lr.workspace.notebookDocuments.filter(g=>g.uri.path===e.uri.path),s,a;for(let g of o)if(s=g.getCells().find(y=>y.document.uri.toString()===e.uri.toString()),s){a=g;break}if(!s||!a)return[];let c=this.symbolsTracker.getNotebookDocumentSymbolTracker(a.uri);if(!c)return[];let l=n.diagnostics.find(g=>g.source==="Cell Execution Error"&&g.message.startsWith("NameError")&&g.message.endsWith("is not defined"));if(!l)return[];let u=l.message.match(/NameError: name '(.+)' is not defined/);if(!u)return[];let p=u[1],m=await c.getPrecedentCells(s),h=await Promise.all(PY(m).map(async g=>{let y=a?.cellAt(g);if(!y)return!1;let x=await c.getCellSymbolRefs(y);if(!x||x.length<=0)return!1;let E=x.filter(A=>A.associatedSymbol?.name===p).find(A=>A.uri.toString()===s?.document.uri.toString());if(!E)return!1;if(oU.intersects(E.range,t))return!0}));if(i.isCancellationRequested)return[];if(h.some(g=>g)){let g=new lr.CodeAction("Run Precedent Cells",lr.CodeActionKind.QuickFix);return g.command={command:"jupyter.runPrecedentCells",title:"Run Precedent Cells",arguments:[s]},[g]}return[]}};async function TY(r){if(!Jo.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await _Y();if(!t)return;let n=new nR(t);r.subscriptions.push(n),r.subscriptions.push(Jo.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=Rw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectSuccessorCells(s,a)})),r.subscriptions.push(Jo.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=Rw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runPrecedentCells(s,a)})),r.subscriptions.push(Jo.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=Rw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runSuccessorCells(s,a)})),r.subscriptions.push(Jo.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=Rw(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectPrecedentCells(s,a)})),r.subscriptions.push(Jo.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=Jo.window.activeNotebookEditor;i&&await n.debugSymbols(i.notebook)})),r.subscriptions.push(Jo.languages.registerCodeActionsProvider({language:"python",notebookType:"jupyter-notebook"},new iR(n),{providedCodeActionKinds:[Jo.CodeActionKind.QuickFix]}))}function RY(){}var Ss=D(require("vscode"));async function AY(r){r.subscriptions.push(Ss.commands.registerCommand("jupyter.listPipPackages",async e=>{let t=e??Ss.window.activeNotebookEditor?.notebook.uri;if(t){let i=await Pe.instance.get(Ke).get(t);if(i){let o=new Ss.CancellationTokenSource().token;try{let s=await iSe(i,o);if(Array.isArray(s.content))return s.content}catch(s){U("Failed to get pip packages",s)}}}return[]})),r.subscriptions.push(Ss.commands.registerCommand("jupyter.listVariables",async e=>{let t=e??Ss.window.activeNotebookEditor?.notebook.uri;if(!t)return[];let n=Ss.workspace.notebookDocuments.find(u=>u.uri.toString()===t.toString());if(!n)return[];let o=Pe.instance.get(St).getSelected(n);if(!o)return[];let s=o.controller.variableProvider;if(!s)return[];let a=new Ss.CancellationTokenSource().token,c=s.provideVariablesWithSummarization(n,void 0,Ss.NotebookVariablesRequestKind.Named,0,a),l=[];for await(let u of c)l.push(u);return l}))}async function iSe(r,e){let t=`import subprocess
proc = subprocess.Popen(["pip", "list", "--format", "json"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
stdout, stderr = proc.communicate()
return stdout
`.split(`
`);try{return{content:await Qf(r,t,e)}}catch(n){throw n}}var LY=D(tN());var NY=D(O());var oh=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,n,i){n?this.container.bind(e).to(t).whenTargetNamed(n):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,n,i){n?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,n){n?this.container.bind(e).toConstantValue(t).whenTargetNamed(n):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,n){n?this.container.rebind(e).to(t).whenTargetNamed(n):this.container.rebind(e).to(t)}rebindSingleton(e,t,n){n?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,n){n?this.container.rebind(e).toConstantValue(t).whenTargetNamed(n):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};v([Eh()],oh.prototype,"getContainer",1),oh=v([(0,NY.injectable)()],oh);var _n=require("vscode");var MY=nU(),oR=class{constructor(e,t,n){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=n}format(e,t,...n){let i=e?`${Xw()} [${e}] ${MY(t,...n)}`:MY(t,...n);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}traceLog(e,...t){this.channel.appendLine(this.format("",e,...t))}traceError(e,...t){this.channel.appendLine(this.format("error",e,...t))}traceWarn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}traceInfo(e,...t){this.channel.appendLine(this.format("info",e,...t))}traceVerbose(e,...t){this.channel.appendLine(this.format("debug",e,...t))}};var KY=require("vscode");function FY(r){let e=KY.window.createOutputChannel(b.jupyterServerConsoleOutputChannel,"log");r.push(e);let t={get(n,i){let o=n[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),OY(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),OY(...s)}}return o}};return new Proxy(e,t)}function OY(...r){r.length===1?P(We(r[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):P(...r)}function UY(r,e,t){let n=_n.window.createOutputChannel(uN.jupyter,"log");mE(new oR(n,t?.userNameRegEx,t?.homePathRegEx)),e.addSingletonInstance($o,n,zu),e.addSingletonInstance($o,FY(r.subscriptions),Ih),n.appendLine(`${_n.env.appName} (${_n.version}, ${_n.env.remoteName}, ${_n.env.appHost})`),n.appendLine(`Jupyter Extension Version: ${r.extension.packageJSON.version}.`);let i=_n.extensions.getExtension(li);i?n.appendLine(`Python Extension Version: ${i.packageJSON.version}.`):n.appendLine("Python Extension not installed.");let o=_n.extensions.getExtension(sm);o?n.appendLine(`Pylance Extension Version${I1()?"":" (Not Used) "}: ${o.packageJSON.version}.`):n.appendLine("Pylance Extension not installed."),t?.platform&&n.appendLine(`Platform: ${t.platform} (${t.arch}).`),!_n.workspace.workspaceFolders||_n.workspace.workspaceFolders.length===0?n.appendLine("No workspace folder opened."):_n.workspace.workspaceFolders.length===1?n.appendLine(`Workspace folder ${B(_n.workspace.workspaceFolders[0].uri)}, Home = ${t?.homePath}`):n.appendLine(`Multiple Workspace folders opened ${_n.workspace.workspaceFolders.map(s=>B(s.uri)).join(", ")}`)}function jY(r){let e=new LY.Container({skipBaseClassChecks:!0}),t=new oh(e),n=new Pe(e);return t.addSingletonInstance(pt,n),t.addSingletonInstance(U6,t),t.addSingletonInstance(F,r.subscriptions),t.addSingletonInstance($e,r.globalState,gt),t.addSingletonInstance($e,r.workspaceState,pi),t.addSingletonInstance(lt,r),[t,n]}function WY(){let r=le(),e={location:_n.ProgressLocation.Window,title:ve.loadingExtension};return _n.window.withProgress(e,()=>r.promise).then(f,f),{dispose:()=>r.resolve()}}function VY(r,e,t){oSe(ve.handleExtensionActivationError),console.error("extension activation failed",r),C("extension activation failed",r),y3(r,e,t)}function oSe(r){try{_n.window.showErrorMessage(r).then(f,f)}catch(e){C("failed to notify user",e)}}var sR=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}},sh=new sR,pS={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0};pS.codeLoadingTime=sh.elapsedTime;var lU;async function sSe(r){pS.startActivateTime=sh.elapsedTime,r9(sh),$V(r.subscriptions),$j(va.env.uiKind==va.UIKind.Web),Gj(!1),r.subscriptions.push({dispose:()=>MS.isExiting=!0});try{let[e,t]=cSe(r);return await t,pS.endActivateTime=sh.elapsedTime,v3(pS,sh),e}catch(e){return pS.endActivateTime=sh.elapsedTime,VY(e,pS,sh),C("Failed to active the Jupyter Extension",e),{ready:Promise.resolve(),registerPythonApi:f,registerRemoteServerProvider:()=>({dispose:f}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0)}}}}function aSe(){if(MS.isExiting=!0,lU){let r=lU.get(di);if(r)return r.dispose()}return RY(),Promise.resolve()}function cSe(r){let e=WY();try{let[t,n]=jY(r);lU=n,XV(s=>n.get(Gp).getPackageVersions(s));let i=lSe(r,t,n);return TY(r).then(f,f),AY(r).then(f,f),[f3(i,t,n,r),i,n]}finally{e.dispose()}}async function lSe(r,e,t){return mSe(r,e,t)}function uSe(){if(process.env.VSC_JUPYTER_FORCE_LOGGING){let r;ci||(r="Jupyter Extension:"),mE(new eR(r))}}function BY(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function pSe(){try{let r=BY((0,Xd.userInfo)().username);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get username info with ${r}
 username will not be obfuscated in local logs`)}}function dSe(){try{let r=BY(cv().fsPath);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get home directory path with ${r}
 home Path will not be obfuscated in local logs`)}}async function mSe(r,e,t){let n=!Nr()&&(r.extensionMode===va.ExtensionMode.Development||va.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(A2,n),n&&va.commands.executeCommand("setContext","jupyter.development",!0).then(f,f),va.commands.executeCommand("setContext","jupyter.webExtension",!1).then(f,f),_2((0,Xd.homedir)()),UY(r,e,{userNameRegEx:pSe(),homePathRegEx:dSe(),arch:(0,Xd.arch)(),platform:(0,Xd.platform)(),homePath:tD.fsPath}),uSe(),M$(e),IG(e,n),Dz(e,n),RQ(e),mY(r,e,n),wY(e);let i=t.get(ac),o=new sR;await i.activate();let s=o.elapsedTime;N("DS_INTERNAL.EXPERIMENT_LOAD",{duration:s});let c=e.get(de).getSettings();DA(c.logging.level),c.onDidChange(()=>{DA(c.logging.level)}),va.commands.executeCommand("setContext","jupyter.vscode.channel",qs()).then(f,f),t.get(XP).activate();let l=t.get(fE);l.initialize(),r.subscriptions.push(l)}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
