"use strict";var DY=Object.create;var _S=Object.defineProperty;var Tj=Object.getOwnPropertyDescriptor;var _Y=Object.getOwnPropertyNames;var TY=Object.getPrototypeOf,RY=Object.prototype.hasOwnProperty;var AY=(r,e)=>()=>(r&&(e=r(r=0)),e);var M=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Rj=(r,e)=>{for(var t in e)_S(r,t,{get:e[t],enumerable:!0})},Aj=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of _Y(e))!RY.call(r,i)&&i!==t&&_S(r,i,{get:()=>e[i],enumerable:!(n=Tj(e,i))||n.enumerable});return r};var D=(r,e,t)=>(t=r!=null?DY(TY(r)):{},Aj(e||!r||!r.__esModule?_S(t,"default",{value:r,enumerable:!0}):t,r)),Nj=r=>Aj(_S({},"__esModule",{value:!0}),r),v=(r,e,t,n)=>{for(var i=n>1?void 0:n?Tj(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&_S(e,t,i),i},d=(r,e)=>(t,n)=>e(t,n,r);var Oj=M(()=>{var Mj;(function(r){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof t.Reflect>"u"?t.Reflect=r:n=i(t.Reflect,n),e(n);function i(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,l={create:s?function(){return on(Object.create(null))}:a?function(){return on({__proto__:null})}:function(){return on({})},has:c?function(H,ie){return t.call(H,ie)}:function(H,ie){return ie in H},get:c?function(H,ie){return t.call(H,ie)?H[ie]:void 0}:function(H,ie){return H[ie]}},u=Object.getPrototypeOf(Function),p=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",m=!p&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:kr(),h=!p&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Hr(),g=!p&&typeof WeakMap=="function"?WeakMap:Rr(),y=new g;function C(H,ie,ge,Ee){if(Pt(ge)){if(!Ml(H))throw new TypeError;if(!V(ie))throw new TypeError;return we(H,ie)}else{if(!Ml(H))throw new TypeError;if(!Bt(ie))throw new TypeError;if(!Bt(Ee)&&!Pt(Ee)&&!$r(Ee))throw new TypeError;return $r(Ee)&&(Ee=void 0),ge=ti(ge),Ue(H,ie,ge,Ee)}}e("decorate",C);function k(H,ie){function ge(Ee,ze){if(!Bt(Ee))throw new TypeError;if(!Pt(ze)&&!Ie(ze))throw new TypeError;X(H,ie,Ee,ze)}return ge}e("metadata",k);function A(H,ie,ge,Ee){if(!Bt(ge))throw new TypeError;return Pt(Ee)||(Ee=ti(Ee)),X(H,ie,ge,Ee)}e("defineMetadata",A);function T(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=ti(ge)),gt(H,ie,ge)}e("hasMetadata",T);function U(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=ti(ge)),rt(H,ie,ge)}e("hasOwnMetadata",U);function oe(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=ti(ge)),ae(H,ie,ge)}e("getMetadata",oe);function G(H,ie,ge){if(!Bt(ie))throw new TypeError;return Pt(ge)||(ge=ti(ge)),ke(H,ie,ge)}e("getOwnMetadata",G);function pe(H,ie){if(!Bt(H))throw new TypeError;return Pt(ie)||(ie=ti(ie)),ye(H,ie)}e("getMetadataKeys",pe);function de(H,ie){if(!Bt(H))throw new TypeError;return Pt(ie)||(ie=ti(ie)),qe(H,ie)}e("getOwnMetadataKeys",de);function te(H,ie,ge){if(!Bt(ie))throw new TypeError;Pt(ge)||(ge=ti(ge));var Ee=lt(ie,ge,!1);if(Pt(Ee)||!Ee.delete(H))return!1;if(Ee.size>0)return!0;var ze=y.get(ie);return ze.delete(ge),ze.size>0||y.delete(ie),!0}e("deleteMetadata",te);function we(H,ie){for(var ge=H.length-1;ge>=0;--ge){var Ee=H[ge],ze=Ee(ie);if(!Pt(ze)&&!$r(ze)){if(!V(ze))throw new TypeError;ie=ze}}return ie}function Ue(H,ie,ge,Ee){for(var ze=H.length-1;ze>=0;--ze){var sn=H[ze],kt=sn(ie,ge,Ee);if(!Pt(kt)&&!$r(kt)){if(!Bt(kt))throw new TypeError;Ee=kt}}return Ee}function lt(H,ie,ge){var Ee=y.get(H);if(Pt(Ee)){if(!ge)return;Ee=new m,y.set(H,Ee)}var ze=Ee.get(ie);if(Pt(ze)){if(!ge)return;ze=new m,Ee.set(ie,ze)}return ze}function gt(H,ie,ge){var Ee=rt(H,ie,ge);if(Ee)return!0;var ze=Ot(ie);return $r(ze)?!1:gt(H,ze,ge)}function rt(H,ie,ge){var Ee=lt(ie,ge,!1);return Pt(Ee)?!1:Mt(Ee.has(H))}function ae(H,ie,ge){var Ee=rt(H,ie,ge);if(Ee)return ke(H,ie,ge);var ze=Ot(ie);if(!$r(ze))return ae(H,ze,ge)}function ke(H,ie,ge){var Ee=lt(ie,ge,!1);if(!Pt(Ee))return Ee.get(H)}function X(H,ie,ge,Ee){var ze=lt(ge,Ee,!0);ze.set(H,ie)}function ye(H,ie){var ge=qe(H,ie),Ee=Ot(H);if(Ee===null)return ge;var ze=ye(Ee,ie);if(ze.length<=0)return ge;if(ge.length<=0)return ze;for(var sn=new h,kt=[],Tt=0,ot=ge;Tt<ot.length;Tt++){var Ut=ot[Tt],se=sn.has(Ut);se||(sn.add(Ut),kt.push(Ut))}for(var fe=0,B=ze;fe<B.length;fe++){var Ut=B[fe],se=sn.has(Ut);se||(sn.add(Ut),kt.push(Ut))}return kt}function qe(H,ie){var ge=[],Ee=lt(H,ie,!1);if(Pt(Ee))return ge;for(var ze=Ee.keys(),sn=nt(ze),kt=0;;){var Tt=Gt(sn);if(!Tt)return ge.length=kt,ge;var ot=nn(Tt);try{ge[kt]=ot}catch(Ut){try{Wt(sn)}finally{throw Ut}}kt++}}function fn(H){if(H===null)return 1;switch(typeof H){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return H===null?1:6;default:return 6}}function Pt(H){return H===void 0}function $r(H){return H===null}function xs(H){return typeof H=="symbol"}function Bt(H){return typeof H=="object"?H!==null:typeof H=="function"}function rn(H,ie){switch(fn(H)){case 0:return H;case 1:return H;case 2:return H;case 3:return H;case 4:return H;case 5:return H}var ge=ie===3?"string":ie===5?"number":"default",Ee=Me(H,i);if(Ee!==void 0){var ze=Ee.call(H,ge);if(Bt(ze))throw new TypeError;return ze}return Bi(H,ge==="default"?"number":ge)}function Bi(H,ie){if(ie==="string"){var ge=H.toString;if(L(ge)){var Ee=ge.call(H);if(!Bt(Ee))return Ee}var ze=H.valueOf;if(L(ze)){var Ee=ze.call(H);if(!Bt(Ee))return Ee}}else{var ze=H.valueOf;if(L(ze)){var Ee=ze.call(H);if(!Bt(Ee))return Ee}var sn=H.toString;if(L(sn)){var Ee=sn.call(H);if(!Bt(Ee))return Ee}}throw new TypeError}function Mt(H){return!!H}function cr(H){return""+H}function ti(H){var ie=rn(H,3);return xs(ie)?ie:cr(ie)}function Ml(H){return Array.isArray?Array.isArray(H):H instanceof Object?H instanceof Array:Object.prototype.toString.call(H)==="[object Array]"}function L(H){return typeof H=="function"}function V(H){return typeof H=="function"}function Ie(H){switch(fn(H)){case 3:return!0;case 4:return!0;default:return!1}}function Me(H,ie){var ge=H[ie];if(ge!=null){if(!L(ge))throw new TypeError;return ge}}function nt(H){var ie=Me(H,o);if(!L(ie))throw new TypeError;var ge=ie.call(H);if(!Bt(ge))throw new TypeError;return ge}function nn(H){return H.value}function Gt(H){var ie=H.next();return ie.done?!1:ie}function Wt(H){var ie=H.return;ie&&ie.call(H)}function Ot(H){var ie=Object.getPrototypeOf(H);if(typeof H!="function"||H===u||ie!==u)return ie;var ge=H.prototype,Ee=ge&&Object.getPrototypeOf(ge);if(Ee==null||Ee===Object.prototype)return ie;var ze=Ee.constructor;return typeof ze!="function"||ze===H?ie:ze}function kr(){var H={},ie=[],ge=function(){function kt(Tt,ot,Ut){this._index=0,this._keys=Tt,this._values=ot,this._selector=Ut}return kt.prototype["@@iterator"]=function(){return this},kt.prototype[o]=function(){return this},kt.prototype.next=function(){var Tt=this._index;if(Tt>=0&&Tt<this._keys.length){var ot=this._selector(this._keys[Tt],this._values[Tt]);return Tt+1>=this._keys.length?(this._index=-1,this._keys=ie,this._values=ie):this._index++,{value:ot,done:!1}}return{value:void 0,done:!0}},kt.prototype.throw=function(Tt){throw this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),Tt},kt.prototype.return=function(Tt){return this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),{value:Tt,done:!0}},kt}();return function(){function kt(){this._keys=[],this._values=[],this._cacheKey=H,this._cacheIndex=-2}return Object.defineProperty(kt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),kt.prototype.has=function(Tt){return this._find(Tt,!1)>=0},kt.prototype.get=function(Tt){var ot=this._find(Tt,!1);return ot>=0?this._values[ot]:void 0},kt.prototype.set=function(Tt,ot){var Ut=this._find(Tt,!0);return this._values[Ut]=ot,this},kt.prototype.delete=function(Tt){var ot=this._find(Tt,!1);if(ot>=0){for(var Ut=this._keys.length,se=ot+1;se<Ut;se++)this._keys[se-1]=this._keys[se],this._values[se-1]=this._values[se];return this._keys.length--,this._values.length--,Tt===this._cacheKey&&(this._cacheKey=H,this._cacheIndex=-2),!0}return!1},kt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=H,this._cacheIndex=-2},kt.prototype.keys=function(){return new ge(this._keys,this._values,Ee)},kt.prototype.values=function(){return new ge(this._keys,this._values,ze)},kt.prototype.entries=function(){return new ge(this._keys,this._values,sn)},kt.prototype["@@iterator"]=function(){return this.entries()},kt.prototype[o]=function(){return this.entries()},kt.prototype._find=function(Tt,ot){return this._cacheKey!==Tt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Tt)),this._cacheIndex<0&&ot&&(this._cacheIndex=this._keys.length,this._keys.push(Tt),this._values.push(void 0)),this._cacheIndex},kt}();function Ee(kt,Tt){return kt}function ze(kt,Tt){return Tt}function sn(kt,Tt){return[kt,Tt]}}function Hr(){return function(){function H(){this._map=new m}return Object.defineProperty(H.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),H.prototype.has=function(ie){return this._map.has(ie)},H.prototype.add=function(ie){return this._map.set(ie,ie),this},H.prototype.delete=function(ie){return this._map.delete(ie)},H.prototype.clear=function(){this._map.clear()},H.prototype.keys=function(){return this._map.keys()},H.prototype.values=function(){return this._map.values()},H.prototype.entries=function(){return this._map.entries()},H.prototype["@@iterator"]=function(){return this.keys()},H.prototype[o]=function(){return this.keys()},H}()}function Rr(){var H=16,ie=l.create(),ge=Ee();return function(){function ot(){this._key=Ee()}return ot.prototype.has=function(Ut){var se=ze(Ut,!1);return se!==void 0?l.has(se,this._key):!1},ot.prototype.get=function(Ut){var se=ze(Ut,!1);return se!==void 0?l.get(se,this._key):void 0},ot.prototype.set=function(Ut,se){var fe=ze(Ut,!0);return fe[this._key]=se,this},ot.prototype.delete=function(Ut){var se=ze(Ut,!1);return se!==void 0?delete se[this._key]:!1},ot.prototype.clear=function(){this._key=Ee()},ot}();function Ee(){var ot;do ot="@@WeakMap@@"+Tt();while(l.has(ie,ot));return ie[ot]=!0,ot}function ze(ot,Ut){if(!t.call(ot,ge)){if(!Ut)return;Object.defineProperty(ot,ge,{value:l.create()})}return ot[ge]}function sn(ot,Ut){for(var se=0;se<Ut;++se)ot[se]=Math.random()*255|0;return ot}function kt(ot){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(ot)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(ot)):sn(new Uint8Array(ot),ot):sn(new Array(ot),ot)}function Tt(){var ot=kt(H);ot[6]=ot[6]&79|64,ot[8]=ot[8]&191|128;for(var Ut="",se=0;se<H;++se){var fe=ot[se];(se===4||se===6||se===8)&&(Ut+="-"),fe<16&&(Ut+="0"),Ut+=fe.toString(16).toLowerCase()}return Ut}}function on(H){return H.__=void 0,delete H.__,H}})})(Mj||(Mj={}))});var Kj={};Rj(Kj,{isPreRelesVersionOfJupyterExtension:()=>NY});var NY,Fj=AY(()=>{"use strict";NY=!1});var Pn=M(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.NON_CUSTOM_TAG_KEYS=Xt.PRE_DESTROY=Xt.POST_CONSTRUCT=Xt.DESIGN_PARAM_TYPES=Xt.PARAM_TYPES=Xt.TAGGED_PROP=Xt.TAGGED=Xt.MULTI_INJECT_TAG=Xt.INJECT_TAG=Xt.OPTIONAL_TAG=Xt.UNMANAGED_TAG=Xt.NAME_TAG=Xt.NAMED_TAG=void 0;Xt.NAMED_TAG="named";Xt.NAME_TAG="name";Xt.UNMANAGED_TAG="unmanaged";Xt.OPTIONAL_TAG="optional";Xt.INJECT_TAG="inject";Xt.MULTI_INJECT_TAG="multi_inject";Xt.TAGGED="inversify:tagged";Xt.TAGGED_PROP="inversify:tagged_props";Xt.PARAM_TYPES="inversify:paramtypes";Xt.DESIGN_PARAM_TYPES="design:paramtypes";Xt.POST_CONSTRUCT="post_construct";Xt.PRE_DESTROY="pre_destroy";function dX(){return[Xt.INJECT_TAG,Xt.MULTI_INJECT_TAG,Xt.NAME_TAG,Xt.UNMANAGED_TAG,Xt.NAMED_TAG,Xt.OPTIONAL_TAG]}Xt.NON_CUSTOM_TAG_KEYS=dX()});var Sa=M(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});op.TargetTypeEnum=op.BindingTypeEnum=op.BindingScopeEnum=void 0;var mX={Request:"Request",Singleton:"Singleton",Transient:"Transient"};op.BindingScopeEnum=mX;var fX={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};op.BindingTypeEnum=fX;var hX={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};op.TargetTypeEnum=hX});var sp=M(pE=>{"use strict";Object.defineProperty(pE,"__esModule",{value:!0});pE.id=void 0;var gX=0;function vX(){return gX++}pE.id=vX});var D2=M(dE=>{"use strict";Object.defineProperty(dE,"__esModule",{value:!0});dE.Binding=void 0;var k2=Sa(),yX=sp(),bX=function(){function r(e,t){this.id=(0,yX.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=k2.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return r.prototype.clone=function(){var e=new r(this.serviceIdentifier,this.scope);return e.activated=e.scope===k2.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},r}();dE.Binding=bX});var Pi=M(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.STACK_OVERFLOW=je.CIRCULAR_DEPENDENCY_IN_FACTORY=je.ON_DEACTIVATION_ERROR=je.PRE_DESTROY_ERROR=je.POST_CONSTRUCT_ERROR=je.ASYNC_UNBIND_REQUIRED=je.MULTIPLE_POST_CONSTRUCT_METHODS=je.MULTIPLE_PRE_DESTROY_METHODS=je.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=je.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=je.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=je.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=je.ARGUMENTS_LENGTH_MISMATCH=je.INVALID_DECORATOR_OPERATION=je.INVALID_TO_SELF_VALUE=je.LAZY_IN_SYNC=je.INVALID_FUNCTION_BINDING=je.INVALID_MIDDLEWARE_RETURN=je.NO_MORE_SNAPSHOTS_AVAILABLE=je.INVALID_BINDING_TYPE=je.NOT_IMPLEMENTED=je.CIRCULAR_DEPENDENCY=je.UNDEFINED_INJECT_ANNOTATION=je.MISSING_INJECT_ANNOTATION=je.MISSING_INJECTABLE_ANNOTATION=je.NOT_REGISTERED=je.CANNOT_UNBIND=je.AMBIGUOUS_MATCH=je.KEY_NOT_FOUND=je.NULL_ARGUMENT=je.DUPLICATED_METADATA=je.DUPLICATED_INJECTABLE_DECORATOR=void 0;je.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";je.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";je.NULL_ARGUMENT="NULL argument";je.KEY_NOT_FOUND="Key Not Found";je.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";je.CANNOT_UNBIND="Could not unbind serviceIdentifier:";je.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";je.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";je.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var IX=function(r){return"@inject called with undefined this could mean that the class "+r+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};je.UNDEFINED_INJECT_ANNOTATION=IX;je.CIRCULAR_DEPENDENCY="Circular dependency found:";je.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";je.INVALID_BINDING_TYPE="Invalid binding type:";je.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";je.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";je.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var SX=function(r){return"You are attempting to construct '"+r+`' in a synchronous way
 but it has asynchronous dependencies.`};je.LAZY_IN_SYNC=SX;je.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";je.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var xX=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return"The number of constructor arguments in the derived class "+(r[0]+" must be >= than the number of constructor arguments of its base class.")};je.ARGUMENTS_LENGTH_MISMATCH=xX;je.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";je.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";je.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";je.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";je.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";je.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";je.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var CX=function(r,e){return"@postConstruct error in class "+r+": "+e};je.POST_CONSTRUCT_ERROR=CX;var wX=function(r,e){return"@preDestroy error in class "+r+": "+e};je.PRE_DESTROY_ERROR=wX;var EX=function(r,e){return"onDeactivation() error in class "+r+": "+e};je.ON_DEACTIVATION_ERROR=EX;var PX=function(r,e){return"It looks like there is a circular dependency in one of the '"+r+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};je.CIRCULAR_DEPENDENCY_IN_FACTORY=PX;je.STACK_OVERFLOW="Maximum call stack size exceeded"});var kA=M(cc=>{"use strict";var kX=cc&&cc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),DX=cc&&cc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_X=cc&&cc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&kX(e,r,t);return DX(e,r),e};Object.defineProperty(cc,"__esModule",{value:!0});cc.MetadataReader=void 0;var PA=_X(Pn()),TX=function(){function r(){}return r.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(PA.PARAM_TYPES,e),n=Reflect.getMetadata(PA.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},r.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(PA.TAGGED_PROP,e)||[];return t},r}();cc.MetadataReader=TX});var _2=M(mE=>{"use strict";Object.defineProperty(mE,"__esModule",{value:!0});mE.BindingCount=void 0;var RX={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};mE.BindingCount=RX});var DA=M(_s=>{"use strict";var AX=_s&&_s.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),NX=_s&&_s.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),MX=_s&&_s.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&AX(e,r,t);return NX(e,r),e};Object.defineProperty(_s,"__esModule",{value:!0});_s.tryAndThrowErrorIfStackOverflow=_s.isStackOverflowExeption=void 0;var OX=MX(Pi());function T2(r){return r instanceof RangeError||r.message===OX.STACK_OVERFLOW}_s.isStackOverflowExeption=T2;var KX=function(r,e){try{return r()}catch(t){throw T2(t)&&(t=e()),t}};_s.tryAndThrowErrorIfStackOverflow=KX});var Kh=M(kn=>{"use strict";var FX=kn&&kn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),LX=kn&&kn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),UX=kn&&kn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&FX(e,r,t);return LX(e,r),e};Object.defineProperty(kn,"__esModule",{value:!0});kn.getSymbolDescription=kn.circularDependencyToException=kn.listMetadataForTarget=kn.listRegisteredBindingsForServiceIdentifier=kn.getServiceIdentifierAsString=kn.getFunctionName=void 0;var jX=UX(Pi());function R2(r){if(typeof r=="function"){var e=r;return e.name}else{if(typeof r=="symbol")return r.toString();var e=r;return e}}kn.getServiceIdentifierAsString=R2;function WX(r,e,t){var n="",i=t(r,e);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=M2(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}kn.listRegisteredBindingsForServiceIdentifier=WX;function A2(r,e){return r.parentRequest===null?!1:r.parentRequest.serviceIdentifier===e?!0:A2(r.parentRequest,e)}function VX(r){function e(n,i){i===void 0&&(i=[]);var o=R2(n.serviceIdentifier);return i.push(o),n.parentRequest!==null?e(n.parentRequest,i):i}var t=e(r);return t.reverse().join(" --> ")}function N2(r){r.childRequests.forEach(function(e){if(A2(e,e.serviceIdentifier)){var t=VX(e);throw new Error(jX.CIRCULAR_DEPENDENCY+" "+t)}else N2(e)})}kn.circularDependencyToException=N2;function BX(r,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),i=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+r+`
 `+r+" - "+t}else return" "+r}kn.listMetadataForTarget=BX;function M2(r){if(r.name)return r.name;var e=r.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}kn.getFunctionName=M2;function qX(r){return r.toString().slice(7,-1)}kn.getSymbolDescription=qX});var O2=M(fE=>{"use strict";Object.defineProperty(fE,"__esModule",{value:!0});fE.Context=void 0;var JX=sp(),$X=function(){function r(e){this.id=(0,JX.id)(),this.container=e}return r.prototype.addPlan=function(e){this.plan=e},r.prototype.setCurrentRequest=function(e){this.currentRequest=e},r}();fE.Context=$X});var xa=M(lc=>{"use strict";var HX=lc&&lc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),GX=lc&&lc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),zX=lc&&lc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&HX(e,r,t);return GX(e,r),e};Object.defineProperty(lc,"__esModule",{value:!0});lc.Metadata=void 0;var QX=zX(Pn()),YX=function(){function r(e,t){this.key=e,this.value=t}return r.prototype.toString=function(){return this.key===QX.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},r}();lc.Metadata=YX});var K2=M(hE=>{"use strict";Object.defineProperty(hE,"__esModule",{value:!0});hE.Plan=void 0;var XX=function(){function r(e,t){this.parentContext=e,this.rootRequest=t}return r}();hE.Plan=XX});var _A=M(gE=>{"use strict";Object.defineProperty(gE,"__esModule",{value:!0});gE.LazyServiceIdentifer=void 0;var ZX=function(){function r(e){this._cb=e}return r.prototype.unwrap=function(){return this._cb()},r}();gE.LazyServiceIdentifer=ZX});var F2=M(vE=>{"use strict";Object.defineProperty(vE,"__esModule",{value:!0});vE.QueryableString=void 0;var eZ=function(){function r(e){this.str=e}return r.prototype.startsWith=function(e){return this.str.indexOf(e)===0},r.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},r.prototype.contains=function(e){return this.str.indexOf(e)!==-1},r.prototype.equals=function(e){return this.str===e},r.prototype.value=function(){return this.str},r}();vE.QueryableString=eZ});var TA=M(uc=>{"use strict";var tZ=uc&&uc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),rZ=uc&&uc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),nZ=uc&&uc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&tZ(e,r,t);return rZ(e,r),e};Object.defineProperty(uc,"__esModule",{value:!0});uc.Target=void 0;var Vl=nZ(Pn()),iZ=sp(),oZ=Kh(),L2=xa(),sZ=F2(),aZ=function(){function r(e,t,n,i){this.id=(0,iZ.id)(),this.type=e,this.serviceIdentifier=n;var o=typeof t=="symbol"?(0,oZ.getSymbolDescription)(t):t;this.name=new sZ.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new L2.Metadata(Vl.NAMED_TAG,i):i instanceof L2.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return r.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var i=n[t];if(i.key===e)return!0}return!1},r.prototype.isArray=function(){return this.hasTag(Vl.MULTI_INJECT_TAG)},r.prototype.matchesArray=function(e){return this.matchesTag(Vl.MULTI_INJECT_TAG)(e)},r.prototype.isNamed=function(){return this.hasTag(Vl.NAMED_TAG)},r.prototype.isTagged=function(){return this.metadata.some(function(e){return Vl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},r.prototype.isOptional=function(){return this.matchesTag(Vl.OPTIONAL_TAG)(!0)},r.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Vl.NAMED_TAG})[0]:null},r.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Vl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},r.prototype.matchesNamedTag=function(e){return this.matchesTag(Vl.NAMED_TAG)(e)},r.prototype.matchesTag=function(e){var t=this;return function(n){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===n)return!0}return!1}},r}();uc.Target=aZ});var $2=M(ki=>{"use strict";var cZ=ki&&ki.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),lZ=ki&&ki.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),U2=ki&&ki.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&cZ(e,r,t);return lZ(e,r),e},yE=ki&&ki.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(ki,"__esModule",{value:!0});ki.getFunctionName=ki.getBaseClassDependencyCount=ki.getDependencies=void 0;var uZ=_A(),RA=U2(Pi()),j2=Sa(),HS=U2(Pn()),AA=Kh();Object.defineProperty(ki,"getFunctionName",{enumerable:!0,get:function(){return AA.getFunctionName}});var W2=TA();function pZ(r,e){var t=(0,AA.getFunctionName)(e);return V2(r,t,e,!1)}ki.getDependencies=pZ;function V2(r,e,t,n){var i=r.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=RA.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,c=Object.keys(a),l=t.length===0&&c.length>0,u=c.length>t.length,p=l||u?c.length:t.length,m=mZ(n,e,o,a,p),h=B2(r,t,e),g=yE(yE([],m,!0),h,!0);return g}function dZ(r,e,t,n,i){var o=i[r.toString()]||[],s=J2(o),a=s.unmanaged!==!0,c=n[r],l=s.inject||s.multiInject;if(c=l||c,c instanceof uZ.LazyServiceIdentifer&&(c=c.unwrap()),a){var u=c===Object,p=c===Function,m=c===void 0,h=u||p||m;if(!e&&h){var g=RA.MISSING_INJECT_ANNOTATION+" argument "+r+" in class "+t+".";throw new Error(g)}var y=new W2.Target(j2.TargetTypeEnum.ConstructorArgument,s.targetName,c);return y.metadata=o,y}return null}function mZ(r,e,t,n,i){for(var o=[],s=0;s<i;s++){var a=s,c=dZ(a,r,e,t,n);c!==null&&o.push(c)}return o}function fZ(r,e,t,n){var i=r||e;if(i===void 0){var o=RA.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+n+".";throw new Error(o)}return i}function B2(r,e,t){for(var n=r.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(n),s=Object.keys(n),a=s.concat(o),c=0,l=a;c<l.length;c++){var u=l[c],p=n[u],m=J2(p),h=m.targetName||u,g=fZ(m.inject,m.multiInject,u,t),y=new W2.Target(j2.TargetTypeEnum.ClassProperty,h,g);y.metadata=p,i.push(y)}var C=Object.getPrototypeOf(e.prototype).constructor;if(C!==Object){var k=B2(r,C,t);i=yE(yE([],i,!0),k,!0)}return i}function q2(r,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=(0,AA.getFunctionName)(t),i=V2(r,n,t,!0),o=i.map(function(c){return c.metadata.filter(function(l){return l.key===HS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:q2(r,t)}else return 0}ki.getBaseClassDependencyCount=q2;function J2(r){var e={};return r.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[HS.INJECT_TAG],multiInject:e[HS.MULTI_INJECT_TAG],targetName:e[HS.NAME_TAG],unmanaged:e[HS.UNMANAGED_TAG]}}});var H2=M(bE=>{"use strict";Object.defineProperty(bE,"__esModule",{value:!0});bE.Request=void 0;var hZ=sp(),gZ=function(){function r(e,t,n,i,o){this.id=(0,hZ.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return r.prototype.addChildRequest=function(e,t,n){var i=new r(e,this.parentContext,this,t,n);return this.childRequests.push(i),i},r}();bE.Request=gZ});var FA=M(uo=>{"use strict";var vZ=uo&&uo.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),yZ=uo&&uo.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Q2=uo&&uo.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vZ(e,r,t);return yZ(e,r),e};Object.defineProperty(uo,"__esModule",{value:!0});uo.getBindingDictionary=uo.createMockRequest=uo.plan=void 0;var IE=_2(),MA=Q2(Pi()),Y2=Sa(),G2=Q2(Pn()),bZ=DA(),Fh=Kh(),X2=O2(),OA=xa(),IZ=K2(),NA=$2(),KA=H2(),Z2=TA();function eW(r){return r._bindingDictionary}uo.getBindingDictionary=eW;function SZ(r,e,t,n,i,o){var s=r?G2.MULTI_INJECT_TAG:G2.INJECT_TAG,a=new OA.Metadata(s,t),c=new Z2.Target(e,n,t,a);if(i!==void 0){var l=new OA.Metadata(i,o);c.metadata.push(l)}return c}function z2(r,e,t,n,i){var o=GS(t.container,i.serviceIdentifier),s=[];return o.length===IE.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&r.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=GS(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new KA.Request(a.serviceIdentifier,t,n,a,i);return a.constraint(c)}),xZ(i.serviceIdentifier,s,i,t.container),s}function xZ(r,e,t,n){switch(e.length){case IE.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,Fh.getServiceIdentifierAsString)(r),o=MA.NOT_REGISTERED;throw o+=(0,Fh.listMetadataForTarget)(i,t),o+=(0,Fh.listRegisteredBindingsForServiceIdentifier)(n,i,GS),new Error(o);case IE.BindingCount.OnlyOneBindingAvailable:return e;case IE.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,Fh.getServiceIdentifierAsString)(r),o=MA.AMBIGUOUS_MATCH+" "+i;throw o+=(0,Fh.listRegisteredBindingsForServiceIdentifier)(n,i,GS),new Error(o)}}function tW(r,e,t,n,i,o){var s,a;if(i===null){s=z2(r,e,n,null,o),a=new KA.Request(t,n,null,s,o);var c=new IZ.Plan(n,a);n.addPlan(c)}else s=z2(r,e,n,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(l){var u=null;if(o.isArray())u=a.addChildRequest(l.serviceIdentifier,l,o);else{if(l.cache)return;u=a}if(l.type===Y2.BindingTypeEnum.Instance&&l.implementationType!==null){var p=(0,NA.getDependencies)(r,l.implementationType);if(!n.container.options.skipBaseClassChecks){var m=(0,NA.getBaseClassDependencyCount)(r,l.implementationType);if(p.length<m){var h=MA.ARGUMENTS_LENGTH_MISMATCH((0,NA.getFunctionName)(l.implementationType));throw new Error(h)}}p.forEach(function(g){tW(r,!1,g.serviceIdentifier,n,u,g)})}})}function GS(r,e){var t=[],n=eW(r);return n.hasKey(e)?t=n.get(e):r.parent!==null&&(t=GS(r.parent,e)),t}function CZ(r,e,t,n,i,o,s,a){a===void 0&&(a=!1);var c=new X2.Context(e),l=SZ(t,n,i,"",o,s);try{return tW(r,a,i,c,null,l),c}catch(u){throw(0,bZ.isStackOverflowExeption)(u)&&(0,Fh.circularDependencyToException)(c.plan.rootRequest),u}}uo.plan=CZ;function wZ(r,e,t,n){var i=new Z2.Target(Y2.TargetTypeEnum.Variable,"",e,new OA.Metadata(t,n)),o=new X2.Context(r),s=new KA.Request(e,o,null,[],i);return s}uo.createMockRequest=wZ});var zS=M(Lh=>{"use strict";Object.defineProperty(Lh,"__esModule",{value:!0});Lh.isPromiseOrContainsPromise=Lh.isPromise=void 0;function LA(r){var e=typeof r=="object"&&r!==null||typeof r=="function";return e&&typeof r.then=="function"}Lh.isPromise=LA;function EZ(r){return LA(r)?!0:Array.isArray(r)&&r.some(LA)}Lh.isPromiseOrContainsPromise=EZ});var rW=M(pc=>{"use strict";var PZ=pc&&pc.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},kZ=pc&&pc.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(pc,"__esModule",{value:!0});pc.saveToScope=pc.tryGetFromScope=void 0;var SE=O(),DZ=zS(),_Z=function(r,e){return e.scope===SE.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===SE.BindingScopeEnum.Request&&r.has(e.id)?r.get(e.id):null};pc.tryGetFromScope=_Z;var TZ=function(r,e,t){e.scope===SE.BindingScopeEnum.Singleton&&AZ(e,t),e.scope===SE.BindingScopeEnum.Request&&RZ(r,e,t)};pc.saveToScope=TZ;var RZ=function(r,e,t){r.has(e.id)||r.set(e.id,t)},AZ=function(r,e){r.cache=e,r.activated=!0,(0,DZ.isPromise)(e)&&NZ(r,e)},NZ=function(r,e){return PZ(void 0,void 0,void 0,function(){var t,n;return kZ(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),r.cache=t,[3,3];case 2:throw n=i.sent(),r.cache=null,r.activated=!1,n;case 3:return[2]}})})}});var nW=M(QS=>{"use strict";Object.defineProperty(QS,"__esModule",{value:!0});QS.FactoryType=void 0;var MZ;(function(r){r.DynamicValue="toDynamicValue",r.Factory="toFactory",r.Provider="toProvider"})(MZ=QS.FactoryType||(QS.FactoryType={}))});var jA=M(po=>{"use strict";var OZ=po&&po.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),KZ=po&&po.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),FZ=po&&po.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&OZ(e,r,t);return KZ(e,r),e};Object.defineProperty(po,"__esModule",{value:!0});po.getFactoryDetails=po.ensureFullyBound=po.multiBindToService=void 0;var LZ=O(),UZ=FZ(Pi()),dc=Sa(),UA=nW(),jZ=function(r){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(i){return r.bind(i).toService(e)})}}};po.multiBindToService=jZ;var WZ=function(r){var e=null;switch(r.type){case dc.BindingTypeEnum.ConstantValue:case dc.BindingTypeEnum.Function:e=r.cache;break;case dc.BindingTypeEnum.Constructor:case dc.BindingTypeEnum.Instance:e=r.implementationType;break;case dc.BindingTypeEnum.DynamicValue:e=r.dynamicValue;break;case dc.BindingTypeEnum.Provider:e=r.provider;break;case dc.BindingTypeEnum.Factory:e=r.factory;break}if(e===null){var t=(0,LZ.getServiceIdentifierAsString)(r.serviceIdentifier);throw new Error(UZ.INVALID_BINDING_TYPE+" "+t)}};po.ensureFullyBound=WZ;var VZ=function(r){switch(r.type){case dc.BindingTypeEnum.Factory:return{factory:r.factory,factoryType:UA.FactoryType.Factory};case dc.BindingTypeEnum.Provider:return{factory:r.provider,factoryType:UA.FactoryType.Provider};case dc.BindingTypeEnum.DynamicValue:return{factory:r.dynamicValue,factoryType:UA.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+r.type)}};po.getFactoryDetails=VZ});var lW=M(zn=>{"use strict";var Uh=zn&&zn.__assign||function(){return Uh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Uh.apply(this,arguments)},BZ=zn&&zn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),qZ=zn&&zn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),JZ=zn&&zn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&BZ(e,r,t);return qZ(e,r),e},sW=zn&&zn.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},aW=zn&&zn.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},$Z=zn&&zn.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(zn,"__esModule",{value:!0});zn.resolveInstance=void 0;var WA=Pi(),BA=Sa(),VA=JZ(Pn()),qA=zS();function HZ(r,e){return r.reduce(function(t,n){var i=e(n),o=n.target.type;return o===BA.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(n),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,qA.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function GZ(r,e,t){var n;if(e.length>0){var i=HZ(e,t),o=Uh(Uh({},i),{constr:r});i.isAsync?n=zZ(o):n=cW(o)}else n=new r;return n}function cW(r){var e,t=new((e=r.constr).bind.apply(e,$Z([void 0],r.constructorInjections,!1)));return r.propertyRequests.forEach(function(n,i){var o=n.target.identifier,s=r.propertyInjections[i];t[o]=s}),t}function zZ(r){return sW(this,void 0,void 0,function(){var e,t;return aW(this,function(n){switch(n.label){case 0:return[4,iW(r.constructorInjections)];case 1:return e=n.sent(),[4,iW(r.propertyInjections)];case 2:return t=n.sent(),[2,cW(Uh(Uh({},r),{constructorInjections:e,propertyInjections:t}))]}})})}function iW(r){return sW(this,void 0,void 0,function(){var e,t,n,i;return aW(this,function(o){for(e=[],t=0,n=r;t<n.length;t++)i=n[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function oW(r,e){var t=QZ(r,e);return(0,qA.isPromise)(t)?t.then(function(){return e}):e}function QZ(r,e){var t,n;if(Reflect.hasMetadata(VA.POST_CONSTRUCT,r)){var i=Reflect.getMetadata(VA.POST_CONSTRUCT,r);try{return(n=(t=e)[i.value])===null||n===void 0?void 0:n.call(t)}catch(o){throw new Error((0,WA.POST_CONSTRUCT_ERROR)(r.name,o.message))}}}function YZ(r,e){r.scope!==BA.BindingScopeEnum.Singleton&&XZ(r,e)}function XZ(r,e){var t="Class cannot be instantiated in "+(r.scope===BA.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof r.onDeactivation=="function")throw new Error((0,WA.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(VA.PRE_DESTROY,e))throw new Error((0,WA.PRE_DESTROY_ERROR)(e.name,t))}function ZZ(r,e,t,n){YZ(r,e);var i=GZ(e,t,n);return(0,qA.isPromise)(i)?i.then(function(o){return oW(e,o)}):oW(e,i)}zn.resolveInstance=ZZ});var fW=M(mo=>{"use strict";var eee=mo&&mo.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),tee=mo&&mo.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ree=mo&&mo.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&eee(e,r,t);return tee(e,r),e},nee=mo&&mo.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},iee=mo&&mo.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(mo,"__esModule",{value:!0});mo.resolve=void 0;var oee=ree(Pi()),xE=Sa(),see=FA(),uW=rW(),JA=zS(),dW=jA(),aee=DA(),cee=lW(),$A=function(r){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return n.map(function(a){var c=$A(r);return c(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return dee(r,e,s)}},lee=function(r,e){var t=(0,dW.getFactoryDetails)(r);return(0,aee.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(r)(e)},function(){return new Error(oee.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},uee=function(r,e,t){var n,i=e.childRequests;switch((0,dW.ensureFullyBound)(t),t.type){case xE.BindingTypeEnum.ConstantValue:case xE.BindingTypeEnum.Function:n=t.cache;break;case xE.BindingTypeEnum.Constructor:n=t.implementationType;break;case xE.BindingTypeEnum.Instance:n=(0,cee.resolveInstance)(t,t.implementationType,i,$A(r));break;default:n=lee(t,e.parentContext)}return n},pee=function(r,e,t){var n=(0,uW.tryGetFromScope)(r,e);return n!==null||(n=t(),(0,uW.saveToScope)(r,e,n)),n},dee=function(r,e,t){return pee(r,t,function(){var n=uee(r,e,t);return(0,JA.isPromise)(n)?n=n.then(function(i){return pW(e,t,i)}):n=pW(e,t,n),n})};function pW(r,e,t){var n=mee(r.parentContext,e,t),i=gee(r.parentContext.container),o,s=i.next();do{o=s.value;var a=r.parentContext,c=r.serviceIdentifier,l=hee(o,c);(0,JA.isPromise)(n)?n=mW(l,a,n):n=fee(l,a,n),s=i.next()}while(s.done!==!0&&!(0,see.getBindingDictionary)(o).hasKey(r.serviceIdentifier));return n}var mee=function(r,e,t){var n;return typeof e.onActivation=="function"?n=e.onActivation(r,t):n=t,n},fee=function(r,e,t){for(var n=r.next();!n.done;){if(t=n.value(e,t),(0,JA.isPromise)(t))return mW(r,e,t);n=r.next()}return t},mW=function(r,e,t){return nee(void 0,void 0,void 0,function(){var n,i;return iee(this,function(o){switch(o.label){case 0:return[4,t];case 1:n=o.sent(),i=r.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,n)];case 3:return n=o.sent(),i=r.next(),[3,2];case 4:return[2,n]}})})},hee=function(r,e){var t=r._activations;return t.hasKey(e)?t.get(e).values():[].values()},gee=function(r){for(var e=[r],t=r.parent;t!==null;)e.push(t),t=t.parent;var n=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:n};return i};function vee(r){var e=$A(r.plan.rootRequest.requestScope);return e(r.plan.rootRequest)}mo.resolve=vee});var HA=M(Di=>{"use strict";var yee=Di&&Di.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),bee=Di&&Di.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Iee=Di&&Di.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&yee(e,r,t);return bee(e,r),e};Object.defineProperty(Di,"__esModule",{value:!0});Di.typeConstraint=Di.namedConstraint=Di.taggedConstraint=Di.traverseAncerstors=void 0;var See=Iee(Pn()),xee=xa(),hW=function(r,e){var t=r.parentRequest;return t!==null?e(t)?!0:hW(t,e):!1};Di.traverseAncerstors=hW;var gW=function(r){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(r)(e)};return t.metaData=new xee.Metadata(r,e),t}};Di.taggedConstraint=gW;var Cee=gW(See.NAMED_TAG);Di.namedConstraint=Cee;var wee=function(r){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof r=="string"){var n=t.serviceIdentifier;return n===r}else{var i=e.bindings[0].implementationType;return r===i}return!1}};Di.typeConstraint=wee});var wE=M(CE=>{"use strict";Object.defineProperty(CE,"__esModule",{value:!0});CE.BindingWhenSyntax=void 0;var $i=EE(),Kn=HA(),Eee=function(){function r(e){this._binding=e}return r.prototype.when=function(e){return this._binding.constraint=e,new $i.BindingOnSyntax(this._binding)},r.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Kn.namedConstraint)(e),new $i.BindingOnSyntax(this._binding)},r.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new $i.BindingOnSyntax(this._binding)},r.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Kn.taggedConstraint)(e)(t),new $i.BindingOnSyntax(this._binding)},r.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Kn.typeConstraint)(e)(t.parentRequest)},new $i.BindingOnSyntax(this._binding)},r.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Kn.namedConstraint)(e)(t.parentRequest)},new $i.BindingOnSyntax(this._binding)},r.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Kn.taggedConstraint)(e)(t)(n.parentRequest)},new $i.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Kn.traverseAncerstors)(t,(0,Kn.typeConstraint)(e))},new $i.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Kn.traverseAncerstors)(t,(0,Kn.typeConstraint)(e))},new $i.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Kn.traverseAncerstors)(t,(0,Kn.namedConstraint)(e))},new $i.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Kn.traverseAncerstors)(t,(0,Kn.namedConstraint)(e))},new $i.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Kn.traverseAncerstors)(n,(0,Kn.taggedConstraint)(e)(t))},new $i.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&!(0,Kn.traverseAncerstors)(n,(0,Kn.taggedConstraint)(e)(t))},new $i.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Kn.traverseAncerstors)(t,e)},new $i.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Kn.traverseAncerstors)(t,e)},new $i.BindingOnSyntax(this._binding)},r}();CE.BindingWhenSyntax=Eee});var EE=M(PE=>{"use strict";Object.defineProperty(PE,"__esModule",{value:!0});PE.BindingOnSyntax=void 0;var vW=wE(),Pee=function(){function r(e){this._binding=e}return r.prototype.onActivation=function(e){return this._binding.onActivation=e,new vW.BindingWhenSyntax(this._binding)},r.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new vW.BindingWhenSyntax(this._binding)},r}();PE.BindingOnSyntax=Pee});var GA=M(kE=>{"use strict";Object.defineProperty(kE,"__esModule",{value:!0});kE.BindingWhenOnSyntax=void 0;var kee=EE(),Dee=wE(),_ee=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new Dee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new kee.BindingOnSyntax(this._binding)}return r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();kE.BindingWhenOnSyntax=_ee});var yW=M(DE=>{"use strict";Object.defineProperty(DE,"__esModule",{value:!0});DE.BindingInSyntax=void 0;var zA=Sa(),QA=GA(),Tee=function(){function r(e){this._binding=e}return r.prototype.inRequestScope=function(){return this._binding.scope=zA.BindingScopeEnum.Request,new QA.BindingWhenOnSyntax(this._binding)},r.prototype.inSingletonScope=function(){return this._binding.scope=zA.BindingScopeEnum.Singleton,new QA.BindingWhenOnSyntax(this._binding)},r.prototype.inTransientScope=function(){return this._binding.scope=zA.BindingScopeEnum.Transient,new QA.BindingWhenOnSyntax(this._binding)},r}();DE.BindingInSyntax=Tee});var bW=M(_E=>{"use strict";Object.defineProperty(_E,"__esModule",{value:!0});_E.BindingInWhenOnSyntax=void 0;var Ree=yW(),Aee=EE(),Nee=wE(),Mee=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new Nee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Aee.BindingOnSyntax(this._binding),this._bindingInSyntax=new Ree.BindingInSyntax(e)}return r.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},r.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},r.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();_E.BindingInWhenOnSyntax=Mee});var xW=M(mc=>{"use strict";var Oee=mc&&mc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Kee=mc&&mc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Fee=mc&&mc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Oee(e,r,t);return Kee(e,r),e};Object.defineProperty(mc,"__esModule",{value:!0});mc.BindingToSyntax=void 0;var IW=Fee(Pi()),Hi=Sa(),SW=bW(),jh=GA(),Lee=function(){function r(e){this._binding=e}return r.prototype.to=function(e){return this._binding.type=Hi.BindingTypeEnum.Instance,this._binding.implementationType=e,new SW.BindingInWhenOnSyntax(this._binding)},r.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+IW.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},r.prototype.toConstantValue=function(e){return this._binding.type=Hi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Hi.BindingScopeEnum.Singleton,new jh.BindingWhenOnSyntax(this._binding)},r.prototype.toDynamicValue=function(e){return this._binding.type=Hi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new SW.BindingInWhenOnSyntax(this._binding)},r.prototype.toConstructor=function(e){return this._binding.type=Hi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Hi.BindingScopeEnum.Singleton,new jh.BindingWhenOnSyntax(this._binding)},r.prototype.toFactory=function(e){return this._binding.type=Hi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Hi.BindingScopeEnum.Singleton,new jh.BindingWhenOnSyntax(this._binding)},r.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(IW.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Hi.BindingTypeEnum.Function,this._binding.scope=Hi.BindingScopeEnum.Singleton,t},r.prototype.toAutoFactory=function(e){return this._binding.type=Hi.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=Hi.BindingScopeEnum.Singleton,new jh.BindingWhenOnSyntax(this._binding)},r.prototype.toAutoNamedFactory=function(e){return this._binding.type=Hi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new jh.BindingWhenOnSyntax(this._binding)},r.prototype.toProvider=function(e){return this._binding.type=Hi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Hi.BindingScopeEnum.Singleton,new jh.BindingWhenOnSyntax(this._binding)},r.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},r}();mc.BindingToSyntax=Lee});var CW=M(TE=>{"use strict";Object.defineProperty(TE,"__esModule",{value:!0});TE.ContainerSnapshot=void 0;var Uee=function(){function r(){}return r.of=function(e,t,n,i,o){var s=new r;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=n,s.moduleActivationStore=o,s},r}();TE.ContainerSnapshot=Uee});var wW=M(RE=>{"use strict";Object.defineProperty(RE,"__esModule",{value:!0});RE.isClonable=void 0;function jee(r){return typeof r=="object"&&r!==null&&"clone"in r&&typeof r.clone=="function"}RE.isClonable=jee});var YA=M(fc=>{"use strict";var Wee=fc&&fc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Vee=fc&&fc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Bee=fc&&fc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Wee(e,r,t);return Vee(e,r),e};Object.defineProperty(fc,"__esModule",{value:!0});fc.Lookup=void 0;var fm=Bee(Pi()),qee=wW(),Jee=function(){function r(){this._map=new Map}return r.prototype.getMap=function(){return this._map},r.prototype.add=function(e,t){if(e==null)throw new Error(fm.NULL_ARGUMENT);if(t==null)throw new Error(fm.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?n.push(t):this._map.set(e,[t])},r.prototype.get=function(e){if(e==null)throw new Error(fm.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(fm.KEY_NOT_FOUND)},r.prototype.remove=function(e){if(e==null)throw new Error(fm.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(fm.KEY_NOT_FOUND)},r.prototype.removeIntersection=function(e){var t=this;this.traverse(function(n,i){var o=e.hasKey(n)?e.get(n):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(c){return a===c})});t._setValue(n,s)}})},r.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach(function(i,o){for(var s=[],a=0,c=i;a<c.length;a++){var l=c[a],u=e(l);u?n.push(l):s.push(l)}t._setValue(o,s)}),n},r.prototype.hasKey=function(e){if(e==null)throw new Error(fm.NULL_ARGUMENT);return this._map.has(e)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){t.forEach(function(i){return e.add(n,(0,qee.isClonable)(i)?i.clone():i)})}),e},r.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},r.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},r}();fc.Lookup=Jee});var PW=M(AE=>{"use strict";Object.defineProperty(AE,"__esModule",{value:!0});AE.ModuleActivationStore=void 0;var EW=YA(),$ee=function(){function r(){this._map=new Map}return r.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},r.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},r.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){e._map.set(n,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},r.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},r.prototype._getEmptyHandlersStore=function(){var e={onActivations:new EW.Lookup,onDeactivations:new EW.Lookup};return e},r}();AE.ModuleActivationStore=$ee});var XA=M(Qn=>{"use strict";var ME=Qn&&Qn.__assign||function(){return ME=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},ME.apply(this,arguments)},Hee=Qn&&Qn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Gee=Qn&&Qn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),kW=Qn&&Qn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Hee(e,r,t);return Gee(e,r),e},Ts=Qn&&Qn.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},Rs=Qn&&Qn.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},zee=Qn&&Qn.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.Container=void 0;var Qee=D2(),Ca=kW(Pi()),Wh=Sa(),hm=kW(Pn()),Yee=kA(),NE=FA(),Xee=fW(),Zee=xW(),gm=zS(),ete=sp(),tte=Kh(),rte=CW(),YS=YA(),nte=PW(),ite=function(){function r(e){var t=e||{};if(typeof t!="object")throw new Error(""+Ca.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Wh.BindingScopeEnum.Transient;else if(t.defaultScope!==Wh.BindingScopeEnum.Singleton&&t.defaultScope!==Wh.BindingScopeEnum.Transient&&t.defaultScope!==Wh.BindingScopeEnum.Request)throw new Error(""+Ca.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+Ca.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+Ca.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,ete.id)(),this._bindingDictionary=new YS.Lookup,this._snapshots=[],this._middleware=null,this._activations=new YS.Lookup,this._deactivations=new YS.Lookup,this.parent=null,this._metadataReader=new Yee.MetadataReader,this._moduleActivationStore=new nte.ModuleActivationStore}return r.merge=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=new r,s=zee([e,t],n,!0).map(function(l){return(0,NE.getBindingDictionary)(l)}),a=(0,NE.getBindingDictionary)(o);function c(l,u){l.traverse(function(p,m){m.forEach(function(h){u.add(h.serviceIdentifier,h.clone())})})}return s.forEach(function(l){c(l,a)}),o},r.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},r.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ts(this,void 0,void 0,function(){var n,i,o,s,a;return Rs(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,o=e,c.label=1;case 1:return i<o.length?(s=o[i],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},r.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},r.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ts(this,void 0,void 0,function(){var n,i,o,s;return Rs(this,function(a){switch(a.label){case 0:n=0,i=e,a.label=1;case 1:return n<i.length?(o=i[n],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.bind=function(e){var t=this.options.defaultScope||Wh.BindingScopeEnum.Transient,n=new Qee.Binding(e,t);return this._bindingDictionary.add(e,n),new Zee.BindingToSyntax(n)},r.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},r.prototype.rebindAsync=function(e){return Ts(this,void 0,void 0,function(){return Rs(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},r.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},r.prototype.unbindAsync=function(e){return Ts(this,void 0,void 0,function(){var t;return Rs(this,function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},r.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,n){e._deactivateSingletons(n)}),this._bindingDictionary=new YS.Lookup},r.prototype.unbindAllAsync=function(){return Ts(this,void 0,void 0,function(){var e,t=this;return Rs(this,function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new YS.Lookup,[2]}})})},r.prototype.onActivation=function(e,t){this._activations.add(e,t)},r.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},r.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},r.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},r.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,hm.NAMED_TAG,t)},r.prototype.isBoundTagged=function(e,t,n){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,NE.createMockRequest)(this,e,t,n);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,n)),i},r.prototype.snapshot=function(){this._snapshots.push(rte.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},r.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(Ca.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},r.prototype.createChild=function(e){var t=new r(e||this.options);return t.parent=this,t},r.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},n)},r.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},r.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},r.prototype.getAsync=function(e){return Ts(this,void 0,void 0,function(){var t;return Rs(this,function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},r.prototype.getTagged=function(e,t,n){var i=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(i)},r.prototype.getTaggedAsync=function(e,t,n){return Ts(this,void 0,void 0,function(){var i;return Rs(this,function(o){return i=this._getNotAllArgs(e,!1,t,n),[2,this._get(i)]})})},r.prototype.getNamed=function(e,t){return this.getTagged(e,hm.NAMED_TAG,t)},r.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,hm.NAMED_TAG,t)},r.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},r.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},r.prototype.getAllTagged=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(i)},r.prototype.getAllTaggedAsync=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getAll(i)},r.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,hm.NAMED_TAG,t)},r.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,hm.NAMED_TAG,t)},r.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},r.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(hm.PRE_DESTROY,e)){var n=Reflect.getMetadata(hm.PRE_DESTROY,e);return t[n.value]()}},r.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},r.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},r.prototype._deactivate=function(e,t){var n=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,gm.isPromise)(o))return this._handleDeactivationError(o.then(function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,gm.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(Ca.ON_DEACTIVATION_ERROR(i.name,a.message))}},r.prototype._handleDeactivationError=function(e,t){return Ts(this,void 0,void 0,function(){var n;return Rs(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw n=i.sent(),new Error(Ca.ON_DEACTIVATION_ERROR(t.name,n.message));case 3:return[2]}})})},r.prototype._deactivateContainer=function(e,t){for(var n=this,i=t.next();i.value;){var o=i.value(e);if((0,gm.isPromise)(o))return o.then(function(){return n._deactivateContainerAsync(e,t)});i=t.next()}},r.prototype._deactivateContainerAsync=function(e,t){return Ts(this,void 0,void 0,function(){var n;return Rs(this,function(i){switch(i.label){case 0:n=t.next(),i.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return i.sent(),n=t.next(),[3,1];case 3:return[2]}})})},r.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,p){u._binding.moduleId=p},n=function(u){return function(p){var m=e.bind(p);return t(m,u),m}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(p){var m=e.rebind(p);return t(m,u),m}},c=function(u){return function(p,m){e._moduleActivationStore.addActivation(u,p,m),e.onActivation(p,m)}},l=function(u){return function(p,m){e._moduleActivationStore.addDeactivation(u,p,m),e.onDeactivation(p,m)}};return function(u){return{bindFunction:n(u),isboundFunction:s(),onActivationFunction:c(u),onDeactivationFunction:l(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},r.prototype._getAll=function(e){return Promise.all(this._get(e))},r.prototype._get=function(e){var t=ME(ME({},e),{contextInterceptor:function(i){return i},targetType:Wh.TargetTypeEnum.Variable});if(this._middleware){var n=this._middleware(t);if(n==null)throw new Error(Ca.INVALID_MIDDLEWARE_RETURN);return n}return this._planAndResolve()(t)},r.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,gm.isPromiseOrContainsPromise)(t))throw new Error(Ca.LAZY_IN_SYNC(e.serviceIdentifier));return t},r.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},r.prototype._getNotAllArgs=function(e,t,n,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:i};return o},r.prototype._planAndResolve=function(){var e=this;return function(t){var n=(0,NE.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var i=(0,Xee.resolve)(n);return i}},r.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,gm.isPromise)(e.cache)?e.cache.then(function(n){return t._deactivate(e,n)}):this._deactivate(e,e.cache)},r.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],o=this._deactivateIfSingleton(i);if((0,gm.isPromise)(o))throw new Error(Ca.ASYNC_UNBIND_REQUIRED)}},r.prototype._deactivateSingletonsAsync=function(e){return Ts(this,void 0,void 0,function(){var t=this;return Rs(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return n.sent(),[2]}})})},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return Ts(this,void 0,void 0,function(){return Rs(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},r.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(Ca.CANNOT_UNBIND+" "+(0,tte.getServiceIdentifierAsString)(e))}},r.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,gm.isPromise)(o))return o.then(function(){return i._preDestroy(n,t)})}return this._preDestroy(n,t)},r.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return Ts(this,void 0,void 0,function(){return Rs(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return i.sent(),[2]}})})},r}();Qn.Container=ite});var _W=M(Vh=>{"use strict";Object.defineProperty(Vh,"__esModule",{value:!0});Vh.AsyncContainerModule=Vh.ContainerModule=void 0;var DW=sp(),ote=function(){function r(e){this.id=(0,DW.id)(),this.registry=e}return r}();Vh.ContainerModule=ote;var ste=function(){function r(e){this.id=(0,DW.id)(),this.registry=e}return r}();Vh.AsyncContainerModule=ste});var TW=M(OE=>{"use strict";Object.defineProperty(OE,"__esModule",{value:!0});OE.getFirstArrayDuplicate=void 0;function ate(r){for(var e=new Set,t=0,n=r;t<n.length;t++){var i=n[t];if(e.has(i))return i;e.add(i)}}OE.getFirstArrayDuplicate=ate});var Bl=M(_i=>{"use strict";var cte=_i&&_i.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),lte=_i&&_i.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),AW=_i&&_i.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&cte(e,r,t);return lte(e,r),e};Object.defineProperty(_i,"__esModule",{value:!0});_i.createTaggedDecorator=_i.tagProperty=_i.tagParameter=_i.decorate=void 0;var KE=AW(Pi()),NW=AW(Pn()),ute=TW();function pte(r){return r.prototype!==void 0}function dte(r){if(r!==void 0)throw new Error(KE.INVALID_DECORATOR_OPERATION)}function MW(r,e,t,n){dte(e),KW(NW.TAGGED,r,t.toString(),n)}_i.tagParameter=MW;function OW(r,e,t){if(pte(r))throw new Error(KE.INVALID_DECORATOR_OPERATION);KW(NW.TAGGED_PROP,r.constructor,e,t)}_i.tagProperty=OW;function mte(r){var e=[];if(Array.isArray(r)){e=r;var t=(0,ute.getFirstArrayDuplicate)(e.map(function(n){return n.key}));if(t!==void 0)throw new Error(KE.DUPLICATED_METADATA+" "+t.toString())}else e=[r];return e}function KW(r,e,t,n){var i=mte(n),o={};Reflect.hasOwnMetadata(r,e)&&(o=Reflect.getMetadata(r,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(p){if(i.some(function(m){return m.key===p.key}))throw new Error(KE.DUPLICATED_METADATA+" "+p.key.toString())},c=0,l=s;c<l.length;c++){var u=l[c];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(r,o,e)}function fte(r){return function(e,t,n){typeof n=="number"?MW(e,t,n,r):OW(e,t,r)}}_i.createTaggedDecorator=fte;function RW(r,e){Reflect.decorate(r,e)}function hte(r,e){return function(t,n){e(t,n,r)}}function gte(r,e,t){typeof t=="number"?RW([hte(t,r)],e):typeof t=="string"?Reflect.decorate([r],e,t):RW([r],e)}_i.decorate=gte});var LW=M(hc=>{"use strict";var vte=hc&&hc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),yte=hc&&hc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),FW=hc&&hc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vte(e,r,t);return yte(e,r),e};Object.defineProperty(hc,"__esModule",{value:!0});hc.injectable=void 0;var bte=FW(Pi()),ZA=FW(Pn());function Ite(){return function(r){if(Reflect.hasOwnMetadata(ZA.PARAM_TYPES,r))throw new Error(bte.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(ZA.DESIGN_PARAM_TYPES,r)||[];return Reflect.defineMetadata(ZA.PARAM_TYPES,e,r),r}}hc.injectable=Ite});var UW=M(FE=>{"use strict";Object.defineProperty(FE,"__esModule",{value:!0});FE.tagged=void 0;var Ste=xa(),xte=Bl();function Cte(r,e){return(0,xte.createTaggedDecorator)(new Ste.Metadata(r,e))}FE.tagged=Cte});var jW=M(gc=>{"use strict";var wte=gc&&gc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ete=gc&&gc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Pte=gc&&gc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&wte(e,r,t);return Ete(e,r),e};Object.defineProperty(gc,"__esModule",{value:!0});gc.named=void 0;var kte=Pte(Pn()),Dte=xa(),_te=Bl();function Tte(r){return(0,_te.createTaggedDecorator)(new Dte.Metadata(kte.NAMED_TAG,r))}gc.named=Tte});var eN=M(LE=>{"use strict";Object.defineProperty(LE,"__esModule",{value:!0});LE.injectBase=void 0;var Rte=Pi(),Ate=xa(),Nte=Bl();function Mte(r){return function(e){return function(t,n,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,Rte.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,Nte.createTaggedDecorator)(new Ate.Metadata(r,e))(t,n,i)}}}LE.injectBase=Mte});var WW=M(vc=>{"use strict";var Ote=vc&&vc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Kte=vc&&vc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Fte=vc&&vc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Ote(e,r,t);return Kte(e,r),e};Object.defineProperty(vc,"__esModule",{value:!0});vc.inject=void 0;var Lte=Fte(Pn()),Ute=eN(),jte=(0,Ute.injectBase)(Lte.INJECT_TAG);vc.inject=jte});var VW=M(yc=>{"use strict";var Wte=yc&&yc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Vte=yc&&yc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Bte=yc&&yc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Wte(e,r,t);return Vte(e,r),e};Object.defineProperty(yc,"__esModule",{value:!0});yc.optional=void 0;var qte=Bte(Pn()),Jte=xa(),$te=Bl();function Hte(){return(0,$te.createTaggedDecorator)(new Jte.Metadata(qte.OPTIONAL_TAG,!0))}yc.optional=Hte});var BW=M(bc=>{"use strict";var Gte=bc&&bc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),zte=bc&&bc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Qte=bc&&bc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Gte(e,r,t);return zte(e,r),e};Object.defineProperty(bc,"__esModule",{value:!0});bc.unmanaged=void 0;var Yte=Qte(Pn()),Xte=xa(),Zte=Bl();function ere(){return function(r,e,t){var n=new Xte.Metadata(Yte.UNMANAGED_TAG,!0);(0,Zte.tagParameter)(r,e,t,n)}}bc.unmanaged=ere});var qW=M(Ic=>{"use strict";var tre=Ic&&Ic.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),rre=Ic&&Ic.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),nre=Ic&&Ic.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&tre(e,r,t);return rre(e,r),e};Object.defineProperty(Ic,"__esModule",{value:!0});Ic.multiInject=void 0;var ire=nre(Pn()),ore=eN(),sre=(0,ore.injectBase)(ire.MULTI_INJECT_TAG);Ic.multiInject=sre});var JW=M(Sc=>{"use strict";var are=Sc&&Sc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),cre=Sc&&Sc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),lre=Sc&&Sc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&are(e,r,t);return cre(e,r),e};Object.defineProperty(Sc,"__esModule",{value:!0});Sc.targetName=void 0;var ure=lre(Pn()),pre=xa(),dre=Bl();function mre(r){return function(e,t,n){var i=new pre.Metadata(ure.NAME_TAG,r);(0,dre.tagParameter)(e,t,n,i)}}Sc.targetName=mre});var tN=M(UE=>{"use strict";Object.defineProperty(UE,"__esModule",{value:!0});UE.propertyEventDecorator=void 0;var fre=xa();function hre(r,e){return function(){return function(t,n){var i=new fre.Metadata(r,n);if(Reflect.hasOwnMetadata(r,t.constructor))throw new Error(e);Reflect.defineMetadata(r,i,t.constructor)}}}UE.propertyEventDecorator=hre});var HW=M(xc=>{"use strict";var gre=xc&&xc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vre=xc&&xc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),$W=xc&&xc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gre(e,r,t);return vre(e,r),e};Object.defineProperty(xc,"__esModule",{value:!0});xc.postConstruct=void 0;var yre=$W(Pi()),bre=$W(Pn()),Ire=tN(),Sre=(0,Ire.propertyEventDecorator)(bre.POST_CONSTRUCT,yre.MULTIPLE_POST_CONSTRUCT_METHODS);xc.postConstruct=Sre});var zW=M(Cc=>{"use strict";var xre=Cc&&Cc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Cre=Cc&&Cc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),GW=Cc&&Cc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&xre(e,r,t);return Cre(e,r),e};Object.defineProperty(Cc,"__esModule",{value:!0});Cc.preDestroy=void 0;var wre=GW(Pi()),Ere=GW(Pn()),Pre=tN(),kre=(0,Pre.propertyEventDecorator)(Ere.PRE_DESTROY,wre.MULTIPLE_PRE_DESTROY_METHODS);Cc.preDestroy=kre});var QW=M(jE=>{"use strict";Object.defineProperty(jE,"__esModule",{value:!0});jE.interfaces=void 0;var rN;rN||(rN={});jE.interfaces=rN});var O=M(We=>{"use strict";var Dre=We&&We.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),_re=We&&We.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Tre=We&&We.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Dre(e,r,t);return _re(e,r),e};Object.defineProperty(We,"__esModule",{value:!0});We.multiBindToService=We.getServiceIdentifierAsString=We.typeConstraint=We.namedConstraint=We.taggedConstraint=We.traverseAncerstors=We.decorate=We.interfaces=We.id=We.MetadataReader=We.preDestroy=We.postConstruct=We.targetName=We.multiInject=We.unmanaged=We.optional=We.LazyServiceIdentifer=We.inject=We.named=We.tagged=We.injectable=We.createTaggedDecorator=We.ContainerModule=We.AsyncContainerModule=We.TargetTypeEnum=We.BindingTypeEnum=We.BindingScopeEnum=We.Container=We.METADATA_KEY=void 0;var Rre=Tre(Pn());We.METADATA_KEY=Rre;var Are=XA();Object.defineProperty(We,"Container",{enumerable:!0,get:function(){return Are.Container}});var nN=Sa();Object.defineProperty(We,"BindingScopeEnum",{enumerable:!0,get:function(){return nN.BindingScopeEnum}});Object.defineProperty(We,"BindingTypeEnum",{enumerable:!0,get:function(){return nN.BindingTypeEnum}});Object.defineProperty(We,"TargetTypeEnum",{enumerable:!0,get:function(){return nN.TargetTypeEnum}});var YW=_W();Object.defineProperty(We,"AsyncContainerModule",{enumerable:!0,get:function(){return YW.AsyncContainerModule}});Object.defineProperty(We,"ContainerModule",{enumerable:!0,get:function(){return YW.ContainerModule}});var Nre=Bl();Object.defineProperty(We,"createTaggedDecorator",{enumerable:!0,get:function(){return Nre.createTaggedDecorator}});var Mre=LW();Object.defineProperty(We,"injectable",{enumerable:!0,get:function(){return Mre.injectable}});var Ore=UW();Object.defineProperty(We,"tagged",{enumerable:!0,get:function(){return Ore.tagged}});var Kre=jW();Object.defineProperty(We,"named",{enumerable:!0,get:function(){return Kre.named}});var Fre=WW();Object.defineProperty(We,"inject",{enumerable:!0,get:function(){return Fre.inject}});var Lre=_A();Object.defineProperty(We,"LazyServiceIdentifer",{enumerable:!0,get:function(){return Lre.LazyServiceIdentifer}});var Ure=VW();Object.defineProperty(We,"optional",{enumerable:!0,get:function(){return Ure.optional}});var jre=BW();Object.defineProperty(We,"unmanaged",{enumerable:!0,get:function(){return jre.unmanaged}});var Wre=qW();Object.defineProperty(We,"multiInject",{enumerable:!0,get:function(){return Wre.multiInject}});var Vre=JW();Object.defineProperty(We,"targetName",{enumerable:!0,get:function(){return Vre.targetName}});var Bre=HW();Object.defineProperty(We,"postConstruct",{enumerable:!0,get:function(){return Bre.postConstruct}});var qre=zW();Object.defineProperty(We,"preDestroy",{enumerable:!0,get:function(){return qre.preDestroy}});var Jre=kA();Object.defineProperty(We,"MetadataReader",{enumerable:!0,get:function(){return Jre.MetadataReader}});var $re=sp();Object.defineProperty(We,"id",{enumerable:!0,get:function(){return $re.id}});var Hre=QW();Object.defineProperty(We,"interfaces",{enumerable:!0,get:function(){return Hre.interfaces}});var Gre=Bl();Object.defineProperty(We,"decorate",{enumerable:!0,get:function(){return Gre.decorate}});var WE=HA();Object.defineProperty(We,"traverseAncerstors",{enumerable:!0,get:function(){return WE.traverseAncerstors}});Object.defineProperty(We,"taggedConstraint",{enumerable:!0,get:function(){return WE.taggedConstraint}});Object.defineProperty(We,"namedConstraint",{enumerable:!0,get:function(){return WE.namedConstraint}});Object.defineProperty(We,"typeConstraint",{enumerable:!0,get:function(){return WE.typeConstraint}});var zre=Kh();Object.defineProperty(We,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return zre.getServiceIdentifierAsString}});var Qre=jA();Object.defineProperty(We,"multiBindToService",{enumerable:!0,get:function(){return Qre.multiBindToService}})});var iV=M(cp=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});cp.PythonExtension=cp.PVSC_EXTENSION_ID=void 0;var Xre=require("vscode");cp.PVSC_EXTENSION_ID="ms-python.python";var Zre;(function(r){async function e(){let t=Xre.extensions.getExtension(cp.PVSC_EXTENSION_ID);if(t===void 0)throw new Error("Python extension is not installed or is disabled");return t.isActive||await t.activate(),t.exports}r.api=e})(Zre=cp.PythonExtension||(cp.PythonExtension={}))});var sV=M(ox=>{ox.get=function(r){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},n=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,r||ox.get);var i=t.stack;return Error.prepareStackTrace=n,Error.stackTraceLimit=e,i};ox.parse=function(r){if(!r.stack)return[];var e=this,t=r.stack.split(`
`).slice(1);return t.map(function(n){if(n.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:n,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=n.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,c=null,l=null,u=i[5]==="native";if(i[1]){a=i[1];var p=a.lastIndexOf(".");if(a[p-1]=="."&&p--,p>0){o=a.substr(0,p),s=a.substr(p+1);var m=o.indexOf(".Module");m>0&&(a=a.substr(m+1),o=o.substr(0,m))}c=null}s&&(c=o,l=s),s==="<anonymous>"&&(l=null,a=null);var h={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:c,methodName:l,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(h)}}).filter(function(n){return!!n})};function ix(r){for(var e in r)this[e]=r[e]}var nne=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],ine=["topLevel","eval","native","constructor"];nne.forEach(function(r){ix.prototype[r]=null,ix.prototype["get"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});ine.forEach(function(r){ix.prototype[r]=!1,ix.prototype["is"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});ox._createParsedCallSite=function(r){return new ix(r)}});var ig=M((_t,MV)=>{_t=MV.exports=zt;var Er;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Er=function(){var r=Array.prototype.slice.call(arguments,0);r.unshift("SEMVER"),console.log.apply(console,r)}:Er=function(){};_t.SEMVER_SPEC_VERSION="2.0.0";var cx=256,XE=Number.MAX_SAFE_INTEGER||9007199254740991,gN=16,mse=cx-6,lx=_t.re=[],Wr=_t.safeRe=[],he=_t.src=[],Jt=0,SN="[a-zA-Z0-9-]",vN=[["\\s",1],["\\d",cx],[SN,mse]];function iP(r){for(var e=0;e<vN.length;e++){var t=vN[e][0],n=vN[e][1];r=r.split(t+"*").join(t+"{0,"+n+"}").split(t+"+").join(t+"{1,"+n+"}")}return r}var Yh=Jt++;he[Yh]="0|[1-9]\\d*";var Xh=Jt++;he[Xh]="\\d+";var xN=Jt++;he[xN]="\\d*[a-zA-Z-]"+SN+"*";var IV=Jt++;he[IV]="("+he[Yh]+")\\.("+he[Yh]+")\\.("+he[Yh]+")";var SV=Jt++;he[SV]="("+he[Xh]+")\\.("+he[Xh]+")\\.("+he[Xh]+")";var yN=Jt++;he[yN]="(?:"+he[Yh]+"|"+he[xN]+")";var bN=Jt++;he[bN]="(?:"+he[Xh]+"|"+he[xN]+")";var CN=Jt++;he[CN]="(?:-("+he[yN]+"(?:\\."+he[yN]+")*))";var wN=Jt++;he[wN]="(?:-?("+he[bN]+"(?:\\."+he[bN]+")*))";var IN=Jt++;he[IN]=SN+"+";var px=Jt++;he[px]="(?:\\+("+he[IN]+"(?:\\."+he[IN]+")*))";var EN=Jt++,xV="v?"+he[IV]+he[CN]+"?"+he[px]+"?";he[EN]="^"+xV+"$";var PN="[v=\\s]*"+he[SV]+he[wN]+"?"+he[px]+"?",kN=Jt++;he[kN]="^"+PN+"$";var ng=Jt++;he[ng]="((?:<|>)?=?)";var ZE=Jt++;he[ZE]=he[Xh]+"|x|X|\\*";var eP=Jt++;he[eP]=he[Yh]+"|x|X|\\*";var bm=Jt++;he[bm]="[v=\\s]*("+he[eP]+")(?:\\.("+he[eP]+")(?:\\.("+he[eP]+")(?:"+he[CN]+")?"+he[px]+"?)?)?";var eg=Jt++;he[eg]="[v=\\s]*("+he[ZE]+")(?:\\.("+he[ZE]+")(?:\\.("+he[ZE]+")(?:"+he[wN]+")?"+he[px]+"?)?)?";var CV=Jt++;he[CV]="^"+he[ng]+"\\s*"+he[bm]+"$";var wV=Jt++;he[wV]="^"+he[ng]+"\\s*"+he[eg]+"$";var EV=Jt++;he[EV]="(?:^|[^\\d])(\\d{1,"+gN+"})(?:\\.(\\d{1,"+gN+"}))?(?:\\.(\\d{1,"+gN+"}))?(?:$|[^\\d])";var oP=Jt++;he[oP]="(?:~>?)";var tg=Jt++;he[tg]="(\\s*)"+he[oP]+"\\s+";lx[tg]=new RegExp(he[tg],"g");Wr[tg]=new RegExp(iP(he[tg]),"g");var fse="$1~",PV=Jt++;he[PV]="^"+he[oP]+he[bm]+"$";var kV=Jt++;he[kV]="^"+he[oP]+he[eg]+"$";var sP=Jt++;he[sP]="(?:\\^)";var rg=Jt++;he[rg]="(\\s*)"+he[sP]+"\\s+";lx[rg]=new RegExp(he[rg],"g");Wr[rg]=new RegExp(iP(he[rg]),"g");var hse="$1^",DV=Jt++;he[DV]="^"+he[sP]+he[bm]+"$";var _V=Jt++;he[_V]="^"+he[sP]+he[eg]+"$";var DN=Jt++;he[DN]="^"+he[ng]+"\\s*("+PN+")$|^$";var _N=Jt++;he[_N]="^"+he[ng]+"\\s*("+xV+")$|^$";var Im=Jt++;he[Im]="(\\s*)"+he[ng]+"\\s*("+PN+"|"+he[bm]+")";lx[Im]=new RegExp(he[Im],"g");Wr[Im]=new RegExp(iP(he[Im]),"g");var gse="$1$2$3",TV=Jt++;he[TV]="^\\s*("+he[bm]+")\\s+-\\s+("+he[bm]+")\\s*$";var RV=Jt++;he[RV]="^\\s*("+he[eg]+")\\s+-\\s+("+he[eg]+")\\s*$";var AV=Jt++;he[AV]="(<|>)?=?\\s*\\*";for(kc=0;kc<Jt;kc++)Er(kc,he[kc]),lx[kc]||(lx[kc]=new RegExp(he[kc]),Wr[kc]=new RegExp(iP(he[kc])));var kc;_t.parse=Sm;function Sm(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof zt)return r;if(typeof r!="string"||r.length>cx)return null;var t=e.loose?Wr[kN]:Wr[EN];if(!t.test(r))return null;try{return new zt(r,e)}catch{return null}}_t.valid=vse;function vse(r,e){var t=Sm(r,e);return t?t.version:null}_t.clean=yse;function yse(r,e){var t=Sm(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null}_t.SemVer=zt;function zt(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof zt){if(r.loose===e.loose)return r;r=r.version}else if(typeof r!="string")throw new TypeError("Invalid Version: "+r);if(r.length>cx)throw new TypeError("version is longer than "+cx+" characters");if(!(this instanceof zt))return new zt(r,e);Er("SemVer",r,e),this.options=e,this.loose=!!e.loose;var t=r.trim().match(e.loose?Wr[kN]:Wr[EN]);if(!t)throw new TypeError("Invalid Version: "+r);if(this.raw=r,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>XE||this.major<0)throw new TypeError("Invalid major version");if(this.minor>XE||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>XE||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<XE)return i}return n}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}zt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};zt.prototype.toString=function(){return this.version};zt.prototype.compare=function(r){return Er("SemVer.compare",this.version,this.options,r),r instanceof zt||(r=new zt(r,this.options)),this.compareMain(r)||this.comparePre(r)};zt.prototype.compareMain=function(r){return r instanceof zt||(r=new zt(r,this.options)),Zh(this.major,r.major)||Zh(this.minor,r.minor)||Zh(this.patch,r.patch)};zt.prototype.comparePre=function(r){if(r instanceof zt||(r=new zt(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],n=r.prerelease[e];if(Er("prerelease compare",e,t,n),t===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(t===void 0)return-1;if(t===n)continue;return Zh(t,n)}while(++e)};zt.prototype.inc=function(r,e){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+r)}return this.format(),this.raw=this.version,this};_t.inc=bse;function bse(r,e,t,n){typeof t=="string"&&(n=t,t=void 0);try{return new zt(r,t).inc(e,n).version}catch{return null}}_t.diff=Ise;function Ise(r,e){if(TN(r,e))return null;var t=Sm(r),n=Sm(e),i="";if(t.prerelease.length||n.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==n[s])return i+s;return o}_t.compareIdentifiers=Zh;var bV=/^[0-9]+$/;function Zh(r,e){var t=bV.test(r),n=bV.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1}_t.rcompareIdentifiers=Sse;function Sse(r,e){return Zh(e,r)}_t.major=xse;function xse(r,e){return new zt(r,e).major}_t.minor=Cse;function Cse(r,e){return new zt(r,e).minor}_t.patch=wse;function wse(r,e){return new zt(r,e).patch}_t.compare=ql;function ql(r,e,t){return new zt(r,t).compare(new zt(e,t))}_t.compareLoose=Ese;function Ese(r,e){return ql(r,e,!0)}_t.rcompare=Pse;function Pse(r,e,t){return ql(e,r,t)}_t.sort=kse;function kse(r,e){return r.sort(function(t,n){return _t.compare(t,n,e)})}_t.rsort=Dse;function Dse(r,e){return r.sort(function(t,n){return _t.rcompare(t,n,e)})}_t.gt=ux;function ux(r,e,t){return ql(r,e,t)>0}_t.lt=tP;function tP(r,e,t){return ql(r,e,t)<0}_t.eq=TN;function TN(r,e,t){return ql(r,e,t)===0}_t.neq=NV;function NV(r,e,t){return ql(r,e,t)!==0}_t.gte=RN;function RN(r,e,t){return ql(r,e,t)>=0}_t.lte=AN;function AN(r,e,t){return ql(r,e,t)<=0}_t.cmp=rP;function rP(r,e,t,n){switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return TN(r,t,n);case"!=":return NV(r,t,n);case">":return ux(r,t,n);case">=":return RN(r,t,n);case"<":return tP(r,t,n);case"<=":return AN(r,t,n);default:throw new TypeError("Invalid operator: "+e)}}_t.Comparator=Ns;function Ns(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Ns){if(r.loose===!!e.loose)return r;r=r.value}if(!(this instanceof Ns))return new Ns(r,e);r=r.trim().split(/\s+/).join(" "),Er("comparator",r,e),this.options=e,this.loose=!!e.loose,this.parse(r),this.semver===dx?this.value="":this.value=this.operator+this.semver.version,Er("comp",this)}var dx={};Ns.prototype.parse=function(r){var e=this.options.loose?Wr[DN]:Wr[_N],t=r.match(e);if(!t)throw new TypeError("Invalid comparator: "+r);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new zt(t[2],this.options.loose):this.semver=dx};Ns.prototype.toString=function(){return this.value};Ns.prototype.test=function(r){return Er("Comparator.test",r,this.options.loose),this.semver===dx?!0:(typeof r=="string"&&(r=new zt(r,this.options)),rP(r,this.operator,this.semver,this.options))};Ns.prototype.intersects=function(r,e){if(!(r instanceof Ns))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new un(r.value,e),nP(this.value,t,e);if(r.operator==="")return t=new un(this.value,e),nP(r.semver,t,e);var n=(this.operator===">="||this.operator===">")&&(r.operator===">="||r.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(r.operator==="<="||r.operator==="<"),o=this.semver.version===r.semver.version,s=(this.operator===">="||this.operator==="<=")&&(r.operator===">="||r.operator==="<="),a=rP(this.semver,"<",r.semver,e)&&(this.operator===">="||this.operator===">")&&(r.operator==="<="||r.operator==="<"),c=rP(this.semver,">",r.semver,e)&&(this.operator==="<="||this.operator==="<")&&(r.operator===">="||r.operator===">");return n||i||o&&s||a||c};_t.Range=un;function un(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof un)return r.loose===!!e.loose&&r.includePrerelease===!!e.includePrerelease?r:new un(r.raw,e);if(r instanceof Ns)return new un(r.value,e);if(!(this instanceof un))return new un(r,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=r.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}un.prototype.format=function(){return this.range=this.set.map(function(r){return r.join(" ").trim()}).join("||").trim(),this.range};un.prototype.toString=function(){return this.range};un.prototype.parseRange=function(r){var e=this.options.loose,t=e?Wr[RV]:Wr[TV];r=r.replace(t,Lse),Er("hyphen replace",r),r=r.replace(Wr[Im],gse),Er("comparator trim",r,Wr[Im]),r=r.replace(Wr[tg],fse),r=r.replace(Wr[rg],hse);var n=e?Wr[DN]:Wr[_N],i=r.split(" ").map(function(o){return Tse(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(n)})),i=i.map(function(o){return new Ns(o,this.options)},this),i};un.prototype.intersects=function(r,e){if(!(r instanceof un))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(n){return r.set.some(function(i){return i.every(function(o){return n.intersects(o,e)})})})})};_t.toComparators=_se;function _se(r,e){return new un(r,e).set.map(function(t){return t.map(function(n){return n.value}).join(" ").trim().split(" ")})}function Tse(r,e){return Er("comp",r,e),r=Nse(r,e),Er("caret",r),r=Rse(r,e),Er("tildes",r),r=Ose(r,e),Er("xrange",r),r=Fse(r,e),Er("stars",r),r}function Qi(r){return!r||r.toLowerCase()==="x"||r==="*"}function Rse(r,e){return r.trim().split(/\s+/).map(function(t){return Ase(t,e)}).join(" ")}function Ase(r,e){var t=e.loose?Wr[kV]:Wr[PV];return r.replace(t,function(n,i,o,s,a){Er("tilde",r,n,i,o,s,a);var c;return Qi(i)?c="":Qi(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":Qi(s)?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(Er("replaceTilde pr",a),c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",Er("tilde return",c),c})}function Nse(r,e){return r.trim().split(/\s+/).map(function(t){return Mse(t,e)}).join(" ")}function Mse(r,e){Er("caret",r,e);var t=e.loose?Wr[_V]:Wr[DV];return r.replace(t,function(n,i,o,s,a){Er("caret",r,n,i,o,s,a);var c;return Qi(i)?c="":Qi(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":Qi(s)?i==="0"?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(Er("replaceCaret pr",a),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(Er("no pr"),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),Er("caret return",c),c})}function Ose(r,e){return Er("replaceXRanges",r,e),r.split(/\s+/).map(function(t){return Kse(t,e)}).join(" ")}function Kse(r,e){r=r.trim();var t=e.loose?Wr[wV]:Wr[CV];return r.replace(t,function(n,i,o,s,a,c){Er("xRange",r,n,i,o,s,a,c);var l=Qi(o),u=l||Qi(s),p=u||Qi(a),m=p;return i==="="&&m&&(i=""),l?i===">"||i==="<"?n="<0.0.0":n="*":i&&m?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),n=i+o+"."+s+"."+a):u?n=">="+o+".0.0 <"+(+o+1)+".0.0":p&&(n=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),Er("xRange return",n),n})}function Fse(r,e){return Er("replaceStars",r,e),r.trim().replace(Wr[AV],"")}function Lse(r,e,t,n,i,o,s,a,c,l,u,p,m){return Qi(t)?e="":Qi(n)?e=">="+t+".0.0":Qi(i)?e=">="+t+"."+n+".0":e=">="+e,Qi(c)?a="":Qi(l)?a="<"+(+c+1)+".0.0":Qi(u)?a="<"+c+"."+(+l+1)+".0":p?a="<="+c+"."+l+"."+u+"-"+p:a="<="+a,(e+" "+a).trim()}un.prototype.test=function(r){if(!r)return!1;typeof r=="string"&&(r=new zt(r,this.options));for(var e=0;e<this.set.length;e++)if(Use(this.set[e],r,this.options))return!0;return!1};function Use(r,e,t){for(var n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(n=0;n<r.length;n++)if(Er(r[n].semver),r[n].semver!==dx&&r[n].semver.prerelease.length>0){var i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}_t.satisfies=nP;function nP(r,e,t){try{e=new un(e,t)}catch{return!1}return e.test(r)}_t.maxSatisfying=jse;function jse(r,e,t){var n=null,i=null;try{var o=new un(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new zt(n,t))}),n}_t.minSatisfying=Wse;function Wse(r,e,t){var n=null,i=null;try{var o=new un(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new zt(n,t))}),n}_t.minVersion=Vse;function Vse(r,e){r=new un(r,e);var t=new zt("0.0.0");if(r.test(t)||(t=new zt("0.0.0-0"),r.test(t)))return t;t=null;for(var n=0;n<r.set.length;++n){var i=r.set[n];i.forEach(function(o){var s=new zt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||ux(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&r.test(t)?t:null}_t.validRange=Bse;function Bse(r,e){try{return new un(r,e).range||"*"}catch{return null}}_t.ltr=qse;function qse(r,e,t){return NN(r,e,"<",t)}_t.gtr=Jse;function Jse(r,e,t){return NN(r,e,">",t)}_t.outside=NN;function NN(r,e,t,n){r=new zt(r,n),e=new un(e,n);var i,o,s,a,c;switch(t){case">":i=ux,o=AN,s=tP,a=">",c=">=";break;case"<":i=tP,o=RN,s=ux,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(nP(r,e,n))return!1;for(var l=0;l<e.set.length;++l){var u=e.set[l],p=null,m=null;if(u.forEach(function(h){h.semver===dx&&(h=new Ns(">=0.0.0")),p=p||h,m=m||h,i(h.semver,p.semver,n)?p=h:s(h.semver,m.semver,n)&&(m=h)}),p.operator===a||p.operator===c||(!m.operator||m.operator===a)&&o(r,m.semver))return!1;if(m.operator===c&&s(r,m.semver))return!1}return!0}_t.prerelease=$se;function $se(r,e){var t=Sm(r,e);return t&&t.prerelease.length?t.prerelease:null}_t.intersects=Hse;function Hse(r,e,t){return r=new un(r,t),e=new un(e,t),r.intersects(e)}_t.coerce=Gse;function Gse(r){if(r instanceof zt)return r;if(typeof r!="string")return null;var e=r.match(Wr[EV]);return e==null?null:Sm(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var jV=M((NEe,UV)=>{"use strict";UV.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var BV=M(MN=>{"use strict";var Qse=Object.prototype.hasOwnProperty,Yse;function WV(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return null}}function VV(r){try{return encodeURIComponent(r)}catch{return null}}function Xse(r){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},n;n=e.exec(r);){var i=WV(n[1]),o=WV(n[2]);i===null||o===null||i in t||(t[i]=o)}return t}function Zse(r,e){e=e||"";var t=[],n,i;typeof e!="string"&&(e="?");for(i in r)if(Qse.call(r,i)){if(n=r[i],!n&&(n===null||n===Yse||isNaN(n))&&(n=""),i=VV(i),n=VV(n),i===null||n===null)continue;t.push(i+"="+n)}return t.length?e+t.join("&"):""}MN.stringify=Zse;MN.parse=Xse});var YV=M((OEe,QV)=>{"use strict";var JV=jV(),fP=BV(),eae=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,$V=/[\n\r\t]/g,tae=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,HV=/:\d+$/,rae=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,nae=/^[a-zA-Z]:/;function KN(r){return(r||"").toString().replace(eae,"")}var ON=[["#","hash"],["?","query"],function(e,t){return Dc(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],qV={hash:1,query:1};function GV(r){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};r=r||t;var n={},i=typeof r,o;if(r.protocol==="blob:")n=new _c(unescape(r.pathname),{});else if(i==="string"){n=new _c(r,{});for(o in qV)delete n[o]}else if(i==="object"){for(o in r)o in qV||(n[o]=r[o]);n.slashes===void 0&&(n.slashes=tae.test(r.href))}return n}function Dc(r){return r==="file:"||r==="ftp:"||r==="http:"||r==="https:"||r==="ws:"||r==="wss:"}function zV(r,e){r=KN(r),r=r.replace($V,""),e=e||{};var t=rae.exec(r),n=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],n==="file:"?s>=2&&(a=a.slice(2)):Dc(n)?a=t[4]:n?i&&(a=a.slice(2)):s>=2&&Dc(e.protocol)&&(a=t[4]),{protocol:n,slashes:i||Dc(n),slashesCount:s,rest:a}}function iae(r,e){if(r==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(r.split("/")),n=t.length,i=t[n-1],o=!1,s=0;n--;)t[n]==="."?t.splice(n,1):t[n]===".."?(t.splice(n,1),s++):s&&(n===0&&(o=!0),t.splice(n,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function _c(r,e,t){if(r=KN(r),r=r.replace($V,""),!(this instanceof _c))return new _c(r,e,t);var n,i,o,s,a,c,l=ON.slice(),u=typeof e,p=this,m=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=fP.parse),e=GV(e),i=zV(r||"",e),n=!i.protocol&&!i.slashes,p.slashes=i.slashes||n&&e.slashes,p.protocol=i.protocol||e.protocol||"",r=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||nae.test(r))||!i.slashes&&(i.protocol||i.slashesCount<2||!Dc(p.protocol)))&&(l[3]=[/(.*)/,"pathname"]);m<l.length;m++){if(s=l[m],typeof s=="function"){r=s(r,p);continue}o=s[0],c=s[1],o!==o?p[c]=r:typeof o=="string"?(a=o==="@"?r.lastIndexOf(o):r.indexOf(o),~a&&(typeof s[2]=="number"?(p[c]=r.slice(0,a),r=r.slice(a+s[2])):(p[c]=r.slice(a),r=r.slice(0,a)))):(a=o.exec(r))&&(p[c]=a[1],r=r.slice(0,a.index)),p[c]=p[c]||n&&s[3]&&e[c]||"",s[4]&&(p[c]=p[c].toLowerCase())}t&&(p.query=t(p.query)),n&&e.slashes&&p.pathname.charAt(0)!=="/"&&(p.pathname!==""||e.pathname!=="")&&(p.pathname=iae(p.pathname,e.pathname)),p.pathname.charAt(0)!=="/"&&Dc(p.protocol)&&(p.pathname="/"+p.pathname),JV(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(a=p.auth.indexOf(":"),~a?(p.username=p.auth.slice(0,a),p.username=encodeURIComponent(decodeURIComponent(p.username)),p.password=p.auth.slice(a+1),p.password=encodeURIComponent(decodeURIComponent(p.password))):p.username=encodeURIComponent(decodeURIComponent(p.auth)),p.auth=p.password?p.username+":"+p.password:p.username),p.origin=p.protocol!=="file:"&&Dc(p.protocol)&&p.host?p.protocol+"//"+p.host:"null",p.href=p.toString()}function oae(r,e,t){var n=this;switch(r){case"query":typeof e=="string"&&e.length&&(e=(t||fP.parse)(e)),n[r]=e;break;case"port":n[r]=e,JV(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[r]="");break;case"hostname":n[r]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[r]=e,HV.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!t;break;case"pathname":case"hash":if(e){var i=r==="pathname"?"/":"#";n[r]=e.charAt(0)!==i?i+e:e}else n[r]=e;break;case"username":case"password":n[r]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(n.username=e.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<ON.length;s++){var a=ON[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&Dc(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function sae(r){(!r||typeof r!="function")&&(r=fP.stringify);var e,t=this,n=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||Dc(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&Dc(t.protocol)&&!n&&t.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||HV.test(t.hostname)&&!t.port)&&(n+=":"),o+=n+t.pathname,e=typeof t.query=="object"?r(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}_c.prototype={set:oae,toString:sae};_c.extractProtocol=zV;_c.location=GV;_c.trimLeft=KN;_c.qs=fP;QV.exports=_c});var FN=M((FEe,e9)=>{"use strict";var XV=Array.isArray,ZV=Object.keys,aae=Object.prototype.hasOwnProperty;e9.exports=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=XV(e),i=XV(t),o,s,a;if(n&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!r(e[o],t[o]))return!1;return!0}if(n!=i)return!1;var c=e instanceof Date,l=t instanceof Date;if(c!=l)return!1;if(c&&l)return e.getTime()==t.getTime();var u=e instanceof RegExp,p=t instanceof RegExp;if(u!=p)return!1;if(u&&p)return e.toString()==t.toString();var m=ZV(e);if(s=m.length,s!==ZV(t).length)return!1;for(o=s;o--!==0;)if(!aae.call(t,m[o]))return!1;for(o=s;o--!==0;)if(a=m[o],!r(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var I9=M(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.EventEmitter=Rc.once=Rc.toPromise=void 0;function Dae(r,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let n=(0,Rc.once)(r,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{n.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,Rc.once)(r,t))}Rc.toPromise=Dae;var _ae=(r,e)=>{let t=r(n=>{e(n),t.dispose()});return t};Rc.once=_ae;var JN=class{constructor(){this.event=(e,t,n)=>{let i=this.add(t?e.bind(t):e);return n?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Rc.EventEmitter=JN});var iM=M(Dp=>{"use strict";Object.defineProperty(Dp,"__esModule",{value:!0});Dp.TargetPopulation=Dp.Filters=Dp.VSCodeFilterProvider=void 0;var XP=require("vscode"),nM=class r{constructor(e,t,n){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=n}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Vc.ApplicationVersion:return r.trimVersionSuffix(XP.version);case Vc.Build:return XP.env.appName;case Vc.ClientId:return XP.env.machineId;case Vc.ExtensionName:return this.extensionName;case Vc.ExtensionVersion:return r.trimVersionSuffix(this.extensionVersion);case Vc.Language:return XP.env.language;case Vc.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Vc);for(let n of t)e.set(n,this.getFilterValue(n));return e}};Dp.VSCodeFilterProvider=nM;var Vc;(function(r){r.Market="X-MSEdge-Market",r.CorpNet="X-FD-Corpnet",r.ApplicationVersion="X-VSCode-AppVersion",r.Build="X-VSCode-Build",r.ClientId="X-MSEdge-ClientId",r.ExtensionName="X-VSCode-ExtensionName",r.ExtensionVersion="X-VSCode-ExtensionVersion",r.Language="X-VSCode-Language",r.TargetPopulation="X-VSCode-TargetPopulation"})(Vc||(Dp.Filters=Vc={}));var c3;(function(r){r.Team="team",r.Internal="internal",r.Insiders="insider",r.Public="public"})(c3||(Dp.TargetPopulation=c3={}))});var l3=M(ZP=>{"use strict";Object.defineProperty(ZP,"__esModule",{value:!0});ZP.BaseFeatureProvider=void 0;var oM=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};ZP.BaseFeatureProvider=oM});var u3=M(ek=>{"use strict";Object.defineProperty(ek,"__esModule",{value:!0});ek.FilteredFeatureProvider=void 0;var jae=l3(),sM=class extends jae.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let n=t.getFilters();for(let i of n.keys()){let o=n.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};ek.FilteredFeatureProvider=sM});var p3=M(_p=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});_p.TasApiFeatureProvider=_p.TASAPI_FETCHERROR_EVENTNAME=void 0;var Wae=u3();_p.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var aM="ErrorType",cM=class extends Wae.FilteredFeatureProvider{constructor(e,t,n){super(t,n),this.httpClient=e,this.telemetry=t,this.filterProviders=n}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let c=e.get(a);t[a]=c}let n;try{n=await this.httpClient.get({headers:t})}catch(a){let c=a,l=new Map;c.response?l.set(aM,"ServerError"):c.request?l.set(aM,"NoResponse"):l.set(aM,"GenericError"),this.telemetry.postEvent(_p.TASAPI_FETCHERROR_EVENTNAME,l)}if(!n)throw Error(_p.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=n.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let c of Object.keys(a.Parameters)){let l=c+(a.Parameters[c]?"":"cf");s.includes(l)||s.push(l)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};_p.TasApiFeatureProvider=cM});var f3=M((k0e,m3)=>{var d3=require("stream").Stream,Vae=require("util");m3.exports=_a;function _a(){this.source=null,this.dataSize=0,this.maxDataSize=1024*1024,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}Vae.inherits(_a,d3);_a.create=function(r,e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];t.source=r;var i=r.emit;return r.emit=function(){return t._handleEmit(arguments),i.apply(r,arguments)},r.on("error",function(){}),t.pauseStream&&r.pause(),t};Object.defineProperty(_a.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});_a.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};_a.prototype.resume=function(){this._released||this.release(),this.source.resume()};_a.prototype.pause=function(){this.source.pause()};_a.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(r){this.emit.apply(this,r)}.bind(this)),this._bufferedEvents=[]};_a.prototype.pipe=function(){var r=d3.prototype.pipe.apply(this,arguments);return this.resume(),r};_a.prototype._handleEmit=function(r){if(this._released){this.emit.apply(this,r);return}r[0]==="data"&&(this.dataSize+=r[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(r)};_a.prototype._checkIfMaxDataSizeExceeded=function(){if(!this._maxDataSizeExceeded&&!(this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(r))}}});var y3=M((D0e,v3)=>{var Bae=require("util"),g3=require("stream").Stream,h3=f3();v3.exports=Sn;function Sn(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}Bae.inherits(Sn,g3);Sn.create=function(r){var e=new this;r=r||{};for(var t in r)e[t]=r[t];return e};Sn.isStreamLike=function(r){return typeof r!="function"&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"&&!Buffer.isBuffer(r)};Sn.prototype.append=function(r){var e=Sn.isStreamLike(r);if(e){if(!(r instanceof h3)){var t=h3.create(r,{maxDataSize:1/0,pauseStream:this.pauseStreams});r.on("data",this._checkDataSize.bind(this)),r=t}this._handleErrors(r),this.pauseStreams&&r.pause()}return this._streams.push(r),this};Sn.prototype.pipe=function(r,e){return g3.prototype.pipe.call(this,r,e),this.resume(),r};Sn.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};Sn.prototype._realGetNext=function(){var r=this._streams.shift();if(typeof r>"u"){this.end();return}if(typeof r!="function"){this._pipeNext(r);return}var e=r;e(function(t){var n=Sn.isStreamLike(t);n&&(t.on("data",this._checkDataSize.bind(this)),this._handleErrors(t)),this._pipeNext(t)}.bind(this))};Sn.prototype._pipeNext=function(r){this._currentStream=r;var e=Sn.isStreamLike(r);if(e){r.on("end",this._getNext.bind(this)),r.pipe(this,{end:!1});return}var t=r;this.write(t),this._getNext()};Sn.prototype._handleErrors=function(r){var e=this;r.on("error",function(t){e._emitError(t)})};Sn.prototype.write=function(r){this.emit("data",r)};Sn.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};Sn.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};Sn.prototype.end=function(){this._reset(),this.emit("end")};Sn.prototype.destroy=function(){this._reset(),this.emit("close")};Sn.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};Sn.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(r))}};Sn.prototype._updateDataSize=function(){this.dataSize=0;var r=this;this._streams.forEach(function(e){e.dataSize&&(r.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};Sn.prototype._emitError=function(r){this._reset(),this.emit("error",r)}});var b3=M((_0e,qae)=>{qae.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var S3=M((T0e,I3)=>{I3.exports=b3()});var w3=M(xo=>{"use strict";var tk=S3(),Jae=require("path").extname,x3=/^\s*([^;\s]*)(?:;|\s|$)/,$ae=/^text\//i;xo.charset=C3;xo.charsets={lookup:C3};xo.contentType=Hae;xo.extension=Gae;xo.extensions=Object.create(null);xo.lookup=zae;xo.types=Object.create(null);Qae(xo.extensions,xo.types);function C3(r){if(!r||typeof r!="string")return!1;var e=x3.exec(r),t=e&&tk[e[1].toLowerCase()];return t&&t.charset?t.charset:e&&$ae.test(e[1])?"UTF-8":!1}function Hae(r){if(!r||typeof r!="string")return!1;var e=r.indexOf("/")===-1?xo.lookup(r):r;if(!e)return!1;if(e.indexOf("charset")===-1){var t=xo.charset(e);t&&(e+="; charset="+t.toLowerCase())}return e}function Gae(r){if(!r||typeof r!="string")return!1;var e=x3.exec(r),t=e&&xo.extensions[e[1].toLowerCase()];return!t||!t.length?!1:t[0]}function zae(r){if(!r||typeof r!="string")return!1;var e=Jae("x."+r).toLowerCase().substr(1);return e&&xo.types[e]||!1}function Qae(r,e){var t=["nginx","apache",void 0,"iana"];Object.keys(tk).forEach(function(i){var o=tk[i],s=o.extensions;if(!(!s||!s.length)){r[i]=s;for(var a=0;a<s.length;a++){var c=s[a];if(e[c]){var l=t.indexOf(tk[e[c]].source),u=t.indexOf(o.source);if(e[c]!=="application/octet-stream"&&(l>u||l===u&&e[c].substr(0,12)==="application/"))continue}e[c]=i}}})}});var P3=M((A0e,E3)=>{E3.exports=Yae;function Yae(r){var e=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;e?e(r):setTimeout(r,0)}});var lM=M((N0e,D3)=>{var k3=P3();D3.exports=Xae;function Xae(r){var e=!1;return k3(function(){e=!0}),function(n,i){e?r(n,i):k3(function(){r(n,i)})}}});var uM=M((M0e,_3)=>{_3.exports=Zae;function Zae(r){Object.keys(r.jobs).forEach(ece.bind(r)),r.jobs={}}function ece(r){typeof this.jobs[r]=="function"&&this.jobs[r]()}});var pM=M((O0e,R3)=>{var T3=lM(),tce=uM();R3.exports=rce;function rce(r,e,t,n){var i=t.keyedList?t.keyedList[t.index]:t.index;t.jobs[i]=nce(e,i,r[i],function(o,s){i in t.jobs&&(delete t.jobs[i],o?tce(t):t.results[i]=s,n(o,t.results))})}function nce(r,e,t,n){var i;return r.length==2?i=r(t,T3(n)):i=r(t,e,T3(n)),i}});var dM=M((K0e,A3)=>{A3.exports=ice;function ice(r,e){var t=!Array.isArray(r),n={index:0,keyedList:t||e?Object.keys(r):null,jobs:{},results:t?{}:[],size:t?Object.keys(r).length:r.length};return e&&n.keyedList.sort(t?e:function(i,o){return e(r[i],r[o])}),n}});var mM=M((F0e,N3)=>{var oce=uM(),sce=lM();N3.exports=ace;function ace(r){Object.keys(this.jobs).length&&(this.index=this.size,oce(this),sce(r)(null,this.results))}});var O3=M((L0e,M3)=>{var cce=pM(),lce=dM(),uce=mM();M3.exports=pce;function pce(r,e,t){for(var n=lce(r);n.index<(n.keyedList||r).length;)cce(r,e,n,function(i,o){if(i){t(i,o);return}if(Object.keys(n.jobs).length===0){t(null,n.results);return}}),n.index++;return uce.bind(n,t)}});var fM=M((U0e,rk)=>{var K3=pM(),dce=dM(),mce=mM();rk.exports=fce;rk.exports.ascending=F3;rk.exports.descending=hce;function fce(r,e,t,n){var i=dce(r,t);return K3(r,e,i,function o(s,a){if(s){n(s,a);return}if(i.index++,i.index<(i.keyedList||r).length){K3(r,e,i,o);return}n(null,i.results)}),mce.bind(i,n)}function F3(r,e){return r<e?-1:r>e?1:0}function hce(r,e){return-1*F3(r,e)}});var U3=M((j0e,L3)=>{var gce=fM();L3.exports=vce;function vce(r,e,t){return gce(r,e,null,t)}});var W3=M((W0e,j3)=>{j3.exports={parallel:O3(),serial:U3(),serialOrdered:fM()}});var B3=M((V0e,V3)=>{V3.exports=function(r,e){return Object.keys(e).forEach(function(t){r[t]=r[t]||e[t]}),r}});var $3=M((B0e,J3)=>{var yM=y3(),q3=require("util"),hM=require("path"),yce=require("http"),bce=require("https"),Ice=require("url").parse,Sce=require("fs"),xce=require("stream").Stream,gM=w3(),Cce=W3(),vM=B3();J3.exports=rr;q3.inherits(rr,yM);function rr(r){if(!(this instanceof rr))return new rr(r);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],yM.call(this),r=r||{};for(var e in r)this[e]=r[e]}rr.LINE_BREAK=`\r
`;rr.DEFAULT_CONTENT_TYPE="application/octet-stream";rr.prototype.append=function(r,e,t){t=t||{},typeof t=="string"&&(t={filename:t});var n=yM.prototype.append.bind(this);if(typeof e=="number"&&(e=""+e),q3.isArray(e)){this._error(new Error("Arrays are not supported."));return}var i=this._multiPartHeader(r,e,t),o=this._multiPartFooter();n(i),n(e),n(o),this._trackLength(i,e,t)};rr.prototype._trackLength=function(r,e,t){var n=0;t.knownLength!=null?n+=+t.knownLength:Buffer.isBuffer(e)?n=e.length:typeof e=="string"&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(r)+rr.LINE_BREAK.length,!(!e||!e.path&&!(e.readable&&e.hasOwnProperty("httpVersion"))&&!(e instanceof xce))&&(t.knownLength||this._valuesToMeasure.push(e))};rr.prototype._lengthRetriever=function(r,e){r.hasOwnProperty("fd")?r.end!=null&&r.end!=1/0&&r.start!=null?e(null,r.end+1-(r.start?r.start:0)):Sce.stat(r.path,function(t,n){var i;if(t){e(t);return}i=n.size-(r.start?r.start:0),e(null,i)}):r.hasOwnProperty("httpVersion")?e(null,+r.headers["content-length"]):r.hasOwnProperty("httpModule")?(r.on("response",function(t){r.pause(),e(null,+t.headers["content-length"])}),r.resume()):e("Unknown stream")};rr.prototype._multiPartHeader=function(r,e,t){if(typeof t.header=="string")return t.header;var n=this._getContentDisposition(e,t),i=this._getContentType(e,t),o="",s={"Content-Disposition":["form-data",'name="'+r+'"'].concat(n||[]),"Content-Type":[].concat(i||[])};typeof t.header=="object"&&vM(s,t.header);var a;for(var c in s)s.hasOwnProperty(c)&&(a=s[c],a!=null&&(Array.isArray(a)||(a=[a]),a.length&&(o+=c+": "+a.join("; ")+rr.LINE_BREAK)));return"--"+this.getBoundary()+rr.LINE_BREAK+o+rr.LINE_BREAK};rr.prototype._getContentDisposition=function(r,e){var t,n;return typeof e.filepath=="string"?t=hM.normalize(e.filepath).replace(/\\/g,"/"):e.filename||r.name||r.path?t=hM.basename(e.filename||r.name||r.path):r.readable&&r.hasOwnProperty("httpVersion")&&(t=hM.basename(r.client._httpMessage.path||"")),t&&(n='filename="'+t+'"'),n};rr.prototype._getContentType=function(r,e){var t=e.contentType;return!t&&r.name&&(t=gM.lookup(r.name)),!t&&r.path&&(t=gM.lookup(r.path)),!t&&r.readable&&r.hasOwnProperty("httpVersion")&&(t=r.headers["content-type"]),!t&&(e.filepath||e.filename)&&(t=gM.lookup(e.filepath||e.filename)),!t&&typeof r=="object"&&(t=rr.DEFAULT_CONTENT_TYPE),t};rr.prototype._multiPartFooter=function(){return function(r){var e=rr.LINE_BREAK,t=this._streams.length===0;t&&(e+=this._lastBoundary()),r(e)}.bind(this)};rr.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+rr.LINE_BREAK};rr.prototype.getHeaders=function(r){var e,t={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in r)r.hasOwnProperty(e)&&(t[e.toLowerCase()]=r[e]);return t};rr.prototype.setBoundary=function(r){this._boundary=r};rr.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary};rr.prototype.getBuffer=function(){for(var r=new Buffer.alloc(0),e=this.getBoundary(),t=0,n=this._streams.length;t<n;t++)typeof this._streams[t]!="function"&&(Buffer.isBuffer(this._streams[t])?r=Buffer.concat([r,this._streams[t]]):r=Buffer.concat([r,Buffer.from(this._streams[t])]),(typeof this._streams[t]!="string"||this._streams[t].substring(2,e.length+2)!==e)&&(r=Buffer.concat([r,Buffer.from(rr.LINE_BREAK)])));return Buffer.concat([r,Buffer.from(this._lastBoundary())])};rr.prototype._generateBoundary=function(){for(var r="--------------------------",e=0;e<24;e++)r+=Math.floor(Math.random()*10).toString(16);this._boundary=r};rr.prototype.getLengthSync=function(){var r=this._overheadLength+this._valueLength;return this._streams.length&&(r+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),r};rr.prototype.hasKnownLength=function(){var r=!0;return this._valuesToMeasure.length&&(r=!1),r};rr.prototype.getLength=function(r){var e=this._overheadLength+this._valueLength;if(this._streams.length&&(e+=this._lastBoundary().length),!this._valuesToMeasure.length){process.nextTick(r.bind(this,null,e));return}Cce.parallel(this._valuesToMeasure,this._lengthRetriever,function(t,n){if(t){r(t);return}n.forEach(function(i){e+=i}),r(null,e)})};rr.prototype.submit=function(r,e){var t,n,i={method:"post"};return typeof r=="string"?(r=Ice(r),n=vM({port:r.port,path:r.pathname,host:r.hostname,protocol:r.protocol},i)):(n=vM(r,i),n.port||(n.port=n.protocol=="https:"?443:80)),n.headers=this.getHeaders(r.headers),n.protocol=="https:"?t=bce.request(n):t=yce.request(n),this.getLength(function(o,s){if(o&&o!=="Unknown stream"){this._error(o);return}if(s&&t.setHeader("Content-Length",s),this.pipe(t),e){var a,c=function(l,u){return t.removeListener("error",c),t.removeListener("response",a),e.call(this,l,u)};a=c.bind(this,null),t.on("error",c),t.on("response",a)}}.bind(this)),t};rr.prototype._error=function(r){this.error||(this.error=r,this.pause(),this.emit("error",r))};rr.prototype.toString=function(){return"[object FormData]"}});var G3=M(H3=>{"use strict";var wce=require("url").parse,Ece={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},Pce=String.prototype.endsWith||function(r){return r.length<=this.length&&this.indexOf(r,this.length-r.length)!==-1};function kce(r){var e=typeof r=="string"?wce(r):r||{},t=e.protocol,n=e.host,i=e.port;if(typeof n!="string"||!n||typeof t!="string"||(t=t.split(":",1)[0],n=n.replace(/:\d*$/,""),i=parseInt(i)||Ece[t]||0,!Dce(n,i)))return"";var o=Og("npm_config_"+t+"_proxy")||Og(t+"_proxy")||Og("npm_config_proxy")||Og("all_proxy");return o&&o.indexOf("://")===-1&&(o=t+"://"+o),o}function Dce(r,e){var t=(Og("npm_config_no_proxy")||Og("no_proxy")).toLowerCase();return t?t==="*"?!1:t.split(/[,\s]/).every(function(n){if(!n)return!0;var i=n.match(/^(.+):(\d+)$/),o=i?i[1]:n,s=i?parseInt(i[2]):0;return s&&s!==e?!0:/^[.*]/.test(o)?(o.charAt(0)==="*"&&(o=o.slice(1)),!Pce.call(r,o)):r!==o}):!0}function Og(r){return process.env[r.toLowerCase()]||process.env[r.toUpperCase()]||""}H3.getProxyForUrl=kce});var ik=M((J0e,z3)=>{var Kg=1e3,Fg=Kg*60,Lg=Fg*60,Am=Lg*24,_ce=Am*7,Tce=Am*365.25;z3.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Rce(r);if(t==="number"&&isFinite(r))return e.long?Nce(r):Ace(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Rce(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Tce;case"weeks":case"week":case"w":return t*_ce;case"days":case"day":case"d":return t*Am;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Lg;case"minutes":case"minute":case"mins":case"min":case"m":return t*Fg;case"seconds":case"second":case"secs":case"sec":case"s":return t*Kg;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Ace(r){var e=Math.abs(r);return e>=Am?Math.round(r/Am)+"d":e>=Lg?Math.round(r/Lg)+"h":e>=Fg?Math.round(r/Fg)+"m":e>=Kg?Math.round(r/Kg)+"s":r+"ms"}function Nce(r){var e=Math.abs(r);return e>=Am?nk(r,e,Am,"day"):e>=Lg?nk(r,e,Lg,"hour"):e>=Fg?nk(r,e,Fg,"minute"):e>=Kg?nk(r,e,Kg,"second"):r+" ms"}function nk(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var bM=M(($0e,Q3)=>{function Mce(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=ik(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null,h,g;function y(...C){if(!y.enabled)return;let k=y,A=Number(new Date),T=A-(p||A);k.diff=T,k.prev=p,k.curr=A,p=A,C[0]=t.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let U=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(G,pe)=>{if(G==="%%")return"%";U++;let de=t.formatters[pe];if(typeof de=="function"){let te=C[U];G=de.call(k,te),C.splice(U,1),U--}return G}),t.formatArgs.call(k,C),(k.log||t.log).apply(k,C)}return y.namespace=u,y.useColors=t.useColors(),y.color=t.selectColor(u),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==t.namespaces&&(h=t.namespaces,g=t.enabled(u)),g),set:C=>{m=C}}),typeof t.init=="function"&&t.init(y),y}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Q3.exports=Mce});var Y3=M((Qo,ok)=>{Qo.formatArgs=Kce;Qo.save=Fce;Qo.load=Lce;Qo.useColors=Oce;Qo.storage=Uce();Qo.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Qo.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Oce(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Kce(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+ok.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}Qo.log=console.debug||console.log||(()=>{});function Fce(r){try{r?Qo.storage.setItem("debug",r):Qo.storage.removeItem("debug")}catch{}}function Lce(){let r;try{r=Qo.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Uce(){try{return localStorage}catch{}}ok.exports=bM()(Qo);var{formatters:jce}=ok.exports;jce.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Z3=M((H0e,X3)=>{"use strict";X3.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),i=e.indexOf("--");return n!==-1&&(i===-1?!0:n<i)}});var sk=M((G0e,eB)=>{"use strict";var Wce=require("os"),Ta=Z3(),Ki=process.env,Ug;Ta("no-color")||Ta("no-colors")||Ta("color=false")?Ug=!1:(Ta("color")||Ta("colors")||Ta("color=true")||Ta("color=always"))&&(Ug=!0);"FORCE_COLOR"in Ki&&(Ug=Ki.FORCE_COLOR.length===0||parseInt(Ki.FORCE_COLOR,10)!==0);function Vce(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function Bce(r){if(Ug===!1)return 0;if(Ta("color=16m")||Ta("color=full")||Ta("color=truecolor"))return 3;if(Ta("color=256"))return 2;if(r&&!r.isTTY&&Ug!==!0)return 0;let e=Ug?1:0;if(process.platform==="win32"){let t=Wce.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Ki)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Ki)||Ki.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Ki)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ki.TEAMCITY_VERSION)?1:0;if(Ki.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ki){let t=parseInt((Ki.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ki.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ki.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ki.TERM)||"COLORTERM"in Ki?1:(Ki.TERM==="dumb",e)}function IM(r){let e=Bce(r);return Vce(e)}eB.exports={supportsColor:IM,stdout:IM(process.stdout),stderr:IM(process.stderr)}});var rB=M((li,ck)=>{var qce=require("tty"),ak=require("util");li.init=Yce;li.log=Gce;li.formatArgs=$ce;li.save=zce;li.load=Qce;li.useColors=Jce;li.destroy=ak.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");li.colors=[6,2,3,4,5,1];try{let r=sk();r&&(r.stderr||r).level>=2&&(li.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}li.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function Jce(){return"colors"in li.inspectOpts?!!li.inspectOpts.colors:qce.isatty(process.stderr.fd)}function $ce(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+ck.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=Hce()+e+" "+r[0]}function Hce(){return li.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Gce(...r){return process.stderr.write(ak.format(...r)+`
`)}function zce(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Qce(){return process.env.DEBUG}function Yce(r){r.inspectOpts={};let e=Object.keys(li.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=li.inspectOpts[e[t]]}ck.exports=bM()(li);var{formatters:tB}=ck.exports;tB.o=function(r){return this.inspectOpts.colors=this.useColors,ak.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};tB.O=function(r){return this.inspectOpts.colors=this.useColors,ak.inspect(r,this.inspectOpts)}});var nB=M((z0e,SM)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?SM.exports=Y3():SM.exports=rB()});var oB=M((Q0e,iB)=>{var kx;iB.exports=function(){if(!kx){try{kx=nB()("follow-redirects")}catch{}typeof kx!="function"&&(kx=function(){})}kx.apply(null,arguments)}});var uB=M((Y0e,NM)=>{var Tx=require("url"),Dx=Tx.URL,Xce=require("http"),Zce=require("https"),PM=require("stream").Writable,kM=require("assert"),sB=oB(),DM=!1;try{kM(new Dx)}catch(r){DM=r.code==="ERR_INVALID_URL"}var ele=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],_M=["abort","aborted","connect","error","socket","timeout"],TM=Object.create(null);_M.forEach(function(r){TM[r]=function(e,t,n){this._redirectable.emit(r,e,t,n)}});var CM=Rx("ERR_INVALID_URL","Invalid URL",TypeError),wM=Rx("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),tle=Rx("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",wM),rle=Rx("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),nle=Rx("ERR_STREAM_WRITE_AFTER_END","write after end"),ile=PM.prototype.destroy||cB;function Co(r,e){PM.call(this),this._sanitizeOptions(r),this._options=r,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],e&&this.on("response",e);var t=this;this._onNativeResponse=function(n){try{t._processResponse(n)}catch(i){t.emit("error",i instanceof wM?i:new wM({cause:i}))}},this._performRequest()}Co.prototype=Object.create(PM.prototype);Co.prototype.abort=function(){AM(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};Co.prototype.destroy=function(r){return AM(this._currentRequest,r),ile.call(this,r),this};Co.prototype.write=function(r,e,t){if(this._ending)throw new nle;if(!Nm(r)&&!ale(r))throw new TypeError("data should be a string, Buffer or Uint8Array");if(_x(e)&&(t=e,e=null),r.length===0){t&&t();return}this._requestBodyLength+r.length<=this._options.maxBodyLength?(this._requestBodyLength+=r.length,this._requestBodyBuffers.push({data:r,encoding:e}),this._currentRequest.write(r,e,t)):(this.emit("error",new rle),this.abort())};Co.prototype.end=function(r,e,t){if(_x(r)?(t=r,r=e=null):_x(e)&&(t=e,e=null),!r)this._ended=this._ending=!0,this._currentRequest.end(null,null,t);else{var n=this,i=this._currentRequest;this.write(r,e,function(){n._ended=!0,i.end(null,null,t)}),this._ending=!0}};Co.prototype.setHeader=function(r,e){this._options.headers[r]=e,this._currentRequest.setHeader(r,e)};Co.prototype.removeHeader=function(r){delete this._options.headers[r],this._currentRequest.removeHeader(r)};Co.prototype.setTimeout=function(r,e){var t=this;function n(s){s.setTimeout(r),s.removeListener("timeout",s.destroy),s.addListener("timeout",s.destroy)}function i(s){t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){t.emit("timeout"),o()},r),n(s)}function o(){t._timeout&&(clearTimeout(t._timeout),t._timeout=null),t.removeListener("abort",o),t.removeListener("error",o),t.removeListener("response",o),t.removeListener("close",o),e&&t.removeListener("timeout",e),t.socket||t._currentRequest.removeListener("socket",i)}return e&&this.on("timeout",e),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",n),this.on("abort",o),this.on("error",o),this.on("response",o),this.on("close",o),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(r){Co.prototype[r]=function(e,t){return this._currentRequest[r](e,t)}});["aborted","connection","socket"].forEach(function(r){Object.defineProperty(Co.prototype,r,{get:function(){return this._currentRequest[r]}})});Co.prototype._sanitizeOptions=function(r){if(r.headers||(r.headers={}),r.host&&(r.hostname||(r.hostname=r.host),delete r.host),!r.pathname&&r.path){var e=r.path.indexOf("?");e<0?r.pathname=r.path:(r.pathname=r.path.substring(0,e),r.search=r.path.substring(e))}};Co.prototype._performRequest=function(){var r=this._options.protocol,e=this._options.nativeProtocols[r];if(!e)throw new TypeError("Unsupported protocol "+r);if(this._options.agents){var t=r.slice(0,-1);this._options.agent=this._options.agents[t]}var n=this._currentRequest=e.request(this._options,this._onNativeResponse);n._redirectable=this;for(var i of _M)n.on(i,TM[i]);if(this._currentUrl=/^\//.test(this._options.path)?Tx.format(this._options):this._options.path,this._isRedirect){var o=0,s=this,a=this._requestBodyBuffers;(function c(l){if(n===s._currentRequest)if(l)s.emit("error",l);else if(o<a.length){var u=a[o++];n.finished||n.write(u.data,u.encoding,c)}else s._ended&&n.end()})()}};Co.prototype._processResponse=function(r){var e=r.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:r.headers,statusCode:e});var t=r.headers.location;if(!t||this._options.followRedirects===!1||e<300||e>=400){r.responseUrl=this._currentUrl,r.redirects=this._redirects,this.emit("response",r),this._requestBodyBuffers=[];return}if(AM(this._currentRequest),r.destroy(),++this._redirectCount>this._options.maxRedirects)throw new tle;var n,i=this._options.beforeRedirect;i&&(n=Object.assign({Host:r.req.getHeader("host")},this._options.headers));var o=this._options.method;((e===301||e===302)&&this._options.method==="POST"||e===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],xM(/^content-/i,this._options.headers));var s=xM(/^host$/i,this._options.headers),a=RM(this._currentUrl),c=s||a.host,l=/^\w+:/.test(t)?this._currentUrl:Tx.format(Object.assign(a,{host:c})),u=ole(t,l);if(sB("redirecting to",u.href),this._isRedirect=!0,EM(u,this._options),(u.protocol!==a.protocol&&u.protocol!=="https:"||u.host!==c&&!sle(u.host,c))&&xM(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),_x(i)){var p={headers:r.headers,statusCode:e},m={url:l,method:o,headers:n};i(this._options,p,m),this._sanitizeOptions(this._options)}this._performRequest()};function aB(r){var e={maxRedirects:21,maxBodyLength:10485760},t={};return Object.keys(r).forEach(function(n){var i=n+":",o=t[i]=r[n],s=e[n]=Object.create(o);function a(l,u,p){return cle(l)?l=EM(l):Nm(l)?l=EM(RM(l)):(p=u,u=lB(l),l={protocol:i}),_x(u)&&(p=u,u=null),u=Object.assign({maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},l,u),u.nativeProtocols=t,!Nm(u.host)&&!Nm(u.hostname)&&(u.hostname="::1"),kM.equal(u.protocol,i,"protocol mismatch"),sB("options",u),new Co(u,p)}function c(l,u,p){var m=s.request(l,u,p);return m.end(),m}Object.defineProperties(s,{request:{value:a,configurable:!0,enumerable:!0,writable:!0},get:{value:c,configurable:!0,enumerable:!0,writable:!0}})}),e}function cB(){}function RM(r){var e;if(DM)e=new Dx(r);else if(e=lB(Tx.parse(r)),!Nm(e.protocol))throw new CM({input:r});return e}function ole(r,e){return DM?new Dx(r,e):RM(Tx.resolve(e,r))}function lB(r){if(/^\[/.test(r.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(r.hostname))throw new CM({input:r.href||r});if(/^\[/.test(r.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(r.host))throw new CM({input:r.href||r});return r}function EM(r,e){var t=e||{};for(var n of ele)t[n]=r[n];return t.hostname.startsWith("[")&&(t.hostname=t.hostname.slice(1,-1)),t.port!==""&&(t.port=Number(t.port)),t.path=t.search?t.pathname+t.search:t.pathname,t}function xM(r,e){var t;for(var n in e)r.test(n)&&(t=e[n],delete e[n]);return t===null||typeof t>"u"?void 0:String(t).trim()}function Rx(r,e,t){function n(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=r,this.message=this.cause?e+": "+this.cause.message:e}return n.prototype=new(t||Error),Object.defineProperties(n.prototype,{constructor:{value:n,enumerable:!1},name:{value:"Error ["+r+"]",enumerable:!1}}),n}function AM(r,e){for(var t of _M)r.removeListener(t,TM[t]);r.on("error",cB),r.destroy(e)}function sle(r,e){kM(Nm(r)&&Nm(e));var t=r.length-e.length-1;return t>0&&r[t]==="."&&r.endsWith(e)}function Nm(r){return typeof r=="string"||r instanceof String}function _x(r){return typeof r=="function"}function ale(r){return typeof r=="object"&&"length"in r}function cle(r){return Dx&&r instanceof Dx}NM.exports=aB({http:Xce,https:Zce});NM.exports.wrap=aB});var e6=M((X0e,ZB)=>{"use strict";var lle=$3(),ule=require("url"),ple=G3(),dle=require("http"),mle=require("https"),DB=require("util"),fle=uB(),hle=require("zlib"),_B=require("stream"),gle=require("events");function Ql(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var TB=Ql(lle),vle=Ql(ule),yle=Ql(dle),ble=Ql(mle),Ile=Ql(DB),Sle=Ql(fle),Np=Ql(hle),Rp=Ql(_B),xle=Ql(gle);function RB(r,e){return function(){return r.apply(e,arguments)}}var{toString:Cle}=Object.prototype,{getPrototypeOf:GM}=Object,fk=(r=>e=>{let t=Cle.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Bc=r=>(r=r.toLowerCase(),e=>fk(e)===r),hk=r=>e=>typeof e===r,{isArray:Bg}=Array,Mx=hk("undefined");function wle(r){return r!==null&&!Mx(r)&&r.constructor!==null&&!Mx(r.constructor)&&qs(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var AB=Bc("ArrayBuffer");function Ele(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&AB(r.buffer),e}var Ple=hk("string"),qs=hk("function"),NB=hk("number"),gk=r=>r!==null&&typeof r=="object",kle=r=>r===!0||r===!1,uk=r=>{if(fk(r)!=="object")return!1;let e=GM(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Dle=Bc("Date"),_le=Bc("File"),Tle=Bc("Blob"),Rle=Bc("FileList"),Ale=r=>gk(r)&&qs(r.pipe),Nle=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||qs(r.append)&&((e=fk(r))==="formdata"||e==="object"&&qs(r.toString)&&r.toString()==="[object FormData]"))},Mle=Bc("URLSearchParams"),Ole=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Kx(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Bg(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{let o=t?Object.getOwnPropertyNames(r):Object.keys(r),s=o.length,a;for(n=0;n<s;n++)a=o[n],e.call(null,r[a],a,r)}}function MB(r,e){e=e.toLowerCase();let t=Object.keys(r),n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}var OB=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),KB=r=>!Mx(r)&&r!==OB;function LM(){let{caseless:r}=KB(this)&&this||{},e={},t=(n,i)=>{let o=r&&MB(e,i)||i;uk(e[o])&&uk(n)?e[o]=LM(e[o],n):uk(n)?e[o]=LM({},n):Bg(n)?e[o]=n.slice():e[o]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Kx(arguments[n],t);return e}var Kle=(r,e,t,{allOwnKeys:n}={})=>(Kx(e,(i,o)=>{t&&qs(i)?r[o]=RB(i,t):r[o]=i},{allOwnKeys:n}),r),Fle=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Lle=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Ule=(r,e,t,n)=>{let i,o,s,a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),o=i.length;o-- >0;)s=i[o],(!n||n(s,r,e))&&!a[s]&&(e[s]=r[s],a[s]=!0);r=t!==!1&&GM(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},jle=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},Wle=r=>{if(!r)return null;if(Bg(r))return r;let e=r.length;if(!NB(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Vle=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&GM(Uint8Array)),Ble=(r,e)=>{let n=(r&&r[Symbol.iterator]).call(r),i;for(;(i=n.next())&&!i.done;){let o=i.value;e.call(r,o[0],o[1])}},qle=(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},Jle=Bc("HTMLFormElement"),$le=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),pB=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),Hle=Bc("RegExp"),FB=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};Kx(t,(i,o)=>{let s;(s=e(i,o,r))!==!1&&(n[o]=s||i)}),Object.defineProperties(r,n)},Gle=r=>{FB(r,(e,t)=>{if(qs(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];if(qs(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},zle=(r,e)=>{let t={},n=i=>{i.forEach(o=>{t[o]=!0})};return Bg(r)?n(r):n(String(r).split(e)),t},Qle=()=>{},Yle=(r,e)=>(r=+r,Number.isFinite(r)?r:e),MM="abcdefghijklmnopqrstuvwxyz",dB="0123456789",LB={DIGIT:dB,ALPHA:MM,ALPHA_DIGIT:MM+MM.toUpperCase()+dB},Xle=(r=16,e=LB.ALPHA_DIGIT)=>{let t="",{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function Zle(r){return!!(r&&qs(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var eue=r=>{let e=new Array(10),t=(n,i)=>{if(gk(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;let o=Bg(n)?[]:{};return Kx(n,(s,a)=>{let c=t(s,i+1);!Mx(c)&&(o[a]=c)}),e[i]=void 0,o}}return n};return t(r,0)},tue=Bc("AsyncFunction"),rue=r=>r&&(gk(r)||qs(r))&&qs(r.then)&&qs(r.catch),Z={isArray:Bg,isArrayBuffer:AB,isBuffer:wle,isFormData:Nle,isArrayBufferView:Ele,isString:Ple,isNumber:NB,isBoolean:kle,isObject:gk,isPlainObject:uk,isUndefined:Mx,isDate:Dle,isFile:_le,isBlob:Tle,isRegExp:Hle,isFunction:qs,isStream:Ale,isURLSearchParams:Mle,isTypedArray:Vle,isFileList:Rle,forEach:Kx,merge:LM,extend:Kle,trim:Ole,stripBOM:Fle,inherits:Lle,toFlatObject:Ule,kindOf:fk,kindOfTest:Bc,endsWith:jle,toArray:Wle,forEachEntry:Ble,matchAll:qle,isHTMLForm:Jle,hasOwnProperty:pB,hasOwnProp:pB,reduceDescriptors:FB,freezeMethods:Gle,toObjectSet:zle,toCamelCase:$le,noop:Qle,toFiniteNumber:Yle,findKey:MB,global:OB,isContextDefined:KB,ALPHABET:LB,generateString:Xle,isSpecCompliantForm:Zle,toJSONObject:eue,isAsyncFn:tue,isThenable:rue};function Xe(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}Z.inherits(Xe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Z.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var UB=Xe.prototype,jB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{jB[r]={value:r}});Object.defineProperties(Xe,jB);Object.defineProperty(UB,"isAxiosError",{value:!0});Xe.from=(r,e,t,n,i,o)=>{let s=Object.create(UB);return Z.toFlatObject(r,s,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Xe.call(s,r.message,e,t,n,i),s.cause=r,s.name=r.name,o&&Object.assign(s,o),s};function UM(r){return Z.isPlainObject(r)||Z.isArray(r)}function WB(r){return Z.endsWith(r,"[]")?r.slice(0,-2):r}function mB(r,e,t){return r?r.concat(e).map(function(i,o){return i=WB(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function nue(r){return Z.isArray(r)&&!r.some(UM)}var iue=Z.toFlatObject(Z,{},null,function(e){return/^is[A-Z]/.test(e)});function vk(r,e,t){if(!Z.isObject(r))throw new TypeError("target must be an object");e=e||new(TB.default||FormData),t=Z.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,C){return!Z.isUndefined(C[y])});let n=t.metaTokens,i=t.visitor||u,o=t.dots,s=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&Z.isSpecCompliantForm(e);if(!Z.isFunction(i))throw new TypeError("visitor must be a function");function l(g){if(g===null)return"";if(Z.isDate(g))return g.toISOString();if(!c&&Z.isBlob(g))throw new Xe("Blob is not supported. Use a Buffer instead.");return Z.isArrayBuffer(g)||Z.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,y,C){let k=g;if(g&&!C&&typeof g=="object"){if(Z.endsWith(y,"{}"))y=n?y:y.slice(0,-2),g=JSON.stringify(g);else if(Z.isArray(g)&&nue(g)||(Z.isFileList(g)||Z.endsWith(y,"[]"))&&(k=Z.toArray(g)))return y=WB(y),k.forEach(function(T,U){!(Z.isUndefined(T)||T===null)&&e.append(s===!0?mB([y],U,o):s===null?y:y+"[]",l(T))}),!1}return UM(g)?!0:(e.append(mB(C,y,o),l(g)),!1)}let p=[],m=Object.assign(iue,{defaultVisitor:u,convertValue:l,isVisitable:UM});function h(g,y){if(!Z.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));p.push(g),Z.forEach(g,function(k,A){(!(Z.isUndefined(k)||k===null)&&i.call(e,k,Z.isString(A)?A.trim():A,y,m))===!0&&h(k,y?y.concat(A):[A])}),p.pop()}}if(!Z.isObject(r))throw new TypeError("data must be an object");return h(r),e}function fB(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function VB(r,e){this._pairs=[],r&&vk(r,this,e)}var BB=VB.prototype;BB.append=function(e,t){this._pairs.push([e,t])};BB.toString=function(e){let t=e?function(n){return e.call(this,n,fB)}:fB;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function oue(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zM(r,e,t){if(!e)return r;let n=t&&t.encode||oue,i=t&&t.serialize,o;if(i?o=i(e,t):o=Z.isURLSearchParams(e)?e.toString():new VB(e,t).toString(n),o){let s=r.indexOf("#");s!==-1&&(r=r.slice(0,s)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}var jM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Z.forEach(this.handlers,function(n){n!==null&&e(n)})}},hB=jM,QM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},sue=vle.default.URLSearchParams,aue={isNode:!0,classes:{URLSearchParams:sue,FormData:TB.default,Blob:typeof Blob<"u"&&Blob||null},protocols:["http","https","file","data"]},qB=typeof window<"u"&&typeof document<"u",cue=(r=>qB&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),lue=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),uue=Object.freeze({__proto__:null,hasBrowserEnv:qB,hasStandardBrowserWebWorkerEnv:lue,hasStandardBrowserEnv:cue}),Bs={...uue,...aue};function pue(r,e){return vk(r,new Bs.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,o){return Bs.isNode&&Z.isBuffer(t)?(this.append(n,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function due(r){return Z.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function mue(r){let e={},t=Object.keys(r),n,i=t.length,o;for(n=0;n<i;n++)o=t[n],e[o]=r[o];return e}function JB(r){function e(t,n,i,o){let s=t[o++],a=Number.isFinite(+s),c=o>=t.length;return s=!s&&Z.isArray(i)?i.length:s,c?(Z.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a):((!i[s]||!Z.isObject(i[s]))&&(i[s]=[]),e(t,n,i[s],o)&&Z.isArray(i[s])&&(i[s]=mue(i[s])),!a)}if(Z.isFormData(r)&&Z.isFunction(r.entries)){let t={};return Z.forEachEntry(r,(n,i)=>{e(due(n),i,t,0)}),t}return null}function fue(r,e,t){if(Z.isString(r))try{return(e||JSON.parse)(r),Z.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var YM={transitional:QM,adapter:["xhr","http"],transformRequest:[function(e,t){let n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=Z.isObject(e);if(o&&Z.isHTMLForm(e)&&(e=new FormData(e)),Z.isFormData(e))return i&&i?JSON.stringify(JB(e)):e;if(Z.isArrayBuffer(e)||Z.isBuffer(e)||Z.isStream(e)||Z.isFile(e)||Z.isBlob(e))return e;if(Z.isArrayBufferView(e))return e.buffer;if(Z.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return pue(e,this.formSerializer).toString();if((a=Z.isFileList(e))||n.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return vk(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),fue(e)):e}],transformResponse:[function(e){let t=this.transitional||YM.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&Z.isString(e)&&(n&&!this.responseType||i)){let s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Xe.from(a,Xe.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Bs.classes.FormData,Blob:Bs.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Z.forEach(["delete","get","head","post","put","patch"],r=>{YM.headers[r]={}});var XM=YM,hue=Z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),gue=r=>{let e={},t,n,i;return r&&r.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),n=s.substring(i+1).trim(),!(!t||e[t]&&hue[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},gB=Symbol("internals");function Ax(r){return r&&String(r).trim().toLowerCase()}function pk(r){return r===!1||r==null?r:Z.isArray(r)?r.map(pk):String(r)}function vue(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}var yue=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function OM(r,e,t,n,i){if(Z.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!Z.isString(e)){if(Z.isString(n))return e.indexOf(n)!==-1;if(Z.isRegExp(n))return n.test(e)}}function bue(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Iue(r,e){let t=Z.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,o,s){return this[n].call(this,e,i,o,s)},configurable:!0})})}var jg=class{constructor(e){e&&this.set(e)}set(e,t,n){let i=this;function o(a,c,l){let u=Ax(c);if(!u)throw new Error("header name must be a non-empty string");let p=Z.findKey(i,u);(!p||i[p]===void 0||l===!0||l===void 0&&i[p]!==!1)&&(i[p||c]=pk(a))}let s=(a,c)=>Z.forEach(a,(l,u)=>o(l,u,c));return Z.isPlainObject(e)||e instanceof this.constructor?s(e,t):Z.isString(e)&&(e=e.trim())&&!yue(e)?s(gue(e),t):e!=null&&o(t,e,n),this}get(e,t){if(e=Ax(e),e){let n=Z.findKey(this,e);if(n){let i=this[n];if(!t)return i;if(t===!0)return vue(i);if(Z.isFunction(t))return t.call(this,i,n);if(Z.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ax(e),e){let n=Z.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||OM(this,this[n],n,t)))}return!1}delete(e,t){let n=this,i=!1;function o(s){if(s=Ax(s),s){let a=Z.findKey(n,s);a&&(!t||OM(n,n[a],a,t))&&(delete n[a],i=!0)}}return Z.isArray(e)?e.forEach(o):o(e),i}clear(e){let t=Object.keys(this),n=t.length,i=!1;for(;n--;){let o=t[n];(!e||OM(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){let t=this,n={};return Z.forEach(this,(i,o)=>{let s=Z.findKey(n,o);if(s){t[s]=pk(i),delete t[o];return}let a=e?bue(o):String(o).trim();a!==o&&delete t[o],t[a]=pk(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return Z.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&Z.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){let n=(this[gB]=this[gB]={accessors:{}}).accessors,i=this.prototype;function o(s){let a=Ax(s);n[a]||(Iue(i,s),n[a]=!0)}return Z.isArray(e)?e.forEach(o):o(e),this}};jg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Z.reduceDescriptors(jg.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});Z.freezeMethods(jg);var Js=jg;function KM(r,e){let t=this||XM,n=e||t,i=Js.from(n.headers),o=n.data;return Z.forEach(r,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function $B(r){return!!(r&&r.__CANCEL__)}function Mm(r,e,t){Xe.call(this,r??"canceled",Xe.ERR_CANCELED,e,t),this.name="CanceledError"}Z.inherits(Mm,Xe,{__CANCEL__:!0});function Nx(r,e,t){let n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new Xe("Request failed with status code "+t.status,[Xe.ERR_BAD_REQUEST,Xe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Sue(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function xue(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function ZM(r,e){return r&&!Sue(e)?xue(r,e):e}var mk="1.6.1";function HB(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}var Cue=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function wue(r,e,t){let n=t&&t.Blob||Bs.classes.Blob,i=HB(r);if(e===void 0&&n&&(e=!0),i==="data"){r=i.length?r.slice(i.length+1):r;let o=Cue.exec(r);if(!o)throw new Xe("Invalid URL",Xe.ERR_INVALID_URL);let s=o[1],a=o[2],c=o[3],l=Buffer.from(decodeURIComponent(c),a?"base64":"utf8");if(e){if(!n)throw new Xe("Blob is not supported",Xe.ERR_NOT_SUPPORT);return new n([l],{type:s})}return l}throw new Xe("Unsupported protocol "+i,Xe.ERR_NOT_SUPPORT)}function Eue(r,e){let t=0,n=1e3/e,i=null;return function(s,a){let c=Date.now();if(s||c-t>n)return i&&(clearTimeout(i),i=null),t=c,r.apply(null,a);i||(i=setTimeout(()=>(i=null,t=Date.now(),r.apply(null,a)),n-(c-t)))}}function GB(r,e){r=r||10;let t=new Array(r),n=new Array(r),i=0,o=0,s;return e=e!==void 0?e:1e3,function(c){let l=Date.now(),u=n[o];s||(s=l),t[i]=c,n[i]=l;let p=o,m=0;for(;p!==i;)m+=t[p++],p=p%r;if(i=(i+1)%r,i===o&&(o=(o+1)%r),l-s<e)return;let h=u&&l-u;return h?Math.round(m*1e3/h):void 0}}var lk=Symbol("internals"),WM=class extends Rp.default.Transform{constructor(e){e=Z.toFlatObject(e,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(a,c)=>!Z.isUndefined(c[a])),super({readableHighWaterMark:e.chunkSize});let t=this,n=this[lk]={length:e.length,timeWindow:e.timeWindow,ticksRate:e.ticksRate,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null},i=GB(n.ticksRate*e.samplesCount,n.timeWindow);this.on("newListener",a=>{a==="progress"&&(n.isCaptured||(n.isCaptured=!0))});let o=0;n.updateProgress=Eue(function(){let c=n.length,l=n.bytesSeen,u=l-o;if(!u||t.destroyed)return;let p=i(u);o=l,process.nextTick(()=>{t.emit("progress",{loaded:l,total:c,progress:c?l/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&l<=c?(c-l)/p:void 0})})},n.ticksRate);let s=()=>{n.updateProgress(!0)};this.once("end",s),this.once("error",s)}_read(e){let t=this[lk];return t.onReadCallback&&t.onReadCallback(),super._read(e)}_transform(e,t,n){let i=this,o=this[lk],s=o.maxRate,a=this.readableHighWaterMark,c=o.timeWindow,l=1e3/c,u=s/l,p=o.minChunkSize!==!1?Math.max(o.minChunkSize,u*.01):0;function m(g,y){let C=Buffer.byteLength(g);o.bytesSeen+=C,o.bytes+=C,o.isCaptured&&o.updateProgress(),i.push(g)?process.nextTick(y):o.onReadCallback=()=>{o.onReadCallback=null,process.nextTick(y)}}let h=(g,y)=>{let C=Buffer.byteLength(g),k=null,A=a,T,U=0;if(s){let oe=Date.now();(!o.ts||(U=oe-o.ts)>=c)&&(o.ts=oe,T=u-o.bytes,o.bytes=T<0?-T:0,U=0),T=u-o.bytes}if(s){if(T<=0)return setTimeout(()=>{y(null,g)},c-U);T<A&&(A=T)}A&&C>A&&C-A>p&&(k=g.subarray(A),g=g.subarray(0,A)),m(g,k?()=>{process.nextTick(y,null,k)}:y)};h(e,function g(y,C){if(y)return n(y);C?h(C,g):n(null)})}setLength(e){return this[lk].length=+e,this}},vB=WM,{asyncIterator:yB}=Symbol,Pue=async function*(r){r.stream?yield*r.stream():r.arrayBuffer?yield await r.arrayBuffer():r[yB]?yield*r[yB]():yield r},zB=Pue,kue=Z.ALPHABET.ALPHA_DIGIT+"-_",Ox=new DB.TextEncoder,Ap=`\r
`,Due=Ox.encode(Ap),_ue=2,VM=class{constructor(e,t){let{escapeName:n}=this.constructor,i=Z.isString(t),o=`Content-Disposition: form-data; name="${n(e)}"${!i&&t.name?`; filename="${n(t.name)}"`:""}${Ap}`;i?t=Ox.encode(String(t).replace(/\r?\n|\r\n?/g,Ap)):o+=`Content-Type: ${t.type||"application/octet-stream"}${Ap}`,this.headers=Ox.encode(o+Ap),this.contentLength=i?t.byteLength:t.size,this.size=this.headers.byteLength+this.contentLength+_ue,this.name=e,this.value=t}async*encode(){yield this.headers;let{value:e}=this;Z.isTypedArray(e)?yield e:yield*zB(e),yield Due}static escapeName(e){return String(e).replace(/[\r\n"]/g,t=>({"\r":"%0D","\n":"%0A",'"':"%22"})[t])}},Tue=(r,e,t)=>{let{tag:n="form-data-boundary",size:i=25,boundary:o=n+"-"+Z.generateString(i,kue)}=t||{};if(!Z.isFormData(r))throw TypeError("FormData instance required");if(o.length<1||o.length>70)throw Error("boundary must be 10-70 characters long");let s=Ox.encode("--"+o+Ap),a=Ox.encode("--"+o+"--"+Ap+Ap),c=a.byteLength,l=Array.from(r.entries()).map(([p,m])=>{let h=new VM(p,m);return c+=h.size,h});c+=s.byteLength*l.length,c=Z.toFiniteNumber(c);let u={"Content-Type":`multipart/form-data; boundary=${o}`};return Number.isFinite(c)&&(u["Content-Length"]=c),e&&e(u),_B.Readable.from(async function*(){for(let p of l)yield s,yield*p.encode();yield a}())},Rue=Tue,BM=class extends Rp.default.Transform{__transform(e,t,n){this.push(e),n()}_transform(e,t,n){if(e.length!==0&&(this._transform=this.__transform,e[0]!==120)){let i=Buffer.alloc(2);i[0]=120,i[1]=156,this.push(i,t)}this.__transform(e,t,n)}},Aue=BM,Nue=(r,e)=>Z.isAsyncFn(r)?function(...t){let n=t.pop();r.apply(this,t).then(i=>{try{e?n(null,...e(i)):n(null,i)}catch(o){n(o)}},n)}:r,Mue=Nue,bB={flush:Np.default.constants.Z_SYNC_FLUSH,finishFlush:Np.default.constants.Z_SYNC_FLUSH},Oue={flush:Np.default.constants.BROTLI_OPERATION_FLUSH,finishFlush:Np.default.constants.BROTLI_OPERATION_FLUSH},IB=Z.isFunction(Np.default.createBrotliDecompress),{http:Kue,https:Fue}=Sle.default,Lue=/https:?/,SB=Bs.protocols.map(r=>r+":");function Uue(r){r.beforeRedirects.proxy&&r.beforeRedirects.proxy(r),r.beforeRedirects.config&&r.beforeRedirects.config(r)}function QB(r,e,t){let n=e;if(!n&&n!==!1){let i=ple.getProxyForUrl(t);i&&(n=new URL(i))}if(n){if(n.username&&(n.auth=(n.username||"")+":"+(n.password||"")),n.auth){(n.auth.username||n.auth.password)&&(n.auth=(n.auth.username||"")+":"+(n.auth.password||""));let o=Buffer.from(n.auth,"utf8").toString("base64");r.headers["Proxy-Authorization"]="Basic "+o}r.headers.host=r.hostname+(r.port?":"+r.port:"");let i=n.hostname||n.host;r.hostname=i,r.host=i,r.port=n.port,r.path=t,n.protocol&&(r.protocol=n.protocol.includes(":")?n.protocol:`${n.protocol}:`)}r.beforeRedirects.proxy=function(o){QB(o,e,o.href)}}var jue=typeof process<"u"&&Z.kindOf(process)==="process",Wue=r=>new Promise((e,t)=>{let n,i,o=(c,l)=>{i||(i=!0,n&&n(c,l))},s=c=>{o(c),e(c)},a=c=>{o(c,!0),t(c)};r(s,a,c=>n=c).catch(a)}),Vue=({address:r,family:e})=>{if(!Z.isString(r))throw TypeError("address must be a string");return{address:r,family:e||(r.indexOf(".")<0?6:4)}},xB=(r,e)=>Vue(Z.isObject(r)?r:{address:r,family:e}),Bue=jue&&function(e){return Wue(async function(n,i,o){let{data:s,lookup:a,family:c}=e,{responseType:l,responseEncoding:u}=e,p=e.method.toUpperCase(),m,h=!1,g;if(a){let X=Mue(a,ye=>Z.isArray(ye)?ye:[ye]);a=(ye,qe,fn)=>{X(ye,qe,(Pt,$r,xs)=>{let Bt=Z.isArray($r)?$r.map(rn=>xB(rn)):[xB($r,xs)];qe.all?fn(Pt,Bt):fn(Pt,Bt[0].address,Bt[0].family)})}}let y=new xle.default,C=()=>{e.cancelToken&&e.cancelToken.unsubscribe(k),e.signal&&e.signal.removeEventListener("abort",k),y.removeAllListeners()};o((X,ye)=>{m=!0,ye&&(h=!0,C())});function k(X){y.emit("abort",!X||X.type?new Mm(null,e,g):X)}y.once("abort",i),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(k),e.signal&&(e.signal.aborted?k():e.signal.addEventListener("abort",k)));let A=ZM(e.baseURL,e.url),T=new URL(A,"http://localhost"),U=T.protocol||SB[0];if(U==="data:"){let X;if(p!=="GET")return Nx(n,i,{status:405,statusText:"method not allowed",headers:{},config:e});try{X=wue(e.url,l==="blob",{Blob:e.env&&e.env.Blob})}catch(ye){throw Xe.from(ye,Xe.ERR_BAD_REQUEST,e)}return l==="text"?(X=X.toString(u),(!u||u==="utf8")&&(X=Z.stripBOM(X))):l==="stream"&&(X=Rp.default.Readable.from(X)),Nx(n,i,{data:X,status:200,statusText:"OK",headers:new Js,config:e})}if(SB.indexOf(U)===-1)return i(new Xe("Unsupported protocol "+U,Xe.ERR_BAD_REQUEST,e));let oe=Js.from(e.headers).normalize();oe.set("User-Agent","axios/"+mk,!1);let G=e.onDownloadProgress,pe=e.onUploadProgress,de=e.maxRate,te,we;if(Z.isSpecCompliantForm(s)){let X=oe.getContentType(/boundary=([-_\w\d]{10,70})/i);s=Rue(s,ye=>{oe.set(ye)},{tag:`axios-${mk}-boundary`,boundary:X&&X[1]||void 0})}else if(Z.isFormData(s)&&Z.isFunction(s.getHeaders)){if(oe.set(s.getHeaders()),!oe.hasContentLength())try{let X=await Ile.default.promisify(s.getLength).call(s);Number.isFinite(X)&&X>=0&&oe.setContentLength(X)}catch{}}else if(Z.isBlob(s))s.size&&oe.setContentType(s.type||"application/octet-stream"),oe.setContentLength(s.size||0),s=Rp.default.Readable.from(zB(s));else if(s&&!Z.isStream(s)){if(!Buffer.isBuffer(s))if(Z.isArrayBuffer(s))s=Buffer.from(new Uint8Array(s));else if(Z.isString(s))s=Buffer.from(s,"utf-8");else return i(new Xe("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",Xe.ERR_BAD_REQUEST,e));if(oe.setContentLength(s.length,!1),e.maxBodyLength>-1&&s.length>e.maxBodyLength)return i(new Xe("Request body larger than maxBodyLength limit",Xe.ERR_BAD_REQUEST,e))}let Ue=Z.toFiniteNumber(oe.getContentLength());Z.isArray(de)?(te=de[0],we=de[1]):te=we=de,s&&(pe||te)&&(Z.isStream(s)||(s=Rp.default.Readable.from(s,{objectMode:!1})),s=Rp.default.pipeline([s,new vB({length:Ue,maxRate:Z.toFiniteNumber(te)})],Z.noop),pe&&s.on("progress",X=>{pe(Object.assign(X,{upload:!0}))}));let lt;if(e.auth){let X=e.auth.username||"",ye=e.auth.password||"";lt=X+":"+ye}if(!lt&&T.username){let X=T.username,ye=T.password;lt=X+":"+ye}lt&&oe.delete("authorization");let gt;try{gt=zM(T.pathname+T.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(X){let ye=new Error(X.message);return ye.config=e,ye.url=e.url,ye.exists=!0,i(ye)}oe.set("Accept-Encoding","gzip, compress, deflate"+(IB?", br":""),!1);let rt={path:gt,method:p,headers:oe.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:lt,protocol:U,family:c,beforeRedirect:Uue,beforeRedirects:{}};!Z.isUndefined(a)&&(rt.lookup=a),e.socketPath?rt.socketPath=e.socketPath:(rt.hostname=T.hostname,rt.port=T.port,QB(rt,e.proxy,U+"//"+T.hostname+(T.port?":"+T.port:"")+rt.path));let ae,ke=Lue.test(rt.protocol);if(rt.agent=ke?e.httpsAgent:e.httpAgent,e.transport?ae=e.transport:e.maxRedirects===0?ae=ke?ble.default:yle.default:(e.maxRedirects&&(rt.maxRedirects=e.maxRedirects),e.beforeRedirect&&(rt.beforeRedirects.config=e.beforeRedirect),ae=ke?Fue:Kue),e.maxBodyLength>-1?rt.maxBodyLength=e.maxBodyLength:rt.maxBodyLength=1/0,e.insecureHTTPParser&&(rt.insecureHTTPParser=e.insecureHTTPParser),g=ae.request(rt,function(ye){if(g.destroyed)return;let qe=[ye],fn=+ye.headers["content-length"];if(G){let rn=new vB({length:Z.toFiniteNumber(fn),maxRate:Z.toFiniteNumber(we)});G&&rn.on("progress",Bi=>{G(Object.assign(Bi,{download:!0}))}),qe.push(rn)}let Pt=ye,$r=ye.req||g;if(e.decompress!==!1&&ye.headers["content-encoding"])switch((p==="HEAD"||ye.statusCode===204)&&delete ye.headers["content-encoding"],(ye.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":qe.push(Np.default.createUnzip(bB)),delete ye.headers["content-encoding"];break;case"deflate":qe.push(new Aue),qe.push(Np.default.createUnzip(bB)),delete ye.headers["content-encoding"];break;case"br":IB&&(qe.push(Np.default.createBrotliDecompress(Oue)),delete ye.headers["content-encoding"])}Pt=qe.length>1?Rp.default.pipeline(qe,Z.noop):qe[0];let xs=Rp.default.finished(Pt,()=>{xs(),C()}),Bt={status:ye.statusCode,statusText:ye.statusMessage,headers:new Js(ye.headers),config:e,request:$r};if(l==="stream")Bt.data=Pt,Nx(n,i,Bt);else{let rn=[],Bi=0;Pt.on("data",function(cr){rn.push(cr),Bi+=cr.length,e.maxContentLength>-1&&Bi>e.maxContentLength&&(h=!0,Pt.destroy(),i(new Xe("maxContentLength size of "+e.maxContentLength+" exceeded",Xe.ERR_BAD_RESPONSE,e,$r)))}),Pt.on("aborted",function(){if(h)return;let cr=new Xe("maxContentLength size of "+e.maxContentLength+" exceeded",Xe.ERR_BAD_RESPONSE,e,$r);Pt.destroy(cr),i(cr)}),Pt.on("error",function(cr){g.destroyed||i(Xe.from(cr,null,e,$r))}),Pt.on("end",function(){try{let cr=rn.length===1?rn[0]:Buffer.concat(rn);l!=="arraybuffer"&&(cr=cr.toString(u),(!u||u==="utf8")&&(cr=Z.stripBOM(cr))),Bt.data=cr}catch(cr){return i(Xe.from(cr,null,e,Bt.request,Bt))}Nx(n,i,Bt)})}y.once("abort",rn=>{Pt.destroyed||(Pt.emit("error",rn),Pt.destroy())})}),y.once("abort",X=>{i(X),g.destroy(X)}),g.on("error",function(ye){i(Xe.from(ye,null,e,g))}),g.on("socket",function(ye){ye.setKeepAlive(!0,1e3*60)}),e.timeout){let X=parseInt(e.timeout,10);if(Number.isNaN(X)){i(new Xe("error trying to parse `config.timeout` to int",Xe.ERR_BAD_OPTION_VALUE,e,g));return}g.setTimeout(X,function(){if(m)return;let qe=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",fn=e.transitional||QM;e.timeoutErrorMessage&&(qe=e.timeoutErrorMessage),i(new Xe(qe,fn.clarifyTimeoutError?Xe.ETIMEDOUT:Xe.ECONNABORTED,e,g)),k()})}if(Z.isStream(s)){let X=!1,ye=!1;s.on("end",()=>{X=!0}),s.once("error",qe=>{ye=!0,g.destroy(qe)}),s.on("close",()=>{!X&&!ye&&k(new Mm("Request stream has been aborted",e,g))}),s.pipe(g)}else g.end(s)})},que=Bs.hasStandardBrowserEnv?function(){return{write:function(t,n,i,o,s,a){let c=[];c.push(t+"="+encodeURIComponent(n)),Z.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),Z.isString(o)&&c.push("path="+o),Z.isString(s)&&c.push("domain="+s),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){let n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Jue=Bs.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),n;function i(o){let s=o;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(s){let a=Z.isString(s)?i(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function CB(r,e){let t=0,n=GB(50,250);return i=>{let o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=n(a),l=o<=s;t=o;let u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,r(u)}}var $ue=typeof XMLHttpRequest<"u",Hue=$ue&&function(r){return new Promise(function(t,n){let i=r.data,o=Js.from(r.headers).normalize(),s=r.responseType,a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let l;if(Z.isFormData(i)){if(Bs.hasStandardBrowserEnv||Bs.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((l=o.getContentType())!==!1){let[g,...y]=l?l.split(";").map(C=>C.trim()).filter(Boolean):[];o.setContentType([g||"multipart/form-data",...y].join("; "))}}let u=new XMLHttpRequest;if(r.auth){let g=r.auth.username||"",y=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(g+":"+y))}let p=ZM(r.baseURL,r.url);u.open(r.method.toUpperCase(),zM(p,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function m(){if(!u)return;let g=Js.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),C={data:!s||s==="text"||s==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:g,config:r,request:u};Nx(function(A){t(A),c()},function(A){n(A),c()},C),u=null}if("onloadend"in u?u.onloadend=m:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(m)},u.onabort=function(){u&&(n(new Xe("Request aborted",Xe.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new Xe("Network Error",Xe.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let y=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",C=r.transitional||QM;r.timeoutErrorMessage&&(y=r.timeoutErrorMessage),n(new Xe(y,C.clarifyTimeoutError?Xe.ETIMEDOUT:Xe.ECONNABORTED,r,u)),u=null},Bs.hasStandardBrowserEnv){let g=Jue(p)&&r.xsrfCookieName&&que.read(r.xsrfCookieName);g&&o.set(r.xsrfHeaderName,g)}i===void 0&&o.setContentType(null),"setRequestHeader"in u&&Z.forEach(o.toJSON(),function(y,C){u.setRequestHeader(C,y)}),Z.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),s&&s!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",CB(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",CB(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=g=>{u&&(n(!g||g.type?new Mm(null,r,u):g),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));let h=HB(p);if(h&&Bs.protocols.indexOf(h)===-1){n(new Xe("Unsupported protocol "+h+":",Xe.ERR_BAD_REQUEST,r));return}u.send(i||null)})},qM={http:Bue,xhr:Hue};Z.forEach(qM,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var wB=r=>`- ${r}`,Gue=r=>Z.isFunction(r)||r===null||r===!1,YB={getAdapter:r=>{r=Z.isArray(r)?r:[r];let{length:e}=r,t,n,i={};for(let o=0;o<e;o++){t=r[o];let s;if(n=t,!Gue(t)&&(n=qM[(s=String(t)).toLowerCase()],n===void 0))throw new Xe(`Unknown adapter '${s}'`);if(n)break;i[s||"#"+o]=n}if(!n){let o=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build")),s=e?o.length>1?`since :
`+o.map(wB).join(`
`):" "+wB(o[0]):"as no adapter specified";throw new Xe("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:qM};function FM(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Mm(null,r)}function EB(r){return FM(r),r.headers=Js.from(r.headers),r.data=KM.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),YB.getAdapter(r.adapter||XM.adapter)(r).then(function(n){return FM(r),n.data=KM.call(r,r.transformResponse,n),n.headers=Js.from(n.headers),n},function(n){return $B(n)||(FM(r),n&&n.response&&(n.response.data=KM.call(r,r.transformResponse,n.response),n.response.headers=Js.from(n.response.headers))),Promise.reject(n)})}var PB=r=>r instanceof Js?r.toJSON():r;function Wg(r,e){e=e||{};let t={};function n(l,u,p){return Z.isPlainObject(l)&&Z.isPlainObject(u)?Z.merge.call({caseless:p},l,u):Z.isPlainObject(u)?Z.merge({},u):Z.isArray(u)?u.slice():u}function i(l,u,p){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return n(void 0,l,p)}else return n(l,u,p)}function o(l,u){if(!Z.isUndefined(u))return n(void 0,u)}function s(l,u){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return n(void 0,l)}else return n(void 0,u)}function a(l,u,p){if(p in e)return n(l,u);if(p in r)return n(void 0,l)}let c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(PB(l),PB(u),!0)};return Z.forEach(Object.keys(Object.assign({},r,e)),function(u){let p=c[u]||i,m=p(r[u],e[u],u);Z.isUndefined(m)&&p!==a||(t[u]=m)}),t}var eO={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{eO[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var kB={};eO.transitional=function(e,t,n){function i(o,s){return"[Axios v"+mk+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,a)=>{if(e===!1)throw new Xe(i(s," has been removed"+(t?" in "+t:"")),Xe.ERR_DEPRECATED);return t&&!kB[s]&&(kB[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};function zue(r,e,t){if(typeof r!="object")throw new Xe("options must be an object",Xe.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let o=n[i],s=e[o];if(s){let a=r[o],c=a===void 0||s(a,o,r);if(c!==!0)throw new Xe("option "+o+" must be "+c,Xe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Xe("Unknown option "+o,Xe.ERR_BAD_OPTION)}}var JM={assertOptions:zue,validators:eO},Tp=JM.validators,Vg=class{constructor(e){this.defaults=e,this.interceptors={request:new hB,response:new hB}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Wg(this.defaults,t);let{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&JM.assertOptions(n,{silentJSONParsing:Tp.transitional(Tp.boolean),forcedJSONParsing:Tp.transitional(Tp.boolean),clarifyTimeoutError:Tp.transitional(Tp.boolean)},!1),i!=null&&(Z.isFunction(i)?t.paramsSerializer={serialize:i}:JM.assertOptions(i,{encode:Tp.function,serialize:Tp.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&Z.merge(o.common,o[t.method]);o&&Z.forEach(["delete","get","head","post","put","patch","common"],g=>{delete o[g]}),t.headers=Js.concat(s,o);let a=[],c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});let l=[];this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let u,p=0,m;if(!c){let g=[EB.bind(this),void 0];for(g.unshift.apply(g,a),g.push.apply(g,l),m=g.length,u=Promise.resolve(t);p<m;)u=u.then(g[p++],g[p++]);return u}m=a.length;let h=t;for(p=0;p<m;){let g=a[p++],y=a[p++];try{h=g(h)}catch(C){y.call(this,C);break}}try{u=EB.call(this,h)}catch(g){return Promise.reject(g)}for(p=0,m=l.length;p<m;)u=u.then(l[p++],l[p++]);return u}getUri(e){e=Wg(this.defaults,e);let t=ZM(e.baseURL,e.url);return zM(t,e.params,e.paramsSerializer)}};Z.forEach(["delete","get","head","options"],function(e){Vg.prototype[e]=function(t,n){return this.request(Wg(n||{},{method:e,url:t,data:(n||{}).data}))}});Z.forEach(["post","put","patch"],function(e){function t(n){return function(o,s,a){return this.request(Wg(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Vg.prototype[e]=t(),Vg.prototype[e+"Form"]=t(!0)});var dk=Vg,$M=class r{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,s=new Promise(a=>{n.subscribe(a),o=a}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},e(function(o,s,a){n.reason||(n.reason=new Mm(o,s,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new r(function(i){e=i}),cancel:e}}},Que=$M;function Yue(r){return function(t){return r.apply(null,t)}}function Xue(r){return Z.isObject(r)&&r.isAxiosError===!0}var HM={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HM).forEach(([r,e])=>{HM[e]=r});var Zue=HM;function XB(r){let e=new dk(r),t=RB(dk.prototype.request,e);return Z.extend(t,dk.prototype,e,{allOwnKeys:!0}),Z.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return XB(Wg(r,i))},t}var Tn=XB(XM);Tn.Axios=dk;Tn.CanceledError=Mm;Tn.CancelToken=Que;Tn.isCancel=$B;Tn.VERSION=mk;Tn.toFormData=vk;Tn.AxiosError=Xe;Tn.Cancel=Tn.CanceledError;Tn.all=function(e){return Promise.all(e)};Tn.spread=Yue;Tn.isAxiosError=Xue;Tn.mergeConfig=Wg;Tn.AxiosHeaders=Js;Tn.formToJSON=r=>JB(Z.isHTMLForm(r)?new FormData(r):r);Tn.getAdapter=YB.getAdapter;Tn.HttpStatusCode=Zue;Tn.default=Tn;ZB.exports=Tn});var t6=M(yk=>{"use strict";Object.defineProperty(yk,"__esModule",{value:!0});yk.AxiosHttpClient=void 0;var epe=e6(),tO=class{constructor(e){this.endpoint=e}get(e){return epe.default.get(this.endpoint,Object.assign(Object.assign({},e),{proxy:!1}))}};yk.AxiosHttpClient=tO});var r6=M(bk=>{"use strict";Object.defineProperty(bk,"__esModule",{value:!0});bk.MemoryKeyValueStorage=void 0;var rO=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};bk.MemoryKeyValueStorage=rO});var n6=M(Ik=>{"use strict";Object.defineProperty(Ik,"__esModule",{value:!0});Ik.ExperimentationServiceBase=void 0;var tpe=r6(),nO=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,n,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=n,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new tpe.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async n=>await n.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let n={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)n.features.includes(o)||n.features.push(o);for(let o of i.configs){let s=n.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):n.configs.push(o)}n.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=n),this.storage&&this.storage.setValue(this.storageKey,n)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let n=this.features.configs.find(i=>i.Id===e);return n?.Parameters[t]}async getTreatmentVariableAsync(e,t,n){if(n){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};Ik.ExperimentationServiceBase=nO});var i6=M(Sk=>{"use strict";Object.defineProperty(Sk,"__esModule",{value:!0});Sk.PollingService=void 0;var iO=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};Sk.PollingService=iO});var o6=M(xk=>{"use strict";Object.defineProperty(xk,"__esModule",{value:!0});xk.ExperimentationServiceAutoPolling=void 0;var rpe=n6(),npe=i6(),oO=class extends rpe.ExperimentationServiceBase{constructor(e,t,n,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=n,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,n<1e3&&n!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");n>0&&(this.pollingService=new npe.PollingService(n),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};xk.ExperimentationServiceAutoPolling=oO});var s6=M(wk=>{"use strict";Object.defineProperty(wk,"__esModule",{value:!0});wk.ExperimentationService=void 0;var ipe=p3(),ope=t6(),spe=o6(),Ck=class extends spe.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new ipe.TasApiFeatureProvider(new ope.AxiosHttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};wk.ExperimentationService=Ck;Ck.REFRESH_RATE_IN_MINUTES=30});var a6=M(Ek=>{"use strict";Object.defineProperty(Ek,"__esModule",{value:!0});Ek.ExperimentationService=void 0;var ape=s6();Object.defineProperty(Ek,"ExperimentationService",{enumerable:!0,get:function(){return ape.ExperimentationService}})});var c6=M(Pk=>{"use strict";Object.defineProperty(Pk,"__esModule",{value:!0});Pk.MementoKeyValueStorage=void 0;var sO=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};Pk.MementoKeyValueStorage=sO});var l6=M(cO=>{"use strict";Object.defineProperty(cO,"__esModule",{value:!0});var aO=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};cO.default=aO});var p6=M(qg=>{"use strict";Object.defineProperty(qg,"__esModule",{value:!0});qg.getExperimentationServiceAsync=qg.getExperimentationService=void 0;var cpe=iM(),lpe=a6(),lO=require("vscode"),upe=c6(),ppe=l6(),dpe="https://default.exp-tas.com/vscode/ab",mpe="query-expfeature",fpe="abexp.assignmentcontext",hpe="VSCode.ABExp.FeatureData",gpe=1e3*60*30;function u6(r,e,t,n,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=lO.workspace.getConfiguration("telemetry");if(!(lO.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):lO.env.isTelemetryEnabled))return new ppe.default;let l=[new cpe.VSCodeFilterProvider(r,e,t),...o],u=new upe.MementoKeyValueStorage(i);return new lpe.ExperimentationService({filterProviders:l,telemetry:n,storageKey:hpe,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:fpe,telemetryEventName:mpe,endpoint:dpe,refetchInterval:gpe})}qg.getExperimentationService=u6;async function vpe(r,e,t,n,i,...o){let s=u6(r,e,t,n,i,...o);return await s.initializePromise,s}qg.getExperimentationServiceAsync=vpe});var m6=M(Mp=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.TargetPopulation=Mp.getExperimentationServiceAsync=Mp.getExperimentationService=void 0;var d6=p6();Object.defineProperty(Mp,"getExperimentationService",{enumerable:!0,get:function(){return d6.getExperimentationService}});Object.defineProperty(Mp,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return d6.getExperimentationServiceAsync}});var ype=iM();Object.defineProperty(Mp,"TargetPopulation",{enumerable:!0,get:function(){return ype.TargetPopulation}})});var x6=M((pRe,S6)=>{"use strict";function Spe(){let r=[].slice.call(arguments).filter(t=>t),e=r.shift();return r.forEach(t=>{Object.keys(t).forEach(n=>{e[n]=t[n]})}),e}S6.exports=Spe});var Eo=M(dO=>{"use strict";dO.fromCallback=function(r){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")r.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(n,i)=>{if(n)return t(n);e(i)},arguments.length++,r.apply(this,arguments)})},"name",{value:r.name})};dO.fromPromise=function(r){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return r.apply(this,arguments);r.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:r.name})}});var w6=M((mRe,C6)=>{var Lp=require("constants"),xpe=process.cwd,Nk=null,Cpe=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return Nk||(Nk=xpe.call(process)),Nk};try{process.cwd()}catch{}typeof process.chdir=="function"&&(mO=process.chdir,process.chdir=function(r){Nk=null,mO.call(process,r)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,mO));var mO;C6.exports=wpe;function wpe(r){Lp.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(r),r.lutimes||t(r),r.chown=o(r.chown),r.fchown=o(r.fchown),r.lchown=o(r.lchown),r.chmod=n(r.chmod),r.fchmod=n(r.fchmod),r.lchmod=n(r.lchmod),r.chownSync=s(r.chownSync),r.fchownSync=s(r.fchownSync),r.lchownSync=s(r.lchownSync),r.chmodSync=i(r.chmodSync),r.fchmodSync=i(r.fchmodSync),r.lchmodSync=i(r.lchmodSync),r.stat=a(r.stat),r.fstat=a(r.fstat),r.lstat=a(r.lstat),r.statSync=c(r.statSync),r.fstatSync=c(r.fstatSync),r.lstatSync=c(r.lstatSync),r.chmod&&!r.lchmod&&(r.lchmod=function(u,p,m){m&&process.nextTick(m)},r.lchmodSync=function(){}),r.chown&&!r.lchown&&(r.lchown=function(u,p,m,h){h&&process.nextTick(h)},r.lchownSync=function(){}),Cpe==="win32"&&(r.rename=typeof r.rename!="function"?r.rename:function(u){function p(m,h,g){var y=Date.now(),C=0;u(m,h,function k(A){if(A&&(A.code==="EACCES"||A.code==="EPERM")&&Date.now()-y<6e4){setTimeout(function(){r.stat(h,function(T,U){T&&T.code==="ENOENT"?u(m,h,k):g(A)})},C),C<100&&(C+=10);return}g&&g(A)})}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.rename)),r.read=typeof r.read!="function"?r.read:function(u){function p(m,h,g,y,C,k){var A;if(k&&typeof k=="function"){var T=0;A=function(U,oe,G){if(U&&U.code==="EAGAIN"&&T<10)return T++,u.call(r,m,h,g,y,C,A);k.apply(this,arguments)}}return u.call(r,m,h,g,y,C,A)}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.read),r.readSync=typeof r.readSync!="function"?r.readSync:function(u){return function(p,m,h,g,y){for(var C=0;;)try{return u.call(r,p,m,h,g,y)}catch(k){if(k.code==="EAGAIN"&&C<10){C++;continue}throw k}}}(r.readSync);function e(u){u.lchmod=function(p,m,h){u.open(p,Lp.O_WRONLY|Lp.O_SYMLINK,m,function(g,y){if(g){h&&h(g);return}u.fchmod(y,m,function(C){u.close(y,function(k){h&&h(C||k)})})})},u.lchmodSync=function(p,m){var h=u.openSync(p,Lp.O_WRONLY|Lp.O_SYMLINK,m),g=!0,y;try{y=u.fchmodSync(h,m),g=!1}finally{if(g)try{u.closeSync(h)}catch{}else u.closeSync(h)}return y}}function t(u){Lp.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(p,m,h,g){u.open(p,Lp.O_SYMLINK,function(y,C){if(y){g&&g(y);return}u.futimes(C,m,h,function(k){u.close(C,function(A){g&&g(k||A)})})})},u.lutimesSync=function(p,m,h){var g=u.openSync(p,Lp.O_SYMLINK),y,C=!0;try{y=u.futimesSync(g,m,h),C=!1}finally{if(C)try{u.closeSync(g)}catch{}else u.closeSync(g)}return y}):u.futimes&&(u.lutimes=function(p,m,h,g){g&&process.nextTick(g)},u.lutimesSync=function(){})}function n(u){return u&&function(p,m,h){return u.call(r,p,m,function(g){l(g)&&(g=null),h&&h.apply(this,arguments)})}}function i(u){return u&&function(p,m){try{return u.call(r,p,m)}catch(h){if(!l(h))throw h}}}function o(u){return u&&function(p,m,h,g){return u.call(r,p,m,h,function(y){l(y)&&(y=null),g&&g.apply(this,arguments)})}}function s(u){return u&&function(p,m,h){try{return u.call(r,p,m,h)}catch(g){if(!l(g))throw g}}}function a(u){return u&&function(p,m,h){typeof m=="function"&&(h=m,m=null);function g(y,C){C&&(C.uid<0&&(C.uid+=4294967296),C.gid<0&&(C.gid+=4294967296)),h&&h.apply(this,arguments)}return m?u.call(r,p,m,g):u.call(r,p,g)}}function c(u){return u&&function(p,m){var h=m?u.call(r,p,m):u.call(r,p);return h&&(h.uid<0&&(h.uid+=4294967296),h.gid<0&&(h.gid+=4294967296)),h}}function l(u){if(!u||u.code==="ENOSYS")return!0;var p=!process.getuid||process.getuid()!==0;return!!(p&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var k6=M((fRe,P6)=>{var E6=require("stream").Stream;P6.exports=Epe;function Epe(r){return{ReadStream:e,WriteStream:t};function e(n,i){if(!(this instanceof e))return new e(n,i);E6.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var l=s[a];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}r.open(this.path,this.flags,this.mode,function(u,p){if(u){o.emit("error",u),o.readable=!1;return}o.fd=p,o.emit("open",p),o._read()})}function t(n,i){if(!(this instanceof t))return new t(n,i);E6.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var c=o[s];this[c]=i[c]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=r.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var _6=M((hRe,D6)=>{"use strict";D6.exports=kpe;var Ppe=Object.getPrototypeOf||function(r){return r.__proto__};function kpe(r){if(r===null||typeof r!="object")return r;if(r instanceof Object)var e={__proto__:Ppe(r)};else var e=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}});var Rn=M((gRe,gO)=>{var dn=require("fs"),Dpe=w6(),_pe=k6(),Tpe=_6(),Mk=require("util"),ui,Kk;typeof Symbol=="function"&&typeof Symbol.for=="function"?(ui=Symbol.for("graceful-fs.queue"),Kk=Symbol.for("graceful-fs.previous")):(ui="___graceful-fs.queue",Kk="___graceful-fs.previous");function Rpe(){}function A6(r,e){Object.defineProperty(r,ui,{get:function(){return e}})}var Om=Rpe;Mk.debuglog?Om=Mk.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Om=function(){var r=Mk.format.apply(Mk,arguments);r="GFS4: "+r.split(/\n/).join(`
GFS4: `),console.error(r)});dn[ui]||(T6=global[ui]||[],A6(dn,T6),dn.close=function(r){function e(t,n){return r.call(dn,t,function(i){i||R6(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,Kk,{value:r}),e}(dn.close),dn.closeSync=function(r){function e(t){r.apply(dn,arguments),R6()}return Object.defineProperty(e,Kk,{value:r}),e}(dn.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Om(dn[ui]),require("assert").equal(dn[ui].length,0)}));var T6;global[ui]||A6(global,dn[ui]);gO.exports=fO(Tpe(dn));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!dn.__patched&&(gO.exports=fO(dn),dn.__patched=!0);function fO(r){Dpe(r),r.gracefulify=fO,r.createReadStream=oe,r.createWriteStream=G;var e=r.readFile;r.readFile=t;function t(te,we,Ue){return typeof we=="function"&&(Ue=we,we=null),lt(te,we,Ue);function lt(gt,rt,ae,ke){return e(gt,rt,function(X){X&&(X.code==="EMFILE"||X.code==="ENFILE")?Xg([lt,[gt,rt,ae],X,ke||Date.now(),Date.now()]):typeof ae=="function"&&ae.apply(this,arguments)})}}var n=r.writeFile;r.writeFile=i;function i(te,we,Ue,lt){return typeof Ue=="function"&&(lt=Ue,Ue=null),gt(te,we,Ue,lt);function gt(rt,ae,ke,X,ye){return n(rt,ae,ke,function(qe){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?Xg([gt,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}var o=r.appendFile;o&&(r.appendFile=s);function s(te,we,Ue,lt){return typeof Ue=="function"&&(lt=Ue,Ue=null),gt(te,we,Ue,lt);function gt(rt,ae,ke,X,ye){return o(rt,ae,ke,function(qe){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?Xg([gt,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}var a=r.copyFile;a&&(r.copyFile=c);function c(te,we,Ue,lt){return typeof Ue=="function"&&(lt=Ue,Ue=0),gt(te,we,Ue,lt);function gt(rt,ae,ke,X,ye){return a(rt,ae,ke,function(qe){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?Xg([gt,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}var l=r.readdir;r.readdir=p;var u=/^v[0-5]\./;function p(te,we,Ue){typeof we=="function"&&(Ue=we,we=null);var lt=u.test(process.version)?function(ae,ke,X,ye){return l(ae,gt(ae,ke,X,ye))}:function(ae,ke,X,ye){return l(ae,ke,gt(ae,ke,X,ye))};return lt(te,we,Ue);function gt(rt,ae,ke,X){return function(ye,qe){ye&&(ye.code==="EMFILE"||ye.code==="ENFILE")?Xg([lt,[rt,ae,ke],ye,X||Date.now(),Date.now()]):(qe&&qe.sort&&qe.sort(),typeof ke=="function"&&ke.call(this,ye,qe))}}}if(process.version.substr(0,4)==="v0.8"){var m=_pe(r);k=m.ReadStream,T=m.WriteStream}var h=r.ReadStream;h&&(k.prototype=Object.create(h.prototype),k.prototype.open=A);var g=r.WriteStream;g&&(T.prototype=Object.create(g.prototype),T.prototype.open=U),Object.defineProperty(r,"ReadStream",{get:function(){return k},set:function(te){k=te},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WriteStream",{get:function(){return T},set:function(te){T=te},enumerable:!0,configurable:!0});var y=k;Object.defineProperty(r,"FileReadStream",{get:function(){return y},set:function(te){y=te},enumerable:!0,configurable:!0});var C=T;Object.defineProperty(r,"FileWriteStream",{get:function(){return C},set:function(te){C=te},enumerable:!0,configurable:!0});function k(te,we){return this instanceof k?(h.apply(this,arguments),this):k.apply(Object.create(k.prototype),arguments)}function A(){var te=this;de(te.path,te.flags,te.mode,function(we,Ue){we?(te.autoClose&&te.destroy(),te.emit("error",we)):(te.fd=Ue,te.emit("open",Ue),te.read())})}function T(te,we){return this instanceof T?(g.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function U(){var te=this;de(te.path,te.flags,te.mode,function(we,Ue){we?(te.destroy(),te.emit("error",we)):(te.fd=Ue,te.emit("open",Ue))})}function oe(te,we){return new r.ReadStream(te,we)}function G(te,we){return new r.WriteStream(te,we)}var pe=r.open;r.open=de;function de(te,we,Ue,lt){return typeof Ue=="function"&&(lt=Ue,Ue=null),gt(te,we,Ue,lt);function gt(rt,ae,ke,X,ye){return pe(rt,ae,ke,function(qe,fn){qe&&(qe.code==="EMFILE"||qe.code==="ENFILE")?Xg([gt,[rt,ae,ke,X],qe,ye||Date.now(),Date.now()]):typeof X=="function"&&X.apply(this,arguments)})}}return r}function Xg(r){Om("ENQUEUE",r[0].name,r[1]),dn[ui].push(r),hO()}var Ok;function R6(){for(var r=Date.now(),e=0;e<dn[ui].length;++e)dn[ui][e].length>2&&(dn[ui][e][3]=r,dn[ui][e][4]=r);hO()}function hO(){if(clearTimeout(Ok),Ok=void 0,dn[ui].length!==0){var r=dn[ui].shift(),e=r[0],t=r[1],n=r[2],i=r[3],o=r[4];if(i===void 0)Om("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Om("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,c=Math.max(o-i,1),l=Math.min(c*1.2,100);a>=l?(Om("RETRY",e.name,t),e.apply(null,t.concat([i]))):dn[ui].push(r)}Ok===void 0&&(Ok=setTimeout(hO,0))}}});var vO=M(Zg=>{var Ape=Eo().fromCallback,Ra=Rn(),Npe=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(r=>typeof Ra[r]=="function");Object.keys(Ra).forEach(r=>{Zg[r]=Ra[r]});Npe.forEach(r=>{Zg[r]=Ape(Ra[r])});Zg.exists=function(r,e){return typeof e=="function"?Ra.exists(r,e):new Promise(t=>Ra.exists(r,t))};Zg.read=function(r,e,t,n,i,o){return typeof o=="function"?Ra.read(r,e,t,n,i,o):new Promise((s,a)=>{Ra.read(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesRead:l,buffer:u})})})};Zg.write=function(r,e,t,n,i,o){return typeof arguments[arguments.length-1]=="function"?Ra.write(r,e,t,n,i,o):typeof e=="string"?new Promise((s,a)=>{Ra.write(r,e,t,n,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})}):new Promise((s,a)=>{Ra.write(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})})}});var O6=M((yRe,M6)=>{"use strict";var Xo=Rn(),N6=require("os"),Fk=require("path");function Mpe(){let r=Fk.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));r=Fk.join(N6.tmpdir(),r);let e=new Date(1435410243862);Xo.writeFileSync(r,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=Xo.openSync(r,"r+");return Xo.futimesSync(t,e,e),Xo.closeSync(t),Xo.statSync(r).mtime>1435410243e3}function Ope(r){let e=Fk.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=Fk.join(N6.tmpdir(),e);let t=new Date(1435410243862);Xo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",n=>{if(n)return r(n);Xo.open(e,"r+",(i,o)=>{if(i)return r(i);Xo.futimes(o,t,t,s=>{if(s)return r(s);Xo.close(o,a=>{if(a)return r(a);Xo.stat(e,(c,l)=>{if(c)return r(c);r(null,l.mtime>1435410243e3)})})})})})}function Kpe(r){if(typeof r=="number")return Math.floor(r/1e3)*1e3;if(r instanceof Date)return new Date(Math.floor(r.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function Fpe(r,e,t,n){Xo.open(r,"r+",(i,o)=>{if(i)return n(i);Xo.futimes(o,e,t,s=>{Xo.close(o,a=>{n&&n(s||a)})})})}M6.exports={hasMillisRes:Ope,hasMillisResSync:Mpe,timeRemoveMillis:Kpe,utimesMillis:Fpe}});var yO=M((bRe,K6)=>{var Zo=Rn(),Ux=require("path"),Lpe=O6();function Upe(r,e,t,n){n||(n=t,t={});var i=process.cwd(),o=Ux.resolve(i,r),s=Ux.resolve(i,e),a=t.filter,c=t.transform,l=t.overwrite;l===void 0&&(l=t.clobber),l===void 0&&(l=!0);var u=t.errorOnExist,p=t.dereference,m=t.preserveTimestamps===!0,h=0,g=0,y=0,C=!1;k(o);function k(ae){if(h++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(ae))return rt(!0)}else if(typeof a=="function"&&!a(ae,e))return rt(!0)}return A(ae)}function A(ae){var ke=p?Zo.stat:Zo.lstat;y++,ke(ae,function(X,ye){if(X)return gt(X);var qe={name:ae,mode:ye.mode,mtime:ye.mtime,atime:ye.atime,stats:ye};if(ye.isDirectory())return G(qe);if(ye.isFile()||ye.isCharacterDevice()||ye.isBlockDevice())return T(qe);if(ye.isSymbolicLink())return te(ae)})}function T(ae){var ke=ae.name.replace(o,s.replace("$","$$$$"));lt(ke,function(X){X?U(ae,ke):l?oe(ke,function(){U(ae,ke)}):u?gt(new Error(ke+" already exists")):rt()})}function U(ae,ke){var X=Zo.createReadStream(ae.name),ye=Zo.createWriteStream(ke,{mode:ae.mode});X.on("error",gt),ye.on("error",gt),c?c(X,ye,ae):ye.on("open",function(){X.pipe(ye)}),ye.once("close",function(){Zo.chmod(ke,ae.mode,function(qe){if(qe)return gt(qe);m?Lpe.utimesMillis(ke,ae.atime,ae.mtime,function(fn){return fn?gt(fn):rt()}):rt()})})}function oe(ae,ke){Zo.unlink(ae,function(X){return X?gt(X):ke()})}function G(ae){var ke=ae.name.replace(o,s.replace("$","$$$$"));lt(ke,function(X){if(X)return pe(ae,ke);de(ae.name)})}function pe(ae,ke){Zo.mkdir(ke,ae.mode,function(X){if(X)return gt(X);Zo.chmod(ke,ae.mode,function(ye){if(ye)return gt(ye);de(ae.name)})})}function de(ae){Zo.readdir(ae,function(ke,X){return ke?gt(ke):(X.forEach(function(ye){k(Ux.join(ae,ye))}),rt())})}function te(ae){var ke=ae.replace(o,s);Zo.readlink(ae,function(X,ye){if(X)return gt(X);we(ye,ke)})}function we(ae,ke){p&&(ae=Ux.resolve(i,ae)),lt(ke,function(X){if(X)return Ue(ae,ke);Zo.readlink(ke,function(ye,qe){return ye?gt(ye):(p&&(qe=Ux.resolve(i,qe)),qe===ae?rt():oe(ke,function(){Ue(ae,ke)}))})})}function Ue(ae,ke){Zo.symlink(ae,ke,function(X){return X?gt(X):rt()})}function lt(ae,ke){Zo.lstat(ae,function(X){return X&&X.code==="ENOENT"?ke(!0):ke(!1)})}function gt(ae){if(!C&&n!==void 0)return C=!0,n(ae)}function rt(ae){if(ae||y--,g++,h===g&&y===0&&n!==void 0)return n(null)}}K6.exports=Upe});var IO=M((IRe,L6)=>{"use strict";var bO=require("path");function F6(r){return r=bO.normalize(bO.resolve(r)).split(bO.sep),r.length>0?r[0]:null}var jpe=/[<>:"|?*]/;function Wpe(r){let e=F6(r);return r=r.replace(e,""),jpe.test(r)}L6.exports={getRootPath:F6,invalidWin32Path:Wpe}});var j6=M((SRe,U6)=>{"use strict";var Vpe=Rn(),SO=require("path"),Bpe=IO().invalidWin32Path,qpe=parseInt("0777",8);function xO(r,e,t,n){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&Bpe(r)){let s=new Error(r+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||Vpe;i===void 0&&(i=qpe&~process.umask()),n||(n=null),t=t||function(){},r=SO.resolve(r),o.mkdir(r,i,s=>{if(!s)return n=n||r,t(null,n);switch(s.code){case"ENOENT":if(SO.dirname(r)===r)return t(s);xO(SO.dirname(r),e,(a,c)=>{a?t(a,c):xO(r,e,t,c)});break;default:o.stat(r,(a,c)=>{a||!c.isDirectory()?t(s,n):t(null,n)});break}})}U6.exports=xO});var V6=M((xRe,W6)=>{"use strict";var Jpe=Rn(),CO=require("path"),$pe=IO().invalidWin32Path,Hpe=parseInt("0777",8);function wO(r,e,t){(!e||typeof e!="object")&&(e={mode:e});let n=e.mode,i=e.fs||Jpe;if(process.platform==="win32"&&$pe(r)){let o=new Error(r+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}n===void 0&&(n=Hpe&~process.umask()),t||(t=null),r=CO.resolve(r);try{i.mkdirSync(r,n),t=t||r}catch(o){switch(o.code){case"ENOENT":if(CO.dirname(r)===r)throw o;t=wO(CO.dirname(r),e,t),wO(r,e,t);break;default:let s;try{s=i.statSync(r)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}W6.exports=wO});var es=M((CRe,B6)=>{"use strict";var Gpe=Eo().fromCallback,EO=Gpe(j6()),PO=V6();B6.exports={mkdirs:EO,mkdirsSync:PO,mkdirp:EO,mkdirpSync:PO,ensureDir:EO,ensureDirSync:PO}});var Yl=M((wRe,J6)=>{"use strict";var zpe=Eo().fromPromise,q6=vO();function Qpe(r){return q6.access(r).then(()=>!0).catch(()=>!1)}J6.exports={pathExists:zpe(Qpe),pathExistsSync:q6.existsSync}});var G6=M((ERe,H6)=>{"use strict";var Ype=Rn(),jx=require("path"),$6=yO(),Xpe=es(),Zpe=Yl().pathExists;function ede(r,e,t,n){typeof t=="function"&&!n?(n=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),n=n||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=jx.resolve(i,r),s=jx.resolve(i,e);if(o===s)return n(new Error("Source and destination must not be the same."));Ype.lstat(r,(a,c)=>{if(a)return n(a);let l=null;if(c.isDirectory()){let u=e.split(jx.sep);u.pop(),l=u.join(jx.sep)}else l=jx.dirname(e);Zpe(l,(u,p)=>{if(u)return n(u);if(p)return $6(r,e,t,n);Xpe.mkdirs(l,m=>{if(m)return n(m);$6(r,e,t,n)})})})}H6.exports=ede});var Q6=M((PRe,z6)=>{var tde=Eo().fromCallback;z6.exports={copy:tde(G6())}});var kO=M((kRe,Y6)=>{Y6.exports=function(r){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(r)}catch{return new Buffer(r)}return new Buffer(r)}});var tq=M((DRe,eq)=>{"use strict";var Jc=Rn(),Z6=64*1024,X6=kO()(Z6);function rde(r,e,t){let n=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if(Jc.existsSync(e))if(n)Jc.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=Jc.openSync(r,"r"),a=Jc.fstatSync(s),c=Jc.openSync(e,"w",a.mode),l=1,u=0;for(;l>0;)l=Jc.readSync(s,X6,0,Z6,u),Jc.writeSync(c,X6,0,l),u+=l;o&&Jc.futimesSync(c,a.atime,a.mtime),Jc.closeSync(s),Jc.closeSync(c)}eq.exports=rde});var oq=M((_Re,iq)=>{"use strict";var Km=Rn(),DO=require("path"),nde=tq(),rq=es();function nq(r,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let n=t.recursive&&!t.dereference?Km.lstatSync(r):Km.statSync(r),i=DO.dirname(e),o=Km.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(r)):typeof t.filter=="function"&&(s=t.filter(r,e)),n.isFile()&&s)o||rq.mkdirsSync(i),nde(r,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(n.isDirectory()&&s)Km.existsSync(e)||rq.mkdirsSync(e),Km.readdirSync(r).forEach(c=>{let l=t;l.recursive=!0,nq(DO.join(r,c),DO.join(e,c),l)});else if(t.recursive&&n.isSymbolicLink()&&s){let a=Km.readlinkSync(r);Km.symlinkSync(a,e)}}iq.exports=nq});var _O=M((TRe,sq)=>{sq.exports={copySync:oq()}});var hq=M((RRe,fq)=>{"use strict";var aq=Rn(),pq=require("path"),pr=require("assert"),Wx=process.platform==="win32";function dq(r){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{r[t]=r[t]||aq[t],t=t+"Sync",r[t]=r[t]||aq[t]}),r.maxBusyTries=r.maxBusyTries||3}function TO(r,e,t){let n=0;typeof e=="function"&&(t=e,e={}),pr(r,"rimraf: missing path"),pr.equal(typeof r,"string","rimraf: path should be a string"),pr.equal(typeof t,"function","rimraf: callback function required"),pr(e,"rimraf: invalid options argument provided"),pr.equal(typeof e,"object","rimraf: options should be object"),dq(e),cq(r,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&n<e.maxBusyTries){n++;let s=n*100;return setTimeout(()=>cq(r,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function cq(r,e,t){pr(r),pr(e),pr(typeof t=="function"),e.lstat(r,(n,i)=>{if(n&&n.code==="ENOENT")return t(null);if(n&&n.code==="EPERM"&&Wx)return lq(r,e,n,t);if(i&&i.isDirectory())return Lk(r,e,n,t);e.unlink(r,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return Wx?lq(r,e,o,t):Lk(r,e,o,t);if(o.code==="EISDIR")return Lk(r,e,o,t)}return t(o)})})}function lq(r,e,t,n){pr(r),pr(e),pr(typeof n=="function"),t&&pr(t instanceof Error),e.chmod(r,438,i=>{i?n(i.code==="ENOENT"?null:t):e.stat(r,(o,s)=>{o?n(o.code==="ENOENT"?null:t):s.isDirectory()?Lk(r,e,t,n):e.unlink(r,n)})})}function uq(r,e,t){let n;pr(r),pr(e),t&&pr(t instanceof Error);try{e.chmodSync(r,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{n=e.statSync(r)}catch(i){if(i.code==="ENOENT")return;throw t}n.isDirectory()?Uk(r,e,t):e.unlinkSync(r)}function Lk(r,e,t,n){pr(r),pr(e),t&&pr(t instanceof Error),pr(typeof n=="function"),e.rmdir(r,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?ide(r,e,n):i&&i.code==="ENOTDIR"?n(t):n(i)})}function ide(r,e,t){pr(r),pr(e),pr(typeof t=="function"),e.readdir(r,(n,i)=>{if(n)return t(n);let o=i.length,s;if(o===0)return e.rmdir(r,t);i.forEach(a=>{TO(pq.join(r,a),e,c=>{if(!s){if(c)return t(s=c);--o===0&&e.rmdir(r,t)}})})})}function mq(r,e){let t;e=e||{},dq(e),pr(r,"rimraf: missing path"),pr.equal(typeof r,"string","rimraf: path should be a string"),pr(e,"rimraf: missing options"),pr.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(r)}catch(n){if(n.code==="ENOENT")return;n.code==="EPERM"&&Wx&&uq(r,e,n)}try{t&&t.isDirectory()?Uk(r,e,null):e.unlinkSync(r)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return Wx?uq(r,e,n):Uk(r,e,n);if(n.code!=="EISDIR")throw n;Uk(r,e,n)}}function Uk(r,e,t){pr(r),pr(e),t&&pr(t instanceof Error);try{e.rmdirSync(r)}catch(n){if(n.code==="ENOTDIR")throw t;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")ode(r,e);else if(n.code!=="ENOENT")throw n}}function ode(r,e){pr(r),pr(e),e.readdirSync(r).forEach(i=>mq(pq.join(r,i),e));let t=Wx?100:1,n=0;do{let i=!0;try{let o=e.rmdirSync(r,e);return i=!1,o}finally{if(++n<t&&i)continue}}while(!0)}fq.exports=TO;TO.sync=mq});var Vx=M((ARe,vq)=>{"use strict";var sde=Eo().fromCallback,gq=hq();vq.exports={remove:sde(gq),removeSync:gq.sync}});var Sq=M((NRe,Iq)=>{var ev;try{ev=Rn()}catch{ev=require("fs")}function ade(r,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var n=e.fs||ev,i=!0;"throws"in e&&(i=e.throws),n.readFile(r,e,function(o,s){if(o)return t(o);s=bq(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(c){return i?(c.message=r+": "+c.message,t(c)):t(null,null)}t(null,a)})}function cde(r,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||ev,n=!0;"throws"in e&&(n=e.throws);try{var i=t.readFileSync(r,e);return i=bq(i),JSON.parse(i,e.reviver)}catch(o){if(n)throw o.message=r+": "+o.message,o;return null}}function yq(r,e){var t,n=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(n=e.EOL));var i=JSON.stringify(r,e?e.replacer:null,t);return i.replace(/\n/g,n)+n}function lde(r,e,t,n){n==null&&(n=t,t={}),t=t||{};var i=t.fs||ev,o="";try{o=yq(e,t)}catch(s){n&&n(s,null);return}i.writeFile(r,o,t,n)}function ude(r,e,t){t=t||{};var n=t.fs||ev,i=yq(e,t);return n.writeFileSync(r,i,t)}function bq(r){return Buffer.isBuffer(r)&&(r=r.toString("utf8")),r=r.replace(/^\uFEFF/,""),r}var pde={readFile:ade,readFileSync:cde,writeFile:lde,writeFileSync:ude};Iq.exports=pde});var Wk=M((MRe,Cq)=>{"use strict";var xq=Eo().fromCallback,jk=Sq();Cq.exports={readJson:xq(jk.readFile),readJsonSync:jk.readFileSync,writeJson:xq(jk.writeFile),writeJsonSync:jk.writeFileSync}});var Pq=M((ORe,Eq)=>{"use strict";var dde=require("path"),mde=es(),fde=Yl().pathExists,wq=Wk();function hde(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=dde.dirname(r);fde(i,(o,s)=>{if(o)return n(o);if(s)return wq.writeJson(r,e,t,n);mde.mkdirs(i,a=>{if(a)return n(a);wq.writeJson(r,e,t,n)})})}Eq.exports=hde});var Dq=M((KRe,kq)=>{"use strict";var gde=Rn(),vde=require("path"),yde=es(),bde=Wk();function Ide(r,e,t){let n=vde.dirname(r);gde.existsSync(n)||yde.mkdirsSync(n),bde.writeJsonSync(r,e,t)}kq.exports=Ide});var Tq=M((FRe,_q)=>{"use strict";var Sde=Eo().fromCallback,Zi=Wk();Zi.outputJson=Sde(Pq());Zi.outputJsonSync=Dq();Zi.outputJSON=Zi.outputJson;Zi.outputJSONSync=Zi.outputJsonSync;Zi.writeJSON=Zi.writeJson;Zi.writeJSONSync=Zi.writeJsonSync;Zi.readJSON=Zi.readJson;Zi.readJSONSync=Zi.readJsonSync;_q.exports=Zi});var Mq=M((LRe,Nq)=>{"use strict";var xde=Eo().fromCallback,$c=Rn(),Cde=yO(),Fm=require("path"),Vk=Vx().remove,wde=es().mkdirs;function RO(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=t.overwrite||t.clobber||!1;Pde(r,e,(s,a)=>{if(s)return n(s);if(a)return n(new Error(`Cannot move '${r}' to a subdirectory of itself, '${e}'.`));wde(Fm.dirname(e),c=>{if(c)return n(c);o()})});function o(){Fm.resolve(r)===Fm.resolve(e)?$c.access(r,n):i?$c.rename(r,e,s=>{if(!s)return n();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){Vk(e,a=>{if(a)return n(a);t.overwrite=!1,RO(r,e,t,n)});return}if(s.code==="EPERM"){setTimeout(()=>{Vk(e,a=>{if(a)return n(a);t.overwrite=!1,RO(r,e,t,n)})},200);return}if(s.code!=="EXDEV")return n(s);Rq(r,e,i,n)}):$c.link(r,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?Rq(r,e,i,n):n(s):$c.unlink(r,n))}}function Rq(r,e,t,n){$c.stat(r,(i,o)=>{if(i)return n(i);o.isDirectory()?Aq(r,e,t,n):Ede(r,e,t,n)})}function Ede(r,e,t,n){let i=t?"w":"wx",o=$c.createReadStream(r),s=$c.createWriteStream(e,{flags:i});o.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),$c.unlink(e,()=>{c.code==="EISDIR"||c.code==="EPERM"?Aq(r,e,t,n):n(c)})}),s.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),n(c)}),s.once("close",a),o.pipe(s);function a(){$c.unlink(r,n)}}function Aq(r,e,t,n){let i={overwrite:!1};t?Vk(e,s=>{if(s)return n(s);o()}):o();function o(){Cde(r,e,i,s=>{if(s)return n(s);Vk(r,n)})}}function Pde(r,e,t){$c.stat(r,(n,i)=>{if(n)return t(n);if(i.isDirectory()){let o=e.split(Fm.dirname(r)+Fm.sep)[1];if(o){let s=o.split(Fm.sep)[0];return s?t(null,r!==e&&e.indexOf(r)>-1&&s===Fm.basename(r)):t(null,!1)}return t(null,!1)}return t(null,!1)})}Nq.exports={move:xde(RO)}});var Lq=M((URe,Fq)=>{"use strict";var Po=Rn(),Lm=require("path"),kde=_O().copySync,AO=Vx().removeSync,Dde=es().mkdirsSync,_de=kO();function Kq(r,e,t){t=t||{};let n=t.overwrite||t.clobber||!1;if(r=Lm.resolve(r),e=Lm.resolve(e),r===e)return Po.accessSync(r);if(Ade(r,e))throw new Error(`Cannot move '${r}' into itself '${e}'.`);Dde(Lm.dirname(e)),i();function i(){if(n)try{return Po.renameSync(r,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return AO(e),t.overwrite=!1,Kq(r,e,t);if(o.code!=="EXDEV")throw o;return Oq(r,e,n)}else try{return Po.linkSync(r,e),Po.unlinkSync(r)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return Oq(r,e,n);throw o}}}function Oq(r,e,t){return Po.statSync(r).isDirectory()?Rde(r,e,t):Tde(r,e,t)}function Tde(r,e,t){let i=_de(65536),o=t?"w":"wx",s=Po.openSync(r,"r"),a=Po.fstatSync(s),c=Po.openSync(e,o,a.mode),l=1,u=0;for(;l>0;)l=Po.readSync(s,i,0,65536,u),Po.writeSync(c,i,0,l),u+=l;return Po.closeSync(s),Po.closeSync(c),Po.unlinkSync(r)}function Rde(r,e,t){let n={overwrite:!1};t&&AO(e),i();function i(){return kde(r,e,n),AO(r)}}function Ade(r,e){try{return Po.statSync(r).isDirectory()&&r!==e&&e.indexOf(r)>-1&&e.split(Lm.dirname(r)+Lm.sep)[1].split(Lm.sep)[0]===Lm.basename(r)}catch{return!1}}Fq.exports={moveSync:Kq}});var $q=M((jRe,Jq)=>{"use strict";var Nde=Eo().fromCallback,Wq=require("fs"),Vq=require("path"),Bq=es(),qq=Vx(),Uq=Nde(function(e,t){t=t||function(){},Wq.readdir(e,(n,i)=>{if(n)return Bq.mkdirs(e,t);i=i.map(s=>Vq.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();qq.remove(s,a=>{if(a)return t(a);o()})}})});function jq(r){let e;try{e=Wq.readdirSync(r)}catch{return Bq.mkdirsSync(r)}e.forEach(t=>{t=Vq.join(r,t),qq.removeSync(t)})}Jq.exports={emptyDirSync:jq,emptydirSync:jq,emptyDir:Uq,emptydir:Uq}});var Qq=M((WRe,zq)=>{"use strict";var Mde=Eo().fromCallback,Hq=require("path"),Bx=Rn(),Gq=es(),Ode=Yl().pathExists;function Kde(r,e){function t(){Bx.writeFile(r,"",n=>{if(n)return e(n);e()})}Bx.stat(r,(n,i)=>{if(!n&&i.isFile())return e();let o=Hq.dirname(r);Ode(o,(s,a)=>{if(s)return e(s);if(a)return t();Gq.mkdirs(o,c=>{if(c)return e(c);t()})})})}function Fde(r){let e;try{e=Bx.statSync(r)}catch{}if(e&&e.isFile())return;let t=Hq.dirname(r);Bx.existsSync(t)||Gq.mkdirsSync(t),Bx.writeFileSync(r,"")}zq.exports={createFile:Mde(Kde),createFileSync:Fde}});var tJ=M((VRe,eJ)=>{"use strict";var Lde=Eo().fromCallback,Xq=require("path"),Um=Rn(),Zq=es(),Yq=Yl().pathExists;function Ude(r,e,t){function n(i,o){Um.link(i,o,s=>{if(s)return t(s);t(null)})}Yq(e,(i,o)=>{if(i)return t(i);if(o)return t(null);Um.lstat(r,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let c=Xq.dirname(e);Yq(c,(l,u)=>{if(l)return t(l);if(u)return n(r,e);Zq.mkdirs(c,p=>{if(p)return t(p);n(r,e)})})})})}function jde(r,e,t){if(Um.existsSync(e))return;try{Um.lstatSync(r)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=Xq.dirname(e);return Um.existsSync(i)||Zq.mkdirsSync(i),Um.linkSync(r,e)}eJ.exports={createLink:Lde(Ude),createLinkSync:jde}});var nJ=M((BRe,rJ)=>{"use strict";var Up=require("path"),qx=Rn(),Wde=Yl().pathExists;function Vde(r,e,t){if(Up.isAbsolute(r))return qx.lstat(r,(n,i)=>n?(n.message=n.message.replace("lstat","ensureSymlink"),t(n)):t(null,{toCwd:r,toDst:r}));{let n=Up.dirname(e),i=Up.join(n,r);return Wde(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:r}):qx.lstat(r,(a,c)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:r,toDst:Up.relative(n,r)})))}}function Bde(r,e){let t;if(Up.isAbsolute(r)){if(t=qx.existsSync(r),!t)throw new Error("absolute srcpath does not exist");return{toCwd:r,toDst:r}}else{let n=Up.dirname(e),i=Up.join(n,r);if(t=qx.existsSync(i),t)return{toCwd:i,toDst:r};if(t=qx.existsSync(r),!t)throw new Error("relative srcpath does not exist");return{toCwd:r,toDst:Up.relative(n,r)}}}rJ.exports={symlinkPaths:Vde,symlinkPathsSync:Bde}});var sJ=M((qRe,oJ)=>{"use strict";var iJ=Rn();function qde(r,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);iJ.lstat(r,(n,i)=>{if(n)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function Jde(r,e){let t;if(e)return e;try{t=iJ.lstatSync(r)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}oJ.exports={symlinkType:qde,symlinkTypeSync:Jde}});var mJ=M((JRe,dJ)=>{"use strict";var $de=Eo().fromCallback,cJ=require("path"),tv=Rn(),lJ=es(),Hde=lJ.mkdirs,Gde=lJ.mkdirsSync,uJ=nJ(),zde=uJ.symlinkPaths,Qde=uJ.symlinkPathsSync,pJ=sJ(),Yde=pJ.symlinkType,Xde=pJ.symlinkTypeSync,aJ=Yl().pathExists;function Zde(r,e,t,n){n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,aJ(e,(i,o)=>{if(i)return n(i);if(o)return n(null);zde(r,e,(s,a)=>{if(s)return n(s);r=a.toDst,Yde(a.toCwd,t,(c,l)=>{if(c)return n(c);let u=cJ.dirname(e);aJ(u,(p,m)=>{if(p)return n(p);if(m)return tv.symlink(r,e,l,n);Hde(u,h=>{if(h)return n(h);tv.symlink(r,e,l,n)})})})})})}function eme(r,e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,tv.existsSync(e))return;let o=Qde(r,e);r=o.toDst,t=Xde(o.toCwd,t);let s=cJ.dirname(e);return tv.existsSync(s)||Gde(s),tv.symlinkSync(r,e,t)}dJ.exports={createSymlink:$de(Zde),createSymlinkSync:eme}});var hJ=M(($Re,fJ)=>{"use strict";var Bk=Qq(),qk=tJ(),Jk=mJ();fJ.exports={createFile:Bk.createFile,createFileSync:Bk.createFileSync,ensureFile:Bk.createFile,ensureFileSync:Bk.createFileSync,createLink:qk.createLink,createLinkSync:qk.createLinkSync,ensureLink:qk.createLink,ensureLinkSync:qk.createLinkSync,createSymlink:Jk.createSymlink,createSymlinkSync:Jk.createSymlinkSync,ensureSymlink:Jk.createSymlink,ensureSymlinkSync:Jk.createSymlinkSync}});var bJ=M((HRe,yJ)=>{"use strict";var tme=Eo().fromCallback,jm=Rn(),gJ=require("path"),vJ=es(),rme=Yl().pathExists;function nme(r,e,t,n){typeof t=="function"&&(n=t,t="utf8");let i=gJ.dirname(r);rme(i,(o,s)=>{if(o)return n(o);if(s)return jm.writeFile(r,e,t,n);vJ.mkdirs(i,a=>{if(a)return n(a);jm.writeFile(r,e,t,n)})})}function ime(r,e,t){let n=gJ.dirname(r);if(jm.existsSync(n))return jm.writeFileSync.apply(jm,arguments);vJ.mkdirsSync(n),jm.writeFileSync.apply(jm,arguments)}yJ.exports={outputFile:tme(nme),outputFileSync:ime}});var Hc=M((GRe,IJ)=>{"use strict";var $s=x6(),ts={};$s(ts,vO());$s(ts,Q6());$s(ts,_O());$s(ts,es());$s(ts,Vx());$s(ts,Tq());$s(ts,Mq());$s(ts,Lq());$s(ts,$q());$s(ts,hJ());$s(ts,bJ());$s(ts,Yl());IJ.exports=ts});var sD=M((nOe,$O)=>{"use strict";function gme(r){var e=void 0;typeof r=="string"?e=[r]:e=r.raw;for(var t="",n=0;n<e.length;n++)t+=e[n].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),n<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=n+1?void 0:arguments[n+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var c=a[1].length;o?o=Math.min(o,c):o=c}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof $O<"u"&&($O.exports=gme)});var L8=M((tje,F8)=>{F8.exports=function(r,e){for(var t=[],n=0;n<r.length;n++){var i=e(r[n],n);_me(i)?t.push.apply(t,i):t.push(i)}return t};var _me=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"}});var B8=M((rje,V8)=>{"use strict";V8.exports=j8;function j8(r,e,t){r instanceof RegExp&&(r=U8(r,t)),e instanceof RegExp&&(e=U8(e,t));var n=W8(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function U8(r,e){var t=e.match(r);return t?t[0]:null}j8.range=W8;function W8(r,e,t){var n,i,o,s,a,c=t.indexOf(r),l=t.indexOf(e,c+1),u=c;if(c>=0&&l>0){if(r===e)return[c,l];for(n=[],o=t.length;u>=0&&!a;)u==c?(n.push(u),c=t.indexOf(r,u+1)):n.length==1?a=[n.pop(),l]:(i=n.pop(),i<o&&(o=i,s=l),l=t.indexOf(e,u+1)),u=c<l&&c>=0?c:l;n.length&&(a=[o,s])}return a}});var Y8=M((nje,Q8)=>{var Tme=L8(),q8=B8();Q8.exports=Nme;var J8="\0SLASH"+Math.random()+"\0",$8="\0OPEN"+Math.random()+"\0",uK="\0CLOSE"+Math.random()+"\0",H8="\0COMMA"+Math.random()+"\0",G8="\0PERIOD"+Math.random()+"\0";function lK(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function Rme(r){return r.split("\\\\").join(J8).split("\\{").join($8).split("\\}").join(uK).split("\\,").join(H8).split("\\.").join(G8)}function Ame(r){return r.split(J8).join("\\").split($8).join("{").split(uK).join("}").split(H8).join(",").split(G8).join(".")}function z8(r){if(!r)return[""];var e=[],t=q8("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,o=t.post,s=n.split(",");s[s.length-1]+="{"+i+"}";var a=z8(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function Nme(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),_v(Rme(r),!0).map(Ame)):[]}function Mme(r){return"{"+r+"}"}function Ome(r){return/^-?0\d/.test(r)}function Kme(r,e){return r<=e}function Fme(r,e){return r>=e}function _v(r,e){var t=[],n=q8("{","}",r);if(!n||/\$$/.test(n.pre))return[r];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),s=i||o,a=n.body.indexOf(",")>=0;if(!s&&!a)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+uK+n.post,_v(r)):[r];var c;if(s)c=n.body.split(/\.\./);else if(c=z8(n.body),c.length===1&&(c=_v(c[0],!1).map(Mme),c.length===1)){var u=n.post.length?_v(n.post,!1):[""];return u.map(function(Ue){return n.pre+c[0]+Ue})}var l=n.pre,u=n.post.length?_v(n.post,!1):[""],p;if(s){var m=lK(c[0]),h=lK(c[1]),g=Math.max(c[0].length,c[1].length),y=c.length==3?Math.abs(lK(c[2])):1,C=Kme,k=h<m;k&&(y*=-1,C=Fme);var A=c.some(Ome);p=[];for(var T=m;C(T,h);T+=y){var U;if(o)U=String.fromCharCode(T),U==="\\"&&(U="");else if(U=String(T),A){var oe=g-U.length;if(oe>0){var G=new Array(oe+1).join("0");T<0?U="-"+G+U.slice(1):U=G+U}}p.push(U)}}else p=Tme(c,function(we){return _v(we,!1)});for(var pe=0;pe<p.length;pe++)for(var de=0;de<u.length;de++){var te=l+p[pe]+u[de];(!e||s||te)&&t.push(te)}return t}});var rC=M((ije,r7)=>{r7.exports=ns;ns.Minimatch=di;var tC=function(){try{return require("path")}catch{}}()||{sep:"/"};ns.sep=tC.sep;var mK=ns.GLOBSTAR=di.GLOBSTAR={},Lme=Y8(),X8={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},pK="[^/]",dK=pK+"*?",Ume="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",jme="(?:(?!(?:\\/|^)\\.).)*?",Z8=Wme("().*{}+?[]^$\\!");function Wme(r){return r.split("").reduce(function(e,t){return e[t]=!0,e},{})}var e7=/\/+/;ns.filter=Vme;function Vme(r,e){return e=e||{},function(t,n,i){return ns(t,r,e)}}function Gp(r,e){e=e||{};var t={};return Object.keys(r).forEach(function(n){t[n]=r[n]}),Object.keys(e).forEach(function(n){t[n]=e[n]}),t}ns.defaults=function(r){if(!r||typeof r!="object"||!Object.keys(r).length)return ns;var e=ns,t=function(i,o,s){return e(i,o,Gp(r,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,Gp(r,o))},t.Minimatch.defaults=function(i){return e.defaults(Gp(r,i)).Minimatch},t.filter=function(i,o){return e.filter(i,Gp(r,o))},t.defaults=function(i){return e.defaults(Gp(r,i))},t.makeRe=function(i,o){return e.makeRe(i,Gp(r,o))},t.braceExpand=function(i,o){return e.braceExpand(i,Gp(r,o))},t.match=function(n,i,o){return e.match(n,i,Gp(r,o))},t};di.defaults=function(r){return ns.defaults(r).Minimatch};function ns(r,e,t){return AD(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new di(e,t).match(r)}function di(r,e){if(!(this instanceof di))return new di(r,e);AD(r),e||(e={}),r=r.trim(),!e.allowWindowsEscape&&tC.sep!=="/"&&(r=r.split(tC.sep).join("/")),this.options=e,this.set=[],this.pattern=r,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}di.prototype.debug=function(){};di.prototype.make=Bme;function Bme(){var r=this.pattern,e=this.options;if(!e.nocomment&&r.charAt(0)==="#"){this.comment=!0;return}if(!r){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(n){return n.split(e7)}),this.debug(this.pattern,t),t=t.map(function(n,i,o){return n.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}di.prototype.parseNegate=qme;function qme(){var r=this.pattern,e=!1,t=this.options,n=0;if(!t.nonegate){for(var i=0,o=r.length;i<o&&r.charAt(i)==="!";i++)e=!e,n++;n&&(this.pattern=r.substr(n)),this.negate=e}}ns.braceExpand=function(r,e){return t7(r,e)};di.prototype.braceExpand=t7;function t7(r,e){return e||(this instanceof di?e=this.options:e={}),r=typeof r>"u"?this.pattern:r,AD(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:Lme(r)}var Jme=1024*64,AD=function(r){if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>Jme)throw new TypeError("pattern is too long")};di.prototype.parse=$me;var RD={};function $me(r,e){AD(r);var t=this.options;if(r==="**")if(t.noglobstar)r="*";else return mK;if(r==="")return"";var n="",i=!!t.nocase,o=!1,s=[],a=[],c,l=!1,u=-1,p=-1,m=r.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",h=this;function g(){if(c){switch(c){case"*":n+=dK,i=!0;break;case"?":n+=pK,i=!0;break;default:n+="\\"+c;break}h.debug("clearStateChar %j %j",c,n),c=!1}}for(var y=0,C=r.length,k;y<C&&(k=r.charAt(y));y++){if(this.debug("%s	%s %s %j",r,y,n,k),o&&Z8[k]){n+="\\"+k,o=!1;continue}switch(k){case"/":return!1;case"\\":g(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",r,y,n,k),l){this.debug("  in class"),k==="!"&&y===p+1&&(k="^"),n+=k;continue}h.debug("call clearStateChar %j",c),g(),c=k,t.noext&&g();continue;case"(":if(l){n+="(";continue}if(!c){n+="\\(";continue}s.push({type:c,start:y-1,reStart:n.length,open:X8[c].open,close:X8[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(l||!s.length){n+="\\)";continue}g(),i=!0;var A=s.pop();n+=A.close,A.type==="!"&&a.push(A),A.reEnd=n.length;continue;case"|":if(l||!s.length||o){n+="\\|",o=!1;continue}g(),n+="|";continue;case"[":if(g(),l){n+="\\"+k;continue}l=!0,p=y,u=n.length,n+=k;continue;case"]":if(y===p+1||!l){n+="\\"+k,o=!1;continue}var T=r.substring(p+1,y);try{RegExp("["+T+"]")}catch{var U=this.parse(T,RD);n=n.substr(0,u)+"\\["+U[0]+"\\]",i=i||U[1],l=!1;continue}i=!0,l=!1,n+=k;continue;default:g(),o?o=!1:Z8[k]&&!(k==="^"&&l)&&(n+="\\"),n+=k}}for(l&&(T=r.substr(p+1),U=this.parse(T,RD),n=n.substr(0,u)+"\\["+U[0],i=i||U[1]),A=s.pop();A;A=s.pop()){var oe=n.slice(A.reStart+A.open.length);this.debug("setting tail",n,A),oe=oe.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(fn,Pt,$r){return $r||($r="\\"),Pt+Pt+$r+"|"}),this.debug(`tail=%j
   %s`,oe,oe,A,n);var G=A.type==="*"?dK:A.type==="?"?pK:"\\"+A.type;i=!0,n=n.slice(0,A.reStart)+G+"\\("+oe}g(),o&&(n+="\\\\");var pe=!1;switch(n.charAt(0)){case"[":case".":case"(":pe=!0}for(var de=a.length-1;de>-1;de--){var te=a[de],we=n.slice(0,te.reStart),Ue=n.slice(te.reStart,te.reEnd-8),lt=n.slice(te.reEnd-8,te.reEnd),gt=n.slice(te.reEnd);lt+=gt;var rt=we.split("(").length-1,ae=gt;for(y=0;y<rt;y++)ae=ae.replace(/\)[+*?]?/,"");gt=ae;var ke="";gt===""&&e!==RD&&(ke="$");var X=we+Ue+gt+ke+lt;n=X}if(n!==""&&i&&(n="(?=.)"+n),pe&&(n=m+n),e===RD)return[n,i];if(!i)return Gme(r);var ye=t.nocase?"i":"";try{var qe=new RegExp("^"+n+"$",ye)}catch{return new RegExp("$.")}return qe._glob=r,qe._src=n,qe}ns.makeRe=function(r,e){return new di(r,e||{}).makeRe()};di.prototype.makeRe=Hme;function Hme(){if(this.regexp||this.regexp===!1)return this.regexp;var r=this.set;if(!r.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?dK:e.dot?Ume:jme,n=e.nocase?"i":"",i=r.map(function(o){return o.map(function(s){return s===mK?t:typeof s=="string"?zme(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch{this.regexp=!1}return this.regexp}ns.match=function(r,e,t){t=t||{};var n=new di(e,t);return r=r.filter(function(i){return n.match(i)}),n.options.nonull&&!r.length&&r.push(e),r};di.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var n=this.options;tC.sep!=="/"&&(e=e.split(tC.sep).join("/")),e=e.split(e7),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],c=e;n.matchBase&&a.length===1&&(c=[o]);var l=this.matchOne(c,a,t);if(l)return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate};di.prototype.matchOne=function(r,e,t){var n=this.options;this.debug("matchOne",{this:this,file:r,pattern:e}),this.debug("matchOne",r.length,e.length);for(var i=0,o=0,s=r.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var c=e[o],l=r[i];if(this.debug(e,c,l),c===!1)return!1;if(c===mK){this.debug("GLOBSTAR",[e,c,l]);var u=i,p=o+1;if(p===a){for(this.debug("** at the end");i<s;i++)if(r[i]==="."||r[i]===".."||!n.dot&&r[i].charAt(0)===".")return!1;return!0}for(;u<s;){var m=r[u];if(this.debug(`
globstar while`,r,u,e,p,m),this.matchOne(r.slice(u),e.slice(p),t))return this.debug("globstar found match!",u,s,m),!0;if(m==="."||m===".."||!n.dot&&m.charAt(0)==="."){this.debug("dot detected!",r,u,e,p);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,r,u,e,p),u===s))}var h;if(typeof c=="string"?(h=l===c,this.debug("string match",c,l,h)):(h=l.match(c),this.debug("pattern match",c,l,h)),!h)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&r[i]==="";throw new Error("wtf?")};function Gme(r){return r.replace(/\\(.)/g,"$1")}function zme(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var u7=M(hK=>{var Hm=require("path"),Qp=process.platform==="win32",zp=require("fs"),Zme=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function efe(){var r;if(Zme){var e=new Error;r=t}else r=n;return r;function t(i){i&&(e.message=i.message,i=e,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function tfe(r){return typeof r=="function"?r:efe()}var H2e=Hm.normalize;Qp?iu=/(.*?)(?:[\/\\]+|$)/g:iu=/(.*?)(?:[\/]+|$)/g;var iu;Qp?sC=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:sC=/^[\/]*/;var sC;hK.realpathSync=function(e,t){if(e=Hm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var n=e,i={},o={},s,a,c,l;u();function u(){var C=sC.exec(e);s=C[0].length,a=C[0],c=C[0],l="",Qp&&!o[c]&&(zp.lstatSync(c),o[c]=!0)}for(;s<e.length;){iu.lastIndex=s;var p=iu.exec(e);if(l=a,a+=p[0],c=l+p[1],s=iu.lastIndex,!(o[c]||t&&t[c]===c)){var m;if(t&&Object.prototype.hasOwnProperty.call(t,c))m=t[c];else{var h=zp.lstatSync(c);if(!h.isSymbolicLink()){o[c]=!0,t&&(t[c]=c);continue}var g=null;if(!Qp){var y=h.dev.toString(32)+":"+h.ino.toString(32);i.hasOwnProperty(y)&&(g=i[y])}g===null&&(zp.statSync(c),g=zp.readlinkSync(c)),m=Hm.resolve(l,g),t&&(t[c]=m),Qp||(i[y]=g)}e=Hm.resolve(m,e.slice(s)),u()}}return t&&(t[n]=e),e};hK.realpath=function(e,t,n){if(typeof n!="function"&&(n=tfe(t),t=null),e=Hm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(n.bind(null,null,t[e]));var i=e,o={},s={},a,c,l,u;p();function p(){var C=sC.exec(e);a=C[0].length,c=C[0],l=C[0],u="",Qp&&!s[l]?zp.lstat(l,function(k){if(k)return n(k);s[l]=!0,m()}):process.nextTick(m)}function m(){if(a>=e.length)return t&&(t[i]=e),n(null,e);iu.lastIndex=a;var C=iu.exec(e);return u=c,c+=C[0],l=u+C[1],a=iu.lastIndex,s[l]||t&&t[l]===l?process.nextTick(m):t&&Object.prototype.hasOwnProperty.call(t,l)?y(t[l]):zp.lstat(l,h)}function h(C,k){if(C)return n(C);if(!k.isSymbolicLink())return s[l]=!0,t&&(t[l]=l),process.nextTick(m);if(!Qp){var A=k.dev.toString(32)+":"+k.ino.toString(32);if(o.hasOwnProperty(A))return g(null,o[A],l)}zp.stat(l,function(T){if(T)return n(T);zp.readlink(l,function(U,oe){Qp||(o[A]=oe),g(U,oe)})})}function g(C,k,A){if(C)return n(C);var T=Hm.resolve(u,k);t&&(t[A]=T),y(T)}function y(C){e=Hm.resolve(C,e.slice(a)),p()}}});var bK=M((z2e,f7)=>{f7.exports=Yp;Yp.realpath=Yp;Yp.sync=yK;Yp.realpathSync=yK;Yp.monkeypatch=nfe;Yp.unmonkeypatch=ife;var Wv=require("fs"),gK=Wv.realpath,vK=Wv.realpathSync,rfe=process.version,p7=/^v[0-5]\./.test(rfe),d7=u7();function m7(r){return r&&r.syscall==="realpath"&&(r.code==="ELOOP"||r.code==="ENOMEM"||r.code==="ENAMETOOLONG")}function Yp(r,e,t){if(p7)return gK(r,e,t);typeof e=="function"&&(t=e,e=null),gK(r,e,function(n,i){m7(n)?d7.realpath(r,e,t):t(n,i)})}function yK(r,e){if(p7)return vK(r,e);try{return vK(r,e)}catch(t){if(m7(t))return d7.realpathSync(r,e);throw t}}function nfe(){Wv.realpath=Yp,Wv.realpathSync=yK}function ife(){Wv.realpath=gK,Wv.realpathSync=vK}});var h7=M((Q2e,IK)=>{typeof Object.create=="function"?IK.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:IK.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}});var g7=M((Y2e,xK)=>{try{if(SK=require("util"),typeof SK.inherits!="function")throw"";xK.exports=SK.inherits}catch{xK.exports=h7()}var SK});var KD=M((X2e,OD)=>{"use strict";function v7(r){return r.charAt(0)==="/"}function y7(r){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(r),n=t[1]||"",i=!!(n&&n.charAt(1)!==":");return!!(t[2]||i)}OD.exports=process.platform==="win32"?y7:v7;OD.exports.posix=v7;OD.exports.win32=y7});var wK=M(Xp=>{Xp.setopts=ufe;Xp.ownProp=b7;Xp.makeAbs=aC;Xp.finish=pfe;Xp.mark=dfe;Xp.isIgnored=S7;Xp.childrenIgnored=mfe;function b7(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var ofe=require("fs"),Vv=require("path"),sfe=rC(),I7=KD(),CK=sfe.Minimatch;function afe(r,e){return r.localeCompare(e,"en")}function cfe(r,e){r.ignore=e.ignore||[],Array.isArray(r.ignore)||(r.ignore=[r.ignore]),r.ignore.length&&(r.ignore=r.ignore.map(lfe))}function lfe(r){var e=null;if(r.slice(-3)==="/**"){var t=r.replace(/(\/\*\*)+$/,"");e=new CK(t,{dot:!0})}return{matcher:new CK(r,{dot:!0}),gmatcher:e}}function ufe(r,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}r.silent=!!t.silent,r.pattern=e,r.strict=t.strict!==!1,r.realpath=!!t.realpath,r.realpathCache=t.realpathCache||Object.create(null),r.follow=!!t.follow,r.dot=!!t.dot,r.mark=!!t.mark,r.nodir=!!t.nodir,r.nodir&&(r.mark=!0),r.sync=!!t.sync,r.nounique=!!t.nounique,r.nonull=!!t.nonull,r.nosort=!!t.nosort,r.nocase=!!t.nocase,r.stat=!!t.stat,r.noprocess=!!t.noprocess,r.absolute=!!t.absolute,r.fs=t.fs||ofe,r.maxLength=t.maxLength||1/0,r.cache=t.cache||Object.create(null),r.statCache=t.statCache||Object.create(null),r.symlinks=t.symlinks||Object.create(null),cfe(r,t),r.changedCwd=!1;var n=process.cwd();b7(t,"cwd")?(r.cwd=Vv.resolve(t.cwd),r.changedCwd=r.cwd!==n):r.cwd=n,r.root=t.root||Vv.resolve(r.cwd,"/"),r.root=Vv.resolve(r.root),process.platform==="win32"&&(r.root=r.root.replace(/\\/g,"/")),r.cwdAbs=I7(r.cwd)?r.cwd:aC(r,r.cwd),process.platform==="win32"&&(r.cwdAbs=r.cwdAbs.replace(/\\/g,"/")),r.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,r.minimatch=new CK(e,t),r.options=r.minimatch.options}function pfe(r){for(var e=r.nounique,t=e?[]:Object.create(null),n=0,i=r.matches.length;n<i;n++){var o=r.matches[n];if(!o||Object.keys(o).length===0){if(r.nonull){var s=r.minimatch.globSet[n];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(c){t[c]=!0})}}if(e||(t=Object.keys(t)),r.nosort||(t=t.sort(afe)),r.mark){for(var n=0;n<t.length;n++)t[n]=r._mark(t[n]);r.nodir&&(t=t.filter(function(c){var l=!/\/$/.test(c),u=r.cache[c]||r.cache[aC(r,c)];return l&&u&&(l=u!=="DIR"&&!Array.isArray(u)),l}))}r.ignore.length&&(t=t.filter(function(c){return!S7(r,c)})),r.found=t}function dfe(r,e){var t=aC(r,e),n=r.cache[t],i=e;if(n){var o=n==="DIR"||Array.isArray(n),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=aC(r,i);r.statCache[a]=r.statCache[t],r.cache[a]=r.cache[t]}}return i}function aC(r,e){var t=e;return e.charAt(0)==="/"?t=Vv.join(r.root,e):I7(e)||e===""?t=e:r.changedCwd?t=Vv.resolve(r.cwd,e):t=Vv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function S7(r,e){return r.ignore.length?r.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function mfe(r,e){return r.ignore.length?r.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var P7=M((nWe,E7)=>{E7.exports=w7;w7.GlobSync=Un;var ffe=bK(),x7=rC(),eWe=x7.Minimatch,tWe=kK().Glob,rWe=require("util"),EK=require("path"),C7=require("assert"),FD=KD(),Gm=wK(),hfe=Gm.setopts,PK=Gm.ownProp,gfe=Gm.childrenIgnored,vfe=Gm.isIgnored;function w7(r,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new Un(r,e).found}function Un(r,e){if(!r)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof Un))return new Un(r,e);if(hfe(this,r,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var n=0;n<t;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}Un.prototype._finish=function(){if(C7(this instanceof Un),this.realpath){var r=this;this.matches.forEach(function(e,t){var n=r.matches[t]=Object.create(null);for(var i in e)try{i=r._makeAbs(i);var o=ffe.realpathSync(i,r.realpathCache);n[o]=!0}catch(s){if(s.syscall==="stat")n[r._makeAbs(i)]=!0;else throw s}})}Gm.finish(this)};Un.prototype._process=function(r,e,t){C7(this instanceof Un);for(var n=0;typeof r[n]=="string";)n++;var i;switch(n){case r.length:this._processSimple(r.join("/"),e);return;case 0:i=null;break;default:i=r.slice(0,n).join("/");break}var o=r.slice(n),s;i===null?s=".":((FD(i)||FD(r.join("/")))&&(!i||!FD(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!gfe(this,s)){var c=o[0]===x7.GLOBSTAR;c?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};Un.prototype._processReaddir=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){for(var a=n[0],c=!!this.minimatch.negate,l=a._glob,u=this.dot||l.charAt(0)===".",p=[],m=0;m<s.length;m++){var h=s[m];if(h.charAt(0)!=="."||u){var g;c&&!r?g=!h.match(a):g=h.match(a),g&&p.push(h)}}var y=p.length;if(y!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var m=0;m<y;m++){var h=p[m];r&&(r.slice(-1)!=="/"?h=r+"/"+h:h=r+h),h.charAt(0)==="/"&&!this.nomount&&(h=EK.join(this.root,h)),this._emitMatch(i,h)}return}n.shift();for(var m=0;m<y;m++){var h=p[m],C;r?C=[r,h]:C=[h],this._process(C.concat(n),i,o)}}}};Un.prototype._emitMatch=function(r,e){if(!vfe(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0,this.stat&&this._stat(e)}}};Un.prototype._readdirInGlobStar=function(r){if(this.follow)return this._readdir(r,!1);var e,t,n;try{t=this.fs.lstatSync(r)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[r]=i,!i&&t&&!t.isDirectory()?this.cache[r]="FILE":e=this._readdir(r,!1),e};Un.prototype._readdir=function(r,e){var t;if(e&&!PK(this.symlinks,r))return this._readdirInGlobStar(r);if(PK(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(r,this.fs.readdirSync(r))}catch(i){return this._readdirError(r,i),null}};Un.prototype._readdirEntries=function(r,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var n=e[t];r==="/"?n=r+n:n=r+"/"+n,this.cache[n]=!0}return this.cache[r]=e,e};Un.prototype._readdirError=function(r,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(r);if(this.cache[t]="FILE",t===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=e.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:if(this.cache[this._makeAbs(r)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};Un.prototype._processGlobStar=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){var a=n.slice(1),c=r?[r]:[],l=c.concat(a);this._process(l,i,!1);var u=s.length,p=this.symlinks[t];if(!(p&&o))for(var m=0;m<u;m++){var h=s[m];if(!(h.charAt(0)==="."&&!this.dot)){var g=c.concat(s[m],a);this._process(g,i,!0);var y=c.concat(s[m],n);this._process(y,i,!0)}}}};Un.prototype._processSimple=function(r,e){var t=this._stat(r);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(r&&FD(r)&&!this.nomount){var n=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=EK.join(this.root,r):(r=EK.resolve(this.root,r),n&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r)}};Un.prototype._stat=function(r){var e=this._makeAbs(r),t=r.slice(-1)==="/";if(r.length>this.maxLength)return!1;if(!this.stat&&PK(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var n,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};Un.prototype._mark=function(r){return Gm.mark(this,r)};Un.prototype._makeAbs=function(r){return Gm.makeAbs(this,r)}});var DK=M((iWe,D7)=>{D7.exports=k7;function k7(r,e){if(r&&e)return k7(r)(e);if(typeof r!="function")throw new TypeError("need wrapper function");return Object.keys(r).forEach(function(n){t[n]=r[n]}),t;function t(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=r.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var TK=M((oWe,_K)=>{var _7=DK();_K.exports=_7(LD);_K.exports.strict=_7(T7);LD.proto=LD(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return LD(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return T7(this)},configurable:!0})});function LD(r){var e=function(){return e.called?e.value:(e.called=!0,e.value=r.apply(this,arguments))};return e.called=!1,e}function T7(r){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=r.apply(this,arguments)},t=r.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var A7=M((sWe,R7)=>{var yfe=DK(),cC=Object.create(null),bfe=TK();R7.exports=yfe(Ife);function Ife(r,e){return cC[r]?(cC[r].push(e),null):(cC[r]=[e],Sfe(r))}function Sfe(r){return bfe(function e(){var t=cC[r],n=t.length,i=xfe(arguments);try{for(var o=0;o<n;o++)t[o].apply(null,i)}finally{t.length>n?(t.splice(0,n),process.nextTick(function(){e.apply(null,i)})):delete cC[r]}})}function xfe(r){for(var e=r.length,t=[],n=0;n<e;n++)t[n]=r[n];return t}});var kK=M((lWe,M7)=>{M7.exports=zm;var Cfe=bK(),N7=rC(),aWe=N7.Minimatch,wfe=g7(),Efe=require("events").EventEmitter,RK=require("path"),AK=require("assert"),lC=KD(),MK=P7(),Qm=wK(),Pfe=Qm.setopts,NK=Qm.ownProp,OK=A7(),cWe=require("util"),kfe=Qm.childrenIgnored,Dfe=Qm.isIgnored,_fe=TK();function zm(r,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return MK(r,e)}return new yr(r,e,t)}zm.sync=MK;var Tfe=zm.GlobSync=MK.GlobSync;zm.glob=zm;function Rfe(r,e){if(e===null||typeof e!="object")return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r}zm.hasMagic=function(r,e){var t=Rfe({},e);t.noprocess=!0;var n=new yr(r,t),i=n.minimatch.set;if(!r)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};zm.Glob=yr;wfe(yr,Efe);function yr(r,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new Tfe(r,e)}if(!(this instanceof yr))return new yr(r,e,t);Pfe(this,r,e),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof t=="function"&&(t=_fe(t),this.on("error",t),this.on("end",function(c){t(null,c)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var o=!0,s=0;s<n;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}yr.prototype._finish=function(){if(AK(this instanceof yr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Qm.finish(this),this.emit("end",this.found)}};yr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var r=this.matches.length;if(r===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,n);function n(){--r===0&&e._finish()}};yr.prototype._realpathSet=function(r,e){var t=this.matches[r];if(!t)return e();var n=Object.keys(t),i=this,o=n.length;if(o===0)return e();var s=this.matches[r]=Object.create(null);n.forEach(function(a,c){a=i._makeAbs(a),Cfe.realpath(a,i.realpathCache,function(l,u){l?l.syscall==="stat"?s[a]=!0:i.emit("error",l):s[u]=!0,--o===0&&(i.matches[r]=s,e())})})};yr.prototype._mark=function(r){return Qm.mark(this,r)};yr.prototype._makeAbs=function(r){return Qm.makeAbs(this,r)};yr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};yr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};yr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var r=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<r.length;e++){var t=r[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<n.length;e++){var i=n[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};yr.prototype._process=function(r,e,t,n){if(AK(this instanceof yr),AK(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([r,e,t,n]);return}for(var i=0;typeof r[i]=="string";)i++;var o;switch(i){case r.length:this._processSimple(r.join("/"),e,n);return;case 0:o=null;break;default:o=r.slice(0,i).join("/");break}var s=r.slice(i),a;o===null?a=".":((lC(o)||lC(r.join("/")))&&(!o||!lC(o))&&(o="/"+o),a=o);var c=this._makeAbs(a);if(kfe(this,a))return n();var l=s[0]===N7.GLOBSTAR;l?this._processGlobStar(o,a,c,s,e,t,n):this._processReaddir(o,a,c,s,e,t,n)}};yr.prototype._processReaddir=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){return a._processReaddir2(r,e,t,n,i,o,l,s)})};yr.prototype._processReaddir2=function(r,e,t,n,i,o,s,a){if(!s)return a();for(var c=n[0],l=!!this.minimatch.negate,u=c._glob,p=this.dot||u.charAt(0)===".",m=[],h=0;h<s.length;h++){var g=s[h];if(g.charAt(0)!=="."||p){var y;l&&!r?y=!g.match(c):y=g.match(c),y&&m.push(g)}}var C=m.length;if(C===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var h=0;h<C;h++){var g=m[h];r&&(r!=="/"?g=r+"/"+g:g=r+g),g.charAt(0)==="/"&&!this.nomount&&(g=RK.join(this.root,g)),this._emitMatch(i,g)}return a()}n.shift();for(var h=0;h<C;h++){var g=m[h],k;r&&(r!=="/"?g=r+"/"+g:g=r+g),this._process([g].concat(n),i,o,a)}a()};yr.prototype._emitMatch=function(r,e){if(!this.aborted&&!Dfe(this,e)){if(this.paused){this._emitQueue.push([r,e]);return}var t=lC(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};yr.prototype._readdirInGlobStar=function(r,e){if(this.aborted)return;if(this.follow)return this._readdir(r,!1,e);var t="lstat\0"+r,n=this,i=OK(t,o);i&&n.fs.lstat(r,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var c=a&&a.isSymbolicLink();n.symlinks[r]=c,!c&&a&&!a.isDirectory()?(n.cache[r]="FILE",e()):n._readdir(r,!1,e)}};yr.prototype._readdir=function(r,e,t){if(!this.aborted&&(t=OK("readdir\0"+r+"\0"+e,t),!!t)){if(e&&!NK(this.symlinks,r))return this._readdirInGlobStar(r,t);if(NK(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return t();if(Array.isArray(n))return t(null,n)}var i=this;i.fs.readdir(r,Afe(this,r,t))}};function Afe(r,e,t){return function(n,i){n?r._readdirError(e,n,t):r._readdirEntries(e,i,t)}}yr.prototype._readdirEntries=function(r,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var i=e[n];r==="/"?i=r+i:i=r+"/"+i,this.cache[i]=!0}return this.cache[r]=e,t(null,e)}};yr.prototype._readdirError=function(r,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(r);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:this.cache[this._makeAbs(r)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};yr.prototype._processGlobStar=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){a._processGlobStar2(r,e,t,n,i,o,l,s)})};yr.prototype._processGlobStar2=function(r,e,t,n,i,o,s,a){if(!s)return a();var c=n.slice(1),l=r?[r]:[],u=l.concat(c);this._process(u,i,!1,a);var p=this.symlinks[t],m=s.length;if(p&&o)return a();for(var h=0;h<m;h++){var g=s[h];if(!(g.charAt(0)==="."&&!this.dot)){var y=l.concat(s[h],c);this._process(y,i,!0,a);var C=l.concat(s[h],n);this._process(C,i,!0,a)}}a()};yr.prototype._processSimple=function(r,e,t){var n=this;this._stat(r,function(i,o){n._processSimple2(r,e,i,o,t)})};yr.prototype._processSimple2=function(r,e,t,n,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!n)return i();if(r&&lC(r)&&!this.nomount){var o=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=RK.join(this.root,r):(r=RK.resolve(this.root,r),o&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r),i()};yr.prototype._stat=function(r,e){var t=this._makeAbs(r),n=r.slice(-1)==="/";if(r.length>this.maxLength)return e();if(!this.stat&&NK(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return e(null,i);if(n&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?e():e(null,a,s)}var c=this,l=OK("stat\0"+t,u);l&&c.fs.lstat(t,l);function u(p,m){if(m&&m.isSymbolicLink())return c.fs.stat(t,function(h,g){h?c._stat2(r,t,null,m,e):c._stat2(r,t,h,g,e)});c._stat2(r,t,p,m,e)}};yr.prototype._stat2=function(r,e,t,n,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=r.slice(-1)==="/";if(this.statCache[e]=n,e.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var s=!0;return n&&(s=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,n)}});var F7=M((uWe,K7)=>{"use strict";var O7=process.platform==="win32",Nfe=O7?/[^:]\\$/:/.\/$/;K7.exports=function(){var r;return O7?r=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":r=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",Nfe.test(r)&&(r=r.slice(0,-1)),r}});var Y7=M((pWe,ou)=>{var _o=require("fs"),KK=require("path"),L7=require("crypto"),Mfe=F7(),uC=require("constants"),FK=Mfe(),U7="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",LK=/XXXXXX/,W7=3,V7=uC.O_CREAT|uC.O_EXCL|uC.O_RDWR,B7=448,q7=384,Bv=[],J7=!1,UK=!1;function j7(r){var e=[],t=null;try{t=L7.randomBytes(r)}catch{t=L7.pseudoRandomBytes(r)}for(var n=0;n<r;n++)e.push(U7[t[n]%U7.length]);return e.join("")}function Ofe(r){return typeof r>"u"}function qv(r,e){if(typeof r=="function"){var t=r;r=e||{},e=t}else typeof r>"u"&&(r={});return[r,e]}function $7(r){if(r.name)return KK.join(r.dir||FK,r.name);if(r.template)return r.template.replace(LK,j7(6));var e=[r.prefix||"tmp-",process.pid,j7(12),r.postfix||""].join("");return KK.join(r.dir||FK,e)}function jK(r,e){var t=qv(r,e),n=t[0],i=t[1],o=n.tries||W7;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(LK))return i(new Error("Invalid template provided"));(function s(){var a=$7(n);_o.stat(a,function(c){if(!c)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function WK(r){var e=qv(r),t=e[0],n=t.tries||W7;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(LK))throw new Error("Invalid template provided");do{var i=$7(t);try{_o.statSync(i)}catch{return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function Kfe(r,e){var t=qv(r,e),n=t[0],i=t[1];n.postfix=Ofe(n.postfix)?".tmp":n.postfix,jK(n,function(s,a){if(s)return i(s);_o.open(a,V7,n.mode||q7,function(l,u){if(l)return i(l);i(null,a,u,H7(a,u,n))})})}function Ffe(r){var e=qv(r),t=e[0];t.postfix=t.postfix||".tmp";var n=WK(t),i=_o.openSync(n,V7,t.mode||q7);return{name:n,fd:i,removeCallback:H7(n,i,t)}}function Lfe(r){var e=[r];do{for(var t=e.pop(),n=!1,i=_o.readdirSync(t),o=0,s=i.length;o<s;o++){var a=KK.join(t,i[o]),c=_o.lstatSync(a);c.isDirectory()?(n||(n=!0,e.push(t)),e.push(a)):_o.unlinkSync(a)}n||_o.rmdirSync(t)}while(e.length!==0)}function Ufe(r,e){var t=qv(r,e),n=t[0],i=t[1];jK(n,function(s,a){if(s)return i(s);_o.mkdir(a,n.mode||B7,function(l){if(l)return i(l);i(null,a,G7(a,n))})})}function jfe(r){var e=qv(r),t=e[0],n=WK(t);return _o.mkdirSync(n,t.mode||B7),{name:n,removeCallback:G7(n,t)}}function H7(r,e,t){var n=z7(function(o){try{_o.closeSync(o[0])}catch(s){if(s.errno!=-uC.EBADF&&s.errno!=-uC.ENOENT)throw s}_o.unlinkSync(o[1])},[e,r]);return t.keep||Bv.unshift(n),n}function G7(r,e){var t=e.unsafeCleanup?Lfe:_o.rmdirSync.bind(_o),n=z7(t,r);return e.keep||Bv.unshift(n),n}function z7(r,e){var t=!1;return function n(){if(!t){var i=Bv.indexOf(n);i>=0&&Bv.splice(i,1),t=!0,r(e)}}}function Q7(){if(!(UK&&!J7))for(var r=0,e=Bv.length;r<e;r++)try{Bv[r].call(null)}catch{}}function Wfe(){J7=!0}var UD=process.versions.node.split(".").map(function(r){return parseInt(r,10)});UD[0]===0&&(UD[1]<9||UD[1]===9&&UD[2]<5)&&process.addListener("uncaughtException",function(e){throw UK=!0,Q7(),e});process.addListener("exit",function(e){e&&(UK=!0),Q7()});ou.exports.tmpdir=FK;ou.exports.dir=Ufe;ou.exports.dirSync=jfe;ou.exports.file=Kfe;ou.exports.fileSync=Ffe;ou.exports.tmpName=jK;ou.exports.tmpNameSync=WK;ou.exports.setGracefulCleanup=Wfe});var Z7=M((Ym,X7)=>{var pC=require("node-fetch"),Vfe=pC.default||pC,jD=function(r,e){return/^\/\//.test(r)&&(r="https:"+r),Vfe.call(this,r,e)};jD.ponyfill=!0;X7.exports=Ym=jD;Ym.fetch=jD;Ym.Headers=pC.Headers;Ym.Request=pC.Request;Ym.Response=pC.Response;Ym.default=jD});var j$=M((d8e,U$)=>{var rhe=require("crypto");U$.exports=function(){return rhe.randomBytes(16)}});var B$=M((m8e,V$)=>{var W$=[];for(SC=0;SC<256;++SC)W$[SC]=(SC+256).toString(16).substr(1);var SC;function nhe(r,e){var t=e||0,n=W$;return[n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]]].join("")}V$.exports=nhe});var Ro=M((f8e,q$)=>{var ihe=j$(),ohe=B$();function she(r,e,t){var n=e&&t||0;typeof r=="string"&&(e=r==="binary"?new Array(16):null,r=null),r=r||{};var i=r.random||(r.rng||ihe)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[n+o]=i[o];return e||ohe(i)}q$.exports=she});var Q$=M((h$e,z$)=>{"use strict";function df(r){if(!(this instanceof df))return new df(r);r=r||{},this.concurrency=r.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=lhe.bind(this)}var che=["push","unshift","splice"];che.forEach(function(r){df.prototype[r]=function(){var e=Array.prototype[r].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(df.prototype,"length",{get:function(){return this.pending+this.jobs.length}});df.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var r=this.jobs.shift();this.pending++,r(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};df.prototype.onDone=function(r){typeof r=="function"&&(this.cbs.push(r),this._run())};function lhe(){this.pending--,this._run()}z$.exports=df});var mf=M((g$e,Y$)=>{"use strict";Y$.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var m5=M((v$e,d5)=>{var t5=require("fs"),pu=require("path"),r5=require("os"),n5=typeof __webpack_require__=="function"?__non_webpack_require__:require,uhe=process.config&&process.config.variables||{},phe=!!process.env.PREBUILDS_ONLY,X$=process.versions.modules,nF=fhe()?"electron":mhe()?"node-webkit":"node",iF=process.env.npm_config_arch||r5.arch(),oF=process.env.npm_config_platform||r5.platform(),i5=process.env.LIBC||(hhe(oF)?"musl":"glibc"),sF=process.env.ARM_VERSION||(iF==="arm64"?"8":uhe.arm_version)||"",o5=(process.versions.uv||"").split(".")[0];d5.exports=sl;function sl(r){return n5(sl.resolve(r))}sl.resolve=sl.path=function(r){r=pu.resolve(r||".");try{var e=n5(pu.join(r,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(r=process.env[e+"_PREBUILD"])}catch{}if(!phe){var t=Z$(pu.join(r,"build/Release"),e5);if(t)return t;var n=Z$(pu.join(r,"build/Debug"),e5);if(n)return n}var i=a(r);if(i)return i;var o=a(pu.dirname(process.execPath));if(o)return o;var s=["platform="+oF,"arch="+iF,"runtime="+nF,"abi="+X$,"uv="+o5,sF?"armv="+sF:"","libc="+i5,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+r+`
`);function a(c){var l=aF(pu.join(c,"prebuilds")).map(s5),u=l.filter(a5(oF,iF)).sort(c5)[0];if(u){var p=pu.join(c,"prebuilds",u.name),m=aF(p).map(l5),h=m.filter(u5(nF,X$)),g=h.sort(p5(nF))[0];if(g)return pu.join(p,g.file)}}};function aF(r){try{return t5.readdirSync(r)}catch{return[]}}function Z$(r,e){var t=aF(r).filter(e);return t[0]&&pu.join(r,t[0])}function e5(r){return/\.node$/.test(r)}function s5(r){var e=r.split("-");if(e.length===2){var t=e[0],n=e[1].split("+");if(t&&n.length&&n.every(Boolean))return{name:r,platform:t,architectures:n}}}function a5(r,e){return function(t){return t==null||t.platform!==r?!1:t.architectures.includes(e)}}function c5(r,e){return r.architectures.length-e.architectures.length}function l5(r){var e=r.split("."),t=e.pop(),n={file:r,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")n.runtime=o;else if(o==="napi")n.napi=!0;else if(o.slice(0,3)==="abi")n.abi=o.slice(3);else if(o.slice(0,2)==="uv")n.uv=o.slice(2);else if(o.slice(0,4)==="armv")n.armv=o.slice(4);else if(o==="glibc"||o==="musl")n.libc=o;else continue;n.specificity++}return n}}function u5(r,e){return function(t){return!(t==null||t.runtime!==r&&!dhe(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==o5||t.armv&&t.armv!==sF||t.libc&&t.libc!==i5)}}function dhe(r){return r.runtime==="node"&&r.napi}function p5(r){return function(e,t){return e.runtime!==t.runtime?e.runtime===r?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function mhe(){return!!(process.versions&&process.versions.nw)}function fhe(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function hhe(r){return r==="linux"&&t5.existsSync("/etc/alpine-release")}sl.parseTags=l5;sl.matchTags=u5;sl.compareTags=p5;sl.parseTuple=s5;sl.matchTuple=a5;sl.compareTuples=c5});var lF=M((y$e,cF)=>{typeof process.addon=="function"?cF.exports=process.addon.bind(process):cF.exports=m5()});var h5=M((b$e,f5)=>{"use strict";var ghe=(r,e,t,n,i)=>{for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]},vhe=(r,e)=>{let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]};f5.exports={mask:ghe,unmask:vhe}});var g5=M((I$e,uF)=>{"use strict";try{uF.exports=lF()(__dirname)}catch{uF.exports=h5()}});var f_=M((S$e,pF)=>{"use strict";var{EMPTY_BUFFER:yhe}=mf();function v5(r,e){if(r.length===0)return yhe;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e);for(var n=0,i=0;i<r.length;i++){let o=r[i];o.copy(t,n),n+=o.length}return t}function y5(r,e,t,n,i){for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]}function b5(r,e){let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]}function I5(r){return r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function m_(r){if(m_.readOnly=!0,Buffer.isBuffer(r))return r;var e;return r instanceof ArrayBuffer?e=Buffer.from(r):ArrayBuffer.isView(r)?e=bhe(r):(e=Buffer.from(r),m_.readOnly=!1),e}function bhe(r){let e=Buffer.from(r.buffer);return r.byteLength!==r.buffer.byteLength?e.slice(r.byteOffset,r.byteOffset+r.byteLength):e}try{let r=g5(),e=r.BufferUtil||r;pF.exports={concat:v5,mask(t,n,i,o,s){s<48?y5(t,n,i,o,s):e.mask(t,n,i,o,s)},toArrayBuffer:I5,toBuffer:m_,unmask(t,n){t.length<32?b5(t,n):e.unmask(t,n)}}}catch{pF.exports={concat:v5,mask:y5,toArrayBuffer:I5,toBuffer:m_,unmask:b5}}});var EC=M((x$e,E5)=>{"use strict";var Ihe=Q$(),wC=require("zlib"),S5=f_(),{kStatusCode:x5,NOOP:She}=mf(),xhe=Buffer.from([0,0,255,255]),Che=Buffer.from([0]),g_=Symbol("permessage-deflate"),du=Symbol("total-length"),C5=Symbol("callback"),ld=Symbol("buffers"),dF=Symbol("error"),h_,mF=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!h_){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;h_=new Ihe({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,n=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{var i=t[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=i})}),e}decompress(e,t,n){h_.push(i=>{this._decompress(e,t,(o,s)=>{i(),n(o,s)})})}compress(e,t,n){h_.push(i=>{this._compress(e,t,(o,s)=>{i(),n(o,s)})})}_decompress(e,t,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?wC.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=wC.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[g_]=this,this._inflate[du]=0,this._inflate[ld]=[],this._inflate.on("error",Ehe),this._inflate.on("data",w5)}this._inflate[C5]=n,this._inflate.write(e),t&&this._inflate.write(xhe),this._inflate.flush(()=>{let o=this._inflate[dF];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=S5.concat(this._inflate[ld],this._inflate[du]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[du]=0,this._inflate[ld]=[]),n(null,s)})}_compress(e,t,n){if(!e||e.length===0){process.nextTick(n,null,Che);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?wC.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=wC.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[du]=0,this._deflate[ld]=[],this._deflate.on("error",She),this._deflate.on("data",whe)}this._deflate.write(e),this._deflate.flush(wC.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=S5.concat(this._deflate[ld],this._deflate[du]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[du]=0,this._deflate[ld]=[]),n(null,o)}})}};E5.exports=mF;function whe(r){this[ld].push(r),this[du]+=r.length}function w5(r){if(this[du]+=r.length,this[g_]._maxPayload<1||this[du]<=this[g_]._maxPayload){this[ld].push(r);return}this[dF]=new RangeError("Max payload size exceeded"),this[dF][x5]=1009,this.removeListener("data",w5),this.reset()}function Ehe(r){this[g_]._inflate=null,r[x5]=1007,this[C5](r)}});var k5=M((C$e,P5)=>{"use strict";var wy=class{constructor(e,t){this.target=t,this.type=e}},fF=class extends wy{constructor(e,t){super("message",t),this.data=e}},hF=class extends wy{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}},gF=class extends wy{constructor(e){super("open",e)}},vF=class extends wy{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},Phe={addEventListener(r,e){if(typeof e!="function")return;function t(s){e.call(this,new fF(s,this))}function n(s,a){e.call(this,new hF(s,a,this))}function i(s){e.call(this,new vF(s,this))}function o(){e.call(this,new gF(this))}r==="message"?(t._listener=e,this.on(r,t)):r==="close"?(n._listener=e,this.on(r,n)):r==="error"?(i._listener=e,this.on(r,i)):r==="open"?(o._listener=e,this.on(r,o)):this.on(r,e)},removeEventListener(r,e){let t=this.listeners(r);for(var n=0;n<t.length;n++)(t[n]===e||t[n]._listener===e)&&this.removeListener(r,t[n])}};P5.exports=Phe});var yF=M((w$e,D5)=>{"use strict";var PC=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function al(r,e,t){Object.prototype.hasOwnProperty.call(r,e)?r[e].push(t):r[e]=[t]}function khe(r){let e={};if(r===void 0||r==="")return e;for(var t={},n=!1,i=!1,o=!1,s,a,c=-1,l=-1,u=0;u<r.length;u++){let h=r.charCodeAt(u);if(s===void 0)if(l===-1&&PC[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);let g=r.slice(c,l);h===44?(al(e,g,t),t={}):s=g,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(l===-1&&PC[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u),al(t,r.slice(c,l),!0),h===44&&(al(e,s,t),t={},s=void 0),c=l=-1}else if(h===61&&c!==-1&&l===-1)a=r.slice(c,u),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(PC[h]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1?c=u:n||(n=!0),i=!1}else if(o)if(PC[h]===1)c===-1&&(c=u);else if(h===34&&c!==-1)o=!1,l=u;else if(h===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(h===34&&r.charCodeAt(u-1)===61)o=!0;else if(l===-1&&PC[h]===1)c===-1&&(c=u);else if(c!==-1&&(h===32||h===9))l===-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);var p=r.slice(c,l);n&&(p=p.replace(/\\/g,""),n=!1),al(t,a,p),h===44&&(al(e,s,t),t={},s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(c===-1||o)throw new SyntaxError("Unexpected end of input");l===-1&&(l=u);let m=r.slice(c,l);return s===void 0?al(e,m,{}):(a===void 0?al(t,m,!0):n?al(t,a,m.replace(/\\/g,"")):al(t,a,m),al(e,s,t)),e}function Dhe(r){return Object.keys(r).map(e=>{var t=r[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(i=>{var o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}D5.exports={format:Dhe,parse:khe}});var T5=M((E$e,_5)=>{"use strict";function _he(r){let e=r.length,t=0;for(;t<e;)if(!(r[t]&128))t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}_5.exports=_he});var R5=M((P$e,bF)=>{"use strict";try{bF.exports=lF()(__dirname)}catch{bF.exports=T5()}});var IF=M(v_=>{"use strict";try{let r=R5();v_.isValidUTF8=typeof r=="object"?r.Validation.isValidUTF8:r}catch{v_.isValidUTF8=()=>!0}v_.isValidStatusCode=r=>r>=1e3&&r<=1013&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999});var wF=M((D$e,F5)=>{"use strict";var{Writable:The}=require("stream"),A5=EC(),{BINARY_TYPES:Rhe,EMPTY_BUFFER:Ahe,kStatusCode:Nhe,kWebSocket:Mhe}=mf(),{concat:SF,toArrayBuffer:Ohe,unmask:Khe}=f_(),{isValidStatusCode:Fhe,isValidUTF8:N5}=IF(),kC=0,M5=1,O5=2,K5=3,xF=4,Lhe=5,CF=class extends The{constructor(e,t,n){super(),this._binaryType=e||Rhe[0],this[Mhe]=void 0,this._extensions=t||{},this._maxPayload=n|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=kC,this._loop=!1}_write(e,t,n){if(this._opcode===8&&this._state==kC)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=n.slice(e),n.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case kC:t=this.getInfo();break;case M5:t=this.getPayloadLength16();break;case O5:t=this.getPayloadLength64();break;case K5:this.getMask();break;case xF:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,hi(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[A5.extensionName])return this._loop=!1,hi(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,hi(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,hi(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,hi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,hi(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,hi(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,hi(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,hi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=M5;else if(this._payloadLength===127)this._state=O5;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,hi(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,hi(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=K5:this._state=xF}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=xF}getData(e){var t=Ahe;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&Khe(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=Lhe,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[A5.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(hi(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=SF(n,t):this._binaryType==="arraybuffer"?e=Ohe(SF(n,t)):e=n,this.emit("message",e)}else{let i=SF(n,t);if(!N5(i))return this._loop=!1,hi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=kC}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return hi(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!Fhe(t))return hi(RangeError,`invalid status code ${t}`,!0,1002);let n=e.slice(2);if(!N5(n))return hi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=kC}};F5.exports=CF;function hi(r,e,t,n){let i=new r(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,hi),i[Nhe]=n,i}});var PF=M((_$e,j5)=>{"use strict";var{randomBytes:Uhe}=require("crypto"),L5=EC(),{EMPTY_BUFFER:jhe}=mf(),{isValidStatusCode:Whe}=IF(),{mask:U5,toBuffer:mu}=f_(),EF=class r{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let n=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(n?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=Uhe(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],n?(U5(e,a,s,i,e.length),[s]):(U5(e,a,e,0,e.length),[s,e])}close(e,t,n,i){var o;if(e===void 0)o=jhe;else{if(typeof e!="number"||!Whe(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,n,i]):this.doClose(o,n,i)}doClose(e,t,n){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){let i=mu(e);this._deflating?this.enqueue([this.doPing,i,t,mu.readOnly,n]):this.doPing(i,t,mu.readOnly,n)}doPing(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),i)}pong(e,t,n){let i=mu(e);this._deflating?this.enqueue([this.doPong,i,t,mu.readOnly,n]):this.doPong(i,t,mu.readOnly,n)}doPong(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),i)}send(e,t,n){let i=mu(e),o=this._extensions[L5.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let c={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:mu.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,c,n]):this.dispatch(i,this._compress,c,n)}else this.sendFrame(r.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:mu.readOnly}),n)}dispatch(e,t,n,i){if(!t){this.sendFrame(r.frame(e,n),i);return}let o=this._extensions[L5.extensionName];this._deflating=!0,o.compress(e,n.fin,(s,a)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(r.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};j5.exports=EF});var _F=M((T$e,Y5)=>{"use strict";var Vhe=require("events"),W5=require("crypto"),Bhe=require("https"),qhe=require("http"),Jhe=require("net"),$he=require("tls"),Ey=require("url"),ud=EC(),J5=k5(),V5=yF(),Hhe=wF(),Ghe=PF(),{BINARY_TYPES:B5,EMPTY_BUFFER:kF,GUID:zhe,kStatusCode:Qhe,kWebSocket:Ao,NOOP:$5}=mf(),y_=["CONNECTING","OPEN","CLOSING","CLOSED"],DF=[8,13],Yhe=30*1e3,No=class r extends Vhe{constructor(e,t,n){super(),this.readyState=r.CONNECTING,this.protocol="",this._binaryType=B5[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(n=t,t=void 0),H5(this,e,t,n)):this._isServer=!0}get CONNECTING(){return r.CONNECTING}get CLOSING(){return r.CLOSING}get CLOSED(){return r.CLOSED}get OPEN(){return r.OPEN}get binaryType(){return this._binaryType}set binaryType(e){B5.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){let i=new Hhe(this._binaryType,this._extensions,n);this._sender=new Ghe(e,this._extensions),this._receiver=i,this._socket=e,i[Ao]=this,e[Ao]=this,i.on("conclude",ege),i.on("drain",tge),i.on("error",rge),i.on("message",nge),i.on("ping",ige),i.on("pong",oge),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",G5),e.on("data",b_),e.on("end",z5),e.on("error",Q5),this.readyState=r.OPEN,this.emit("open")}emitClose(){if(this.readyState=r.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ud.extensionName]&&this._extensions[ud.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let n="WebSocket was closed before the connection was established";return fu(this,this._req,n)}if(this.readyState===r.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Yhe)}}ping(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${y_[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||kF,t,n)}pong(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${y_[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||kF,t,n)}send(e,t,n){if(typeof t=="function"&&(n=t,t={}),this.readyState!==r.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${y_[this.readyState]})`);if(n)return n(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[ud.extensionName]||(i.compress=!1),this._sender.send(e||kF,i,n)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let e="WebSocket was closed before the connection was established";return fu(this,this._req,e)}this._socket&&(this.readyState=r.CLOSING,this._socket.destroy())}}};y_.forEach((r,e)=>{No[r]=e});["open","error","close","message"].forEach(r=>{Object.defineProperty(No.prototype,`on${r}`,{get(){let e=this.listeners(r);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(r);for(var n=0;n<t.length;n++)t[n]._listener&&this.removeListener(r,t[n]);this.addEventListener(r,e)}})});No.prototype.addEventListener=J5.addEventListener;No.prototype.removeEventListener=J5.removeEventListener;Y5.exports=No;function H5(r,e,t,n){let i=Object.assign({protocolVersion:DF[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!DF.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${DF.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,r.url=e.href):(o=Ey.URL?new Ey.URL(e):Ey.parse(e),r.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${r.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",c=a?443:80,l=W5.randomBytes(16).toString("base64"),u=a?Bhe.get:qhe.get,p=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var m;if(i.createConnection=a?Zhe:Xhe,i.defaultPort=i.defaultPort||c,i.port=o.port||c,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=p,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new ud(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=V5.format({[ud.extensionName]:m.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let g=p.split(":");i.socketPath=g[0],i.path=g[1]}var h=r._req=u(i);i.timeout&&h.on("timeout",()=>{fu(r,h,"Opening handshake has timed out")}),h.on("error",g=>{r._req.aborted||(h=r._req=null,r.readyState=No.CLOSING,r.emit("error",g),r.emitClose())}),h.on("response",g=>{let y=g.headers.location,C=g.statusCode;if(y&&i.followRedirects&&C>=300&&C<400){if(++r._redirects>i.maxRedirects){fu(r,h,"Maximum redirects exceeded");return}h.abort();let k=Ey.URL?new Ey.URL(y,e):Ey.resolve(e,y);H5(r,k,t,n)}else r.emit("unexpected-response",h,g)||fu(r,h,`Unexpected server response: ${g.statusCode}`)}),h.on("upgrade",(g,y,C)=>{if(r.emit("upgrade",g),r.readyState!==No.CONNECTING)return;h=r._req=null;let k=W5.createHash("sha1").update(l+zhe).digest("base64");if(g.headers["sec-websocket-accept"]!==k){fu(r,y,"Invalid Sec-WebSocket-Accept header");return}let A=g.headers["sec-websocket-protocol"],T=(t||"").split(/, */);var U;if(!t&&A?U="Server sent a subprotocol but none was requested":t&&!A?U="Server sent no subprotocol":A&&!T.includes(A)&&(U="Server sent an invalid subprotocol"),U){fu(r,y,U);return}if(A&&(r.protocol=A),m)try{let oe=V5.parse(g.headers["sec-websocket-extensions"]);oe[ud.extensionName]&&(m.accept(oe[ud.extensionName]),r._extensions[ud.extensionName]=m)}catch{fu(r,y,"Invalid Sec-WebSocket-Extensions header");return}r.setSocket(y,C,i.maxPayload)})}function Xhe(r){return r.protocolVersion&&(r.path=r.socketPath),Jhe.connect(r)}function Zhe(r){return r.path=void 0,r.servername=r.servername||r.host,$he.connect(r)}function fu(r,e,t){r.readyState=No.CLOSING;let n=new Error(t);Error.captureStackTrace(n,fu),e.setHeader?(e.abort(),e.once("abort",r.emitClose.bind(r)),r.emit("error",n)):(e.destroy(n),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function ege(r,e){let t=this[Ao];t._socket.removeListener("data",b_),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,r===1005?t.close():t.close(r,e)}function tge(){this[Ao]._socket.resume()}function rge(r){let e=this[Ao];e._socket.removeListener("data",b_),e.readyState=No.CLOSING,e._closeCode=r[Qhe],e.emit("error",r),e._socket.destroy()}function q5(){this[Ao].emitClose()}function nge(r){this[Ao].emit("message",r)}function ige(r){let e=this[Ao];e.pong(r,!e._isServer,$5),e.emit("ping",r)}function oge(r){this[Ao].emit("pong",r)}function G5(){let r=this[Ao];this.removeListener("close",G5),this.removeListener("end",z5),r.readyState=No.CLOSING,r._socket.read(),r._receiver.end(),this.removeListener("data",b_),this[Ao]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",q5),r._receiver.on("finish",q5))}function b_(r){this[Ao]._receiver.write(r)||this.pause()}function z5(){let r=this[Ao];r.readyState=No.CLOSING,r._receiver.end(),this.end()}function Q5(){let r=this[Ao];this.removeListener("error",Q5),this.on("error",$5),r.readyState=No.CLOSING,this.destroy()}});var eH=M((R$e,Z5)=>{"use strict";var sge=require("events"),age=require("crypto"),S_=require("http"),ff=EC(),X5=yF(),cge=_F(),{GUID:lge}=mf(),uge=/^[+/0-9A-Za-z]{22}==$/,TF=class extends sge{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=S_.createServer((n,i)=>{let o=S_.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=pge(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s=>{this.emit("connection",s,n)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let n of this.clients)n.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(dge,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",RF);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=+e.headers["sec-websocket-version"],a={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!o||!uge.test(o)||s!==8&&s!==13||!this.shouldHandle(e))return I_(t,400);if(this.options.perMessageDeflate){let c=new ff(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let l=X5.parse(e.headers["sec-websocket-extensions"]);l[ff.extensionName]&&(c.accept(l[ff.extensionName]),a[ff.extensionName]=c)}catch{return I_(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${s===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(l,u,p,m)=>{if(!l)return I_(t,u||401,p,m);this.completeUpgrade(o,a,e,t,n,i)});return}if(!this.options.verifyClient(c))return I_(t,401)}this.completeUpgrade(o,a,e,t,n,i)}completeUpgrade(e,t,n,i,o,s){if(!i.readable||!i.writable)return i.destroy();let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${age.createHash("sha1").update(e+lge).digest("base64")}`],l=new cge(null);var u=n.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(mge),this.options.handleProtocols?u=this.options.handleProtocols(u,n):u=u[0],u&&(c.push(`Sec-WebSocket-Protocol: ${u}`),l.protocol=u)),t[ff.extensionName]){let p=t[ff.extensionName].params,m=X5.format({[ff.extensionName]:[p]});c.push(`Sec-WebSocket-Extensions: ${m}`),l._extensions=t}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",RF),l.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(l),l.on("close",()=>this.clients.delete(l))),s(l)}};Z5.exports=TF;function pge(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let n of Object.keys(e))r.removeListener(n,e[n])}}function dge(r){r.emit("close")}function RF(){this.destroy()}function I_(r,e,t,n){r.writable&&(t=t||S_.STATUS_CODES[e],n=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},n),r.write(`HTTP/1.1 ${e} ${S_.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+t)),r.removeListener("error",RF),r.destroy()}function mge(r){return r.trim()}});var rH=M((A$e,tH)=>{"use strict";var x_=_F();x_.Server=eH();x_.Receiver=wF();x_.Sender=PF();tH.exports=x_});var iH=M((N$e,nH)=>{"use strict";nH.exports=rH()});var pH=M((k_,uH)=>{(function(r,e){typeof k_=="object"&&typeof uH<"u"?e(k_):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_algorithm={}))})(k_,function(r){"use strict";r.ArrayExt=void 0,function(L){function V(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=se.length;if(re===0)return-1;B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);var De;q<B?De=q+1+(re-B):De=q-B+1;for(var Le=0;Le<De;++Le){var mr=(B+Le)%re;if(se[mr]===fe)return mr}return-1}L.firstIndexOf=V;function Ie(se,fe,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var re=se.length;if(re===0)return-1;B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);var De;B<q?De=B+1+(re-q):De=B-q+1;for(var Le=0;Le<De;++Le){var mr=(B-Le+re)%re;if(se[mr]===fe)return mr}return-1}L.lastIndexOf=Ie;function Me(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=se.length;if(re===0)return-1;B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);var De;q<B?De=q+1+(re-B):De=q-B+1;for(var Le=0;Le<De;++Le){var mr=(B+Le)%re;if(fe(se[mr],mr))return mr}return-1}L.findFirstIndex=Me;function nt(se,fe,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var re=se.length;if(re===0)return-1;B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);var De;B<q?De=B+1+(re-q):De=B-q+1;for(var Le=0;Le<De;++Le){var mr=(B-Le+re)%re;if(fe(se[mr],mr))return mr}return-1}L.findLastIndex=nt;function nn(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=Me(se,fe,B,q);return re!==-1?se[re]:void 0}L.findFirstValue=nn;function Gt(se,fe,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var re=nt(se,fe,B,q);return re!==-1?se[re]:void 0}L.findLastValue=Gt;function Wt(se,fe,B,q,re){q===void 0&&(q=0),re===void 0&&(re=-1);var De=se.length;if(De===0)return 0;q<0?q=Math.max(0,q+De):q=Math.min(q,De-1),re<0?re=Math.max(0,re+De):re=Math.min(re,De-1);for(var Le=q,mr=re-q+1;mr>0;){var Si=mr>>1,Ol=Le+Si;B(se[Ol],fe)<0?(Le=Ol+1,mr-=Si+1):mr=Si}return Le}L.lowerBound=Wt;function Ot(se,fe,B,q,re){q===void 0&&(q=0),re===void 0&&(re=-1);var De=se.length;if(De===0)return 0;q<0?q=Math.max(0,q+De):q=Math.min(q,De-1),re<0?re=Math.max(0,re+De):re=Math.min(re,De-1);for(var Le=q,mr=re-q+1;mr>0;){var Si=mr>>1,Ol=Le+Si;B(se[Ol],fe)>0?mr=Si:(Le=Ol+1,mr-=Si+1)}return Le}L.upperBound=Ot;function kr(se,fe,B){if(se===fe)return!0;if(se.length!==fe.length)return!1;for(var q=0,re=se.length;q<re;++q)if(B?!B(se[q],fe[q]):se[q]!==fe[q])return!1;return!0}L.shallowEqual=kr;function Hr(se,fe){fe===void 0&&(fe={});var B=fe.start,q=fe.stop,re=fe.step;if(re===void 0&&(re=1),re===0)throw new Error("Slice `step` cannot be zero.");var De=se.length;B===void 0?B=re<0?De-1:0:B<0?B=Math.max(B+De,re<0?-1:0):B>=De&&(B=re<0?De-1:De),q===void 0?q=re<0?-1:De:q<0?q=Math.max(q+De,re<0?-1:0):q>=De&&(q=re<0?De-1:De);var Le;re<0&&q>=B||re>0&&B>=q?Le=0:re<0?Le=Math.floor((q-B+1)/re+1):Le=Math.floor((q-B-1)/re+1);for(var mr=[],Si=0;Si<Le;++Si)mr[Si]=se[B+Si*re];return mr}L.slice=Hr;function Rr(se,fe,B){var q=se.length;if(!(q<=1)&&(fe<0?fe=Math.max(0,fe+q):fe=Math.min(fe,q-1),B<0?B=Math.max(0,B+q):B=Math.min(B,q-1),fe!==B)){for(var re=se[fe],De=fe<B?1:-1,Le=fe;Le!==B;Le+=De)se[Le]=se[Le+De];se[B]=re}}L.move=Rr;function on(se,fe,B){fe===void 0&&(fe=0),B===void 0&&(B=-1);var q=se.length;if(!(q<=1))for(fe<0?fe=Math.max(0,fe+q):fe=Math.min(fe,q-1),B<0?B=Math.max(0,B+q):B=Math.min(B,q-1);fe<B;){var re=se[fe],De=se[B];se[fe++]=De,se[B--]=re}}L.reverse=on;function H(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=se.length;if(!(re<=1)&&(B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1),!(B>=q))){var De=q-B+1;if(fe>0?fe=fe%De:fe<0&&(fe=(fe%De+De)%De),fe!==0){var Le=B+fe;on(se,B,Le-1),on(se,Le,q),on(se,B,q)}}}L.rotate=H;function ie(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=se.length;if(re!==0){B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);var De;q<B?De=q+1+(re-B):De=q-B+1;for(var Le=0;Le<De;++Le)se[(B+Le)%re]=fe}}L.fill=ie;function ge(se,fe,B){var q=se.length;fe<0?fe=Math.max(0,fe+q):fe=Math.min(fe,q);for(var re=q;re>fe;--re)se[re]=se[re-1];se[fe]=B}L.insert=ge;function Ee(se,fe){var B=se.length;if(fe<0&&(fe+=B),!(fe<0||fe>=B)){for(var q=se[fe],re=fe+1;re<B;++re)se[re-1]=se[re];return se.length=B-1,q}}L.removeAt=Ee;function ze(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=V(se,fe,B,q);return re!==-1&&Ee(se,re),re}L.removeFirstOf=ze;function sn(se,fe,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var re=Ie(se,fe,B,q);return re!==-1&&Ee(se,re),re}L.removeLastOf=sn;function kt(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=se.length;if(re===0)return 0;B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);for(var De=0,Le=0;Le<re;++Le)B<=q&&Le>=B&&Le<=q&&se[Le]===fe||q<B&&(Le<=q||Le>=B)&&se[Le]===fe?De++:De>0&&(se[Le-De]=se[Le]);return De>0&&(se.length=re-De),De}L.removeAllOf=kt;function Tt(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re,De=Me(se,fe,B,q);return De!==-1&&(re=Ee(se,De)),{index:De,value:re}}L.removeFirstWhere=Tt;function ot(se,fe,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var re,De=nt(se,fe,B,q);return De!==-1&&(re=Ee(se,De)),{index:De,value:re}}L.removeLastWhere=ot;function Ut(se,fe,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var re=se.length;if(re===0)return 0;B<0?B=Math.max(0,B+re):B=Math.min(B,re-1),q<0?q=Math.max(0,q+re):q=Math.min(q,re-1);for(var De=0,Le=0;Le<re;++Le)B<=q&&Le>=B&&Le<=q&&fe(se[Le],Le)||q<B&&(Le<=q||Le>=B)&&fe(se[Le],Le)?De++:De>0&&(se[Le-De]=se[Le]);return De>0&&(se.length=re-De),De}L.removeAllWhere=Ut}(r.ArrayExt||(r.ArrayExt={}));function e(L){var V;return typeof L.iter=="function"?V=L.iter():V=new p(L),V}function t(L){return new m(L)}function n(L){return new h(L)}function i(L){return new g(L)}function o(L){return new y(L)}function s(L,V){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(V(nt,Ie++)===!1)return}function a(L,V){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(!V(nt,Ie++))return!1;return!0}function c(L,V){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(V(nt,Ie++))return!0;return!1}function l(L){for(var V=0,Ie=[],Me=e(L),nt;(nt=Me.next())!==void 0;)Ie[V++]=nt;return Ie}function u(L){for(var V=e(L),Ie,Me={};(Ie=V.next())!==void 0;)Me[Ie[0]]=Ie[1];return Me}var p=function(){function L(V){this._index=0,this._source=V}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},L}(),m=function(){function L(V,Ie){Ie===void 0&&(Ie=Object.keys(V)),this._index=0,this._source=V,this._keys=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source,this._keys);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var V=this._keys[this._index++];return V in this._source?V:this.next()}},L}(),h=function(){function L(V,Ie){Ie===void 0&&(Ie=Object.keys(V)),this._index=0,this._source=V,this._keys=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source,this._keys);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var V=this._keys[this._index++];return V in this._source?this._source[V]:this.next()}},L}(),g=function(){function L(V,Ie){Ie===void 0&&(Ie=Object.keys(V)),this._index=0,this._source=V,this._keys=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source,this._keys);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var V=this._keys[this._index++];return V in this._source?[V,this._source[V]]:this.next()}},L}(),y=function(){function L(V){this._fn=V}return L.prototype.iter=function(){return this},L.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},L.prototype.next=function(){return this._fn.call(void 0)},L}();function C(){for(var L=[],V=0;V<arguments.length;V++)L[V]=arguments[V];return new k(e(L.map(e)))}var k=function(){function L(V){this._cloned=!1,this._source=V,this._active=void 0}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source.clone());return V._active=this._active&&this._active.clone(),V._cloned=!0,this._cloned=!0,V},L.prototype.next=function(){if(this._active===void 0){var V=this._source.next();if(V===void 0)return;this._active=this._cloned?V.clone():V}var Ie=this._active.next();return Ie!==void 0?Ie:(this._active=void 0,this.next())},L}();function A(){return new T}var T=function(){function L(){}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L},L.prototype.next=function(){},L}();function U(L,V){return V===void 0&&(V=0),new oe(e(L),V)}var oe=function(){function L(V,Ie){this._source=V,this._index=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._index)},L.prototype.next=function(){var V=this._source.next();if(V!==void 0)return[this._index++,V]},L}();function G(L,V){return new pe(e(L),V)}var pe=function(){function L(V,Ie){this._index=0,this._source=V,this._fn=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source.clone(),this._fn);return V._index=this._index,V},L.prototype.next=function(){for(var V=this._fn,Ie=this._source,Me;(Me=Ie.next())!==void 0;)if(V(Me,this._index++))return Me},L}();function de(L,V){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(V(nt,Ie++))return nt}function te(L,V){for(var Ie=0,Me=e(L),nt;(nt=Me.next())!==void 0;)if(V(nt,Ie++))return Ie-1;return-1}function we(L,V){var Ie=e(L),Me=Ie.next();if(Me!==void 0){for(var nt=Me;(Me=Ie.next())!==void 0;)V(Me,nt)<0&&(nt=Me);return nt}}function Ue(L,V){var Ie=e(L),Me=Ie.next();if(Me!==void 0){for(var nt=Me;(Me=Ie.next())!==void 0;)V(Me,nt)>0&&(nt=Me);return nt}}function lt(L,V){var Ie=e(L),Me=Ie.next();if(Me!==void 0){for(var nt=Me,nn=Me;(Me=Ie.next())!==void 0;)V(Me,nt)<0?nt=Me:V(Me,nn)>0&&(nn=Me);return[nt,nn]}}function gt(L,V){return new rt(e(L),V)}var rt=function(){function L(V,Ie){this._index=0,this._source=V,this._fn=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source.clone(),this._fn);return V._index=this._index,V},L.prototype.next=function(){var V=this._source.next();if(V!==void 0)return this._fn.call(void 0,V,this._index++)},L}();function ae(L,V,Ie){return V===void 0?new ke(0,L,1):Ie===void 0?new ke(L,V,1):new ke(L,V,Ie)}var ke=function(){function L(V,Ie,Me){this._index=0,this._start=V,this._stop=Ie,this._step=Me,this._length=X.rangeLength(V,Ie,Me)}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._start,this._stop,this._step);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},L}(),X;(function(L){function V(Ie,Me,nt){return nt===0?1/0:Ie>Me&&nt>0||Ie<Me&&nt<0?0:Math.ceil((Me-Ie)/nt)}L.rangeLength=V})(X||(X={}));function ye(L,V,Ie){var Me=0,nt=e(L),nn=nt.next();if(nn===void 0&&Ie===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(nn===void 0)return Ie;var Gt=nt.next();if(Gt===void 0&&Ie===void 0)return nn;if(Gt===void 0)return V(Ie,nn,Me++);var Wt;Ie===void 0?Wt=V(nn,Gt,Me++):Wt=V(V(Ie,nn,Me++),Gt,Me++);for(var Ot;(Ot=nt.next())!==void 0;)Wt=V(Wt,Ot,Me++);return Wt}function qe(L,V){return new Pt(L,V)}function fn(L){return new Pt(L,1)}var Pt=function(){function L(V,Ie){this._value=V,this._count=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._value,this._count)},L.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},L}();function $r(L){var V;return typeof L.retro=="function"?V=L.retro():V=new xs(L),V}var xs=function(){function L(V){this._source=V,this._index=V.length-1}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var V=new L(this._source);return V._index=this._index,V},L.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},L}();function Bt(L){var V=[],Ie=new Set,Me=new Map;return s(L,nt),Me.forEach(function(Gt,Wt){nn(Wt)}),V;function nt(Gt){var Wt=Gt[0],Ot=Gt[1],kr=Me.get(Ot);kr?kr.push(Wt):Me.set(Ot,[Wt])}function nn(Gt){if(!Ie.has(Gt)){Ie.add(Gt);var Wt=Me.get(Gt);Wt&&Wt.forEach(nn),V.push(Gt)}}}function rn(L,V){return new Bi(e(L),V)}var Bi=function(){function L(V,Ie){this._source=V,this._step=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._step)},L.prototype.next=function(){for(var V=this._source.next(),Ie=this._step-1;Ie>0;--Ie)this._source.next();return V},L}();r.StringExt=void 0,function(L){function V(Gt,Wt,Ot){Ot===void 0&&(Ot=0);for(var kr=new Array(Wt.length),Hr=0,Rr=Ot,on=Wt.length;Hr<on;++Hr,++Rr){if(Rr=Gt.indexOf(Wt[Hr],Rr),Rr===-1)return null;kr[Hr]=Rr}return kr}L.findIndices=V;function Ie(Gt,Wt,Ot){Ot===void 0&&(Ot=0);var kr=V(Gt,Wt,Ot);if(!kr)return null;for(var Hr=0,Rr=0,on=kr.length;Rr<on;++Rr){var H=kr[Rr]-Ot;Hr+=H*H}return{score:Hr,indices:kr}}L.matchSumOfSquares=Ie;function Me(Gt,Wt,Ot){Ot===void 0&&(Ot=0);var kr=V(Gt,Wt,Ot);if(!kr)return null;for(var Hr=0,Rr=Ot-1,on=0,H=kr.length;on<H;++on){var ie=kr[on];Hr+=ie-Rr-1,Rr=ie}return{score:Hr,indices:kr}}L.matchSumOfDeltas=Me;function nt(Gt,Wt,Ot){for(var kr=[],Hr=0,Rr=0,on=Wt.length;Hr<on;){for(var H=Wt[Hr],ie=Wt[Hr];++Hr<on&&Wt[Hr]===ie+1;)ie++;Rr<H&&kr.push(Gt.slice(Rr,H)),H<ie+1&&kr.push(Ot(Gt.slice(H,ie+1))),Rr=ie+1}return Rr<Gt.length&&kr.push(Gt.slice(Rr)),kr}L.highlight=nt;function nn(Gt,Wt){return Gt<Wt?-1:Gt>Wt?1:0}L.cmp=nn}(r.StringExt||(r.StringExt={}));function Mt(L,V){return new cr(e(L),V)}var cr=function(){function L(V,Ie){this._source=V,this._count=Ie}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._count)},L.prototype.next=function(){if(!(this._count<=0)){var V=this._source.next();if(V!==void 0)return this._count--,V}},L}();function ti(){for(var L=[],V=0;V<arguments.length;V++)L[V]=arguments[V];return new Ml(L.map(e))}var Ml=function(){function L(V){this._source=V}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.map(function(V){return V.clone()}))},L.prototype.next=function(){for(var V=new Array(this._source.length),Ie=0,Me=this._source.length;Ie<Me;++Ie){var nt=this._source[Ie].next();if(nt===void 0)return;V[Ie]=nt}return V},L}();r.ArrayIterator=p,r.ChainIterator=k,r.EmptyIterator=T,r.EnumerateIterator=oe,r.FilterIterator=pe,r.FnIterator=y,r.ItemIterator=g,r.KeyIterator=m,r.MapIterator=rt,r.RangeIterator=ke,r.RepeatIterator=Pt,r.RetroArrayIterator=xs,r.StrideIterator=Bi,r.TakeIterator=cr,r.ValueIterator=h,r.ZipIterator=Ml,r.chain=C,r.each=s,r.empty=A,r.enumerate=U,r.every=a,r.filter=G,r.find=de,r.findIndex=te,r.iter=e,r.iterFn=o,r.iterItems=i,r.iterKeys=t,r.iterValues=n,r.map=gt,r.max=Ue,r.min=we,r.minmax=lt,r.once=fn,r.range=ae,r.reduce=ye,r.repeat=qe,r.retro=$r,r.some=c,r.stride=rn,r.take=Mt,r.toArray=l,r.toObject=u,r.topologicSort=Bt,r.zip=ti,Object.defineProperty(r,"__esModule",{value:!0})})});var mH=M((D_,dH)=>{(function(r,e){typeof D_=="object"&&typeof dH<"u"?e(D_):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_properties={}))})(D_,function(r){"use strict";r.AttachedProperty=function(){function t(n){this._pid=e.nextPID(),this.name=n.name,this._create=n.create,this._coerce=n.coerce||null,this._compare=n.compare||null,this._changed=n.changed||null}return t.prototype.get=function(n){var i,o=e.ensureMap(n);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n),i},t.prototype.set=function(n,i){var o,s=e.ensureMap(n);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(n);var a=this._coerceValue(n,i);this._maybeNotify(n,o,s[this._pid]=a)},t.prototype.coerce=function(n){var i,o=e.ensureMap(n);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n);var s=this._coerceValue(n,i);this._maybeNotify(n,i,o[this._pid]=s)},t.prototype._createValue=function(n){var i=this._create;return i(n)},t.prototype._coerceValue=function(n,i){var o=this._coerce;return o?o(n,i):i},t.prototype._compareValue=function(n,i){var o=this._compare;return o?o(n,i):n===i},t.prototype._maybeNotify=function(n,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(n,i,o)},t}(),function(t){function n(i){e.ownerData.delete(i)}t.clearData=n}(r.AttachedProperty||(r.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function n(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=n})(e||(e={})),Object.defineProperty(r,"__esModule",{value:!0})})});var T_=M((__,fH)=>{(function(r,e){typeof __=="object"&&typeof fH<"u"?e(__,pH(),mH()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_signaling={},r.lumino_algorithm,r.lumino_properties))})(__,function(r,e,t){"use strict";r.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return n.connect(this,o,s)},i.prototype.disconnect=function(o,s){return n.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||n.emit(this,o)},i}(),function(i){function o(h,g){var y=n.blockedProperty;y.set(h,y.get(h)+1);try{g()}finally{y.set(h,y.get(h)-1)}}i.blockAll=o;function s(h,g){n.disconnectBetween(h,g)}i.disconnectBetween=s;function a(h){n.disconnectSender(h)}i.disconnectSender=a;function c(h){n.disconnectReceiver(h)}i.disconnectReceiver=c;function l(h){n.disconnectAll(h)}i.disconnectAll=l;function u(h){n.disconnectAll(h)}i.clearData=u;function p(){return n.exceptionHandler}i.getExceptionHandler=p;function m(h){var g=n.exceptionHandler;return n.exceptionHandler=h,g}i.setExceptionHandler=m}(r.Signal||(r.Signal={}));var n;(function(i){i.exceptionHandler=function(G){console.error(G)};function o(G,pe,de){de=de||void 0;var te=m.get(G.sender);if(te||(te=[],m.set(G.sender,te)),C(te,G,pe,de))return!1;var we=de||pe,Ue=h.get(we);Ue||(Ue=[],h.set(we,Ue));var lt={signal:G,slot:pe,thisArg:de};return te.push(lt),Ue.push(lt),!0}i.connect=o;function s(G,pe,de){de=de||void 0;var te=m.get(G.sender);if(!te||te.length===0)return!1;var we=C(te,G,pe,de);if(!we)return!1;var Ue=de||pe,lt=h.get(Ue);return we.signal=null,A(te),A(lt),!0}i.disconnect=s;function a(G,pe){var de=m.get(G);if(!(!de||de.length===0)){var te=h.get(pe);!te||te.length===0||(e.each(te,function(we){we.signal&&we.signal.sender===G&&(we.signal=null)}),A(de),A(te))}}i.disconnectBetween=a;function c(G){var pe=m.get(G);!pe||pe.length===0||(e.each(pe,function(de){if(de.signal){var te=de.thisArg||de.slot;de.signal=null,A(h.get(te))}}),A(pe))}i.disconnectSender=c;function l(G){var pe=h.get(G);!pe||pe.length===0||(e.each(pe,function(de){if(de.signal){var te=de.signal.sender;de.signal=null,A(m.get(te))}}),A(pe))}i.disconnectReceiver=l;function u(G){c(G),l(G)}i.disconnectAll=u;function p(G,pe){if(!(i.blockedProperty.get(G.sender)>0)){var de=m.get(G.sender);if(!(!de||de.length===0))for(var te=0,we=de.length;te<we;++te){var Ue=de[te];Ue.signal===G&&k(Ue,pe)}}}i.emit=p;var m=new WeakMap,h=new WeakMap,g=new Set,y=function(){var G=typeof requestAnimationFrame=="function";return G?requestAnimationFrame:setImmediate}();function C(G,pe,de,te){return e.find(G,function(we){return we.signal===pe&&we.slot===de&&we.thisArg===te})}function k(G,pe){var de=G.signal,te=G.slot,we=G.thisArg;try{te.call(we,de.sender,pe)}catch(Ue){i.exceptionHandler(Ue)}}function A(G){g.size===0&&y(T),g.add(G)}function T(){g.forEach(U),g.clear()}function U(G){e.ArrayExt.removeAllWhere(G,oe)}function oe(G){return G.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(n||(n={})),Object.defineProperty(r,"__esModule",{value:!0})})});var BF=M((ytt,_H)=>{"use strict";var Ege=require("child_process").spawn;function Pge(r){if(r){r=r.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return r=r.replace(e,""),r.trim()}}function kge(r,e,t,n){typeof t=="function"&&(n=t,t=void 0);var i=!1,o=Ege(r,e,t),s="",a="";o.stdout.on("data",function(c){s+=c.toString()}),o.stderr.on("data",function(c){a+=c.toString()}),o.on("error",function(c){i||(i=!0,n(new Error(c)))}),o.on("close",function(c){if(!i){if(i=!0,a=Pge(a),a)return n(new Error(a));n(null,s,c)}})}_H.exports=kge});var RH=M((btt,TH)=>{"use strict";var Dge=require("os"),_ge=BF();function Tge(r){var e=["-A","-o","ppid,pid"];_ge("ps",e,function(t,n,i){if(t)return r(t);if(i!==0)return r(new Error("pidtree ps command exited with code "+i));try{n=n.split(Dge.EOL);for(var o=[],s=1;s<n.length;s++)n[s]=n[s].trim(),n[s]&&(n[s]=n[s].split(/\s+/),n[s][0]=parseInt(n[s][0],10),n[s][1]=parseInt(n[s][1],10),o.push(n[s]));r(null,o)}catch(a){r(a)}})}TH.exports=Tge});var NH=M((Itt,AH)=>{"use strict";var Rge=require("os"),Age=BF();function Nge(r){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};Age("wmic",e,t,function(n,i,o){if(n){r(n);return}if(o!==0){r(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(Rge.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));r(null,s)}catch(c){r(c)}})}AH.exports=Nge});var FH=M((Stt,KH)=>{"use strict";var OH=require("os"),Mge={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},Oge={ps:()=>RH(),wmic:()=>NH()},qF=OH.platform();qF.startsWith("win")&&(qF="win");var MH=Mge[qF];function Kge(r){MH===void 0&&r(new Error(OH.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=Oge[MH]();e(r)}KH.exports=Kge});var UH=M((xtt,LH)=>{"use strict";var Fge=FH();function Lge(r,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),r=parseInt(r,10),isNaN(r)||r<-1){t(new TypeError("The pid provided is invalid"));return}Fge(function(n,i){if(n){t(n);return}if(r===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===r){s=e.advanced?{ppid:i[a][0],pid:r}:r;break}i[a][0]===r&&(s=e.advanced?{pid:r}:r)}if(!s){t(new Error("No matching pid found"));return}for(var c={};i.length>0;){var l=i.pop();c[l[0]]?c[l[0]].push(l[1]):c[l[0]]=[l[1]]}for(var u=0,p=[s];u<p.length;){var m=e.advanced?p[u++].pid:p[u++];if(c[m]){for(var h=c[m].length,g=0;g<h;g++)p.push(e.advanced?{ppid:m,pid:c[m][g]}:c[m][g]);delete c[m]}}e.root||p.shift(),t(null,p)})}LH.exports=Lge});var VH=M((Ctt,WH)=>{"use strict";function Uge(r,e,t){return new Promise(function(n,i){r(e,t,function(o,s){if(o)return i(o);n(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(r){return this.substring(0,r.length)===r});var jH=UH();function jge(r,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){jH(r,e,t);return}return Uge(jH,r,e)}WH.exports=jge});var QH=M((wtt,zH)=>{var BH=Array.prototype.slice,qH=typeof Object.keys=="function"?Object.keys:function(r){var e=[];for(var t in r)e.push(t);return e},JH=zH.exports=function(r,e){return r===0&&e===0?Wge(r,e):r===e?!0:r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():GH(r)?GH(e):typeof r!="object"&&typeof e!="object"?r==e:Vge(r,e)};function $H(r){return r==null}function HH(r){return Object.prototype.toString.call(r)=="[object Arguments]"}function GH(r){return typeof r=="number"&&r!==r}function Wge(r,e){return 1/r===1/e}function Vge(r,e){if($H(r)||$H(e)||r.prototype!==e.prototype)return!1;if(HH(r))return HH(e)?(r=BH.call(r),e=BH.call(e),JH(r,e)):!1;try{var t=qH(r),n=qH(e),i,o}catch{return!1}if(t.length!=n.length)return!1;for(t.sort(),n.sort(),o=t.length-1;o>=0;o--)if(t[o]!=n[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!JH(r[i],e[i]))return!1;return!0}});var ZH=M((Ett,XH)=>{"use strict";var YH="[a-fA-F\\d:]",vd=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${YH})|(?<=${YH})(?=\\s|$))`:"",ja="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Nn="[a-fA-F\\d]{1,4}",tT=`
(?:
(?:${Nn}:){7}(?:${Nn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Nn}:){6}(?:${ja}|:${Nn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Nn}:){5}(?::${ja}|(?::${Nn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Nn}:){4}(?:(?::${Nn}){0,1}:${ja}|(?::${Nn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Nn}:){3}(?:(?::${Nn}){0,2}:${ja}|(?::${Nn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Nn}:){2}(?:(?::${Nn}){0,3}:${ja}|(?::${Nn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Nn}:){1}(?:(?::${Nn}){0,4}:${ja}|(?::${Nn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Nn}){0,5}:${ja}|(?::${Nn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Bge=new RegExp(`(?:^${ja}$)|(?:^${tT}$)`),qge=new RegExp(`^${ja}$`),Jge=new RegExp(`^${tT}$`),JF=r=>r&&r.exact?Bge:new RegExp(`(?:${vd(r)}${ja}${vd(r)})|(?:${vd(r)}${tT}${vd(r)})`,"g");JF.v4=r=>r&&r.exact?qge:new RegExp(`${vd(r)}${ja}${vd(r)}`,"g");JF.v6=r=>r&&r.exact?Jge:new RegExp(`${vd(r)}${tT}${vd(r)}`,"g");XH.exports=JF});var e4=M((Ptt,$ge)=>{$ge.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var r4=M((ktt,t4)=>{t4.exports=Qge;var Hge=/^(?:\w+:)?\/\/(\S+)$/,Gge=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,zge=/^[^\s\.]+\.\S{2,}$/;function Qge(r){if(typeof r!="string")return!1;var e=r.match(Hge);if(!e)return!1;var t=e[1];return t?!!(Gge.test(t)||zge.test(t)):!1}});var o4=M(i4=>{"use strict";var n4={}.hasOwnProperty,br={}.toString,S=i4,Yge=QH(),Xge=ZH();S.version=e4().version;S.browser=function(){return!S.node()&&typeof window<"u"&&br.call(window)==="[object global]"};S.defined=function(r){return typeof r<"u"};S.def=S.defined;S.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};S.node=S.nodejs;S.undefined=function(r){return r===void 0};S.udef=S.undef=S.undefined;S.array=function(r){return br.call(r)==="[object Array]"};S.arr=S.ary=S.arry=S.array;S.arrayLike=function(r){return S.nullOrUndef(r)?!1:r!==void 0&&n4.call(r,"length")&&isFinite(r.length)};S.arrLike=S.arryLike=S.aryLike=S.arraylike=S.arrayLike;S.arguments=function(r){return br.call(r)==="[object Arguments]"};S.args=S.arguments;S.boolean=function(r){return br.call(r)==="[object Boolean]"};S.bool=S.boolean;S.buffer=function(r){return S.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(r)};S.buff=S.buf=S.buffer;S.date=function(r){return br.call(r)==="[object Date]"};S.error=function(r){return br.call(r)==="[object Error]"};S.err=S.error;S.false=function(r){return r===!1};S.function=function(r){return S.syncFunction(r)||S.asyncFunction(r)};S.fun=S.func=S.function;S.asyncFunction=function(r){return br.call(r)==="[object AsyncFunction]"};S.asyncFun=S.asyncFunc=S.asyncFunction;S.syncFunction=function(r){return br.call(r)==="[object Function]"};S.syncFun=S.syncFunc=S.syncFunction;S.null=function(r){return r===null};S.nullOrUndefined=function(r){return r===null||typeof r>"u"};S.nullOrUndef=S.nullOrUndefined;S.number=function(r){return br.call(r)==="[object Number]"};S.num=S.number;S.object=function(r){return br.call(r)==="[object Object]"};S.obj=S.object;S.regExp=function(r){return br.call(r)==="[object RegExp]"};S.re=S.regexp=S.regExp;S.string=function(r){return br.call(r)==="[object String]"};S.str=S.string;S.true=function(r){return r===!0};var Zge=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");S.uuid=function(r){return Zge.test(r)};S.equal=function(r,e){var t=br.call(r);return typeof r!=typeof e||t!==br.call(e)?!1:t==="[object Object]"||t==="[object Array]"?Yge(r,e):t==="[object Function]"?r.prototype===e.prototype:t==="[object Date]"?r.getTime()===e.getTime():r===e};S.objEquals=S.eq=S.equal;var eve={boolean:1,number:1,string:1,undefined:1};S.hosted=function(r,e){if(S.nullOrUndef(r))return!1;var t=typeof e[r];return t==="object"?!!e[r]:!eve[t]};S.instanceOf=function(r,e){return S.nullOrUndef(r)||S.nullOrUndef(e)?!1:r instanceof e};S.instOf=S.instanceof=S.instanceOf;S.objectInstanceOf=function(r,e){try{return br.call(r)==="[object Object]"&&r instanceof e}catch{return!1}};S.instOf=S.instanceOf=S.objInstOf=S.objectInstanceOf;S.type=function(r,e){return typeof r===e};S.a=S.type;S.empty=function(r){var e=br.call(r);if(e==="[object Array]"||e==="[object Arguments]")return r.length===0;if(e==="[object Object]"){for(var t in r)if(n4.call(r,t))return!1;return!0}return e==="[object String]"?r==="":!1};S.emptyArguments=function(r){return br.call(r)==="[object Arguments]"&&r.length===0};S.noArgs=S.emptyArgs=S.emptyArguments;S.emptyArray=function(r){return br.call(r)==="[object Array]"&&r.length===0};S.emptyArry=S.emptyAry=S.emptyArray;S.emptyArrayLike=function(r){return r.length===0};S.emptyArrLike=S.emptyArrayLike;S.emptyString=function(r){return S.string(r)&&r.length===0};S.emptyStr=S.emptyString;S.nonEmptyArray=function(r){return br.call(r)==="[object Array]"&&r.length>0};S.nonEmptyArr=S.nonEmptyArry=S.nonEmptyAry=S.nonEmptyArray;S.nonEmptyObject=function(r){return br.call(r)==="[object Object]"&&Object.keys(r).length>0};S.nonEmptyObj=S.nonEmptyObject;S.emptyObject=function(r){return br.call(r)==="[object Object]"&&Object.keys(r).length===0};S.emptyObj=S.emptyObject;S.nonEmptyString=function(r){return S.string(r)&&r.length>0};S.nonEmptyStr=S.nonEmptyString;S.even=function(r){return br.call(r)==="[object Number]"&&r%2===0};S.decimal=function(r){return br.call(r)==="[object Number]"&&r%1!==0};S.dec=S.decNum=S.decimal;S.integer=function(r){return br.call(r)==="[object Number]"&&r%1===0};S.int=S.integer;S.notANumber=function(r){return!S.num(r)||r!==r};S.nan=S.notANum=S.notANumber;S.odd=function(r){return!S.decimal(r)&&br.call(r)==="[object Number]"&&r%2!==0};S.oddNumber=S.oddNum=S.odd;S.positiveNumber=function(r){return br.call(r)==="[object Number]"&&r>0};S.pos=S.positive=S.posNum=S.positiveNum=S.positiveNumber;S.negativeNumber=function(r){return br.call(r)==="[object Number]"&&r<0};S.neg=S.negNum=S.negativeNum=S.negativeNumber;S.negativeInteger=function(r){return br.call(r)==="[object Number]"&&r%1===0&&r<0};S.negativeInt=S.negInt=S.negativeInteger;S.positiveInteger=function(r){return br.call(r)==="[object Number]"&&r%1===0&&r>0};S.posInt=S.positiveInt=S.positiveInteger;S.divisibleBy=function(r,e){return r===0?!1:br.call(r)==="[object Number]"&&e!==0&&r%e===0};S.divBy=S.divisBy=S.divisibleBy;S.greaterOrEqualTo=function(r,e){return r>=e};S.greaterOrEqual=S.ge=S.greaterOrEqualTo;S.greaterThan=function(r,e){return r>e};S.gt=S.greaterThan;S.lessThanOrEqualTo=function(r,e){return r<=e};S.lessThanOrEq=S.lessThanOrEqual=S.le=S.lessThanOrEqualTo;S.lessThan=function(r,e){return r<e};S.lt=S.lessThan;S.maximum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r<e[t])return!1;return!0};S.max=S.maximum;S.minimum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r>e[t])return!1;return!0};S.min=S.minimum;S.within=function(r,e,t){return r>=e&&r<=t};S.withIn=S.within;S.prettyClose=function(r,e,t){return!S.number(r)||!S.number(e)||S.defined(t)&&!S.posInt(t)?!1:(S.undefined(t)&&(t=2),r.toFixed(t)===e.toFixed(t))};S.closish=S.near=S.prettyClose;S.dnsAddress=function(r){return!(!S.nonEmptyStr(r)||r.length>255||rve.test(r)||!tve.test(r))};S.dnsAddr=S.dns=S.dnsAddress;var tve=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,rve=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;S.emailAddress=function(r){return S.nonEmptyStr(r)?nve.test(r):!1};S.email=S.emailAddr=S.emailAddress;var nve=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;S.ipv4Address=function(r){if(!S.nonEmptyStr(r)||r.length>15)return!1;var e=r.split(".");if(!S.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var n=parseInt(e[t],10);if(isNaN(n)||n<0||n>255)return!1}return!0};S.ipv4=S.ipv4Addr=S.ipv4Address;S.ipv6Address=function(r){return S.nonEmptyStr(r)?Xge.v6({extract:!0}).test(r):!1};S.ipv6=S.ipv6Addr=S.ipv6Address;S.ipAddress=function(r){return S.nonEmptyStr(r)?S.ipv4Address(r)||S.ipv6Address(r):!1};S.ip=S.ipAddr=S.ipAddress;S.hostAddress=function(r){return S.nonEmptyStr(r)?S.dns(r)||S.ipv4(r)||S.ipv6(r):!1};S.host=S.hostIp=S.hostAddr=S.hostAddress;S.port=function(r){return!(!S.num(r)||S.negativeInt(r)||r>65535)};S.systemPort=function(r){return!!(S.port(r)&&r<1024)};S.sysPort=S.systemPort;S.userPort=function(r){return!!(S.port(r)&&r>1023)};S.creditCardNumber=function(r){if(!S.str(r))return!1;var e=r.split(""),t,n;for(t=e.length-1,n=1;t>-1;t--,n++)n%2===0&&(e[t]*=2);r=e.join("");var i=0;for(t=0;t<r.length;t++)i+=Math.floor(r[t]);return i%10===0};S.creditCard=S.creditCardNum=S.creditCardNumber;S.americanExpressCardNumber=function(r){if(!S.str(r)||r.length!==15)return!1;var e=Math.floor(r.slice(0,2));return!(e!==34&&e!==37||!S.creditCardNumber(r))};S.amexCard=S.amexCardNum=S.americanExpressCardNumber;S.chinaUnionPayCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,2));return!(e!==62&&e!==88)};S.chinaUnion=S.chinaUnionPayCard=S.chinaUnionPayCardNumber;S.dinersClubCarteBlancheCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3));return!(e<300||e>305||!S.creditCardNumber(r))};S.dinersClubCB=S.dinersClubCarteBlancheCard=S.dinersClubCarteBlancheCardNumber;S.dinersClubInternationalCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3)),t=Math.floor(r.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!S.creditCardNumber(r))};S.dinersClubInt=S.dinersClubInternationalCard=S.dinersClubInternationalCardNumber;S.dinersClubUSACanadaCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e!==54&&e!==55||!S.creditCardNumber(r))};S.dinersClub=S.dinersClubUSACanCard=S.dinersClubUSACanadaCardNumber;S.discoverCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,6)),t=Math.floor(r.slice(0,3));return!(r.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&r.slice(0,2)!=="65"||!S.creditCardNumber(r))};S.discover=S.discoverCard=S.discoverCardNumber;S.instaPaymentCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,3));return!(e<637||e>639||!S.creditCardNumber(r))};S.instaPayment=S.instaPaymentCardNumber;S.jcbCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4));return!(e<3528||e>3589||!S.creditCardNumber(r))};S.jcb=S.jcbCard=S.jcbCardNumber;S.laserCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.laser=S.laserCard=S.laserCardNumber;S.maestroCardNumber=function(r){if(!S.str(r)||r.length<12||r.length>19)return!1;var e=r.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.maestro=S.maestroCard=S.maestroCardNumber;S.dankortCardNumber=function(r){return!(!S.str(r)||r.length!==16||r.slice(0,4)!=="5019"||!S.creditCardNumber(r))};S.dankort=S.dankortCard=S.dankortCardNumber;S.masterCardCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e<50||e>55||!S.creditCardNumber(r))};S.masterCard=S.masterCardCard=S.masterCardCardNumber;S.visaCardNumber=function(r){return!(!S.str(r)||r.length!==13&&r.length!==16||r.slice(0,1)!=="4"||!S.creditCardNumber(r))};S.visa=S.visaCard=S.visaCardNumber;S.visaElectronCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return r.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!S.creditCardNumber(r),!1};S.visaElectron=S.visaElectronCard=S.visaElectronCardNumber;var ive=/^[0-9a-fA-F]{24}$/;S.mongoId=S.objectId=S.objId=function(r){return!!r&&!Array.isArray(r)&&ive.test(String(r))};S.matching=S.match=S.inArgs=function(r){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var n=S.equal(r,arguments[t]);e=e||n}return e};S.streetAddress=function(r){if(!S.str(r))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(r)};S.street=S.address=S.streetAddress;S.zipCode=function(r){if(S.undefined(r)||!(S.string(r)||S.number(r)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(r)};S.zip=S.zipCode;S.phoneNumber=function(r){if(!S.string(r))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]‌​)\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-‌​9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(r)};S.phone=S.phoneNumber;var ove=r4();S.url=function(r){return ove(r)};S.uri=S.url;S.enumerator=function(r,e){var t=!1;if(!S.defined(r)||!S.defined(e)||!S.arrayLike(e))return t;for(var n=0,i=e.length;n<i;n++)if(S.equal(r,e[n])){t=!0;break}return t};S.enum=S.inArray=S.enumerator});var $F=M((_tt,s4)=>{function sve(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=ik(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null;function h(...g){if(!h.enabled)return;let y=h,C=Number(new Date),k=C-(p||C);y.diff=k,y.prev=p,y.curr=C,p=C,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let A=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(U,oe)=>{if(U==="%%")return"%";A++;let G=t.formatters[oe];if(typeof G=="function"){let pe=g[A];U=G.call(y,pe),g.splice(A,1),A--}return U}),t.formatArgs.call(y,g),(y.log||t.log).apply(y,g)}return h.namespace=u,h.useColors=t.useColors(),h.color=t.selectColor(u),h.extend=n,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>m===null?t.enabled(u):m,set:g=>{m=g}}),typeof t.init=="function"&&t.init(h),h}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}s4.exports=sve});var a4=M((fs,rT)=>{fs.formatArgs=cve;fs.save=lve;fs.load=uve;fs.useColors=ave;fs.storage=pve();fs.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();fs.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function ave(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function cve(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+rT.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}fs.log=console.debug||console.log||(()=>{});function lve(r){try{r?fs.storage.setItem("debug",r):fs.storage.removeItem("debug")}catch{}}function uve(){let r;try{r=fs.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function pve(){try{return localStorage}catch{}}rT.exports=$F()(fs);var{formatters:dve}=rT.exports;dve.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var l4=M((vi,iT)=>{var mve=require("tty"),nT=require("util");vi.init=Ive;vi.log=vve;vi.formatArgs=hve;vi.save=yve;vi.load=bve;vi.useColors=fve;vi.destroy=nT.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");vi.colors=[6,2,3,4,5,1];try{let r=sk();r&&(r.stderr||r).level>=2&&(vi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}vi.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function fve(){return"colors"in vi.inspectOpts?!!vi.inspectOpts.colors:mve.isatty(process.stderr.fd)}function hve(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+iT.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=gve()+e+" "+r[0]}function gve(){return vi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function vve(...r){return process.stderr.write(nT.format(...r)+`
`)}function yve(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function bve(){return process.env.DEBUG}function Ive(r){r.inspectOpts={};let e=Object.keys(vi.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=vi.inspectOpts[e[t]]}iT.exports=$F()(vi);var{formatters:c4}=iT.exports;c4.o=function(r){return this.inspectOpts.colors=this.useColors,nT.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};c4.O=function(r){return this.inspectOpts.colors=this.useColors,nT.inspect(r,this.inspectOpts)}});var u4=M((Ttt,HF)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?HF.exports=a4():HF.exports=l4()});var v4=M(Sf=>{"use strict";Sf.check=h4;Sf.waitUntilFreeOnHost=xve;Sf.waitUntilFree=Cve;Sf.waitUntilUsedOnHost=g4;Sf.waitUntilUsed=wve;Sf.waitForStatus=sT;var Wa=o4(),Sve=require("net"),p4=require("util"),oT=u4()("tcp-port-used"),d4=2e3,m4=250;function f4(){var r,e,t=new Promise(function(n,i){r=n,e=i});return{resolve:r,reject:e,promise:t}}function zy(r,e,t,n,i){var o={};return o.port=r,o.host=e,o.inUse=t,o.retryTimeMs=n,o.timeOutMs=i,o}function h4(r,e){var t=f4(),n=!0,i,o;if(Wa.obj(r)?o=r:o=zy(r,e),!Wa.port(o.port))return oT("Error invalid port: "+p4.inspect(o.port)),t.reject(new Error("invalid port: "+p4.inspect(o.port))),t.promise;Wa.nullOrUndefined(o.host)&&(oT("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(n),s()}function c(l){l.code!=="ECONNREFUSED"?t.reject(l):(n=!1,t.resolve(n)),s()}return i=new Sve.Socket,i.once("connect",a),i.once("error",c),i.connect({port:o.port,host:o.host},function(){}),t.promise}function sT(r,e,t,n,i){var o=f4(),s,a=!1,c,l;if(Wa.obj(r)?l=r:l=zy(r,e,t,n,i),!Wa.bool(l.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;Wa.positiveInt(l.retryTimeMs)||(l.retryTimeMs=m4,oT("set retryTime to default "+m4+"ms")),Wa.positiveInt(l.timeOutMs)||(l.timeOutMs=d4,oT("set timeOutMs to default "+d4+"ms"));function u(){s&&clearTimeout(s),c&&clearTimeout(c)}function p(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(p,l.timeOutMs);function m(){h4(l.port,l.host).then(function(h){if(!a)if(h===l.inUse){o.resolve(),u();return}else{c=setTimeout(function(){m()},l.retryTimeMs);return}},function(h){a||(o.reject(h),u())})}return m(),o.promise}function xve(r,e,t,n){var i;return Wa.obj(r)?(i=r,i.inUse=!1):i=zy(r,e,!1,t,n),sT(i)}function Cve(r,e,t){var n;return Wa.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!1):n=zy(r,"127.0.0.1",!1,e,t),sT(n)}function g4(r,e,t,n){var i;return Wa.obj(r)?(i=r,i.inUse=!0):i=zy(r,e,!0,t,n),sT(i)}function wve(r,e,t){var n;return Wa.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!0):n=zy(r,"127.0.0.1",!0,e,t),g4(n)}});var w4=M((aT,ml)=>{(function(r,e){typeof aT=="object"&&typeof ml<"u"?e(aT):typeof define=="function"&&define.amd?define(["exports"],e):e(r.async=r.async||{})})(aT,function(r){"use strict";function e(I,P){P=P|0;for(var R=Math.max(I.length-P,0),K=Array(R),Y=0;Y<R;Y++)K[Y]=I[P+Y];return K}var t=function(I){var P=e(arguments,1);return function(){var R=e(arguments);return I.apply(null,P.concat(R))}},n=function(I){return function(){var P=e(arguments),R=P.pop();I.call(this,P,R)}};function i(I){var P=typeof I;return I!=null&&(P=="object"||P=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(I){setTimeout(I,0)}function c(I){return function(P){var R=e(arguments,1);I(function(){P.apply(null,R)})}}var l;o?l=setImmediate:s?l=process.nextTick:l=a;var u=c(l);function p(I){return n(function(P,R){var K;try{K=I.apply(this,P)}catch(Y){return R(Y)}i(K)&&typeof K.then=="function"?K.then(function(Y){m(R,null,Y)},function(Y){m(R,Y.message?Y:new Error(Y))}):R(null,K)})}function m(I,P,R){try{I(P,R)}catch(K){u(h,K)}}function h(I){throw I}var g=typeof Symbol=="function";function y(I){return g&&I[Symbol.toStringTag]==="AsyncFunction"}function C(I){return y(I)?p(I):I}function k(I){return function(P){var R=e(arguments,1),K=n(function(Y,Q){var ce=this;return I(P,function(me,Re){C(me).apply(ce,Y.concat(Re))},Q)});return R.length?K.apply(this,R):K}}var A=typeof global=="object"&&global&&global.Object===Object&&global,T=typeof self=="object"&&self&&self.Object===Object&&self,U=A||T||Function("return this")(),oe=U.Symbol,G=Object.prototype,pe=G.hasOwnProperty,de=G.toString,te=oe?oe.toStringTag:void 0;function we(I){var P=pe.call(I,te),R=I[te];try{I[te]=void 0;var K=!0}catch{}var Y=de.call(I);return K&&(P?I[te]=R:delete I[te]),Y}var Ue=Object.prototype,lt=Ue.toString;function gt(I){return lt.call(I)}var rt="[object Null]",ae="[object Undefined]",ke=oe?oe.toStringTag:void 0;function X(I){return I==null?I===void 0?ae:rt:ke&&ke in Object(I)?we(I):gt(I)}var ye="[object AsyncFunction]",qe="[object Function]",fn="[object GeneratorFunction]",Pt="[object Proxy]";function $r(I){if(!i(I))return!1;var P=X(I);return P==qe||P==fn||P==ye||P==Pt}var xs=9007199254740991;function Bt(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=xs}function rn(I){return I!=null&&Bt(I.length)&&!$r(I)}var Bi={};function Mt(){}function cr(I){return function(){if(I!==null){var P=I;I=null,P.apply(this,arguments)}}}var ti=typeof Symbol=="function"&&Symbol.iterator,Ml=function(I){return ti&&I[ti]&&I[ti]()};function L(I,P){for(var R=-1,K=Array(I);++R<I;)K[R]=P(R);return K}function V(I){return I!=null&&typeof I=="object"}var Ie="[object Arguments]";function Me(I){return V(I)&&X(I)==Ie}var nt=Object.prototype,nn=nt.hasOwnProperty,Gt=nt.propertyIsEnumerable,Wt=Me(function(){return arguments}())?Me:function(I){return V(I)&&nn.call(I,"callee")&&!Gt.call(I,"callee")},Ot=Array.isArray;function kr(){return!1}var Hr=typeof r=="object"&&r&&!r.nodeType&&r,Rr=Hr&&typeof ml=="object"&&ml&&!ml.nodeType&&ml,on=Rr&&Rr.exports===Hr,H=on?U.Buffer:void 0,ie=H?H.isBuffer:void 0,ge=ie||kr,Ee=9007199254740991,ze=/^(?:0|[1-9]\d*)$/;function sn(I,P){var R=typeof I;return P=P??Ee,!!P&&(R=="number"||R!="symbol"&&ze.test(I))&&I>-1&&I%1==0&&I<P}var kt="[object Arguments]",Tt="[object Array]",ot="[object Boolean]",Ut="[object Date]",se="[object Error]",fe="[object Function]",B="[object Map]",q="[object Number]",re="[object Object]",De="[object RegExp]",Le="[object Set]",mr="[object String]",Si="[object WeakMap]",Ol="[object ArrayBuffer]",rR="[object DataView]",nR="[object Float32Array]",iR="[object Float64Array]",Ce="[object Int8Array]",oU="[object Int16Array]",sU="[object Int32Array]",aU="[object Uint8Array]",cU="[object Uint8ClampedArray]",lU="[object Uint16Array]",uU="[object Uint32Array]",Fr={};Fr[nR]=Fr[iR]=Fr[Ce]=Fr[oU]=Fr[sU]=Fr[aU]=Fr[cU]=Fr[lU]=Fr[uU]=!0,Fr[kt]=Fr[Tt]=Fr[Ol]=Fr[ot]=Fr[rR]=Fr[Ut]=Fr[se]=Fr[fe]=Fr[B]=Fr[q]=Fr[re]=Fr[De]=Fr[Le]=Fr[mr]=Fr[Si]=!1;function pU(I){return V(I)&&Bt(I.length)&&!!Fr[X(I)]}function dU(I){return function(P){return I(P)}}var oR=typeof r=="object"&&r&&!r.nodeType&&r,ch=oR&&typeof ml=="object"&&ml&&!ml.nodeType&&ml,mU=ch&&ch.exports===oR,Tw=mU&&A.process,sR=function(){try{var I=ch&&ch.require&&ch.require("util").types;return I||Tw&&Tw.binding&&Tw.binding("util")}catch{}}(),aR=sR&&sR.isTypedArray,fU=aR?dU(aR):pU,hU=Object.prototype,gU=hU.hasOwnProperty;function vU(I,P){var R=Ot(I),K=!R&&Wt(I),Y=!R&&!K&&ge(I),Q=!R&&!K&&!Y&&fU(I),ce=R||K||Y||Q,me=ce?L(I.length,String):[],Re=me.length;for(var tt in I)(P||gU.call(I,tt))&&!(ce&&(tt=="length"||Y&&(tt=="offset"||tt=="parent")||Q&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||sn(tt,Re)))&&me.push(tt);return me}var yU=Object.prototype;function bU(I){var P=I&&I.constructor,R=typeof P=="function"&&P.prototype||yU;return I===R}function IU(I,P){return function(R){return I(P(R))}}var SU=IU(Object.keys,Object),xU=Object.prototype,CU=xU.hasOwnProperty;function wU(I){if(!bU(I))return SU(I);var P=[];for(var R in Object(I))CU.call(I,R)&&R!="constructor"&&P.push(R);return P}function Rw(I){return rn(I)?vU(I):wU(I)}function EU(I){var P=-1,R=I.length;return function(){return++P<R?{value:I[P],key:P}:null}}function PU(I){var P=-1;return function(){var K=I.next();return K.done?null:(P++,{value:K.value,key:P})}}function kU(I){var P=Rw(I),R=-1,K=P.length;return function Y(){var Q=P[++R];return Q==="__proto__"?Y():R<K?{value:I[Q],key:Q}:null}}function DU(I){if(rn(I))return EU(I);var P=Ml(I);return P?PU(P):kU(I)}function va(I){return function(){if(I===null)throw new Error("Callback was already called.");var P=I;I=null,P.apply(this,arguments)}}function cS(I){return function(P,R,K){if(K=cr(K||Mt),I<=0||!P)return K(null);var Y=DU(P),Q=!1,ce=0,me=!1;function Re(Ae,wt){if(ce-=1,Ae)Q=!0,K(Ae);else{if(wt===Bi||Q&&ce<=0)return Q=!0,K(null);me||tt()}}function tt(){for(me=!0;ce<I&&!Q;){var Ae=Y();if(Ae===null){Q=!0,ce<=0&&K(null);return}ce+=1,R(Ae.value,Ae.key,va(Re))}me=!1}tt()}}function Ju(I,P,R,K){cS(P)(I,C(R),K)}function Bn(I,P){return function(R,K,Y){return I(R,P,K,Y)}}function _U(I,P,R){R=cr(R||Mt);var K=0,Y=0,Q=I.length;Q===0&&R(null);function ce(me,Re){me?R(me):(++Y===Q||Re===Bi)&&R(null)}for(;K<Q;K++)P(I[K],K,va(ce))}var TU=Bn(Ju,1/0),Kl=function(I,P,R){var K=rn(I)?_U:TU;K(I,C(P),R)};function em(I){return function(P,R,K){return I(Kl,P,C(R),K)}}function cR(I,P,R,K){K=K||Mt,P=P||[];var Y=[],Q=0,ce=C(R);I(P,function(me,Re,tt){var Ae=Q++;ce(me,function(wt,Gr){Y[Ae]=Gr,tt(wt)})},function(me){K(me,Y)})}var lS=em(cR),lR=k(lS);function tm(I){return function(P,R,K,Y){return I(cS(R),P,C(K),Y)}}var rm=tm(cR),Aw=Bn(rm,1),uR=k(Aw);function uS(I,P){for(var R=-1,K=I==null?0:I.length;++R<K&&P(I[R],R,I)!==!1;);return I}function RU(I){return function(P,R,K){for(var Y=-1,Q=Object(P),ce=K(P),me=ce.length;me--;){var Re=ce[I?me:++Y];if(R(Q[Re],Re,Q)===!1)break}return P}}var AU=RU();function lh(I,P){return I&&AU(I,P,Rw)}function NU(I,P,R,K){for(var Y=I.length,Q=R+(K?1:-1);K?Q--:++Q<Y;)if(P(I[Q],Q,I))return Q;return-1}function MU(I){return I!==I}function OU(I,P,R){for(var K=R-1,Y=I.length;++K<Y;)if(I[K]===P)return K;return-1}function pS(I,P,R){return P===P?OU(I,P,R):NU(I,MU,R)}var Nw=function(I,P,R){typeof P=="function"&&(R=P,P=null),R=cr(R||Mt);var K=Rw(I),Y=K.length;if(!Y)return R(null);P||(P=Y);var Q={},ce=0,me=!1,Re=Object.create(null),tt=[],Ae=[],wt={};lh(I,function(Yr,an){if(!Ot(Yr)){Gr(an,[Yr]),Ae.push(an);return}var qn=Yr.slice(0,Yr.length-1),Ll=qn.length;if(Ll===0){Gr(an,Yr),Ae.push(an);return}wt[an]=Ll,uS(qn,function(vh){if(!I[vh])throw new Error("async.auto task `"+an+"` has a non-existent dependency `"+vh+"` in "+qn.join(", "));ec(vh,function(){Ll--,Ll===0&&Gr(an,Yr)})})}),wY(),xi();function Gr(Yr,an){tt.push(function(){tc(Yr,an)})}function xi(){if(tt.length===0&&ce===0)return R(null,Q);for(;tt.length&&ce<P;){var Yr=tt.shift();Yr()}}function ec(Yr,an){var qn=Re[Yr];qn||(qn=Re[Yr]=[]),qn.push(an)}function ws(Yr){var an=Re[Yr]||[];uS(an,function(qn){qn()}),xi()}function tc(Yr,an){if(!me){var qn=va(function(vh,oA){if(ce--,arguments.length>2&&(oA=e(arguments,1)),vh){var sA={};lh(Q,function(PY,kY){sA[kY]=PY}),sA[Yr]=oA,me=!0,Re=Object.create(null),R(vh,sA)}else Q[Yr]=oA,ws(Yr)});ce++;var Ll=C(an[an.length-1]);an.length>1?Ll(Q,qn):Ll(qn)}}function wY(){for(var Yr,an=0;Ae.length;)Yr=Ae.pop(),an++,uS(EY(Yr),function(qn){--wt[qn]===0&&Ae.push(qn)});if(an!==Y)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function EY(Yr){var an=[];return lh(I,function(qn,Ll){Ot(qn)&&pS(qn,Yr,0)>=0&&an.push(Ll)}),an}};function nm(I,P){for(var R=-1,K=I==null?0:I.length,Y=Array(K);++R<K;)Y[R]=P(I[R],R,I);return Y}var KU="[object Symbol]";function FU(I){return typeof I=="symbol"||V(I)&&X(I)==KU}var LU=1/0,pR=oe?oe.prototype:void 0,dR=pR?pR.toString:void 0;function Mw(I){if(typeof I=="string")return I;if(Ot(I))return nm(I,Mw)+"";if(FU(I))return dR?dR.call(I):"";var P=I+"";return P=="0"&&1/I==-LU?"-0":P}function UU(I,P,R){var K=-1,Y=I.length;P<0&&(P=-P>Y?0:Y+P),R=R>Y?Y:R,R<0&&(R+=Y),Y=P>R?0:R-P>>>0,P>>>=0;for(var Q=Array(Y);++K<Y;)Q[K]=I[K+P];return Q}function jU(I,P,R){var K=I.length;return R=R===void 0?K:R,!P&&R>=K?I:UU(I,P,R)}function WU(I,P){for(var R=I.length;R--&&pS(P,I[R],0)>-1;);return R}function VU(I,P){for(var R=-1,K=I.length;++R<K&&pS(P,I[R],0)>-1;);return R}function BU(I){return I.split("")}var qU="\\ud800-\\udfff",JU="\\u0300-\\u036f",$U="\\ufe20-\\ufe2f",HU="\\u20d0-\\u20ff",GU=JU+$U+HU,zU="\\ufe0e\\ufe0f",QU="\\u200d",YU=RegExp("["+QU+qU+GU+zU+"]");function XU(I){return YU.test(I)}var mR="\\ud800-\\udfff",ZU="\\u0300-\\u036f",ej="\\ufe20-\\ufe2f",tj="\\u20d0-\\u20ff",rj=ZU+ej+tj,nj="\\ufe0e\\ufe0f",ij="["+mR+"]",Ow="["+rj+"]",Kw="\\ud83c[\\udffb-\\udfff]",oj="(?:"+Ow+"|"+Kw+")",fR="[^"+mR+"]",hR="(?:\\ud83c[\\udde6-\\uddff]){2}",gR="[\\ud800-\\udbff][\\udc00-\\udfff]",sj="\\u200d",vR=oj+"?",yR="["+nj+"]?",aj="(?:"+sj+"(?:"+[fR,hR,gR].join("|")+")"+yR+vR+")*",cj=yR+vR+aj,lj="(?:"+[fR+Ow+"?",Ow,hR,gR,ij].join("|")+")",uj=RegExp(Kw+"(?="+Kw+")|"+lj+cj,"g");function pj(I){return I.match(uj)||[]}function bR(I){return XU(I)?pj(I):BU(I)}function dj(I){return I==null?"":Mw(I)}var mj=/^\s+|\s+$/g;function fj(I,P,R){if(I=dj(I),I&&(R||P===void 0))return I.replace(mj,"");if(!I||!(P=Mw(P)))return I;var K=bR(I),Y=bR(P),Q=VU(K,Y),ce=WU(K,Y)+1;return jU(K,Q,ce).join("")}var hj=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,gj=/,/,vj=/(=.+)?(\s*)$/,yj=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function bj(I){return I=I.toString().replace(yj,""),I=I.match(hj)[2].replace(" ",""),I=I?I.split(gj):[],I=I.map(function(P){return fj(P.replace(vj,""))}),I}function IR(I,P){var R={};lh(I,function(K,Y){var Q,ce=y(K),me=!ce&&K.length===1||ce&&K.length===0;if(Ot(K))Q=K.slice(0,-1),K=K[K.length-1],R[Y]=Q.concat(Q.length>0?Re:K);else if(me)R[Y]=K;else{if(Q=bj(K),K.length===0&&!ce&&Q.length===0)throw new Error("autoInject task functions require explicit parameters.");ce||Q.pop(),R[Y]=Q.concat(Re)}function Re(tt,Ae){var wt=nm(Q,function(Gr){return tt[Gr]});wt.push(Ae),C(K).apply(null,wt)}}),Nw(R,P)}function Cs(){this.head=this.tail=null,this.length=0}function SR(I,P){I.length=1,I.head=I.tail=P}Cs.prototype.removeLink=function(I){return I.prev?I.prev.next=I.next:this.head=I.next,I.next?I.next.prev=I.prev:this.tail=I.prev,I.prev=I.next=null,this.length-=1,I},Cs.prototype.empty=function(){for(;this.head;)this.shift();return this},Cs.prototype.insertAfter=function(I,P){P.prev=I,P.next=I.next,I.next?I.next.prev=P:this.tail=P,I.next=P,this.length+=1},Cs.prototype.insertBefore=function(I,P){P.prev=I.prev,P.next=I,I.prev?I.prev.next=P:this.head=P,I.prev=P,this.length+=1},Cs.prototype.unshift=function(I){this.head?this.insertBefore(this.head,I):SR(this,I)},Cs.prototype.push=function(I){this.tail?this.insertAfter(this.tail,I):SR(this,I)},Cs.prototype.shift=function(){return this.head&&this.removeLink(this.head)},Cs.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},Cs.prototype.toArray=function(){for(var I=Array(this.length),P=this.head,R=0;R<this.length;R++)I[R]=P.data,P=P.next;return I},Cs.prototype.remove=function(I){for(var P=this.head;P;){var R=P.next;I(P)&&this.removeLink(P),P=R}return this};function xR(I,P,R){if(P==null)P=1;else if(P===0)throw new Error("Concurrency must not be zero");var K=C(I),Y=0,Q=[],ce=!1;function me(wt,Gr,xi){if(xi!=null&&typeof xi!="function")throw new Error("task callback must be a function");if(Ae.started=!0,Ot(wt)||(wt=[wt]),wt.length===0&&Ae.idle())return u(function(){Ae.drain()});for(var ec=0,ws=wt.length;ec<ws;ec++){var tc={data:wt[ec],callback:xi||Mt};Gr?Ae._tasks.unshift(tc):Ae._tasks.push(tc)}ce||(ce=!0,u(function(){ce=!1,Ae.process()}))}function Re(wt){return function(Gr){Y-=1;for(var xi=0,ec=wt.length;xi<ec;xi++){var ws=wt[xi],tc=pS(Q,ws,0);tc===0?Q.shift():tc>0&&Q.splice(tc,1),ws.callback.apply(ws,arguments),Gr!=null&&Ae.error(Gr,ws.data)}Y<=Ae.concurrency-Ae.buffer&&Ae.unsaturated(),Ae.idle()&&Ae.drain(),Ae.process()}}var tt=!1,Ae={_tasks:new Cs,concurrency:P,payload:R,saturated:Mt,unsaturated:Mt,buffer:P/4,empty:Mt,drain:Mt,error:Mt,started:!1,paused:!1,push:function(wt,Gr){me(wt,!1,Gr)},kill:function(){Ae.drain=Mt,Ae._tasks.empty()},unshift:function(wt,Gr){me(wt,!0,Gr)},remove:function(wt){Ae._tasks.remove(wt)},process:function(){if(!tt){for(tt=!0;!Ae.paused&&Y<Ae.concurrency&&Ae._tasks.length;){var wt=[],Gr=[],xi=Ae._tasks.length;Ae.payload&&(xi=Math.min(xi,Ae.payload));for(var ec=0;ec<xi;ec++){var ws=Ae._tasks.shift();wt.push(ws),Q.push(ws),Gr.push(ws.data)}Y+=1,Ae._tasks.length===0&&Ae.empty(),Y===Ae.concurrency&&Ae.saturated();var tc=va(Re(wt));K(Gr,tc)}tt=!1}},length:function(){return Ae._tasks.length},running:function(){return Y},workersList:function(){return Q},idle:function(){return Ae._tasks.length+Y===0},pause:function(){Ae.paused=!0},resume:function(){Ae.paused!==!1&&(Ae.paused=!1,u(Ae.process))}};return Ae}function CR(I,P){return xR(I,1,P)}var im=Bn(Ju,1);function Fl(I,P,R,K){K=cr(K||Mt);var Y=C(R);im(I,function(Q,ce,me){Y(P,Q,function(Re,tt){P=tt,me(Re)})},function(Q){K(Q,P)})}function Fw(){var I=nm(arguments,C);return function(){var P=e(arguments),R=this,K=P[P.length-1];typeof K=="function"?P.pop():K=Mt,Fl(I,P,function(Y,Q,ce){Q.apply(R,Y.concat(function(me){var Re=e(arguments,1);ce(me,Re)}))},function(Y,Q){K.apply(R,[Y].concat(Q))})}}var wR=function(){return Fw.apply(null,e(arguments).reverse())},Ij=Array.prototype.concat,dS=function(I,P,R,K){K=K||Mt;var Y=C(R);rm(I,P,function(Q,ce){Y(Q,function(me){return me?ce(me):ce(null,e(arguments,1))})},function(Q,ce){for(var me=[],Re=0;Re<ce.length;Re++)ce[Re]&&(me=Ij.apply(me,ce[Re]));return K(Q,me)})},ER=Bn(dS,1/0),PR=Bn(dS,1),kR=function(){var I=e(arguments),P=[null].concat(I);return function(){var R=arguments[arguments.length-1];return R.apply(this,P)}};function uh(I){return I}function om(I,P){return function(R,K,Y,Q){Q=Q||Mt;var ce=!1,me;R(K,function(Re,tt,Ae){Y(Re,function(wt,Gr){wt?Ae(wt):I(Gr)&&!me?(ce=!0,me=P(!0,Re),Ae(null,Bi)):Ae()})},function(Re){Re?Q(Re):Q(null,ce?me:P(!1))})}}function DR(I,P){return P}var mS=em(om(uh,DR)),ph=tm(om(uh,DR)),fS=Bn(ph,1);function _R(I){return function(P){var R=e(arguments,1);R.push(function(K){var Y=e(arguments,1);typeof console=="object"&&(K?console.error&&console.error(K):console[I]&&uS(Y,function(Q){console[I](Q)}))}),C(P).apply(null,R)}}var TR=_R("dir");function RR(I,P,R){R=va(R||Mt);var K=C(I),Y=C(P);function Q(me){if(me)return R(me);var Re=e(arguments,1);Re.push(ce),Y.apply(this,Re)}function ce(me,Re){if(me)return R(me);if(!Re)return R(null);K(Q)}ce(null,!0)}function Lw(I,P,R){R=va(R||Mt);var K=C(I),Y=function(Q){if(Q)return R(Q);var ce=e(arguments,1);if(P.apply(this,ce))return K(Y);R.apply(null,[null].concat(ce))};K(Y)}function AR(I,P,R){Lw(I,function(){return!P.apply(this,arguments)},R)}function NR(I,P,R){R=va(R||Mt);var K=C(P),Y=C(I);function Q(me){if(me)return R(me);Y(ce)}function ce(me,Re){if(me)return R(me);if(!Re)return R(null);K(Q)}Y(ce)}function MR(I){return function(P,R,K){return I(P,K)}}function hS(I,P,R){Kl(I,MR(C(P)),R)}function dh(I,P,R,K){cS(P)(I,MR(C(R)),K)}var mh=Bn(dh,1);function Uw(I){return y(I)?I:n(function(P,R){var K=!0;P.push(function(){var Y=arguments;K?u(function(){R.apply(null,Y)}):R.apply(null,Y)}),I.apply(this,P),K=!1})}function gS(I){return!I}var vS=em(om(gS,gS)),fh=tm(om(gS,gS)),yS=Bn(fh,1);function OR(I){return function(P){return P?.[I]}}function Sj(I,P,R,K){var Y=new Array(P.length);I(P,function(Q,ce,me){R(Q,function(Re,tt){Y[ce]=!!tt,me(Re)})},function(Q){if(Q)return K(Q);for(var ce=[],me=0;me<P.length;me++)Y[me]&&ce.push(P[me]);K(null,ce)})}function xj(I,P,R,K){var Y=[];I(P,function(Q,ce,me){R(Q,function(Re,tt){Re?me(Re):(tt&&Y.push({index:ce,value:Q}),me())})},function(Q){Q?K(Q):K(null,nm(Y.sort(function(ce,me){return ce.index-me.index}),OR("value")))})}function jw(I,P,R,K){var Y=rn(P)?Sj:xj;Y(I,P,C(R),K||Mt)}var bS=em(jw),hh=tm(jw),IS=Bn(hh,1);function KR(I,P){var R=va(P||Mt),K=C(Uw(I));function Y(Q){if(Q)return R(Q);K(Y)}Y()}var SS=function(I,P,R,K){K=K||Mt;var Y=C(R);rm(I,P,function(Q,ce){Y(Q,function(me,Re){return me?ce(me):ce(null,{key:Re,val:Q})})},function(Q,ce){for(var me={},Re=Object.prototype.hasOwnProperty,tt=0;tt<ce.length;tt++)if(ce[tt]){var Ae=ce[tt].key,wt=ce[tt].val;Re.call(me,Ae)?me[Ae].push(wt):me[Ae]=[wt]}return K(Q,me)})},FR=Bn(SS,1/0),LR=Bn(SS,1),UR=_R("log");function xS(I,P,R,K){K=cr(K||Mt);var Y={},Q=C(R);Ju(I,P,function(ce,me,Re){Q(ce,me,function(tt,Ae){if(tt)return Re(tt);Y[me]=Ae,Re()})},function(ce){K(ce,Y)})}var jR=Bn(xS,1/0),WR=Bn(xS,1);function VR(I,P){return P in I}function BR(I,P){var R=Object.create(null),K=Object.create(null);P=P||uh;var Y=C(I),Q=n(function(me,Re){var tt=P.apply(null,me);VR(R,tt)?u(function(){Re.apply(null,R[tt])}):VR(K,tt)?K[tt].push(Re):(K[tt]=[Re],Y.apply(null,me.concat(function(){var Ae=e(arguments);R[tt]=Ae;var wt=K[tt];delete K[tt];for(var Gr=0,xi=wt.length;Gr<xi;Gr++)wt[Gr].apply(null,Ae)})))});return Q.memo=R,Q.unmemoized=I,Q}var CS;s?CS=process.nextTick:o?CS=setImmediate:CS=a;var qR=c(CS);function Ww(I,P,R){R=R||Mt;var K=rn(P)?[]:{};I(P,function(Y,Q,ce){C(Y)(function(me,Re){arguments.length>2&&(Re=e(arguments,1)),K[Q]=Re,ce(me)})},function(Y){R(Y,K)})}function JR(I,P){Ww(Kl,I,P)}function $R(I,P,R){Ww(cS(P),I,R)}var Vw=function(I,P){var R=C(I);return xR(function(K,Y){R(K[0],Y)},P,1)},HR=function(I,P){var R=Vw(I,P);return R.push=function(K,Y,Q){if(Q==null&&(Q=Mt),typeof Q!="function")throw new Error("task callback must be a function");if(R.started=!0,Ot(K)||(K=[K]),K.length===0)return u(function(){R.drain()});Y=Y||0;for(var ce=R._tasks.head;ce&&Y>=ce.priority;)ce=ce.next;for(var me=0,Re=K.length;me<Re;me++){var tt={data:K[me],priority:Y,callback:Q};ce?R._tasks.insertBefore(ce,tt):R._tasks.push(tt)}u(R.process)},delete R.unshift,R};function GR(I,P){if(P=cr(P||Mt),!Ot(I))return P(new TypeError("First argument to race must be an array of functions"));if(!I.length)return P();for(var R=0,K=I.length;R<K;R++)C(I[R])(P)}function wS(I,P,R,K){var Y=e(I).reverse();Fl(Y,P,R,K)}function ES(I){var P=C(I);return n(function(K,Y){return K.push(function(ce,me){if(ce)Y(null,{error:ce});else{var Re;arguments.length<=2?Re=me:Re=e(arguments,1),Y(null,{value:Re})}}),P.apply(this,K)})}function zR(I){var P;return Ot(I)?P=nm(I,ES):(P={},lh(I,function(R,K){P[K]=ES.call(this,R)})),P}function QR(I,P,R,K){jw(I,P,function(Y,Q){R(Y,function(ce,me){Q(ce,!me)})},K)}var YR=em(QR),Bw=tm(QR),XR=Bn(Bw,1);function ZR(I){return function(){return I}}function PS(I,P,R){var K=5,Y=0,Q={times:K,intervalFunc:ZR(Y)};function ce(Ae,wt){if(typeof wt=="object")Ae.times=+wt.times||K,Ae.intervalFunc=typeof wt.interval=="function"?wt.interval:ZR(+wt.interval||Y),Ae.errorFilter=wt.errorFilter;else if(typeof wt=="number"||typeof wt=="string")Ae.times=+wt||K;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof I=="function"?(R=P||Mt,P=I):(ce(Q,I),R=R||Mt),typeof P!="function")throw new Error("Invalid arguments for async.retry");var me=C(P),Re=1;function tt(){me(function(Ae){Ae&&Re++<Q.times&&(typeof Q.errorFilter!="function"||Q.errorFilter(Ae))?setTimeout(tt,Q.intervalFunc(Re)):R.apply(null,arguments)})}tt()}var eA=function(I,P){P||(P=I,I=null);var R=C(P);return n(function(K,Y){function Q(ce){R.apply(null,K.concat(ce))}I?PS(I,Q,Y):PS(Q,Y)})};function tA(I,P){Ww(im,I,P)}var kS=em(om(Boolean,uh)),gh=tm(om(Boolean,uh)),DS=Bn(gh,1);function rA(I,P,R){var K=C(P);lS(I,function(Q,ce){K(Q,function(me,Re){if(me)return ce(me);ce(null,{value:Q,criteria:Re})})},function(Q,ce){if(Q)return R(Q);R(null,nm(ce.sort(Y),OR("value")))});function Y(Q,ce){var me=Q.criteria,Re=ce.criteria;return me<Re?-1:me>Re?1:0}}function nA(I,P,R){var K=C(I);return n(function(Y,Q){var ce=!1,me;function Re(){var tt=I.name||"anonymous",Ae=new Error('Callback function "'+tt+'" timed out.');Ae.code="ETIMEDOUT",R&&(Ae.info=R),ce=!0,Q(Ae)}Y.push(function(){ce||(Q.apply(null,arguments),clearTimeout(me))}),me=setTimeout(Re,P),K.apply(null,Y)})}var Cj=Math.ceil,wj=Math.max;function _(I,P,R,K){for(var Y=-1,Q=wj(Cj((P-I)/(R||1)),0),ce=Array(Q);Q--;)ce[K?Q:++Y]=I,I+=R;return ce}function j(I,P,R,K){var Y=C(R);rm(_(0,I,1),P,Y,K)}var Ze=Bn(j,1/0),qw=Bn(j,1);function Ej(I,P,R,K){arguments.length<=3&&(K=R,R=P,P=Ot(I)?[]:{}),K=cr(K||Mt);var Y=C(R);Kl(I,function(Q,ce,me){Y(P,Q,ce,me)},function(Q){K(Q,P)})}function Pj(I,P){var R=null,K;P=P||Mt,mh(I,function(Y,Q){C(Y)(function(ce,me){arguments.length>2?K=e(arguments,1):K=me,R=ce,Q(!ce)})},function(){P(R,K)})}function kj(I){return function(){return(I.unmemoized||I).apply(null,arguments)}}function iA(I,P,R){R=va(R||Mt);var K=C(P);if(!I())return R(null);var Y=function(Q){if(Q)return R(Q);if(I())return K(Y);var ce=e(arguments,1);R.apply(null,[null].concat(ce))};K(Y)}function Dj(I,P,R){iA(function(){return!I.apply(this,arguments)},P,R)}var _j=function(I,P){if(P=cr(P||Mt),!Ot(I))return P(new Error("First argument to waterfall must be an array of functions"));if(!I.length)return P();var R=0;function K(Q){var ce=C(I[R++]);Q.push(va(Y)),ce.apply(null,Q)}function Y(Q){if(Q||R===I.length)return P.apply(null,arguments);K(e(arguments,1))}K([])},CY={apply:t,applyEach:lR,applyEachSeries:uR,asyncify:p,auto:Nw,autoInject:IR,cargo:CR,compose:wR,concat:ER,concatLimit:dS,concatSeries:PR,constant:kR,detect:mS,detectLimit:ph,detectSeries:fS,dir:TR,doDuring:RR,doUntil:AR,doWhilst:Lw,during:NR,each:hS,eachLimit:dh,eachOf:Kl,eachOfLimit:Ju,eachOfSeries:im,eachSeries:mh,ensureAsync:Uw,every:vS,everyLimit:fh,everySeries:yS,filter:bS,filterLimit:hh,filterSeries:IS,forever:KR,groupBy:FR,groupByLimit:SS,groupBySeries:LR,log:UR,map:lS,mapLimit:rm,mapSeries:Aw,mapValues:jR,mapValuesLimit:xS,mapValuesSeries:WR,memoize:BR,nextTick:qR,parallel:JR,parallelLimit:$R,priorityQueue:HR,queue:Vw,race:GR,reduce:Fl,reduceRight:wS,reflect:ES,reflectAll:zR,reject:YR,rejectLimit:Bw,rejectSeries:XR,retry:PS,retryable:eA,seq:Fw,series:tA,setImmediate:u,some:kS,someLimit:gh,someSeries:DS,sortBy:rA,timeout:nA,times:Ze,timesLimit:j,timesSeries:qw,transform:Ej,tryEach:Pj,unmemoize:kj,until:Dj,waterfall:_j,whilst:iA,all:vS,allLimit:fh,allSeries:yS,any:kS,anyLimit:gh,anySeries:DS,find:mS,findLimit:ph,findSeries:fS,forEach:hS,forEachSeries:mh,forEachLimit:dh,forEachOf:Kl,forEachOfSeries:im,forEachOfLimit:Ju,inject:Fl,foldl:Fl,foldr:wS,select:bS,selectLimit:hh,selectSeries:IS,wrapSync:p};r.default=CY,r.apply=t,r.applyEach=lR,r.applyEachSeries=uR,r.asyncify=p,r.auto=Nw,r.autoInject=IR,r.cargo=CR,r.compose=wR,r.concat=ER,r.concatLimit=dS,r.concatSeries=PR,r.constant=kR,r.detect=mS,r.detectLimit=ph,r.detectSeries=fS,r.dir=TR,r.doDuring=RR,r.doUntil=AR,r.doWhilst=Lw,r.during=NR,r.each=hS,r.eachLimit=dh,r.eachOf=Kl,r.eachOfLimit=Ju,r.eachOfSeries=im,r.eachSeries=mh,r.ensureAsync=Uw,r.every=vS,r.everyLimit=fh,r.everySeries=yS,r.filter=bS,r.filterLimit=hh,r.filterSeries=IS,r.forever=KR,r.groupBy=FR,r.groupByLimit=SS,r.groupBySeries=LR,r.log=UR,r.map=lS,r.mapLimit=rm,r.mapSeries=Aw,r.mapValues=jR,r.mapValuesLimit=xS,r.mapValuesSeries=WR,r.memoize=BR,r.nextTick=qR,r.parallel=JR,r.parallelLimit=$R,r.priorityQueue=HR,r.queue=Vw,r.race=GR,r.reduce=Fl,r.reduceRight=wS,r.reflect=ES,r.reflectAll=zR,r.reject=YR,r.rejectLimit=Bw,r.rejectSeries=XR,r.retry=PS,r.retryable=eA,r.seq=Fw,r.series=tA,r.setImmediate=u,r.some=kS,r.someLimit=gh,r.someSeries=DS,r.sortBy=rA,r.timeout=nA,r.times=Ze,r.timesLimit=j,r.timesSeries=qw,r.transform=Ej,r.tryEach=Pj,r.unmemoize=kj,r.until=Dj,r.waterfall=_j,r.whilst=iA,r.all=vS,r.allLimit=fh,r.allSeries=yS,r.any=kS,r.anyLimit=gh,r.anySeries=DS,r.find=mS,r.findLimit=ph,r.findSeries=fS,r.forEach=hS,r.forEachSeries=mh,r.forEachLimit=dh,r.forEachOf=Kl,r.forEachOfSeries=im,r.forEachOfLimit=Ju,r.inject=Fl,r.foldl=Fl,r.foldr=wS,r.select=bS,r.selectLimit=hh,r.selectSeries=IS,r.wrapSync=p,Object.defineProperty(r,"__esModule",{value:!0})})});var GF=M((ort,E4)=>{"use strict";function Eve(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=o,t.enabled=a,t.humanize=ik(),Object.keys(r).forEach(function(l){t[l]=r[l]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(l){for(var u=0,p=0;p<l.length;p++)u=(u<<5)-u+l.charCodeAt(p),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(l){var u;function p(){if(p.enabled){for(var m=arguments.length,h=new Array(m),g=0;g<m;g++)h[g]=arguments[g];var y=p,C=Number(new Date),k=C-(u||C);y.diff=k,y.prev=u,y.curr=C,u=C,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");var A=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(U,oe){if(U==="%%")return U;A++;var G=t.formatters[oe];if(typeof G=="function"){var pe=h[A];U=G.call(y,pe),h.splice(A,1),A--}return U}),t.formatArgs.call(y,h);var T=y.log||t.log;T.apply(y,h)}}return p.namespace=l,p.enabled=t.enabled(l),p.useColors=t.useColors(),p.color=e(l),p.destroy=n,p.extend=i,typeof t.init=="function"&&t.init(p),t.instances.push(p),p}function n(){var l=t.instances.indexOf(this);return l!==-1?(t.instances.splice(l,1),!0):!1}function i(l,u){return t(this.namespace+(typeof u>"u"?":":u)+l)}function o(l){t.save(l),t.names=[],t.skips=[];var u,p=(typeof l=="string"?l:"").split(/[\s,]+/),m=p.length;for(u=0;u<m;u++)p[u]&&(l=p[u].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.substr(1)+"$")):t.names.push(new RegExp("^"+l+"$")));for(u=0;u<t.instances.length;u++){var h=t.instances[u];h.enabled=t.enabled(h.namespace)}}function s(){t.enable("")}function a(l){if(l[l.length-1]==="*")return!0;var u,p;for(u=0,p=t.skips.length;u<p;u++)if(t.skips[u].test(l))return!1;for(u=0,p=t.names.length;u<p;u++)if(t.names[u].test(l))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}return t.enable(t.load()),t}E4.exports=Eve});var P4=M((na,lT)=>{"use strict";function cT(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?cT=function(t){return typeof t}:cT=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cT(r)}na.log=Dve;na.formatArgs=kve;na.save=_ve;na.load=Tve;na.useColors=Pve;na.storage=Rve();na.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Pve(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function kve(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+lT.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;r.splice(1,0,e,"color: inherit");var t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}}function Dve(){var r;return(typeof console>"u"?"undefined":cT(console))==="object"&&console.log&&(r=console).log.apply(r,arguments)}function _ve(r){try{r?na.storage.setItem("debug",r):na.storage.removeItem("debug")}catch{}}function Tve(){var r;try{r=na.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Rve(){try{return localStorage}catch{}}lT.exports=GF()(na);var Ave=lT.exports.formatters;Ave.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var D4=M((ji,dT)=>{"use strict";var Nve=require("tty"),pT=require("util");ji.init=jve;ji.log=Fve;ji.formatArgs=Ove;ji.save=Lve;ji.load=Uve;ji.useColors=Mve;ji.colors=[6,2,3,4,5,1];try{uT=sk(),uT&&(uT.stderr||uT).level>=2&&(ji.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var uT;ji.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function Mve(){return"colors"in ji.inspectOpts?!!ji.inspectOpts.colors:Nve.isatty(process.stderr.fd)}function Ove(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o="  ".concat(i,";1m").concat(e," \x1B[0m");r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+dT.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=Kve()+e+" "+r[0]}function Kve(){return ji.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Fve(){return process.stderr.write(pT.format.apply(pT,arguments)+`
`)}function Lve(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Uve(){return process.env.DEBUG}function jve(r){r.inspectOpts={};for(var e=Object.keys(ji.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=ji.inspectOpts[e[t]]}dT.exports=GF()(ji);var k4=dT.exports.formatters;k4.o=function(r){return this.inspectOpts.colors=this.useColors,pT.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};k4.O=function(r){return this.inspectOpts.colors=this.useColors,pT.inspect(r,this.inspectOpts)}});var _4=M((srt,zF)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?zF.exports=P4():zF.exports=D4()});var N4=M((art,A4)=>{var UC=require("path"),T4=require("fs"),R4=parseInt("0777",8);A4.exports=Zy.mkdirp=Zy.mkdirP=Zy;function Zy(r,e,t,n){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||T4;i===void 0&&(i=R4),n||(n=null);var s=t||function(){};r=UC.resolve(r),o.mkdir(r,i,function(a){if(!a)return n=n||r,s(null,n);switch(a.code){case"ENOENT":if(UC.dirname(r)===r)return s(a);Zy(UC.dirname(r),e,function(c,l){c?s(c,l):Zy(r,e,s,l)});break;default:o.stat(r,function(c,l){c||!l.isDirectory()?s(a,n):s(null,n)});break}})}Zy.sync=function r(e,t,n){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||T4;i===void 0&&(i=R4),n||(n=null),e=UC.resolve(e);try{o.mkdirSync(e,i),n=n||e}catch(a){switch(a.code){case"ENOENT":n=r(UC.dirname(e),t,n),r(e,t,n);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return n}});var K4=M(Pr=>{"use strict";var M4=require("fs"),Wve=require("os"),Vve=require("net"),mT=require("path"),O4=w4(),XF=_4(),Bve=N4().mkdirp,QF=XF("portfinder:testPort"),jC=XF("portfinder:getPort"),qve=XF("portfinder:defaultHosts"),YF={};YF.testPort=function(r,e){e||(e=r,r={}),r.server=r.server||Vve.createServer(function(){}),QF("entered testPort(): trying",r.host,"port",r.port);function t(){QF("done w/ testPort(): OK",r.host,"port",r.port),r.server.removeListener("error",n),r.server.close(),e(null,r.port)}function n(i){if(QF("done w/ testPort(): failed",r.host,"w/ port",r.port,"with error",i.code),r.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Pr.nextPort(r.port);if(o>Pr.highestPort)return e(new Error("No open ports available"));YF.testPort({port:o,host:r.host,server:r.server},e)}r.server.once("error",n),r.server.once("listening",t),r.host?r.server.listen(r.port,r.host):r.server.listen(r.port)};Pr.basePort=8e3;Pr.highestPort=65535;Pr.basePath="/tmp/portfinder";Pr.getPort=function(r,e){if(e||(e=r,r={}),r.port=Number(r.port)||Number(Pr.basePort),r.host=r.host||null,r.stopPort=Number(r.stopPort)||Number(Pr.highestPort),!r.startPort){if(r.startPort=Number(r.port),r.startPort<0)throw Error("Provided options.startPort("+r.startPort+") is less than 0, which are cannot be bound.");if(r.stopPort<r.startPort)throw Error("Provided options.stopPort("+r.stopPort+"is less than options.startPort ("+r.startPort+")")}if(r.host){for(var t,n=0;n<Pr._defaultHosts.length;n++)if(Pr._defaultHosts[n]===r.host){t=!0;break}t||Pr._defaultHosts.push(r.host)}var i=[],o;return O4.eachSeries(Pr._defaultHosts,function(s,a){return jC("in eachSeries() iteration callback: host is",s),YF.testPort({host:s,port:r.port},function(c,l){return c?(jC("in eachSeries() iteration callback testPort() callback","with an err:",c.code),o=s,a(c)):(jC("in eachSeries() iteration callback testPort() callback","with a success for port",l),i.push(l),a())})},function(s){if(s)if(jC("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(r.host===o){var a="Provided host "+r.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var c=Pr._defaultHosts.indexOf(o);return Pr._defaultHosts.splice(c,1),Pr.getPort(r,e)}else return e(s);if(i.sort(function(l,u){return l-u}),jC("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=r.stopPort)return e(null,i[0]);var a="No open ports found in between "+r.startPort+" and "+r.stopPort;return e(Error(a))}else return Pr.getPort({port:i.pop(),host:r.host,startPort:r.startPort,stopPort:r.stopPort},e)})};Pr.getPortPromise=function(r){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return r||(r={}),new Promise(function(e,t){Pr.getPort(r,function(n,i){if(n)return t(n);e(i)})})};Pr.getPorts=function(r,e,t){t||(t=e,e={});var n=null;O4.timesSeries(r,function(i,o){n&&(e.port=Pr.nextPort(n)),Pr.getPort(e,function(s,a){s?o(s):(n=a,o(null,a))})},t)};Pr.getSocket=function(r,e){e||(e=r,r={}),r.mod=r.mod||parseInt(755,8),r.path=r.path||Pr.basePath+".sock";function t(){M4.stat(r.path,function(o){o?o.code=="ENOENT"?e(null,r.path):e(o):(r.path=Pr.nextSocket(r.path),Pr.getSocket(r,e))})}function n(o){Bve(o,r.mod,function(s){if(s)return e(s);r.exists=!0,t()})}function i(){var o=mT.dirname(r.path);M4.stat(o,function(s,a){if(s||!a.isDirectory())return n(o);r.exists=!0,t()})}return r.exists?t():i()};Pr.nextPort=function(r){return r+1};Pr.nextSocket=function(r){var e=mT.dirname(r),t=mT.basename(r,".sock"),n=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(n[2]),o=n[1];return isNaN(i)&&(i=0),i+=1,mT.join(e,o+i+".sock")};Pr._defaultHosts=function(){var r={};try{r=Wve.networkInterfaces()}catch(c){if(c.syscall!=="uv_interface_addresses")throw c}for(var e=Object.keys(r),t="0.0.0.0",n=[t],i=0;i<e.length;i++)for(var o=r[e[i]],s=0;s<o.length;s++){var a=o[s];n.push(a.address)}return n.push(null),qve("exports._defaultHosts is: %o",n),n}()});var B4=M(eb=>{"use strict";Object.defineProperty(eb,"__esModule",{value:!0});eb.encode=eb.decode=void 0;var j4=require("crypto"),eL="<IDS|MSG>",Jve=5;function vT(r){return JSON.parse(r.toString())}function W4(r){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},r)}function V4(r){let e=r;switch(r){case"hmac-sha256":e="sha256";break}return e}function $ve(r,e,t="sha256"){var n=0;let i=[];for(n=0;n<r.length;n++){var o=r[n];if(o.toString()===eL)break;i.push(o)}if(r.length-n<Jve)throw new Error("Message Decoding: Not enough message frames");if(r[n].toString()!==eL)throw new Error("Message Decoding: Missing delimiter");if(e){let u=V4(t);var s=r[n+1].toString(),a=j4.createHmac(u,e);a.update(r[n+2]),a.update(r[n+3]),a.update(r[n+4]),a.update(r[n+5]);var c=a.digest("hex");if(c!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${c}"`)}var l=W4({idents:i,header:vT(r[n+2]),parent_header:vT(r[n+3]),content:vT(r[n+5]),metadata:vT(r[n+4]),buffers:Array.prototype.slice.apply(r,[n+6])});return l}eb.decode=$ve;function Hve(r,e,t="sha256"){let n=W4(r),i=V4(t),o=n.idents,s=Buffer.from(JSON.stringify(n.header),"utf-8"),a=Buffer.from(JSON.stringify(n.parent_header),"utf-8"),c=Buffer.from(JSON.stringify(n.metadata),"utf-8"),l=Buffer.from(JSON.stringify(n.content),"utf-8"),u="";if(e){let m=j4.createHmac(i,e);m.update(s),m.update(a),m.update(c),m.update(l),u=m.digest("hex")}var p=o.concat([Buffer.from(eL),Buffer.from(u),s,a,c,l]).concat(n.buffers);return p}eb.encode=Hve});var eG=M((hit,Z4)=>{"use strict";Z4.exports=({onlyFirst:r=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")}});var AG=M((Ldt,RG)=>{"use strict";var vye=(r,e={})=>{let t=e.safe===!0||e.keepProtected===!0,n=!1,i=(o,s)=>{let a="",c,l;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&n===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){c=i(u,o),l=c.split(`
`),a+=`
`.repeat(l.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}n=!0;break;case"line":if(e.first&&n===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),n=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(r)};RG.exports=vye});var MG=M((Udt,NG)=>{"use strict";var YT=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},pL=class extends YT{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};NG.exports={Node:YT,Block:pL}});var KG=M(OG=>{"use strict";OG.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var UG=M((Wdt,LG)=>{"use strict";var{Node:Pd,Block:FG}=MG(),yye=KG(),dL={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},bye=(r,e={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");let t=new FG({type:"root",nodes:[]}),n=[t],i=(e.language||"javascript").toLowerCase(),o=yye[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:c}=o,l=t,u=r,p,m,h=[a,c].filter(Boolean),g=!1;h.every(T=>T.source==='^"""')&&(g=!0);let y=(T=u[0]||"")=>(u=u.slice(T.length),T),C=(T,U="text")=>{let oe=T.exec(u);if(oe)return y(oe[0]),{type:U,value:oe[0],match:oe}},k=T=>{if(m&&m.type==="text"&&T.type==="text"){m.value+=T.value;return}l.push(T),T.nodes&&(n.push(T),l=T),m=T},A=()=>{if(l.type==="root")throw new SyntaxError("Unclosed block comment");n.pop(),l=n[n.length-1]};for(;u!=="";){if(p=C(dL.ESCAPED_CHAR_REGEX,"text")){k(new Pd(p));continue}if(l.type!=="block"&&(!m||!/\w$/.test(m.value))&&!(g&&u.startsWith('"""'))&&(p=C(dL.QUOTED_STRING_REGEX,"text"))){k(new Pd(p));continue}if(p=C(dL.NEWLINE_REGEX,"newline")){k(new Pd(p));continue}if(a&&e.block&&!(g&&l.type==="block")&&(p=C(a,"open"))){k(new FG({type:"block"})),k(new Pd(p));continue}if(c&&l.type==="block"&&e.block&&(p=C(c,"close"))){p.newline=p.match[1]||"",k(new Pd(p)),A();continue}if(s&&l.type!=="block"&&e.line&&(p=C(s,"line"))){k(new Pd(p));continue}if(p=C(/^[a-zABD-Z0-9\t ]+/,"text")){k(new Pd(p));continue}k(new Pd({type:"text",value:y(u[0])}))}return t};LG.exports=bye});var WG=M((Vdt,jG)=>{"use strict";var XT=AG(),HC=UG(),ZT=jG.exports=(r,e)=>{let t={...e,block:!0,line:!0};return XT(HC(r,t),t)};ZT.block=(r,e)=>{let t={...e,block:!0};return XT(HC(r,t),t)};ZT.line=(r,e)=>{let t={...e,line:!0};return XT(HC(r,t),t)};ZT.first=(r,e)=>{let t={...e,block:!0,line:!0,first:!0};return XT(HC(r,t),t)};ZT.parse=HC});var _z=M((hTt,Dz)=>{var Hye=typeof global=="object"&&global&&global.Object===Object&&global;Dz.exports=Hye});var Rz=M((gTt,Tz)=>{var Gye=_z(),zye=typeof self=="object"&&self&&self.Object===Object&&self,Qye=Gye||zye||Function("return this")();Tz.exports=Qye});var H0=M((vTt,Az)=>{var Yye=Rz(),Xye=Yye.Symbol;Az.exports=Xye});var Mz=M((yTt,Nz)=>{function Zye(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}Nz.exports=Zye});var Kz=M((bTt,Oz)=>{var ebe=Array.isArray;Oz.exports=ebe});var jz=M((ITt,Uz)=>{var Fz=H0(),Lz=Object.prototype,tbe=Lz.hasOwnProperty,rbe=Lz.toString,uw=Fz?Fz.toStringTag:void 0;function nbe(r){var e=tbe.call(r,uw),t=r[uw];try{r[uw]=void 0;var n=!0}catch{}var i=rbe.call(r);return n&&(e?r[uw]=t:delete r[uw]),i}Uz.exports=nbe});var Vz=M((STt,Wz)=>{var ibe=Object.prototype,obe=ibe.toString;function sbe(r){return obe.call(r)}Wz.exports=sbe});var $z=M((xTt,Jz)=>{var Bz=H0(),abe=jz(),cbe=Vz(),lbe="[object Null]",ube="[object Undefined]",qz=Bz?Bz.toStringTag:void 0;function pbe(r){return r==null?r===void 0?ube:lbe:qz&&qz in Object(r)?abe(r):cbe(r)}Jz.exports=pbe});var Gz=M((CTt,Hz)=>{function dbe(r){return r!=null&&typeof r=="object"}Hz.exports=dbe});var Qz=M((wTt,zz)=>{var mbe=$z(),fbe=Gz(),hbe="[object Symbol]";function gbe(r){return typeof r=="symbol"||fbe(r)&&mbe(r)==hbe}zz.exports=gbe});var rQ=M((ETt,tQ)=>{var Yz=H0(),vbe=Mz(),ybe=Kz(),bbe=Qz(),Ibe=1/0,Xz=Yz?Yz.prototype:void 0,Zz=Xz?Xz.toString:void 0;function eQ(r){if(typeof r=="string")return r;if(ybe(r))return vbe(r,eQ)+"";if(bbe(r))return Zz?Zz.call(r):"";var e=r+"";return e=="0"&&1/r==-Ibe?"-0":e}tQ.exports=eQ});var iQ=M((PTt,nQ)=>{var Sbe=rQ();function xbe(r){return r==null?"":Sbe(r)}nQ.exports=xbe});var aQ=M((kTt,sQ)=>{var Cbe=iQ(),oQ=/[\\^$.*+?()[\]{}|]/g,wbe=RegExp(oQ.source);function Ebe(r){return r=Cbe(r),r&&wbe.test(r)?r.replace(oQ,"\\$&"):r}sQ.exports=Ebe});var YL=M((L9t,dY)=>{dY.exports=require("util").format});var UIe={};Rj(UIe,{activate:()=>PIe,deactivate:()=>kIe});module.exports=Nj(UIe);Reflect.metadata===void 0&&Oj();function $u(){try{return(Fj(),Nj(Kj)).isPreRelesVersionOfJupyterExtension===!0}catch{return!0}}var TS={isExiting:!1},Jw="_builtin.JupyterServerSelectorForTesting",aA="_builtin.jupyterServerUrlProvider";var Lj=!1;function Uj(r){Lj=r}function sm(){return Lj}var jj=!1;function Wj(r){jj=r}function cn(){return jj}var xe="python",RS="markdown",Ul="vscode-notebook-cell",MY={scheme:"untitled",language:xe},OY={scheme:"file",language:xe},$w={language:xe},KY={scheme:Ul,language:xe},Vj=[MY,OY,KY],Hw="vscode-interactive-input",xt="jupyter-notebook",yt="interactive";var rc="GitHub.codespaces",$e="ms-toolsai.jupyter",yh="ms-toolsai.jupyter-hub",Bj="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",Hu="STANDARD_OUTPUT_CHANNEL",AS;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(AS||={});var ri;(o=>(o.JupyterServerRemoteLaunchNameSeparator=`
`,o.JupyterServerRemoteLaunchService=$e,o.JupyterServerUriListMax=10,o.IntellisenseTimeout=2e3,o.IntellisenseResolveTimeout=5e3))(ri||={});var ni=!1;var FY=!1;function Ar(){return FY||NS()}var LY=!1;function NS(){return LY}var Qe;(y=>(y.GeneratedThemeName="ipython-theme",y.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",y.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",y.DefaultCodeCellMarker="# %%",y.DefaultCommTarget="jupyter.widget",y.ALL_VARIABLES="ALL_VARIABLES",y.KERNEL_VARIABLES="KERNEL_VARIABLES",y.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",y.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",y.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",y.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",y.REMOTE_URI="https://remote/",y.REMOTE_URI_ID_PARAM="id",y.REMOTE_URI_HANDLE_PARAM="uriHandle",y.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Qe||={});var nc;(i=>(i.ImportIPython=`{0}
from IPython import get_ipython

{1}`,i.MatplotLibInit=`import matplotlib
%matplotlib inline
${Qe.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,i.UpdateCWDAndPath=`import os as _VSCODE_os
import sys as _VSCODE_sys
%cd "{0}"
if _VSCODE_os.getcwd() not in _VSCODE_sys.path:
    _VSCODE_sys.path.insert(0, _VSCODE_os.getcwd())

del _VSCODE_sys
del _VSCODE_os`,i.DisableJedi="%config Completer.use_jedi = False"))(nc||={});var bh="JUPYTER_OUTPUT_CHANNEL",cA="Default Light+",ii="ms-python.python",Ih="ms-toolsai.jupyter-renderers",am="ms-python.vscode-pylance",qj=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],Jj=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),MS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var J;(Ce=>(Ce.RunAllCells="jupyter.runallcells",Ce.RunAllCellsAbove="jupyter.runallcellsabove",Ce.RunCellAndAllBelow="jupyter.runcellandallbelow",Ce.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",Ce.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",Ce.RunToLine="jupyter.runtoline",Ce.RunFromLine="jupyter.runfromline",Ce.RunCell="jupyter.runcell",Ce.RunCurrentCell="jupyter.runcurrentcell",Ce.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",Ce.CreateNewInteractive="jupyter.createnewinteractive",Ce.ImportNotebook="jupyter.importnotebook",Ce.ImportNotebookFile="jupyter.importnotebookfile",Ce.ExportFileAsNotebook="jupyter.exportfileasnotebook",Ce.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",Ce.InterruptKernel="jupyter.interruptkernel",Ce.RestartKernel="jupyter.restartkernel",Ce.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",Ce.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",Ce.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",Ce.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",Ce.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",Ce.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",Ce.ExpandAllCells="jupyter.expandallcells",Ce.CollapseAllCells="jupyter.collapseallcells",Ce.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",Ce.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",Ce.RunFileInInteractiveWindows="jupyter.runFileInteractive",Ce.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",Ce.AddCellBelow="jupyter.addcellbelow",Ce.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",Ce.DebugCell="jupyter.debugcell",Ce.DebugStepOver="jupyter.debugstepover",Ce.DebugContinue="jupyter.debugcontinue",Ce.DebugStop="jupyter.debugstop",Ce.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",Ce.InsertCellBelowPosition="jupyter.insertCellBelowPosition",Ce.InsertCellBelow="jupyter.insertCellBelow",Ce.InsertCellAbove="jupyter.insertCellAbove",Ce.DeleteCells="jupyter.deleteCells",Ce.SelectCell="jupyter.selectCell",Ce.SelectCellContents="jupyter.selectCellContents",Ce.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",Ce.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",Ce.MoveCellsUp="jupyter.moveCellsUp",Ce.MoveCellsDown="jupyter.moveCellsDown",Ce.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",Ce.ChangeCellToCode="jupyter.changeCellToCode",Ce.GotoNextCellInFile="jupyter.gotoNextCellInFile",Ce.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",Ce.ScrollToCell="jupyter.scrolltocell",Ce.CreateNewNotebook="jupyter.createnewnotebook",Ce.ViewJupyterOutput="jupyter.viewOutput",Ce.ExportAsPythonScript="jupyter.exportAsPythonScript",Ce.ExportToHTML="jupyter.exportToHTML",Ce.ExportToPDF="jupyter.exportToPDF",Ce.Export="jupyter.export",Ce.NativeNotebookExport="jupyter.notebookeditor.export",Ce.LatestExtension="jupyter.latestExtension",Ce.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",Ce.NotebookEditorExpandAllCells="jupyter.notebookeditor.expandallcells",Ce.NotebookEditorCollapseAllCells="jupyter.notebookeditor.collapseallcells",Ce.EnableDebugLogging="jupyter.enableDebugLogging",Ce.ResetLoggingLevel="jupyter.resetLoggingLevel",Ce.ShowDataViewer="jupyter.showDataViewer",Ce.RefreshDataViewer="jupyter.refreshDataViewer",Ce.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",Ce.OpenVariableView="jupyter.openVariableView",Ce.OpenOutlineView="jupyter.openOutlineView",Ce.InteractiveClearAll="jupyter.interactive.clearAllCells",Ce.InteractiveGoToCode="jupyter.interactive.goToCode",Ce.InteractiveCopyCell="jupyter.interactive.copyCell",Ce.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",Ce.InteractiveExportAs="jupyter.interactive.exportas",Ce.RunByLine="jupyter.runByLine",Ce.RunAndDebugCell="jupyter.runAndDebugCell",Ce.RunByLineNext="jupyter.runByLineNext",Ce.RunByLineStop="jupyter.runByLineStop",Ce.ReplayPylanceLog="jupyter.replayPylanceLog",Ce.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",Ce.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",Ce.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",Ce.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))(J||={});var Gu;(n=>(n.DefaultDesignLenses=[J.RunCurrentCell,J.RunAllCellsAbove,J.DebugCell],n.DefaultDebuggingLenses=[J.DebugContinue,J.DebugStop,J.DebugStepOver],n.DebuggerCommands=[J.DebugContinue,J.DebugStop,J.DebugStepOver]))(Gu||={});var Sr;(de=>(de.HasCodeCells="jupyter.hascodecells",de.IsInteractiveActive="jupyter.isinteractiveactive",de.OwnsSelection="jupyter.ownsSelection",de.HaveNativeCells="jupyter.havenativecells",de.HaveNative="jupyter.havenative",de.IsNativeActive="jupyter.isnativeactive",de.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",de.IsPythonOrNativeActive="jupyter.ispythonornativeactive",de.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",de.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",de.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",de.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",de.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",de.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",de.RunByLineCells="jupyter.notebookeditor.runByLineCells",de.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",de.DebugDocuments="jupyter.notebookeditor.debugDocuments",de.IsPythonNotebook="jupyter.ispythonnotebook",de.IsJupyterKernelSelected="jupyter.kernel.isjupyter",de.IsDataViewerActive="jupyter.dataViewerActive",de.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",de.ZmqAvailable="jupyter.zmqavailable",de.ReplayLogLoaded="jupyter.replayLogLoaded",de.KernelSource="jupyter.kernelSource"))(Sr||={});var cm;(c=>(c.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,c.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,c.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",c.HttpPattern=/https?:\/\//,c.ShapeSplitterRegEx=/.*,\s*(\d+).*/,c.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,c.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,c.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(cm||={});var $j=Symbol("DataScienceStartupTime"),OS={major:4,minor:2},qi="application/vnd.jupyter.widget-view+json";var KS=7,Sh="unknown";var LS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},FS=new Map;function Hj(){return FS}function Gj(r,e){let t=e.map(n=>`${JSON.stringify(n)}`).join("-Arg-Separator-");return`KeyPrefix=${r}-Args=${t}`}var lm=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=FS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?FS.get(this.cacheKey)?.data:void 0}set data(e){let t=new LS(this.expiryDurationMs,e);FS.set(this.cacheKey,t)}clear(){FS.delete(this.cacheKey)}};async function Ci(r){return new Promise(e=>{setTimeout(()=>e(r),r)})}async function zw(r,e,t){return new Promise(n=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{r().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),n(a)}})}function xr(r,e,...t){let n=Gw(e)?void 0:e;Gw(e)&&t.push(e);let i,o=setTimeout(()=>i?.(n),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function Ch(r,e,...t){let n,i=setTimeout(()=>n?.(e),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>n=s)])}function um(r){return typeof r?.then=="function"&&typeof r?.catch=="function"}function Gw(r){return typeof r?.then=="function"}var lA=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function le(r=null){return new lA(r)}function Es(r){let e=le();return r.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var xh=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=le(),n=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await n,t.promise}chainFinally(e){let t=le();return this.currentPromise=this.currentPromise.finally(()=>e().then(n=>t.resolve(n)).catch(n=>t.reject(n))),t.promise}};var Je=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};function f(){}function On(r){try{let e=r();um(e)&&e.catch(f)}catch{}}function uA(r,e,t){let n=new Je;try{t&&r(void 0);let i=e();return um(i)?i.then(o=>(r({elapsed:n.elapsedTime,returnValue:o}),o)).catch(o=>{r({elapsed:n.elapsedTime,err:o})}):r({elapsed:n.elapsedTime,returnValue:i}),i}catch(i){throw r({elapsed:n.elapsedTime,err:i}),i}}function zu(r){if(!r)return!0;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function Jn(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function Qj(r){let e=Jn(r)?r:r.uri;return e.scheme.includes(Ul)||e.path.endsWith(".interactive")}function Qu(){return process.platform.toString()==="web"}function zj(r,e){return Jn(e)?e.toString():e}function ya(r,e){return r===e?!0:r&&!e||!r&&e?!1:JSON.stringify(r,zj)===JSON.stringify(e,zj)}var Yj=Hj();function pA(r){return function(e,t,n){let i=n.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;n.value=async function(...a){if(Ar())return i.apply(this,a);let c=Gj(s,a),l=Yj.get(c);if(l&&!l.expired)return E(`Cached data exists ${c}`),Promise.resolve(l.data);let u=i.apply(this,a);return u.then(p=>Yj.set(c,new LS(r,p))).catch(f),u}}}function Lr(r){return function(e,t,n){let i=n.value,o=`Jupyter Extension (Error in ${r||t}, method:${t}):`;n.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(c=>{Ar()||x(o,c)})}catch(a){if(Ar())return;x(o,a)}}}}function Xj(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:n,target:t},c=this;return uA(l=>r(a,l),()=>o.apply(c,s),e)},i}}function wh(){return function(r,e,t){let n=t.value;return t.value=function(...i){if(!Ar())throw new Error(`Function: ${e} can only be called from test code`);return n.apply(this,i)},t}}function dA(){return function(r,e,t){let n=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>n.apply(this,o)):s=n.apply(this,o),this[i]=s;let a=s.then(c=>c).catch(c=>{throw this[i]=void 0,c});return a.catch(f),a},t}}function mA(r,e){if(Array.isArray(r))return r.map(t=>mA(t,e)).join(", ");if(r===void 0)return"undefined";if(r===null)return"null";try{return r&&r.path?`<Uri:${r.path}>`:JSON.stringify(r)}catch{return`<${e} cannot be serialized for logging>`}}function fA(r){if(!r)return"";try{return r.map((t,n)=>{let i=mA(t,"argument");return`Arg ${n+1}: ${i}`}).join(", ")}catch{return""}}function Zj(r){return`Return Value: ${mA(r,"Return value")}`}function Qw(){let r=new Date,e=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0"),n=String(r.getSeconds()).padStart(2,"0"),i=String(r.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${n}.${i}`}function Fe(r,e={removeEmptyEntries:!0,trim:!0}){r=r||"";let t=r.split(/\r?\n/g);return e&&e.trim&&(t=t.map(n=>n.trim())),e&&e.removeEmptyEntries&&(t=t.filter(n=>n.length>0)),t}function US(r){return r&&(r.indexOf(" ")>=0&&!r.startsWith('"')&&!r.endsWith('"')?`"${r}"`:r.toString())}function jS(r){return r&&US(r).replace(/\\/g,"/")}function pm(r){return r&&r.replace(/(^['"])|(['"]$)/g,"")}function ic(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}function Eh(r){return r?r.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():r||""}function Ph(r){let e=r.split(`
`),t=e.find(n=>n.trim().length>0&&!n.trim().startsWith("#"));if(t){let n=t.match(/^\s*/)[0];return e.map(i=>i.startsWith(n)?i.replace(n,""):i).join(`
`)}return r}var xA=require("vscode");var Xw="en",eE=!1,tE=!1,WS=!1,UY=!1,jY=!1,gA=!1,WY=!1,VY=!1,BY=!1,Yw,Zw=Xw,qY,Xu,Ps=typeof self=="object"?self:typeof global=="object"?global:{},ao;typeof Ps.vscode<"u"&&typeof Ps.vscode.process<"u"?ao=Ps.vscode.process:typeof process<"u"&&(ao=process);var e2=typeof ao?.versions?.electron=="string",t2=e2&&ao?.type==="renderer",cSe=t2&&ao?.sandboxed;if(typeof navigator=="object"&&!t2)Xu=navigator.userAgent,eE=Xu.indexOf("Windows")>=0,tE=Xu.indexOf("Macintosh")>=0,VY=(Xu.indexOf("Macintosh")>=0||Xu.indexOf("iPad")>=0||Xu.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,WS=Xu.indexOf("Linux")>=0,gA=!0,Yw=navigator.language,Zw=Yw;else if(typeof ao=="object"){eE=ao.platform==="win32",tE=ao.platform==="darwin",WS=ao.platform==="linux",UY=WS&&!!ao.env.SNAP&&!!ao.env.SNAP_REVISION,WY=e2,BY=!!ao.env.CI||!!ao.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Yw=Xw,Zw=Xw;let r=ao.env.VSCODE_NLS_CONFIG;if(r)try{let e=JSON.parse(r),t=e.availableLanguages["*"];Yw=e.locale,Zw=t||Xw,qY=e._translationsConfigFile}catch{}jY=!0}else console.error("Unable to resolve platform.");var hA=0;tE?hA=1:eE?hA=3:WS&&(hA=2);var VS=eE,r2=tE,n2=WS;var rE=gA,lSe=gA&&typeof Ps.importScripts=="function";var oc=Xu,Yu=Zw,JY;(n=>{function r(){return Yu}n.value=r;function e(){return Yu.length===2?Yu==="en":Yu.length>=3?Yu[0]==="e"&&Yu[1]==="n"&&Yu[2]==="-":!1}n.isDefaultVariant=e;function t(){return Yu==="en"}n.isDefault=t})(JY||={});var uSe=(()=>{if(typeof Ps.postMessage=="function"&&!Ps.importScripts){let r=[];Ps.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let n=0,i=r.length;n<i;n++){let o=r[n];if(o.id===t.data.vscodeScheduleAsyncWork){r.splice(n,1),o.callback();return}}});let e=0;return t=>{let n=++e;r.push({id:n,callback:t}),Ps.postMessage({vscodeScheduleAsyncWork:n},"*")}}return r=>setTimeout(r)})();var $Y=!!(oc&&oc.indexOf("Chrome")>=0),pSe=!!(oc&&oc.indexOf("Firefox")>=0),dSe=!!(!$Y&&oc&&oc.indexOf("Safari")>=0),mSe=!!(oc&&oc.indexOf("Edg/")>=0),fSe=!!(oc&&oc.indexOf("Android")>=0);var dm;if(typeof Ps.vscode<"u"&&typeof Ps.vscode.process<"u"){let r=Ps.vscode.process;dm={get platform(){return r.platform},get arch(){return r.arch},get env(){return r.env},cwd(){return r.cwd()}}}else typeof process<"u"?dm={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:dm={get platform(){return VS?"win32":r2?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var nE=dm.cwd,i2=dm.env,co=dm.platform,ySe=dm.arch;var GY=65,zY=97,QY=90,YY=122,tp=46,$n=47,lo=92,Zu=58,XY=63,iE=class extends Error{constructor(t,n,i){let o;typeof n=="string"&&n.indexOf("not ")===0?(o="must not be",n=n.replace(/^not /,"")):o="must be";let s=t.indexOf(".")!==-1?"property":"argument",a=`The "${t}" ${s} ${o} of type ${n}`;a+=`. Received type ${typeof i}`;super(a);this.code="ERR_INVALID_ARG_TYPE"}};function hn(r,e){if(typeof r!="string")throw new iE(e,"string",r)}function Kt(r){return r===$n||r===lo}function vA(r){return r===$n}function ep(r){return r>=GY&&r<=QY||r>=zY&&r<=YY}function oE(r,e,t,n){let i="",o=0,s=-1,a=0,c=0;for(let l=0;l<=r.length;++l){if(l<r.length)c=r.charCodeAt(l);else{if(n(c))break;c=$n}if(n(c)){if(!(s===l-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==tp||i.charCodeAt(i.length-2)!==tp){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=l,a=0;continue}else if(i.length!==0){i="",o=0,s=l,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${r.slice(s+1,l)}`:i=r.slice(s+1,l),o=l-s-1;s=l,a=0}else c===tp&&a!==-1?++a:a=-1}return i}function o2(r,e){if(e===null||typeof e!="object")throw new iE("pathObject","Object",e);let t=e.dir||e.root,n=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${n}`:`${t}${r}${n}`:n}var En={resolve(...r){let e="",t="",n=!1;for(let i=r.length-1;i>=-1;i--){let o;if(i>=0){if(o=r[i],hn(o,"path"),o.length===0)continue}else e.length===0?o=nE():(o=i2[`=${e}`]||nE(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===lo)&&(o=`${e}\\`));let s=o.length,a=0,c="",l=!1,u=o.charCodeAt(0);if(s===1)Kt(u)&&(a=1,l=!0);else if(Kt(u))if(l=!0,Kt(o.charCodeAt(1))){let p=2,m=p;for(;p<s&&!Kt(o.charCodeAt(p));)p++;if(p<s&&p!==m){let h=o.slice(m,p);for(m=p;p<s&&Kt(o.charCodeAt(p));)p++;if(p<s&&p!==m){for(m=p;p<s&&!Kt(o.charCodeAt(p));)p++;(p===s||p!==m)&&(c=`\\\\${h}\\${o.slice(m,p)}`,a=p)}}}else a=1;else ep(u)&&o.charCodeAt(1)===Zu&&(c=o.slice(0,2),a=2,s>2&&Kt(o.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(e.length>0){if(c.toLowerCase()!==e.toLowerCase())continue}else e=c;if(n){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,n=l,l&&e.length>0)break}return t=oE(t,!n,"\\",Kt),n?`${e}\\${t}`:`${e}${t}`||"."},normalize(r){hn(r,"path");let e=r.length;if(e===0)return".";let t=0,n,i=!1,o=r.charCodeAt(0);if(e===1)return vA(o)?"\\":r;if(Kt(o))if(i=!0,Kt(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){let l=r.slice(c,a);for(c=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return`\\\\${l}\\${r.slice(c)}\\`;a!==c&&(n=`\\\\${l}\\${r.slice(c,a)}`,t=a)}}}else t=1;else ep(o)&&r.charCodeAt(1)===Zu&&(n=r.slice(0,2),t=2,e>2&&Kt(r.charCodeAt(2))&&(i=!0,t=3));let s=t<e?oE(r.slice(t),!i,"\\",Kt):"";return s.length===0&&!i&&(s="."),s.length>0&&Kt(r.charCodeAt(e-1))&&(s+="\\"),n===void 0?i?`\\${s}`:s:i?`${n}\\${s}`:`${n}${s}`},isAbsolute(r){hn(r,"path");let e=r.length;if(e===0)return!1;let t=r.charCodeAt(0);return Kt(t)||e>2&&ep(t)&&r.charCodeAt(1)===Zu&&Kt(r.charCodeAt(2))},join(...r){if(r.length===0)return".";let e,t;for(let o=0;o<r.length;++o){let s=r[o];hn(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let n=!0,i=0;if(typeof t=="string"&&Kt(t.charCodeAt(0))){++i;let o=t.length;o>1&&Kt(t.charCodeAt(1))&&(++i,o>2&&(Kt(t.charCodeAt(2))?++i:n=!1))}if(n){for(;i<e.length&&Kt(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return En.normalize(e)},relative(r,e){if(hn(r,"from"),hn(e,"to"),r===e)return"";let t=En.resolve(r),n=En.resolve(e);if(t===n||(r=t.toLowerCase(),e=n.toLowerCase(),r===e))return"";let i=0;for(;i<r.length&&r.charCodeAt(i)===lo;)i++;let o=r.length;for(;o-1>i&&r.charCodeAt(o-1)===lo;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===lo;)a++;let c=e.length;for(;c-1>a&&e.charCodeAt(c-1)===lo;)c--;let l=c-a,u=s<l?s:l,p=-1,m=0;for(;m<u;m++){let g=r.charCodeAt(i+m);if(g!==e.charCodeAt(a+m))break;g===lo&&(p=m)}if(m!==u){if(p===-1)return n}else{if(l>u){if(e.charCodeAt(a+m)===lo)return n.slice(a+m+1);if(m===2)return n.slice(a+m)}s>u&&(r.charCodeAt(i+m)===lo?p=m:m===2&&(p=3)),p===-1&&(p=0)}let h="";for(m=i+p+1;m<=o;++m)(m===o||r.charCodeAt(m)===lo)&&(h+=h.length===0?"..":"\\..");return a+=p,h.length>0?`${h}${n.slice(a,c)}`:(n.charCodeAt(a)===lo&&++a,n.slice(a,c))},toNamespacedPath(r){if(typeof r!="string")return r;if(r.length===0)return"";let e=En.resolve(r);if(e.length<=2)return r;if(e.charCodeAt(0)===lo){if(e.charCodeAt(1)===lo){let t=e.charCodeAt(2);if(t!==XY&&t!==tp)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(ep(e.charCodeAt(0))&&e.charCodeAt(1)===Zu&&e.charCodeAt(2)===lo)return`\\\\?\\${e}`;return r},dirname(r){hn(r,"path");let e=r.length;if(e===0)return".";let t=-1,n=0,i=r.charCodeAt(0);if(e===1)return Kt(i)?r:".";if(Kt(i)){if(t=n=1,Kt(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return r;a!==c&&(t=n=a+1)}}}}else ep(i)&&r.charCodeAt(1)===Zu&&(t=e>2&&Kt(r.charCodeAt(2))?3:2,n=t);let o=-1,s=!0;for(let a=e-1;a>=n;--a)if(Kt(r.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return r.slice(0,o)},basename(r,e){e!==void 0&&hn(e,"ext"),hn(r,"path");let t=0,n=-1,i=!0,o;if(r.length>=2&&ep(r.charCodeAt(0))&&r.charCodeAt(1)===Zu&&(t=2),e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=t;--o){let c=r.charCodeAt(o);if(Kt(c)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=t;--o)if(Kt(r.charCodeAt(o))){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){hn(r,"path");let e=0,t=-1,n=0,i=-1,o=!0,s=0;r.length>=2&&r.charCodeAt(1)===Zu&&ep(r.charCodeAt(0))&&(e=n=2);for(let a=r.length-1;a>=e;--a){let c=r.charCodeAt(a);if(Kt(c)){if(!o){n=a+1;break}continue}i===-1&&(o=!1,i=a+1),c===tp?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===n+1?"":r.slice(t,i)},format:o2.bind(null,"\\"),parse(r){hn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.length,n=0,i=r.charCodeAt(0);if(t===1)return Kt(i)?(e.root=e.dir=r,e):(e.base=e.name=r,e);if(Kt(i)){if(n=1,Kt(r.charCodeAt(1))){let p=2,m=p;for(;p<t&&!Kt(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&Kt(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&!Kt(r.charCodeAt(p));)p++;p===t?n=p:p!==m&&(n=p+1)}}}}else if(ep(i)&&r.charCodeAt(1)===Zu){if(t<=2)return e.root=e.dir=r,e;if(n=2,Kt(r.charCodeAt(2))){if(t===3)return e.root=e.dir=r,e;n=3}}n>0&&(e.root=r.slice(0,n));let o=-1,s=n,a=-1,c=!0,l=r.length-1,u=0;for(;l>=n;--l){if(i=r.charCodeAt(l),Kt(i)){if(!c){s=l+1;break}continue}a===-1&&(c=!1,a=l+1),i===tp?o===-1?o=l:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=r.slice(s,a):(e.name=r.slice(s,o),e.base=r.slice(s,a),e.ext=r.slice(o,a))),s>0&&s!==n?e.dir=r.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Cr={resolve(...r){let e="",t=!1;for(let n=r.length-1;n>=-1&&!t;n--){let i=n>=0?r[n]:nE();hn(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===$n)}return e=oE(e,!t,"/",vA),t?`/${e}`:e.length>0?e:"."},normalize(r){if(hn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===$n,t=r.charCodeAt(r.length-1)===$n;return r=oE(r,!e,"/",vA),r.length===0?e?"/":t?"./":".":(t&&(r+="/"),e?`/${r}`:r)},isAbsolute(r){return hn(r,"path"),r.length>0&&r.charCodeAt(0)===$n},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){let n=r[t];hn(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":Cr.normalize(e)},relative(r,e){if(hn(r,"from"),hn(e,"to"),r===e||(r=Cr.resolve(r),e=Cr.resolve(e),r===e))return"";let t=1,n=r.length,i=n-t,o=1,s=e.length-o,a=i<s?i:s,c=-1,l=0;for(;l<a;l++){let p=r.charCodeAt(t+l);if(p!==e.charCodeAt(o+l))break;p===$n&&(c=l)}if(l===a)if(s>a){if(e.charCodeAt(o+l)===$n)return e.slice(o+l+1);if(l===0)return e.slice(o+l)}else i>a&&(r.charCodeAt(t+l)===$n?c=l:l===0&&(c=0));let u="";for(l=t+c+1;l<=n;++l)(l===n||r.charCodeAt(l)===$n)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+c)}`},toNamespacedPath(r){return r},dirname(r){if(hn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===$n,t=-1,n=!0;for(let i=r.length-1;i>=1;--i)if(r.charCodeAt(i)===$n){if(!n){t=i;break}}else n=!1;return t===-1?e?"/":".":e&&t===1?"//":r.slice(0,t)},basename(r,e){e!==void 0&&hn(e,"ext"),hn(r,"path");let t=0,n=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=0;--o){let c=r.charCodeAt(o);if(c===$n){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===$n){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){hn(r,"path");let e=-1,t=0,n=-1,i=!0,o=0;for(let s=r.length-1;s>=0;--s){let a=r.charCodeAt(s);if(a===$n){if(!i){t=s+1;break}continue}n===-1&&(i=!1,n=s+1),a===tp?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||n===-1||o===0||o===1&&e===n-1&&e===t+1?"":r.slice(e,n)},format:o2.bind(null,"/"),parse(r){hn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.charCodeAt(0)===$n,n;t?(e.root="/",n=1):n=0;let i=-1,o=0,s=-1,a=!0,c=r.length-1,l=0;for(;c>=n;--c){let u=r.charCodeAt(c);if(u===$n){if(!a){o=c+1;break}continue}s===-1&&(a=!1,s=c+1),u===tp?i===-1?i=c:l!==1&&(l=1):i!==-1&&(l=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||l===0||l===1&&i===s-1&&i===o+1?e.base=e.name=r.slice(u,s):(e.name=r.slice(u,i),e.base=r.slice(u,s),e.ext=r.slice(i,s))}return o>0?e.dir=r.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Cr.win32=En.win32=En;Cr.posix=En.posix=Cr;var xn=co==="win32"?En.normalize:Cr.normalize,kh=co==="win32"?En.isAbsolute:Cr.isAbsolute,Ve=co==="win32"?En.join:Cr.join,s2=co==="win32"?En.resolve:Cr.resolve,sE=co==="win32"?En.relative:Cr.relative,dt=co==="win32"?En.dirname:Cr.dirname,_e=co==="win32"?En.basename:Cr.basename,Ji=co==="win32"?En.extname:Cr.extname,bSe=co==="win32"?En.format:Cr.format,a2=co==="win32"?En.parse:Cr.parse,ISe=co==="win32"?En.toNamespacedPath:Cr.toNamespacedPath,Hn=co==="win32"?En.sep:Cr.sep,Gn=co==="win32"?En.delimiter:Cr.delimiter;var qS=require("vscode");var ZY=require("vscode");var aE=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var BS=class r{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new r(()=>e(this.getValue()))}};function d2(r,e){return r<e?-1:r>e?1:0}function eX(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c<l)return-1;if(c>l)return 1}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function m2(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c===l)continue;if(c>=128||l>=128)return eX(r.toLowerCase(),e.toLowerCase(),t,n,i,o);c2(c)&&(c-=32),c2(l)&&(l-=32);let u=c-l;if(u!==0)return u}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function c2(r){return r>=97&&r<=122}function f2(r,e){return r.length===e.length&&m2(r,e)===0}function h2(r,e){let t=e.length;return e.length>r.length?!1:m2(r,e,0,t)===0}var l2=class r{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new BS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new aE(e=>{function t(u){let p=new Map;for(let m=0;m<u.length;m+=2)p.set(u[m],u[m+1]);return p}function n(u,p){let m=new Map(u);for(let[h,g]of p)m.set(h,g);return m}function i(u,p){if(!u)return p;let m=new Map;for(let[h,g]of u)p.has(h)&&m.set(h,g);return m}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let p=t(o[u]);a=i(a,p)}let c=t(o._common),l=n(c,a);return new r(l)})}static getInstance(e){return r.cache.get(Array.from(e))}static{this._locales=new BS(()=>Object.keys(r.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return r._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},u2=class r{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(r.getRawData())),this._data}static isInvisibleCharacter(e){return r.getData().has(e)}static get codePoints(){return r.getData()}};function rp(r){return r===47||r===92}function yA(r){return r.replace(/[\\/]/g,Cr.sep)}function g2(r){return r.indexOf("/")===-1&&(r=yA(r)),/^[a-zA-Z]:(\/|$)/.test(r)&&(r="/"+r),r}function bA(r,e=Cr.sep){if(!r)return"";let t=r.length,n=r.charCodeAt(0);if(rp(n)){if(rp(r.charCodeAt(1))&&!rp(r.charCodeAt(2))){let o=3,s=o;for(;o<t&&!rp(r.charCodeAt(o));o++);if(s!==o&&!rp(r.charCodeAt(o+1))){for(o+=1;o<t;o++)if(rp(r.charCodeAt(o)))return r.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(tX(n)&&r.charCodeAt(1)===58)return rp(r.charCodeAt(2))?r.slice(0,2)+e:r.slice(0,2);let i=r.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(rp(r.charCodeAt(i)))return r.slice(0,i+1)}return""}function IA(r,e,t,n=Hn){if(r===e)return!0;if(!r||!e||e.length>r.length)return!1;if(t){if(!h2(r,e))return!1;if(e.length===r.length)return!0;let o=e.length;return e.charAt(e.length-1)===n&&o--,r.charAt(o)===n}return e.charAt(e.length-1)!==n&&(e+=n),r.indexOf(e)===0}function tX(r){return r>=65&&r<=90||r>=97&&r<=122}var sc;(ae=>(ae.inMemory="inmemory",ae.vscode="vscode",ae.internal="private",ae.walkThrough="walkThrough",ae.walkThroughSnippet="walkThroughSnippet",ae.http="http",ae.https="https",ae.file="file",ae.mailto="mailto",ae.untitled="untitled",ae.data="data",ae.command="command",ae.vscodeRemote="vscode-remote",ae.vscodeRemoteResource="vscode-remote-resource",ae.vscodeUserData="vscode-userdata",ae.vscodeCustomEditor="vscode-custom-editor",ae.vscodeNotebook="vscode-notebook",ae.vscodeNotebookCell="vscode-notebook-cell",ae.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",ae.vscodeNotebookCellOutput="vscode-notebook-cell-output",ae.vscodeInteractive="vscode-interactive",ae.vscodeInteractiveInput="vscode-interactive-input",ae.vscodeSettings="vscode-settings",ae.vscodeWorkspaceTrust="vscode-workspace-trust",ae.vscodeTerminal="vscode-terminal",ae.webviewPanel="webview-panel",ae.vscodeWebview="vscode-webview",ae.extension="extension",ae.vscodeFileResource="vscode-file",ae.tmp="tmp",ae.vsls="vsls"))(sc||={});function ba(r){return rE?r?.path||"":r?.fsPath||""}var JS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,n=!1){return e===t?0:d2(this.getComparisonKey(e,n),this.getComparisonKey(t,n))}isEqual(e,t,n=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,n)===this.getComparisonKey(t,n)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,n=!1,i=VS?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===sc.file)return IA(ba(e),ba(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(n||e.fragment===t.fragment);if(v2(e.authority,t.authority))return IA(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(n||e.fragment===t.fragment)}return!1}joinPath(e,...t){return qS.Uri.joinPath(e,...t)}basenameOrAuthority(e){return vn(e)||e.authority}basename(e,t){return Cr.basename(e.path,t)}extname(e){return Cr.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===sc.file?t=qS.Uri.file(dt(ba(e))).path:(t=Cr.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===sc.file?t=qS.Uri.file(xn(ba(e))).path:t=Cr.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!v2(e.authority,t.authority))return;if(e.scheme===sc.file){let o=sE(ba(e),ba(t));return VS?yA(o):o}let n=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(n.length,i.length);o<s&&!(n.charCodeAt(o)!==i.charCodeAt(o)&&n.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return Cr.relative(n,i)}resolvePath(e,t){if(e.scheme===sc.file){let n=qS.Uri.file(s2(ba(e),t));return e.with({authority:n.authority,path:n.path})}return t=g2(t),e.with({path:Cr.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&f2(e,t)}hasTrailingPathSeparator(e,t=Hn){if(e.scheme===sc.file){let n=ba(e);return n.length>bA(n).length&&n[n.length-1]===t}else{let n=e.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=Hn){return y2(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=Hn){let n=!1;if(e.scheme===sc.file){let i=ba(e);n=i!==void 0&&i.length===bA(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;n=i.length===1&&i.charCodeAt(i.length-1)===47}return!n&&!y2(e,t)?e.with({path:e.path+"/"}):e}},nr=new JS(()=>!1),LSe=new JS(r=>r.scheme===sc.file?!n2:!0),USe=new JS(r=>!0),wi=nr.isEqual.bind(nr),$S=nr.isEqualOrParent.bind(nr),gn=nr.getComparisonKey.bind(nr),jSe=nr.basenameOrAuthority.bind(nr),vn=nr.basename.bind(nr),np=nr.extname.bind(nr),Ei=nr.dirname.bind(nr),lr=nr.joinPath.bind(nr),WSe=nr.normalizePath.bind(nr),SA=nr.relativePath.bind(nr),VSe=nr.resolvePath.bind(nr),BSe=nr.isAbsolutePath.bind(nr),v2=nr.isEqualAuthority.bind(nr),y2=nr.hasTrailingPathSeparator.bind(nr),qSe=nr.removeTrailingPathSeparator.bind(nr),JSe=nr.addTrailingPathSeparator.bind(nr),nX;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[p,m]=u.split(":");p&&m&&a.set(p,m)});let l=s.path.substring(0,s.path.indexOf(";"));return l&&a.set(o.META_DATA_MIME,l),a}o.parseMetaData=i})(nX||={});function Ur(r=process.platform){return/^win/.test(r)?"Windows":/^darwin/.test(r)?"OSX":/^linux/.test(r)?"Linux":"Unknown"}function Dh(r,e){return r.replace(/^~(?=$|\/|\\)/,e)}function iX(){if(!Qu())return xA.Uri.file(require("os").homedir())}function Te(r){let e=Ur()==="Windows";if(r){let t=ba(r);return t&&t.startsWith(Hn)&&t.length>1&&t[1]!==Hn&&e?t.slice(1):t||""}return""}function $(r,e=[],t){t=t||iX();let n;typeof r=="string"&&(n=xA.Uri.file(r)),typeof r!="string"&&(n=r);let i=b2(n,void 0,t),o=e.map(a=>b2(n,a.uri,t)),s=i;return[i,...o].forEach(a=>{a.length<s.length&&(s=a)}),s}function b2(r,e,t){let n=Ur()==="Windows";if(r&&e&&$S(r,e,!0)){let i=SA(e,r);if(i)return n?i.replace(/\//g,"\\"):i}if(r&&t&&$S(r,t,!0)){let i=SA(t,r);if(i)return i=n?i.replace(/\//g,"\\"):i,`~${Hn}${i}`}return Te(r)}var lE="",I2=3,mm=[];function wA(r){return mm.push(r),{dispose:()=>{mm=mm.filter(e=>e!==r)}}}var sX=new Map([["error",40],["warn",30],["info",20],["debug",10],["none",100],["off",100],[void 0,40]]),Th=10;function EA(r){Th=typeof r=="number"?r:sX.get(r)??40}function S2(r){lE=r.toLowerCase()}function x2(...r){return Th<=5?r:r.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let n=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(n.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&n.push(`Interpreter Id = ${$(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=Fe(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?n.push(o[0]):o.length>1&&s?.length?n.push(s):n.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>n.push(`${o} = ${String(t[o]).trim()}`)),n.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function x(r,...e){Th<=40&&(e=x2(...e),mm.forEach(t=>t.traceError(r,...e)))}function W(r,...e){Th<=30&&(e=x2(...e),mm.forEach(t=>t.traceWarn(r,...e)))}function ee(r,...e){Th<=20&&mm.forEach(t=>t.traceInfo(r,...e))}function E(r,...e){Th<=5&&mm.forEach(t=>t.traceVerbose(r,...e))}function ne(r,...e){if(ni)if(typeof r=="function"){let n=r(),i="",o=[];typeof n=="string"?i=n:(i=n.shift(),o=n),ee(i,...o)}else ee(r,...e)}function oi(r,e=I2){return C2({message:r,opts:e,level:5})}function Rh(r){return C2({message:r,opts:I2,level:40})}var jl=new WeakMap;function Wl(r){return(e,t,n)=>{jl.has(e)||jl.set(e,new Map);let i=jl.get(e);i||jl.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:n,propertyOfParameterToLog:r})}}function ip(){return(r,e,t)=>{jl.has(r)||jl.set(r,new Map);let n=jl.get(r);n||jl.set(r,n=new Map),n.has(e)||n.set(e,[]),n.get(e).push({parameterIndex:t,ignore:!0})}}function C2(r){return Xj((e,t)=>pX(r,t,e),(r.opts&4)>0)}function aX(r){let{kind:e,name:t,args:n}=r;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),n||(n=[]),{kind:e,name:t,args:n,methodName:r.methodName||"",target:r.target||void 0}}function cX(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function CA(r){let e=lE?r.toLowerCase().indexOf(lE):-1;return e===-1?r:`~${r.substring(e+lE.length)}`}function lX(r,e,t,n){if(cX(t))return CA(t.path);if(!t)return t;let o=jl.get(r)?.get(e)?.find(a=>a.parameterIndex===n);if(!o)return typeof t=="string"?CA(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?CA(s):s}function uX(r,e,t){t=aX(t);let n=[r.message];return n.push(`${t.kind} name = ${t.name}`.trim()),e?(n.push(`completed in ${e.elapsed}ms`),n.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):n[n.length-1]=`${n[n.length-1]} (started execution)`,(r.opts&1)===1&&(r.level===5?n.push(fA(t.args.map((i,o)=>t?lX(t.target,t.methodName,i,o):i))):n.push(fA(t.args))),e&&(r.opts&2)===2&&n.push(Zj(e.returnValue)),n.join(", ")}function pX(r,e,t){let n=uX(r,e,t);e?e.err===void 0?r.level&&r.level===40||(r.level?cE(r.level,n):cE(20,n)):cE(40,n,e.err):r.level&&r.level!==40&&cE(r.level,n)}function cE(r,e,...t){switch(r){case 40:x(e,...t);break;case 30:W(e,...t);break;case 20:ee(e,...t);break;case 10:E(e,...t);break;case 5:E(e,...t);break;default:break}}var dr=require("vscode");var ZN=require("vscode");var w2=Symbol("IsDevMode"),Bo=Symbol("IOutputChannel"),E2=Symbol("IS_WINDOWS"),F=Symbol("IDisposableRegistry"),He=Symbol("IGlobalMemento"),bt=Symbol("IGlobalMemento"),si=Symbol("IWorkspaceMemento");var ac=Symbol("IPersistentStateFactory"),uxe=Symbol("IRandom"),ue=Symbol("IConfigurationService"),ut=Symbol("ExtensionContext"),Ia=Symbol("IExtensions"),P2=Symbol("IJupyterExtensionBanner"),uE=Symbol("IFeaturesManager"),Ah=Symbol("ICryptoUtils"),ai=Symbol("IAsyncDisposableRegistry");var Ds=Symbol("IExperimentService"),Nh=Symbol("IDataScienceCommandListener"),Mh=Symbol("IVariableScriptGenerator"),Oh=Symbol("IDataFrameScriptGenerator");var K9=require("vscode");var XW=require("events"),XS=D(O());try{(0,XS.decorate)((0,XS.injectable)(),XW.EventEmitter)}catch(r){W("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",r)}var Pe=class{constructor(e){this.container=e;Pe._instance=this}static get instance(){return Pe._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};Pe=v([(0,XS.injectable)()],Pe);var Dt=require("vscode");var tr=Symbol("IPythonApi"),Ye=Symbol("IPythonExtensionChecker");var w=require("vscode");var ct=require("vscode"),iN=60,oN=iN*60,ZS=oN*24,ZW=ZS*7,eV=ZS*30,tV=ZS*365;function Bh(r,e,t,n){typeof r!="number"&&(r=r.getTime());let i=Math.round((new Date().getTime()-r)/1e3);if(i<-30)return ct.l10n.t("in {0}",Bh(new Date().getTime()+i*1e3,!1));if(!n&&i<30)return ct.l10n.t("now");let o;return i<iN?(o=i,e?o===1?t?ct.l10n.t("{0} second ago",o):ct.l10n.t("{0} sec ago",o):t?ct.l10n.t("{0} seconds ago",o):ct.l10n.t("{0} secs ago",o):o===1?t?ct.l10n.t("{0} second",o):ct.l10n.t("{0} sec",o):t?ct.l10n.t("{0} seconds",o):ct.l10n.t("{0} secs",o)):i<oN?(o=Math.floor(i/iN),e?o===1?t?ct.l10n.t("{0} minute ago",o):ct.l10n.t("{0} min ago",o):t?ct.l10n.t("{0} minutes ago",o):ct.l10n.t("{0} mins ago",o):o===1?t?ct.l10n.t("{0} minute",o):ct.l10n.t("{0} min",o):t?ct.l10n.t("{0} minutes",o):ct.l10n.t("{0} mins",o)):i<ZS?(o=Math.floor(i/oN),e?o===1?t?ct.l10n.t("{0} hour ago",o):ct.l10n.t("{0} hr ago",o):t?ct.l10n.t("{0} hours ago",o):ct.l10n.t("{0} hrs ago",o):o===1?t?ct.l10n.t("{0} hour",o):ct.l10n.t("{0} hr",o):t?ct.l10n.t("{0} hours",o):ct.l10n.t("{0} hrs",o)):i<ZW?(o=Math.floor(i/ZS),e?o===1?ct.l10n.t("{0} day ago",o):ct.l10n.t("{0} days ago",o):o===1?ct.l10n.t("{0} day",o):ct.l10n.t("{0} days",o)):i<eV?(o=Math.floor(i/ZW),e?o===1?t?ct.l10n.t("{0} week ago",o):ct.l10n.t("{0} wk ago",o):t?ct.l10n.t("{0} weeks ago",o):ct.l10n.t("{0} wks ago",o):o===1?t?ct.l10n.t("{0} week",o):ct.l10n.t("{0} wk",o):t?ct.l10n.t("{0} weeks",o):ct.l10n.t("{0} wks",o)):i<tV?(o=Math.floor(i/eV),e?o===1?t?ct.l10n.t("{0} month ago",o):ct.l10n.t("{0} mo ago",o):t?ct.l10n.t("{0} months ago",o):ct.l10n.t("{0} mos ago",o):o===1?t?ct.l10n.t("{0} month",o):ct.l10n.t("{0} mo",o):t?ct.l10n.t("{0} months",o):ct.l10n.t("{0} mos",o)):(o=Math.floor(i/tV),e?o===1?t?ct.l10n.t("{0} year ago",o):ct.l10n.t("{0} yr ago",o):t?ct.l10n.t("{0} years ago",o):ct.l10n.t("{0} yrs ago",o):o===1?t?ct.l10n.t("{0} year",o):ct.l10n.t("{0} yr",o):t?ct.l10n.t("{0} years",o):ct.l10n.t("{0} yrs",o))}var nV=D(O());var qh=class{async createHash(e,t="SHA-256"){return wa(e,t)}};qh=v([(0,nV.injectable)()],qh);var VE={},rV=!1,BE;typeof window=="object"?BE=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?BE=self.crypto:BE=require("node:crypto").webcrypto;async function wa(r,e){let t=r.includes("/")||r.includes("\\")||r.endsWith(".interactive");if(t&&VE[r])return VE[r];let n=await Yre(r,e);return t&&!rV&&(Object.keys(VE).length>1e4&&(rV=!0),VE[r]=n),n}async function Yre(r,e){let t=new TextEncoder().encode(r),n=await BE.subtle.digest({name:e},t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}function ap(r){if(typeof r=="string")try{let[e,t,n]=`${r.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?"":isNaN(t)?e.toString():isNaN(n)?`${e}.${t}`:`${e}.${t}.${n}`}catch(e){return x(`Failed to parse version ${r}`,e),""}return r?`${r.major}.${r.minor}.${r.micro}`:""}async function It(r){return wa(r,"SHA-256")}var sN=D(iV());var ex=require("vscode");function jr(r){let e=Nr(r);if(e){let c=[];typeof e.version?.major=="number"&&(c.push(e.version.major.toString()),typeof e.version.minor=="number"&&(c.push(e.version.minor.toString()),typeof e.version.micro=="number"&&c.push(e.version.micro.toString())));let l=c.length?c.join("."):"",u=e.environment?.name||(e.environment?vn(e.environment?.folderUri):""),p=l?`Python ${l}`:"Python";return wr(r)&&u?u:u?`${u} (${p})`:p}if(Object.keys(r).length===1&&r.id)return r.id;let t=ap(Gi(r)||"").trim(),n=wr(r),i=t?`Python ${t}`:"Python",o=qo(r);if(n&&o)return o;let s=[];o&&s.push(o);let a=Be(r);return a&&a!=="Unknown"&&s.push(a),[i,s.length?`(${s.join(": ")})`:""].join(" ").trim()}function qo(r){let e=Nr(r),t=e?.environment?.name;return!t&&e?.environment?.folderUri&&Be(r)==="Conda"&&(t=vn(e?.environment?.folderUri)),t}var ene=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Be(r){let e=Nr(r);return e?tne(e):"Unknown"}function tne(r){if(r.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,n]of e)if(r.tools.includes(t))return n;if(r.environment?.type==="VirtualEnvironment")return"VirtualEnv";for(let t of ene)if(r.tools.some(n=>n.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}var fo;function oV(r){fo=r}function wr(r){if(!r||!fo)return!1;let e=Nr(r);return e&&Be(e)==="Conda"&&!e.executable.uri}function Nr(r){if(r){if(!fo)throw new Error("Python API not initialized");return fo.environments.known.find(e=>e.id===r.id)}}async function Ea(r){if(!r?.id)return;if(fo){let n=fo.environments.known.find(i=>i.id===r.id);if(n?.executable?.sysPrefix)return n.executable.sysPrefix}let t=await(await sN.PythonExtension.api()).environments.resolveEnvironment(r.id).then(n=>n?.executable?.sysPrefix);return t||W(`Unable to find sysPrefix for interpreter ${$(r.id)}`),t}function Jh(r){if(!r?.id)return;if(!fo)throw new Error("Python API not initialized");return fo.environments.known.find(t=>t.id===r.id)?.executable?.sysPrefix}async function lp(r,e=!1){if(!r?.id)return;if(fo&&!e){let i=fo.environments.known.find(o=>o.id===r.id);if(i?.version)return i.version}let n=await(await sN.PythonExtension.api()).environments.resolveEnvironment(r.id);return n?.version||W(`Unable to find Version for interpreter ${$(r.id)}`),n?.version}function Gi(r){if(!r?.id)return;if(!fo)throw new Error("Python API not initialized");return fo.environments.known.find(t=>t.id===r.id)?.version}function ho(){return fo?fo.environments.known:[]}function Ti(r){if(!r)return;let e,t=r.id;if(r.executable.uri)e=r.executable.uri;else if(Be(r)==="Conda")e=Ur()==="Windows"?ex.Uri.joinPath(r.environment?.folderUri||ex.Uri.file(r.path),"python.exe"):ex.Uri.joinPath(r.environment?.folderUri||ex.Uri.file(r.path),"bin","python");else{W(`Python environment ${$(r.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function rne(r){return jr(r)}var ve;(k=>(k.bannerLabelYes=w.l10n.t("Yes"),k.bannerLabelNo=w.l10n.t("No"),k.canceled=w.l10n.t("Canceled"),k.cancel=w.l10n.t("Cancel"),k.ok=w.l10n.t("Ok"),k.refresh=w.l10n.t("Refresh"),k.refreshing=w.l10n.t("Refreshing..."),k.install=w.l10n.t("Install"),k.loadingExtension=w.l10n.t("Jupyter Extension loading..."),k.handleExtensionActivationError=w.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),k.doNotShowAgain=w.l10n.t("Do not show again"),k.reload=w.l10n.t("Reload"),k.moreInfo=w.l10n.t("More Info"),k.learnMore=w.l10n.t("Learn more"),k.and=w.l10n.t("and"),k.reportThisIssue=w.l10n.t("Report this issue"),k.clickHereForMoreInfoWithHtml=A=>w.l10n.t("Click <a href='{0}'>here</a> for more info.",A)))(ve||={});var up;(t=>(t.notInGroup=n=>w.l10n.t("User does not belong to experiment group '{0}'",n),t.inGroup=n=>w.l10n.t("User belongs to experiment group '{0}'",n)))(up||={});var aN;(e=>e.jupyter=w.l10n.t("Jupyter"))(aN||={});var cN;(e=>e.currentWorkingDirectory="cwd:")(cN||={});var lN;(e=>e.bannerMessage=w.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(lN||={});var uN;(e=>e.bannerMessage=w.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(uN||={});var qE;(t=>(t.bannerLabelYes=w.l10n.t("Yes, take survey now"),t.bannerLabelNo=w.l10n.t("No, thanks")))(qE||={});var b;(_=>(_.warnWhenSelectingKernelWithUnSupportedPythonVersion=w.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),_.installingPythonExtension=w.l10n.t("Installing Python extension and locating kernels."),_.pythonExtensionRequired=w.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),_.rendererExtensionRequired=w.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),_.rendererExtension1015Required=w.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),_.pythonExtensionInstalled=w.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),_.unknownPackage=w.l10n.t("unknown"),_.interactiveWindowTitleFormat=j=>w.l10n.t("Interactive - {0}",j),_.interactiveWindowModeBannerTitle=w.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),_.interactiveWindowModeBannerSwitchYes=w.l10n.t("Yes"),_.interactiveWindowModeBannerSwitchNo=w.l10n.t("No"),_.dataExplorerTitle=w.l10n.t("Data Viewer"),_.badWebPanelFormatString=j=>w.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[j],comment:["Only translate the text within the HTML tags"]}),_.installingMissingDependencies=w.l10n.t("Installing missing dependencies"),_.validatingKernelDependencies=w.l10n.t("Validating kernel dependencies"),_.performingExport=w.l10n.t("Performing Export"),_.exportNotebookToPython=w.l10n.t("Exporting Notebook to Python"),_.sessionDisposed=w.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),_.passwordFailure=w.l10n.t("Failed to connect to password protected server. Check that password is correct."),_.incorrectPassword=w.l10n.t("Incorrect Password."),_.exportDialogFilter=w.l10n.t("Jupyter Notebooks"),_.exportDialogComplete=j=>w.l10n.t("Notebook written to {0}",j),_.exportDialogFailed=j=>w.l10n.t("Failed to export notebook. {0}",j),_.exportOpenQuestion1=w.l10n.t("Open in editor"),_.runCellLensCommandTitle=w.l10n.t("Run Cell"),_.importDialogTitle=w.l10n.t("Import Jupyter Notebook"),_.importDialogFilter="Jupyter Notebooks",_.notebookCheckForImportNo=w.l10n.t("Later"),_.libraryRequiredToLaunchJupyterNotInstalled=j=>w.l10n.t("Running cells requires {0} package.",j),_.librariesRequiredToLaunchJupyterNotInstalled=j=>w.l10n.t("Running cells requires {0} package.",j),_.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(j,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package.",j,Ze),_.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(j,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package.",j,Ze),_.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(j,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",j,Ze),_.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(j,Ze)=>w.l10n.t("Running cells with '{0}' requires the {1} package.",j,Ze),_.installPackageInstructions=(j,Ze)=>w.l10n.t(`Run the following command to install '{0}' into the Python environment. 
Command: '{1}'`,j,Ze),_.pythonCondaKernelsWithoutPython=w.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),_.selectJupyterInterpreter=w.l10n.t("Select an Interpreter to start Jupyter"),_.jupyterInstall=w.l10n.t("Install"),_.currentlySelectedJupyterInterpreterForPlaceholder=j=>w.l10n.t("Selected Environment {0}",j),_.jupyterNotSupported=j=>w.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",j),_.jupyterNotebookNotInstalledOrNotFound=j=>{if(j){let Ze=rne(j);return w.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",Ze)}else return w.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},_.jupyterNotSupportedBecauseOfEnvironment=(j,Ze)=>w.l10n.t("Activating {0} to run Jupyter failed with {1}",j,Ze),_.jupyterNbConvertNotSupported=w.l10n.t("Jupyter nbconvert is not installed"),_.jupyterLaunchTimedOut=w.l10n.t("The Jupyter notebook server failed to launch in time"),_.jupyterLaunchNoURL=w.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),_.jupyterSelfCertFail=j=>w.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,j),_.jupyterExpiredCertFail=j=>w.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,j),_.jupyterSelfCertFailErrorMessageOnly=w.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),_.jupyterSelfCertExpiredErrorMessageOnly=w.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),_.jupyterSelfCertEnable=w.l10n.t("Yes, connect anyways"),_.jupyterSelfCertClose=w.l10n.t("No, close the connection"),_.pythonInteractiveHelpLink=w.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),_.importingFormat=j=>w.l10n.t("Importing {0}",j),_.startingJupyter=w.l10n.t("Starting Jupyter Server"),_.connectingToKernel=j=>w.l10n.t("Connecting to kernel: {0}",j),_.connectingToJupyter=w.l10n.t("Connecting to Jupyter Server"),_.exportingFormat=j=>w.l10n.t("Exporting {0}",j),_.runAllCellsLensCommandTitle=w.l10n.t("Run All Cells"),_.runAllCellsAboveLensCommandTitle=w.l10n.t("Run Above"),_.runCellAndAllBelowLensCommandTitle=w.l10n.t("Run Below"),_.restartKernelMessage=w.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),_.restartKernelMessageYes=w.l10n.t("Restart"),_.restartKernelMessageDontAskAgain=w.l10n.t("Don't Ask Again"),_.automaticallyReconnectingToAKernelProgressMessage=j=>w.l10n.t("Reconnecting to the kernel {0}",j),_.restartingKernelStatus=j=>w.l10n.t("Restarting Kernel {0}",j),_.interruptingKernelFailed=w.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),_.sessionStartFailedWithKernel=j=>w.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyter=j=>w.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyterWithErrorInfo=(j,Ze)=>w.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[j,Ze],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyterDueToOutdatedTraitlets=(j,Ze)=>w.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[j,Ze],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),_.failedToStartKernel=w.l10n.t("Failed to start the Kernel."),_.failedToRestartKernel=w.l10n.t("Failed to restart the Kernel."),_.failedToInterruptKernel=w.l10n.t("Failed to interrupt the Kernel."),_.rawKernelStartFailedDueToTimeout=j=>w.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.rawKernelStartFailedDueToTimeoutWaitingForPort=j=>w.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.viewJupyterLogForFurtherInfo=w.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.kernelDied=j=>w.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.kernelDiedWithoutError=j=>w.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.failedToStartAnUntrustedKernelSpec=(j,Ze)=>w.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[j,Ze],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),_.kernelDiedWithoutErrorAndAutoRestarting=j=>w.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[j],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.kernelCrashedDueToCodeInCurrentOrPreviousCell=w.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.kernelDisconnected=j=>w.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",j),_.cannotRunCellKernelIsDead=j=>w.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",j),_.showJupyterLogs=w.l10n.t("Show Jupyter Logs."),_.restartKernel=w.l10n.t("Restart Kernel"),_.reloadRequired=w.l10n.t("Please reload the window for new settings to take effect."),_.restartedKernelHeader=j=>w.l10n.t("Restarted {0}",j),_.connectedKernelHeader=j=>w.l10n.t("Connected to {0}",j),_.restartingKernelCustomHeader=j=>w.l10n.t("_Restarting {0}..._",j),_.restartingKernelHeader=w.l10n.t("_Restarting kernel..._"),_.startingNewKernelHeader=w.l10n.t("_Connecting to kernel..._"),_.startingNewKernelCustomHeader=j=>w.l10n.t("_Connecting to {0}..._",j),_.noKernelConnected=w.l10n.t("No kernel connected"),_.jupyterSelectUriCommandLabel=w.l10n.t("Enter the URL of the running Jupyter Server..."),_.jupyterSelectUriInputTitle=w.l10n.t("Enter the URL of the running Jupyter Server"),_.jupyterSelectUriInputPlaceholder=w.l10n.t("Enter the url of the running Jupyter Server"),_.connectToToTheJupyterServer=j=>w.l10n.t("Connect to the Jupyter Server {0}",j),_.enterOrSelectRemoteJupyterPlaceholder=w.l10n.t("Enter a remote url, or select a remote server"),_.selectRemoteJupyterPlaceholder=w.l10n.t("Select a remote server"),_.jupyterServerLastConnectionForQuickPickDescription=j=>w.l10n.t("Last connected {0}",Bh(j,!0,!1,!1)),_.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=w.l10n.t("Jupyter Servers"),_.jupyterSelectURIInvalidURI=w.l10n.t("Invalid URL specified"),_.jupyterSelectURIMustBeHttpOrHttps=w.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),_.jupyterSelectLiveRemoteKernelDescription=(j,Ze)=>j?Ze===0?w.l10n.t("Last activity {0}",Bh(j,!0,!1,!1)):Ze===1?w.l10n.t("Last activity {0}, 1 connection",Bh(j,!0,!1,!1)):w.l10n.t("Last activity {0}, {1} connections",Bh(j,!0,!1,!1),Ze.toString()):Ze===0?"":Ze===1?w.l10n.t("1 connection"):w.l10n.t("{0} connections",Ze.toString()),_.installJupyterHub=w.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),_.useJupyterHubExtension=w.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),_.useJupyterHubExtensionDetail=w.l10n.t("Use this option when connecting to JupyterHub servers"),_.installJupyterHubDetail=w.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),_.jupyterSelectUserAndPasswordTitle=w.l10n.t("Enter your user name and password to connect to Jupyter Hub"),_.jupyterRenameServer=w.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),_.jupyterServerUriDisplayNameInputPlaceholder=w.l10n.t("Enter a display name"),_.jupyterSelectUserPrompt=w.l10n.t("Enter your user name"),_.jupyterSelectPasswordPrompt=w.l10n.t("Enter your password"),_.jupyterSelectPasswordTitle=w.l10n.t("Enter your password for the Jupyter Server"),_.pythonNotInstalled=w.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),_.pleaseReloadVSCodeOncePythonHasBeenInstalled=w.l10n.t("Upon installing Python please reload VS Code."),_.jupyterNotebookFailure=j=>w.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,j),_.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=j=>w.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",j),_.remoteJupyterConnectionFailedWithServerWithError=(j,Ze)=>w.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",j,Ze),_.remoteJupyterConnectionFailedWithServer=j=>w.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",j),_.remoteJupyterConnectionFailedWithoutServerWithError=j=>w.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",j),_.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=j=>w.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,j),_.removeRemoteJupyterConnectionButtonText=w.l10n.t("Forget Connection"),_.jupyterNotebookRemoteConnectFailedWeb=j=>w.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,j),_.packageNotInstalledWindowsLongPathNotEnabledError=(j,Ze)=>w.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,j,Ze),_.changeRemoteJupyterConnectionButtonText=w.l10n.t("Manage Connections"),_.rawConnectionBrokenError=w.l10n.t("Direct kernel connection broken"),_.jupyterServerCrashed=j=>w.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,j.toString()),_.jupyterKernelSpecModuleNotFound=j=>w.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,j),_.interruptKernelStatus=j=>w.l10n.t("Interrupting Kernel {0}",j),_.exportPythonQuickPickLabel=w.l10n.t("Python Script"),_.exportHTMLQuickPickLabel=w.l10n.t("HTML"),_.exportPDFQuickPickLabel=w.l10n.t("PDF"),_.restartKernelAfterInterruptMessage=j=>w.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",j),_.documentMismatch=j=>w.l10n.t("Cannot run cells, duplicate documents for {0} found.",j),_.jupyterGetVariablesBadResults=w.l10n.t("Failed to fetch variable info from the Jupyter Server."),w.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),_.jupyterGetVariablesExecutionError=j=>w.l10n.t(`Failure during variable extraction: \r
{0}`,j),_.selectKernel=w.l10n.t("Change Kernel"),_.selectDifferentKernel=w.l10n.t("Select a different Kernel"),_.kernelFilterPlaceholder=w.l10n.t("Choose the kernels that are available in the kernel picker."),_.recommendedItemCategoryInQuickPick=w.l10n.t("Recommended"),_.selectedKernelCategoryInQuickPick=w.l10n.t("Selected"),_.createPythonEnvironmentInQuickPick=w.l10n.t("Create Python Environment"),_.createPythonEnvironmentInQuickPickTooltip=w.l10n.t("Create an isolated Python Environment per workspace folder"),_.selectDifferentJupyterInterpreter=w.l10n.t("Change Interpreter"),_.pandasTooOldForViewingFormat=(j,Ze)=>w.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[j,Ze],comment:["Do not translate 'pandas' as that is a Python module name"]}),_.pandasRequiredForViewing=j=>w.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[j],comment:["Do not translate 'pandas' as that is a Python module name"]}),_.tooManyColumnsMessage=w.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),_.tooManyColumnsYes=w.l10n.t("Yes"),_.tooManyColumnsNo=w.l10n.t("No"),_.tooManyColumnsDontAskAgain=w.l10n.t("Don't Ask Again"),_.plotViewerTitle=w.l10n.t("Plots"),_.exportPlotTitle=w.l10n.t("Save plot image"),_.pdfFilter="PDF",_.pngFilter="PNG",_.svgFilter="SVG",_.exportImageFailed=j=>w.l10n.t("Error exporting image: {0}",j),_.jupyterDataRateExceeded=w.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),_.addCellBelowCommandTitle=w.l10n.t("Add cell"),_.debugCellCommandTitle=w.l10n.t("Debug Cell"),_.debugStepOverCommandTitle=w.l10n.t("Step over"),_.debugContinueCommandTitle=w.l10n.t("Continue"),_.debugStopCommandTitle=w.l10n.t("Stop"),_.runCurrentCellAndAddBelow=w.l10n.t("Run current cell and add empty cell below"),_.jupyterDebuggerNotInstalledError=j=>w.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",j),_.jupyterDebuggerOutputParseError=j=>w.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",j),_.cellStopOnErrorMessage=w.l10n.t("Cell was canceled due to an error in a previous cell."),_.scrollToCellTitleFormatMessage=j=>w.l10n.t("Go to [{0}]",j.toString()),_.instructionComments=j=>w.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,j),_.exportButtonTitle=w.l10n.t("Export"),_.exportAsQuickPickPlaceholder=w.l10n.t("Export As..."),_.openExportedFileMessage=w.l10n.t("Would you like to open the exported file?"),_.openExportFileYes=w.l10n.t("Yes"),_.openExportFileNo=w.l10n.t("No"),_.exportFailedGeneralMessage=w.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.exportToPDFDependencyMessage=w.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),_.failedExportMessage=w.l10n.t("Export failed."),_.startingJupyterLogMessage=(j,Ze)=>w.l10n.t("Starting Jupyter from {0} with arguments {1}",j,Ze),_.waitingForJupyterSessionToBeIdle=w.l10n.t("Waiting for Jupyter Session to be idle"),_.gettingListOfKernelsForRemoteConnection=w.l10n.t("Fetching Kernels"),_.gettingListOfKernelSpecs=w.l10n.t("Fetching Kernel specs"),_.startingJupyterNotebook=w.l10n.t("Starting Jupyter Notebook"),_.registeringKernel=w.l10n.t("Registering Kernel"),_.jupyterCommandLineReloadQuestion=w.l10n.t("Please reload the window when changing the Jupyter command line."),_.jupyterCommandLineReloadAnswer=w.l10n.t("Reload"),_.createdNewKernel=(j,Ze)=>w.l10n.t("{0}: Kernel started: {1}",j,Ze),_.kernelInvalid=j=>w.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",j),_.removeRemoteJupyterServerEntryInQuickPick=w.l10n.t("Remove"),_.loadClassFailedWithNoInternet=(j,Ze)=>w.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",j,Ze),_.useCDNForWidgetsNoInformation=w.l10n.t("Widgets require us to download supporting files from a 3rd party website."),_.enableCDNForWidgetsSetting=(j,Ze)=>w.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",j,Ze),_.enableCDNForWidgetsButton=w.l10n.t("Enable Downloads"),_.unhandledMessage=(j,Ze)=>w.l10n.t("Unhandled kernel message from a widget: {0} : {1}",j,Ze),_.cdnWidgetScriptNotAccessibleWarningMessage=(j,Ze)=>w.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",j,Ze),_.widgetScriptNotFoundOnCDNWidgetMightNotWork=(j,Ze,qw)=>w.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",j,Ze,qw),_.insecureSessionMessage=w.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),_.insecureSessionDenied=w.l10n.t("Denied connection to insecure server."),_.selectKernelForEditor=w.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),_.needIpykernel6=w.l10n.t("Ipykernel setup required for this feature"),_.setup=w.l10n.t("Setup"),_.showDataViewerFail=w.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),_.defaultNotebookName=w.l10n.t("default"),_.recommendExtensionForNotebookLanguage=(j,Ze)=>w.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",j,Ze),_.kernelWasNotStarted=w.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),_.noNotebookToDebug=w.l10n.t("No active notebook document to debug."),_.cantStartDebugging=w.l10n.t("Can't start debugging."),_.restartNotSupported=w.l10n.t("Restarting is not supported in the interactive window."),_.importingIpynb=w.l10n.t("Importing notebook file"),_.exportingToFormat=j=>w.l10n.t("Exporting to {0}",j),_.kernelCategoryForJupyterSession=w.l10n.t("Jupyter Session"),_.kernelDefaultRemoteDisplayName=w.l10n.t("Remote"),_.kernelCategoryForJupyterKernel=w.l10n.t("Jupyter Kernel"),_.kernelCategoryForRemoteJupyterKernel=w.l10n.t("Jupyter Kernel"),_.kernelCategoryForConda=w.l10n.t("Conda Env"),_.kernelCategoryForCondaWithoutPython=w.l10n.t("Conda Env Without Python"),_.kernelCategoryForPoetry=w.l10n.t("Poetry Env"),_.kernelCategoryForPipEnv=w.l10n.t("Pipenv Env"),_.kernelCategoryForPyEnv=w.l10n.t("PyEnv Env"),_.kernelCategoryForGlobal=w.l10n.t("Global Env"),_.kernelCategoryForVirtual=w.l10n.t("Virtual Env"),_.fileSeemsToBeInterferingWithKernelStartup=j=>w.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",j),_.moduleSeemsToBeInterferingWithKernelStartup=j=>w.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",j),_.pipCondaInstallHoverWarning=(j,Ze)=>w.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",j,Ze),_.percentPipCondaInstallInsteadOfBang=j=>w.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[j],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),_.replacePipCondaInstallCodeAction=j=>w.l10n.t("Replace with '%{0} install'",j),_.failedToStartKernelDueToMissingModule=j=>w.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",j),_.failedToStartKernelDueToImportFailure=j=>w.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",j),_.failedToStartKernelDueToImportFailureFromFile=(j,Ze)=>w.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",j,Ze),_.failedToStartKernelDueToUnknownDllLoadFailure=w.l10n.t("The kernel failed to start as a dll could not be loaded."),_.failedToStartKernelDueToDllLoadFailure=j=>w.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",j),_.failedToStartKernelDueToWin32APIFailure=w.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),_.failedToStartKernelDueToPyZmqFailure=w.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),_.failedToStartKernelDueToOldIPython=w.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),_.failedToStartKernelDueToOldIPyKernel=w.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),_.failedToStartKernelDueToMissingPythonEnv=j=>w.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",j),_.matplotlibWidgetInsteadOfOther=w.l10n.t("'%matplotlib' widget works best inside of VS Code"),_.matplotlibWidgetCodeActionTitle=w.l10n.t("More info"),_.allowExtensionToUseJupyterKernelApi=(j,Ze)=>w.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",j,Ze),_.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=j=>w.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",j),_.activatingPythonEnvironment=j=>w.l10n.t("Activating Python Environment '{0}'",j),_.runningKernelStartupHooksFor=j=>w.l10n.t("Running Kernel startup hooks in '{0}'",j),_.cellAtFormat=(j,Ze)=>w.l10n.t("{0} Cell {1}",j,Ze),_.jupyterServerConsoleOutputChannel=w.l10n.t("Jupyter Server Console"),_.kernelConsoleOutputChannel=j=>w.l10n.t("{0} Kernel Console Output",j),_.webNotSupported=w.l10n.t("Operation not supported in web version of Jupyter Extension."),_.failedToInstallPythonExtension=w.l10n.t("Failed to install the Python Extension."),_.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=j=>w.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",j),_.listOfFilesWithLinksThatMightNeedToBeRenamed=j=>w.l10n.t("File(s): {0} might need to be renamed.",j),_.failedToGetVersionOfPandas=w.l10n.t("Failed to get version of Pandas to use the Data Viewer."),_.failedToInstallPandas=w.l10n.t("Failed to install Pandas to use the Data Viewer."),_.localKernelSpecs=w.l10n.t("Jupyter Kernel..."),_.localPythonEnvironments=w.l10n.t("Python Environments..."),_.quickPickTitleForSelectionOfJupyterServer=w.l10n.t("Select a Jupyter Server"),_.UserJupyterServerUrlProviderDisplayName=w.l10n.t("Existing Jupyter Server..."),_.UserJupyterServerUrlProviderDetail=w.l10n.t("Connect to an existing Jupyter Server"),_.kernelPickerSelectKernelTitle=w.l10n.t("Select Kernel"),_.kernelPickerSelectLocalKernelSpecTitle=w.l10n.t("Select a Jupyter Kernel"),_.quickPickSelectPythonEnvironmentTitle=w.l10n.t("Select a Python Environment"),_.kernelPickerSelectKernelFromRemoteTitle=j=>w.l10n.t("Select a Kernel from {0}",j),_.kernelPickerSelectKernelFromRemoteTitleWithoutName=w.l10n.t("Select a Jupyter Kernel"),_.installPythonExtensionViaKernelPickerTitle=w.l10n.t("Install Python Extension"),_.installPythonExtensionViaKernelPickerToolTip=w.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),_.installPythonQuickPickTitle=w.l10n.t("Install Python"),_.installPythonQuickPickToolTip=w.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),_.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=w.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),_.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=w.l10n.t("Ensure the server is running and reachable."),_.dataViewerDeprecationMessage=w.l10n.t("The Data Viewer will be deprecated in coming months. Please install other data viewing extensions."),_.dataViewerDeprecationRecommendationActionMessage=w.l10n.t("See Recommended Extensions.")))(b||={});var qt;(X=>(X.collapseSingle=w.l10n.t("Collapse"),X.expandSingle=w.l10n.t("Expand"),X.noRowsInDataViewer=w.l10n.t("No rows match current filter"),X.sliceIndexError=w.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),X.sliceMismatchedAxesError=w.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),X.fetchingDataViewer=w.l10n.t("Fetching data ..."),X.dataViewerHideFilters=w.l10n.t("Hide filters"),X.dataViewerShowFilters=w.l10n.t("Show filters"),X.refreshDataViewer=w.l10n.t("Refresh data viewer"),X.sliceSummaryTitle=w.l10n.t("SLICING"),X.sliceData=w.l10n.t("Slice Data"),X.sliceSubmitButton=w.l10n.t("Apply"),X.sliceDropdownAxisLabel=w.l10n.t("Axis"),X.sliceDropdownIndexLabel=w.l10n.t("Index"),X.variableExplorerNameColumn=w.l10n.t("Name"),X.variableExplorerTypeColumn=w.l10n.t("Type"),X.variableExplorerCountColumn=w.l10n.t("Size"),X.variableExplorerValueColumn=w.l10n.t("Value"),X.collapseVariableExplorerLabel=w.l10n.t("Variables"),X.variableLoadingValue=w.l10n.t("Loading..."),X.showDataExplorerTooltip=w.l10n.t("Show variable snapshot in data viewer"),X.noRowsInVariableExplorer=w.l10n.t("No variables defined"),X.loadingRowsInVariableExplorer=w.l10n.t("Loading variables"),X.previousPlot=w.l10n.t("Previous"),X.nextPlot=w.l10n.t("Next"),X.panPlot=w.l10n.t("Pan"),X.zoomInPlot=w.l10n.t("Zoom in"),X.zoomOutPlot=w.l10n.t("Zoom out"),X.exportPlot=w.l10n.t("Export to different formats"),X.deletePlot=w.l10n.t("Remove"),X.selectedImageListLabel=w.l10n.t("Selected Image"),X.selectedImageLabel=w.l10n.t("Image"),X.errorOutputExceedsLinkToOpenFormatString=w.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']})))(qt||={});var tx;(n=>(n.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=w.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=w.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=w.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(tx||={});var $h;(n=>(n.noCondaOrPipInstaller=w.l10n.t("There is no Conda or Pip installer available in the selected environment."),n.noPipInstaller=w.l10n.t("There is no Pip installer available in the selected environment."),n.searchForHelp=w.l10n.t("Search for help")))($h||={});var pN;(e=>e.installingModule=t=>w.l10n.t("Installing {0}",t))(pN||={});var Ks=D(O());var rx="Python Kernel Debug Adapter",nx="Python Interactive Window Debug Adapter";var HE=require("node-fetch"),sx=D(sV());var Hh=require("vscode");var et=class extends Error{constructor(t,n){super(n);this.category=t;this.isJupyterError=!0}},ln=class r extends et{constructor(t,n,i){super(i||dN(n),t);this.originalException=n;n&&(this.stack=`${new Error("").stack}

${n.stack}`)}static from(t,n){return n instanceof et?n:new r(t,n)}static unwrap(t){return t&&(t instanceof r&&t.originalException&&t.originalException instanceof et&&(t=t.originalException),t)}};function dN(r){return r&&r instanceof et?r.category:"unknown"}var As=class extends et{constructor(t,n,i){super("jupyterconnection",t+(n?`
${n}`:""));this.interpreter=i}};var yn=class extends et{constructor(){super("sessionDisposed",b.sessionDisposed)}};var JE=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function Gh(r=""){if(!r)return;let e=/\S+Error: /g,t=`${r.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let n=t[0],o=((n.match(e)?n:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function $E(r=""){let e=cV(r);return e?e[1]:void 0}function cV(r=""){if(!r)return;let e=r.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function lV(r){if(!r)return;let t=(Array.isArray(r)?r[0]:r).split(`
`).map(c=>c.trim().toLowerCase()).filter(c=>c.length).reverse().find(c=>c.startsWith("file ")&&c.includes(", line ")&&c.includes(".py")&&c.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function vm(r,e,t,n="",i=[]){let o=e instanceof et?e.stdErr||e.stack||"":e.toString(),s=cV(o),a=o.toLowerCase();if(e instanceof yn)return{reason:"sessionDisposed",message:b.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:b.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:b.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?b.failedToStartKernelDueToDllLoadFailure(u):b.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:b.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:b.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:b.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=aV(s[1]);if(u&&n){let p=one(u.moduleName,u.fileName,r,n);return p||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?b.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):b.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let c="No module named".toLowerCase(),l="is not a package".toLowerCase();if(a.includes(c)&&!l){let u=Fe(o).map(m=>m.trim()).filter(m=>m.length).find(m=>m.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:p,message:b.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(c)&&l){let u=Fe(o).map(y=>y.trim()).filter(y=>y.length).find(y=>y.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"",m="",h="";p.split("'").length>2&&(m=p.split("'").slice(-2)[0]||"",m=m?`${m}.py`:"",h=m||"",p=p.split("'")[1]||p);let g=i.filter(y=>vn(y).toLowerCase()==="__init__.py").map(y=>vn(Ei(y)));return p&&m&&p!==m&&i.some(y=>vn(y).toLowerCase()===m.toLowerCase())?{reason:"overridingBuiltinModules",fileName:m,moduleName:p,message:b.fileSeemsToBeInterferingWithKernelStartup(m),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:p&&g&&p!==h&&g.some(y=>y.toLowerCase()===h.toLowerCase())?{reason:"overridingBuiltinModules",folderName:h,moduleName:p,message:b.moduleSeemsToBeInterferingWithKernelStartup(h),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:p,message:b.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof et&&e.category==="invalidkernel"&&i.length){let u=vn(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:vn(i[0],".py"),message:b.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=aV(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:b.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof As){let u=Fe(o).map(C=>C.trim()).reverse().find(C=>C.toLowerCase().includes("error: ")),p="AttributeError: 'Namespace' object has no attribute '_flags'",m=["jupyter.startup.failure"],h,g="jupyterStartFailure",y=Fe(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(C=>C.toLowerCase().includes("error: "));if(y=y||Fe(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(C=>C.toLowerCase().includes("error: ")),a.includes(p.toLowerCase())?(g="jupyterStartFailureOutdatedTraitlets",u=b.failedToStartJupyterDueToOutdatedTraitlets(t||"",y||""),m.push("outdated.traitlets"),h="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=y?b.failedToStartJupyterWithErrorInfo(t||"",y):b.failedToStartJupyter(t||""),h=void 0),u)return{reason:g,message:u,pythonError:y,moreInfoLink:h,telemetrySafeTags:m}}}function aV(r){r=r.replace(/"/g,"'");let e=r.match(/'[^\\']*(\\'[^\\']*)*'/g),t=r.match(/\((.*?)\)/g),n,i;return e&&e[0].length>2&&(n=e[0],n=n.substring(1,n.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),n?{moduleName:n,fileName:i}:void 0}function one(r,e,t,n){if(n&&t.length!==0&&e&&!e.toLowerCase().startsWith(n)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:r,message:b.fileSeemsToBeInterferingWithKernelStartup($(Hh.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function zh(r){if(!r)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(r))!==null;)t.length===3&&(r=r.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let n=Fe(r,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new Hh.NotebookCellOutput([Hh.NotebookCellOutputItem.error({message:"",name:"",stack:n})])}var sne=[ane,cne];function uV(r){let e=[],t=Array.isArray(r)?r[0].toLowerCase():r.toLowerCase();sne.forEach(i=>i(t,e));let n=vm([],t,void 0);return n?.telemetrySafeTags.length&&e.push(...n.telemetrySafeTags),Array.from(new Set(e)).join(",")}function ane(r,e=[]){r.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function cne(r,e=[]){r.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function pV(){return(new Error().stack||"").split(`
`).filter(r=>r.includes($e))}async function dV(r,e){r.failed=!0,r.failureCategory=r.failureCategory||dN(e);let t=!HE.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||HE.FetchError!==void 0)&&pne(e,t?TypeError:HE.FetchError);r.failureCategory==="unknown"&&i&&(r.failureCategory="fetcherror"),r.stackTrace=lne(e),typeof e=="string"&&(r.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;r.failureSubCategory=r.failureSubCategory||uV(o);let s=lV(o);s&&([r.pythonErrorFile,r.pythonErrorFolder,r.pythonErrorPackage]=await Promise.all([Promise.resolve(r.pythonErrorFile||It(s.fileName)),Promise.resolve(r.pythonErrorFolder||It(s.folderName)),Promise.resolve(r.pythonErrorPackage||It(s.packageName))]))}function mN(r){if(r.stack&&Array.isArray(r.stack)){let e={...r,stack:r.stack.join(`
`)};return sx.parse.call(sx,e)}return sx.parse.call(sx,r)}function lne(r){let e="";for(let t of mN(r)){let n=t.getFileName();if(n){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${une(t)} ${n}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function une(r){let e=[];return typeof r.getTypeName()=="string"&&r.getTypeName().length>0&&e.push(r.getTypeName()),typeof r.getMethodName()=="string"&&r.getMethodName().length>0&&e.push(r.getMethodName()),typeof r.getFunctionName()=="string"&&r.getFunctionName().length>0&&(e.length!==2||e.join(".")!==r.getFunctionName())&&e.push(r.getFunctionName()),e.join(".")}function pne(r,e){return e?r instanceof e||r instanceof ln&&r.originalException instanceof e:(console.error("Error type is not defined",r),!1)}var hV=require("vscode");function dne(){try{return require("vscode")===void 0?!1:gV()!==void 0}catch{return!1}}function zE(){return hV.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}var GE={};function Qh(r,e){let t=r;NS()&&t.startsWith("ds_")||(e===void 0?delete GE[t]:GE[t]=e)}var fN;function gV(){if(fN)return fN;let r=require("@vscode/extension-telemetry").default;return fN=new r(Bj)}function mV(r,e){let t={};return Object.getOwnPropertyNames(e).forEach(n=>{if(!(e[n]===void 0||e[n]===null))try{t[n]=typeof e[n]=="string"?e[n]:typeof e[n]=="object"?"object":e[n].toString()}catch(i){x(`Failed to serialize ${n} for ${r}`,i)}}),t}function N(r,e,t,n){Ar()||!dne()||mne(r,e,t,n)}function mne(r,e,t,n){let i=gV(),o={},s=r;n?(o={},Object.assign(o,GE),Object.assign(o,t||{}),dV(o,n).then(()=>{o=mV(s,o),i.sendTelemetryEvent(s,o,e)}).catch(f)):(t&&(o=mV(s,t)),Object.assign(o,GE),i.sendTelemetryEvent(s,o,e))}var fV=new Set;function fr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a=e||{},c=new Je,l=`${r.toString()}${JSON.stringify(a)}`,u=!fV.has(l);fV.add(l);let p=o.apply(this,s);return p&&typeof p.then=="function"&&typeof p.catch=="function"?p.then(m=>{let h={...a};return u&&(h.firstTime=u),N(r,c?{duration:c?.elapsedTime}:void 0,h),m}).catch(m=>{let h={...a};h.failed=!0,N(r,c?{duration:c?.elapsedTime}:{},h,m)}):N(r,c?{duration:c?.elapsedTime}:void 0,a),p},i}}function Zr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){return N(r,void 0,e),o.apply(this,s)},i}}function fne(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function Nt(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function Jo(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function wc(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function zi(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...Jo()}}}var Pwe={...Nt(),...wc(),...fne()};var hne,gne,vne,yne,bne,Ine,Sne,xne,Cne,wne,Ene,Pne,kne,Dne,_ne,Tne,Rne,Ane,Nne,Mne,One,Kne,Fne,Lne,Une,jne,Wne,Vne,Bne,qne,Jne,$ne,Hne,Gne,zne,Qne,Yne,Xne,Zne,eie,tie,rie,nie,iie,oie,sie,aie,cie,lie,uie,pie,die,mie,fie,hie,gie,vie,yie,bie,Iie,Sie,xie,Cie,wie,Eie,Pie,kie,Die,_ie,Tie,Rie,Aie,Nie,Mie,Oie,Kie,Fie,Lie,Uie,jie,Wie,Vie,Bie,qie,Jie,$ie,Hie,Gie,zie,Qie,Yie,Xie,Zie,eoe,toe,roe,noe,ioe,ooe,soe,aoe,coe,loe,uoe,poe,doe,moe,foe,hoe,goe,voe,yoe,boe,Ioe,Soe,xoe,Coe,woe,Eoe,Poe,koe,Doe,_oe,Toe,Roe,Aoe,Noe,Moe,Ooe,Koe,Foe,Loe,Uoe,joe,Woe,Voe,Boe,qoe,Joe,$oe,Hoe,Goe,zoe,Qoe,Yoe,Xoe,Zoe,ese,tse,rse,nse,ise,ose,sse,ase,cse,lse,use,pse,dse,vV=class{constructor(){this[hne]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[gne]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:Nt()};this[vne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[yne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[bne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Jo()}};this[Ine]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:Nt()};this[Sne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Jo()}};this[xne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:Nt()};this[Cne]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[wne]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[Ene]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[Pne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:Nt()};this[kne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:Nt()};this[Dne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[_ne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Tne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Rne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Ane]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Nne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Mne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...wc(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:Nt()};this[One]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Kne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Fne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Lne]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Une]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:zi().properties,measures:{...Nt()}};this[jne]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[Wne]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[Vne]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Bne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[qne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Jne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[$ne]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Hne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Gne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[zne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Qne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Yne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Xne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Zne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[eie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[tie]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[rie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[nie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[iie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[oie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[sie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[aie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[cie]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[lie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[uie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[pie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[die]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[mie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[fie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[hie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[gie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[vie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[yie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[bie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Iie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Sie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[xie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Cie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[wie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Eie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Pie]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[kie]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Die]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[_ie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Tie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[Rie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Aie]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Nie]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Mie]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Oie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Jo()},measures:Nt()};this[Kie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Fie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:Nt()};this[Lie]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Uie]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[jie]={owner:"IanMatthewHuff",feature:["DataFrameViewer","VariableViewer"],source:"N/A"};this[Wie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[Vie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failedWithoutBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},failedWithBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},localHost:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Bie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[qie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[Jie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:Nt()};this[$ie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Hie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Gie]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...wc(),...Jo()},measures:{...Nt()}};this[zie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Qie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Yie]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[Xie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Zie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:Nt()};this[eoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[toe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[roe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[noe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[ioe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[ooe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[soe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",measures:{totalOverheadInMs:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfMessagesWaitedOn:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},averageWaitTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfRegisteredHooks:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[aoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[coe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[loe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...Nt(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...zi().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[uoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:Nt()};this[poe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...Nt()},properties:{...zi().properties,...wc()}};this[doe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:Nt(),properties:{...zi().properties,...wc(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[moe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...zi().properties,...wc()}};this[foe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...zi().properties,...wc()}};this[hoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:zi().properties};this[goe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...Jo(),...wc(),...zi().properties},measures:{...Nt()}};this[voe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...Jo(),...wc(),...zi().properties},measures:Nt()};this[yoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...Jo(),...wc(),...zi().properties,envMissingReason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isEmptyCondaEnv:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},pythonEnvType:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},fileExists:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[boe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...Jo(),...zi().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[Ioe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Jo(),...zi().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Soe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Jo(),...zi().properties}};this[xoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Jo(),...zi().properties}};this[Coe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[woe]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Eoe]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Poe]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:Nt(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[koe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:Nt()};this[Doe]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[_oe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:Nt()};this[Toe]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:Nt()};this[Roe]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Aoe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Noe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Moe]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ooe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Koe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Foe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Loe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Uoe]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[joe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Woe]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Voe]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Boe]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[qoe]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Joe]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[$oe]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...Nt(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},timesExceededTimeout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Hoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Goe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[zoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Qoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Yoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...Nt()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[Xoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Zoe]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ese]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:Nt()};this[tse]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[rse]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[nse]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...zi().properties,...Jo()}};this[ise]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[ose]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[sse]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[ase]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[cse]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[lse]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:Nt()};this[use]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[pse]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[dse]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"}}static{hne="EXTENSION.LOAD",gne="DS_INTERNAL.EXPERIMENT_LOAD",vne="ENVFILE_VARIABLE_SUBSTITUTION",yne="ENVFILE_WORKSPACE",bne="HASHED_PACKAGE_NAME",Ine="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",Sne="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",xne="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",Cne="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",wne="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",Ene="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",Pne="DATASCIENCE.ADD_CELL_BELOW",kne="DS_INTERNAL.CODE_LENS_ACQ_TIME",Dne="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",_ne="DATASCIENCE.DEBUG_CONTINUE",Tne="DATASCIENCE.DEBUG_CURRENT_CELL",Rne="DATASCIENCE.DEBUG_STEP_OVER",Ane="DATASCIENCE.DEBUG_STOP",Nne="DATASCIENCE.DEBUG_FILE_INTERACTIVE",Mne="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",One="DS_INTERNAL.JUPYTER_KERNEL_SPEC",Kne="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",Fne="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",Lne="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",Une="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",jne="DATASCIENCE.EXPORT_PYTHON_FILE",Wne="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",Vne="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",Bne="DATASCIENCE.EXPORT_NOTEBOOK_AS",qne="DATASCIENCE.IMPORT_NOTEBOOK",Jne="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",$ne="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",Hne="DS_INTERNAL.GET_PASSWORD_FAILURE",Gne="DS_INTERNAL.GET_PASSWORD_SUCCESS",zne="DS_INTERNAL.JUPYTER_HUB_PASSWORD",Qne="DS_INTERNAL.SHOW_DATA_NO_PANDAS",Yne="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",Xne="DS_INTERNAL.SHOW_DATA_PANDAS_OK",Zne="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",eie="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",tie="DATASCIENCE.OPEN_PLOT_VIEWER",rie="DATASCIENCE.RUN_ALL_CELLS",nie="DATASCIENCE.RUN_SELECTION_OR_LINE",iie="DATASCIENCE.RUN_CURRENT_CELL",oie="DATASCIENCE.RUN_ALL_CELLS_ABOVE",sie="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",aie="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",cie="DATASCIENCE.RUN_FILE_INTERACTIVE",lie="DATASCIENCE.RUN_TO_LINE",uie="DATASCIENCE.RUN_FROM_LINE",pie="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",die="DATASCIENCE.RUN_INSERT_CELL_BELOW",mie="DATASCIENCE.RUN_INSERT_CELL_ABOVE",fie="DATASCIENCE.RUN_DELETE_CELLS",hie="DATASCIENCE.RUN_SELECT_CELL",gie="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",vie="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",yie="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",bie="DATASCIENCE.RUN_MOVE_CELLS_UP",Iie="DATASCIENCE.RUN_MOVE_CELLS_DOWN",Sie="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",xie="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",Cie="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",wie="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",Eie="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",Pie="DATASCIENCE.SELFCERTSMESSAGECLOSE",kie="DATASCIENCE.SELFCERTSMESSAGEENABLED",Die="DATASCIENCE.USER_INSTALLED_JUPYTER",_ie="DATASCIENCE.USER_INSTALLED_PANDAS",Tie="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",Rie="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",Aie="DS_INTERNAL.PYTHON_NOT_INSTALLED",Nie="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",Mie="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",Oie="DS_INTERNAL.PYTHON_MODULE_INSTALL",Kie="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",Fie="DATASCIENCE.START_SHOW_DATA_EXPLORER",Lie="DATASCIENCE.SHOW_DATA_EXPLORER",Uie="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",jie="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",Wie="DATASCIENCE.REFRESH_DATA_VIEWER",Vie="DS_INTERNAL.JUPYTER_STARTED_SESSION_WITH_BACKING_FILE",Bie="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",qie="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",Jie="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",$ie="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",Hie="DATASCIENCE.KERNEL_SPEC_LANGUAGE",Gie="DS_INTERNAL.KERNEL_LAUNCHER_PERF",zie="GLOBAL_PYTHON_KERNELSPEC",Qie="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",Yie="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",Xie="DS_INTERNAL.IPYWIDGET_USED_BY_USER",Zie="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",eoe="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",toe="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",roe="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",noe="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",ioe="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",ooe="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",soe="DS_INTERNAL.IPYWIDGET_OVERHEAD",aoe="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",coe="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",loe="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",uoe="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",poe="DATASCIENCE.EXECUTE_CELL",doe="DATASCIENCE.EXECUTE_CODE",moe="DATASCIENCE.RESUME_EXECUTE_CELL",foe="DATASCIENCE.NOTEBOOK_START",hoe="DS_INTERNAL.SWITCH_KERNEL",goe="DATASCIENCE.NOTEBOOK_INTERRUPT",voe="DATASCIENCE.NOTEBOOK_RESTART",yoe="DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",boe="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",Ioe="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",Soe="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",xoe="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",Coe="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",woe="DS_INTERNAL.KERNEL_COUNT",Eoe="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",Poe="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",koe="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",Doe="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",_oe="DATAVIEWER.WEBVIEW_LOADED",Toe="PLOTVIEWER.WEBVIEW_LOADED",Roe="DS_INTERNAL.COMMAND_EXECUTED",Aoe="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",Noe="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",Moe="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",Ooe="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",Koe="DATASCIENCE.RECOMMENT_EXTENSION",Foe="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",Loe="DATASCIENCE.DEBUGGING.CLOSED_MODAL",Uoe="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",joe="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",Woe="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",Voe="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",Boe="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",qoe="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",Joe="DATASCIENCE.DEBUGGING.ENDED_SESSION",$oe="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",Hoe="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",Goe="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",zoe="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",Qoe="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",Yoe="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",Xoe="DATASCIENCE.JUPYTER_API_USAGE",Zoe="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",ese="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",tse="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",rse="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",nse="DATASCIENCE.KERNEL_CRASH",ise="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",ose="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",sse="DS_INTERNAL.RUNTEST",ase="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",cse="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",lse="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",use="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",pse="DATAVIEWER.USING_INTERPRETER",dse="DATAVIEWER.USING_KERNEL"}};var pp=require("vscode");function Pc(r){let e=Ec(r.uri);return It(e.path)}function $o(r=pp.Uri.file(""),e=pp.Uri.file(""),t=Ur(),n=!1){let i=Ec(r,t,t=="Windows"||n),o=Ec(e,t,t=="Windows"||n);return i===o||wi(i,o,!0)}function Ec(r=pp.Uri.file(""),e=Ur(),t=!1){let n=Te(r);return t&&(n=n.toLowerCase()),n.endsWith("/bin/python")?["Linux","OSX"].includes(e)?n.endsWith("/bin/python")&&n.split("/").length>4?pp.Uri.file(n.replace("/bin/python","/python")):pp.Uri.file(n):pp.Uri.file(n):pp.Uri.file(n)}var yV=require("vscode");var go=class{constructor(){this.promises=new Set;this._onStateChange=new yV.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(f)}};var QE=class extends ln{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var YE=class extends et{constructor(){super("pythonExtension","Python Extension API not exported")}};var OV=D(ig());var xm=require("vscode");var aP=class{};function Ms(r,e=""){let t=r?xm.workspace.getWorkspaceFolder(r):xm.workspace.workspaceFolders?xm.workspace.workspaceFolders[0]:void 0;return t?xn(Ur()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function Os(){return(Array.isArray(xm.workspace.workspaceFolders)&&xm.workspace.workspaceFolders.length>0?xm.workspace.workspaceFolders[0]:void 0)?.uri}function mx(r,e){if(r){let t={...r,uri:Dt.Uri.file(r.path||""),id:e||r.id};return delete t.path,t}}function KV(r){let e,t=r.id;if(r.executable.uri)e=r.executable.uri;else if(Be(r)==="Conda")e=Ur()==="Windows"?Dt.Uri.joinPath(r.environment?.folderUri||Dt.Uri.file(r.path),"python.exe"):Dt.Uri.joinPath(r.environment?.folderUri||Dt.Uri.file(r.path),"bin","python");else{W(`Python environment ${$(r.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Cm(r){if(r){let e=Object.assign({},r,{path:Te(r.uri)});return delete e.uri,e}}var og=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=le();this.didActivatePython=new Dt.EventEmitter;this._pythonExtensionHooked=le();this.extensionChecker.isPythonExtensionInstalled||Dt.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(f),this.api.promise}async getNewApi(){await this.init();let e=Dt.extensions.getExtension(ii);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new OV.SemVer(e?.packageJSON?.version)),e?.exports&&oV(e.exports),e?.exports}setApi(e){this.api.resolved||!Dt.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;Dt.extensions.getExtension(ii)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=Dt.extensions.getExtension(ii);if(!e)return;let t=!1;if(!e.isActive)try{await e.activate(),t=!0}catch(n){x("Failed activating the python extension: ",n),this.api.reject(new QE(n));return}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(x("Python extension is not exporting the jupyter API"),this.api.reject(new YE)),this._pythonExtensionHooked.resolve())}};og=v([(0,Ks.injectable)(),d(0,(0,Ks.inject)(F)),d(1,(0,Ks.inject)(Ye))],og);var dp=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new Dt.EventEmitter;Dt.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return Dt.extensions.getExtension(ii)!==void 0}get isPythonExtensionActive(){return Dt.extensions.getExtension(ii)?.isActive===!0}async directlyInstallPythonExtension(){return Dt.commands.executeCommand("workbench.extensions.installExtension",ii,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!Dt.workspace.isTrusted)return;dp.promptDisplayed=!0;let e=ve.bannerLabelYes;N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await Dt.window.showInformationMessage(b.pythonExtensionRequired,{modal:!0},e)===e?(N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){Dt.commands.executeCommand("extension.open",ii).then(f,f)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};dp=v([(0,Ks.injectable)(),d(0,(0,Ks.inject)(F))],dp);var sg=class{constructor(e,t,n,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=n;this.context=i;this.didChangeInterpreter=new Dt.EventEmitter;this.didChangeInterpreters=new Dt.EventEmitter;this._onDidEnvironmentVariablesChange=new Dt.EventEmitter;this._onDidRemoveInterpreter=new Dt.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this._status="idle";this._onDidChangeStatus=new Dt.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new go;this.onResumeEnvDetection=new Dt.EventEmitter;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&!this.extensionChecker.isPythonExtensionActive&&this.apiProvider.onDidActivatePythonExtension(()=>{this.hookupOnDidChangeInterpreterEvent()},this,this.disposables),Dt.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"})}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}initialize(){this.hookupOnDidChangeInterpreterEvent()}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let n=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(n||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}async refreshInterpreters(e=!1){let t=(async()=>{let n=await this.getApi();if(n)try{await n.environments.refreshEnvironments({forceRefresh:e}),this.hookupOnDidChangeInterpreterEvent(),E("Refreshed Environments")}catch{x("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>Ci(1e3))),await t}async getActiveInterpreter(e){if(!Dt.workspace.isTrusted)return;let t=new Je;this.hookupOnDidChangeInterpreterEvent(),!e&&Dt.workspace.workspaceFolders?.length===1&&(e=Dt.workspace.workspaceFolders[0].uri),Dt.workspace.workspaceFolders?.length&&(e=(e?Dt.workspace.getWorkspaceFolder(e)?.uri:void 0)||Dt.workspace.workspaceFolders[0].uri);let n=Ms(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(n)||(this.workspaceCachedActiveInterpreter.add(n),N("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{W(`Failed to get active interpreter from Python for workspace ${n}`,o)}),(ni||[Dt.ExtensionMode.Development,Dt.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${$(e)}'-${$(o?.id)}`;if(this.lastLoggedResourceAndInterpreterId===s)return;this.lastLoggedResourceAndInterpreterId=s;let a=Gi(o);ee(`Active Interpreter ${e?`for '${$(e)}' `:""}is ${$(o?.id)} (${o&&Be(o)}, '${o?qo(o):""}', ${a?.major}.${a?.minor}.${a?.micro})`)}).catch(f),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!Dt.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async n=>{if(!n||t?.isCancellationRequested)return;let i=n.environments.known.find(c=>Jn(e)?$o(c.executable.uri,e):typeof e=="string"?c.id===e:$o(Dt.Uri.file(c.path),Dt.Uri.file(e.path))),o=Jn(e)?$(e):typeof e=="string"?e:$(Dt.Uri.file(e.path));if(i){let c=await n.environments.resolveEnvironment(i),l=this.trackResolvedEnvironment(c);return ne(`Interpreter details for ${o} from Python is ${JSON.stringify(c)} and our mapping is ${JSON.stringify(l)}`),l}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),W(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await n.environments.resolveEnvironment(Jn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(n){W(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:$(Jn(e)?e:Dt.Uri.file(e.path))}`,n);return}}trackResolvedEnvironment(e){if(e){let t=Ti(e);return t?(Pc(t).then(n=>{this.pythonEnvHashes.set(t.id,n)}).catch(f),this.triggerEventIfAllowed("interpretersChangeEvent",t),t):void 0}}triggerEventIfAllowed(e,t){e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),this.triggerPendingEvents()}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(n=>!!n);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi()),this.apiPromise}hookupOnDidChangeInterpreterEvent(){this.eventHandlerAdded||this.getApi().then(e=>{!this.eventHandlerAdded&&e&&(this.eventHandlerAdded=!0,e.environments.onDidEnvironmentVariablesChange(t=>{E(`Detected changes to env file ${t.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),e.environments.onDidChangeActiveEnvironmentPath(()=>{E("Detected change in Active Python environment via Python API"),this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),e.environments.onDidChangeEnvironments(async t=>{if(E(`Python API env change detected, ${t.type} => '${t.env.id}'`),t.type==="remove"){this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:t.env.id});return}let n=Ti(Nr(t.env));n&&(this.triggerEventIfAllowed("interpreterChangeEvent",n),this.triggerEventIfAllowed("interpretersChangeEvent",n))},this,this.disposables),this.didChangeInterpreters.fire(ho().map(Ti).filter(t=>!!t).map(t=>t)))}).catch(f)}};sg=v([(0,Ks.injectable)(),d(0,(0,Ks.inject)(tr)),d(1,(0,Ks.inject)(Ye)),d(2,(0,Ks.inject)(F)),d(3,(0,Ks.inject)(ut))],sg);var ag=require("vscode");function cP(r,e){let t=r.length>0?`?token=${r}`:"";return`${e}${t}`}function cg(r,e,t){return r?t.createSystemVariables(e).resolve(r):e?dt(Te(e)):process.cwd()}async function lP(r,e){let t=b.jupyterSelfCertEnable,n=b.jupyterSelfCertClose,i=await ag.window.showErrorMessage(b.jupyterSelfCertFail(e),{modal:!0},t,n);return i===t?(N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,ag.ConfigurationTarget.Workspace),!0):(i===n&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function uP(r,e){let t=b.jupyterSelfCertEnable,n=b.jupyterSelfCertClose,i=await ag.window.showErrorMessage(b.jupyterExpiredCertFail(e),{modal:!0},t,n);return i===t?(N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,ag.ConfigurationTarget.Workspace),!0):(i===n&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function fx(r,e,t,n,i,o,s){let a=e.baseUrl,c=e.token,l=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0,p=u?()=>u:void 0,m={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},h=t.getRequestInit();(!(c===""||c==="null")||p)&&(m={...m,token:c,appendToken:!0});let y=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&y&&n){let A=n.createHttpRequestAgent();h={...h,agent:A}}let{ServerConnection:C}=require("@jupyterlab/services");return m={...m,init:h,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,y,p),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,y,p),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:r.id,serverProviderHandle:r,token:c,hostName:l,displayName:e&&e.displayName?e.displayName:cP(c,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:p,settings:C.makeSettings(m)}}async function FV(r){let e=Vt(r);return wa(e,"SHA-256")}var zse=new Set([$e,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(r=>r.toLowerCase()));function Vt(r){return zse.has(r.extensionId.toLowerCase())?`${Qe.REMOTE_URI}?${Qe.REMOTE_URI_ID_PARAM}=${r.id}&${Qe.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}`:`${Qe.REMOTE_URI}?${Qe.REMOTE_URI_ID_PARAM}=${r.id}&${Qe.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}&${Qe.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(r.extensionId)}`}async function pP(r){if(!Qu()&&r.interpreter?.uri){let e=r.interpreter.uri.fsPath,t=Ec(r.interpreter.uri).fsPath,n=r.id.replace(e,t);return It(n)}return It(r.id)}var Fs=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=mx(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return mp.create(t);case"connectToLiveRemoteKernel":return hx.create(t);case"startUsingRemoteKernelSpec":return gx.create(t);case"startUsingPythonInterpreter":return Ho.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},hx=class r{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,mP(this)}static create(e){return new r(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return pP(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:Cm(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Fs.fromJSON(e)}},mp=class r{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,mP(this)}static create(e){return new r(e)}getHashId(){return pP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Cm(this.interpreter),kind:this.kind}}static fromJSON(e){return Fs.fromJSON(e)}},gx=class r{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,mP(this)}static create(e){return new r(e)}getHashId(){return pP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Cm(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Fs.fromJSON(e)}},Ho=class r{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,mP(this)}static create(e){return new r(e)}getHashId(){return pP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Cm(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return Fs.fromJSON(e)}};function mt(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"}function Ft(r){return!mt(r)}var Ke=Symbol("IKernelProvider"),wm=Symbol("IThirdPartyKernelProvider");var dP=Symbol("IJupyterServerConnector"),vx=Symbol("IKernelSessionFactory");var Ls=Symbol("IKernelDependencyService"),Mr=Symbol("IKernelFinder"),lg=Symbol("ITracebackFormatter");var Go=Symbol("IStartupCodeProviders"),LV=new Set;function mP(r){if(LV.has(r.id))return;LV.add(r.id);let e="kernelSpec"in r?r.kernelSpec:void 0,t=e?.language||(r.kind==="startUsingPythonInterpreter"?xe:void 0),n="",i="",o="interpreter"in r?r.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(n=e.argv[0],a=n.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),_e(n)!==n&&(n=`<P>${_e(n)}`),i=e.argv.map(h=>h.includes("/")||h.includes("\\")?`<P>${_e(h)}`:h).join(s));let c="kernelSpec"in r&&r.kernelSpec.specFile?It(r.kernelSpec.specFile):Promise.resolve(""),l=It(r.id),u=Ft(r)?It(Vt(r.serverProviderHandle)):Promise.resolve(""),p=Ft(r)?r.serverProviderHandle.extensionId:$e,m=Ft(r)?It(r.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([c,l,u,m]).then(([h,g,y,C])=>N("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:g,serverIdHash:y,kernelSpecHash:h,baseUrlHash:C,providerExtensionId:p,kernelConnectionType:r.kind,kernelLanguage:t,envType:o&&Be(o),isArgv0SameAsInterpreter:a,argv0:n,argv:i})).catch(f)}var Cn=require("vscode");var f9=D(YV()),$l=require("vscode");var fp=class{constructor(e,t,n,i){this.specFile=t;this.interpreterPath=n;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var yo=require("vscode"),u9=D(FN());var t9=D(ig());var Pa=require("vscode");var cae={output_type:"stream",name:"stdout",text:""},lae={output_type:"error",ename:"",evalue:"",traceback:[""]},uae={output_type:"display_data",data:{},metadata:{}},pae={output_type:"execute_result",execution_count:0,data:{},metadata:{}},HEe={stream:new Set(Object.keys(cae)),error:new Set(Object.keys(lae)),display_data:new Set(Object.keys(uae)),execute_result:new Set(Object.keys(pae))};function Yi(r){return r&&np(r).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function Tc(r){return r=r.toLowerCase(),r.length===2&&r.endsWith("#")?`${r.substring(0,1)}sharp`:Jj.get(r)||r}function Rt(r){return typeof r=="string"?r===xt||r===yt:r.notebookType===xt||r.notebookType===yt}function vo(r){if(hp()){let e=r.metadata?.custom;return JSON.parse(JSON.stringify(e?.metadata||{}))}else{let e=r.metadata;return JSON.parse(JSON.stringify(e?.metadata||{}))}}function r9(r){if(hp()){let e=r.metadata?.custom;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}else{let e=r.metadata;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}}async function n9(r,e){let t=new Pa.WorkspaceEdit;if(hp()){let n=JSON.parse(JSON.stringify(r.metadata||{custom:{}}));n.custom=n.custom||{},n.custom.metadata=e,t.set(r.uri,[Pa.NotebookEdit.updateNotebookMetadata(vP({...r.metadata||{},custom:n.custom}))])}else t.set(r.uri,[Pa.NotebookEdit.updateNotebookMetadata(vP({...r.metadata||{},metadata:e}))]);await Pa.workspace.applyEdit(t)}function ug(r){return Pa.workspace.notebookDocuments.find(e=>Rt(e)&&e.getCells().some(t=>t.document===r))}function Us(r){if(Array.isArray(r)){let e="";for(let t=0;t<r.length;t+=1){let n=r[t];t<r.length-1&&!n.endsWith(`
`)?e=e.concat(`${n}
`):e=e.concat(n)}return e}return r.toString()}function pg(r){if(Array.isArray(r))return r;let e=r.toString();if(e.length>0){let t=e.split(`
`);return t.map((n,i)=>i<t.length-1?`${n}
`:n).filter(n=>n.length>0)}return[]}function dae(r){let e=r;do r=e,e=r.replace(/[^\n]\x08/gm,"");while(e.length<r.length);return r}function mae(r){for(r=r.replace(/\r+\n/gm,`
`);r.search(/\r[^$]/g)>-1;){var e=r.match(/^(.*)\r+/m)[1],t=r.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),r=r.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return r}function i9(r){return mae(dae(r))}var hP="'''",gP='"""';function Em(r,e,t){let n,i,o=0;for(let s of r){let a=s.trim(),c=a.startsWith(hP)?hP:a.startsWith(gP)?gP:void 0,l=a.includes(hP)?hP:a.includes(gP)?gP:void 0;if(i)i===l&&(i=void 0),t(s,o);else if(n)n===c&&(n=void 0),n&&e(s,o);else if(l&&!c){let u=a.indexOf(l);i=a.lastIndexOf(l)!==u?void 0:l,t(s,o)}else if(c){let u=a.indexOf(c,3);n=u>=0?void 0:c,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function dg(r,e=`
`,t){return r.map((n,i)=>{let o=t?t(n):n;return i===r.length-1?`${o}`:`${o}${e}`})}function fae(r){let e=[];return Em(r,t=>e.push(t),t=>{}),e}function yP(r){return dg(fae(r.slice(r.length>1?1:0)))}function o9(r){let e=r.length,t=-1;return r.forEach((n,i)=>{n.trim()&&(e=i,t<0&&(t=i))}),t>=0?r.slice(t,e+1):[]}function bP(r){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(r);if(e&&e.length>2){let t=parseInt(e[1],10),n=parseInt(e[2],10),i=parseInt(e[3],10);return(0,t9.parse)(`${t}.${n}.${i}`,!0)??void 0}}function Pm(r){if(hp()){let e=r.metadata.custom||{},t=e;return t.metadata=t.metadata||{},e}else{let e=r.metadata.metadata||{};return e.metadata=e.metadata||{},e}}function hp(){let r=Pa.extensions.getExtension("vscode.ipynb");if(r&&typeof r.exports.dropCustomMetadata=="boolean")return!r.exports.dropCustomMetadata;try{return!Pa.workspace.getConfiguration("jupyter",void 0).get("experimental.dropCustomMetadata",!1)}catch{return!0}}function vP(r){return hae(r)}function hae(r){return Array.isArray(r)?r.map(vP):r!=null&&typeof r=="object"&&Object.keys(r).length>0?Object.keys(r).sort().reduce((e,t)=>(e[t]=vP(r[t]),e),{}):r}var LN=class{constructor(e,t,n,i=!1){this._impl=e;this.controllerId=t;this._endCallback=n;this.clearOutputOnStartWithTime=i;this.started=!1}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this.started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(E(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(f,f)):E(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t,this.errorInfo),ee(`Cell ${this.cell.index} completed in ${((t||0)-(this._startTime||0))/1e3}s (start: ${this._startTime}, end: ${t})`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},Ri=class r{static{this._map=new WeakMap}static getOrCreate(e,t,n=!1){let i,o=e.document;if(i=this.get(e),!i)i=r.create(o,e,t,n);else if(i.controllerId!==t.id){let s=i;s.end(void 0),i=r.create(o,e,t,n),s.started&&i.start(new Date().getTime())}return i}static get(e){let t=e.document;return r._map.get(t)}static create(e,t,n,i=!1){let o=new LN(n.createNotebookCellExecution(t),n.id,()=>{r._map.delete(e)},i);return r._map.set(e,o),o}};function mg(r){return typeof Buffer<"u"&&typeof Buffer.from=="function"?Buffer.from(r,"base64"):Uint8Array.from(atob(r),e=>e.charCodeAt(0))}var gae=new TextDecoder;function IP(r){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(r).toString("base64");{let e=gae.decode(r);return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,n){return String.fromCharCode(Number.parseInt("0x"+n))}))}}var s9=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function a9(r){if(r.mime.startsWith("application/vnd."))try{return new TextDecoder().decode(r.data).length===0}catch{}return!1}function vae(r){return r.sort((e,t)=>{let n=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=s9.findIndex(s=>n(s,e.mime)),o=s9.findIndex(s=>n(s,t.mime));return a9(e)&&(i=-1),a9(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var Jl=class r{static{this.cellStates=new WeakMap}static getCellState(e){return r.cellStates.get(e)?.state}static getCellStatus(e){return(r.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let n=r.cellStates.get(e)?.start||new Je,i=r.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${n.elapsedTime}ms`}`),r.cellStates.set(e,{stateTransition:i,state:t,start:n})}};function St(r,e){let t=typeof e=="string"?()=>e:e;ne(()=>`Cell Index:${r.index}, of document ${vn(r.notebook.uri)} with state:${Jl.getCellStatus(r)}, exec: ${r.executionSummary?.executionOrder}. ${t()}. called from ${pV()}`)}var hg=new Map;hg.set("display_data",xP);hg.set("error",Sae);hg.set("execute_result",xP);hg.set("stream",yae);hg.set("update_display_data",xP);function bo(r){let e=hg.get(r.output_type),t;return e?t=e(r):(W(`Unable to translate cell from ${r.output_type} to NotebookCellData for VS Code.`),t=xP(r)),t}function UN(r){let e={outputType:r.output_type};switch(r.transient&&(e.transient=r.transient),r.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=r.execution_count,e.metadata=r.metadata?JSON.parse(JSON.stringify(r.metadata)):{};break}default:break}return e}function km(r){return r.metadata}function xP(r){let e=UN(r);("image/svg+xml"in r.data||"image/png"in r.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(r.data)for(let n in r.data)t.push(Iae(n,r.data[n]));return new yo.NotebookCellOutput(vae(t),e)}function yae(r){let e=Us(r.text),t=r.name==="stderr"?yo.NotebookCellOutputItem.stderr:yo.NotebookCellOutputItem.stdout;return new yo.NotebookCellOutput([t(e)],UN(r))}function bae(r){if(r.items.length>0)return r.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function c9(r){let e=r.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=r.metadata?.originalError,n=JSON.parse(new TextDecoder().decode(e.data));return{output_type:"error",ename:n.name,evalue:n.message,traceback:t?.traceback||pg(n.stack||n.message||"")}}var fg=new TextDecoder,p9=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function SP(r,e){if(!e)return"";try{if(r==="application/vnd.code.notebook.error"){let t=fg.decode(e);return JSON.parse(t)}else if(r.startsWith("text/")||p9.includes(r)){let t=fg.decode(e);return pg(t)}else{if(r.startsWith("image/")&&r!=="image/svg+xml")return IP(e);if(r.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&r.toLowerCase().endsWith("+json")){let t=fg.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(r.toLowerCase().includes("json")){let t=fg.decode(e);return t.length>0?JSON.parse(t):t}else return fg.decode(e)}}catch(t){return x(`Failed to convert ${r} output from a buffer ${typeof e}, ${e}`,t),""}}function Iae(r,e){if(!e)return yo.NotebookCellOutputItem.text("",r);try{if((r.startsWith("text/")||p9.includes(r))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?Us(e):e;return yo.NotebookCellOutputItem.text(t,r)}else return r.startsWith("image/")&&typeof e=="string"&&r!=="image/svg+xml"?new yo.NotebookCellOutputItem(mg(e),r):typeof e=="object"&&e!==null&&!Array.isArray(e)?yo.NotebookCellOutputItem.text(JSON.stringify(e),r):(e=Array.isArray(e)?Us(e):e,yo.NotebookCellOutputItem.text(e,r))}catch(t){return x(`Failed to convert ${r} output to a buffer ${typeof e}, ${e}`,t),yo.NotebookCellOutputItem.text("")}}function l9(r){let e=[];r.items.filter(n=>n.mime==="application/vnd.code.notebook.stderr"||n.mime==="application/vnd.code.notebook.stdout").map(n=>fg.decode(n.data)).forEach(n=>{let i=n.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let n=0;n<e.length-1;n++)e[n]=`${e[n]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:bae(r)||"stdout",text:e}}function jN(r){let e=r.metadata,t;switch(e?.outputType){case"error":{t=c9(r);break}case"stream":{t=l9(r);break}case"display_data":{t={output_type:"display_data",data:r.items.reduce((i,o)=>(i[o.mime]=SP(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:r.items.reduce((i,o)=>(i[o.mime]=SP(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:r.items.reduce((i,o)=>(i[o.mime]=SP(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=r.items.length===1&&r.items.every(c=>c.mime==="application/vnd.code.notebook.error"),o=r.items.every(c=>c.mime==="application/vnd.code.notebook.stderr"||c.mime==="application/vnd.code.notebook.stdout");if(i)return c9(r);let s=e?.outputType||(o?"stream":"display_data");N("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=l9(r):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),r.items.length>0&&(a.data=r.items.reduce((c,l)=>(c[l.mime]=SP(l.mime,l.data),c),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function Sae(r){return r=r||{output_type:"error",ename:"",evalue:"",traceback:[]},new yo.NotebookCellOutput([yo.NotebookCellOutputItem.error({name:r?.ename||"",message:r?.evalue||"",stack:(r?.traceback||[]).join(`
`)})],{...UN(r),originalError:r})}async function d9(r,e,t){let n=!1,i;if(!r)return{changed:n,kernelId:i};r?.language_info?.name||(r.language_info=r.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=xe;break;default:break}if(r.language_info.name!==o&&o&&(r.language_info.name=o,n=!0),t&&"language_info"in t&&t.language_info)(0,u9.default)(r.language_info,t.language_info)||(r.language_info=JSON.parse(JSON.stringify(t.language_info)),n=!0);else{let a=ft(e),c=a?m9(e):void 0,l=await lp(c),u=l?`${l.major}.${l.minor}.${l.micro}`:"";c&&l&&r&&r.language_info&&r.language_info.version!==u?(r.language_info.version=u,n=!0):!c&&r?.language_info&&a&&(r.language_info=void 0,n=!0)}let s=e&&gg(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,c=a.display_name||Nr(e.interpreter)?.environment?.name||"",l="";switch(Fn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":l="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{l=(a.metadata?.vscode?.originalSpecFile?_e(dt(a.metadata.vscode.originalSpecFile)):void 0)||a.name,c=a.metadata?.vscode?.originalDisplayName||c;break}default:l=a.name;break}r.kernelspec?.name!==l&&(n=!0,r.kernelspec={name:l,language:xe,display_name:c},"vscode"in r&&delete r.vscode,"interpreter"in r&&delete r.interpreter)}else if(s&&!r.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?_e(dt(s.metadata.vscode.originalSpecFile)):void 0;r.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(r.kernelspec.language=s.language),i=s.id,n=!0}else if(s&&r.kernelspec){let c=(s.metadata?.vscode?.originalSpecFile?_e(dt(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",l=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(r.kernelspec.name!==c||r.kernelspec.language!==u||r.kernelspec.display_name!==l||i!==s.id)&&(n=!0,r.kernelspec.name=c,r.kernelspec.display_name=l,r.kernelspec.language=u,i=s.id);try{delete r.kernelspec.metadata}catch{}}return{changed:n,kernelId:i}}async function gp(r,e,t,n){let i=zh(t);if(!i){let s=Ri.get(r);n&&s?.started&&s.end(n?void 0:!1,r.executionSummary?.timing?.endTime);return}Ri.get(r)||(n=!0);let o=Ri.getOrCreate(r,e);o.started||(o.start(r.executionSummary?.timing?.endTime),o.executionOrder=r.executionSummary?.executionOrder),await o.appendOutput(i),o.end(n?void 0:!1,r.executionSummary?.timing?.endTime)}function yx(r){if(r.hasOwnProperty("text/html")){let e=r["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(r["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return r}function Dm(r){let e=this,t=!1,n;return function(){return t||(t=!0,n=r.apply(e,arguments)),n}}var _m="{connection_file}";function h9(r){return r.argv.findIndex(e=>e.includes(_m))}var vg="-jvsc-",xae=/^python\d*.?\d*$/;async function js(r,e){return Cae(await qN(r),r,e)}function Cae(r,e,t){let n=e?{path:Te(e.uri)}:{},i={name:r,language:"python",display_name:(e?Nr(e)?.environment?.name:"")||"Python 3",metadata:{interpreter:n},argv:["python","-m","ipykernel_launcher","-f",_m],env:{},resources:{}},o=t&&i.name?lr(t,i.name,"kernel.json"):void 0;return new fp(i,o?Te(o):void 0,Te(e?.uri),"registeredByNewVersionOfExt")}function g9(r){let e=JSON.parse(JSON.stringify(r));return e.env&&Object.keys(e.env).forEach(n=>{if(e.env){let i=e.env[n];i!=null&&(e.env[n]=i.toString())}}),e}function CP(r){let e=r?.kernelspec;return r?.language_info?.name&&r.language_info.name!==xe?!1:e?.name?.includes(xe)?!0:e?.language===xe||r?.language_info?.name===xe}function wP(r){let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?_e(dt(e)):r.name||"",n=r.metadata?.vscode?.originalDisplayName||r.display_name||"";return!!(t.toLowerCase().match(xae)||n.toLowerCase()==="python 3 (ipykernel)"||n.toLowerCase()==="python 3")}function wae(r){if(r.includes(vg)){let e=/[a-f0-9]$/;if(r.substring(r.lastIndexOf(vg)+vg.length).search(e)!==-1){let t=r.substring(0,r.lastIndexOf(vg));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return r}function EP(r){return r.kind!=="connectToLiveRemoteKernel"}function gg(r){return r.kind==="connectToLiveRemoteKernel"}function Ai(r,e,t){e=WN(r)?e:void 0;let n=r.name,i=Fn(r);if(i&&n.includes(bx)&&(n=n.substring(n.indexOf(bx)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let l=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile;l&&(n=`${n}#${_e(dt(l))}`)}let o="";WN(r)?o=r.argv.slice(1).filter(l=>!["-f","{connection_file}"].includes(l)).join("#").toLowerCase():o=r.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Te(Ec(r.interpreterPath?$l.Uri.file(r.interpreterPath):$l.Uri.file(r.executable))),c=Te(Ec(e?.uri))||"";return`${s}${r.id||""}.${n}.${a}.${c}.${o}`}function ht(r){let e=Eae(r);if(!r)return e;switch(r.kind){case"connectToLiveRemoteKernel":{let n=wae(r.kernelModel?.notebook?.path||r.kernelModel?.model?.path||"");return n?`${e} (${n})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(r.interpreter&&Be(r.interpreter)!=="Unknown"){let n=qo(r.interpreter);if(r.kernelSpec.language===xe){let i=`Python ${ap(Gi(r.interpreter))||""}`.trim();return n?`${e} (${i})`:e}else return n?`${e} (${n})`:e}else return e;case"startUsingPythonInterpreter":let t=(ap(Gi(r.interpreter))||"").trim();if(r.interpreter&&Be(r.interpreter)!=="Unknown"){if(r.kernelSpec.display_name&&Fn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return r.kernelSpec.display_name;let n=wr(r.interpreter),i=t.trim()?`Python ${t}`:"Python",o=qo(r.interpreter);return n&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function Eae(r){if(!r)return"";let e=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.display_name:r.kernelSpec?.display_name,t=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name,n=r.kind==="startUsingPythonInterpreter"?jr(r.interpreter):void 0;return[e,t,n,""].find(i=>typeof i=="string"&&i.length>0)||""}function yg(r,e=""){return r?r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name:e}function Pae(r){if(!r)return;let e=gg(r)?r.kernelModel:void 0,t=EP(r)?r.kernelSpec:void 0;if(r.kind==="startUsingPythonInterpreter"||(r.kind==="startUsingRemoteKernelSpec"||r.kind==="startUsingLocalKernelSpec")&&r.kernelSpec.language===xe){let n=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;if(n==="/python"||n==="python"){let i=Nr(r.interpreter);return i?.environment?.folderUri||(i?$l.Uri.file(i.path):void 0)}return n?$l.Uri.file(n):void 0}else{let n=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return n?$l.Uri.file(n):void 0}}function VN(r,e=""){if(r?.kind==="connectToLiveRemoteKernel"){let t;if(typeof r.kernelModel.lastActivityTime=="string")try{t=new Date(r.kernelModel.lastActivityTime)}catch(n){E(`Error parsing date ${n}`)}else t=r.kernelModel.lastActivityTime;return b.jupyterSelectLiveRemoteKernelDescription(t,r.kernelModel.numberOfConnections)}return e}function BN(r,e){if(r?.kind==="connectToLiveRemoteKernel")return;let t=Pae(r),n=$l.workspace.workspaceFolders?$l.workspace.workspaceFolders:[];return t?$(t,n,e.homeDir):""}function m9(r){if(!r)return;if(r.interpreter)return r.interpreter;let e=gg(r)?r.kernelModel:void 0;if(e?.metadata?.interpreter)return mx(e?.metadata?.interpreter,"");let t=EP(r)?r.kernelSpec:void 0;return mx(t?.metadata?.interpreter,"")}function bg(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"&&r.kernelSpec&&Fn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function ft(r){if(!r)return!1;if(r.kind==="startUsingPythonInterpreter")return!0;let e=gg(r)?r.kernelModel:void 0,t=EP(r)?r.kernelSpec:void 0;return e?.language===xe||WN(t)}function WN(r){return(r?.language||"").toLowerCase()===xe}function Io(r){if(!r)return;if(r.kind==="startUsingPythonInterpreter")return xe;let e=gg(r)?r.kernelModel:void 0,t=EP(r)?r.kernelSpec:void 0;return e?.language||v9(t)}function PP(r){if(!r)return;let e=r.kernelspec;return v9(e)||r.language_info?.name}function v9(r){return r?.language}var bx="jvsc74a57bd0";async function qN(r){let t=(ap(Gi(r))||"3").replace(/\./g,""),n=r?`python${t}`:"";return r?`${n}${bx}${await Pc(r)}`:"python3"}function Fn(r){if(r.isRegisteredByVSC)return r.isRegisteredByVSC;if(!r.name)return;let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?_e(dt(e)):r.name,n=wP({...r,name:t})?Object.keys(r.env||{}).length>0:typeof e=="string"&&!e.includes(bx);if(r.name.includes(bx))return n?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(r.metadata?.interpreter&&r.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function y9(r,e){return!r&&!e?!0:!r&&e||r&&!e?!1:r?.id===e?.id}function kP(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"){let e=new f9.default(r.baseUrl);return e.hostname.toLocaleLowerCase()==="localhost"||e.hostname==="127.0.0.1"}return!1}async function bn(r,e,t){E(`Executing silently Code (${r.status}) = ${Fe(e.substring(0,100)).join("\\n")}`);let n=require("@jupyterlab/services"),i=r.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(n.KernelMessage.isStreamMsg(a))if(ne(`Got io pub message (stream), ${Fe(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let c=o[o.length-1];c.text+=a.content.text}else{let c={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(c)}else if(n.KernelMessage.isExecuteResultMsg(a)){ne("Got io pub message (execresult)}");let c={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(c)}else if(n.KernelMessage.isDisplayDataMsg(a)){ne("Got io pub message (displaydata)}");let c={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(c)}else if(n.KernelMessage.isErrorMsg(a)){if(ne(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let l=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;x(`${l} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let c={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(c)}else ne(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=Fe(e.substring(0,100)).join("\\n");return t&&kae(o,t,s),E(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function b9(r,e,t,n){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=r.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=Dm(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?n(bo({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?n(bo({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?n(bo({output_type:"display_data",data:yx(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isUpdateDisplayDataMsg(a)?n(bo({output_type:"display_data",data:yx(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?n(bo({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||W(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function kae(r,e,t){r.filter(n=>n.output_type==="error").forEach(n=>{let i=n,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?x(s):W(s),e.telemetryName&&N(e.telemetryName)})}var x9=D(I9());var $N;(C=>{function r(k){return k&&typeof k=="object"&&typeof k[Symbol.iterator]=="function"}C.is=r;let e=Object.freeze([]);function t(){return e}C.empty=t;function*n(k){yield k}C.single=n;function i(k){return r(k)?k:n(k)}C.wrap=i;function o(k){return k||e}C.from=o;function s(k){return!k||k[Symbol.iterator]().next().done===!0}C.isEmpty=s;function a(k){return k[Symbol.iterator]().next().value}C.first=a;function c(k,A){for(let T of k)if(A(T))return!0;return!1}C.some=c;function l(k,A){for(let T of k)if(A(T))return T}C.find=l;function*u(k,A){for(let T of k)A(T)&&(yield T)}C.filter=u;function*p(k,A){let T=0;for(let U of k)yield A(U,T++)}C.map=p;function*m(...k){for(let A of k)for(let T of A)yield T}C.concat=m;function h(k,A,T){let U=T;for(let oe of k)U=A(U,oe);return U}C.reduce=h;function*g(k,A,T=k.length){for(A<0&&(A+=k.length),T<0?T+=k.length:T>k.length&&(T=k.length);A<T;A++)yield k[A]}C.slice=g;function y(k,A=Number.POSITIVE_INFINITY){let T=[];if(A===0)return[T,k];let U=k[Symbol.iterator]();for(let oe=0;oe<A;oe++){let G=U.next();if(G.done)return[T,C.empty()];T.push(G.value)}return[T,{[Symbol.iterator](){return U}}]}C.consume=y})($N||={});var C9;function w9(r){C9=r}function DP(r){return C9?.push(r),r}function z(r){if($N.is(r)){for(let e of r)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(r)?[]:r}else if(r)return r.dispose(),r}var ci=class r{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),DP(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{z(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?r.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},ir=class{constructor(...e){this._store=new ci;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),DP(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Ws=class extends ir{constructor(){super();this._onDidDispose=new x9.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var S9=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{z(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};function ka(r){return(e,t=null,n)=>{let i=!1,o;return o=r(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,n),i&&o.dispose(),o}}function HN(r,e=null,t){return new Promise(n=>ka(r)(n,e,t))}var _P="application/vnd.vscode.chat_message",E9=`
def __VSCODE_inject_module():

    def __VSCODE_call_function(function, callback, data=None):
        __VSCODE_send_chat_message__(function, data, callback=callback)

    def __VSCODE_send_chat_message__(function, data, callback):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        import uuid as __VSCODE_send_chat_message__uuid
        import IPython.display as __VSCODE_send_chat_message__ipython_display

        id = str(__VSCODE_send_chat_message__uuid.uuid4())
        requests[id] = callback
        data_is_none = data is None
        __VSCODE_send_chat_message__ipython_display.display({"${_P}": data}, metadata={"id":id, "function": function, "dataIsNone": data_is_none}, raw=True)

        del __VSCODE_send_chat_message__ipython_display
        del __VSCODE_send_chat_message__uuid

    def __VSCODE_on_chat_message(id, data):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        if id in requests:
            requests[id](data)
            del requests[id]
        else:
            raise NotImplementedError(f"Callback not found for message {id}")

    import sys as __VSCODE_send_chat_message__sys
    import IPython as __VSCODE_send_chat_message__IPython
    chat = type(__VSCODE_send_chat_message__IPython)("chat")
    chat.send_message = __VSCODE_send_chat_message__
    chat.call_function = __VSCODE_call_function
    chat.__on_message = __VSCODE_on_chat_message
    __VSCODE_send_chat_message__sys.modules["vscode"] = type(__VSCODE_send_chat_message__IPython)("vscode")
    __VSCODE_send_chat_message__sys.modules["vscode"].chat = chat
    del __VSCODE_send_chat_message__sys
    del __VSCODE_send_chat_message__IPython


__VSCODE_inject_module()
del __VSCODE_inject_module
`,Tae=[[new RegExp("\\\\","g"),"\\\\"],[new RegExp('"',"g"),'\\"'],[new RegExp("'","g"),"'"],[new RegExp("\\\b","g"),"\\b"],[new RegExp("\\f","g"),"\\f"],[new RegExp("\\n","g"),"\\n"],[new RegExp("\\r","g"),"\\r"],[new RegExp("\\t","g"),"\\t"]];function P9(r,e){let t=Ix(e),n=typeof t=="string"?`"${t}"`:"None";return`
import vscode as __vscode
try:
    __vscode.chat.__on_message('${r}', ${n})
finally:
    del __vscode
`}function Ix(r){if(typeof r!="string")return r;for(let[e,t]of Tae)r=r.replace(e,t);return r}var Sx=new WeakMap;function TP(r,e,t){let i=km(t)?.transient?.display_id;if(t.metadata?.outputType!=="display_data"||!i)return;let o=Sx.get(e)||new Map;Sx.set(e,o);let s=o.get(r)||[];o.set(r,s),s.push(i),s.length>1e3&&s.shift()}function k9(r,e){let t=Sx.get(r)||new Map;for(let n of t.values())if(n.includes(e))return!0;return!1}function D9(r,e,t){return((Sx.get(e)||new Map).get(r)||[]).includes(t)}function _9(r,e){let t=Sx.get(r)||new Map;for(let n of t.values()){let i=n.indexOf(e);i>=0&&n.splice(i,1)}}var zN=class{constructor(e,t){let n=Cn.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=Cn.workspace.notebookDocuments.find(i=>i.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=ht(t.kernelConnectionMetadata),this.title=Cn.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,n),this.eventHandler=Cn.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}dispose(){this.eventHandler.dispose(),this.disposable?.dispose()}show(){if(this.deferred&&!this.deferred.completed){let e=this.deferred;return this.deferred=le(),e.resolve(),this.disposable=new Cn.Disposable(()=>this.deferred?.resolve())}return this.deferred=le(),this.showProgress().catch(f),this.disposable=new Cn.Disposable(()=>this.deferred?.resolve())}async showProgress(){await Ci(500),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){!this.notebook||!this.shouldDisplayProgress||Cn.window.visibleNotebookEditors.some(e=>e.notebook===this.notebook)&&(this.displayInProgress=!0,await Cn.window.withProgress({location:Cn.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1)}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}},QN=class r extends ir{constructor(t,n,i,o){super();this.extensionId=t;this.kernel=n;this.execution=i;this.kernelAccess=o;this._onDidChangeStatus=this._register(new Cn.EventEmitter);this._onDidReceiveDisplayUpdate=this._register(new Cn.EventEmitter);this.progress=this._register(new zN(t,n)),this._register(ka(n.onDisposed)(()=>this.progress.dispose())),this.language=n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?xe:n.kernelConnectionMetadata.kernelSpec.language||xe,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status))),this._register(i.onDidReceiveDisplayUpdate(a=>{let c=this.kernel.session,l=km(a);l?.outputType==="display_data"&&l?.transient?.display_id&&c&&D9(this.extensionId,c,l?.transient?.display_id)&&this._onDidReceiveDisplayUpdate.fire(a)}));let s=this;this._api=Object.freeze({language:this.language,get status(){return s.kernel.status},onDidChangeStatus:s.onDidChangeStatus.bind(this),get onDidReceiveDisplayUpdate(){if(![$e].includes(t))throw new Error(`Proposed API is not supported for extension ${t}`);return s.onDidReceiveDisplayUpdate.bind(this)},executeCode:(a,c)=>this.executeCode(a,c),executeChatCode:(a,c,l)=>this.executeChatCode(a,c,l)})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}get onDidReceiveDisplayUpdate(){return this._onDidReceiveDisplayUpdate.event}static createApiKernel(t,n,i,o){let s=new r(t,n,i,o);return Pe.instance.get(F).push(s),s._api}async*executeCode(t,n){for await(let i of this.executeCodeInternal(t,void 0,n))yield i}async*executeChatCode(t,n,i){if(!["ms-vscode.dscopilot-agent",$e].includes(this.extensionId.toLowerCase()))throw new Error(`Proposed API is not supported for extension ${this.extensionId}`);if(!ft(this.kernel.kernelConnectionMetadata))throw new Error("Chat code execution is only supported for Python kernels");for await(let s of this.executeCodeInternal(t,n,i))yield s}async*executeCodeInternal(t,n={},i){if(!this.kernelAccess.accessAllowed)throw new Error(Cn.l10n.t("Access to Jupyter Kernel has been revoked"));this.previousProgress?.dispose();let o=!1,s={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},a={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},c=new Je,l=new Set;if(Rae(this.extensionId,this.kernel,"executeCode",s.executionCount).catch(f),this.kernel.disposed)throw a.failed=!0,GN(this.kernel,s,a).catch(f),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw a.failed=!0,GN(this.kernel,s,a).catch(f),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let u=[];u.push({dispose:()=>{s.duration=c.elapsedTime,a.mimeTypes=Array.from(l).join(","),o=!0,GN(this.kernel,s,a).catch(f)}});let p=Pe.instance.get(Ke).getKernelExecution(this.kernel),m={started:new Cn.EventEmitter,executionAcknowledged:new Cn.EventEmitter};m.started.event(()=>{if(a.requestSent=!0,s.requestSentAfter=c.elapsedTime,!i.isCancellationRequested&&this.extensionId!==$e){let h=this.previousProgress=this.progress.show();u.push(h)}},this,u),m.executionAcknowledged.event(()=>{a.requestAcknowledged=!0,s.requestAcknowledgedAfter=c.elapsedTime},this,u),i.onCancellationRequested(()=>{o||(a.cancelled=!0,s.cancelledAfter=c.elapsedTime,a.cancelledBeforeRequestSent=!a.requestSent,a.cancelledBeforeRequestAcknowledged=!a.requestAcknowledged,E(`Code execution cancelled by extension ${this.extensionId}`))},this,u);try{for await(let h of p.executeCode(t,this.extensionId,m,i))if(TP(this.extensionId,this.kernel.session,h),h.items.forEach(g=>l.add(g.mime)),n&&T9(h))for await(let g of this.handleChatOutput(h,p,m,l,n,i))yield g;else yield h}finally{z(u)}}async*handleChatOutput(t,n,i,o,s={},a){let c=t.items.find(C=>C.mime===_P);if(!c)return;let l=(t.metadata||{}).metadata,u=l.function,p=l.id,m=l.dataIsNone?void 0:new TextDecoder().decode(c.data),h=s[u];if(!h)throw new Error(`Chat Function ${u} not found`);let g=await h(m),y=P9(p,g);for await(let C of n.executeCode(y,this.extensionId,i,a))if(C.items.forEach(k=>o.add(k.mime)),T9(C))for await(let k of this.handleChatOutput(C,n,i,o,s,a))yield k;else yield C}};function T9(r){return r.items.some(e=>e.mime===_P)}async function Rae(r,e,t,n){let i=await It(e.id);N("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:n},{kernelId:i,pemUsed:t,extensionId:r})}async function GN(r,e,t){t.kernelId=await It(r.id),N("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function RP(r,e,t){let n=Pe.instance.get(Ke);return QN.createApiKernel(r,e,n.getKernelExecution(e),t)}var Ln=require("vscode");var Ig=new Map,R9=new Set;async function A9(r){if(!Ln.workspace.isTrusted)return{accessAllowed:!1};if(r===$e)return{accessAllowed:!0};let e=Ig.get(r);return e||(e=Aae(r),Ig.set(r,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&Ig.get(r)===e&&(Ig.delete(r),R9.add(r))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function Aae(r){let e=await YN();if(e.get(r)===!0)return{result:"allowed"};if(e.get(r)===!1)return{result:"denied"};let t=Ln.extensions.getExtension(r)?.packageJSON?.displayName;if(!t)return x(`Kernel API access revoked, as extension ${r} does not exist!`),{result:"denied"};let n=Ln.l10n.t("Allow"),i=Ln.l10n.t("Deny"),o=await Ln.window.showInformationMessage(Ln.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,r),{modal:!0,detail:Ln.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},n,ve.learnMore,i);switch(o===ve.learnMore?Ln.env.openExternal(Ln.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(f,f):(o===n||o===i)&&await Nae(r,o===n),o){case n:return{result:"allowed"};case ve.learnMore:return{result:"learnMore"};case i:return{result:"denied"};default:return{result:"cancelled"}}}async function N9(){let r=new Set,[e]=await Promise.all([YN().then(t=>new Map(t)),...Array.from(Ig.entries()).map(async([t,n])=>{(await n).result!=="allowed"&&r.add(t)})]);return r.forEach(t=>e.set(t,!1)),R9.forEach(t=>e.set(t,e.get(t)===!0)),e}var AP="API.Access",vp;async function YN(r=!1){let e=Pe.instance.get(ut);if(e.extensionMode===Ln.ExtensionMode.Test)return new Map;if(Dm(()=>{Pe.instance.get(F).push(e.secrets.onDidChange(i=>{i.key===AP&&(vp=void 0)}))})(),vp&&!r)return vp;let t="";try{return t=await e.secrets.get(AP),!t||t.length===0?new Map:(vp=new Map(Object.entries(JSON.parse(t))),vp)}catch(n){return x(`Failed to parse API access information ${t}`,n),new Map}}var NP=Promise.resolve();async function M9(r){return NP=NP.then(async()=>{await Promise.all(Array.from(Ig.entries()).map(async([t,n])=>{let i=await n;i.result=r.includes(t)===!0?"allowed":"denied"})),vp=new Map(r.map(t=>[t,!0]));let e=Pe.instance.get(ut);if(e.extensionMode!==Ln.ExtensionMode.Test)try{await e.secrets.store(AP,JSON.stringify(Object.fromEntries(vp)))}catch(t){x(`Failed to update API access information ${JSON.stringify(Object.fromEntries(vp))}`,t)}})}async function Nae(r,e){return NP=NP.then(async()=>{let t=Pe.instance.get(ut);if(t.extensionMode===Ln.ExtensionMode.Test)return;let n=await YN(!0);if(e!==n.get(r)){n.set(r,e);try{await t.secrets.store(AP,JSON.stringify(Object.fromEntries(n)))}catch(i){x(`Failed to store API access information ${JSON.stringify(Object.fromEntries(n))}`,i)}}})}var O9=new WeakMap;function F9(r){return{async getKernel(e){let t,n=Pe.instance.get(Ke),i=K9.workspace.notebookDocuments.find(l=>l.uri.toString()===e.toString()),o=n.get(i||e);if(!o||!o.startedAtLeastOnce){N("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let s=n.getKernelExecution(o);if(!Ft(o.kernelConnectionMetadata)&&s.executionCount===0){N("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let a=await A9(r);if(t=a.accessAllowed,N("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t}),!t)return;let c=O9.get(o)||RP(r,o,a);return O9.set(o,c),c}}}var yp=Symbol("JupyterServerHelper"),MP=Symbol("INotebookImporter"),Sg=Symbol("INotebookExporter"),bp=Symbol("IJupyterInterpreterDependencyManager"),xg=Symbol("INbConvertInterpreterDependencyChecker"),OP=Symbol("INbConvertExportToPythonService"),Cg=Symbol("IJupyterServerProvider"),Zt=Symbol("IJupyterServerUriStorage"),KP=Symbol("IJupyterKernelService"),Ip=Symbol("IJupyterRequestAgentCreator"),Hl=Symbol("IJupyterRequestCreator"),FP=Symbol("INotebookStarter"),Tm=Symbol("ILiveRemoteKernelConnectionUsageTracker"),LP=Symbol("IJupyterRemoteCachedKernelValidator"),Qt=Symbol("IJupyterServerProviderRegistry");function UP(r,e,t,n,i){N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n,pemUsed:"createJupyterServerCollection"});let s=i.get(Qt).createJupyterServerCollection(n,r,Eh(e),t);return{dispose:()=>{s?.dispose()},get id(){return r},set label(c){s.label=Eh(c)},get label(){return s.label},set documentation(c){s.documentation=c},get documentation(){return s.documentation},set commandProvider(c){s.commandProvider=c},get commandProvider(){return s.commandProvider}}}var L9=!1;function U9(r,e){if(L9)return;L9=!0,e.get(tr).setApi(r)}var Ep=require("vscode");var wg=D(O());var Mc=D(O());var Sp=class extends et{constructor(t,n){super("remotejupyterserveruriprovider",n.message||n.toString());this.serverProviderHandle=t;this.originalError=n}};var zo=class extends et{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){return e.message.indexOf("reason: self signed certificate")>=0}};var Ac=class extends et{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var en=Symbol("IDataScienceErrorHandler"),_n=class extends et{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}},Nc=class extends ln{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}};var Ni=class extends et{constructor(t,n,i){super("remotejupyterserverconnection",b.remoteJupyterConnectionFailedWithServerWithError(j9(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=n;this.originalError=i;this.baseUrl=j9(t)}};function j9(r){let e=new URL(r);return`${e.protocol}//${e.host}/`}var xx=require("vscode");var W9=require("vscode");var xp=class r{constructor(e){this.serverSettings=e;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get isDisposed(){return this.disposed===!0}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(e){return new r(e)}async dispose(){if(!this.disposed){this.disposed=!0,E("Disposing Jupyter Lab Helper");try{this.contentsManager&&(E("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(E("ShutdownSessionAndConnection - dispose session manager"),await xr(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(e){x("Exception on Jupyter Lab Helper shutdown: ",e)}finally{E("Finished disposing Jupyter Lab Helper")}}}async getRunningSessions(){if(!this.sessionManager)return[];await xr(1e4,this.sessionManager.ready).catch(f),await this.sessionManager.refreshRunning();let e=[],t=this.sessionManager.running(),n=t.next();for(;n;)e.push(n),n=t.next();return e}async getRunningKernels(){let e=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),t=new Set;return e.map(n=>{let i=n;return{id:n.id,name:n.name,lastActivityTime:i.last_activity?new Date(Date.parse(i.last_activity.toString())):new Date,numberOfConnections:i.connections?parseInt(i.connections.toString(),10):0}}).filter(n=>t.has(n.id)?!1:(t.add(n.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new yn;try{let e=new Je,t=this.kernelSpecManager;if(!t)return x(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await js()];let n={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:t.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,waitedForChangeEvent:!1},i=(c={})=>t.specs&&Object.keys(t.specs.kernelspecs).length?t.specs.kernelspecs:c,o=i();await xr(1e4,this.sessionManager.ready),n.sessionManagerReady=this.sessionManager.isReady,await xr(1e4,t.refreshSpecs()),n.specsManagerReady=t.isReady;let s=!1;if(t&&Object.keys(t.specs?.kernelspecs||{}).length===0){let c=[],l=le(),u=l.resolve.bind(l);t.specsChanged.connect(u),c.push(new W9.Disposable(()=>t.specsChanged.disconnect(u)));let p=Promise.all([l.promise,t.ready,t.refreshSpecs(),this.sessionManager.ready]);await xr(1e4,p),n.waitedForChangeEvent=!0,l.completed||(s=!0,N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,reason:t.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),z(c)}let a=i(o);if(Object.keys(a||{}).length){let c=[];return Object.entries(a).forEach(([l,u])=>{u&&c.push(new fp(u))}),N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:e.elapsedTime},n),c}else return x(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(a)}.`),s||N("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await js()]}catch(e){return x("Jupyter Lab Helper:getKernelSpecs failure: ",e),[]}}};var pn=class{constructor(e,t,n,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=n;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let n={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return fx(e,n,this.requestCreator,this.requestAgentCreator,this.configService,xx.Uri.file(""))}async validateRemoteUri(e,t,n){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=fx(e,t,this.requestCreator,this.requestAgentCreator,this.configService,xx.Uri.file(""));try{i=xp.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(zo.isSelfCertsError(s)){if(!await lP(this.configService,s.message))throw s}else if(Ac.isSelfCertsExpiredError(s)){if(!await uP(this.configService,s.message))throw s}else throw t&&!n&&await this.errorHandler.handleError(new Ni(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose().catch(f)}}async getJupyterServerUri(e){let t=new xx.CancellationTokenSource;try{let n=this.jupyterPickerRegistration.jupyterCollections.find(c=>c.extensionId===e.extensionId&&c.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!n)return;let i=await Promise.resolve(n.serverProvider.provideJupyterServers(t.token)),o=i?.find(c=>c.id===e.handle);if(!o&&i?.length===0)try{o=await n.serverProvider.resolveJupyterServer({id:e.handle,label:""},t.token)}catch{}if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(n.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(n){throw n instanceof et?n:new Sp(e,n)}finally{t.dispose()}}};pn=v([(0,Mc.injectable)(),d(0,(0,Mc.inject)(Qt)),d(1,(0,Mc.inject)(ue)),d(2,(0,Mc.inject)(en)),d(3,(0,Mc.inject)(Ip)),d(3,(0,Mc.optional)()),d(4,(0,Mc.inject)(Hl))],pn);var Da=class{constructor(e,t,n){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=n}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=rc.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){x(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};Da=v([(0,wg.injectable)(),d(0,(0,wg.inject)(Zt)),d(1,(0,wg.inject)(pn)),d(2,(0,wg.inject)(Qt))],Da);var V9=" (Interactive)",Ct=Symbol("IControllerRegistration");var jP=Symbol("IRemoteNotebookKernelSourceSelector"),WP=Symbol("ILocalNotebookKernelSourceSelector"),Rm=Symbol("ILocalPythonNotebookKernelSourceSelector"),Cp=Symbol("IConnectionDisplayData");var B9=D(O()),Oc=require("vscode");var wp=require("vscode");function hr(r,e=!1){return typeof r!="object"||!r?!1:!!(r instanceof wp.CancellationError||e&&(r.message.includes("Canceled")||r.message.includes(ve.canceled)))}async function or(r,e,...t){let n;return Gw(e)?(t.push(e),n=void 0):n=e,r?r.isCancellationRequested?n:new Promise((i,o)=>{if(r.isCancellationRequested)return i(n);let s=r.onCancellationRequested(()=>{s.dispose(),i(n)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function ur(r,...e){if(!r)return Promise.race(e);if(r.isCancellationRequested)throw new wp.CancellationError;return new Promise((t,n)=>{if(r.isCancellationRequested)return n(new wp.CancellationError);let i=r.onCancellationRequested(()=>{i.dispose(),n(new wp.CancellationError)});Promise.race(e).then(t,n).finally(()=>i.dispose())})}function Eg(...r){let e=new wp.CancellationTokenSource,t=[];for(let i of r)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let n=e.dispose.bind(e);return e.dispose=()=>{n(),z(t)},e}var In;(e=>{function r(t){if(t?.isCancellationRequested)throw new wp.CancellationError}e.throwIfCanceled=r})(In||={});function q9(r){let e=new Map,t=(a,c)=>{if(!e.has(a)){let l={id:a,label:c.displayName,connectionInformation:{baseUrl:Oc.Uri.parse(c.baseUrl),token:c.token,fetch:c.fetch,headers:c.authorizationHeader,WebSocket:c.WebSocket}};e.set(a,{serverUri:c,server:l})}return e.get(a).server},n=new Oc.EventEmitter,i={async provideJupyterServers(a){let c=r.getHandles?await ur(a,r.getHandles()):[];return!c||c.length===0?[]:ur(a,Promise.all(c.map(l=>r.getServerUri(l).then(u=>t(l,u)))))},resolveJupyterServer(a,c){return a},onDidChangeServers:n.event};if(!r.handleQuickPick||!r.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,c){let l=o.get(a.label);if(!l||!r.handleQuickPick)return;let u=await ur(c,r.handleQuickPick(l,!0));if(u==="back")return;if(!u)throw new Oc.CancellationError;let p=await r.getServerUri(u);return t(u,p)},async provideCommands(a,c){return r.getQuickPickEntryItems?(await ur(c,Promise.resolve(r.getQuickPickEntryItems()))).map(u=>{let p={label:Eh(u.label),canBeAutoSelected:u.default,description:Eh(u.description)};return o.set(p.label,u),p}):[]}}}}var XN=class extends Ws{constructor(t,n,i,o){super();this.extensionId=t;this.id=n;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Oc.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},Pg=class extends ir{constructor(){super();this._onDidChangeCollections=new Oc.EventEmitter;this._collections=new Map;Pe.instance.get(F).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,n){return await this.loadExtension(t,n).catch(f),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===n)}async loadExtension(t,n){if(t===$e)return;let i=Oc.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${n}' not found`);i.isActive||await i.activate().then(f,f)}createJupyterServerCollection(t,n,i,o){let s=`${t}#${n}`;if(this._collections.has(s)&&t!==$e)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new XN(t,n,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};Pg=v([(0,B9.injectable)()],Pg);var VP=Symbol("IExportedKernelServiceFactory");function Mae(r,e){return new Promise(t=>{e.onDidChange(n=>{for(let i of n.added)Ft(i.connection)&&i.connection.serverProviderHandle.id===r.id&&i.connection.serverProviderHandle.handle===r.handle&&t()})})}function J9(r,e){let t=e.get(Ia),n=r.id.startsWith("_builtin")?$e:t.determineExtensionFromCallStack().extensionId;if(x(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${n}).`),n.toLowerCase()!=rc.toLowerCase())throw new Error("Deprecated API");N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n,pemUsed:"registerRemoteServerProvider"});let{serverProvider:i,commandProvider:o}=q9(r),s=UP(r.id,r.displayName||r.detail||r.id,i,n,e);return o&&(s.commandProvider=o),{dispose:()=>{s.dispose()}}}function $9(r){return r.then(()=>void 0).catch(e=>(x("Failure during activation.",e),Promise.reject(e)))}function H9(r){let e=r.get(Ia);return N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:e.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),r.get(VP).getService()}async function G9(r,e,t){let n=t.get(Ia);x("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let i=n.determineExtensionFromCallStack().extensionId;if(i.toLowerCase()!=rc.toLowerCase())throw new Error("Deprecated API");N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:i,pemUsed:"addRemoteJupyterServer"});let o=t.get(Da),s=t.get(Ct),a=Mae({id:r,handle:e},s);await o.addJupyterServer({id:r,handle:e,extensionId:i}),await a}async function z9(r,e,t){let n=t.get(Ia);N("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:n.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let i=t.get(Ct),o=typeof e=="string"?e:void 0,s=typeof e=="string"?void 0:e,a=o&&i.all.find(l=>l.id===e)?.id;if(!a&&s&&!Qu()&&(a=i.all.find(l=>l.kind==="startUsingPythonInterpreter"&&l.interpreter.id===s.id)?.id,!a)){let u=await t.get(Rm).getKernelConnection(s);a=u&&i.all.find(p=>p.id===u?.id)?.id}if(!a)throw new Error(`Kernel ${e} not found.`);let c=Ep.window.activeNotebookEditor?.notebook?.uri?.toString()===r.toString()?Ep.window.activeNotebookEditor:await Ep.window.showNotebookDocument(await Ep.workspace.openNotebookDocument(r));return await Ep.commands.executeCommand("notebook.selectKernel",{notebookEditor:c,id:a,extension:$e}),c.notebook}function Q9(r,e,t,n){let i=t.get(Ia),o={ready:$9(r),registerPythonApi:s=>U9(s,t),registerRemoteServerProvider:s=>J9(s,t),getKernelService:()=>H9(t),addRemoteJupyterServer:(s,a)=>G9(s,a,t),openNotebook:async(s,a)=>z9(s,a,t),createJupyterServerCollection:(s,a,c)=>UP(s,a,c,i.determineExtensionFromCallStack().extensionId,t),get kernels(){return F9(i.determineExtensionFromCallStack().extensionId)}};return(Ar()||n.extensionMode===ZN.ExtensionMode.Development||n.extensionMode===ZN.ExtensionMode.Test)&&(o.serviceContainer=t,o.serviceManager=e),o}var Y9=Symbol("IServiceManager"),pt=Symbol("IServiceContainer");var X9=require("vscode");async function Z9(r,e,t){if(!Ar())try{await r,e.totalActivateTime=t.elapsedTime,await t3(e),N("EXTENSION.LOAD",e)}catch(n){x("sendStartupTelemetry() failed.",n)}}async function e3(r,e){try{let t={};try{await t3(e)}catch(n){x("getActivationTelemetryProps() failed.",n)}N("EXTENSION.LOAD",e,t,r)}catch(t){x("sendErrorTelemetry() failed.",t)}}async function t3(r){let e=X9.workspace.workspaceFolders?.length??0;r.workspaceFolderCount=e}var BP=Symbol("IExtensionActivationManager"),be=Symbol("IExtensionSyncActivationService");var Gl=D(O());var Kc=Symbol("IEnvironmentVariablesService"),Fc=Symbol("ICustomEnvironmentVariablesProvider");var st=Symbol("IInterpreterService");var $P=D(O()),Lc=require("vscode");var Oae={JupyterSessionWaitForIdleSession:b.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:b.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:b.gettingListOfKernelSpecs,KernelsRegisterKernel:b.registeringKernel,NotebookConnect:b.connectingToJupyter,NotebookStart:b.startingJupyterNotebook,InstallingMissingDependencies:b.installingMissingDependencies,ExportNotebookToPython:b.exportNotebookToPython,PerformingExport:b.performingExport};function JP(r){return Oae[r]}var vt=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),vt.instance=this}activate(){}dispose(){z(Array.from(vt.disposables))}static createProgressReporter(e,t,n){if(!vt.instance)return new Lc.Disposable(f);let i=e?gn(e):"";return vt.instance.kernelResourceProgressReporter.has(i)?vt.reportProgress(e,t):vt.createProgressReporterInternal(i,t,n)}static wrapAndReportProgress(e,t,n){let i=e?gn(e):"";if(!vt.instance)return n();let o=vt.reportProgressInternal(i,t);return n().finally(()=>o?.dispose())}static reportProgress(e,t){let n=JP(t)||t,i=e?gn(e):"";return n?vt.reportProgressInternal(i,n||""):new Lc.Disposable(()=>f)}static reportProgressInternal(e,t){if(!vt.instance)return new Lc.Disposable(f);let n=vt.instance.kernelResourceProgressReporter.get(e);if(n||(n={title:t,pendingProgress:[],progressList:[],dispose:f},vt.instance.kernelResourceProgressReporter.set(e,n)),n.reporter)n.progressList.push(t),n.reporter.report({message:t});else{if(n.progressList.includes(t))return new Lc.Disposable(f);n.pendingProgress.push(t)}return{dispose:()=>{try{if(!n)return;let i=n.progressList.findIndex(o=>o===t);if(i>=0&&n.progressList.splice(i),n.progressList.length>0){let o=n.progressList[n.progressList.length-1];n.reporter&&n.reporter.report({message:o===n.title&&n.reporter?"":o})}else vt.instance.kernelResourceProgressReporter.delete(e),n.dispose()}catch(i){x(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,n){let i=le(),o=new Lc.Disposable(()=>i.resolve()),s=vt.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,c=()=>{a||(a=!0,Lc.window.withProgress({location:Lc.ProgressLocation.Notification,title:t},async(l,u)=>{let p=vt.instance.kernelResourceProgressReporter.get(e);if(p){for(p.reporter=l;p.pendingProgress.length>0;){let m=p.pendingProgress.shift();m===t?p.progressList.push(m):m!==t&&m&&(p.progressList.push(m),l.report({message:m}))}await or(u,i.promise),vt.instance.kernelResourceProgressReporter.get(e)===p&&vt.instance.kernelResourceProgressReporter.delete(e),vt.disposables.delete(o)}}).then(f,f))};return vt.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:c}),vt.disposables.add(o),s.pendingProgress.push(t),n||c(),{dispose:()=>o.dispose(),show:c}}};vt.disposables=new Set,vt=v([(0,$P.injectable)(),d(0,(0,$P.inject)(F))],vt);var kg=D(O()),HP=require("vscode");var Dr=Symbol("IPlatformService"),at=Symbol("IFileSystem");var J_e=Symbol("IBufferDecoder"),Mi=Symbol("IProcessServiceFactory"),Cx=class extends et{constructor(e){super("unknown",e)}};var eM=class{constructor(e,t){this.uri=e;this.value=t}};function Kae(r){return Array.isArray(r)}var Fae,So=class r{constructor(e,t){this[Fae]="ResourceMap";if(e instanceof r)this.map=new Map(e.map),this.toKey=t??r.defaultToKey;else if(Kae(e)){this.map=new Map,this.toKey=t??r.defaultToKey;for(let[n,i]of e)this.set(n,i)}else this.map=new Map,this.toKey=e??r.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new eM(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,n]of this.map)e(n.value,n.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(Fae=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},Lae,Uc=class{constructor(e,t){this[Lae]="ResourceSet";!e||typeof e=="function"?this._map=new So(e):(this._map=new So(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((n,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(Lae=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var Uae,r3=class{constructor(){this[Uae]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let n=this._map.get(e);if(n)return t!==0&&this.touch(n,t),n.value}set(e,t,n=0){let i=this._map.get(e);if(i)i.value=t,n!==0&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.key,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.value,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:[n.key,n.value],done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}[(Uae=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};var jc=class{constructor(e,t,n){this.processFactory=e;this.platform=t;this.fs=n;this.userSitePaths=new So}async getExecutablesPath(e){let t=e.executable.uri;if(!(Be(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let n=this.getUserSitePathImpl(t);n.catch(()=>{this.userSitePaths.get(t)===n&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,n)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),n="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${n}");print(site.${i});print("${n}");`]);if(o.includes(n)){let s=o.substring(o.indexOf(n)+n.length,o.lastIndexOf(n)).trim(),a=HP.Uri.file(s),c;if(this.platform.isWindows?c=HP.Uri.joinPath(Ei(a),"Scripts"):c=HP.Uri.joinPath(a,"bin"),!c||!this.fs.exists(c))throw new Error(`USER_SITE ${c.fsPath} dir does not exist for the interpreter ${$(e)}`);return E(`USER_SITE for ${$(e)} is ${c.fsPath}`),c}else throw new Error(`USER_SITE not found for the interpreter ${$(e)}. Stdout: ${o}`)}};v([Lr()],jc.prototype,"getExecutablesPath",1),jc=v([(0,kg.injectable)(),d(0,(0,kg.inject)(Mi)),d(1,(0,kg.inject)(Dr)),d(2,(0,kg.inject)(at))],jc);var tM=require("vscode");var n3=6e4,Pp=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=n;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,n){let i=b.activatingPythonEnvironment(jr(t));return vt.wrapAndReportProgress(e,i,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,t.id,n))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,n){let i=await this.interpreterService.resolveEnvironment(t);if(!i){W(`Failed to resolve environment for ${t}`);return}let o=`${e?.toString()||""}${t}`,s=this.activatedEnvVariablesCache.get(o);if(s&&s.time.elapsedTime>=n3&&this.activatedEnvVariablesCache.delete(o),!this.activatedEnvVariablesCache.has(o)){let c=this.getActivatedEnvironmentVariablesImpl(e,i,n);c.catch(f),this.activatedEnvVariablesCache.set(o,{promise:c,time:new Je})}let a=this.activatedEnvVariablesCache.get(o).promise;return n?a:or(n,a)}async getActivatedEnvironmentVariablesImpl(e,t,n){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new Je;return this.getActivatedEnvironmentVariablesFromPython(e,t,n).then(o=>{if(!n?.isCancellationRequested)return o}).catch(o=>{x(`Failed to get env vars with python ${$(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,n){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>n3&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,n);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new Je})}return or(n,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,n){e=e||(tM.workspace.workspaceFolders?.length?tM.workspace.workspaceFolders[0].uri:void 0);let i=new Je,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,c=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,t,!1).catch(p=>{x(`Failed to get activated env variables from Python Extension for ${$(t.path)}`,p),s="failedToGetActivatedEnvVariablesFromPython"}));if(n?.isCancellationRequested)return;let l=Be(t);if(N("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:l,source:"python",failed:Object.keys(c||{}).length===0,reason:s},a),c?E(`Got env vars from Python Ext in ${i.elapsedTime}ms for ${$(t.path)}, with env var count ${Object.keys(c||{}).length}. 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`):l==="Conda"?x(`Failed to get activated conda env vars for ${$(t.path)}
                 in ${i.elapsedTime}ms`):W(`Failed to get activated env vars for ${$(t.path)} in ${i.elapsedTime}ms`),!c){let u=await o;if(c={},Be(t)==="Conda"){let y=await Ea(t);y?c.CONDA_PREFIX=y:W(`Failed to get the SysPrefix for the Conda Environment ${$(t.path)}}`)}this.envVarsService.mergeVariables(process.env,c),this.envVarsService.mergeVariables(u,c),this.envVarsService.mergePaths(process.env,c),process.env.PYTHONPATH&&(c.PYTHONPATH=process.env.PYTHONPATH);let p=u?Object.keys(u).find(y=>y.toLowerCase()=="path"):void 0;p&&u[p]&&this.envVarsService.appendPath(c,u[p]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(c,u.PYTHONPATH);let m=await this.globalExecPaths.getExecutablesPath(t).catch(f);if(n?.isCancellationRequested)return;let h=c.PATH||c.Path,g=h?h.split(Gn):[];m&&g[1]!==m.fsPath?(E(`Prepend PATH with user site path for ${$(t.path)}, user site ${m.fsPath}`),this.envVarsService.prependPath(c,m.fsPath)):wr(t)||x(`Unable to determine site packages path for python ${$(t.path)} (${Be(t)})`),!c.PATH&&c.Path&&(c.PATH=c.Path)}return t.executable.uri&&(E(`Prepend PATH with python bin for ${$(t.path)}`),this.envVarsService.prependPath(c,dt(t.executable.uri.fsPath))),E(`Activated Env Variables for ${$(t.path)}, 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`),c}};v([oi("Getting activated env variables",1),d(1,Wl("id"))],Pp.prototype,"getActivatedEnvironmentVariablesImpl",1),v([d(1,Wl("id")),d(2,ip())],Pp.prototype,"getActivatedEnvironmentVariablesFromPython",1),Pp=v([(0,Gl.injectable)(),d(0,(0,Gl.inject)(st)),d(1,(0,Gl.inject)(Fc)),d(2,(0,Gl.inject)(tr)),d(3,(0,Gl.inject)(Ye)),d(4,(0,Gl.inject)(Kc)),d(5,(0,Gl.inject)(jc))],Pp);var Vs=Symbol("IEnvironmentActivationService");var _g=D(O()),Tg=require("vscode");var Dg=class{constructor(e,t,n){this.disposables=e;this.extensionChecker=t;this.pythonApi=n;this._changed=new Tg.EventEmitter;this._registered=!1;Tg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(Tg.window.activeNotebookEditor&&Rt(Tg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(f))}};Dg=v([(0,_g.injectable)(),d(0,(0,_g.inject)(F)),d(1,(0,_g.inject)(Ye)),d(2,(0,_g.inject)(tr))],Dg);function i3(r){r.addSingleton(tr,og),r.addSingleton(Ye,dp),r.addSingleton(st,sg),r.addSingleton(be,Dg),r.addSingleton(Vs,Pp)}var o3=D(O());var wx=require("vscode");var Rg=class{activate(){wx.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await wx.window.showInformationMessage(e,ve.reload)===ve.reload&&wx.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};Rg=v([(0,o3.injectable)()],Rg);var s3=D(O()),Xi=require("vscode");var zl=class{get activeDebugConsole(){return Xi.debug.activeDebugConsole}get activeDebugSession(){return ne(`Getting active debug session, ${Xi.debug.activeDebugSession?.name}`),Xi.debug.activeDebugSession}get breakpoints(){return Xi.debug.breakpoints}get onDidChangeActiveDebugSession(){return Xi.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return Xi.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return Xi.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return Xi.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return Xi.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return Xi.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return Xi.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,n){return Xi.debug.startDebugging(e,t,n)}addBreakpoints(e){Xi.debug.addBreakpoints(e)}removeBreakpoints(e){Xi.debug.removeBreakpoints(e)}};zl.instance=new zl,zl=v([(0,s3.injectable)()],zl);var GP=D(O()),rM=require("vscode");var Ag=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,n){if(ni&&this.extensionContext.extensionMode!==rM.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,n||"");return}if(n)await this.extensionContext.secrets.store(`${e}.${t}`,n);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){x(i)}}async retrieve(e,t){if(ni&&this.extensionContext.extensionMode!==rM.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){x(i)}}}};Ag=v([(0,GP.injectable)(),d(0,(0,GP.inject)(ut))],Ag);var zP=D(O()),Ex=require("vscode");var Ng=class{constructor(e){this._extensions=[];e.push(Ex.extensions.onDidChange(()=>this._extensions=Ex.extensions.all)),this._extensions=Ex.extensions.all}get extensions(){return this._extensions}determineExtensionFromCallStack(e){e=e||new Error().stack;try{let t=Ex.extensions.getExtension($e).extensionUri.toString().toLowerCase(),n=[];if(e){n=e.split(`
`).map(c=>{let l=/\((.*)\)/.exec(c),u=l?l[1]:void 0;try{let p=/\((.*)\:\d*\:\d*\)/.exec(c);if(!p)return u;if(!u||u.startsWith(p[1]))return p[1]}catch{}return u}).filter(c=>c&&!c.toLowerCase().startsWith(t));let i=t.split(/[\\/]/),o=i.findIndex(c=>c.startsWith($e)),s=o===-1?void 0:i[o-1];mN(new Error("Ex")).forEach(c=>{let l=c.getFileName();l&&!l.toLowerCase().startsWith(t)&&n.push(l)});for(let c of n){let l=this.extensions.find(u=>u.id!==$e&&(c.toLowerCase().startsWith(u.extensionUri.fsPath.toLowerCase())||c.toLowerCase().startsWith(u.extensionUri.path.toLowerCase())));if(l)return{extensionId:l.id,displayName:l.packageJSON.displayName}}let a=n.find(c=>c.includes($e));if(a&&(a=a.substring(0,a.indexOf($e)-1)),!s||!a)return{extensionId:Sh,displayName:b.unknownPackage};for(let c of n.filter(l=>l.startsWith(a)&&!l.includes($e))){let l=c.substring(a.length).substring(1).split(/[\\/]/)[0];l.includes("-")&&(l=l.substring(0,l.lastIndexOf("-")));let u=this.extensions.find(p=>p.id===l);if(u)return{extensionId:u.id,displayName:u.packageJSON.displayName}}}return x("Unable to determine the caller of the extension API for trace stack",e),x("Jupyter Root",t),x("Frames",n),{extensionId:Sh,displayName:b.unknownPackage}}catch(t){return x("Unable to determine the caller of the extension API for trace stack.",e),x("Failure error",t),{extensionId:Sh,displayName:b.unknownPackage}}}};Ng=v([(0,zP.injectable)(),d(0,(0,zP.inject)(F))],Ng);var QP=Symbol("IWorkspaceService"),Oi=Symbol("IDebugManager"),Wc=Symbol("IApplicationEnvironment"),h0e=Symbol("IWebviewPanelMessageListener"),g0e=Symbol("IWebviewViewMessageListener"),v0e=Symbol("IWebview"),y0e=Symbol("IWebviewView"),b0e=Symbol("IWebviewPanel"),kp=Symbol("IWebviewPanelProvider"),YP=Symbol("IWebviewViewProvider"),Px=Symbol("IEncryptedStorage");var a3=D(O());var Mg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};Mg=v([(0,a3.injectable)()],Mg);var Op=D(O()),f6=require("vscode"),Fx=D(m6());var kk=class{setSharedProperty(e,t){Qh(e,t)}postEvent(e,t){let n={};t.forEach((i,o)=>{n[o]=i}),N(e,void 0,n)}};var uO=D(require("vscode")),Dk=D(O());var Jg=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};Jg=v([(0,Dk.injectable)(),d(0,(0,Dk.inject)(ut))],Jg);function wo(){return uO.env.appName.indexOf("Insider")>0||uO.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var bpe="VSCode.ABExp.FeatureData",pO="vscode",$g=class{constructor(e,t,n){this.configurationService=e;this.appEnvironment=t;this.globalState=n;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(c=>!c.endsWith("control")),this._optOutFrom=o.filter(c=>!c.endsWith("control")),!this.enabled)return;let s;wo()==="insiders"?s=Fx.TargetPopulation.Insiders:s=Fx.TargetPopulation.Public;let a=new kk;this.experimentationService=(0,Fx.getExperimentationService)($e,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(E(`Experimentation service retrieved: ${this.experimentationService}`),await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(pO,e),!0):e==="KernelCompletions"&&(wo()==="insiders"||$u())||e==="DoNotWaitForZmqPortsToBeUsed"&&(wo()==="insiders"||$u())||e==="DataViewerContribution"&&(wo()==="insiders"||$u())?!0:this.experimentationService.getTreatmentVariable(pO,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(pO,e)}getFeatures(){return this.globalState.get(bpe,{features:[]}).features}logExperiments(){let e=f6.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(ee("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(ee("Telemetry level is off"),t=!0),t&&ee("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){ee(up.inGroup("All"));return}let n=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{ee(up.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),ee(up.inGroup(o))}),t&&!i.has("KernelCompletions")&&(wo()==="insiders"||$u())&&ee(up.inGroup("KernelCompletions")),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(wo()==="insiders"||$u())&&ee(up.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(n.add(o),ee(up.inGroup(o)))})}};$g=v([(0,Op.injectable)(),d(0,(0,Op.inject)(ue)),d(1,(0,Op.inject)(Wc)),d(2,(0,Op.inject)(He)),d(2,(0,Op.named)(bt))],$g);var Rk=D(O()),Yo=require("vscode");var Tk=require("vscode");function Kp(r){Tk.env.openExternal(typeof r=="string"?Tk.Uri.parse(r):r).then(f,f)}var Ipe=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:tx.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:tx.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:tx.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Hg=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Yo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Yo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){Ipe.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Yo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let n="Learn more",i="Never show again",o=await Yo.window.showInformationMessage(e.message,n,i);if(o)switch(o){case n:{Kp(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Yo.workspace.workspaceFolders)&&Yo.workspace.workspaceFolders.length>0?Yo.workspace.workspaceFolders.forEach(n=>{t||(t=this.isDeprecatedSettingAndValueUsed(Yo.workspace.getConfiguration("jupyter",n.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Yo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(n=>E("Jupyter Extension: notifyDeprecation",n))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let n=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(n)?n.length>0:!0:!Array.isArray(t.values)||t.values.length===0?n===void 0?!1:Array.isArray(n)?n.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Hg=v([(0,Rk.injectable)(),d(0,(0,Rk.inject)(ac))],Hg);var Fp=D(O());var Ak=class{constructor(e,t,n,i){this.storage=e;this.key=t;this.defaultValue=n;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},Gg=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,n){return new Ak(this.globalState,e,t,n)}createWorkspacePersistentState(e,t,n){return new Ak(this.workspaceState,e,t,n)}};Gg=v([(0,Fp.injectable)(),d(0,(0,Fp.inject)(He)),d(0,(0,Fp.named)(bt)),d(1,(0,Fp.inject)(He)),d(1,(0,Fp.named)(si))],Gg);var h6="Path",g6="PATH",v6=/^win/.test(process.platform);var y6=D(O()),qc=require("vscode");var Ne=class r extends Error{static{this.back=new r("back")}static{this.cancel=new r("cancel")}static{this.resume=new r("resume")}},Lx=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:n,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:c,matchOnDescription:l,matchOnDetail:u,acceptFilterBoxTextAsSelection:p,startBusy:m,stopBusy:h,validate:g,onDidTriggerItemButton:y,onDidTriggerButton:C,supportBackInFirstStep:k,onDidChangeItems:A,ignoreFocusOut:T}){let U=[],oe=le(),G=qc.window.createQuickPick();return G.title=e,G.step=t,G.totalSteps=n,G.placeholder=s,G.ignoreFocusOut=T??!0,G.items=i,h&&(G.busy=m??!1,h(()=>{G.enabled&&(G.busy=!1)},this,U)),A&&(G.keepScrollPosition=!0,A(pe=>{G.items=pe},this,U)),y&&G.onDidTriggerItemButton(pe=>y(pe),void 0,U),G.matchOnDescription=l||!1,G.matchOnDetail=u||!1,o?G.activeItems=[o]:G.activeItems=[],G.buttons=[...this.steps.length>1||k?[qc.QuickInputButtons.Back]:[],...a||[]],U.push(G.onDidTriggerButton(pe=>{pe===qc.QuickInputButtons.Back?oe.reject(Ne.back):C?C(pe):oe.resolve(pe)}),G.onDidChangeSelection(async pe=>{let de=pe.length?pe[0].label:"",te=!!de;if(de&&g&&pe.length){G.enabled=!1,G.busy=!0;let we=await g(pe[0]);we&&(te=!1,await qc.window.showErrorMessage(we,{modal:!0})),G.enabled=!0,G.busy=!1}te&&oe.resolve(pe[0])}),G.onDidHide(()=>{(async()=>{oe.reject(c&&await c()?Ne.resume:Ne.cancel)})().catch(oe.reject)})),p&&U.push(G.onDidAccept(async()=>{if(!G.busy){let pe=g?await g(G):void 0;pe?(G.enabled=!1,G.busy=!0,await qc.window.showErrorMessage(pe),G.enabled=!0,G.busy=!1):oe.resolve(G.value)}})),this.current&&this.current.dispose(),this.current=G,this.current.show(),oe.promise.finally(()=>z(U)).catch(f),{quickPick:G,selection:oe.promise}}async showInputBox({title:e,step:t,totalSteps:n,value:i,prompt:o,validate:s,password:a,buttons:c,shouldResume:l,validationMessage:u}){let p=[];try{return await new Promise((m,h)=>{let g=qc.window.createInputBox();g.title=e,g.step=t,g.totalSteps=n,g.password=!!a,g.value=i||"",g.prompt=o,g.validationMessage=u||"",g.ignoreFocusOut=!0,g.validationMessage=u||"",g.buttons=[...this.steps.length>1?[qc.QuickInputButtons.Back]:[],...c||[]],p.push(g.onDidTriggerButton(y=>{y===qc.QuickInputButtons.Back?h(Ne.back):m(y)}),g.onDidAccept(async()=>{let y=g.value;g.enabled=!1,g.busy=!0;let C=await s(y);C?(g.validationMessage=C,g.show()):(g.validationMessage="",m(y)),g.enabled=!0,g.busy=!1}),g.onDidChangeValue(async()=>{g.validationMessage=""}),g.onDidHide(()=>{(async()=>{g.busy||h(l&&await l()?Ne.resume:Ne.cancel)})().catch(h)})),this.current&&this.current.dispose(),this.current=g,this.current.show()})}finally{p.forEach(m=>m.dispose())}}async stepThrough(e,t){let n=e;for(;n;){this.steps.push(n),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{n=await n(this,t)}catch(i){if(i===Ne.back)this.steps.pop(),n=this.steps.pop();else if(i===Ne.resume)n=this.steps.pop();else if(i===Ne.cancel)n=void 0;else throw i;if(!n)return i}}this.current&&this.current.dispose()}},Qg=Symbol("IMultiStepInputFactory"),zg=class{create(){return new Lx}};zg=v([(0,y6.injectable)()],zg);var b6=D(O()),I6=require("vscode");var Yg=class{activate(){I6.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{MS.includes(t)||MS.push(t)})},f)}};Yg=v([(0,b6.injectable)()],Yg);var Xl=D(Hc());function jp(r){return Ur()==="Windows"?xn(r).toUpperCase():xn(r)}function Wp(r,e){return jp(r)===jp(e)}function rv(r,e){return e.endsWith(Hn)||(e+=Hn),r.endsWith(Hn)||(r+=Hn),jp(r).startsWith(jp(e))}var SJ=require("os"),NO;function xJ(r){NO=r}async function CJ(r,e={}){return(await NO.get(Mi).create(void 0)).shellExec(r,e)}function nv(r){return Xl.pathExists(r)}function MO(r){return Xl.pathExistsSync(r)}function wJ(r){return Xl.readFile(r,"utf-8")}function EJ(r){return Xl.readFileSync(r,"utf-8")}var $k=r=>Dh(r,(0,SJ.homedir)());function PJ(r){return NO.get(ue).getSettings()[r]}var TJ=D(O()),Vm=D(require("os")),RJ=D(ig()),KO=require("vscode");var OO=require("vscode"),DJ=D(require("os"));var kJ=DJ.homedir();function Wm(r){return process.env[r]}function iv(){if(Ur()==="Windows")return OO.Uri.file(Wm("USERPROFILE")||kJ);let r=Wm("HOME")||Wm("HOMEPATH")||kJ;return OO.Uri.file(r.replace(/\\/g,"/"))}var ov=D(ig());function _J(r){r=r.replace(/\.00*(?=[1-9]|0\.)/,".");let e=ov.coerce(r);return e===null||!ov.valid(e)?new ov.SemVer("0.0.0"):e}var Gc=class{constructor(){this._homeDir=iv()||KO.Uri.file(Vm.homedir());this._tempDir=KO.Uri.file(Vm.tmpdir());this.osType=Ur();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?h6:g6}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,RJ.coerce)(Vm.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return _J(Vm.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};Gc=v([(0,TJ.injectable)()],Gc);function AJ(r){r.addSingleton(Dr,Gc),xJ(r.get(pt))}var Qk=D(O()),OJ=require("vscode");var Bm=require("child_process"),zk=require("vscode");var FO="utf8";var Hk=require("vscode"),NJ=require("os"),Gk=Hk.Uri.file((0,NJ.homedir)());function MJ(r,e){let t=e?[{uri:Hk.Uri.file(e),name:"",index:0}]:[];return $(r?Hk.Uri.file(r):void 0,t,Gk)}function An(r,e=[]){return $(r,e,Gk)}function LO(r,e,t){let n=e.reduce((o,s,a)=>{let c=US(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(c=`${s[0]}${An(s.substr(1))}`),a===0?c:`${o} ${c}`},""),i=[`Process Execution: ${An(r)} ${n}`];t&&t.cwd&&i.push(`    > ${cN.currentWorkingDirectory} ${An(t.cwd.toString())}`),ee(i.join(`
`))}var UO=class{decode(e){return Buffer.concat(e).toString(FO)}},Vp=class Vp{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new UO}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Bm.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Bm.spawn)(e,t,i),s=!1;ne(`Exec observable ${e}, ${t.join(" ")}`);let a=[],c={dispose:function(){o&&!o.killed&&!s&&Vp.kill(o.pid),o&&o.unref(),z(a)}};this.processesToKill.add(c);let l=ome();a.push(l);let u=(m,h,g)=>{m.on(h,g),a.push({dispose:()=>m.removeListener(h,g)})};n.token&&a.push(n.token.onCancellationRequested(()=>{!s&&!o.killed&&(Vp.kill(o.pid),s=!0)}));let p=(m,h)=>{let g=this.decoder.decode([h]);m==="stderr"&&n.throwOnStdErr?l.reject(new Cx(g)):l.fire({source:m,out:g})};return u(o.stdout,"data",m=>p("stdout",m)),u(o.stderr,"data",m=>p("stderr",m)),o.once("close",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("exit",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("error",m=>{s=!0,l.reject(m),a.forEach(h=>h.dispose())}),LO(e,t,n),{proc:o,out:l,dispose:c.dispose}}exec(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Bm.spawn)(e,t,i),s=le(),a={dispose:()=>{!o.killed&&!s.completed&&Vp.kill(o.pid)}};this.processesToKill.add(a);let c=[],l=(m,h,g)=>{m.on(h,g),c.push({dispose:()=>m.removeListener(h,g)})};n.token&&c.push(n.token.onCancellationRequested(a.dispose));let u=[];l(o.stdout,"data",m=>u.push(m));let p=[];return l(o.stderr,"data",m=>{n.mergeStdOutErr&&u.push(m),p.push(m)}),o.once("close",()=>{if(s.completed)return;let m=p.length===0?void 0:this.decoder.decode(p);if(m&&m.length>0&&n.throwOnStdErr)s.reject(new Cx(m));else{let h=this.decoder.decode(u);s.resolve({stdout:h,stderr:m})}c.forEach(h=>h.dispose())}),o.once("error",m=>{s.reject(m),c.forEach(h=>h.dispose())}),LO(e,t,n),s.promise}shellExec(e,t={}){let n=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Bm.exec)(e,n,(l,u,p)=>{s?.dispose(),l&&l!==null?o(l):n.throwOnStdErr&&p&&p.length?o(new Error(p)):i({stderr:p&&p.length>0?p:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new zk.CancellationError),Vp.kill(a.pid))}));let c={dispose:()=>{a.killed||Vp.kill(a.pid)}};this.processesToKill.add(c)})}getDefaultOptions(e){let t={...e},n=t;if(n){let i=n.encoding=typeof n.encoding=="string"&&n.encoding.length>0?n.encoding:FO;delete n.encoding,n.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t}};v([oi("Execing shell command",5),d(1,ip())],Vp.prototype,"shellExec",1);var zc=Vp;function ome(){let r=new zk.EventEmitter,e=le();return e.promise.catch(f),{get onDidChange(){return r.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:r.fire.bind(r),dispose:()=>{r.dispose()}}}var qm=class{constructor(e){this.envVarsService=e}async create(e,t){if(!OJ.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return DP(new zc(n))}};v([oi("Create ProcessService",5)],qm.prototype,"create",1),qm=v([(0,Qk.injectable)(),d(0,(0,Qk.inject)(Fc))],qm);function KJ(r){r.addSingleton(Mi,qm)}var LJ=D(require("os")),Xk=D(O());var sv=D(require("vscode")),FJ;(c=>{let r=sv.FileSystemError.FileNotFound().name,e=sv.FileSystemError.FileExists().name,t=sv.FileSystemError.FileIsADirectory().name,n=sv.FileSystemError.FileNotADirectory().name,i=sv.FileSystemError.NoPermissions().name,o=[r,e,t,n,i];function s(l,u){if(o.includes(l.name))return l.name===u}function a(l){return s(l,r)}c.isFileNotFound=a})(FJ||={});function sme(r,e){let t=r.code;if(t)return t===e}function Yk(r){let e=FJ.isFileNotFound(r);return e!==void 0?e:sme(r,"ENOENT")}var UJ=require("vscode");var av=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return ame(await this.fs.readFile(UJ.Uri.file(e)),t)}catch(n){Yk(n)||x(`Failed to parse env file ${e}`,n)}}mergeVariables(e,t){t&&Object.keys(e).forEach(n=>{let i=n.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||n;t[o]=e[n]})}mergePaths(e,t){let n=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||n;n&&i&&(t[i]=e[n])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,n,...i){let o=i.filter(m=>typeof m=="string"&&m.trim().length>0).map(m=>m.trim()).join(Gn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(m=>m.toLowerCase()==s):void 0,c=e&&a?e[a]:void 0,l=a||t;c&&typeof c=="string"&&c.length>0?n&&!(e[l]||"").endsWith(Gn+o)?e[l]=c+Gn+o:!n&&!(e[l]||"").startsWith(o+Gn)&&(e[l]=o+Gn+c):e[l]=o;let p=["Path","PATH"].find(m=>m!==l);if(LJ.platform()==="win32"&&p&&p in e&&typeof e[p]=="string"){let m=e[p],h=p;m&&typeof m=="string"&&m.length>0?n&&!(e[h]||"").endsWith(Gn+o)?e[h]=m+Gn+o:!n&&!(e[h]||"").startsWith(o+Gn)&&(e[h]=o+Gn+m):e[h]=o}return e}};av=v([(0,Xk.injectable)(),d(0,(0,Xk.inject)(at))],av);function ame(r,e){let t=e||{},n={};return r.toString().split(`
`).forEach((i,o)=>{let[s,a]=cme(i);s!==""&&(n[s]=ume(a,n,t))}),n}function cme(r){let e=r.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],n=e[2];return n&&n!==""?n[0]==="'"&&n[n.length-1]==="'"?(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n[0]==='"'&&n[n.length-1]==='"'&&(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n="",[t,n]}var lme=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function ume(r,e,t,n=""){let i=!1,o=r;return o=o.replace(lme,(s,a,c,l,u)=>l>0&&u[l-1]==="\\"?s:c&&c!==""||!a||a===""?(i=!0,s):e[a]||t[a]||n),!i&&o!==r&&(r=o,N("ENVFILE_VARIABLE_SUBSTITUTION")),r.replace(/\\\$/g,"$")}var Qc=D(O());var ko=require("vscode");var Aa=require("vscode");var jO={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function WO(r){return Array.isArray?Array.isArray(r):!!(r&&typeof r.length===jO.number&&r.constructor===Array)}function Zk(r){return typeof r===jO.string||r instanceof String}function VO(r){return typeof r===jO.object&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}var eD=class{resolve(e){return Zk(e)?this.__resolveString(e):WO(e)?this.__resolveArray(e):VO(e)?this.__resolveLiteral(e):e}resolveAny(e){return Zk(e)?this.__resolveString(e):WO(e)?this.__resolveAnyArray(e):VO(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(n,i)=>{let o=this[i];return Zk(o)?o:n&&(n.indexOf("env.")>0||n.indexOf("env:")>0)?"":n})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var cv=class extends eD{constructor(t,n){super();let i=t?Aa.workspace.getWorkspaceFolder(t):void 0;this._workspaceFolder=i?i.uri.fsPath:n?.fsPath||__dirname,this._workspaceFolderName=_e(this._workspaceFolder),this._filePath=t?t.fsPath:void 0,Aa.window&&Aa.window.activeTextEditor&&(this._lineNumber=Aa.window.activeTextEditor.selection.anchor.line+1,this._selectedText=Aa.window.activeTextEditor.document.getText(new Aa.Range(Aa.window.activeTextEditor.selection.start,Aa.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(o=>{this[`env:${o}`]=this[`env.${o}`]=process.env[o]})}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?sE(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?dt(this.relativeFile):void 0}get fileBasename(){return this.file?_e(this.file):void 0}get fileBasenameNoExtension(){return this.file?a2(this.file).name:void 0}get fileDirname(){return this.file?dt(this.file):void 0}get fileExtname(){return this.file?Ji(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var rD=require("vscode"),Jx,tD=!1;function jJ(){BJ()&&VJ()}async function WJ(r,e){if(BJ()){let n=new cv(e,void 0).resolveAny(qJ());await r.exists(rD.Uri.file(n))&&VJ()}}function VJ(){N("ENVFILE_WORKSPACE"),tD=!0}function BJ(){return!tD}function qJ(){return Jx||(Jx=rD.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),Jx}var dme;(t=>{function r({telemetrySent:n,defaultSetting:i}){n!==void 0&&(tD=n),qJ!==void 0&&(Jx=i)}t.setState=r;function e(){Jx=void 0,tD=!1}t.resetState=e})(dme||={});var mme=60*1e3,Jm=class{constructor(e,t,n,i,o=mme){this.envVarsService=e;this.extensionChecker=n;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new ko.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),z(this.disposables)}async getEnvironmentVariables(e,t,n){if(e=e||(ko.workspace.workspaceFolders?.length?ko.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,n);let i=new lm(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return E(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,n);return o.then(s=>{n?.isCancellationRequested||(i.data=s)}).catch(f),o}async getCustomEnvironmentVariables(e,t,n){e=e||(ko.workspace.workspaceFolders?.length?ko.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){ne(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let c=await this.pythonApi.getNewApi();if(c&&!n?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,c.environments.onDidEnvironmentVariablesChange(l=>{E(`Python env vars changed ${l.resource?.uri?.path}`),this.onEnvironmentFileChanged(l.resource?.uri),this.changeEventEmitter.fire(l.resource?.uri)},this,this.disposables)),c.environments.getEnvironmentVariables(i)}let o=new lm(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return E(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(n?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(c=>{n?.isCancellationRequested||(o.data=c)}).catch(f),a}createFileWatcher(e,t){let n=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(n))return;let i=new ko.RelativePattern(ko.Uri.file(dt(e)),_e(e)),o=ko.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(n),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):x("Failed to create file watcher for environment file")}getEnvFile(e){return Ve(e.fsPath,".env")}async _getEnvironmentVariables(e,t,n){let i=await this.getCustomEnvironmentVariables(e,t,n);if(n?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=ko.workspace.workspaceFolders||[],n=t.length===1?t[0].uri:void 0;return e&&ko.workspace.getWorkspaceFolder(e)?.uri||n}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),jJ()}onEnvironmentFileChanged(e){new lm(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new lm(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${Ms(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${Ms(e)}:RunNonPythonCode:CustomVars`}};v([oi("Get Custom Env Variables",1)],Jm.prototype,"getEnvironmentVariables",1),Jm=v([(0,Qc.injectable)(),d(0,(0,Qc.inject)(Kc)),d(1,(0,Qc.inject)(F)),d(2,(0,Qc.inject)(Ye)),d(3,(0,Qc.inject)(tr)),d(4,(0,Qc.inject)("number")),d(4,(0,Qc.optional)())],Jm);function JJ(r){r.addSingleton(Kc,av),r.addSingleton(Fc,Jm)}var $J=D(O()),Bp=require("vscode");var BO=require("vscode");var lv=class{activate(){Bp.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=BO.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let n=t+1,i={"ms-toolsai.jupyter":n,"ms-toolsai.jupyter-renderers":n};Bp.extensions.getExtension(ii)&&(i[ii]=n),Bp.extensions.getExtension(am)&&(i[am]=n),await BO.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},Bp.ConfigurationTarget.Global),Bp.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};lv=v([(0,$J.injectable)()],lv);var $x=require("vscode");var Yc=D(O());var HJ=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList"],uv=class{constructor(e,t,n,i){this.globalState=e;this.crypto=t;this.workspaceState=n;this.extensionContext=i}activate(){this.removeOldCachedItems().then(f,f)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(HJ).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(f,f)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(HJ.map(t=>this.globalState.keys().filter(n=>n.startsWith(t)).map(n=>this.globalState.update(n,void 0).then(f,f))).flat()),await this.extensionContext.secrets.delete(`${ri.JupyterServerRemoteLaunchService}.remote-uri-list`).then(f,f)}async getUriAccountKey(){let e=Os();return e?this.crypto.createHash(Te(e),"SHA-512"):$x.workspace.workspaceFile?this.crypto.createHash(Te($x.workspace.workspaceFile),"SHA-512"):$x.env.machineId}};uv=v([(0,Yc.injectable)(),d(0,(0,Yc.inject)(He)),d(0,(0,Yc.named)(bt)),d(1,(0,Yc.inject)(Ah)),d(2,(0,Yc.inject)(He)),d(2,(0,Yc.named)(si)),d(3,(0,Yc.inject)(ut))],uv);function GJ(r){r.addSingletonInstance(E2,v6),r.addSingleton(Ia,Ng),r.addSingleton(ac,Gg),r.addSingleton(Oi,zl),r.addSingleton(Wc,Jg),r.addSingleton(Px,Ag),r.addSingleton(Ah,qh),r.addSingleton(Ds,$g),r.addSingleton(uE,Hg),r.addSingleton(ai,Mg),r.addSingleton(Qg,zg),r.addSingleton(be,Yg),r.addSingleton(be,uv),r.addSingleton(be,Rg),r.addSingleton(be,lv),AJ(r),KJ(r),JJ(r)}var iD=D(O());var rs=Ve(__dirname,"..");var qO=Ve(rs,"pythonFiles"),fme=qO;function zJ(){let e=[Ve(fme,"normalizeSelection.py")];function t(n){return n}return[e,t]}var Fi=require("vscode");var nD=class{async normalizeLines(e,t){return e}async getFileToExecute(){let e=Fi.window.activeTextEditor;if(!e){Fi.window.showErrorMessage("No open file to run in terminal").then(f,f);return}if(e.document.isUntitled){Fi.window.showErrorMessage("The active file needs to be saved before it can be run").then(f,f);return}if(e.document.languageId!==xe){Fi.window.showErrorMessage("The active file is not a Python source file").then(f,f);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,n;return t.isEmpty?n=e.document.lineAt(t.start.line).text:t.isSingleLine?n=this.getSingleLineSelectionText(e):n=this.getMultiLineSelectionText(e),Ph(n.trimEnd())}async saveFileIfDirty(e){let t=Fi.workspace.textDocuments.filter(n=>n.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}getSingleLineSelectionText(e){let t=e.selection,n=new Fi.Range(t.start,t.end),i=e.document.getText(n),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,n=new Fi.Range(t.start,t.end),i=e.document.getText(n),o=new Fi.Range(new Fi.Position(t.start.line,0),new Fi.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,c=new Fi.Range(t.start,new Fi.Position(t.start.line,a.length)),l=e.document.getText(c);return l.trimStart()===a.trimStart()?a+i.substring(l.length):i}};var pv=class extends nD{constructor(t){super();this.processServiceFactory=t.get(Mi),this.interpreterService=t.get(st)}async normalizeLines(t,n){let i=[];try{let o=t.trim();if(o.length===0)return"";if(t=t.replace(new RegExp("\\r","g"),""),o.indexOf(`
`)===-1)return o+`
`;let s=await this.interpreterService.getActiveInterpreter(n),a=await this.processServiceFactory.create(n),[c,l]=zJ(),u=a.execObservable(Te(s?.uri)||"python",c,{throwOnStdErr:!0}),p="";u.out.onDidChange(A=>{A.source==="stdout"&&(p+=A.out)},this,i);let m=JSON.stringify({code:t});u.proc?.stdin?.write(m),u.proc?.stdin?.end(),await u.out.done;let g=JSON.parse(p),y=l(g.normalized),C=Fe(t,{trim:!0,removeEmptyEntries:!1}).findIndex(A=>A.length),k=Fe(y,{trim:!0,removeEmptyEntries:!1}).findIndex(A=>A.length);if(C>k){let A=C-k;return`${`
`.repeat(A)}${y}`}return y}catch(o){return x(o,"Python: Failed to normalize code for execution in Interactive Window"),t}finally{z(i)}}};pv=v([(0,iD.injectable)(),d(0,(0,iD.inject)(pt))],pv);var oD=Symbol("ICodeExecutionHelper");function QJ(r){r.addSingleton(oD,pv)}var qp=D(O()),XJ=D(ig()),Hx=require("vscode");var YJ="CONDA_INFORMATION_CACHE";function JO(r){return r&&kh(r.fsPath)&&r.fsPath.startsWith(Hn)&&`${Hn}${_e(r.fsPath)}`===r.fsPath?_e(r.fsPath):r?.fsPath}var Hs=class{constructor(e,t,n){this.pythonApi=e;this.globalState=t;this.fs=n}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(f)}).catch(f);let n=Es(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.version?this._version=n.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return JO(this._file);if(this._previousFileCall)return this._previousFileCall.then(JO);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{E(`Conda file is ${i}`),this._file=i?Hx.Uri.file(i):void 0,this.updateCache().catch(f)}).catch(f);let n=Es(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.file?this._file=n.value.file:t.then(i=>i?Hx.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(JO)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(YJ,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(YJ,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(Hx.Uri.file(e.file));if(e.fileHash===t)return{version:new XJ.SemVer(e.version),file:Hx.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};Hs=v([(0,qp.injectable)(),d(0,(0,qp.inject)(tr)),d(1,(0,qp.inject)(He)),d(1,(0,qp.named)(bt)),d(2,(0,qp.inject)(at))],Hs);var Gx=D(O());var e8=D(sD());var ZJ="_VSCODE_getDataFrame",aD=e8.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Xc=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${ZJ}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:aD}:{code:`${t}

${i}

${aD}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${ZJ}("rows", ${n}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:aD}:{code:`${t}

${i}

${aD}`}}async getContentsOfDataFrameScript(){if(Xc.contentsOfDataFrameScript)return Xc.contentsOfDataFrameScript;let e=lr(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Xc.contentsOfDataFrameScript=t,t}};Xc=v([(0,Gx.injectable)(),d(0,(0,Gx.inject)(at)),d(1,(0,Gx.inject)(ut))],Xc);var Qx=D(O());function cD(r,e){e===void 0&&(e=!1);var t=r.length,n=0,i="",o=0,s=16,a=0,c=0,l=0,u=0,p=0;function m(T,U){for(var oe=0,G=0;oe<T||!U;){var pe=r.charCodeAt(n);if(pe>=48&&pe<=57)G=G*16+pe-48;else if(pe>=65&&pe<=70)G=G*16+pe-65+10;else if(pe>=97&&pe<=102)G=G*16+pe-97+10;else break;n++,oe++}return oe<T&&(G=-1),G}function h(T){n=T,i="",o=0,s=16,p=0}function g(){var T=n;if(r.charCodeAt(n)===48)n++;else for(n++;n<r.length&&dv(r.charCodeAt(n));)n++;if(n<r.length&&r.charCodeAt(n)===46)if(n++,n<r.length&&dv(r.charCodeAt(n)))for(n++;n<r.length&&dv(r.charCodeAt(n));)n++;else return p=3,r.substring(T,n);var U=n;if(n<r.length&&(r.charCodeAt(n)===69||r.charCodeAt(n)===101))if(n++,(n<r.length&&r.charCodeAt(n)===43||r.charCodeAt(n)===45)&&n++,n<r.length&&dv(r.charCodeAt(n))){for(n++;n<r.length&&dv(r.charCodeAt(n));)n++;U=n}else p=3;return r.substring(T,U)}function y(){for(var T="",U=n;;){if(n>=t){T+=r.substring(U,n),p=2;break}var oe=r.charCodeAt(n);if(oe===34){T+=r.substring(U,n),n++;break}if(oe===92){if(T+=r.substring(U,n),n++,n>=t){p=2;break}var G=r.charCodeAt(n++);switch(G){case 34:T+='"';break;case 92:T+="\\";break;case 47:T+="/";break;case 98:T+="\b";break;case 102:T+="\f";break;case 110:T+=`
`;break;case 114:T+="\r";break;case 116:T+="	";break;case 117:var pe=m(4,!0);pe>=0?T+=String.fromCharCode(pe):p=4;break;default:p=5}U=n;continue}if(oe>=0&&oe<=31)if(zx(oe)){T+=r.substring(U,n),p=2;break}else p=6;n++}return T}function C(){if(i="",p=0,o=n,c=a,u=l,n>=t)return o=t,s=17;var T=r.charCodeAt(n);if(HO(T)){do n++,i+=String.fromCharCode(T),T=r.charCodeAt(n);while(HO(T));return s=15}if(zx(T))return n++,i+=String.fromCharCode(T),T===13&&r.charCodeAt(n)===10&&(n++,i+=`
`),a++,l=n,s=14;switch(T){case 123:return n++,s=1;case 125:return n++,s=2;case 91:return n++,s=3;case 93:return n++,s=4;case 58:return n++,s=6;case 44:return n++,s=5;case 34:return n++,i=y(),s=10;case 47:var U=n-1;if(r.charCodeAt(n+1)===47){for(n+=2;n<t&&!zx(r.charCodeAt(n));)n++;return i=r.substring(U,n),s=12}if(r.charCodeAt(n+1)===42){n+=2;for(var oe=t-1,G=!1;n<oe;){var pe=r.charCodeAt(n);if(pe===42&&r.charCodeAt(n+1)===47){n+=2,G=!0;break}n++,zx(pe)&&(pe===13&&r.charCodeAt(n)===10&&n++,a++,l=n)}return G||(n++,p=1),i=r.substring(U,n),s=13}return i+=String.fromCharCode(T),n++,s=16;case 45:if(i+=String.fromCharCode(T),n++,n===t||!dv(r.charCodeAt(n)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=g(),s=11;default:for(;n<t&&k(T);)n++,T=r.charCodeAt(n);if(o!==n){switch(i=r.substring(o,n),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(T),n++,s=16}}function k(T){if(HO(T)||zx(T))return!1;switch(T){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function A(){var T;do T=C();while(T>=12&&T<=15);return T}return{setPosition:h,getPosition:function(){return n},scan:e?A:C,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return n-o},getTokenStartLine:function(){return c},getTokenStartCharacter:function(){return o-u},getTokenError:function(){return p}}}function HO(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function zx(r){return r===10||r===13||r===8232||r===8233}function dv(r){return r>=48&&r<=57}var lD;(function(r){r.DEFAULT={allowTrailingComma:!1}})(lD||(lD={}));function t8(r,e){var t=[],n=new Object,i=void 0,o={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(c,l,u,p){o.value=c,o.offset=l,o.length=u,o.type=p,o.colonOffset=void 0,i=o}try{QO(r,{onObjectBegin:function(c,l){if(e<=c)throw n;i=void 0,s=e>c,t.push("")},onObjectProperty:function(c,l,u){if(e<l||(a(c,l,u,"property"),t[t.length-1]=c,e<=l+u))throw n},onObjectEnd:function(c,l){if(e<=c)throw n;i=void 0,t.pop()},onArrayBegin:function(c,l){if(e<=c)throw n;i=void 0,t.push(0)},onArrayEnd:function(c,l){if(e<=c)throw n;i=void 0,t.pop()},onLiteralValue:function(c,l,u){if(e<l||(a(c,l,u,r8(c)),e<=l+u))throw n},onSeparator:function(c,l,u){if(e<=l)throw n;if(c===":"&&i&&i.type==="property")i.colonOffset=l,s=!1,i=void 0;else if(c===","){var p=t[t.length-1];typeof p=="number"?t[t.length-1]=p+1:(s=!0,t[t.length-1]=""),i=void 0}}})}catch(c){if(c!==n)throw c}return{path:t,previousNode:i,isAtPropertyKey:s,matches:function(c){for(var l=0,u=0;l<c.length&&u<t.length;u++)if(c[l]===t[u]||c[l]==="*")l++;else if(c[l]!=="**")return!1;return l===c.length}}}function GO(r,e,t){e===void 0&&(e=[]),t===void 0&&(t=lD.DEFAULT);var n={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(c){n.type==="property"&&(n.length=c-n.offset,n=n.parent)}function o(c){return n.children.push(c),c}var s={onObjectBegin:function(c){n=o({type:"object",offset:c,length:-1,parent:n,children:[]})},onObjectProperty:function(c,l,u){n=o({type:"property",offset:l,length:-1,parent:n,children:[]}),n.children.push({type:"string",value:c,offset:l,length:u,parent:n})},onObjectEnd:function(c,l){i(c+l),n.length=c+l-n.offset,n=n.parent,i(c+l)},onArrayBegin:function(c,l){n=o({type:"array",offset:c,length:-1,parent:n,children:[]})},onArrayEnd:function(c,l){n.length=c+l-n.offset,n=n.parent,i(c+l)},onLiteralValue:function(c,l,u){o({type:r8(c),offset:l,length:u,parent:n,value:c}),i(l+u)},onSeparator:function(c,l,u){n.type==="property"&&(c===":"?n.colonOffset=l:c===","&&i(l))},onError:function(c,l,u){e.push({error:c,offset:l,length:u})}};QO(r,s,t);var a=n.children[0];return a&&delete a.parent,a}function zO(r,e){if(r){for(var t=r,n=0,i=e;n<i.length;n++){var o=i[n];if(typeof o=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;for(var s=!1,a=0,c=t.children;a<c.length;a++){var l=c[a];if(Array.isArray(l.children)&&l.children[0].value===o){t=l.children[1],s=!0;break}}if(!s)return}else{var u=o;if(t.type!=="array"||u<0||!Array.isArray(t.children)||u>=t.children.length)return;t=t.children[u]}}return t}}function uD(r){switch(r.type){case"array":return r.children.map(uD);case"object":for(var e=Object.create(null),t=0,n=r.children;t<n.length;t++){var i=n[t],o=i.children[1];o&&(e[i.children[0].value]=uD(o))}return e;case"null":case"string":case"number":case"boolean":return r.value;default:return}}function QO(r,e,t){t===void 0&&(t=lD.DEFAULT);var n=cD(r,!1);function i(te){return te?function(){return te(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:function(){return!0}}function o(te){return te?function(we){return te(we,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter())}:function(){return!0}}var s=i(e.onObjectBegin),a=o(e.onObjectProperty),c=i(e.onObjectEnd),l=i(e.onArrayBegin),u=i(e.onArrayEnd),p=o(e.onLiteralValue),m=o(e.onSeparator),h=i(e.onComment),g=o(e.onError),y=t&&t.disallowComments,C=t&&t.allowTrailingComma;function k(){for(;;){var te=n.scan();switch(n.getTokenError()){case 4:A(14);break;case 5:A(15);break;case 3:A(13);break;case 1:y||A(11);break;case 2:A(12);break;case 6:A(16);break}switch(te){case 12:case 13:y?A(10):h();break;case 16:A(1);break;case 15:case 14:break;default:return te}}}function A(te,we,Ue){if(we===void 0&&(we=[]),Ue===void 0&&(Ue=[]),g(te),we.length+Ue.length>0)for(var lt=n.getToken();lt!==17;){if(we.indexOf(lt)!==-1){k();break}else if(Ue.indexOf(lt)!==-1)break;lt=k()}}function T(te){var we=n.getTokenValue();return te?p(we):a(we),k(),!0}function U(){switch(n.getToken()){case 11:var te=n.getTokenValue(),we=Number(te);isNaN(we)&&(A(2),we=0),p(we);break;case 7:p(null);break;case 8:p(!0);break;case 9:p(!1);break;default:return!1}return k(),!0}function oe(){return n.getToken()!==10?(A(3,[],[2,5]),!1):(T(!1),n.getToken()===6?(m(":"),k(),de()||A(4,[],[2,5])):A(5,[],[2,5]),!0)}function G(){s(),k();for(var te=!1;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(te||A(4,[],[]),m(","),k(),n.getToken()===2&&C)break}else te&&A(6,[],[]);oe()||A(4,[],[2,5]),te=!0}return c(),n.getToken()!==2?A(7,[2],[]):k(),!0}function pe(){l(),k();for(var te=!1;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(te||A(4,[],[]),m(","),k(),n.getToken()===4&&C)break}else te&&A(6,[],[]);de()||A(4,[],[4,5]),te=!0}return u(),n.getToken()!==4?A(8,[4],[]):k(),!0}function de(){switch(n.getToken()){case 3:return pe();case 1:return G();case 10:return T(!0);default:return U()}}return k(),n.getToken()===17?t.allowEmptyContent?!0:(A(4,[],[]),!1):de()?(n.getToken()!==17&&A(9,[],[]),!0):(A(4,[],[]),!1)}function r8(r){switch(typeof r){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(r){if(Array.isArray(r))return"array"}else return"null";return"object"}default:return"null"}}var YO=t8;var n8=GO,i8=zO;var o8=uD;var ZO=require("vscode");var pD=D(O()),Zl=require("vscode");var pi=class{constructor(e){this.disposables=[];this._onDidChange=new Zl.EventEmitter;e.push(this),cn()||Zl.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),z(this.disposables)}isPythonEnvironmentExcluded(e){if(cn())return!1;let t=this.getExcludedPythonEnvironments(),n=XO(e,t),i="uri"in e?e.uri:e.executable.uri;return n&&(N("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),E(`Python Env hidden via filter: ${$(i)}`)),n}getExcludedPythonEnvironments(){if(!Zl.workspace.workspaceFolders||Zl.workspace.workspaceFolders.length===0)return Zl.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return Zl.workspace.workspaceFolders.forEach(t=>{e.push(...Zl.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};pi=v([(0,pD.injectable)(),d(0,(0,pD.inject)(F))],pi);function XO(r,e){let t="uri"in r?r.envPath:r.environment?.folderUri,n="uri"in r?r.uri:r.executable.uri;return!n&&!t?!1:e.some(o=>{let s=$(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=$(n).toLowerCase().replace(/\\/g,"/"),c=n?n.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===c||s===c)return!0;let l=$(t||"").toLowerCase().replace(/\\/g,"/"),u=$(t||"").toLowerCase().replace(/\\/g,"/");return o===l||s===l||o===u||s===u})}var Jp=class{constructor(e,t){this.disposableRegistry=e;this.pythonExtChecker=t;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(ZO.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(ZO.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,n){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||ho().length===0||!Jp.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return ho().filter(o=>!XO(o,i)).map(o=>{let s=jr(o),a=$(o.executable.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(_e(e.uri.fsPath)!=="settings.json")return!1;let n=YO(e.getText(),e.offsetAt(t));return n.path[0]==="jupyter.kernels.excludePythonEnvironments"&&n.path.length===2}getCurrentItemsInList(e,t){try{let n=e.getText(),i=YO(n,e.offsetAt(t)),o=n8(n),s=i8(o,[i.path[0]]);if(!s)return[];let a=o8(s);return Array.isArray(a)?a:[]}catch(n){return W("Failed to provide completions for python env filter",n),[]}}};Jp=v([(0,Qx.injectable)(),d(0,(0,Qx.inject)(F)),d(1,(0,Qx.inject)(Ye))],Jp);var s8=D(O()),Li=require("vscode");var mv=class{activate(){this.migrateFilters().catch(f)}async migrateFilters(){let e=Array.isArray(Li.workspace.workspaceFolders)?Li.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Li.workspace.getConfiguration("jupyter",void 0),Li.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Li.workspace.getConfiguration("jupyter",void 0),Li.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Li.workspace.getConfiguration("jupyter",e[0].uri),Li.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Li.workspace.getConfiguration("jupyter",void 0),Li.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Li.workspace.getConfiguration("jupyter",t.uri),Li.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let n=e.inspect("kernels.filter"),i=[];switch(t){case Li.ConfigurationTarget.Global:i=n?.globalValue||[];break;case Li.ConfigurationTarget.Workspace:i=n?.workspaceValue||[];break;default:i=n?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};mv=v([(0,s8.injectable)()],mv);var dD=D(O());var eK=require("vscode");var fv=class{constructor(e){this.disposables=e}activate(){this.disposables.push(eK.commands.registerCommand("jupyter.filterKernels",()=>eK.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(f,f),this))}};fv=v([(0,dD.injectable)(),d(0,(0,dD.inject)(F))],fv);var fD=D(O());var $m=Symbol("IModuleInstaller"),eKe=Symbol("IPythonInstallation"),mD=Symbol("IInstallationChannelManager"),Yx=Symbol("IProductService"),Xx=Symbol("IProductPathService");var Ui=Symbol("IInstaller");var gv=require("vscode");var hv=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let n=await this.getInstallationChannels(t);if(n.length>=1)return n[0];if(n.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll($m),n=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(n.length>0)break;i=o.priority}await o.isSupported(e)&&n.push(o)}return n}async showNoInstallersMessage(e){let t=Be(e);if(await gv.window.showErrorMessage(t==="Conda"?$h.noCondaOrPipInstaller:$h.noPipInstaller,{modal:!0},$h.searchForHelp)===$h.searchForHelp){let i=this.serviceContainer.get(Dr),o=i.isWindows?"Windows":i.isMac?"MacOS":"Linux";gv.env.openExternal(gv.Uri.parse(`https://www.bing.com/search?q=Install Pip ${o} ${t==="Conda"?"Conda":""}`))}}};hv=v([(0,fD.injectable)(),d(0,(0,fD.inject)(pt))],hv);var vD=D(O());var hD=require("vscode");function eo(r){switch(r){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${r} cannot be installed as a Python Module.`)}}var a8=require("os");var vv=class extends et{constructor(t,n,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=n;this.originalMessage=i}};var Vr=Symbol("IPythonExecutionFactory"),vKe=Symbol("IPythonExecutionService");var Zc=class{constructor(e){this.serviceContainer=e}async installModule(e,t,n,i){let o=typeof e=="string"?e:eo(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Vr),c=this.serviceContainer.get(Mi),l=this.serviceContainer.get(Vs),u=this.serviceContainer.get(Kc);if(n.token.isCancellationRequested)return;let p=async(h,g)=>{let y=le(),C=[];g.onCancellationRequested(()=>{n.cancel(),y.resolve()},this,C);let k;if(s.useShellExec){let G=await c.create(void 0);if(n.token.isCancellationRequested)return;try{let pe=await G.shellExec(s.args.join(" "),{cwd:s.cwd});E(pe.stdout),y.resolve()}catch(pe){y.reject(pe)}}else if(s.exe){let G=await l.getActivatedEnvironmentVariables(void 0,t);if(n.token.isCancellationRequested)return;let pe={...process.env};u.mergeVariables(G||{},pe),u.mergePaths(G||{},pe);let de=await c.create(void 0);if(n.token.isCancellationRequested)return;k=de.execObservable(s.exe,s.args,{encoding:"utf-8",token:g,env:pe,cwd:s.cwd})}else{let G=await a.createActivatedEnvironment({interpreter:t});if(n.token.isCancellationRequested)return;k=G.execObservable(s.args,{encoding:"utf-8",token:g,cwd:s.cwd})}let A,T,U=[".","..","..."],oe=0;return k&&(k.out.onDidChange(G=>{let pe=U[oe%3],de=G.out.trim();oe+=1;let te=de.length>28?`${de.substring(0,28)}${pe}`:de;h.report({message:te}),E(G.out),G.source==="stderr"&&(T?T+=G.out:!T&&G.out.includes("ERROR: Could not install packages")&&(T=G.out.substring(G.out.indexOf("ERROR: Could not install packages"))),A=G.out)},this,C),k.out.done.then(()=>{k?.proc?.exitCode!==0?T&&T.includes("https://pip.pypa.io/warnings/enable-long-paths")?(T=Fe(T,{trim:!0,removeEmptyEntries:!0}).filter(G=>!G.startsWith("[notice]")).join(a8.EOL),y.reject(new vv(e,t,T))):y.reject(A||k?.proc?.exitCode):y.resolve()},G=>{y.reject(G)}).finally(()=>z(C))),y.promise},m={location:hD.ProgressLocation.Notification,cancellable:!0,title:pN.installingModule(o)};await hD.window.withProgress(m,async(h,g)=>p(h,g))}};var xme=[eo(18),eo(20)];function gD(r,e){return xme.includes(e)?r==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var c8=require("vscode");var yv=class extends Zc{constructor(t){super(t)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(t){if(this._isCondaAvailable===!1)return!1;let n=this.serviceContainer.get(Hs);return this._isCondaAvailable=await n.isCondaAvailable(),this._isCondaAvailable?Be(t)==="Conda":!1}async installModule(t,n,i,o){if(await super.installModule(t,n,i,o),wr(n)){if(!this.serviceContainer.get(Ye).isPythonExtensionActive)return;let c=await this.serviceContainer.get(st).getInterpreterDetails(n.id);c&&!wr(c)&&Object.assign(n,c)}}async getExecutionArgs(t,n,i=0){let s=await this.serviceContainer.get(Hs).getCondaFile(),a=Nr(n)?.environment?.name,c=this.getEnvironmentPath(n),l=[i&1?"update":"install"];return[19,23,22,18,20].map(eo).includes(t)&&l.push("-c","conda-forge"),a?(l.push("--name"),l.push(US(a))):c&&(l.push("--prefix"),l.push(jS(c))),i&2&&l.push("--update-deps"),i&4&&l.push("--force-reinstall"),l.push(t),l.push(...gD("conda",t)),l.push("-y"),{exe:s,args:l}}getEnvironmentPath(t){let n,i=Nr(t);if(i?.environment?.folderUri)return i.environment.folderUri.fsPath;n=i?.executable.uri||c8.Uri.file(t.id);let o=dt(n.fsPath),s=_e(o);return["BIN","SCRIPTS"].indexOf(s.toUpperCase())!==-1?Ve(o,".."):o}};yv=v([(0,vD.injectable)(),d(0,(0,vD.inject)(pt))],yv);var bD=D(O());function Cme(){let r=Wm("PIPENV_MAX_DEPTH");if(r===void 0)return 3;let e=parseInt(r,10);return isNaN(e)?(x(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${r}' to number results in NaN`),1):e}async function l8(r,e){let t=Wm("PIPENV_PIPFILE")||"Pipfile",n=e.lookIntoParentDirectories?Cme():1;for(;n>0&&!Wp(r,dt(r));){let i=Ve(r,t);if(await nv(i))return i;r=dt(r),n-=1}}async function wme(r){let e=Ve(r,".project");if(!await nv(e))return;let t=await wJ(e);if(!await nv(t)){x(`The .project file inside environment folder: ${r} doesn't contain a valid path to the project`);return}return t}async function Eme(r){let e=dt(dt(r.fsPath)),t=await wme(e);if(!(t===void 0||!_e(jp(e)).startsWith(`${_e(jp(t))}-`)))return l8(t,{lookIntoParentDirectories:!1})}async function u8(r,e){let t=await Eme(r);if(!t)return!1;let n=Wm("PIPENV_NO_INHERIT")===void 0,i=await l8(e.fsPath,{lookIntoParentDirectories:n});return i?Wp(t,i):!1}var yD=require("vscode");function Zx(r){let e="executable"in r?r.executable.uri||yD.Uri.file(r.path):r.uri;return yD.workspace.getWorkspaceFolder(e)?.uri||Os()}var d8=require("vscode");var p8="pipenv",bv=class extends Zc{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return p8}get priority(){return 10}async isSupported(e){if(zu(e)){let t=await this.serviceContainer.get(st).getActiveInterpreter(e),n=e?d8.workspace.getWorkspaceFolder(e):void 0;return!t||!n||Be(t)!=="PipEnv"?!1:u8(t.uri,n.uri)}else return Be(e)==="PipEnv"}async getExecutionArgs(e,t,n=0){let o=[n&4||n&2||n&1?"update":"install",e,"--dev"],s=Zx(t);return{args:o,exe:p8,cwd:s?Te(s):void 0}}};bv=v([(0,bD.injectable)(),d(0,(0,bD.inject)(pt))],bv);var ID=D(O());var m8=require("vscode");var Iv=class extends Zc{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch(Be(e)){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,n=0){if(e===eo(27))return await this.serviceContainer.get(Ui).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[Ve(qO,"get-pip.py")]};let i=[],o=m8.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),n&4&&i.push("--force-reinstall"),Be(t)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(gD("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Vr).create({resource:void 0,interpreter:e}).then(n=>n.isModuleInstalled("pip")).catch(()=>!1)}};Iv=v([(0,ID.injectable)(),d(0,(0,ID.inject)(pt))],Iv);var eC=D(O());var Pme=5e4,eu=class eu{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(kme(e))return(eu.poetryPromise.get(e)===void 0||Ar())&&eu.poetryPromise.set(e,eu.locate(e)),eu.poetryPromise.get(e)}static async locate(e){E(`Getting poetry for cwd ${e}`);function*t(){let n=PJ("poetryPath");n&&n!=="poetry"&&(yield n),yield"poetry";let i=iv();if(i){let o=Ve(i.fsPath,".poetry","bin","poetry");MO(o)&&(yield o)}}for(let n of t()){E(`Probing poetry binary for ${e}: ${n}`);let i=new eu(n,e);if(await i.getEnvList()!==void 0)return E(`Found poetry via filesystem probing for ${e}: ${n}`),i;E(`Failed to find poetry for ${e}: ${n}`)}E(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let n=await this.safeShellExecute(`${e} env list --full-path`);if(!n)return;let i="(Activated)";return(await Promise.all(Fe(n.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await nv(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(Ur()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let n=new Je,i=await CJ(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:Pme}).catch(o=>{t?E(o):x(o)});return E(`Time taken to run ${e} in ms`,n.elapsedTime),i}};v([pA(3e4)],eu.prototype,"getEnvListCached",1),v([pA(2e4)],eu.prototype,"getActiveEnvPathCached",1);var SD=eu;async function f8(r,e,t){let i=await(t?new SD(t,e):await SD.getPoetry(e))?.getActiveEnvPath();return i?rv(r,i):!1}function kme(r){let e=Ve(r,"pyproject.toml");return!(!MO(e)||!EJ(e).includes("[tool.poetry]"))}var h8=require("vscode");var Dme="poetry",Sv=class extends Zc{constructor(t,n){super(t);this.configurationService=n}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return Dme}get priority(){return 10}async isSupported(t){if(Be(t)!=="Poetry")return!1;let n=Zx(t);if(n){let i="executable"in t?t.executable.uri||h8.Uri.file(t.path):t.uri;return f8(i.fsPath,n.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,n){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=Zx(n)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};Sv=v([(0,eC.injectable)(),d(0,(0,eC.inject)(pt)),d(1,(0,eC.inject)(ue))],Sv);var el=D(O()),S8=require("vscode");var gr=new Map;gr.set(18,"jupyter");gr.set(20,"notebook");gr.set(19,"ipykernel");gr.set(22,"nbconvert");gr.set(21,"kernelspec");gr.set(23,"pandas");gr.set(27,"pip");gr.set(28,"ensurepip");var $p=D(O());var g8=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(r=>r.toLowerCase())),v8="NOT INSTALLED",Gs=class{constructor(e,t,n,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=n;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;Gs._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return Gs._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=gn(e.uri),n=this.interpreterInformation.get(t);return n||(n=le(),this.interpreterInformation.set(t,n),this.trackInterpreterPackages(e).catch(f)),n.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let n=await this.getPackageVersions(e),i=await It(t.toLocaleLowerCase());if(!n.has(i))return;let o=n.get(i);if(o)return o===v8?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(f)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=Ms(e);if(!this.interpreterPackages.has(t)){let n=this.listPackagesImpl(e);this.interpreterPackages.set(t,n),n.catch(i=>{this.interpreterPackages.get(t)===n&&this.interpreterPackages.delete(t),W(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(n=>Array.from(n))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let n=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await n.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(c=>c.toLowerCase())))}else return x(`Failed to get list of installed packages for ${An(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let n;if(zu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;n=i}else n=e;this.trackInterpreterPackages(n,t).catch(f)}async trackInterpreterPackages(e,t){let n=gn(e.uri);if(this.pendingInterpreterInformation.has(n)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(n)===i&&this.pendingInterpreterInformation.delete(n)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(f),this.pendingInterpreterInformation.set(n,i)}async getPackageInformation({interpreter:e}){if(wr(e))return;let n=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(g8).map(async a=>{i.set(await It(a),v8)})),await Promise.all(n.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let c=a.split(" ").filter(m=>m.trim().length);if(c.length<2)return;let[l,u]=c;if(!g8.has(l.toLowerCase().trim()))return;let p=ap(u);i.set(await It(l),p||"")}));let o=gn(e.uri),s=this.interpreterInformation.get(o);s||(s=le(),this.interpreterInformation.set(o,s)),s.resolve(i)}};Gs=v([(0,$p.injectable)(),d(0,(0,$p.inject)(Ye)),d(1,(0,$p.inject)(st)),d(2,(0,$p.inject)(Vr)),d(3,(0,$p.inject)(tr)),d(4,(0,$p.inject)(F))],Gs);async function xD(r,e,t){if(zu(t))return;let n=`${await Pc(t)}#${gr.get(e)}`;await r.update(n,!0)}async function y8(r,e,t){let n=`${await Pc({uri:t})}#${gr.get(e)}`;await r.update(n,void 0)}async function b8(r,e,t){let n=`${await Pc(t)}#${gr.get(e)}`;return r.get(n,!1)}var CD=Symbol("IReservedPythonNamedProvider"),Hp=Symbol("IInterpreterPackages"),wD=Symbol("IWorkspaceInterpreterTracker");async function x8(r,e,t){let n=`${await Pc(t)}#${gr.get(e)}`;if(r.get(n,!1))return!0;let i=eo(e),o=Gs.instance?Gs.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{x("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await xr(500,o);if(typeof s=="string")return s==="found"}catch{x(`Failed to check if package exists ${gr.get(e)}`)}}var ED=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(ue),this.productService=e.get(Yx),this.persistentStateFactory=e.get(ac)}async install(e,t,n,i,o){let a=await this.serviceContainer.get(mD).getInstallationChannel(e,t);if(!a)return 2;if(n.token.isCancellationRequested)return 3;let c=i===!0?6:void 0;return o===!0&&(c=c?c|8:8),await a.installModule(e,t,n,c),n.token.isCancellationRequested?3:this.isInstalled(e,t).then(l=>l?0:2)}async isInstalled(e,t){let n=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Vr).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(n):(await this.serviceContainer.get(Mi).create(void 0)).exec(n,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(Xx,n).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(Xx,n).isExecutableAModule(e,t)}};v([oi("Checking if product is installed"),d(1,Wl("path"))],ED.prototype,"isInstalled",1);var xv=class{constructor(e,t,n,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=n;this.output=i;this._onInstalled=new S8.EventEmitter;this.productService=e.get(Yx)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,n,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,n,i,o);switch(xD(this.memento,e,t).catch(f),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{N("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:gr.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return eo(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new ED(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};xv=v([(0,el.injectable)(),d(0,(0,el.inject)(pt)),d(1,(0,el.inject)(Hp)),d(2,(0,el.inject)(He)),d(2,(0,el.named)(bt)),d(3,(0,el.inject)(Bo)),d(3,(0,el.named)(Hu))],xv);var PD=D(O());var iK=class{constructor(e){this.serviceContainer=e;this.configService=e.get(ue),this.productInstaller=e.get(Ui)}isExecutableAModule(e,t){if(e===21)return!1;let n;try{n=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof n=="string"&&n.length>0&&_e(i)===i}},Cv=class extends iK{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};Cv=v([(0,PD.injectable)(),d(0,(0,PD.inject)(pt))],Cv);var C8=D(O());var wv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};wv=v([(0,C8.injectable)()],wv);var kD=D(O());var Ev=class{constructor(e){this.interpreterService=e}activate(){this.interpreterService.initialize()}};Ev=v([(0,kD.injectable)(),d(0,(0,kD.inject)(st))],Ev);var oK=require("vscode"),Pv=D(O());var zs=class{constructor(e,t,n){this.title=b.localPythonEnvironments;this._onDidChange=new oK.EventEmitter;this._onDidChangeStatus=new oK.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new go;this._status="idle";n.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>x("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(f)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){z(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(f)}withFilter(e){return new Proxy(this,{get(t,n){switch(n){case"items":return t.items.filter(e);case"dispose":return f;default:return t[n]}}})}};zs=v([(0,Pv.injectable)(),d(0,(0,Pv.inject)(tr)),d(1,(0,Pv.inject)(Ye)),d(2,(0,Pv.inject)(F))],zs);var Dv=D(O());function sK(r,e){if(Array.isArray(r)){let t=r.slice(1);return e&&t.push(...e),{args:t,command:r[0],python:[...r],pythonExecutable:r[r.length-1]}}return{command:r,args:e||[],python:[r],pythonExecutable:r}}function w8(r,e){let t={command:r.command,args:[...r.args],python:[...r.python],pythonExecutable:r.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var D8=require("vscode");function aK(r,e){return["-m",r,...e]}function E8(){let r=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[r,e]}function P8(r){let e=["-c",`import ${r};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(n){return n.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(E(`Module ${r} is not installed. Output ${n}`),!1)}return[e,t]}async function _8(r,e){let[t,n]=E8(),i=w8(r,t),o=await e(i.command,i.args);return D8.Uri.file(n(o.stdout))}var DD=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return sK(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return sK(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return _8(e,this.deps.exec)}async isModuleInstalled(e){let[t,n]=P8(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return n(o.stdout)}catch(o){return W(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function T8(r,e,t,n,i){return{getPythonArgv:o=>e||[Te(o)],getObservablePythonArgv:o=>t||[Te(o)],isValidExecutable:r,exec:async(o,s,a)=>n(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function R8(r,e,t){let n=T8(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new DD(r,n)}function A8(r,e,t,n,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[r,...o,"python"],a=T8(async c=>i.exists(c),s,void 0,(c,l,u)=>n.exec(c,l,u),(c,l)=>n.shellExec(c,l));return new DD(t,a)}var _D=class extends et{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var cK=class{constructor(e){this.deps=e}execObservable(e,t){let n={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,n)}execModuleObservable(e,t,n){let i=aK(e,t),o={...n},s=this.deps.getExecutionObservableInfo(i),a={...n};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let n={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,n)}async execModule(e,t,n){let i=aK(e,t),o={...n},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&JE.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new _D(e);return a}};function N8(r,e){let t={isModuleInstalled:async n=>e.isModuleInstalled(n),getExecutionInfo:n=>e.getExecutionInfo(n),getExecutionObservableInfo:n=>e.getExecutionObservableInfo(n),exec:async(n,i,o)=>r.exec(n,i,o),execObservable:(n,i,o)=>r.execObservable(n,i,o)};return new cK(t)}var TD=require("vscode");var kv=class{constructor(e,t,n){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=n;this.disposables=this.serviceContainer.get(F),this.fileSystem=this.serviceContainer.get(at)}async create(e){let t=await this.processServiceFactory.create(e.resource);return M8(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:TD.workspace.workspaceFolders?.length?TD.workspace.workspaceFolders[0].uri:void 0,!TD.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new zc({...t});return this.disposables.push(i),M8(e.interpreter,i,this.fileSystem)}};kv=v([(0,Dv.injectable)(),d(0,(0,Dv.inject)(pt)),d(1,(0,Dv.inject)(Vs)),d(2,(0,Dv.inject)(Mi))],kv);function M8(r,e,t,n){let i=R8(r,e,t);if(n){let[s,a]=n;i=A8(s,a,r,e,t)}let o=N8(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,c)=>o.execModuleObservable(s,a,c),exec:(s,a)=>o.exec(s,a),execModule:(s,a,c)=>o.execModule(s,a,c)}}var tu=D(O()),ru=require("vscode");var O8="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",K8=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var n7=D(rC());var vr=Symbol("IFileSystemNode");var Qme="jupyter.pythonPackages",fK="diagnostics.reservedPythonNames.exclude",Tv=class{constructor(e,t,n,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];n.push(this),this.cachedModules=new Set(this.cache.get(Qme,K8).map(o=>o.toLowerCase())),ru.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${fK}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){z(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,n]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>ru.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(n.map(a=>ru.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,n7.default)(t,o,{dot:!0}))return!0}))return!1;let n=vn(e,np(e)).toLowerCase(),i=n==="__init__"?vn(Ei(e)).toLowerCase():n;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=ru.workspace.getConfiguration("jupyter"),n=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(n),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(fK,Array.from(this.ignoredFiles),ru.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=ru.workspace.getConfiguration("jupyter").get(fK,[]);this.platform.isWindows&&(t=t.map(n=>n.toLowerCase())),this.ignoredFiles=new Set(t)}};Tv=v([(0,tu.injectable)(),d(0,(0,tu.inject)(He)),d(0,(0,tu.named)(bt)),d(1,(0,tu.inject)(Dr)),d(2,(0,tu.inject)(F)),d(3,(0,tu.inject)(vr))],Tv);var nC=D(O());var ND=D(sD());var Rv="_VSCODE_getVariable",tl=ND.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,rl=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${Rv}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:tl}:{code:`${t}

${i}

${tl}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${Rv}("properties", ${n}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:tl}:{code:`${t}

${i}

${tl}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=e.parent?t:`${t}

_VSCODE_rwho_ls = %who_ls
`,o=ND.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=e.parent?`${Rv}("AllChildrenDescriptions", ${n}, "${e.parent.root}", ${JSON.stringify(e.parent.propertyChain)}, ${e.startIndex})`:`${Rv}("AllVariableDescriptions", ${n}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:i,code:s,cleanupCode:e.parent?tl:`${tl}
${o}`}:{code:`${i}

${s}

${tl}`}}async generateCodeToGetVariableTypes(e){let n=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=ND.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${Rv}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:n,code:s,cleanupCode:`${tl}
${o}`}:{code:`${n}${s}

${tl}
${o}`}}async generateCodeToGetVariableValueSummary(e){let t=await this.getContentsOfScript(),i=`${Rv}("summary", False, ${e.variableName})`;return{code:`${t}

${i}

${tl}`}}async getContentsOfScript(){if(rl.contentsOfScript)return rl.contentsOfScript;let e=lr(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return rl.contentsOfScript=t,t}};rl=v([(0,nC.injectable)(),d(0,(0,nC.inject)(at)),d(1,(0,nC.inject)(ut))],rl);var Av=D(O());var Na=class{constructor(e){this.workspaceInterpreterTracker=e;Na.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};Na.isActiveWorkspaceInterpreter=()=>!1,Na=v([(0,Av.injectable)(),d(0,(0,Av.inject)(wD)),d(0,(0,Av.optional)())],Na);var iC=require("vscode");var Mv=D(O());var Nv=class{constructor(e,t,n){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=n;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),iC.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let n=Ms(e),i=this.workspaceInterpreters.get(n);return i?$o(i,t.uri):!1}trackActiveInterpreters(){cn()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(iC.workspace.workspaceFolders)?iC.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let n=Ms(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(n,i?.uri)}catch{}}))},this,this.disposables))}};Nv=v([(0,Mv.injectable)(),d(0,(0,Mv.inject)(Ye)),d(1,(0,Mv.inject)(F)),d(2,(0,Mv.inject)(st))],Nv);function i7(r){r.addSingleton(Vr,kv),r.addSingleton(Hs,Hs),r.addSingleton(jc,jc),r.addSingleton(Hp,Gs),r.addSingleton(be,Na),r.addSingleton(be,Ev),r.addSingleton(wD,Nv),r.addSingleton(be,mv),r.addSingleton(be,fv),r.addSingleton(be,Jp),r.addSingleton(pi,pi),r.addSingleton(CD,Tv),r.addSingleton(Mh,rl),r.addSingleton(Oh,Xc),r.addSingleton($m,yv),r.addSingleton($m,Iv),r.addSingleton($m,bv),r.addSingleton($m,Sv),r.addSingleton(mD,hv),r.addSingleton(Yx,wv),r.addSingleton(Ui,xv),r.addSingleton(Xx,Cv,"DataScience"),r.addSingleton(zs,zs),r.addBinding(zs,be)}var c7=D(O()),Kv=require("vscode");var s7=new Set;function a7(r){s7.add(r)}function o7(r){try{s7.forEach(e=>e.report(r))}catch(e){x("Failed to report progress",e)}}function Ov(r){return function(e,t,n){let i=n.value;n.value=async function(...o){return o7({action:r,phase:"started"}),i.apply(this,o).finally(()=>{o7({action:r,phase:"completed"})})}}}var is=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];a7(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let n=new Kv.CancellationTokenSource,i=le(),o={location:Kv.ProgressLocation.Notification,cancellable:t,title:e};return Kv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&n.cancel(),i.resolve()}),n.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(f,f),{token:n.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=JP(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};is=v([(0,c7.injectable)()],is);var l7=D(O());var Xn=require("vscode");var nu=require("vscode");var oC=class r{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLes.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(r.migratedSettings))e.push(...this.migrateSetting(t,r.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){Fv(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(n?.globalValue===n?.defaultValue||!i||i?.globalValue&&i.globalValue[xe])return;if(typeof n?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[xe]=n.globalValue.split(""),await this.jupyterConfig.update(t,o,nu.ConfigurationTarget.Global).then(f,Fv)}}finally{n?.globalValue&&await this.jupyterConfig.update(e,void 0,nu.ConfigurationTarget.Global).then(f,Fv)}}migrateSetting(e,t){let n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(n?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceValue,nu.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,nu.ConfigurationTarget.Workspace),Fv))}if(n?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceFolderValue,nu.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,nu.ConfigurationTarget.WorkspaceFolder),Fv))}if(n?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,n.globalValue,nu.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,nu.ConfigurationTarget.Global),Fv))}return o}};function Fv(r){W("Error migrating Jupyter configuration",r)}function Yme(r){return(e,t,n)=>{let i=null,o=null;if(typeof n.value=="function"?(i="value",o=n.value):typeof n.get=="function"&&(i="get",o=n.get),!o)throw new Error("not supported");n[i]=r(o,t)}}function Lv(r,e,t){return Yme((n,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{n.apply(this,a),this[s]=t?t():void 0},r)}})}var Ma=class Ma{constructor(e,t,n){this._systemVariablesCtor=t;this._type=n;this.logging={level:"error"};this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.normalizeSelectionForInteractiveWindow=!0;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this._changeEmitter=new Xn.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),Xn.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,n){let i=Ma.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=Ma.jupyterSettings.get(o);return s?s._type==="web"&&n==="node"&&(s._systemVariablesCtor=t,s._type=n):(s=new Ma(i,t,n),Ma.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?Xn.workspace.getWorkspaceFolder(e):void 0,n=t?t.uri:void 0;!n&&Array.isArray(Xn.workspace.workspaceFolders)&&Xn.workspace.workspaceFolders.length>0&&(n=Xn.workspace.workspaceFolders[0].uri);let i=n?Xn.ConfigurationTarget.WorkspaceFolder:Xn.ConfigurationTarget.Global;return{uri:n,target:i}}static dispose(){if(!Ar())throw new Error("Dispose can only be called from unit tests");Ma.jupyterSettings.forEach(e=>e&&e.dispose()),Ma.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(n=>e[n]=this[n]),e}update(e,t){let n=this.createSystemVariables(void 0),i=n.resolveAny(e.get("logging"));i&&(i.level=Xme(i.level),this.logging?Object.assign(this.logging,i):this.logging=i);let o=n.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,o):this.experiments=o,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let s=(c,l)=>{let u=oC.fullSettingIds[c],p=u&&l.get(u)!==void 0?l.get(u):l.get(c),m=n.resolveAny(p);m!==void 0&&(this[c]=m)};this.getSerializableKeys().filter(c=>c!=="experiments"&&c!=="logging"&&c!=="kernelPickerType").forEach(c=>s(c,e)),t&&s("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(Xn.workspace.workspaceFolders||[]).map(i=>i.uri.path),n=Array.from(Ma.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)Ma.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=Xn.workspace.getConfiguration("jupyter",this._workspaceRoot),o=Xn.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(Xn.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(Xn.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=Xn.workspace.getConfiguration("jupyter",this._workspaceRoot),n=Xn.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,n),this.migrateSettings(t).catch(f))}async migrateSettings(e){await new oC(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};v([Lv(1)],Ma.prototype,"debounceChangeNotification",1);var Uv=Ma;function Xme(r){switch(r){case"info":return 20;case"warn":return 30;case"off":return"off";case"debug":return 10;case"verbose":return 5;default:return 40}}var nl=require("vscode");var MD=class{async updateSectionSetting(e,t,n,i,o){let a={uri:i,target:o||nl.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==nl.ConfigurationTarget.Global&&(a=Uv.getSettingsUriAndTarget(i));let c=nl.workspace.getConfiguration(e,a.uri),l=c.inspect(t);l!==void 0&&(o===nl.ConfigurationTarget.Global&&l.globalValue===n||o===nl.ConfigurationTarget.Workspace&&l.workspaceValue===n||o===nl.ConfigurationTarget.WorkspaceFolder&&l.workspaceFolderValue===n)||(await c.update(t,n,o),o&&await this.verifySetting(c,o,t,n))}async updateSetting(e,t,n,i){return this.updateSectionSetting("jupyter",e,t,n,i)}async verifySetting(e,t,n,i){if(Ar()&&!NS()){let o=0;do{let s=e.inspect(n);if(!s&&i===void 0||s&&i!==void 0&&(t===nl.ConfigurationTarget.Global?s.globalValue:t===nl.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var jv=class extends MD{getSettings(e){return Uv.getInstance(e,cv,"node")}};jv=v([(0,l7.injectable)()],jv);var jn=D(Hc()),i$=D(kK()),o$=D(O()),s$=D(Y7()),a$=require("util");var r$=D(O()),Zp=D(require("vscode"));var e$=D(Z7()),t$=require("vscode"),il=class{constructor(e=e$.fetch){this.fetchImplementation=e;this.requestOptions={};let t=t$.workspace.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return this.fetchImplementation(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return E(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var n$="utf8",Jv=class{constructor(){this.vscfs=Zp.workspace.fs}arePathsSame(e,t){return wi(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(n=>n[1]===Zp.FileType.File).map(n=>Zp.Uri.file(n[0]))}async copy(e,t,n){await this.vscfs.copy(e,t,n)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return new TextDecoder().decode(t)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){return this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new il().exists(e.toString());let n;try{n=await this.stat(e)}catch(i){return Yk(i)||x(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===Zp.FileType.Unknown?n.type===Zp.FileType.Unknown:(n.type&t)===t}async getFileHash(e){let t=await this.stat(e),n=`${t.ctime}-${t.mtime}`;return wa(n,"SHA-512")}};Jv=v([(0,r$.injectable)()],Jv);var c$=require("vscode");var su=class extends Jv{constructor(){super();this.globFiles=(0,a$.promisify)(i$.default)}createLocalWriteStream(t){return jn.createWriteStream(t)}async createTemporaryLocalFile(t){let n=typeof t=="string"?t:t.fileExtension,i=t&&typeof t=="object"?t.prefix:void 0,o={postfix:n,prefix:i};return new Promise((s,a)=>{s$.file(o,(c,l,u,p)=>{if(c)return a(c);s({filePath:l,dispose:p})})})}async searchLocal(t,n,i){let o;n&&(o={...o,cwd:n}),i&&(o={...o,dot:i});let s=await this.globFiles(t,o);return Array.isArray(s)?s:[]}async writeLocalFile(t,n){return await jn.ensureDir(dt(t)),jn.writeFile(t,n)}async readFile(t){if(Xm(t)){let n=await jn.readFile(Te(t));return Buffer.from(n).toString(n$)}else return super.readFile(t)}async delete(t){Xm(t)?await this.exists(t)&&((await this.stat(t)).type===c$.FileType.Directory?await new Promise(i=>jn.rm(Te(t),{force:!0,recursive:!0},i)):await jn.unlink(Te(t))):await super.delete(t)}async exists(t,n){return Xm(t)?jn.pathExists(Te(t)):super.exists(t,n)}async createDirectory(t){Xm(t)?await jn.ensureDir(Te(t)):await this.vscfs.createDirectory(t)}async writeFile(t,n){if(Xm(t)){let i=Te(t);return await jn.ensureDir(dt(i)),jn.writeFile(i,typeof n=="string"?Buffer.from(n):n)}else await this.vscfs.writeFile(t,typeof n=="string"?new TextEncoder().encode(n):n)}async copy(t,n,i){if(Xm(t)&&Xm(n)){let o=typeof i===void 0||typeof i?.overwrite==null?!0:i?.overwrite;await jn.copy(Te(t),Te(n),{overwrite:o})}else await super.copy(t,n,i)}};su=v([(0,o$.injectable)()],su);function Xm(r){return r.scheme==="file"}var dC=D(Hc());var l$=D(O()),u$=require("vscode");var $v=class extends aP{async computeWorkingDirectory(e){return mC(e)}};$v=v([(0,l$.injectable)()],$v);async function mC(r){let e=r&&r.scheme==="file"?await dC.pathExists(r.fsPath):!1;return(r&&r.scheme==="file"?await dC.pathExists(dt(r.fsPath)):!1)&&r&&r.fsPath.includes(".")?dt(r.fsPath):e&&r&&(await dC.stat(r.fsPath)).isDirectory()?r.fsPath:r&&u$.workspace.getWorkspaceFolder(r)?.uri.fsPath||Os()?.fsPath||process.cwd()}var Zm=D(O());var p$=require("vscode");var Hv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(p$.commands.registerCommand(J.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};Hv=v([(0,Zm.injectable)(),d(0,(0,Zm.inject)(Bo)),d(0,(0,Zm.named)(Hu)),d(1,(0,Zm.inject)(F))],Hv);var fC=D(O()),m$=require("vscode");var d$=require("vscode");var Gv=class{constructor(e,t,n,i=[]){this.fs=e;this.disposableRegistry=t;this.options=n;this.loadFailedEmitter=new d$.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};n.webviewHost?(this.webviewHost=n.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),n=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString(),i="false";return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Qe.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${n}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return ${i};
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=b.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){x(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var VK=class extends Gv{constructor(t,n,i,o=[]){super(t,n,i,o);this.panelOptions=i;this._onDidChangeVisibility=new m$.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(n=>{this.panelOptions.listener.onMessage(n.type,n.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},zv=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new VK(this.fs,this.disposableRegistry,e)}};zv=v([(0,fC.injectable)(),d(0,(0,fC.inject)(F)),d(1,(0,fC.inject)(at))],zv);var Yv=D(O()),WD=require("vscode");var BK=class extends Gv{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,n,i=[]){super(e,t,n,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return WD.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},Qv=class{constructor(e,t,n){this.disposableRegistry=e;this.fs=t;this.context=n}async create(e){let t=[WD.Uri.file(Ve(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new BK(this.fs,this.disposableRegistry,e,t)}};Qv=v([(0,Yv.injectable)(),d(0,(0,Yv.inject)(F)),d(1,(0,Yv.inject)(at)),d(2,(0,Yv.inject)(ut))],Qv);function f$(r){r.addSingleton(su,su),r.addBinding(su,vr),r.addBinding(su,at),r.addSingleton(QP,$v),r.addSingleton(ue,jv),i3(r),GJ(r),QJ(r),i7(r),r.addSingletonInstance($j,Date.now()),r.addSingleton(is,is),r.addSingleton(be,vt),r.addSingleton(Nh,Hv),r.add(YP,zv),r.add(kp,Qv)}var ef=D(O()),I$=require("vscode");var rd=D(O()),ey=require("vscode");var hC=D(O()),au=require("vscode");var Xv=Symbol("IJupyterCommandFactory"),ed=Symbol("IJupyterSubCommandExecutionService");function Bfe(r){r.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function qK(r,e){let t=jr(e)||jr(e)||Nr(e)?.environment?.folderUri?.fsPath||e.uri.fsPath,n=r.map(i=>gr.get(i)).filter(i=>!!i).map(i=>i);switch(n.length){case 0:return"";case 1:return t?b.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,n[0]):b.libraryRequiredToLaunchJupyterNotInstalled(n[0]);default:{let i=n.pop();return t?b.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${n.join(", ")} ${ve.and} ${i}`):b.librariesRequiredToLaunchJupyterNotInstalled(`${n.join(", ")} ${ve.and} ${i}`)}}}var Qs=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let n=new au.CancellationTokenSource;try{let i=Be(e)==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=qK(s===!1?[27].concat(o):o,e);switch(N("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:gr.get(18),pythonEnvType:Be(e)}),await au.window.showErrorMessage(a,{modal:!0},b.jupyterInstall,b.selectDifferentJupyterInterpreter)){case b.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let l=o.filter(p=>p!==21);Bfe(l);let u=l.shift();for(;u;)if(await or(n.token,2,this.installer.install(u,e,n,void 0,s===!1))===0){u=l.shift();continue}else return 2;return N("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case b.selectDifferentJupyterInterpreter:return N("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case b.pythonInteractiveHelpLink:return au.env.openExternal(au.Uri.parse(AS.PythonInteractiveHelpLink)),N("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return N("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{n.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(n=>n.length===0)}async getDependenciesNotInstalled(e,t){let n=gn(e.uri);if(this.dependenciesInstalledInInterpreter.has(n))return[];let i=[];if(await or(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(n),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(x("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await au.window.showErrorMessage(b.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},b.selectDifferentJupyterInterpreter)===b.selectDifferentJupyterInterpreter?1:2}};v([Ov("InstallingMissingDependencies")],Qs.prototype,"installMissingDependencies",1),Qs=v([(0,hC.injectable)(),d(0,(0,hC.inject)(Ui)),d(1,(0,hC.inject)(Xv))],Qs);var $D=D(O());var HD=require("vscode");var g$=require("vscode");function VD(r,e){let t=jr(r),i={label:`${r.id===e.recommended?.id?"$(star-full) ":wr(r)?"$(warning) ":""}${t}`};return i.description=$(r.executable.uri||r.path,g$.workspace.workspaceFolders||[],new Gc().homeDir),i.tooltip=wr(r)?b.pythonCondaKernelsWithoutPython:"",i}function BD(r){switch(Be(r)){case"Conda":return wr(r)?{label:b.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:b.kernelCategoryForConda};case"PipEnv":return{label:b.kernelCategoryForPipEnv};case"Poetry":return{label:b.kernelCategoryForPoetry};case"Pyenv":return{label:b.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:b.kernelCategoryForVirtual};default:return{label:b.kernelCategoryForGlobal}}}var Ys=D(O()),v$=require("vscode");var qD="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",JK="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",Oa=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(JK,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(qD,void 0);if(e)return v$.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(qD,e?.toString()).then(f,f),this.memento.update(JK,!0).then(f,f)}};Oa=v([(0,Ys.injectable)(),d(0,(0,Ys.inject)(He)),d(0,(0,Ys.named)(bt))],Oa);var Zv=class{constructor(e,t,n,i){this.api=e;this.memento=t;this.checker=n;this.disposables=i}activate(){this.activateBackground().catch(f),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(qD)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(qD,t),await this.memento.update(JK,!0)}};Zv=v([(0,Ys.injectable)(),d(0,(0,Ys.inject)(tr)),d(1,(0,Ys.inject)(He)),d(1,(0,Ys.named)(bt)),d(2,(0,Ys.inject)(Ye)),d(3,(0,Ys.inject)(F))],Zv);var os=require("vscode");var $K=class{constructor(e){this.label=e}},JD=class extends $K{constructor(t,n){super(t);this.sortKey=n;this.kind=os.QuickPickItemKind.Separator}},td=class extends ir{constructor(t,n,i,o,s,a){super();this.provider=t;this.createQuickPickItem=n;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=new Set;this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let n=this._recommended?.id!==t?.id;this._recommended=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let n=this._selected!==t;this._selected=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],n={iconPath:new os.ThemeIcon("refresh"),tooltip:ve.refresh},i=this.quickPick=os.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.matchOnDescription=!0,i.buttons=this.options.supportsBack?[os.QuickInputButtons.Back,n]:[n],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>z(t),this,t),i.title=this._title||b.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=b.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===n&&(i.busy=!0,await o.refresh().catch(f),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new os.Disposable(()=>s&&clearTimeout(s)));break}},this,t),y$(o.items.map(a=>this.toQuickPickItem(a)),(a,c)=>b$(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{let c=this.connectionToCategory(a[0].item);this.quickPickItems.push(c),a.sort((l,u)=>l.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(c,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>x(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.has(t)}addCommand(t,n){let i=t;return i.execute=n,this.commands.add(i),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{this.commands.delete(i)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:n,disposables:i}=this.createQuickPick();n.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{n.onDidChangeSelection(c=>{if(c.length){let l=c[0];this.isSelectorQuickPickItem(l)?s(l.item):this.isCommandQuickPickItem(l)?s(l):this.isErrorQuickPickItem(l)}}),n.onDidTriggerButton(c=>c===os.QuickInputButtons.Back?s(Ne.back):void 0,this,i),n.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof Ne)return o===Ne.back?Ne.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===Ne.back)continue;return s instanceof Ne,s}return o||void 0}finally{z(i)}}}updateQuickPickItems(t,n){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(n.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let c=i.get(a.item.id);if(c&&c!==a.item)return this.toQuickPickItem(c);let l=o.get(a.item.id);if(l){let u=this.toQuickPickItem(l);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(l)}}return a});let s=n.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,n),y$(s,(a,c)=>b$(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{a.sort((u,p)=>u.label.localeCompare(p.label));let c=this.connectionToCategory(a[0].item),l=this.quickPickItems.find(u=>u.kind===os.QuickPickItemKind.Separator&&u.label===c.label);if(l){let u=this.quickPickItems.indexOf(l),p=this.categories.get(l),m=new Map(Array.from(p).map(y=>[y.item.id,y])),h=p.size;a.forEach(y=>{let C=m.get(y.item.id);C&&p.delete(C),p.add(y)});let g=Array.from(p);g.sort((y,C)=>y.label.localeCompare(C.label)),this.quickPickItems.splice(u+1,h,...g)}else{let u=this.quickPickItems.filter(h=>h instanceof JD).map((h,g)=>[h,g]);u.push([c,-1]),u.sort((h,g)=>h[0].sortKey.localeCompare(g[0].sortKey));let p=u.findIndex(h=>h[1]===-1),m=0;p>0&&(m=u.length===p+1?this.quickPickItems.length:u[p+1][1]),a.sort((h,g)=>h.label.localeCompare(g.label)),this.quickPickItems.splice(m,0,c,...a),this.categories.set(c,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];n&&i.push({label:b.recommendedItemCategoryInQuickPick,kind:os.QuickPickItemKind.Separator},n);let o=n;o=this.selected?this.quickPickItems.filter(p=>this.isSelectorQuickPickItem(p)).map(p=>p).find(p=>p.item.id===this.selected?.id):o;let s=this.quickPickItems.filter(p=>!this.isSelectorQuickPickItem(p)||p.item.id!==n?.item?.id),a=t.activeItems.length?t.activeItems[0]:void 0;o&&a&&(this.isSelectorQuickPickItem(a)?a.item.id!==o.item.id&&(o=void 0):o=void 0);let c=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,l=[].concat(Array.from(this.commands.values())).concat(i).concat(s).concat(c?[c]:[]),u=o?[o]:t.activeItems.length?[t.activeItems[0]]:[];if(u.length&&!l.includes(u[0])){let p=u[0],m=this.isSelectorQuickPickItem(p)&&l.find(h=>this.isSelectorQuickPickItem(h)&&h.item.id===p.item.id);m?u[0]=m:u.length=0}t.items=l,t.activeItems=u,!t.activeItems.length&&this.previouslySelectedItem&&l.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let n=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(n),n}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let n=this.createQuickPickItem(t,this);return n.item=t,this.quickPickItemMap.add(n),n}removeOutdatedQuickPickItems(t,n){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(n.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((c,l)=>{c.forEach(u=>{s.includes(u.item.id)&&(c.delete(u),a.push(u))}),c.size||(a.push(l),this.categories.delete(l))}),this.quickPickItems=this.quickPickItems.filter(c=>!a.includes(c)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let n=this.getCategory(t,this);return new JD(n.label,n.sortKey||n.label)}};function y$(r,e){let t=[],n;for(let i of r.slice(0).sort(e))!n||e(n[0],i)!==0?(n=[i],t.push(n)):n.push(i);return t}function b$(r,e){return(r.sortKey||r.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var cu=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(st).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new HD.CancellationTokenSource,t=new Gc,n=this.serviceContainer.get(Oa).selectedPythonPath,i=Pe.instance.get(pi),o=Pe.instance.get(zs).withFilter(u=>!wr(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>$o(u.executable.uri,n,t.osType)),a=n?b.currentlySelectedJupyterInterpreterForPlaceholder($(n,HD.workspace.workspaceFolders||[],t.homeDir)):"",c=[],l=new td(Promise.resolve(o),VD,BD,{supportsBack:!1},void 0,b.quickPickSelectPythonEnvironmentTitle);l.placeholder=a,l.selected=s(),c.push(l),c.push(e);try{if(!l.selected&&n){let p=o.onDidChange(()=>{l.selected=s(),l.selected&&p.dispose()});c.push(p)}let u=await l.selectItem(e.token);return!u||u instanceof Ne?void 0:u}catch(u){x("Failed to select a Python Environment to start Jupyter",u)}finally{z(c)}}};cu=v([(0,$D.injectable)(),d(0,(0,$D.inject)(pt))],cu);var mi=class{constructor(e,t,n,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=n;this.interpreterService=i;this._onDidChangeInterpreter=new ey.EventEmitter;ey.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),n=t;if(!n&&(n=await this.interpreterService.getActiveInterpreter(void 0),!n))return e&&await ey.window.showErrorMessage(e.message,{modal:!0},b.selectDifferentJupyterInterpreter)!==b.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(n,e);return i===1?(n=await this.selectInterpreter(),n?0:2):(i===0&&n!==t&&await this.setAsSelectedInterpreter(n),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let n=await or(t,this.interpreterService.getInterpreterDetails(e));if(n&&await this.interpreterConfiguration.areDependenciesInstalled(n,t))return n}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let n=await this.interpreterService.getActiveInterpreter(void 0);n&&await this.interpreterConfiguration.areDependenciesInstalled(n,e)&&(t=n)}return t}};mi=v([(0,rd.injectable)(),d(0,(0,rd.inject)(Oa)),d(1,(0,rd.inject)(cu)),d(2,(0,rd.inject)(Qs)),d(3,(0,rd.inject)(st)),d(4,(0,rd.inject)(F))],mi);var GD=Symbol("IKernelLauncher"),fi=Symbol("IRawNotebookSupportedService"),zD=Symbol("IRawKernelSessionFactory");var ty=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=n;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(I$.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){Rt(e)&&(this.notebookOpened=!0,N("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",r9(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f)}};ty=v([(0,ef.injectable)(),d(0,(0,ef.inject)(mi)),d(1,(0,ef.inject)(F)),d(2,(0,ef.inject)(fi)),d(3,(0,ef.inject)(Ye))],ty);var QD=D(O()),S$=require("vscode");var tn=class{static dispose(){z(tn.disposables)}constructor(e){e.push({dispose:()=>{tn.dispose()}})}activate(){S$.workspace.onDidChangeNotebookDocument(e=>{Rt(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let n=tn.cellToDisplayIdMapping.get(t.cell);n&&(tn.cellToDisplayIdMapping.delete(t.cell),tn.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(n))})})}static trackOutputByDisplayId(e,t,n,i){let o=tn.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,tn.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:n,cell:e,outputItems:i}),tn.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let n=tn.displayIdCellOutputMappingPerDocument.get(e);if(!n)return;let i=n.get(t);return i?.cell.document.isClosed?void 0:i}};tn.displayIdCellOutputMappingPerDocument=new WeakMap,tn.cellToDisplayIdMapping=new WeakMap,tn.disposables=[],tn=v([(0,QD.injectable)(),d(0,(0,QD.inject)(F))],tn);var tf=D(O());var HK="Active_Kernel_Id_List",qfe=100,ss=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(HK,[]);if(t.length){let n=e.uri,i=await this.crypto.createHash(n.toString()),o=t.find(s=>s.fileHash===i);return E(`Preferred Remote kernel for ${$(n)} is ${o?.kernelId}`),o?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let n=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(HK,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(n=!0,i.splice(s,1)),t&&(n=!0,i.push({fileHash:o,kernelId:t}),E(`Storing Preferred remote kernel for ${$(e)} is ${t}`));i.length>qfe;)n=!0,i.shift();n&&await this.globalMemento.update(HK,i)}};ss=v([(0,tf.injectable)(),d(0,(0,tf.inject)(He)),d(0,(0,tf.named)(bt)),d(1,(0,tf.inject)(Ah))],ss);var ny=D(O()),GK=require("vscode");var Jfe=1e3,ry=class{constructor(e,t,n){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.monitoredKernels=new WeakSet;this.timeouts=new Set;n.push(this)}dispose(){z(this.disposables),z(Array.from(this.timeouts.values()))}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.kernelProvider.onDidRestartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){let t=e.kernelConnectionMetadata;if(!Ft(t)||this.monitoredKernels.has(e))return;this.monitoredKernels.add(e);let n=[];this.disposables.push(new GK.Disposable(()=>z(n)));let i=()=>{if(z(n),e.disposed||e.disposing)return;let o=setTimeout(()=>{this.serverStorage.update(t.serverProviderHandle).catch(f)},Jfe);n.push(new GK.Disposable(()=>clearTimeout(o)))};this.kernelProvider.getKernelExecution(e).onPreExecute(i,this,this.disposables),i()}};ry=v([(0,ny.injectable)(),d(0,(0,ny.inject)(Zt)),d(1,(0,ny.inject)(Ke)),d(2,(0,ny.inject)(F))],ry);var Ka=D(O()),gC=require("vscode");var x$=require("vscode"),Yt=class{constructor(e){this._event=new x$.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}};var $fe="last-python-notebook-created",C$="last-notebook-created",iy=class{constructor(e,t,n,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=n;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;gC.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,n)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(C$);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(f)}shouldAutoStartStartServer(e){if(!e)return!1;let n=new Date().getTime()-e.getTime();return Math.floor(n/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!gC.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new gC.CancellationTokenSource,t=new Yt(!0);try{ee("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(n){x("Error starting server in serverPreload: ",n)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){Rt(e)&&this.createServerIfNecessary().catch(f)}kernelStarted(e){let t=Io(e.kernelConnectionMetadata);this.mementoStorage.update(C$,Date.now()).then(f,f),t===xe&&this.mementoStorage.update($fe,Date.now()).then(f,f)}};iy=v([(0,Ka.injectable)(),d(0,(0,Ka.inject)(ue)),d(1,(0,Ka.inject)(dP)),d(2,(0,Ka.inject)(F)),d(3,(0,Ka.inject)(fi)),d(4,(0,Ka.inject)(He)),d(4,(0,Ka.named)(si)),d(5,(0,Ka.inject)(Ke))],iy);var To=D(O());var Xs=D(O());var to=class extends et{constructor(e){super("jupyterinstall",e)}};var Or=require("vscode");var rf=class extends _n{constructor(e){super("timeout",b.rawKernelStartFailedDueToTimeout(ht(e)),e)}};var nd=class extends Nc{constructor(t,n,i,o){super(t,i,o);this.stdErr=n}};var oy=class extends _n{constructor(e){super("timeout",b.rawKernelStartFailedDueToTimeoutWaitingForPort(ht(e)),e)}};var id=class extends _n{constructor(t=-1,n,i){super("kerneldied",b.kernelDied(n.trim()),i);this.exitCode=t;this.stdErr=n}};var nf=class extends _n{constructor(t,n){super("noipykernel",b.kernelInvalid(ht(n)),n);this.reason=t}};var od=class extends Nc{constructor(e){super(b.kernelDiedWithoutError(ht(e)),void 0,e)}};var YD=class extends et{constructor(e){super("jupyterexpiredcert",e)}};var sd=class extends et{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var XD=new Map,QK=new Map,zK;function w$(r){zK=r}function YK(r,e){if(!r.pythonEnvironmentPath)return;let t=le();Hfe({interpreterHash:r.pythonEnvironmentPath}).then(n=>{r.pythonEnvironmentPackages=n||r.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=n||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function Hfe(r){if(!zK)return x("Python package provider is not initialized."),"{}";let e;if("interpreter"in r?e=r.interpreter:e=QK.get(r.interpreterHash),!e)return"{}";let t=await zK(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function E$(r){if(!r)return{};let e=XD.get(gn(r)),t=Yi(r);if(!e&&t)return{resourceType:t,resourceHash:r?await It(r.toString()):void 0};if(!e)return{};let n=JSON.parse(JSON.stringify(e[0]));return YK(e[0],n),n}function At(r,e,t,n,i){E$(r).then(o=>{Object.assign(o,n||{}),N(e,t,o,i)}).catch(f)}var lu=class extends et{constructor(t,n,i){super("jupyternotebooknotinstalled",t+(n?`
${n}`:""));this.interpreter=i}};var P$=new Map;function ZD(r,e){P$.set(Vt(r),e)}function sy(r,e,t){let n=e.jupyterCollections.find(i=>i.extensionId===r.extensionId&&i.id===r.id);return P$.get(Vt(r))||n?.label||t||`${r.id}:${r.handle}`}var cy=class{constructor(e,t,n,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=n;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(W("DataScience Error",e),e=ln.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof to)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof zo)await lP(this.configuration,e.message);else if(e instanceof YD)await uP(this.configuration,e.message);else if(!hr(e))if(e instanceof rf||e instanceof oy)Or.window.showErrorMessage(e.message).then(f,f);else if(e instanceof nd||e instanceof id||e instanceof lu||e instanceof As)Or.window.showErrorMessage(ay(e)).then(f,f);else if(e instanceof Ni&&cn())Or.window.showErrorMessage(b.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(f,f);else if(e instanceof Ni){let t=await this.handleJupyterServerConnectionError(e,void 0);Or.window.showErrorMessage(t).then(f,f)}else if(e instanceof Sp){let t=await this.handleJupyterServerUriProviderError(e,void 0);Or.window.showErrorMessage(t).then(f,f)}else{let t=k$(e.message||e.toString());Or.window.showErrorMessage(t).then(f,f)}}}async getErrorMessageForDisplayInCell(e,t,n){if(e=ln.unwrap(e),hr(e)||x("Error in execution (get message for cell)",e),e instanceof od)return"";if(e instanceof nf)return XK(e.kernelConnectionMetadata)||e.message;if(e instanceof to)return Qfe(e)||e.message;if(e instanceof Ni&&!cn())return e.message;if(e instanceof Ni&&cn())return b.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(hr(e))return"";if(e instanceof vv){let i=typeof e.product=="string"?e.product:gr.get(e.product)||`${e.product}`,o=jr(e.interpreter)||e.interpreter.id||"",s=Nr(e.interpreter),a=$(s?.executable.uri),c=o?` ${o} (${a})`:a;return b.packageNotInstalledWindowsLongPathNotEnabledError(i,c)}else{if((e instanceof nd||e instanceof id)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return b.failedToStartKernelDueToMissingPythonEnv(jr(e.kernelConnectionMetadata.interpreter)||qo(e.kernelConnectionMetadata.interpreter)||$(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof nd||e instanceof id)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0))return XK(e.kernelConnectionMetadata)||e.message;if(e instanceof _n||e instanceof Nc){let[i,o]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n),Ea(e.kernelConnectionMetadata.interpreter)]),s=vm(Or.workspace.workspaceFolders||[],e,ht(e.kernelConnectionMetadata),o,i.map(a=>a.uri));if(s){if(s.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(s.moduleName))return XK(e.kernelConnectionMetadata)||e.message;let a=[s.message];return s.moreInfoLink&&a.push(ve.clickHereForMoreInfoWithHtml(s.moreInfoLink)),mt(e.kernelConnectionMetadata)&&s.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(s.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(a,n),a.join(`
`)}}else{if(e instanceof Ni)return this.handleJupyterServerConnectionError(e,t);if(e instanceof Sp)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof sd){let i=Or.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return ay(b.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(i),t)}}}return ay(e,t)}async handleJupyterServerUriProviderError(e,t){let n=await sy(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return ay(b.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerConnectionError(e,t){let n=await sy(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return ay(b.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerProviderConnectionError(e,t){let n=new Or.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(f)),!0}catch{return!1}finally{n.dispose()}}async handleKernelError(e,t,n,i,o){if(hr(e)||W(`Kernel Error, context = ${t}`,e),e=ln.unwrap(e),hr(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof nf)if(W(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new Or.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof to)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof Ni||e instanceof Sp||e instanceof sd){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof sd?"":e instanceof Ni?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,c=e.serverProviderHandle.id,l=this.jupyterUriProviderRegistration.jupyterCollections.find(y=>y.extensionId===a&&y.id==c);if(!l||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,l))return 3;let u=e instanceof Ni?e.baseUrl:"",p=sy(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),m=e instanceof sd?Or.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",h=o==="jupyterExtension"?[b.selectDifferentKernel]:[];switch(await Or.window.showErrorMessage(e instanceof sd?b.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(m):b.remoteJupyterConnectionFailedWithServer(p),{detail:s,modal:!0},b.removeRemoteJupyterConnectionButtonText,b.changeRemoteJupyterConnectionButtonText,...h)){case b.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(f),1;case b.changeRemoteJupyterConnectionButtonText:return 1;case b.selectDifferentKernel:return 3}return 1}else if(e instanceof zo){this.sendKernelTelemetry(e,t,i,e.category);let s=b.jupyterSelfCertEnable,a=b.jupyterSelfCertClose;return Or.window.showErrorMessage(b.jupyterSelfCertFail(e.message),s,a).then(c=>{c===s?(N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Or.ConfigurationTarget.Workspace).catch(f)):c===a&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(f,f),2}else{if((t==="start"||t==="restart")&&n.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(n.interpreter.uri))return this.interpreterService.getInterpreterDetails(n.interpreter.id).then(async s=>{let a=await this.fs.exists(n.interpreter.uri);s?At(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"Unknown",isEmptyCondaEnv:wr(s),pythonEnvType:Be(s),fileExists:a}):At(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"EmptyEnvDetailsFromPython",isEmptyCondaEnv:wr(n.interpreter),pythonEnvType:Be(n.interpreter),fileExists:a})}).catch(async()=>{let s=await this.fs.exists(n.interpreter.uri);At(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"FailedToGetEnvDetailsFromPython",isEmptyCondaEnv:wr(n.interpreter),pythonEnvType:Be(n.interpreter),fileExists:s})}).catch(f),this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),Or.window.showErrorMessage(b.failedToStartKernelDueToMissingPythonEnv(jr(n.interpreter)||qo(n.interpreter)||$(n.interpreter.uri))).then(f,f),this.interpreterService.refreshInterpreters(!0).catch(f),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(n,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new Or.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let[s,a]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),Ea(n.interpreter)]),c=vm(Or.workspace.workspaceFolders||[],e,ht(n),a,s.map(l=>l.uri));return this.sendKernelTelemetry(e,t,i,c?.reason),c?this.showMessageWithMoreInfo(c.message,c?.moreInfoLink).catch(f):this.showMessageWithMoreInfo(ay(e,t)).catch(f),2}}}}sendKernelTelemetry(e,t,n,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&At(n,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes(J.ViewJupyterOutput)||(e=`${e} 
${b.viewJupyterLogForFurtherInfo}`);let n=t?[ve.learnMore]:[];await Or.window.showErrorMessage(e,...n).then(i=>{i===ve.learnMore&&t&&Or.env.openExternal(Or.Uri.parse(t))})}};cy=v([d(0,(0,Xs.inject)(bp)),d(0,(0,Xs.optional)()),d(1,(0,Xs.inject)(ue)),d(2,(0,Xs.inject)(Ls)),d(2,(0,Xs.optional)()),d(3,(0,Xs.inject)(Zt)),d(4,(0,Xs.inject)(Qt)),d(5,(0,Xs.inject)(at)),d(6,(0,Xs.inject)(st)),d(6,(0,Xs.optional)())],cy);var Gfe={restart:b.failedToRestartKernel,start:b.failedToStartKernel,interrupt:b.failedToInterruptKernel,execution:""};function ay(r,e){r=typeof r=="string"?r:ln.unwrap(r);let t=e?Gfe[e]:"",n="";return r instanceof lu?n=b.jupyterNotebookNotInstalledOrNotFound(r.interpreter):r instanceof et?n=$E(r.stdErr)||r.stdErr||r.message:n=typeof r=="string"?r:r.message,k$(t,n)}function zfe(r){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(r)?.length??0)>0}function k$(r="",e=""){r&&e.startsWith(r.substring(0,r.length-1))&&(r="");let t=[r,e].map(n=>n.trim()).filter(n=>n.length>0).join(` 
`);return!zfe(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${b.viewJupyterLogForFurtherInfo}`:t}function XK(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"||!r.interpreter)return;let e=jr(r.interpreter)||Te(r.interpreter.uri),t=gr.get(19),n=eo(19),i=`${jS(Te(r.interpreter.uri))} -m pip install ${n} -U --force-reinstall`;if(r.interpreter&&Be(r.interpreter)==="Conda"){let a=Nr(r.interpreter);a?.environment?.name?i=`conda install -n ${a?.environment?.name} ${n} --update-deps --force-reinstall`:a?.environment?.folderUri&&(i=`conda install -p ${Te(a?.environment?.folderUri)} ${n} --update-deps --force-reinstall`)}else r.interpreter&&Be(r.interpreter)==="Unknown"&&(i=`${jS(Te(r.interpreter.uri))} -m pip install ${n} -U --user --force-reinstall`);let o=b.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(e,gr.get(19)),s=b.installPackageInstructions(t,i);return o+`
`+s}function Qfe(r){let e=`${gr.get(18)} ${ve.and} ${gr.get(20)}`,t=[18,20].map(eo).join(" "),n=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=b.installPackageInstructions(e,n);return r.message+`
`+i+`
`+ve.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var ly=class extends cy{constructor(t,n,i,o,s,a,c,l){super(t,n,i,o,s,c,l);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,n){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n);if(i.length>0){let o=n?Ei(n):void 0,s=i.map(c=>{if(c.type==="file"){let l=n?$(c.uri,[],o):vn(c.uri);return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}else{let l=n?$(c.uri,[],o):`${vn(Ei(c.uri))}/__init__.py`;return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${ve.and} ${s.slice(-1)}`,t.push(b.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(b.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(ve.clickHereForMoreInfoWithHtml(O8))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(Ei(t)):[]}};ly=v([(0,To.injectable)(),d(0,(0,To.inject)(bp)),d(0,(0,To.optional)()),d(1,(0,To.inject)(ue)),d(2,(0,To.inject)(Ls)),d(2,(0,To.optional)()),d(3,(0,To.inject)(Zt)),d(4,(0,To.inject)(Qt)),d(5,(0,To.inject)(CD)),d(6,(0,To.inject)(at)),d(7,(0,To.inject)(st))],ly);var t_=D(O());var vC=class{constructor(e,t,n,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=n;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>n.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let n={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,n)}},ZK=class extends vC{constructor(e,t,n,i){super(e,t,n,i)}},eF=class extends vC{constructor(e,t,n,i){super(e,t,n,i)}async exec(e,t){let n,i={stdout:""};try{i=await super.exec(e,t)}catch(a){n=a}if(!i.stderr&&!n)return i;let o=()=>{if(n)throw x("Exception attempting to enumerate kernelspecs: ",n),n;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){x("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve(rs,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ve(rs,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},uy=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,n,i){return e==="notebook"?new ZK(t,n,this.executionFactory,i):e==="kernelspec"?new eF(t,n,this.executionFactory,i):new vC(t,n,this.executionFactory,i)}};uy=v([(0,t_.injectable)(),d(0,(0,t_.inject)(Vr))],uy);var yC=D(O());var D$=require("vscode");var py=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push(D$.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(f)}))}};py=v([(0,yC.injectable)(),d(0,(0,yC.inject)(mi)),d(1,(0,yC.inject)(F))],py);var ea=D(O());var Zs=D(O());var _r=require("vscode");var _$=D(Hc()),T$=require("vscode");async function r_(r){try{let e=await _$.realpath(r.fsPath);return Ur()!="Windows"&&(e=e.replace(/\\/g,"/")),T$.Uri.file(e)}catch{return r}}var Yfe=Ve("AppData","Roaming","jupyter","kernels"),R$=Ve(".local","share","jupyter","kernels"),A$=Ve("Library","Jupyter","kernels"),Xfe=Ve("AppData","Roaming","jupyter","runtime"),Zfe=Ve("Library","Jupyter","runtime"),N$=Ve("share","jupyter","kernels"),n_="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",tF="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",Br=class{constructor(e,t,n,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,n)}async getKernelSpecTempRegistrationFolder(){let e=lr(this.context.extensionUri,"temp","jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?r_(lr(t,Yfe)):this.platformService.isMac?lr(t,A$):lr(t,R$)})(),this.cachedKernelSpecRootPath.then(t=>{E(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(f),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e,t=this.platformService.homeDir;if(t&&(this.platformService.isWindows?e=await r_(lr(t,Xfe)):this.platformService.isMac?e=lr(t,Zfe):e=process.env.$XDG_RUNTIME_DIR?_r.Uri.file(Ve(process.env.$XDG_RUNTIME_DIR,"jupyter","runtime")):lr(t,".local","share","jupyter","runtime")),!e){x("Failed to determine Jupyter runtime directory");return}try{return await this.fs.createDirectory(e),e}catch(n){x(`Failed to create runtime directory, reverting to temp directory ${e}`,n)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let n=new So,i=await this.getJupyterPaths();for(let m of i)m&&!n.has(m)&&n.set(m,n.size);if(t)try{ne(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let m=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),h=_r.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),g=await m.exec([h.fsPath],{});if(g.stdout.trim().length){let y=_r.Uri.file(g.stdout.trim());await this.fs.exists(y)?n.has(y)||n.set(y,n.size):W(`Got a non-existent Jupyter Data Dir ${y}`)}else W(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${g.stderr}`)}catch(m){x(`Failed to get DataDir based on ENABLE_USER_SITE for ${jr(t)}`,m)}let o;t&&(o=await Ea(t));let s=o?_r.Uri.joinPath(_r.Uri.file(o),"share","jupyter"):void 0,a=this.getSystemJupyterPaths(),c=s?new Uc(a).has(s)?void 0:s:void 0,l=this.getJupyterDataDir(),u=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(u)?[l,c].forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}):[c,l].forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}),a.forEach(m=>{m&&!n.has(m)&&n.set(m,n.size)}),Array.from(n.entries()).sort((m,h)=>m[1]-h[1]).map(m=>m[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?_r.Uri.file(xn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?_r.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?xn(process.env.PROGRAMDATA):void 0;return e?[_r.Uri.joinPath(_r.Uri.file(e),"jupyter")]:[]}else return[_r.Uri.file("/usr/local/share/jupyter"),_r.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return _r.Uri.file(xn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return _r.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?_r.Uri.file(xn(process.env.APPDATA)):"";if(e)return _r.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?_r.Uri.joinPath(t,"data"):_r.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let n=process.env.XDG_DATA_HOME?_r.Uri.file(xn(process.env.XDG_DATA_HOME)):_r.Uri.joinPath(this.platformService.homeDir,".local","share");return _r.Uri.joinPath(n,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new Je,n=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:n,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===n&&(this.cachedKernelSpecRootPaths=void 0)},this);return n.finally(()=>i.dispose()).catch(f),n}async getKernelSpecRootPathsImpl(e){let t=new Uc(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let n=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];n&&t.add(n),process.env.PROGRAMDATA&&t.add(_r.Uri.file(Ve(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let n=this.platformService.isMac?A$:R$;t.add(_r.Uri.file(Ve("/","usr","share","jupyter","kernels"))),t.add(_r.Uri.file(Ve("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(lr(this.platformService.homeDir,n))}return E(`Kernel Spec Root Paths, ${Array.from(t).map(n=>$(n)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(f,f)},f),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let n=new Uc,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(Gn).map(s=>t?Ve(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>r_(_r.Uri.file(a))))).forEach(a=>{a&&n.add(a)}),E(`Jupyter Paths ${$(t)}: ${Array.from(n).map(s=>$(s))}`),Array.from(n)}getCachedPaths(){return this.globalState.get(tF,[]).map(e=>_r.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(tF,[]),n=e.map(_r.Uri.toString);t.join(",")!==n.join(",")&&await this.globalState.update(tF,n)}getCachedRootPath(){if(this.globalState.get(n_)){let e=this.globalState.get(n_);if(e)return _r.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(n_,e.toString()).then(f,f):this.globalState.update(n_,void 0).then(f,f)}};v([oi("getDataDirsImpl",7),d(1,Wl("id"))],Br.prototype,"getDataDirsImpl",1),v([d(0,ip())],Br.prototype,"getJupyterPathKernelPaths",1),Br=v([(0,Zs.injectable)(),d(0,(0,Zs.inject)(Dr)),d(1,(0,Zs.inject)(Fc)),d(2,(0,Zs.inject)(F)),d(3,(0,Zs.inject)(He)),d(3,(0,Zs.named)(bt)),d(4,(0,Zs.inject)(vr)),d(5,(0,Zs.inject)(ut)),d(6,(0,Zs.inject)(Vr))],Br);var of=class{constructor(e,t,n,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=n;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return b.selectJupyterInterpreter;let n=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return n.length===0?"":n.length===1&&n[0]===21?b.jupyterKernelSpecModuleNotFound(t.uri.fsPath):qK(n,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let n=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(b.startingJupyterLogMessage(An(n.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:n}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,n)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(Gn).filter(l=>l.trim().length);a.push(Ei(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(Gn)},E(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(Gn)}`),E(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let c=Object.keys(s).filter(l=>l.toLowerCase()==="path");if(c.length){let l=c.map(u=>`${u}=${s[u]}`).join(",");E(`Start Jupyter Notebook with PATH variable. ${l}`)}else x("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),n=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=Ve(rs,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await n.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(c){W("Failed to parse JSON when getting server info out from getServerInfo.py",c);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let n=await this.getReasonForJupyterNotebookNotBeingSupported();throw new to(n)}return t}};of=v([(0,ea.injectable)(),d(0,(0,ea.inject)(mi)),d(1,(0,ea.inject)(st)),d(2,(0,ea.inject)(Qs)),d(3,(0,ea.inject)(Vr)),d(4,(0,ea.inject)(Bo)),d(4,(0,ea.named)(bh)),d(5,(0,ea.inject)(Br)),d(6,(0,ea.inject)(Vs))],of);var i_=D(O());var sf=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,n,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=n?[e.fsPath,"--to","python","--stdout","--template",n]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw x("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};v([Ov("ExportNotebookToPython")],sf.prototype,"exportNotebookToPython",1),sf=v([(0,i_.injectable)(),d(0,(0,i_.inject)(Vr))],sf);var bC=D(O());var dy=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new Uc}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let n=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return n===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),n}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return bP(i.stdout)}};dy=v([(0,bC.injectable)(),d(0,(0,bC.inject)(Ui)),d(1,(0,bC.inject)(Xv))],dy);var lf=D(O());var my=require("vscode");var ad=D(O());var O$=require("vscode");async function ro(r,e){if(!r)return;let t=gn(r),[n,i]=XD.get(t)||[{resourceType:Yi(r),resourceHash:r?await It(r.toString()):void 0,kernelSessionId:await It(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(n.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(n.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(n.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(n.userExecutedCell=e.userExecutedCell,n.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(n.kernelSessionId=await It(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=xe;break;default:break}let c="kernelSpec"in o&&o.kernelSpec.specFile?It(o.kernelSpec.specFile):Promise.resolve("");n.kernelLanguage=a,[n.kernelId,n.kernelSpecHash]=await Promise.all([It(o.id),c]),i.previouslySelectedKernelConnectionId=o.id;let l=o.interpreter;if(l){n.isUsingActiveInterpreter=Na.isActiveWorkspaceInterpreter(r,l),n.pythonEnvironmentType=Be(l);let[u,p]=await Promise.all([It(Te(Ec(l.uri))),lp(l)]);n.pythonEnvironmentPath=u,QK.set(n.pythonEnvironmentPath,l),p?n.pythonEnvironmentVersion=`${p.major}.${p.minor}.${p.micro}`:n.pythonEnvironmentVersion=void 0,YK(n)}n.kernelConnectionType=n.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";XD.set(t,[n,i])}async function as(r,e){await ro(r,{kernelConnection:e,userExecutedCell:!0})}var Fa=class{constructor(e,t,n,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=n;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,n,i){let o=n.env&&Object.keys(n.env).length>0?n.env:void 0,s=(n.language||"").toLowerCase()===xe;if(!t&&n.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(O$.Uri.file(n.interpreterPath),i).catch(p=>{x("Failed to fetch interpreter information for interpreter that owns a kernel",p)})),i?.isCancellationRequested)return;let[a,c]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(f),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(p=>{x("Failed to get env variables for interpreter, hence no variables for Kernel",p)}):void 0]);if(i?.isCancellationRequested)return;await ro(e,{capturedEnvVars:Object.keys(c||{}).length>0}),!c&&Object.keys(a||{}).length===0&&E("No custom variables nor do we have a conda environment");let l={...process.env};process.platform==="win32"&&(l={},Object.keys(process.env).forEach(p=>{l[p.toUpperCase()]=process.env[p]})),o=o||{},a=a||{};let u={};for(let[p,m]of Object.entries(o||{}))typeof m=="string"&&M$(p,m,process.env)!==m&&(u[p]=m,delete o[p]);s||t?(c=c||a,Object.assign(l,c,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(ee(`Adding env Variable PYTHONNOUSERSITE to ${$(t?.uri)}`),l.PYTHONNOUSERSITE="True"),s&&(l.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,l),this.envVarsService.mergeVariables(a,l)),E(`Kernel Env Variables for ${n.specFile||n.name}, PATH value is ${l.PATH}`);for(let[p,m]of Object.entries(u))l[p]=M$(p,m,l);return l}};Fa=v([(0,ad.injectable)(),d(0,(0,ad.inject)(st)),d(1,(0,ad.inject)(Vs)),d(2,(0,ad.inject)(Kc)),d(3,(0,ad.inject)(Fc)),d(4,(0,ad.inject)(ue))],Fa);var ehe=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function M$(r,e,t){if(!e.includes("$"))return e;let n=!1,i=e;return i=i.replace(ehe,(o,s,a,c,l)=>c>0&&l[c-1]==="\\"?o:a&&a!==""||!s||s===""?(n=!0,o):t[s]||""),!n&&i!==e&&(E(`${r} value in kernelSpec updated from ${e} to ${i}`),e=i),e.replace(/\\\$/g,"$")}var K$=require("vscode");async function F$(r,e,t){if(!t.interpreter||!ft(t)||!r.kernel||r.kernel.status==="dead"||r.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let n=new Je;try{let i=await bn(r.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=Us(o.text).trim().toLowerCase(),a=$o(t.interpreter.uri,K$.Uri.file(s));await ro(e,{interpreterMatchesKernel:a})}catch(i){x(`Failed to compare interpreters after ${n.elapsedTime}ms`,i)}}function the(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!mt(e))return!1;let t=e?e.kernelSpec:r;return o_(t.argv[0])}function af(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!mt(e))return!1;let t=e?e.kernelSpec:r;if(t.language&&t.language.toLowerCase()!==xe||!the(r))return!1;let n=t.argv.indexOf("-m");if(n===-1)return!1;let i=t.argv.length-1>=n?t.argv[n+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function o_(r){return r=_e(r).trim().toLowerCase(),r==="python"||r==="python3"||r==="python.exe"||r==="python3.exe"}var cf=class{constructor(e,t,n,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=n;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,n,i,o){if(E(`Check if a kernel ${t.id} is usable`),af(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new nf(a,t);default:break}}var s=void 0;mt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(my.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&_e(dt(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(E(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):E(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let n=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=lr(n,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return ee(`Kernel spec file for ${e.id} already exists ${$(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!Wp(Te(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:Cm(e.interpreter)}),ee(`RegisterKernel for ${e.id} into ${$(i)}`),E(`RegisterKernel for ${e.id} into ${$(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=dt(s),c=dt(i.fsPath),l=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(l.map(async u=>{let p=Ve(a,u),m=Ve(c,u);await this.fs.copy(my.Uri.file(p),my.Uri.file(m))}))}return i.fsPath}async updateKernelEnvironment(e,t,n,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),c=s;if(n&&a){let l=_e(n).toLowerCase()===s.name.toLowerCase()?n:lr(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(my.Uri.file(l))){W(`Spec file for ${t.id} does not exist ${l} hence not updating env vars.`);return}let u=my.Uri.file(l);try{let p=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(p.metadata?.interpreter?(af(s)&&(E(`Python KernelSpec argv[0] updated for ${t.id} from '${p.argv[0]}' to '${$(o.uri)}'`),p.argv[0]=o.uri.fsPath),p.metadata=p.metadata||{},p.metadata.interpreter=o):E(`KernelSpec argv[0] not updated for ${t.id} ('${p.argv[0]}')`),p.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,c),p=g9(p),await this.fs.writeFile(u,JSON.stringify(p,void 0,2)),E(`Updated kernel spec for ${t.id} with environment variables for ${$(u)}`),i?.isCancellationRequested))return;c.metadata=p.metadata}catch(p){if(i?.isCancellationRequested)return;throw x(`Failed to update kernel spec for ${t.id} with environment variables for ${$(u)}`,p),p}}else W(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};v([Rh("Failed to register an interpreter as a kernel")],cf.prototype,"registerKernel",1),cf=v([(0,lf.injectable)(),d(0,(0,lf.inject)(Ls)),d(1,(0,lf.inject)(vr)),d(2,(0,lf.inject)(Br)),d(3,(0,lf.inject)(Fa))],cf);var IC=D(O());var L$=require("vscode");var fy=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return W(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let n=new L$.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(W(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return W(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{n.dispose()}}};fy=v([(0,IC.injectable)(),d(0,(0,IC.inject)(Tm)),d(1,(0,IC.inject)(Qt))],fy);var J$=D(Ro()),s_=require("vscode"),ta=D(O());var hy=class extends _n{constructor(e){super("timeout",b.jupyterLaunchTimedOut,e)}};var gy=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.disposableRegistry=t;this.configuration=i;this.notebookStarter=o;this.jupyterInterpreterService=s;this.disposed=!1;this._disposed=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),s_.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),n.push(this)}async dispose(){ee("Disposing HostJupyterExecution"),this._disposed||(this._disposed=!0,E("Disposing super HostJupyterExecution"),this.disposed=!0,E("Cleaning up server cache"),await this.cache?.then(e=>e.dispose()).catch(f)),E("Finished disposing HostJupyterExecution")}async startServer(e,t){if(this._disposed)throw new Error("Notebook server is disposed");if(!this.cache){let n=this.cache=this.startJupyterWithRetry(e,t);n.catch(i=>{x("Failed to start the Jupyter Server",i),this.cache===n&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(e){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(e):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():b.webNotSupported}async getUsableJupyterPython(e){return!this.usablePythonInterpreter&&!this.disposed&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await ur(e,this.jupyterInterpreterService.getSelectedInterpreter(e))),this.usablePythonInterpreter}startJupyterWithRetry(e,t){return ur(t,(async()=>{let i,o=1,s=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),a;for(;o<=s&&!this.disposed;){try{return i=await this.startImpl(e,t),E("Connection complete server"),i}catch(c){if(a=c,c instanceof hy&&o<s)ee("Retry because of wait for idle problem."),i?.dispose(),o+=1;else throw i&&this.disposed,c}throw a}throw new Error("Max number of attempts reached")})())}async startImpl(e,t){ee("Launching server");let n=this.configuration.getSettings(e),i=n.useDefaultConfigForJupyter,o=await mC(e),s=Os(),a=cg(o,s?lr(s,`${(0,J$.default)()}.txt`):void 0,n);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(e,i,this.configuration.getSettings(void 0).jupyterCommandLineArguments,s_.Uri.file(a),t)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};gy=v([(0,ta.injectable)(),d(0,(0,ta.inject)(st)),d(1,(0,ta.inject)(F)),d(2,(0,ta.inject)(ai)),d(3,(0,ta.inject)(ue)),d(4,(0,ta.inject)(FP)),d(4,(0,ta.optional)()),d(5,(0,ta.inject)(ed)),d(5,(0,ta.optional)())],gy);var xC=D(O());var a_=class extends ln{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var vy=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Yt(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new a_}};vy=v([(0,xC.injectable)(),d(0,(0,xC.inject)(Cg)),d(1,(0,xC.inject)(Ye))],vy);var uf=D(O());var c_=class extends et{constructor(){super("nodeonly",b.webNotSupported)}};var yy=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new c_;try{if(E("Checking for server usability."),!await this.checkUsable())throw E("Server not usable (should ask for install now)"),new to(b.jupyterNotSupported(await t.getJupyterServerError()));E("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return In.throwIfCanceled(e.token),i}catch(n){throw e.token?.isCancellationRequested&&hr(n)||await t.refreshCommands(),n}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let n=jr(t)||Te(t.uri);throw new Error(b.jupyterNotSupportedBecauseOfEnvironment(n,e.toString()))}else throw new to(b.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};yy=v([(0,uf.injectable)(),d(0,(0,uf.inject)(yp)),d(0,(0,uf.optional)()),d(1,(0,uf.inject)(st))],yy);var $$=D(require("child_process")),uu=D(O()),H$=D(require("os"));var G$=D(Ro()),CC=require("vscode");var u_=require("vscode");var by=class extends et{constructor(t,n,i){super("jupytercannotbelaunchedwitheroot",t+(n?`
${n}`:""));this.interpreter=i}};var ahe=new RegExp(cm.UrlPatternRegEx),l_=class{constructor(e,t,n,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=n;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=le();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let c=o.get(ue).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(b.jupyterLaunchTimedOut)},c);let l=0;e.proc&&e.proc.on("exit",u=>l=u||0),this.subscriptions.push(e.out.onDidChange(u=>{E(u.out),this.output+=u.out,cm.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(p=>this.getJupyterURL(p,this.output)).catch(p=>W("Failed to get server info",p))})),e.out.done.then(()=>this.rejectStartPromise(b.jupyterServerCrashed(l))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),z(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let n=e.find(i=>Wp(Te(this.notebookDir),Te(u_.Uri.file(i.notebook_dir))));if(n){let i=n.url,o=n.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=ahe.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(l){x(`Failed to parse ${s}`,l),this.rejectStartPromise(b.jupyterLaunchNoURL);return}let c=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${c}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let n=this.serviceContainer.get(ue),i=this.serviceContainer.get(Hl),o=this.serviceContainer.get(Ip),s=fx({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:$e},{baseUrl:e,token:t,displayName:cP(t,e)},i,o,n,this.rootDir,new u_.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,n=this.output;n.includes("Jupyter command `jupyter-notebook` not found")?t=new lu(e,n,this.interpreter):n.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new by(e,n,this.interpreter):t=new As(e,n,this.interpreter),this.startPromise.reject(t)}}};var Iy=require("vscode");var ra=new Set;function p_(...r){let e=new ci;try{let t=new class{async providePortAttributes(n,i){if(r.includes(n.port))return new Iy.PortAttributes(Iy.PortAutoForwardAction.Ignore)}};for(let n of r){let i={portRange:n};e.add(Iy.workspace.registerPortAttributesProvider(i,t))}}catch(t){x("Failure in registering port attributes",t)}return e}var Sy=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=n;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,n,i,o){ee("Starting Notebook");let s=0,a,c=[],l=vt.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(C=>this.disposables.push(C)).catch(f);let p=await this.generateArguments(t,n,u,i.fsPath);In.throwIfCanceled(o),E("Starting Jupyter Notebook");let[m,h,g]=await Promise.all([this.jupyterInterpreterService.startNotebook(p||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);m.proc&&(m.proc.on("exit",C=>s=C),m.out.onDidChange(C=>this.jupyterOutputChannel.append(C.out))),m&&o.onCancellationRequested(()=>{m.dispose()},this,c),E("Waiting for Jupyter Notebook"),a=new l_(m,CC.Uri.file(h.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,g),In.throwIfCanceled(o);let y=await ur(o,a.ready);try{let C=parseInt(new URL(y.baseUrl).port||"0",10);if(C&&!isNaN(C)){let k=p_(C);m.proc&&m.proc.on("exit",()=>{ra.delete(C),k.dispose()}),ra.add(C)}}catch(C){x(`Parsing failed ${y.baseUrl}`,C)}return z(c),y}catch(u){throw z(c),hr(u)||u instanceof As||u instanceof by||u instanceof lu?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(b.jupyterServerCrashed(s)):ln.from(b.jupyterNotebookFailure(u),u):new to(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{l.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,n){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(n))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,n,i){return!t||t.length===0?this.generateDefaultArguments(e,n,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,n=Ve(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(CC.Uri.file(n),""),ee(`Generating custom default config at ${n}`),`--config=${n}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(CC.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(n=>{$$.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),n(e)})}))}catch{return e}}async generateTempDir(){let e=CC.Uri.file(Ve(H$.tmpdir(),(0,G$.default)()));return await this.fs.createDirectory(e),{path:Te(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};Sy=v([(0,uu.injectable)(),d(0,(0,uu.inject)(ed)),d(1,(0,uu.inject)(at)),d(2,(0,uu.inject)(pt)),d(3,(0,uu.inject)(Bo)),d(3,(0,uu.named)(bh))],Sy);var ol=require("vscode"),pf=D(O());var xy=class extends ir{constructor(t,n){super();this._onDidLoad=this._register(new ol.EventEmitter);this._onDidChangeUri=this._register(new ol.EventEmitter);this._onDidRemoveUris=this._register(new ol.EventEmitter);this._onDidAddUri=this._register(new ol.EventEmitter);this._all=[];n.push(this),this.newStorage=this._register(new rF(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,n){this.hookupStorageEvents(),ne(`setUri: ${t.id}.${t.handle}`);let i={time:n?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};xy=v([(0,pf.injectable)(),d(0,(0,pf.inject)(He)),d(0,(0,pf.named)(bt)),d(1,(0,pf.inject)(F))],xy);var rF=class{constructor(e){this.memento=e;this._onDidChangeUri=new ol.EventEmitter;this._onDidRemoveUris=new ol.EventEmitter;this._onDidAddUri=new ol.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${ol.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),n=t.find(a=>Vt(a.provider)===Vt(e.provider)),o=[{displayName:e.displayName||n?.displayName||Vt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,c)=>c.time-a.time).filter(a=>Vt(a.provider)!==Vt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(ri.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),n||this._onDidAddUri.fire(e),s.length){let a=s.map(c=>({provider:c.serverHandle,time:c.time,displayName:c.displayName||""}));this._onDidRemoveUris.fire(a.map(c=>c.provider))}this._onDidChangeUri.fire()}).catch(f)}async update(e){let n=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:n?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let n=this.getAll();if(n.length===0)return;let i=n.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=n.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>x(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async n=>{let i=Vt(n.serverHandle),o={time:n.time,displayName:n.displayName||i,provider:n.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var cd=D(O());var d_="removeKernelUrisAndSessionsUsedByResources",Cy=class{constructor(e,t,n){this.disposables=e;this.uriStorage=t;this.memento=n;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(d_,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Vt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,n){let i=Vt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][n]=this.usedRemoteKernelServerIdsAndSessions[i][n]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][n];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(d_,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}trackKernelIdAsNotUsed(e,t,n){let i=Vt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(n in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][n];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][n],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(d_,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}onDidRemoveServers(e){e.forEach(t=>{let n=Vt(t);delete this.usedRemoteKernelServerIdsAndSessions[n],this.memento.update(d_,this.usedRemoteKernelServerIdsAndSessions).then(f,f)})}};Cy=v([(0,cd.injectable)(),d(0,(0,cd.inject)(F)),d(1,(0,cd.inject)(Zt)),d(2,(0,cd.inject)(He)),d(2,(0,cd.named)(bt))],Cy);var hf=D(require("node-fetch")),sH=D(iH());var oH=require("vscode");function AF(r){return class extends r{constructor(...n){super(...n);this._onAnyMessage=new oH.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(n){super.emit=n}send(n,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(n,i)))).then(()=>super.send(n,i)):super.send(n,i)}handleEvent(n,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>n(i,...o)).catch(s=>x(`Exception while handling messages: ${s}`)),!0):n(i,...o)}emit(n,...i){return this.handleEvent((o,...s)=>super.emit(o,...s),n,...i)}addReceiveHook(n){this.receiveHooks.push(n)}removeReceiveHook(n){this.receiveHooks=this.receiveHooks.filter(i=>i!==n)}addSendHook(n){this.sendHooks.push(n)}removeSendHook(n){this.sendHooks=this.sendHooks.filter(i=>i!==n)}}}var aH=D(O());var no=new Map;var Py=class{getRequestCtor(e,t,n){class i extends hf.Request{constructor(s,a){super(s,a);let c=this.headers,l=n();Object.keys(l).forEach(m=>c.append(m,l[m].toString())),c.set("Content-Type","application/json");let p=c.append.bind(c);c.append=(m,h)=>{m.toLowerCase()!=="authorization"&&p(m,h)}}}return n&&Object.keys(n()||{}).length?i:hf.Request}getWebsocketCtor(e,t,n){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),n){let c=n();a=a?{...a,...c}:c}return a&&(s={...s,headers:a}),s};class o extends AF(sH.default){constructor(c,l){super(c,l,i());let u,p=/.*\/kernels\/(.*)\/.*/.exec(c);p&&p.length>1&&(this.kernelId=p[1]),this.kernelId?(no.set(this.kernelId,this),this.on("close",()=>{u&&this.timer!==u&&clearInterval(u),no.get(this.kernelId)===this&&no.delete(this.kernelId)})):x("KernelId not extracted from Kernel WebSocket URL"),u=this.timer=setInterval(()=>this.ping(f),3e4)}}return o}wrapWebSocketCtor(e){class t extends AF(e){constructor(o,s,a){super(o,s,a);let c,l=/.*\/kernels\/(.*)\/.*/.exec(o);l&&l.length>1&&(this.kernelId=l[1]),this.kernelId?(no.set(this.kernelId,this),this.on("close",()=>{c&&this.timer!==c&&clearInterval(c),no.get(this.kernelId)===this&&no.delete(this.kernelId)})):x("KernelId not extracted from Kernel WebSocket URL"),c=this.timer=setInterval(()=>this.ping(f),3e4)}}return t}getFetchMethod(){return hf.default}getHeadersCtor(){return hf.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};Py=v([(0,aH.injectable)()],Py);var cH=require("https"),lH=D(O());var ky=class{createHttpRequestAgent(){return new cH.Agent({rejectUnauthorized:!1})}};ky=v([(0,lH.injectable)()],ky);var ls=D(O());var cs=require("vscode");var fge=["/bin/sh","/bin/bash","/bin/zsh"];function C_(r,e){let t=(r.argv||[]).some(n=>(n=n.toLowerCase(),fge.some(i=>n.includes(i))));N("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:r.language,kind:e,usesShell:t})}var Dy="remoteKernelSpecCache.json";var hge=2e3,w_=class extends Ws{constructor(t,n,i,o,s,a,c,l,u,p){super();this.id=t;this.displayName=n;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=c;this.jupyterConnection=l;this.fs=u;this.context=p;this._status="idle";this._onDidChangeStatus=new cs.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new go;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new cs.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new cs.EventEmitter;this.onDidChange=this._onDidChange.event;this.cacheFile=cs.Uri.joinPath(p.globalStorageUri,Dy),this.cacheKey=Vt(c),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(f,f),this._register(this.kernelProvider.onDidStartKernel(t=>{Ft(t.kernelConnectionMetadata)&&this.updateCache().then(f,f)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&Ft(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let n=setTimeout(()=>{this.updateCache().then(f,f)},hge);return this.kernelDisposeDelayTimer=new cs.Disposable(()=>clearTimeout(n)),n}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,n=!1){return(!this.cachedConnection||n)&&(this.cachedConnection=this.getRemoteConnectionInfo(t)),this.cachedConnection.then(i=>i?(this.cachedConnection=Promise.resolve(i),this.listKernelsFromConnection(i)):Promise.resolve([])).catch(i=>this.isDisposed?Promise.reject(i):n?(this.cachedConnection=void 0,Promise.reject(i)):this.getListOfKernelsWithCachedConnection(t,!0))}async loadCache(t=!1,n=!1){ne(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(f,f),this.loadCache(!0).then(f,f);else try{s=await this.getListOfKernelsWithCachedConnection(n),this._lastError=void 0}catch(a){a instanceof cs.CancellationError||(x("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let n=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new cs.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{n=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){W(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),n=await this.getFromCache(i.token),n=n.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(n)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let n=[];return t&&n.push(vt.createProgressReporter(void 0,b.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>z(n))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new cs.CancellationError;let n=this.cache;(!n||n.length===0)&&(n=await this.getCacheContents());let i=[],o=Promise.all(n.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await or(t,o),i}catch(n){x("UniversalRemoteKernelFinder: Failed to get from cache",n)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),n=JSON.parse(t);if(n.extensionVersion!==this.env.extensionVersion)return[];let i=n.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>Fs.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let n=[];try{let i=xp.create(t.settings);n.push(i);let[o,s,a,c]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),FV(t.serverProviderHandle)]),l=s.map(m=>(C_(m,"remote"),gx.create({kernelSpec:m,id:Ai(m,void 0,c),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(m=>{let h=m.kernel,g=h.last_activity?new Date(Date.parse(h.last_activity.toString())):new Date,y=h.connections?parseInt(h.connections.toString(),10):0,C=o.find(T=>T.id===m.kernel?.id)||{},k=s.find(T=>T.name===m.kernel?.name)||{};return hx.create({kernelModel:{...m.kernel,...k,...C,name:m.kernel?.name||"",lastActivityTime:g,numberOfConnections:y,model:m},baseUrl:t.baseUrl,id:m.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(m=>!this.kernelIdsToHide.has(m.kernelModel.id||"")),...l]}catch(i){throw x(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(n.map(i=>i.dispose().catch(f)))}}async writeToCache(t){try{E(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let n=this.cache,i=new Map(n.map(m=>[m.id,m])),o=new Map(t.map(m=>[m.id,m])),s=t.filter(m=>!i.has(m.id)),a=t.filter(m=>i.has(m.id)&&!ya(m,i.get(m.id))),c=n.filter(m=>!o.has(m.id)),l=this.cacheKey;this.cache=n.filter(m=>o.has(m.id)).concat(s),this.cache.forEach(m=>{let h=o.get(m.id);m!==h&&h.kind==="connectToLiveRemoteKernel"&&m.kind==="connectToLiveRemoteKernel"&&m.updateModel(h.kernelModel)});let u=t.map(m=>m.toJSON()),p={extensionVersion:this.env.extensionVersion,data:{}};try{let m=await this.fs.readFile(this.cacheFile),h=JSON.parse(m);h.extensionVersion===this.env.extensionVersion&&(p=h)}catch{}p.data[l]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(p))).catch(m=>{x("Failed to cache the remote kernels.",m)}),(s.length||a.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}catch(n){x("UniversalRemoteKernelFinder: Failed to write to cache",n)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var E_=require("vscode");var hu=class{constructor(e,t,n,i,o,s,a,c,l,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=n;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=c;this.context=l;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(f)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(f))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new E_.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let n=t.serverProvider;if(!(!n||this.mappedProviders.has(n)))return this.mappedProviders.add(n),n?.onDidChangeServers&&n?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(f)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Vt(o.provider))),n=e.serverProvider;if(!n)return;let i=new E_.CancellationTokenSource;try{let o=await Promise.resolve(n.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let c={extensionId:e.extensionId,handle:a.id,id:e.id},l=Vt(c);s.add(l),ZD(c,a.label),!(this.mappedServers.has(l)||!t.has(l))&&(this.mappedServers.add(l),this.createRemoteKernelFinder(c,a.label))}),this.serverFinderMapping.forEach((a,c)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Vt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(c))})}catch(o){x(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Vt(e.provider);if(this.serverFinderMapping.has(t))return;let n=new E_.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(l=>l.extensionId===e.provider.extensionId&&l.id===e.provider.id);if(!s||!s.serverProvider)return;let c=(await Promise.resolve(s.serverProvider.provideJupyterServers(n.token)))?.find(l=>l.id===e.provider.handle)?.label;c&&this.createRemoteKernelFinder(e.provider,c)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===rc&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(f),o().catch(f)]),n.dispose()}getOrCreateRemoteKernelFinder(e,t){let n=Vt(e);if(!this.serverFinderMapping.has(n)){let i=new w_(`remote-${n}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(n,i),i.activate().then(f,f)}return this.serverFinderMapping.get(n)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let n=Vt(t),i=this.serverFinderMapping.get(n);i&&i.dispose(),this.serverFinderMapping.delete(n)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};v([Lr("Handle Jupyter Provider Changes")],hu.prototype,"handleProviderChanges",1),v([Lr("Check Servers in Jupyter Server Provider")],hu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),v([Lr("Failed to create a Remote Kernel Finder")],hu.prototype,"validateAndCreateFinder",1),hu=v([(0,ls.injectable)(),d(0,(0,ls.inject)(Zt)),d(1,(0,ls.inject)(Wc)),d(2,(0,ls.inject)(LP)),d(3,(0,ls.inject)(Mr)),d(4,(0,ls.inject)(Ke)),d(5,(0,ls.inject)(pn)),d(6,(0,ls.inject)(F)),d(7,(0,ls.inject)(at)),d(8,(0,ls.inject)(ut)),d(9,(0,ls.inject)(Qt))],hu);var pd=D(O());var Ny=require("vscode");var M_=D(Ro());var ul=D(O());var P_=class extends et{constructor(t){super("localjupyterserverconnection",b.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function Ty(r){if(Ar()){let e=r;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(n=>{n._status!==void 0&&(n._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var _y=class extends ln{constructor(e){super(e.message,e)}};var DC=require("vscode");var gf=class extends _n{constructor(e){super("invalidkernel",b.kernelInvalid(ht(e)),e)}};async function Ry(r,e,t,n,i){if(!t.kernel)throw new gf(r);let o=vt.reportProgress(e,b.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{E(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=le();i.onCancellationRequested(()=>a.reject(new DC.CancellationError),void 0,s);let c=(m,h)=>{E(`Got status ${h} in waitForIdleOnSession`),h=="idle"&&a.resolve(h)};t.kernel.statusChanged?.connect(c),s.push(new DC.Disposable(()=>On(()=>t.kernel?.statusChanged?.disconnect(c)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let l=le(),u=()=>l.resolve("");t.disposed.connect(u,l),s.push(new DC.Disposable(()=>On(()=>t.disposed.disconnect(u,l)))),l.promise.catch(f),a.promise.catch(f);let p=await xr(n,"",a.promise,l.promise);if(t.isDisposed)throw x("Session disposed while waiting for session to be idle."),new gf(r);if(E(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),p=="idle")return;throw x(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new hy(r)}catch(a){throw ne("Error waiting for idle",a),a}finally{z(s)}}var N_=require("vscode");var ll=D(T_()),R_=require("vscode");var Ay=class{constructor(e,t){this.kind=e;this.session=t;this.propertyChanged=new ll.Signal(this);this.kernelChanged=new ll.Signal(this);this.statusChanged=new ll.Signal(this);this.connectionStatusChanged=new ll.Signal(this);this.iopubMessage=new ll.Signal(this);this.unhandledMessage=new ll.Signal(this);this.anyMessage=new ll.Signal(this);this.disposables=[];this.disposed=new ll.Signal(this);this._disposed=new R_.EventEmitter;this.didShutdown=new R_.EventEmitter;this._onDidKernelSocketChange=new R_.EventEmitter;t.propertyChanged.connect(this.onPropertyChanged,this),t.kernelChanged.connect(this.onKernelChanged,this),t.statusChanged.connect(this.onStatusChanged,this),t.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.anyMessage.connect(this.onAnyMessage,this),this.disposables.push({dispose:()=>{this.didShutdown.dispose(),this._disposed.dispose(),this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get isDisposed(){return this._isDisposed===!0}get onDidDispose(){return this._disposed.event}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}async disposeAsync(){this.dispose()}dispose(){this.disposeInvoked||(this.statusChanged.emit("dead"),this._disposed.fire(),this.disposed.emit(),this.previousAnyMessageHandler?.dispose(),z(this.disposables),ll.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),ee(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let e={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:no.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(e.kernel.model)&&this.previousKernelSocketInformation?.kernel===e.kernel&&this.previousKernelSocketInformation?.kernel.id===e.kernel.id&&this.previousKernelSocketInformation?.socket===e.socket||(this.previousKernelSocketInformation=e,this.previousAnyMessageHandler?.dispose(),this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(e,t){this.propertyChanged.emit(t)}onKernelChanged(e,t){this.kernelChanged.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t);let n=this.status;ne(`Server Status = ${n}`)}onConnectionStatusChanged(e,t){this.connectionStatusChanged.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){W(`Unhandled message found: ${t.header.msg_type}`),this.unhandledMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}setPath(e){return this.session.setPath(e)}setName(e){return this.session.setName(e)}setType(e){return this.session.setType(e)}changeKernel(e){return this.session.changeKernel(e)}onKernelConnectionStatusHandler(e,t){ne(`Server Kernel Status = ${t}`)}};var A_=class extends Ay{constructor(t,n,i,o,s){super(mt(i)?"localJupyter":"remoteJupyter",t);this.resource=n;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(ne(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).catch(f)}async disposeAsync(){await this.shutdownImplementation(!1).catch(f),await super.disposeAsync()}async waitForIdle(t,n){try{await Ry(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw ne("Error waiting for idle",i),await this.shutdown().catch(f),i}}async restart(){let t=[],n=new N_.CancellationTokenSource;this.restartToken=n;let i=new Yt(!1);t.push(i),t.push(n);try{await this.validateLocalKernelDependencies(n.token,i),await super.restart()}finally{z(t)}}async validateLocalKernelDependencies(t,n){if(!(!this.kernelConnectionMetadata?.interpreter||!mt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new N_.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,n,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this._isDisposed)return;this._isDisposed=!0;let n=(new Error().stack||"").split(`
`).filter(o=>o.includes($e));E(`Shutdown session - current session, called from 
 ${n.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;E(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{E(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),Ty(this.session.kernel),this.session.isDisposed||await xr(1e3,this.session.shutdown().catch(f))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){W("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else E(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){W("Failures in disposing the session",o)}super.dispose(),E("Shutdown session -- complete")}catch(o){W("Failures in disposing the session",o)}E(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return mt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&Yi(this.resource)==="interactive"?!0:!(this.resource&&Yi(this.resource)==="notebook"&&Ft(this.kernelConnectionMetadata))}};var gu=class{constructor(e,t,n,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=n;this.kernelService=i;this.configService=o}async create(e){let t=[],n,i=()=>{e.ui.disableUI||n||(n=vt.createProgressReporter(e.resource,Ft(e.kernelConnection)?b.connectingToJupyter:b.startingJupyter),t.push(n))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=Ft(e.kernelConnection)?await ur(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await ur(e.token,this.validateLocalKernelDependencies(e));let c=xp.create(o.settings);this.asyncDisposables.push(c),s.push(new Ny.Disposable(()=>c.dispose().catch(f))),await ur(e.token,this.validateRemoteServer(e,c));let l=await this.connectToOrCreateSession({...e,contentsManager:c.contentsManager,sessionManager:c.sessionManager,kernelManager:c.kernelManager,kernelSpecManager:c.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await l.shutdown().catch(f),On(()=>l.dispose())),In.throwIfCanceled(e.token),ee(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new A_(l,e.resource,e.kernelConnection,this.kernelService,e.creator),p=l.disposed,m=()=>{c.dispose().catch(f),p.disconnect(m)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),l.disposed.connect(m);let h=u.onDidDispose(m);return this.asyncDisposables.push(h),u}catch(c){throw z(s),Ft(e.kernelConnection)?o?zo.isSelfCertsError(c)?new zo(o.baseUrl):Ac.isSelfCertsExpiredError(c)?new Ac(o.baseUrl):new Ni(o.baseUrl,e.kernelConnection.serverProviderHandle,c):c:c instanceof et?c:new P_(c)}finally{z(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new yn;if(!mt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(n){throw x("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",n),new Ni(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,n)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new Ny.CancellationError;e.kernelConnection?.interpreter&&mt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new Ny.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await ur(e.token,zw(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else E(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await Ry(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(f);if(e.token.isCancellationRequested)throw new Ny.CancellationError;return t}catch(n){let i=e.ui.disableUI?E:x;throw n instanceof et?(i("Failed to change kernel, re-throwing",n),n):(i("Failed to change kernel",n),new gf(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),n=t?.path,i=yg(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?np(e.resource):"";o=`${e.resource?vn(e.resource,a):""}-${(0,M_.default)()}${a}`}let s={path:n||yge(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await ur(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new _y(new Error("No kernel created"));return ee(b.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof _y?a:new _y(a)}}};gu=v([(0,ul.injectable)(),d(0,(0,ul.inject)(Cg)),d(1,(0,ul.inject)(pn)),d(2,(0,ul.inject)(ai)),d(3,(0,ul.inject)(KP)),d(3,(0,ul.optional)()),d(4,(0,ul.inject)(ue))],gu);function vge(){return`${vg}${(0,M_.default)()}`}function yge(r){let e=`${vge()}${(0,M_.default)()}.ipynb`;return r?`${vn(r,".ipynb")}${e}`:`${b.defaultNotebookName}${e}`}var My=class{constructor(e,t,n){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=n}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&mt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};My=v([(0,pd.injectable)(),d(0,(0,pd.inject)(fi)),d(1,(0,pd.inject)(zD)),d(1,(0,pd.optional)()),d(2,(0,pd.inject)(gu))],My);var _C=Symbol("RemoteKernelFinderController");function hH(r,e){r.add(Xv,uy),r.addSingleton(be,py),r.addSingleton(be,Zv),r.addSingleton(yp,gy),r.addSingleton(Qs,Qs),r.addSingleton(xg,dy),r.addSingleton(OP,sf),r.addSingleton(cu,cu),r.addSingleton(mi,mi),r.addSingleton(Oa,Oa),r.addSingleton(Da,Da),r.addSingleton(KP,cf),r.addSingleton(Cg,yy),r.addSingleton(bp,of),r.addSingleton(ed,of),r.addSingleton(Zt,xy),r.addSingleton(FP,Sy),r.addSingleton(dP,vy),r.addSingleton(vx,My),r.addSingleton(gu,gu),r.addSingleton(Hl,Py),r.addSingleton(Ip,ky),r.addSingleton(pn,pn),r.addSingleton(Tm,Cy),r.addBinding(Tm,be),r.addSingleton(LP,fy),r.addSingleton(en,ly),r.addSingleton(_C,hu),r.addBinding(_C,be),r.addSingleton(Qt,Pg)}var vf=D(O()),us=require("vscode");var Oy=class{constructor(e,t,n,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=n;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(us.notebooks.onDidChangeNotebookCellExecutionState(e=>{if(!Rt(e.cell.notebook)||e.state!==us.NotebookCellExecutionState.Idle)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}onDidStartKernel(e){if(!this.kernelsStartedSuccessfully.has(e)){if(this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry),!e.session?.kernel)return;this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),e.onDisposed(()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this,this.disposableRegistry),e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this,this.disposableRegistry),e.onRestarted(()=>this.kernelsRestarting.delete(e),this,this.disposableRegistry)}}onKernelStatusChanged(e,t){let n=this.kernelConnectionToKernelMapping.get(e);if(n&&!this.kernelsRestarting.has(n))switch(t){case"connected":{this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n);return}case"disconnected":{this.kernelReconnectProgress.has(n)&&(this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n),this.onKernelDisconnected(n)?.catch(f));return}case"connecting":this.kernelReconnectProgress.has(n)||this.onKernelConnecting(n)?.catch(f);return;default:return}}async onKernelConnecting(e){let t=le(),n=new us.Disposable(()=>t.resolve());if(this.kernelReconnectProgress.set(e,n),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let i=b.automaticallyReconnectingToAKernelProgressMessage(ht(e.kernelConnectionMetadata));us.window.withProgress({location:us.ProgressLocation.Notification,title:i},async()=>t.promise).then(f,f),this.disposableRegistry.push(n)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(At(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=mt(e.kernelConnectionMetadata)?b.kernelDisconnected(ht(e.kernelConnectionMetadata)):b.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);us.window.showErrorMessage(t).then(f,f);try{let n=this.lastExecutedCellPerKernel.get(e);if(!n||n.document.isClosed||n.notebook.isClosed||n.executionSummary?.success===!1)return;await gp(n,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let n=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!n)return!1;let i=new us.CancellationTokenSource;try{return(await Promise.resolve(n.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};Oy=v([(0,vf.injectable)(),d(0,(0,vf.inject)(F)),d(1,(0,vf.inject)(Ke)),d(2,(0,vf.inject)(Zt)),d(3,(0,vf.inject)(Qt))],Oy);var TC=D(O());var Ky=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=vt.createProgressReporter(e.resourceUri,b.restartingKernelStatus(ht(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};Ky=v([(0,TC.injectable)(),d(0,(0,TC.inject)(F)),d(1,(0,TC.inject)(Ke))],Ky);var RC=D(O()),NF=require("vscode");var yf=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry)}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(NF.window.showErrorMessage(b.kernelDiedWithoutError(ht(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(NF.window.showErrorMessage(b.kernelDiedWithoutErrorAndAutoRestarting(ht(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(At(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return gp(t,e.controller,b.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};v([Lr()],yf.prototype,"onKernelStatusChanged",1),yf=v([(0,RC.injectable)(),d(0,(0,RC.inject)(F)),d(1,(0,RC.inject)(Ke))],yf);var vu=D(O()),md=require("vscode");var dd=class{constructor(e,t,n,i){this.installer=e;this.memento=t;this.rawSupport=n;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!mt(t)||!ft(t)||!t.interpreter)return 0;ee(`Check & install missing Kernel dependencies for ${$(t.interpreter?.uri)}, ui.disabled=${n.disableUI} for resource '${$(e)}'`);let c=async()=>{if(await vt.wrapAndReportProgress(e,b.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let h=await c();if(h===0||h===1)return h}let l=gn(t.interpreter.uri),u=this.installPromises.get(l),p;if(!u){let h=new md.CancellationTokenSource,g=i.onCancellationRequested(()=>{h.cancel(),g.dispose()});u=vt.wrapAndReportProgress(e,b.installingMissingDependencies,async()=>{if(a){let y=await c();if(y===0||y===1)return y}return this.runInstaller(e,t.interpreter,n,h,s,a)}),u.finally(()=>{g.dispose(),h.dispose()}).catch(f),this.installPromises.set(l,u)}let m=2;try{m=await u,(p?.token?.isCancellationRequested||i.isCancellationRequested)&&(m=1)}catch(h){ne("Failed to install kernel dependency",h),m=2}finally{this.installPromises.delete(l)}return m}async areDependenciesInstalled(e,t,n){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!n&&this.rawSupport.isSupported&&await b8(this.memento,19,e.interpreter))return ee(`IPyKernel found previously in this environment ${$(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&xD(this.memento,19,e.interpreter).catch(f)},f),or(t,!1,i)}async runInstaller(e,t,n,i,o,s){if(ne(`Run Installer for ${$(e)} ui.disableUI=${n.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),n.disableUI)return 4;let a=Be(t),[c,l]=await Promise.all([x8(this.memento,19,t),a==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let u=c?b.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:b.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,p=l===!1?[19,27]:[19],m=u(jr(t)||t.uri.fsPath,p.map(U=>gr.get(U)).join(` ${ve.and} `)),h=p.map(U=>gr.get(U)).join(", "),g=e?Yi(e):void 0,y=e?await It(e.toString()):void 0;At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a});let C=ve.install,k=b.selectKernel,A=ve.moreInfo,T=[C];e&&!o&&T.push(k),T.push(A);try{(!sm()||!s)&&At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a});let U;do U=sm()||s?C:await or(i.token,md.window.showInformationMessage(m,{modal:!0},...T)),U===A&&(At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),md.env.openExternal(md.Uri.parse("https://aka.ms/AAhi594")));while(U===A);if(i.token.isCancellationRequested)return At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),1;if(U===k)return At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),3;if(U===C){At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a});let oe=await or(i.token,3,this.installer.install(19,t,i,c===!0,l===!1));if(oe===0)return At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),0;if(oe===2)return At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),2}return At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),1}catch(U){throw x(`Failed to install ${h}`,U),At(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:h,resourceType:g,resourceHash:y,pythonEnvType:a}),U}}};v([oi("Install Missing Dependencies")],dd.prototype,"installMissingDependencies",1),v([oi("Are Dependencies Installed"),d(0,Wl("id"))],dd.prototype,"areDependenciesInstalled",1),dd=v([(0,vu.injectable)(),d(0,(0,vu.inject)(Ui)),d(1,(0,vu.inject)(He)),d(1,(0,vu.named)(bt)),d(2,(0,vu.inject)(fi)),d(3,(0,vu.inject)(pt))],dd);var O_=D(O()),Ly=require("vscode");var Fy=class extends ir{constructor(t){super();this._onDidChangeRegistrations=this._register(new Ly.EventEmitter);this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=this._register(new Ly.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=this._register(new Ly.EventEmitter);t.push(this),this._register(this._onDidChangeStatus),this._register(this._onDidChangeRegistrations)}get status(){return this._status}set status(t){this._status!=t&&(this._status=t,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(t){this._finders.push(t);let n=()=>{this.status=this._finders.every(s=>s.status==="idle")?"idle":"discovering"};n();let i=this._register(new ci),o=()=>{let s=this._finders.findIndex(a=>a===t);s>=0&&this._finders.splice(s,1),i.dispose(),n(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[t]})};return i.add(t.onDidChangeStatus(n,this)),i.add(t.onDidChangeKernels(()=>this._onDidChangeKernels.fire())),i.add(t.onDidDispose(()=>o())),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[t],removed:[]}),new Ly.Disposable(()=>o())}get kernels(){let t=[];this.connectionFinderMapping.clear();let n=new Set;this._finders.filter(o=>o.kind==="localPythonEnvironment").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&n.add(s.kernelSpec.specFile),t.push(s),this.connectionFinderMapping.set(s.id,o)})}),this._finders.filter(o=>o.kind==="localKernelSpec").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&n.has(s.kernelSpec.specFile)||(t.push(s),this.connectionFinderMapping.set(s.id,o))})});let i=this._finders.filter(o=>o.kind==="remote");for(let o of i){let s=o.kernels;s.forEach(a=>{this.connectionFinderMapping.set(a.id,o)}),t.push(...s)}return t}getFinderForConnection(t){return this.connectionFinderMapping.get(t.id)}get registered(){return this._finders}};Fy=v([(0,O_.injectable)(),d(0,(0,O_.inject)(F))],Fy);var mn=D(O());var gi=require("vscode");var K_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new gi.EventEmitter;this._onDidStartKernel=new gi.EventEmitter;this._onDidCreateKernel=new gi.EventEmitter;this._onDidDisposeKernel=new gi.EventEmitter;this._onKernelStatusChanged=new gi.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),gi.workspace.onDidCloseNotebookDocument(n=>this.disposeOldKernel(n),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){let e=new Set;return gi.workspace.notebookDocuments.forEach(t=>{let n=this.get(t);n&&e.add(n)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){if(Jn(e)){let t=gi.workspace.notebookDocuments.find(n=>n.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){ne("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByNotebook.set(e,{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),E(`Kernel got disposed, hence there is no longer a kernel associated with ${$(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByNotebook.get(e);t&&(E(`Disposing kernel associated with ${$(e.uri)}, isClosed=${e.isClosed}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>W("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){gi.workspace.notebookDocuments.forEach(t=>{let n=this.kernelsByNotebook.get(t);if(n){let i=n.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(n.kernel.id))}})}},F_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new gi.EventEmitter;this._onDidStartKernel=new gi.EventEmitter;this._onDidCreateKernel=new gi.EventEmitter;this._onDidDisposeKernel=new gi.EventEmitter;this._onKernelStatusChanged=new gi.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),gi.workspace.onDidCloseNotebookDocument(n=>{E(`Notebook document ${$(n.uri)} got closed`),this.disposeOldKernel(n.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){ne("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByUri.set(e.toString(),{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),E(`Kernel got disposed, hence there is no longer a kernel associated with ${$(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(ne(`Disposing kernel associated with ${$(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>W("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByUri.delete(e.toString())}};var OF=D(Ro()),zr=require("vscode");var yH=D(sD());var MF="KERNEL_INFO",bge=1e3*60*60*24*2;async function vH(r,e,t){let n=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!r.kernel)return;r.kernel?.info&&(n.push(r.kernel.info),r.kernel.info.then(a=>gH(t,e,a)).catch(f));let o=r.kernel.requestKernelInfo().then(a=>a?.content);if(n.push(o),o.then(a=>gH(t,e,a)).catch(f),e.kind==="connectToLiveRemoteKernel"){let a=Ige(t,e);a?n.push(Promise.resolve(a)):n.push(Ci(5e3).then(()=>i))}let s=await Promise.race(n);return s===i?W("Failed to Kernel info in a timely manner, defaulting to empty info!"):E("Got Kernel info"),s}async function gH(r,e,t){if(!t||!Ft(e))return;let n=r.get(MF,[]).filter(i=>Date.now()-i.age<bge).filter(i=>i.id!==e.id);n.push({id:e.id,age:Date.now(),info:t}),await r.update(MF,n)}function Ige(r,e){if(Ft(e))return r.get(MF,[]).find(t=>t.id===e.id)?.info}var L_=class extends _n{constructor(e){super("kernelpromisetimeout",b.interruptingKernelFailed,e)}};var U_="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function B_(r){let e=typeof r=="string"?r:"";return typeof r!="string"&&"content"in r&&"code"in r.content&&typeof r.content.code=="string"&&(e=r.content.code),!e.includes(U_)}function q_(r){return r.status==="dead"||r.status==="terminating"&&!r.disposed&&!r.disposing||!r.disposed&&!r.disposing&&(r.session?.status=="unknown"||r.session?.kernel?.status=="unknown")&&(r.session.kernel?.isDisposed||r.session.isDisposed)}function bH(r){return r.status==="dead"||r.status==="terminating"&&!r.isDisposed||!r.isDisposed&&(r.status=="unknown"||r.kernel?.status=="unknown")&&(r.kernel?.isDisposed||r.isDisposed)}var j_=class{constructor(e,t,n,i,o,s,a,c,l){this.id=e;this.uri=t;this.resourceUri=n;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=c;this.workspaceMemento=l;this.disposables=[];this._onIPyWidgetVersionResolved=new zr.EventEmitter;this._onDidKernelSocketChange=new zr.EventEmitter;this._onStatusChanged=new zr.EventEmitter;this._onRestarted=new zr.EventEmitter;this._onStarted=new zr.EventEmitter;this._onDisposed=new zr.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new zr.CancellationTokenSource;this.startupUI=new Yt(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),ro(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(f),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||ro(this.resourceUri,{disableUI:!1}).catch(f)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,n,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=n?t.bind(n):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){return this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new zr.CancellationTokenSource),this.startJupyterSession(e)}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(n=>n()));ee(`Interrupt requested ${$(this.resourceUri||this.uri)}`);let t;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;ee("Interrupt kernel execution"),n?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(n,e)),this._interruptPromise=void 0):(ee("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(n=>n())).catch(f)}if(ee(`Interrupt requested & sent for ${$(this.uri)} in notebookEditor.`),t==="timeout"){let n=b.restartKernelAfterInterruptMessage(ht(this.kernelConnectionMetadata)),i=b.restartKernelMessageYes;await zr.window.showInformationMessage(n,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(ee(`Dispose Kernel '${$(this.uri)}' associated with '${$(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(n=>n())).then(f).catch(f)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._session&&(t.push(this._session.disposeAsync().catch(f)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),z(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=Yi(this.resourceUri);ee(`Restart requested ${$(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(n=>n(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new Je;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;n?(this._restartPromise||(this._restartPromise=n.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(f)),await this._restartPromise,this.startCancellation=new zr.CancellationTokenSource):await this.start(new Yt(!1)),At(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(n){x(`Restart failed ${$(this.uri)}`,n),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,At(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,n),await i?.disposeAsync().catch(f),this._ignoreJupyterSessionDisposedErrors=!1,n}await this.initializeAfterStart(this._session),this._onRestarted.fire()}catch(e){throw x(`Failed to restart kernel ${$(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(f)}}async startJupyterSession(e=new Yt(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)}),this.startupUI.disableUI?this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||as(this.resourceUri,this.kernelConnectionMetadata).catch(f)},this,this.disposables):await as(this.resourceUri,this.kernelConnectionMetadata),this.disposing)throw new zr.CancellationError;if(In.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new Je;if(await ro(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator}),this.disposing)throw new zr.CancellationError;In.throwIfCanceled(this.startCancellation.token),this._jupyterSessionPromise=this.createJupyterSession().then(n=>(At(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),n)).catch(n=>{throw ne(`Failed to create Jupyter Session in Kernel.startNotebook for ${$(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,n})}return this._jupyterSessionPromise.finally(()=>this.sendKernelStartedTelemetry()).catch(f),this._jupyterSessionPromise}async interruptExecution(e,t){let n=le(),i=new Je,o=[],s=l=>{(l==="restarting"||l==="autorestarting")&&(W("Kernel restarting during interrupt"),n.resolve(!0))},a=(l,u)=>s(u);return e.statusChanged.connect(a),o.push(new zr.Disposable(()=>On(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(ee(`Interrupting kernel: ${e.kernel.name}`),await Ch(this.kernelSettings.interruptTimeout,new L_(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(l=>{W(`Error during interrupt: ${l}`),n.resolve(!0)})),(async()=>{let l=le();this.status==="busy"&&(this.onDisposed(()=>l.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?l.resolve("dead"):void 0,this,o));try{return await xr(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),n.promise.then(()=>"restart"),l.promise)}catch(u){if(n.completed)return"restart";throw At(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{z(o)}})().then(l=>(At(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:l}),l))}async createJupyterSession(){if(this.disposing)throw new zr.CancellationError;In.throwIfCanceled(this.startCancellation.token);let e=[];try{let t="",n=this.kernelConnectionMetadata.interpreter;if(n){let o=[];o.push(`Python Path: ${$(n.uri)}`),o.push(n?Be(n):""),o.push(jr(n)||"");let s=Gi(n);s&&o.push(`${s.major}.${s.minor}.${s.micro}`),t=` (${o.filter(a=>a).join(", ")})`}ee(`Starting Kernel ${this.kernelConnectionMetadata.kind}, ${this.kernelConnectionMetadata.id} ${t} for '${$(this.uri)}' (disableUI=${this.startupUI.disableUI})`),this.createProgressIndicator(e),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new zr.CancellationError;if(In.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new zr.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),i}catch(t){if(this.startupUI.disableUI?E(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t):!this.startCancellation.token&&!hr(t)&&x(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t),In.throwIfCanceled(this.startCancellation.token),t instanceof As)throw t;let n=b.sessionStartFailedWithKernel(ht(this.kernelConnectionMetadata));throw ln.from(n+" "+("message"in t?t.message:t.toString()),t)}finally{z(e)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,At(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=vt.createProgressReporter(this.resourceUri,b.connectingToKernel(ht(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(t=>t(e,this.startCancellation.token).catch(f))),E(`Started running kernel initialization for ${$(this.uri)}`),!e){E("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(n=>this._onDidKernelSocketChange.fire(n)),e.onDidDispose(()=>{if(ne(`Kernel got disposed as a result of session.onDisposed (1) ${$(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){ee(`Kernel got disposed as a result of session.onDisposed ${$(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let n=this._session===e;this._jupyterSessionPromise=void 0,this._session=void 0,n&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let t=(n,i)=>this._onStatusChanged.fire(i);e.statusChanged.connect(t),this.disposables.push(new zr.Disposable(()=>On(()=>e.statusChanged.disconnect(t))))}if(e.kernel?.registerCommTarget(Qe.DefaultCommTarget,f),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(t=>x("Failed to determine IPyWidget version",t)),this.gatherInternalStartupCode().then(t=>this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(t=>x("Failed to execute internal startup code",t));else{await this.determineVersionOfIPyWidgets(e);let t=await this.gatherInternalStartupCode();await this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}try{E("Requesting Kernel info"),this._info=await vH(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(t){W("Failed to request KernelInfo",t)}this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(E("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),E("End running kernel initialization, session is idle"))}async determineVersionOfIPyWidgets(e){if(!ft(this.kernelConnectionMetadata)){this._ipywidgetsVersion==KS,this._onIPyWidgetVersionResolved.fire(KS);return}let t=async()=>{let n=yH.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${U_}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[n]).catch(o=>x("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(c=>(c.text||"")?.toString().includes(`${U_}8.`)),s=i.some(c=>(c.text||"")?.toString().includes(`${U_}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;E(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else W("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let n=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[qi]||"target_name"in s.content&&s.content.target_name===Qe.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(f),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(n,this)))};this.session.kernel.anyMessage.connect(n,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((n,i)=>i.priority-n.priority).map(n=>n.getCode(this)));for(let n of t)e.push(...n);if(ft(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let n=Te(this.resourceUri);n&&e.push(`__vsc_ipynb_file__ = "${n.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(nc.DisableJedi),e.push(...Sge(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){ne(`Initialize config for plots for ${$(this.resourceUri||this.uri)}`);let t=nc.MatplotLibInit;E(`Initialize matplotlib for ${$(this.resourceUri||this.uri)}`),e.push(...Fe(t,{trim:!1}));let n=zr.window.activeColorTheme.kind===zr.ColorThemeKind.Dark;e.push(n?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Qe.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return Fe(t,{trim:!1})}return[]}async executeSilently(e,t,n){if(t.join("").trim().length!==0){if(!e.kernel){E(`Not executing startup as there is no session, code: ${t}`);return}return bn(e.kernel,t.join(`
`),n)}}},W_=class extends j_{get creator(){return"3rdPartyExtension"}constructor(e,t,n,i,o,s,a){super(`3rdPartyKernel_${(0,OF.default)()}`,e,t,n,i,o,s,"3rdPartyExtension",a)}},V_=class extends j_{constructor(t,n,i,o,s,a,c,l){super((0,OF.default)(),n.uri,t,i,o,s,c,"jupyterExtension",l);this.notebook=n;this.controller=a}get creator(){return"jupyterExtension"}};function Sge(r,e){return!r||r.length===0||(r=r.map(t=>`    ${t}`),r.unshift("try:"),r.push("except:",`    print('${e}')`)),r}function J_(r){if(r.length>0){let e=r[0].data;if(e&&e.hasOwnProperty("text/plain"))return Us(e["text/plain"]);if(r[0].output_type==="stream"){let t=r[0];return Us(t.text)}}}function KF(r,e){return{get enableExtendedPythonKernelCompletions(){return r.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return r.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return r.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return r.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return r.getSettings(e).themeMatplotlibPlots}}}var ps=require("vscode");var La=require("vscode");var FF=D(FN()),Tr=require("vscode");var io=require("vscode"),$_=class{addFailureDiagnostic(e,t,n){if(!this.shouldAddDiagnostics())return;let{range:i,executionCount:o}=this.parseStackTrace(e,n);if(i&&t.content.ename!=="KeyboardInterrupt"){let s=io.languages.createDiagnosticCollection("cellFailure");s.set(n.document.uri,[{code:"",message:`${t.content.ename}: ${t.content.evalue}`,range:i,severity:io.DiagnosticSeverity.Error,source:"Cell Execution Failure",relatedInformation:[]}]);let a=[];a.push(io.workspace.onDidChangeNotebookDocument(c=>{if(c.notebook.uri.toString()===n.notebook.uri.toString())for(let l of c.cellChanges)l.cell.document.uri.toString()===n.document.uri.toString()&&l.executionSummary?.executionOrder&&l.executionSummary.executionOrder!==o&&(s.clear(),a.forEach(u=>u.dispose()))})),a.push(io.workspace.onDidChangeTextDocument(c=>{c.document.uri.toString()===n.document.uri.toString()&&(s.clear(),a.forEach(l=>l.dispose()))}))}}shouldAddDiagnostics(){let e="github.copilot",t=io.extensions.getExtension(e);return io.workspace.getConfiguration("jupyter").get("experimental.cellFailureDiagnostics.enabled")&&t?.isActive}parseStackTrace(e,t){let n=/(?<prefix>Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*)(?<lineLabel>line (?<lineNumber>\d+)).*/,i=/(?<prefix>Input\s+?(?:\u001b\[.+?m)(?<cellLabel>In\s*\[(?<executionCount>\d+)\]))(?<postfix>.*)/,o,s;for(let c of e){let l=n.exec(c)??i.exec(c);if(l&&l.groups){o=parseInt(l.groups.lineNumber),s=parseInt(l.groups.executionCount);break}}let a;if(o&&o>0&&o<=t.document.lineCount){let c=t.document.lineAt(o-1),l=c.text.split("#")[0].trimEnd().length;a=new io.Range(new io.Position(c.lineNumber,c.firstNonWhitespaceCharacterIndex),new io.Position(c.lineNumber,l))}return{range:a,executionCount:s}}};var Uy=new WeakMap;function yu(r){if(r.parent_header&&"msg_id"in r.parent_header)return r.parent_header.msg_id}var fd=class fd{constructor(e,t,n,i,o,s,a,c){this.cell=e;this.controller=t;this.context=n;this.formatters=i;this.kernel=o;this.request=s;this.failureDiagostics=new $_;this._onErrorHandlingIOPubMessage=new Tr.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=le();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(f),this.executeRequestMessageId=c,this.ownedRequestMsgIds.add(c),Tr.workspace.onDidChangeNotebookDocument(l=>{if(!Rt(l.notebook))return;let u=l.cellChanges.find(({cell:p})=>p===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=l=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(l)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(f))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,St(this.cell,"Execution Message Handler disposed"),z(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:n}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=yu(n);i.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),n.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(n)&&n.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,c=typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type==="interrupt_request",l=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],p="msg_type"in n&&typeof n.msg_type=="string"&&u.includes(n.msg_type);if(!this.completedExecution&&l)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(p||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),c?1e3:100),this.disposables.push(new Tr.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(n)&&this.ownedCommIds.has(n.content.comm_id)&&this.ownedRequestMsgIds.add(n.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(n){x("Failed to handle iopub message as a result of some comm message",t,n),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(n)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(){if(this.cell.document.isClosed)return;let e=Uy.get(this.cell.notebook);return e||(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=Ri.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),E(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let n=e;this.handleStatusMessage(n)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||W(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Qe.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let n="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||n&&this.ownedRequestMsgIds.has(n.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let n="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return W("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(n))return W(`Came across a comm update message a child that start start with ${n}`,i);let o=i.substring(n.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(St(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(f,f),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&qi in e.data){let c=e.data[qi];if(c&&this.context.extensionMode===Tr.ExtensionMode.Test&&(c._vsc_test_cellIndex=this.cell.index),c&&"model_id"in c){let l=fd.modelIdsOwnedByCells.get(this.cell)||new Set;l.add(c.model_id),fd.modelIdsOwnedByCells.set(this.cell,l)}}let n=bo(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;St(this.cell,()=>`Update output with mimes ${n.items.map(c=>c.mime).toString()}`);let o=this.execution||this.createTemporaryTask();this.clearOutputIfNecessary(o),i&&tn.trackOutputByDisplayId(this.cell,i,n,n.items),this.clearLastUsedStreamOutput(),St(this.cell,"Append output in addToCellData");let s=!0,a=yu(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&n.items.every(c=>this.canMimeTypeBeRenderedByWidgetManager(c))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:n},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([n]).then(f,f),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===qi){let n=JSON.parse(new TextDecoder().decode(e.data));return!(typeof n.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(n.model_id))}return!t.startsWith("application/vnd")}updateJupyterOutputWidgetWithOutput(e,t){let n=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:n;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(C=>fd.modelIdsOwnedByCells.get(C)?.has(s));if(!a){W(`Unable to find a cell that owns the model ${s}`);return}let c=a.outputs.find(C=>C.items.find(k=>{if(k.mime!==qi)return!1;try{return JSON.parse(new TextDecoder().decode(k.data)).model_id===s}catch(A){W("Failed to deserialize the widget data",A)}return!1}));if(!c)return;let l=fd.outputsOwnedByWidgetModel.get(s)||new Set,p=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let m=a.outputs.slice().filter(C=>p?!l.has(C.id):!0),h=m.slice(0,m.indexOf(c)+1),g=m.slice(m.indexOf(c)+1);fd.outputsOwnedByWidgetModel.set(s,l),o&&l.add(o.id);let y=o?h.concat(o).concat(g):h.concat(g);return g.length===0&&o?t?.appendOutput(o,a).then(f,f):p&&!o&&g.length===0||t?.replaceOutput(y,a).then(f,f),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new Tr.CancellationTokenSource;this.prompts.add(t);let n=e.content.password!==null&&e.content.password;await Tr.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:n},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"})},f),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(n=>{n.source&&n.source==="set_next_input"&&"text"in n&&"replace"in n&&this.handleSetNextInput(n),n.data&&n.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:n.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new Tr.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new Tr.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{St(this.cell,"Create new cell after current");let n=new Tr.NotebookCellData(Tr.NotebookCellKind.Code,e.text,this.cell.document.languageId);n.outputs=[],n.metadata={};let i=Tr.NotebookEdit.insertCells(this.cell.index+1,[n]);t.set(this.cell.notebook.uri,[i])}Tr.workspace.applyEdit(t).then(f,f)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){St(this.cell,`Kernel switching to ${e.content.execution_state}`)}handleStreamMessage(e){if(yu(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==yu(e))return;St(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.execution||this.createTemporaryTask(),n=e.content.name==="stdout"?Tr.NotebookCellOutputItem.stdout("").mime:Tr.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===n)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=bo({output_type:"stream",name:e.content.name,text:e.content.text});St(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(f,f)}else if(i){let o=Us(e.content.text),s=bo({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},St(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(f,f)}else{let o=i9(Us(e.content.text)),s=bo({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},St(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(f,f)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:yx(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===yu(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.execution||this.createTemporaryTask();this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.execution||this.createTemporaryTask();this.clearLastUsedStreamOutput(),t?.clearOutput().then(f,f),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;ne(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),ne(`Traceback for error after formatting ${t}`);let n={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};if(this.cell.notebook.notebookType!=="interactive"){let i=Ri.get(this.cell);i&&e.content.ename!=="KeyboardInterrupt"&&(i.errorInfo={message:`${e.content.ename}: ${e.content.evalue}`,location:this.failureDiagostics.parseStackTrace(e.content.traceback,this.cell).range,uri:this.cell.document.uri,stack:e.content.traceback.join(`
`)})}this.addToCellData(n,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){W("Update display data message received, but no display id",e.content);return}let n=tn.getMappedOutput(this.cell.notebook,t);if(!n){E("Update display data message received, but no output found to update",e.content);return}if(n.cell.document.isClosed){W("Update display data message received, but output cell is closed",e.content);return}let i=jN(new Tr.NotebookCellOutput(n.outputItems,n.outputContainer.metadata)),o=bo({...i,data:e.content.data,metadata:e.content.metadata});if(n.outputItems.length===0&&o.items.length===0){E("Update display data message received, but no output to update",e.content);return}let s=!1;if(n.outputItems.length===o.items.length){let c=!0;if((0,FF.default)(n.outputContainer.metadata||{},o.metadata||{})||(s=!0,c=!1),c){for(let l=0;l<n.outputItems.length;l++)if(!(0,FF.default)(n.outputItems[l],o.items[l])){c=!1;break}}if(c){E("Update display data message received, but no output to update (data is the same)",e.content);return}}let a=this.execution||this.createTemporaryTask();if(St(this.cell,`Replace output items in display data ${o.items.length}`),s){let c=n.cell.outputs.map(l=>{let u=jN(l);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:l});a?.replaceOutput(c,n.cell).then(f,f),tn.trackOutputByDisplayId(n.cell,t,o,o.items)}else a?.replaceOutputItems(o.items,n.outputContainer).then(f,f),tn.trackOutputByDisplayId(n.cell,t,n.outputContainer,o.items);this.endTemporaryTask()}};v([Lr()],fd.prototype,"handleReply",1);var AC=fd;var hd=class extends Error{constructor(t){super(t.evalue||t.ename);this.ename=t.ename,this.evalue=t.evalue,this.traceback=t.traceback}};var H_=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,n,i){return LF.fromCell(e,t,n,this.controller,this.requestListener,i)}},LF=class r{constructor(e,t,n,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=n;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=le();this.cancelHandled=!1;this.disposables=[];this._preExecuteEmitter=new La.EventEmitter;if(La.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){ee(`Disposing request as the cell (${this.cell.index}) was deleted ${$(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(c){x(`Error during cell execution dispose: ${c}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),Jl.setCellState(e,La.NotebookCellExecutionState.Idle),this.canExecuteCell())this.execution=Ri.getOrCreate(e,this.controller,!s?.msg_id),Jl.setCellState(e,La.NotebookCellExecutionState.Pending);else{let a=Ri.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get preExecute(){return this._preExecuteEmitter.event}static fromCell(e,t,n,i,o,s){return new r(e,t,n,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){St(this.cell,"Not starting as it was cancelled");return}if(St(this.cell,"Start execution"),ne(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(f,f),this.completedWithErrors(new yn),this.result):this.started?(St(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),x(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,Uy.set(this.cell.notebook,this.execution),Jl.setCellState(this.cell,La.NotebookCellExecutionState.Executing),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(f),this.result)}async resume(e,t){if(this.cancelHandled){St(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(St(this.cell,"Start resuming execution"),ne(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(x(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,Uy.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),Jl.setCellState(this.cell,La.NotebookCellExecutionState.Executing),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(n=>{x(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,n),this.completedWithErrors(n.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(f),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){St(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(f);return}this.cancelHandled||this._completed||(St(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,St(this.cell,"Execution disposed"),z(this.disposables))}completedWithErrors(e,t,n=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?W("Cell completed with errors",e):W(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),St(this.cell,"Completed with errors"),n){let i,o;e&&!(e instanceof et)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&bH(this.session)&&(e=new yn),e&&(e instanceof et?i=vm(La.workspace.workspaceFolders||[],e,ht(this.kernelConnection),Jh(this.kernelConnection.interpreter))?.message:i=e.message||e.name||e.stack),o=zh(i||""),o&&this.execution?.appendOutput(o).then(f,f)}this.endCellTask("failed",t),St(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){St(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),St(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}Uy.get(this.cell.notebook)===this.execution&&Uy.set(this.cell.notebook,void 0),Jl.setCellState(this.cell,La.NotebookCellExecutionState.Idle),this.execution=void 0}}completedDueToCancellation(){St(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),St(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(St(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(f,f)),St(this.cell,"Empty cell execution"),this.completedSuccessfully();let n={cellId:this.cell.document.uri.toString(),...Pm(this.cell).metadata},i=t.kernel;try{this._preExecuteEmitter.fire(this.cell),E(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,n),this.request.done.then(f,f)}catch(o){return x(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{x(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{St(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();St(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new hd(o.content),s,!1):this.completedSuccessfully(s),St(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&x("Error in waiting for cell to complete",o),St(this.cell,"Some other execution error"),o&&o instanceof Error&&hr(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var IH=require("vscode");var G_=class{constructor(e,t,n,i){this.controller=e;this.context=t;this.formatters=n;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;IH.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){z(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new AC(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,n),n}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new AC(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,n),n}};var UF=require("vscode");var z_=require("vscode");function pl(r,e,t){r!==$e&&E(`Execution Id:${e}. ${t}.`)}var SH=new Map,jy=class r{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new z_.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new z_.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new z_.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=le();this.cancelHandled=!1;this.disposables=[];let n=SH.get(t)||0;n+=1,SH.set(t,n),this.executionId=`${t}-${n}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new r(e,t)}async start(e){if(this.session=e,this.cancelHandled){pl(this.extensionId,this.executionId,"Not starting as it was cancelled");return}if(pl(this.extensionId,this.executionId,"Start Code execution"),ne(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new yn);return}if(this.started)return pl(this.extensionId,this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),x(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(f)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){pl(this.extensionId,this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&this.extensionId!==$e&&await e.interrupt().catch(f),this.request?.dispose(),await this.request?.done.catch(f)}this.cancelHandled||this._completed||(pl(this.extensionId,this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||pl(this.extensionId,this.executionId,"Execution disposed"),z(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}pl(this.extensionId,this.executionId,"Send code for execution");let n=t.kernel;try{this.started=!0,this._onRequestSent.fire(),pl(this.extensionId,this.executionId,"Execution Request Sent to Kernel"),this.request=b9(n,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(f,f)}catch(i){x(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(pl(this.extensionId,this.executionId,"Executed with errors"),this._done.reject(new hd(i.content))):(pl(this.extensionId,this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&x(`Error in waiting for code ${this.executionId} to complete`,i),this._done.reject(i)}}};var Q_=class{constructor(e,t,n,i){this.session=e;this.executionFactory=t;this.metadata=n;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this._onPreExecute=new UF.EventEmitter;this._onPostExecute=new UF.EventEmitter;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}get onPreExecute(){return this._onPreExecute.event}get onPostExecute(){return this._onPostExecute.event}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,n){return this.enqueue({code:e,extensionId:t,token:n})}enqueue(e){let t;if("cell"in e){let{cell:n,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===n);if(o)return St(n,"Use existing cell execution"),o;let s=this.executionFactory.create(n,i,this.metadata);t=s,this.disposables.push(s),s.preExecute(a=>this._onPreExecute.fire(a),this,this.disposables),this.queueOfItemsToExecute.push(s),St(n,"User queued cell for execution")}else{let{code:n,extensionId:i,token:o}=e,s=jy.fromCode(n,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(ka(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){St(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),St(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,E("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,E("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(n=>e===n.cell):this.queueOfItemsToExecute;await Promise.all(t.map(n=>n.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(f),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){x("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(n=>n.type==="cell"&&St(n.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let n=this.queueOfItemsToExecute[0];this.lastCellExecution=n,n.type==="cell"&&St(n.cell,"Before Execute individual cell");let i=!0;try{n.type==="cell"&&n.cell.notebook.isClosed?e=!0:n.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await n.start(t).then(()=>!0).catch(()=>!1))}finally{n.type==="cell"&&St(n.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(n);s>=0&&this.queueOfItemsToExecute.splice(s,1),n.type==="cell"&&this._onPostExecute.fire(n.cell)}let o=!1;if(n.type==="cell"&&Pm(n.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){W(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)W(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){W(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,W("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var Y_=class{constructor(e,t,n,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this._onPreExecute=new ps.EventEmitter;this.onPreExecute=this._onPreExecute.event;this._onPostExecute=new ps.EventEmitter;this.onPostExecute=this._onPostExecute.event;this.documentExecutions=new WeakMap;this._onDidReceiveDisplayUpdate=new ps.EventEmitter;this.onDidReceiveDisplayUpdate=this._onDidReceiveDisplayUpdate.event;this.hookedSesions=new WeakSet;let o=new G_(e.controller,t,n,i);this.disposables.push(o),this.executionFactory=new H_(e.controller,o),ps.notebooks.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===ps.NotebookCellExecutionState.Idle&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),e.onStatusChanged(this.hookupIOPubHandler,this,this.disposables),e.onRestarted(this.hookupIOPubHandler,this,this.disposables),this.hookupIOPubHandler(),this.disposables.push(this._onPreExecute)}get executionCount(){return this._visibleExecutionCount}hookupIOPubHandler(){let e=this.kernel.session;if(!e||this.hookedSesions.has(e))return;this.hookedSesions.add(e);let t=(n,i)=>{if(i.header.msg_type!=="update_display_data"&&i.header.msg_type!=="display_data")return;let o=i,s=o.content.transient?.display_id;if(!s||!k9(e,s))return;let a=bo({output_type:"display_data",data:o.content.data,metadata:o.content.metadata,transient:o.content.transient});this._onDidReceiveDisplayUpdate.fire(a)};e.iopubMessage.connect(t),this.disposables.push({dispose:()=>{e?.iopubMessage.disconnect(t)}})}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(St(e,`NotebookKernelExecution.resumeCellExecution (start), ${$(e.notebook.uri)}`),e.kind==ps.NotebookCellKind.Markup)return;await as(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata),At(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let n=this.kernel.start(new Yt(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,n);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);St(e,`NotebookKernelExecution.resumeCellExecution (completed), ${$(e.notebook.uri)}`),E(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){St(e,`NotebookKernelExecution.executeCell (1), ${$(e.notebook.uri)}`);let n=new Je;if(e.kind==ps.NotebookCellKind.Markup)return;St(e,`NotebookKernelExecution.executeCell, ${$(e.notebook.uri)}`),await as(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let i=this.kernel.start(new Yt(!1));await this.kernel.restarting,St(e,`NotebookKernelExecution.executeCell (2), ${$(e.notebook.uri)}`);let o=this.getOrCreateCellExecutionQueue(e.notebook,i);o.queueCell(e,t);let s=!0;try{await o.waitForCompletion(e)}catch(a){throw s=!1,a}finally{St(e,`NotebookKernelExecution.executeCell completed (3), ${$(e.notebook.uri)}`),E(`Cell ${e.index} executed ${s?"successfully":"with an error"}`),At(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:n.elapsedTime})}}async*executeCode(e,t,n,i){let o=new Je;await as(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let s=this.kernel.start(new Yt(!1));await this.kernel.restarting;let a=this.getOrCreateCellExecutionQueue(this.notebook,s),c;t===$e?(c=jy.fromCode(e,t),s.then(g=>c.start(g))):c=a.queueCode(e,t,i),t!==$e&&E(`Queue code ${c.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let l=!1,u=[];c.result.finally(()=>{l=!0,!i.isCancellationRequested&&ee(`Execution of code ${c.executionId} completed in ${o.elapsedTime}ms`),t!==$e&&At(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),z(u)}).catch(f);let p=Es(c.result),m=[],h=le();for(u.push(c.onRequestSent(()=>n.started.fire())),u.push(c.onRequestAcknowledged(()=>n.executionAcknowledged.fire())),c.onDidEmitOutput(g=>{m.push(g),h.resolve(),h=le()},this,u),i.onCancellationRequested(()=>{l||E(`Code execution cancelled by extension ${t}`)},this,u);;){await Promise.race([h.promise,p.promise]),l&&(h=le());let g=this.kernel.session;for(;m.length;){let y=m.shift();g&&TP(t,g,y),yield y}if(p.completed)break}}executeHidden(e){return this.kernel.start().then(n=>n.kernel?bn(n.kernel,e):Promise.reject(new yn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(ee("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(f)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),n=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(f)):Promise.resolve();n||(ee("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let n=this.documentExecutions.get(e);if(n&&!n.isEmpty&&!n.failed)return n;let i=new Q_(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),ps.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(E(`Cancel executions after closing notebook ${$(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),i.onPreExecute(o=>this._onPreExecute.fire(o),this,this.disposables),i.onPostExecute(o=>this._onPostExecute.fire(o),this,this.disposables),this.documentExecutions.set(e,i),i}};var Wy=class extends K_{constructor(t,n,i,o,s,a,c,l,u){super(t,n);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=c;this.startupCodeProviders=l;this.workspaceStorage=u;n.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t.notebookType===yt?n.resourceUri:t.uri,s=KF(this.configService,o),a=t.uri.path.endsWith(".interactive")||n.resourceUri?.path.endsWith(".interactive")?yt:xt,c=new V_(o,t,n.metadata,this.sessionCreator,s,n.controller,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.executions.set(c,new Y_(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(c),c}};Wy=v([(0,mn.injectable)(),d(0,(0,mn.inject)(ai)),d(1,(0,mn.inject)(F)),d(2,(0,mn.inject)(vx)),d(3,(0,mn.inject)(ue)),d(4,(0,mn.inject)(ut)),d(5,(0,mn.inject)(Zt)),d(6,(0,mn.multiInject)(lg)),d(7,(0,mn.inject)(Go)),d(8,(0,mn.inject)(He)),d(8,(0,mn.named)(si))],Wy);var Vy=class extends F_{constructor(t,n,i,o,s,a){super(t,n);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=KF(this.configService,o),a=o.path.endsWith(".interactive")?yt:xt,c=new W_(t,o,n.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(t,c),c}};Vy=v([(0,mn.injectable)(),d(0,(0,mn.inject)(ai)),d(1,(0,mn.inject)(F)),d(2,(0,mn.inject)(vx)),d(3,(0,mn.inject)(ue)),d(4,(0,mn.inject)(Go)),d(5,(0,mn.inject)(He)),d(5,(0,mn.named)(si))],Vy);var bf=D(O()),bu=require("vscode");var By=class{constructor(e,t,n,i){this.extensionChecker=t;this.interpreterService=n;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();E(`Start refreshing Kernel Picker (${t})`);let n=bu.notebooks.createNotebookControllerDetectionTask(xt),i=bu.notebooks.createNotebookControllerDetectionTask(yt);this.disposables.push(n),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(E(`End refreshing Kernel Picker (${t})`),n.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;bu.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&Rt(o.notebook)&&(e=!0,E("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables),bu.workspace.onDidOpenNotebookDocument(o=>{!e&&Rt(o)&&(e=!0,E("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables);let t,n="",i=()=>(t&&!t.isDisposed||(n=Date.now().toString(),E(`Start refreshing Kernel Picker (${n})`),t=new ci(bu.notebooks.createNotebookControllerDetectionTask(xt),bu.notebooks.createNotebookControllerDetectionTask(yt)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(E(`End refreshing Kernel Picker (${n})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(E(`End refreshing Kernel Picker (${n})`),t?.dispose()):i()},this,this.disposables)}};By=v([(0,bf.injectable)(),d(0,(0,bf.inject)(F)),d(1,(0,bf.inject)(Ye)),d(2,(0,bf.inject)(st)),d(3,(0,bf.inject)(Mr))],By);var xH=D(O());var qy=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};qy=v([(0,xH.injectable)()],qy);var NC=D(O());var Jy=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await F$(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};Jy=v([(0,NC.injectable)(),d(0,(0,NC.inject)(Ke)),d(1,(0,NC.inject)(F))],Jy);var MC=D(O());var CH=require("vscode");var $y=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=vt.createProgressReporter(e.resourceUri,b.restartingKernelStatus(`: ${ht(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new ci,n=setTimeout(()=>{t.isDisposed||t.add(vt.createProgressReporter(e.resourceUri,b.interruptKernelStatus(ht(e.kernelConnectionMetadata))))},1e3);t.add(new CH.Disposable(()=>clearTimeout(n))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};$y=v([(0,MC.injectable)(),d(0,(0,MC.inject)(Ke)),d(1,(0,MC.inject)(F))],$y);var Su=D(O()),KC=require("vscode");var Ua=D(O()),OC=require("vscode");var ds=require("vscode");var xge=/python\s\d*.?\d*$/,jF="__old_vscode_kernelspecs",WF=class{constructor(e,t,n){this.fs=e;this.globalState=t;this.jupyterPaths=n;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&E(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(f,f)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){z(this.disposables)}async loadKernelSpec(e,t,n){if(e.fsPath.includes(jF))return;let i=gn(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,n).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),c=s&&a&&Fn(s)&&s.specFile&&$S(ds.Uri.file(s.specFile),a);if(s&&!c)return s;s?.specFile&&c&&this.deleteOldKernelSpec(s.specFile).catch(f),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(l=>wi(l.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(f)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=_e(dt(e)),n=Ve(dt(dt(e)),jF);this.oldKernelSpecsFolder=n;let i=Ve(n,t,_e(e));await this.fs.createDirectory(ds.Uri.file(dt(i))),await this.fs.copy(ds.Uri.file(e),ds.Uri.file(i)).catch(f),await this.fs.delete(ds.Uri.file(e)),E(`Old KernelSpec '${e}' deleted and backup stored in ${n}`)}async loadKernelSpecImpl(e,t,n){return Cge(e,this.fs,t,n)}async findKernelSpecsInPaths(e,t){let n=gn(e),i=this.findKernelSpecsInPathCache.get(n);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(c=>lr(e,c)):[])();this.findKernelSpecsInPathCache.set(n,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),s.dispose()}).catch(f),o.catch(a=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),E(`Failed to search for kernels in ${$(e)} with an error`,a)}),o}},Hy=class{constructor(e,t,n,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=n;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new go;this._onDidChangeStatus=new ds.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new ds.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.timeouts=new Map;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new WF(e,n,s),this.disposables.push(this.kernelSpecFinder),this.disposables.push(new ds.Disposable(()=>z(Array.from(this.timeouts.values()))))}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let n=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(n),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>Fs.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}writeToMementoCache(e,t){this.timeouts.get(t)?.dispose();let n=setTimeout(()=>{this.memento.update(t,JSON.stringify({kernels:e.map(i=>i.toJSON()),extensionVersion:this.env.extensionVersion}))},500);this.timeouts.set(t,{dispose:()=>Dm(clearTimeout)(n)})}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(ds.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(n=>n&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function Cge(r,e,t,n){if(r.fsPath.includes(jF))return;let i;try{i=JSON.parse(await e.readFile(r))}catch(l){x(`Failed to parse kernelspec ${r}`,l);return}if(t.isCancellationRequested||(i.name=n?await qN(n):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(xge)&&i.language===xe&&i.argv.length>2){let l=i.argv.slice(1).map(u=>u.toLowerCase()).filter(u=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(u));l.length&&(i.name=`${i.name}.${l.join("#")}`)}i.metadata=i.metadata||{},i.metadata.vscode=i.metadata.vscode||{},i.metadata.vscode.originalSpecFile||(i.metadata.vscode.originalSpecFile=r.fsPath),i.metadata.vscode.originalDisplayName||(i.metadata.vscode.originalDisplayName=i.display_name),i.metadata.originalSpecFile&&(i.metadata.vscode.originalSpecFile=i.metadata.originalSpecFile,delete i.metadata.originalSpecFile);let s=new fp(i,r.fsPath,n?.uri.fsPath||i?.metadata?.interpreter?.path,Fn(i));s.name=i?.name||_e(dt(r.fsPath));let a=n?.uri.fsPath||i?.metadata?.interpreter?.path,c=wr(n);if(!(a&&!c&&!await e.exists(ds.Uri.file(a))))return i.isRegisteredByVSC=Fn(i),s}function wH(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${OC.env.appHost}:${OC.env.remoteName||""}`}var ms=class extends Hy{constructor(t,n,i,o,s,a){super(t,i,o,s,a,n);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(wH()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(n=>this._kernels.set(n.id,n)),this._onDidChangeKernels.fire())}).catch(f),this.refresh().then(f,f)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new OC.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),wH())}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,p)=>u.id.localeCompare(p.id)),a=o.sort((u,p)=>u.id.localeCompare(p.id)),c=new Set(o.map(u=>u.id)),l=s.filter(u=>!c.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),l.length&&(E(`Local kernel spec connection deleted ${l.map(u=>`${u.kind}:'${u.id}'`)}`),l.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||l.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let n=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(n.map(c=>this.kernelSpecFinder.findKernelSpecsInPaths(c,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async c=>{try{let l=await this.kernelSpecFinder.loadKernelSpec(c,t);if(!l||t.isCancellationRequested)return;if(C_(l,"local"),l.metadata?.originalSpecFile){if(o.has(l.metadata.originalSpecFile))return;o.add(l.metadata.originalSpecFile)}if(l.specFile){if(o.has(l.specFile))return;o.add(l.specFile)}let u=a.get(l.display_name),p=mp.create({kernelSpec:l,interpreter:void 0,id:Ai(l)});u&&u.executable!==l.executable?(s.push(p),ya(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?W(`Duplicate kernel found ${l.display_name} ${l.executable} in ${l.specFile}`):(s.push(p),a.set(l.display_name,l),ya(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(l){x(`Failed to load kernelSpec for ${c}`,l);return}})),s}};v([Lv(100)],ms.prototype,"writeKernelsToMemento",1),ms=v([(0,Ua.injectable)(),d(0,(0,Ua.inject)(vr)),d(1,(0,Ua.inject)(Br)),d(2,(0,Ua.inject)(Ye)),d(3,(0,Ua.inject)(He)),d(3,(0,Ua.named)(bt)),d(4,(0,Ua.inject)(F)),d(5,(0,Ua.inject)(Wc))],ms);var Mo=D(O()),EH=require("vscode");var gd=Symbol("ITrustedKernelPaths");var Zn=require("vscode");function VF(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${Zn.env.appHost}:${Zn.env.remoteName||""}`}async function wge(r,e,t,n,i){let o=await Ea(r);if(!o){W(`Failed to get sysPrefix for interpreter ${An(r.id)}`);return}let s=Zn.Uri.file(Ve(o,N$)),a=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||a.some(p=>wi(p,s)))return;let c=await n.findKernelSpecsInPaths(s,e);if(e.isCancellationRequested)return;let l=new Set,u=new Map;await Promise.all(c.map(async p=>{try{let m=await n.loadKernelSpec(p,e,r);if(e.isCancellationRequested||!m)return;if(m.metadata?.originalSpecFile){if(l.has(m.metadata.originalSpecFile))return;l.add(m.metadata.originalSpecFile)}if(m.specFile){if(l.has(m.specFile))return;l.add(m.specFile)}let h=u.get(m.display_name);h&&h.executable!==m.executable?i.fire(m):h||(u.set(m.display_name,m),i.fire(m))}catch(m){x(`Failed to load kernel spec ${p}`,m)}}))}var X_=class extends ir{constructor(t,n,i,o,s){super();this.interpreter=t;this.interpreterService=n;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new Zn.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new Zn.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this.lastKnownInterpreterVersion=Gi(t),this.lastKnownInterpreterSysPrefix=Jh(t),this.lastKnownEnvFolder=Nr(t)?.environment?.folderUri,this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new Zn.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>{switch(this._kernels.size){case 0:E(`No Kernels found in interpreter ${this.interpreter.id}`);break;case 1:break;default:E(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)}}),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=Nr({id:this.interpreter.id});if(!t)return;let n=Gi(t),i=Jh(t);(this.lastKnownEnvFolder?.fsPath!==t.environment?.folderUri?.fsPath||this.lastKnownInterpreterVersion?.sysVersion!==n?.sysVersion||Be(this.interpreter)!==Be(t)||this.lastKnownInterpreterSysPrefix!==i)&&(this.lastKnownInterpreterVersion=n,this.lastKnownInterpreterSysPrefix=i,this.listKernelSpecs(!0).catch(f))}async listKernelSpecsImpl(){let t=this.cancelToken.token;if(!Jh(this.interpreter))return;E(`Search for KernelSpecs in Interpreter ${An(this.interpreter.uri)}`);let i=new Map,o=new Zn.EventEmitter,s=o.event(m=>{if(t.isCancellationRequested||m.language===xe&&(!m.env||Object.keys(m.env).length===0)&&wP(m))return;let h=af(m)?Ho.create({kernelSpec:m,interpreter:this.interpreter,id:Ai(m,this.interpreter)}):mp.create({kernelSpec:m,interpreter:this.interpreter,id:Ai(m,this.interpreter)});h&&!this._kernels.has(h.id)&&(this._kernels.set(h.id,h),this._onDidChangeKernels.fire({added:[h],removed:[]})),h&&!i.has(h.id)&&i.set(h.id,h)}),[a]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),wge(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,o)]);if(o.dispose(),s.dispose(),t.isCancellationRequested)return;let l=await js(this.interpreter,a);if(t.isCancellationRequested)return;let u=Ho.create({kernelSpec:l,interpreter:this.interpreter,id:Ai(l,this.interpreter)});this._kernels.has(u.id)||(this._kernels.set(u.id,u),this._onDidChangeKernels.fire({added:[u],removed:[]})),i.has(u.id)||i.set(u.id,u);let p=Array.from(this._kernels.keys()).filter(m=>!i.has(m)).map(m=>this._kernels.get(m));p.forEach(m=>this._kernels.delete(m.id)),this._onDidChangeKernels.fire({added:[],removed:p})}},Z_=class r{constructor(e,t,n,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=n;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new Zn.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!ya(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){z(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new Zn.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,n){let i=this.extensionChecker.isPythonExtensionInstalled?ho():[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await It(e.specFile):"",c=!!Fn(e);if(e.language&&e.language!==xe){!c&&o&&e.specFile&&o_(o)&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:_e(o)!==o,argv0:_e(o),language:s,isCreatedByUs:c});return}let l=i.find(u=>e.metadata?.interpreter?.path&&$o(Zn.Uri.file(e.metadata.interpreter.path),u.executable.uri)?(E(`Kernel ${e.name} matches ${An(u.id)} based on metadata.interpreter.`),!0):!1);if(l)return Ti(l);if(o&&_e(o)===o&&e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:_e(o),language:s,isCreatedByUs:c}),o&&_e(o)!==o){let u=Zn.Uri.file(o),p=i.find(m=>$o(u,m.executable.uri)?(E(`Kernel ${e.name} matches ${An(m.id)} based on argv.`),!0):!1);if(p)return e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"found",language:s,isCreatedByUs:c}),Ti(p);if(!e.specFile||this.trustedKernels.isTrusted(Zn.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(n?.isCancellationRequested)return;if(m)return e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:c}),m;e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:c})}else e.specFile&&!c&&N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:_e(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:c})}if(e.interpreterPath){let u=Zn.Uri.file(e.interpreterPath),p=i.find(m=>e.interpreterPath&&$o(u,m.executable.uri)?(E(`Kernel ${e.name} matches ${An(m.id)} based on interpreterPath.`),!0):!1);if(p)return Ti(p);if(!e.specFile||this.trustedKernels.isTrusted(Zn.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(m)return m}}if(!n?.isCancellationRequested)return Ti(i.find(u=>e.display_name===Nr(u)?.environment?.name?(E(`Kernel ${e.name} matches ${An(u.id)} based on display name`),N("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?_e(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:c}),!0):!1))}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===xe)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),W(`Kernel Spec for '${e.display_name}' (${An(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Fn(s.kernelSpec)),n=s=>{if(s.kernelSpec.language!==xe)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),c=a.indexOf("-m");if(c===-1)return!1;let l=a.length-1>=c?a[c+1]:void 0;return l?l!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Fn(s.kernelSpec);return!!(!a&&(n(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===xe&&!wP(s.kernelSpec))}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let l=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(o_(l)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let c=mp.create({kernelSpec:s.kernelSpec,interpreter:a,id:Ai(s.kernelSpec,a)});i.set(c.id,c),c.kernelSpec.specFile&&o.add(c.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var Iu=class extends Hy{constructor(t,n,i,o,s,a,c,l,u){super(n,o,a,c,l,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new Z_(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f)},this,this.disposables),t.onDidRemoveInterpreter(async p=>{if(await Ci(1e3),Nr(p))return;E(`Interpreter removed ${p.id}`);let m=[];this._kernels.forEach(h=>{h.interpreter?.id===p.id&&(E(`Interpreter ${p.id} deleted, hence deleting corresponding kernel ${h.kind}:'${h.id}`),m.push(h),this._kernels.delete(h.id))}),m.length&&(E(`Local Python connection deleted ${m.map(h=>`${h.kind}:'${h.id}: (interpreter id=${An(h.interpreter?.id)})'`)}`),this.updateCache().catch(f))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(VF()).then(t=>{t.length&&(t.filter(n=>!this._kernels.has(n.id)).forEach(n=>{this._kernelsFromCache.push(n),this._kernels.set(n.id,n)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,n=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==n.length||!ya(t,n))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(f))},this,this.disposables)}).catch(f)}get kernels(){return Array.from(this._kernels.values())}dispose(){z(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(f),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let n=this.refreshCancellation=new EH.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(n.token,t).catch(o=>x("Failure in listKernelsImplementation",o)),!n.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(l=>!this._kernelsExcludingCachedItems.has(l.id)),s=[];o.length&&(W(`Kernels ${o.map(l=>`${l.kind}:'${l.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(l=>`${l.kind}:'${l.id}'`).join(", ")}`),o.forEach(l=>{this._kernels.delete(l.id),s.push(l)}));let a=new Set(ho().map(l=>l.id)),c=Array.from(this._kernels.values()).filter(l=>!!(l.interpreter&&!a.has(l.interpreter.id)));c.length&&(W(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${c.map(l=>`${l.kind}:'id=${l.id}'(interpreterId='${An(l.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),c.forEach(l=>{this._kernels.delete(l.id),s.push(l)})),s.length&&(E(`Local Python connection deleted ${s.map(l=>`${l.kind}:'${l.id}: (interpreter id=${An(l.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>x("Failed to discover kernels in interpreters",o)).finally(()=>{n===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,VF())),this.updateCachePromise}async listKernelsImplementation(t,n){let i=this.extensionChecker.isPythonExtensionInstalled?ho():[],o=Promise.all(i.map(async a=>{let c=this.interpreterKernelSpecs.get(a.id);c||(c=new X_(Ti(a),this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(c),this.interpreterKernelSpecs.set(a.id,c),c.onDidChangeKernels(l=>{l.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(l.added),!l.added.length&&l.removed.length&&this.updateCache()},this,this.disposables)),await or(t,[],c.listKernelSpecs(n))})),s=or(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(n)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(n=>{mt(n)&&n.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(n.id,n),this._kernels.has(n.id)?this._kernels.set(n.id,n):this._kernels.set(n.id,n)):W(`Found a kernel ${n.kind}:'${n.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===xe).filter(i=>t?!0:!Fn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};Iu=v([(0,Mo.injectable)(),d(0,(0,Mo.inject)(st)),d(1,(0,Mo.inject)(vr)),d(2,(0,Mo.inject)(Br)),d(3,(0,Mo.inject)(Ye)),d(4,(0,Mo.inject)(ms)),d(5,(0,Mo.inject)(He)),d(5,(0,Mo.named)(si)),d(6,(0,Mo.inject)(F)),d(7,(0,Mo.inject)(Wc)),d(8,(0,Mo.inject)(gd))],Iu);var If=class extends Ws{constructor(t,n,i,o,s,a){super();this.nonPythonKernelFinder=t;this.pythonKernelFinder=n;this.disposables=o;this.extensionChecker=s;this.interpreters=a;this._status="idle";this._onDidChangeStatus=new KC.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new go;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=b.localKernelSpecs;this._onDidChangeKernels=new KC.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];this.disposables.push(this),i.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let t,n=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?t||(t=le(),this.promiseMonitor.push(t.promise)):(t?.resolve(),t=void 0)};n(),this.nonPythonKernelFinder.onDidChangeStatus(n,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(n,this,this.disposables),this.interpreters.onDidChangeStatus(n,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),KC.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let t=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(t),await t}updateCache(){try{let t=[],n=this.nonPythonKernelFinder.kernels.filter(o=>this.extensionChecker.isPythonExtensionInstalled?o.kernelSpec.language!==xe:!0),i=this.pythonKernelFinder.kernels.filter(o=>bg(o));t=t.concat(n).concat(i),this.writeToCache(t)}catch(t){x("Exception Saving loaded kernels",t)}}get kernels(){let t=new Set,n=[];return this.pythonKernelFinder.kernels.forEach(i=>{let o=Fn(i.kernelSpec);i.kernelSpec.specFile&&o==="registeredByNewVersionOfExtForCustomKernelSpec"&&(t.add(i.kernelSpec.specFile),n.push(i))}),this.cache.forEach(i=>{i.kernelSpec.specFile&&t.has(i.kernelSpec.specFile)||n.push(i)}),n}writeToCache(t){let n=new Set;t=t.filter(u=>n.has(u.id)?!1:(n.add(u.id),!0));let i=this.cache,o=new Map(i.map(u=>[u.id,u])),s=new Map(t.map(u=>[u.id,u])),a=t.filter(u=>!o.has(u.id)),c=t.filter(u=>o.has(u.id)&&!ya(u,o.get(u.id))),l=i.filter(u=>!s.has(u.id));this.cache=t,(a.length||c.length||l.length)&&this._onDidChangeKernels.fire({removed:l})}};v([Rh("List kernels failed")],If.prototype,"updateCache",1),If=v([(0,Su.injectable)(),d(0,(0,Su.inject)(ms)),d(1,(0,Su.inject)(Iu)),d(2,(0,Su.inject)(Mr)),d(3,(0,Su.inject)(F)),d(4,(0,Su.inject)(Ye)),d(5,(0,Su.inject)(st))],If);var Gy=D(O());var FC=require("vscode"),kH=require("os");function PH(r){let e=Be(r);return!!(DH(r)&&(e==="Unknown"||e==="Pyenv"||e==="Conda"))}function DH(r){let e=Gi(r)?.major??3,t=Gi(r)?.minor??6;return e>=3&&t>=6}var xu=class{constructor(e,t,n){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.context=n;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(n){return x("Failed to create interrupter, trying again",n),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let n=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!n)throw x("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:n,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:n},e,t)},dispose:async()=>{await this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:n},e,t).catch(i=>x(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&PH(e))return e;let t=ho();return t.length===0?e:Ti(t.find(PH))||Ti(t.find(DH))||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let n=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=FC.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=FC.Uri.joinPath(s,"kernel_interrupt_daemon.py"),c=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((l,u)=>{let p=!1,m=c.out.onDidChange(h=>{if(ne(`Output from interrupt daemon started = ${p}, output (${h.source}) = ${h.out} ('END)`),h.source==="stdout"&&h.out.trim().includes("DAEMON_STARTED:")&&!p)p=!0,l();else if(h.source==="stderr"&&h.out.includes("INTERRUPT:")&&h.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&p)Fe(h.out,{trim:!0,removeEmptyEntries:!0}).filter(g=>g.includes("INTERRUPT:")).forEach(g=>{try{let y=g.split(":"),C=parseInt(y[y.indexOf("INITIALIZE_INTERRUPT")+1],10),k=this.messages.get(C);k&&(x(`Failed to initialize interrupt daemon for ${C}, ${h.out}`),k.deferred.reject(new Error(`Failed to start interrupt daemon ${h.out}`)),this.messages.delete(C))}catch(y){x(`Failed to parse interrupt daemon response, ${h.out}`,y)}});else if(h.source==="stdout"&&h.out.includes("INTERRUPT:")&&p)Fe(h.out,{trim:!0,removeEmptyEntries:!0}).filter(g=>g.includes("INTERRUPT:")).forEach(g=>{try{let[y,C,k]=g.split(":"),A=this.messages.get(parseInt(C,10));A?(E(`Got a response of ${k} for ${y}:${C}`),A.deferred.resolve(k),this.messages.delete(parseInt(C,10))):x(`Got a response of ${k} for ${y}:${C} but no command entry found in ${h.out}`)}catch(y){x(`Failed to parse interrupt daemon response, ${h.out}`,y)}});else if(h.out.includes("ERROR: handling command")){if(W(`Error output in interrupt daemon response ${h.out} ('END')`),!p)return u(new Error(`Interrupt daemon failed to start, ${h.out}`));try{let g=h.out.split(":")[2],y=this.messages.get(parseInt(g,10));if(y){y.deferred.reject(new Error(h.out)),this.messages.delete(parseInt(g,10));return}}catch(g){x(`Failed to parse interrupt daemon response, ${h.out}`,g)}}});this.disposableRegistry.push(m)}),this.disposableRegistry.push(new FC.Disposable(()=>On(()=>c.proc?.kill()))),c.proc?.on("close",()=>{ne("Interrupt daemon closed"),this.startupPromise=void 0}),c.proc?.on("exit",()=>{ne("Interrupt daemon exited"),this.startupPromise=void 0}),c})();return n.catch(i=>x(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=n,n}async sendCommand(e,t,n){let i=le(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,n);if(!a||!a.stdin)throw x("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${kH.EOL}`),ne(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let c=await i.promise;if(ne(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(c,10)}};xu=v([(0,Gy.injectable)(),d(0,(0,Gy.inject)(Vr)),d(1,(0,Gy.inject)(F)),d(2,(0,Gy.inject)(ut))],xu);var eT=D(O());var LC=require("vscode");var dl=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?LC.Uri.file(xn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return LC.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!dl.IsKernelSpecHidden.completed&&dl.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>LC.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};dl.IsKernelSpecHidden=le(),dl=v([(0,eT.injectable)(),d(0,(0,eT.inject)(Dr))],dl);var fT=D(Hc()),hs=D(O()),ZF=D(require("os"));var L4=require("util"),U4=D(Ro()),hT=require("vscode");var S4=require("process"),x4=D(Hc()),Yy=D(require("os"));var Xy=require("vscode");var C4=D(VH());var y4="To connect another client to this kernel, use:",b4=`NOTE: When using the \`ipython kernel\` entry point, Ctrl-C will not work.

To exit, you will have to explicitly quit this process, by either sending
"quit" from a client, or using Ctrl-\\ in UNIX-like environments.

To read more about this, see https://github.com/ipython/ipython/issues/2049


`,Qy=class extends Ws{constructor(t,n,i,o,s,a,c,l,u,p,m,h,g){super();this.processExecutionFactory=t;this._connection=n;this.fileSystem=o;this.resource=s;this.extensionChecker=a;this.kernelEnvVarsService=c;this.pythonExecFactory=l;this.outputChannel=u;this.jupyterSettings=p;this.jupyterPaths=m;this.pythonKernelInterruptDaemon=h;this.platform=g;this.exitEvent=new Xy.EventEmitter;this._kernelConnectionMetadata=i}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return ft(this.kernelConnectionMetadata)&&af(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)ee("Interrupting kernel via SIGINT"),this._process.pid&&(0,S4.kill)(this._process.pid,"SIGINT");else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&ft(this._kernelConnectionMetadata))return ee("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();x("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(t,n,i){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0,await this.updateConnectionArgs(),In.throwIfCanceled(i);let o=await this.launchAsObservable(t,i),s=o.proc;if(i.isCancellationRequested)throw new Xy.CancellationError;E(`Kernel process ${s?.pid}.`);let a="",c="",l="",u=!1,p,m=le();m.promise.catch(f),s&&(s.on("exit",g=>{if(g=g||p,this.isDisposed){E(`KernelProcess Exited, Exit Code - ${g}`);return}E(`KernelProcess Exited, Exit Code - ${g}`,l),u||(this.exitEvent.fire({exitCode:g||void 0,reason:Gh(l)||l}),u=!0),i.isCancellationRequested||(ne("KernelProcessExitedError raised",c),m.reject(new id(g||-1,c,this.kernelConnectionMetadata)))}),s.stdout?.on("data",g=>{E(`Kernel output: ${(g||"").toString()}`),this.sendToOutput((g||"").toString())}),s.stderr?.on("data",g=>{let y=I4((g||"").toString());l+=y,y.trim().length&&E(`KernelProcess error: ${y}`),this.sendToOutput(y)}));let h=!1;o.out.onDidChange(g=>{if(g.source==="stderr")g.out=I4(g.out),c+=g.out,g.out.trim().length&&!g.out.includes("It seems that frozen modules are being used, which may")&&!g.out.includes("make the debugger miss breakpoints. Please pass -Xfrozen_modules=off")&&!g.out.includes("to python to disable frozen modules")&&!g.out.includes("Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION")&&W(`StdErr from Kernel Process ${g.out.trim()}`);else{if(a+=g.out,!h){a=a.replace(b4,""),a=a.replace(b4.split(/\r?\n/).join(Yy.EOL),""),a=a.trimStart();let y=Fe(a,{trim:!0,removeEmptyEntries:!0});y.length===2&&y[0]===y4&&y[1].startsWith("--existing")&&y[1].endsWith(".json")&&(a=`${y.join(" ")}${Yy.EOL}`)}a.includes(y4)&&(h=!0)}this.sendToOutput(g.out)}),o.out.done.catch(g=>{if(this.isDisposed){W("Kernel died",g,c);return}x("Kernel died",g,c),m.reject(g)});try{m.rejected&&await m.promise;let g=Pe.instance.get(Ds).inExperiment("DoNotWaitForZmqPortsToBeUsed"),y=(await Promise.resolve().then(()=>D(v4()))).default,C=new Je;g&&n>1e4&&(n=1e4);let k=Promise.all([y.waitUntilUsed(this.connection.shell_port,200,n),y.waitUntilUsed(this.connection.iopub_port,200,n)]).catch(A=>{if(!(i.isCancellationRequested||m.rejected)&&(console.error("ex"),console.error(A),W(`Waited ${C.elapsedTime}ms for kernel to start`,A),!g))return Promise.reject(new oy(this.kernelConnectionMetadata))});await ur(i,k,m.promise)}catch(g){let y=(l||c||"").trim();if(!i?.isCancellationRequested&&!hr(g)&&(x("Disposing kernel process due to an error",g),g&&g instanceof Error&&y.length&&g.message.includes(y)||x(y)),await this.dispose(),!i?.isCancellationRequested&&g instanceof et)throw g;{i?.isCancellationRequested&&E("User cancelled the kernel launch");let C=$E(y)||y.substring(0,100);throw ne("KernelDiedError raised",C,l+`
`+c+`
`),console.error("KernelDiedError raised",g),new nd(b.kernelDied(C),l+`
`+c+`
`,g,this.kernelConnectionMetadata)}}}async dispose(){if(this._disposingPromise)return this._disposingPromise;if(this.isDisposed)return;let t=this._process?.pid;E(`Dispose Kernel process ${t}.`),this._disposingPromise=(async()=>{await xr(1e3,this.killChildProcesses(this._process?.pid).catch(f));try{this.interrupter?.dispose().catch(f),this._process?.kill(),this.exitEvent.fire({})}catch(n){x(`Error disposing kernel process ${t}`,n)}On(async()=>{this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(n=>W(`Failed to delete connection file ${this.connectionFile} for pid ${t}`,n))}),E(`Disposed Kernel process ${t}.`)})(),super.dispose()}async killChildProcesses(t){if(!(!t||!zc.isAlive(t)))try{if(this.platform.isWindows){let n=process.env.WINDIR||"C:\\Windows",i=Ve(n,"System32","taskkill.exe");await new zc().exec(i,["/F","/T","/PID",t.toString()])}else await new Promise(n=>{(0,C4.default)(t,(i,o)=>{i?W(`Failed to kill children for ${t}`,i):o.forEach(s=>zc.kill(s)),n()})})}catch(n){W(`Failed to kill children for ${t}`,n)}}sendToOutput(t){this.outputChannel&&this.outputChannel.append(t)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let t=this._kernelConnectionMetadata.kernelSpec;if(!t)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(t.argv)?this._launchKernelSpec={...t,argv:[...t.argv]}:(x("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let t=h9(this.launchKernelSpec);if(t===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&t===0&&this.launchKernelSpec.argv[t-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.connectionFile=await this.createConnectionFile(),this.isPythonKernel)this.launchKernelSpec.argv.splice(t-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let n=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[t].includes("--connection-file")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(_m,n):this.launchKernelSpec.argv[t].includes(`=${_m}`)&&!this.launchKernelSpec.argv[t].trim().startsWith("=")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(_m,n):this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(_m,this.connectionFile.fsPath)}}async createConnectionFile(){let t=await this.jupyterPaths.getRuntimeDir(),n=await this.fileSystem.createTemporaryLocalFile({fileExtension:".json",prefix:"kernel-v2-"}),i=t?Ve(t.fsPath,_e(n.filePath)):n.filePath;return await n.dispose(),Xy.Uri.file(i)}addPythonConnectionArgs(t){let n=[],i=t.fsPath.includes(" ")?`"${t.fsPath}"`:t.fsPath;return n.push(`--f=${i}`),n}async launchAsObservable(t,n){let i;if(E(`Launching kernel ${this.kernelConnectionMetadata.id} for ${$(this.resource)} in ${$(t)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let o=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),[s,a,c]=await Promise.all([o,x4.pathExists(t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,n)]);if(In.throwIfCanceled(n),Yy.platform()==="win32"){c=c||process.env;try{let u=await this.getWin32InterruptHandle();c.JPY_INTERRUPT_EVENT=`${u}`,ne(`Got interrupt handle kernel id ${u} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(u){x(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,u)}}In.throwIfCanceled(n);let l=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&l.push("--debug"),i=s.execObservable(l,{cwd:a?t:process.cwd(),env:c}),In.throwIfCanceled(n)}else{let o=this.launchKernelSpec.argv[0];ee(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${o}`);let[s,a]=await Promise.all([this.processExecutionFactory.create(this.resource,n),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,n)]);In.throwIfCanceled(n);let c=this.launchKernelSpec.argv.slice(1);i=s.execObservable(o,c,{env:a,cwd:t})}if(!i.proc)throw new Error("KernelProcess failed to launch");return this._process=i.proc,this._pid=i.proc.pid,i}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};v([fr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],Qy.prototype,"launch",1),v([d(1,ip())],Qy.prototype,"launchAsObservable",1);function I4(r){let e=Fe(r,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")).join(Yy.EOL):r}var F4="kernelLauncherPortStart_{0}.tmp",Oo=class{constructor(e,t,n,i,o,s,a,c,l,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=n;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=c;this.pythonKernelInterruptDaemon=l;this.platformService=u}static async cleanupStartPort(){try{let e=await Oo.startPortPromise;E(`Cleaning up port start file : ${e}`);let t=Ve(ZF.tmpdir(),ic(F4,e.toString()));await fT.remove(t)}catch(e){W("Kernel port mutex failed to cleanup: ",e)}}static async computeStartPort(){if(Ar()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let n=Ve(ZF.tmpdir(),ic(F4,e.toString()));await fT.open(n,"wx"),t=e}catch{e+=1e3}return E(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,n,i,o){let s=new Je,a=(async()=>(this.logIPyKernelPath(n,e,o).catch(f),await this.launchProcess(e,n,i,t,o)))();return a.then(()=>N("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:Yi(n)})).catch(f),a}async logIPyKernelPath(e,t,n){let i=t.interpreter;if(!mt(t)||!ft(t)||!i)return;let s=await(await this.pythonExecFactory.createActivatedEnvironment({interpreter:i,resource:e})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:n});if(n.isCancellationRequested)return;let a=$(i.uri);if(s.stdout){let c=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(l=>l.trim()).filter(l=>l.length>0);c.length===2?E(`ipykernel version & path ${c[0]}, ${MJ(c[1])} for ${a}`):E(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let c=Fe(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((l,u)=>u===0?l:`    ${l}`).join(`
`);W(`Stderr output when getting ipykernel version & path ${c} for ${a}`)}}async launchProcess(e,t,n,i,o){let s=await ur(o,this.getKernelConnection(e)),a=t?_e(t.fsPath):"",c=this.configService.getSettings(t),l=c.logKernelOutputSeparately||c.development?hT.window.createOutputChannel(b.kernelConsoleOutputChannel(a),"log"):void 0;l?.clear();let u=p_(s.control_port,s.hb_port,s.iopub_port,s.shell_port,s.stdin_port),p=new Qy(this.processExecutionFactory,s,e,this.fs,t,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,l,c,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);ka(p.onDidDispose)(()=>u.dispose(),this,this.disposables),ka(p.exited)(()=>l?.dispose(),this,this.disposables);try{await ur(o,p.launch(n,i,o))}catch(h){throw await p.dispose(),In.throwIfCanceled(o),h}let m=ka(p.exited)(({exitCode:h,reason:g})=>{At(t,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",h?{exitCode:h}:void 0,{exitReason:Gh(g)}),ra.delete(s.control_port),ra.delete(s.hb_port),ra.delete(s.iopub_port),ra.delete(s.shell_port),ra.delete(s.stdin_port),m.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await p.dispose(),new hT.CancellationError;return p}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let n=await(0,L4.promisify)((await Promise.resolve().then(()=>D(K4()))).getPorts)(5,{host:"127.0.0.1",port:e});if(n.some(i=>ra.has(i))){let i=Math.max(...ra,...n);return Oo.findNextFreePort(i)}return n.forEach(i=>ra.add(i)),n}async getConnectionPorts(){let e=await Oo.startPortPromise;return Oo.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,U4.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Oo.startPortPromise=Oo.computeStartPort(),v([Lr("Failed to capture IPyKernel version and path")],Oo.prototype,"logIPyKernelPath",1),Oo=v([(0,hs.injectable)(),d(0,(0,hs.inject)(Mi)),d(1,(0,hs.inject)(vr)),d(2,(0,hs.inject)(Ye)),d(3,(0,hs.inject)(Fa)),d(4,(0,hs.inject)(F)),d(5,(0,hs.inject)(Vr)),d(6,(0,hs.inject)(ue)),d(7,(0,hs.inject)(Br)),d(8,(0,hs.inject)(xu)),d(9,(0,hs.inject)(Dr))],Oo);var Y4=D(require("vscode")),WC=D(O());var gT=class extends Ay{constructor(t,n,i){super("localRaw",t);this.resource=n;this.kernelConnectionMetadata=i;this.initializeKernelSocket()}get atleastOneCellExecutedSuccessfully(){return this.session.atleastOneCellExecutedSuccessfully}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(ne(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.disposeAsync().catch(f)}async disposeAsync(){await this.shutdown().catch(f).finally(()=>this.session.dispose()).finally(()=>super.dispose())}async waitForIdle(t,n){try{await Ry(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw ne("Error waiting for idle",i),await this.shutdown().catch(f),i}}async shutdown(){if(this._isDisposed)return;this._isDisposed=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;E(`Shutdown session ${t} - start called from ${new Error("").stack}`),Ty(this.session.kernel),await xr(1e3,this.session.shutdown().catch(f)),this.didShutdown.fire(),super.dispose(),E(`Shutdown session ${t} - shutdown complete`)}};var Va=D(T_()),Q4=D(Ro());var xT=D(Ro());var ST=D(B4()),z4=D(Ro());var Cu=D(Hc());var yT=D(require("os"));var q4=D(Hc()),tL=D(require("os"));var Gve=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],zve=new RegExp(/^[0-9 .]*$/);async function J4(){let r={id:"",version_id:""};if(tL.platform()==="darwin"||tL.platform()==="win32")return r;try{let e=await q4.readFile("/etc/os-release","utf-8");Fe(e).forEach(t=>{let n=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(n||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(n)r.id=Gve.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";r.version_id=zve.test(o)?o:s.toString()}}})}catch(e){x("Failed to read distro info",e)}return r}var Qve="zeromq";function bT(){try{let r=require(Qve);return r.context.blocky=!1,rL(!1).catch(f),r}catch(r){try{let e=require(Ve(rs,"dist","node_modules","zeromqold"));return ee("ZMQ loaded via fallback mechanism."),rL(!1,!0,r.message||r.toString()).catch(f),e}catch(e){throw rL(!0,!0,r.message||r.toString(),e.message||e.toString()).catch(f),W("Exception while attempting zmq :",r.message||r),W("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Yve(){try{let r=Ve(rs,"dist","node_modules","zeromq","prebuilds");if(!await Cu.pathExists(Ve(rs,"dist","node_modules")))return;let e=await Cu.readdir(r).then(n=>n.map(async i=>{let o=Ve(r,i);return(await Cu.stat(o)).isDirectory()?Cu.readdir(o).then(a=>a.map(c=>Ve(o,c))):[]}));return(await Promise.all(e.flat())).flat().map(n=>n.substring(n.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(r){return W("Failed to determine local zmq binaries.",r),["Failed to determine local zmq binaries."]}}var $4=!1;async function rL(r,e=!1,t="",n=""){if($4)return;$4=!0;let[i,o]=await Promise.all([J4().catch(()=>({id:"",version_id:""})),Yve()]),s=Xve();N("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),N("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:n})}function H4(r){return r==="linux"&&Cu.existsSync("/etc/alpine-release")}function Xve(){try{let r=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||yT.arch(),n=process.env.npm_config_platform||yT.platform(),i=H4(n),o=process.env.LIBC||(H4(n)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":r.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(r){return W("Failed to determine platform information used to load zeromq binary.",r),{}}}function Zve(r,e){let t=r.transport==="tcp"?":":"-",n=r[`${e}_port`];if(!n)throw new Error(`Port not found for channel "${e}"`);return`${r.transport}://${r.ip}${t}${n}`}var IT=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=f;this.onerror=f;this.onclose=f;this.onmessage=f;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(n){x("Error during socket shutdown",n)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,n){let i=n();return i.connect(Zve(e,t)),this.processSocketMessages(t,i).catch(x.bind(`Failed to read messages from channel ${t}`)),i}async processSocketMessages(e,t){for await(let n of t){if(this.closed)break;this.onIncomingMessage(e,n)}}generateChannels(e){let t=bT(),n=(0,z4.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let n=this.closed?{}:ST.decode(t,this.connection.key,this.connection.signature_scheme);n.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(n);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(n,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(n,e))}fireOnMessage(e,t){if(!this.closed)try{tye(e,t),this.onmessage({data:e,type:"message",target:this})}catch(n){x(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,n)}}sendMessage(e,t){let n=ST.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,f)))).then(async()=>{try{await this.postToSocket(e.channel,n)}catch(o){x(`Failed to write data to the kernel channel ${e.channel}`,n,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,n)});this.sendChain.catch(f)}postToSocket(e,t){let n=this.channels[e];n?n.send(t).catch(i=>{x("Error communicating with the kernel",i)}):x(`Attempting to send message on invalid channel: ${e}`)}},eye=["username","version","session","msg_id","msg_type"],G4={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function tye(r,e){let t=r.header;eye.forEach(n=>{typeof t[n]!="string"&&(t[n]="")}),typeof r.channel!="string"&&(r.channel=e),r.content||(r.content={}),r.metadata||(r.metadata={}),r.channel==="iopub"&&rye(r)}function rye(r){if(r.channel!=="iopub")return;let e=r.header.msg_type;if(e in G4){let t=G4[e];if(t===void 0)return;let n=Object.keys(t),i=r.content;for(let o=0;o<n.length;o++){let s=t[n[o]];Array.isArray(s)||(s=[s]);let a=n[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var yd=D(T_()),bd=require("vscode");var nL,CT=class{constructor(e,t,n,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=n;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new yd.Signal(this);this.connectionStatusChanged=new yd.Signal(this);this.iopubMessage=new yd.Signal(this);this.unhandledMessage=new yd.Signal(this);this.anyMessage=new yd.Signal(this);this.disposed=new yd.Signal(this);this.id=(0,xT.default)();this.clientId=(0,xT.default)();this.username=(0,xT.default)();this.infoDeferred=le();this.name=yg(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new bd.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],n=Eg(e);t.push(n);try{let i=this.kernelProcess;this.kernelProcess=void 0,i?.dispose()?.catch(f),On(()=>this.socket?.dispose()),On(()=>this.realKernel?.dispose());let o=this.kernelProcess=await vt.wrapAndReportProgress(this.resource,b.connectingToKernel(ht(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new bd.CancellationError;this.hookupKernelProcessExitHandler(o);let s=iye(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=s.kernelProcess,this.realKernel=s.realKernel,this.socket=s.socket,s.realKernel.info.then(c=>this.infoDeferred.resolve(c),c=>this.infoDeferred.reject(c));let a=setTimeout(()=>n.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(a)}),await vt.wrapAndReportProgress(this.resource,b.waitingForJupyterSessionToBeIdle,()=>nye(n.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,s.realKernel)),e.isCancellationRequested)throw new bd.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(i){throw await Promise.all([this.kernelProcess?.dispose().catch(f),this.realKernel?.shutdown().catch(o=>W(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,o))]),hr(i)&&n.token.isCancellationRequested&&!e.isCancellationRequested?new rf(this.kernelConnectionMetadata):(hr(i)||e.isCancellationRequested?E("Starting of raw session cancelled by user"):x(`Failed to connect raw kernel session: ${i}`),i)}finally{z(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(n=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(x(`Disposing session as kernel process died ExitCode: ${n.exitCode}, Reason: ${n.reason}`),At(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",n.exitCode?{exitCode:n.exitCode}:void 0,{exitReason:Gh(n.reason)}),this.shutdown().catch(f))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),yd.Signal.disconnectAll(this)}).catch(f))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),Ty(this.realKernel),await this.kernelProcess?.dispose().catch(f),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}clone(e){return this}get spec(){if(bg(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return x("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,n){return this.realKernel.sendShellMessage(e,t,n)}sendControlMessage(e,t,n){return this.realKernel.sendControlMessage(e,t,n)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){ee("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(n=>x("Failed to interrupt via a message",n))}else x("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,n){return this.realKernel.requestExecute(e,t,n)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e){return this.realKernel.sendInputReply(e)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function nye(r,e,t,n,i){try{E("Waiting for Raw Session to be ready in postStartRawSession"),await ur(r,oye(i,n,e)),E("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw x("Failed waiting for Raw Session to be ready",u),hr(u)||r.isCancellationRequested?new bd.CancellationError:u}E(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=le(),s=le(),a=()=>o.resolve(!0);i.iopubMessage.connect(a);let c=()=>{let p=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(p,!0,!0).done.then(()=>s.resolve(!0)).catch(f)},l=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(f)};try{let u=new Je,p=0;for(;u.elapsedTime<e*1e3;){p+=1;try{E("Sending request for kernelInfo"),c(),l(),await ur(r,Promise.all([o.promise,s.promise]),Ci(Math.min(e,500)).then(f))}catch(m){throw x("Failed to request kernel info",m),m}if(o.completed&&s.completed){E("Got response for requestKernelInfo");break}else{E("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?E(`Successfully completed postStartRawSession after ${p} attempt(s) in ${u.elapsedTime}ms`):W(`Didn't get response for requestKernelInfo after ${p} attempt(s) in ${u.elapsedTime}ms.`),At(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:p},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function iye(r,e,t,n){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends IT{constructor(){super(r.connection,o.serialize),s=this}}let c=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW"});nL||(nL=require("@jupyterlab/services/lib/kernel/nonSerializingKernel"));let l=new nL.KernelConnection({serverSettings:c,clientId:e,handleComms:!0,username:t,model:n});return bd.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&l.anyMessage.connect((u,p)=>{E(`[AnyMessage Event] [${p.direction}] [${r.pid}] ${JSON.stringify(p.msg)}`)}),no.set(l.id,s),s.emit("open"),{realKernel:l,socket:s,kernelProcess:r}}async function oye(r,e,t){E(`Waiting for Raw session to be ready, status: ${r.connectionStatus}`);let n=le(),i=(s,a)=>{a=="connected"?(E("Raw session connected"),n.resolve(a)):E(`Raw session not connected, status: ${a}`)};r.connectionStatusChanged.connect(i),r.connectionStatus==="connected"&&(E("Raw session connected"),n.resolve(r.connectionStatus)),E("Waiting for Raw session to be ready");let o=await xr(t,n.promise);if(r.connectionStatusChanged.disconnect(i),E(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new rf(e)}var wT=class{constructor(e,t,n,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new Va.Signal(this);this.kernelChanged=new Va.Signal(this);this.terminated=new Va.Signal(this);this.iopubMessage=new Va.Signal(this);this.unhandledMessage=new Va.Signal(this);this.anyMessage=new Va.Signal(this);this.disposed=new Va.Signal(this);this.connectionStatusChanged=new Va.Signal(this);this.propertyChanged=new Va.Signal(this);this._didShutDownOnce=!1;this.id=(0,Q4.default)(),this.name=yg(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new CT(e,t,n,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this)}get atleastOneCellExecutedSuccessfully(){return this.cellExecutedSuccessfully===!0}get jupyterLabServices(){return this._jupyterLabServices||(this._jupyterLabServices=require("@jupyterlab/services")),this._jupyterLabServices}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await ro(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;At(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(f).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),Va.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>W(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){ne(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){!this.cellExecutedSuccessfully&&t.header.msg_type==="execute_result"&&t.content&&(this.jupyterLabServices.KernelMessage.isExecuteResultMsg(t)||this.jupyterLabServices.KernelMessage.isExecuteInputMsg(t))&&t.content.execution_count&&(this.cellExecutedSuccessfully=!0),this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var tb=class{constructor(e,t){this.configService=e;this.kernelLauncher=t}async create(e){E(`Creating raw notebook for resource '${$(e.resource)}'`);let t,[n]=await Promise.all([ur(e.token,mC(e.resource).then(o=>Y4.Uri.file(o))),ur(e.token,ro(e.resource,{kernelConnection:e.kernelConnection}))]),i=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new wT(e.resource,this.kernelLauncher,n,e.kernelConnection,i,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await ur(e.token,t.startKernel(e))}catch(o){throw hr(o)||e.token.isCancellationRequested?E("Starting of raw session cancelled by user"):x(`Failed to connect raw kernel session: ${o}`),t?.shutdown().catch(s=>x(`Failed to dispose of raw session on launch error: ${s} `)).finally(()=>t?.dispose()).catch(f),o}return new gT(t,e.resource,e.kernelConnection)}};tb=v([(0,WC.injectable)(),d(0,(0,WC.inject)(ue)),d(1,(0,WC.inject)(GD))],tb);var ET=D(O());var rb=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{bT(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};rb=v([(0,ET.injectable)(),d(0,(0,ET.inject)(ue))],rb);var wu=D(O()),X4=require("vscode");var Mn=Symbol("IJupyterVariables"),PT=Symbol("IKernelVariableRequester");var xf=class{constructor(e,t,n){this.kernelVariables=t;this.debuggerVariables=n;this.refreshEventEmitter=new X4.EventEmitter;e.push(n.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,n,i){return this.variableHandler.getAllVariableDiscriptions(e,t,n,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,n){return this.variableHandler.getMatchingVariable(e,t,n)}async getDataFrameInfo(e,t,n,i){return this.variableHandler.getDataFrameInfo(e,t,n,i)}async getVariableValueSummary(e,t,n){return this.variableHandler.getVariableValueSummary(e,t,n)}async getDataFrameRows(e,t,n,i,o){return this.variableHandler.getDataFrameRows(e,t,n,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};v([fr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],xf.prototype,"getVariables",1),xf=v([(0,wu.injectable)(),d(0,(0,wu.inject)(F)),d(1,(0,wu.inject)(Mn)),d(1,(0,wu.named)(Qe.KERNEL_VARIABLES)),d(2,(0,wu.inject)(Mn)),d(2,(0,wu.named)(Qe.DEBUGGER_VARIABLES))],xf);var Eu=D(O()),kT=require("vscode");function fl(r){if(typeof r!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof r}\``);var e=eG();let t=e;return t.default&&(t=t.default),r.replace(t(),"")}var sye=/Type:\s*(\w+)/,aye=/Value:\s*(.*)/,cye=/String form:\s*([\s\S]+?)\n/,lye=/Docstring:\s*(.*)/,uye=/Length:\s+(.*)/,pye=/^\s+\[(\d+) rows x (\d+) columns\]/m,dye=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),nb=class{constructor(e,t,n,i){this.configService=e;this.disposables=n;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new kT.EventEmitter;this.variableRequesters.set(xe,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,n,i){let o=Io(e.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,n,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,n){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,n)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,n);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,size:0,count:0,shape:"",truncated:!0},t,n)}}}async getVariableValueSummary(e,t,n){if(!t)return;let i=Io(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);if(o)return o.getVariableValueSummary(e,t,n)}async getDataFrameInfo(e,t,n,i){if(!t)return e;let o=Io(t?.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return n&&(a=`${e.name}${n}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,n,i,o){let s=Io(i?.kernelConnectionMetadata)||xe,a=this.variableRequesters.get(s);if(a){let c=e.name;return o&&(c=`${e.name}${o}`),a.getDataFrameRows(t,n,i,c)}return{data:[]}}async getFullVariable(e,t,n){let i=Io(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,n):e}async getVariablesBasedOnKernel(e,t){let n=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!n||!i&&(n.currentExecutionCount!==t.executionCount||n.currentExecutionCount!==o.executionCount))&&(n={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(c=>({name:c.name,value:void 0,supportsDataExplorer:!1,type:c.type,size:0,shape:"",count:0,truncated:!0,fileName:e.notebook.uri}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(n){let c=t.sortColumn,l=(m,h)=>{let g=m[c]?m[c]:"",y=h[c]?h[c]:"";return t.sortAscending?g.localeCompare(y,void 0,{sensitivity:"base"}):y.localeCompare(g,void 0,{sensitivity:"base"})};n.variables.sort(l);let u=t.startIndex?t.startIndex:0,p=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let m=u;m<u+p&&m<n.variables.length;){if(s&&s.indexOf(n.variables[m].type)>=0){n.variables.splice(m,1);continue}let h=typeof n.variables[m].value=="string"?n.variables[m]:await this.getVariableValueFromKernel(n.variables[m],e);n.variables[m]=h,a.pageResponse.push(h),m+=1}this.cachedVariables.set(e.uri.toString(),n),a.totalCount=n.variables.length}return a}async getVariableProperties(e,t,n){let i=await this.getMatchingVariable(e,t,n),o=Io(t.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,n,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let n=Io(e.kernelConnectionMetadata)||xe,i=this.variableRequesters.get(n);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,n=0,i){let o=le();try{e.requestInspect({code:t,cursor_pos:n,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new kT.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,n){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,n);if(o&&o.hasOwnProperty("text/plain")){let s=fl(o["text/plain"].toString()),a=sye.exec(s),c=uye.exec(s),l=pye.exec(s);a&&(i.type=a[1]),i.value=[aye,cye,lye].reduce((u,p)=>u||p.exec(s)?.[1]||"",""),c&&(i.count=parseInt(c[1],10)),l&&(i.shape=`(${l[1]}, ${l[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),dye.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&ft(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};nb=v([(0,Eu.injectable)(),d(0,(0,Eu.inject)(ue)),d(1,(0,Eu.inject)(PT)),d(1,(0,Eu.named)(Qe.PYTHON_VARIABLES_REQUESTER)),d(2,(0,Eu.inject)(F)),d(3,(0,Eu.inject)(Ke))],nb);var hl=D(O());var ib=class{constructor(e,t,n,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=n;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(f))),this.preWarmInterpreterVariables().catch(f),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(f),this.condaService.getCondaVersion().catch(f))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(f)}};ib=v([(0,hl.injectable)(),d(0,(0,hl.inject)(Vs)),d(1,(0,hl.inject)(mi)),d(2,(0,hl.inject)(F)),d(3,(0,hl.inject)(Ye)),d(4,(0,hl.inject)(tr)),d(5,(0,hl.inject)(fi)),d(6,(0,hl.inject)(Hs))],ib);var VC=D(O());var ob=class extends et{constructor(){super("unknown",b.jupyterDataRateExceeded)}};function iL(r){let e=r.index,t=r.columns;return{data:r.data.map((o,s)=>{let a={index:e[s]};return t.forEach((c,l)=>{a[c]=o[l]}),a})}}async function sb(r,{code:e,initializeCode:t,cleanupCode:n},i){if(r.disposed||r.disposing||!r.session?.kernel||!r.session.kernel||r.session.isDisposed)return[];try{return t&&await bn(r.session.kernel,t,i),await bn(r.session.kernel,e,i)}catch(o){if(o instanceof yn)return[];throw o}finally{n&&await bn(r.session.kernel,n,i)}}var ab=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:n}),a=await sb(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),c=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:c}}async getDataFrameRows(e,t,n,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),c=await sb(n,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return c.length===0?{data:[]}:iL(this.deserializeJupyterResult(c))}async getVariableProperties(e,t,n){let i={};return n&&n.value&&(i[`${e}`]=n.value),i}async getVariableValueSummary(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableValueSummary({variableName:e.name}),a=await sb(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});try{return this.extractJupyterResultText(a)}catch{return}}async getAllVariableDiscriptions(e,t,n,i){if(!e.session)return[];let{code:o,cleanupCode:s,initializeCode:a}=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions({isDebugging:!1,parent:t,startIndex:n}),c=await sb(e,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request when retrieving variables",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing||i?.isCancellationRequested)return[];try{return this.deserializeJupyterResult(c)}catch(l){return x(l),[]}}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:n,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await sb(e,{code:n,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),c=[];for(let[l,u]of Object.entries(a)){let p={name:l,value:void 0,supportsDataExplorer:!1,type:u||"",size:0,shape:"",count:0,truncated:!0};c.push(p)}return c}return[]}async getFullVariable(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await sb(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let n=t.text;if(n.includes("iopub_data_rate_limit"))throw new ob;{let i=b.jupyterGetVariablesExecutionError(n);throw x(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let n=t.data;if(n&&n.hasOwnProperty("text/plain"))return n["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(fl).join(`\r
`),o=b.jupyterGetVariablesExecutionError(i);throw x(o),new Error(o)}}throw new Error(b.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};ab=v([(0,VC.injectable)(),d(0,(0,VC.inject)(Mh)),d(1,(0,VC.inject)(Oh))],ab);var Cf=D(O());var rG=require("vscode");var tG=1e3*60*60*24*2,Ba=class extends ir{constructor(t,n,i,o){super();this.serverStorage=n;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=rG.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,n){if(t.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,n){if(!Ft(n.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,c)=>{if(c.direction==="send"){let l=c.msg;if(l.header.msg_type==="execute_request"&&l.metadata&&typeof l.metadata=="object"&&l.metadata&&"cellId"in l.metadata&&typeof l.metadata.cellId=="string"&&l.metadata.cellId===t.document.uri.toString()){let u=l.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:n.session?.kernel?.id||"",cellIndex:t.index})}}else if(c.direction==="recv"){let l=c.msg,u=this.executedCells.get(t);if(u?.msg_id&&yu(l)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(l.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in l.content&&typeof l.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==l.content.execution_count&&(u.executionCount=l.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,n,u),z(i))}}},s=()=>{let a=n.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>On(()=>a.anyMessage?.disconnect(o))}))};n.onStarted(()=>s(),i),n.session&&s()}deleteTrackedCellExecution(t,n){t.notebook.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,n,i){if(!i.executionCount||!i.msg_id||!i.startTime||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:n.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Vt(n.kernelConnectionMetadata.serverProviderHandle),sessionId:n.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let c=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(c.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let n={};try{let s=await this.fs.readFile(this.storageFile);n=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Vt(s)));Object.keys(n).forEach(s=>{let a=n[s];(o.has(a.serverId)||Date.now()-a.startTime>tG)&&(delete n[s],i=!0)}),i&&(this.removeOldItems(n),this.staleState=n,await this.fs.writeFile(this.storageFile,JSON.stringify(n)))}))}removeOldItems(t){Object.keys(t).forEach(n=>{let i=t[n];i&&Date.now()-i.startTime>tG&&delete t[n]})}};Ba=v([(0,Cf.injectable)(),d(0,(0,Cf.inject)(F)),d(1,(0,Cf.inject)(Zt)),d(2,(0,Cf.inject)(ut)),d(3,(0,Cf.inject)(at))],Ba);var lb=D(O());var BC=require("vscode");var cb=class{constructor(e,t,n){this.serverUriStorage=e;this.registrations=t;this.disposables=n}activate(){this.disposables.push(BC.commands.registerCommand(J.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(f),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===$e).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new BC.CancellationTokenSource,n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((n||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(f)))})).catch(f),await BC.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(f,f)},this))}};cb=v([(0,lb.injectable)(),d(0,(0,lb.inject)(Zt)),d(1,(0,lb.inject)(Qt)),d(2,(0,lb.inject)(F))],cb);var DT=D(O());var ub=class{constructor(e){this.registry=e;this.priority=0}activate(){this.registry.register(this,xt),this.registry.register(this,yt)}async getCode(e){return ft(e.kernelConnectionMetadata)?[E9]:[]}};ub=v([(0,DT.injectable)(),d(0,(0,DT.inject)(Go))],ub);function nG(r,e){r.addSingleton(be,ty),r.addSingleton(be,iy),r.addSingleton(fi,rb),r.addSingleton(ss,ss),r.addSingleton(zD,tb),r.addSingleton(GD,Oo),r.addSingleton(Fa,Fa),r.addSingleton(Mr,Fy),r.addSingleton(be,If),r.addSingleton(be,ry),r.addSingleton(Br,Br),r.addSingleton(gd,dl),r.addSingleton(ms,ms),r.addBinding(ms,be),r.addSingleton(Iu,Iu),r.addSingleton(be,$y),r.addSingleton(be,ib),r.addSingleton(Mn,xf,Qe.ALL_VARIABLES),r.addSingleton(Mn,nb,Qe.KERNEL_VARIABLES),r.addSingleton(PT,ab,Qe.PYTHON_VARIABLES_REQUESTER),r.addSingleton(Ls,dd),r.addSingleton(be,yf),r.addSingleton(be,By),r.addSingleton(be,Oy),r.addSingleton(be,Ky),r.addSingleton(be,Jy),r.addSingleton(Ke,Wy),r.addSingleton(wm,Vy),r.addSingleton(be,cb),r.addSingleton(Ba,Ba),r.addBinding(Ba,be),hH(r,e),Qh("isInsiderExtension",$u()?"true":"false");let t=r.get(Ye);Qh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let n=r.get(fi);Qh("rawKernelSupported",n.isSupported?"true":"false"),r.addSingleton(be,tn),r.addSingleton(Go,qy),r.addSingleton(xu,xu),r.addSingleton(be,ub)}var Id=D(O()),gs=require("vscode");var pb=class{constructor(e,t,n,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=n;this.pythonApi=i;this.errorHandler=o;this.executingCells=new WeakSet}activate(){this.disposables.push(gs.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this)),this.disposables.push(gs.commands.registerCommand(J.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(gs.commands.registerCommand(J.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}onDidChangeNotebookCellExecutionState(e){e.cell.notebook.notebookType===xt&&(e.state===gs.NotebookCellExecutionState.Pending||e.state===gs.NotebookCellExecutionState.Executing?this.executingCells.add(e.cell):e.state===gs.NotebookCellExecutionState.Idle&&this.executingCells.delete(e.cell))}async installPythonViaKernelPicker(){N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[ve.install,ve.reload]:[ve.install],t=await gs.window.showErrorMessage(b.pythonNotInstalled,{modal:!0},...e);t===ve.install?(this.installedOnceBefore=!0,N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await gs.commands.executeCommand("python.installPython")):t===ve.reload?(N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await gs.commands.executeCommand("jupyter.reloadVSCode",b.reloadRequired)):N("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){N("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(b.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",n=await xr(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&n===t)return E("Python Extension installed via Kernel Picker command"),N("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;x("Failed to install Python Extension via Kernel Picker command"),N("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(b.failedToInstallPythonExtension)).then(f,f)}finally{e.dispose()}}}};pb=v([(0,Id.injectable)(),d(0,(0,Id.inject)(F)),d(1,(0,Id.inject)(Ye)),d(2,(0,Id.inject)(is)),d(3,(0,Id.inject)(tr)),d(4,(0,Id.inject)(en))],pb);var db=D(O()),Ef=require("vscode");var wf=class{constructor(e,t,n){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=n}activate(){Ef.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),Ef.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!Rt(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e);if(!t)return;let n=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(f),!0):!1};if(n())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&n()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){E(`Using notebook.selectKernel to force remote kernel for ${$(e.uri)} to ${t.id}`),await Ef.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:$e}),await zw(async()=>{if(Ef.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(f),!0}return!1},2e3,100)?E(`Successfully switched remote kernel for ${$(e.uri)} to ${t.id}`):W(`Failed to switch remote kernel for ${$(e.uri)} to ${t.id}`)}};v([Lr()],wf.prototype,"onDidOpenNotebook",1),wf=v([(0,db.injectable)(),d(0,(0,db.inject)(F)),d(1,(0,db.inject)(Ct)),d(2,(0,db.inject)(ss))],wf);var fb=D(O()),xd=require("vscode");var Fo=require("vscode");var JC=D(O()),lG=require("vscode");var sL=D(Ro()),sG=require("vscode");function iG(r){if(!r||!Array.isArray(r)||r.length===0)return;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=Array.apply(null,new Uint8Array(n.buffer));e.push({...n,byteLength:n.byteLength,byteOffset:n.byteOffset,buffer:i})}else e.push([...new Uint8Array(n)])}return e}function oG(r){if(!Array.isArray(r)||r.length===0)return r;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=new Uint8Array(n.buffer).buffer,o=new DataView(i,n.byteOffset,n.byteLength);e.push(o)}else{let i=new Uint8Array(n).buffer;e.push(i)}}return e}var qC=new WeakMap;function aG(r,e){let t=qC.get(r);t&&(t.targets.add(e),t.registerCommTarget(e))}function cG(r,e){qC.get(r)?.targets?.delete?.(e)}var _T=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new sG.EventEmitter;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.totalWaitTime=0;this.totalWaitedMessages=0;this.hookCount=0;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let n=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=n.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.sendOverheadTelemetry(),this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?x(`Widget Error: ${t.message}`):E(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(oG(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e))}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let n=t?no.get(t):void 0;if(n?.removeReceiveHook(this.onKernelSocketMessage),n?.removeSendHook(this.mirrorSend),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(s=>s.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(s=>s.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!no.get(e.session?.kernel?.id))return;qC.has(e.session.kernel)||qC.set(e.session.kernel,{targets:new Set,registerCommTarget:s=>{this.raisePostMessage("IPyWidgets_registerCommTarget",s)}}),this.kernelWasConnectedAtLeastOnce=!0;let i=e.session.kernel?.id,o=i?no.get(i):void 0;o?.addReceiveHook(this.onKernelSocketMessage),o?.addSendHook(this.mirrorSend),this.sendKernelOptions(),this.registerCommTargets(e),this.sendPendingMessages()}sendKernelOptions(){this.kernel?.session?.kernel&&this.raisePostMessage("IPyWidgets_kernelOptions",{id:this.kernel?.session?.kernel?.id||"",clientId:this.kernel?.session?.kernel?.clientId||"",userName:this.kernel?.session?.kernel?.username||"",model:this.kernel?.session?.kernel?.model||{id:"",name:""}})}async mirrorSend(e,t){if(typeof e=="string"&&e.includes("shell")&&e.includes("execute_request")){let n=Date.now(),i=this.deserialize(e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!B_(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o,this.totalWaitTime=Date.now()-n,this.totalWaitedMessages+=1}}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=le();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e){let t=(0,sL.default)(),n=le();if(this.waitingMessageIds.set(t,{startTime:Date.now(),resultPromise:n}),typeof e=="string"?B_(e)&&this.raisePostMessage("IPyWidgets_msg",{id:t,data:e}):this.raisePostMessage("IPyWidgets_binary_msg",{id:t,data:iG([e])}),typeof e!="string"||e.includes(qi)||e.includes(Qe.DefaultCommTarget)||e.includes("comm_open")||e.includes("comm_close")||e.includes("comm_msg")){let o=this.deserialize(e);if(!B_(o))return;o&&o.content&&o.content.data&&(o.content.data[qi]||o.content.target_name===Qe.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let s=o.header?.msg_type==="comm_open"&&o.content?.data?.state?._model_module==="@jupyter-widgets/output"&&o.content?.data?.state?._model_name==="OutputModel",a=o.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(o.content?.comm_id);s?this.outputWidgetIds.add(o.content.comm_id):a?this.outputWidgetIds.delete(o.content.comm_id):this.messageNeedsFullHandle(o)&&(this.fullHandleMessage={id:o.header.msg_id,promise:le()},await n.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),this.totalWaitTime+=Date.now()-t.startTime,this.totalWaitedMessages+=1,t.resultPromise.resolve())}sendPendingMessages(){if(this.kernel?.session?.kernel)for(;this.pendingMessages.length;)try{let e=this.pendingMessages[0],t=typeof e=="string"?JSON.parse(e):this.deserialize(e);t.buffers?.length&&(t.buffers=t.buffers.map(n=>n instanceof DataView?n.buffer:n)),t.channel==="control"?this.kernel.session.kernel.sendControlMessage(t):this.kernel.session.kernel.sendShellMessage(t),this.pendingMessages.shift()}catch(e){x("Failed to send message to Kernel",e);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let n=Array.from([...this.pendingTargetNames.values()]).shift();if(n){if(this.commTargetsRegistered.has(n))return;E(`Registering commtarget ${n}`),this.commTargetsRegistered.add(n),this.pendingTargetNames.delete(n),e.session?.kernel&&n!==Qe.DefaultCommTarget&&!qC.get(e.session.kernel)?.targets?.has(n)&&e.session.kernel.registerCommTarget(n,f)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){this.hookCount+=1;let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=le(),n=(0,sL.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(n,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:n,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}sendOverheadTelemetry(){N("DS_INTERNAL.IPYWIDGET_OVERHEAD",{totalOverheadInMs:this.totalWaitTime,numberOfMessagesWaitedOn:this.totalWaitedMessages,averageWaitTime:this.totalWaitTime/this.totalWaitedMessages,numberOfRegisteredHooks:this.hookCount})}};var aL=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new lG.EventEmitter;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},Pu=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new _T(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let n=[];e&&this.messagesPerNotebook.get(e)&&(n=this.messagesPerNotebook.get(e)||[]);let i=new aL(t,n);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,n=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),n?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};Pu=v([(0,JC.injectable)(),d(0,(0,JC.inject)(F)),d(1,(0,JC.inject)(Ke))],Pu);var pG=require("vscode");var uG=require("vscode");var mb=class mb extends ir{constructor(t,n,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=n;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(c=>this._register(c)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(n=>n.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async n=>{n.getWidgetScriptSources&&t.push(...await n.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,n){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let c=await a.getWidgetScriptSource(t,n,i);if(c.scriptUri){s=c;break}else W(`Widget Script Source not found for ${t}@${n} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,n,"",s.source).catch(f),s.scriptUri?E(`Script source for Widget ${t}@${n} was found from source ${s.source} and ${s.scriptUri}`):x(`Script source for Widget ${t}@${n} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,n,i,o){let s=`${t}.${t}@${n}`;if(mb.trackedWidgetModuleNames.has(s))return;mb.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),c=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),l=c?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=c?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;N("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await It(t),moduleName:l,modelName:u,source:o,moduleVersion:c?n:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new uG.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,n){if(n.direction==="recv"&&n.msg.header.msg_type==="comm_open"){let o=n.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(f)}}};v([Lr()],mb.prototype,"sendTelemetryForWidgetModule",1),v([Lr()],mb.prototype,"onAnyMessage",1);var RT=mb;var AT=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var NT=class{constructor(e,t,n,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new pG.EventEmitter;this.disposables=[];this.isWebViewOnline=le();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new So;this.uriConverter=new AT(cn(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,le()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(f),n.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let n=t;n&&this.uriTranslationRequests.has(n.request)&&this.uriTranslationRequests.get(n.request).resolve(n.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(f);else if(e==="IPyWidgets_IsOnline"){let n=t.isOnline;this.isWebViewOnline.resolve(n)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(f)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new RT(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),E("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>x("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){W("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:n,requestId:i}=e;if(ee(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,n,i).catch(o=>x("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,n,i).catch(x.bind(void 0,"Failed to send widget sources upon ready"))}}async sendWidgetSource(e,t="*",n){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:n});return}let i={moduleName:e,requestId:n};try{ee(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){x("Failed to get widget source due to an error",o),N("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{ee(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:n,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,n,i).catch(x.bind(`Failed to send WidgetScript for ${t}`))}}}};var OT=Symbol("IWidgetScriptSourceProviderFactory"),KT=Symbol("INbExtensionsPathProvider"),FT=Symbol("IIPyWidgetScriptManagerFactory"),$at=Symbol("IIPyWidgetScriptManager");var Pf=D(O()),Ko=require("vscode");var fG="https://unpkg.com/",lL="https://cdn.jsdelivr.net/npm/",LT="IPYWidgetCDNConfigured",dG="IPYWidgetNotFoundOnCDN",mG="IPYWidgetNoNetWorkAccess";function mye(r,e,t){let n=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),n=e.substr(0,o)),r===lL&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${r}${n}@${t}/dist/${i}`}function fye(r){switch(r){case"unpkg.com":return fG;case"jsdelivr.com":return lL;default:break}}var qa=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let n=(async()=>{let i=new il,o=Es(i.exists(`${fG}${e}`)),s=Es(i.exists(`${lL}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return n.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(f,f),this.isOnCDNCache.set(t,n),n}async getWidgetScriptSource(e,t,n){if(n===!1)return ne(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(f),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(LT,!1))return ne("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,n){let i=fye(n);if(i)return mye(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(ee(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(ee(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(x(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(f),{moduleName:e})}async getValidUri(e,t,n){try{let i=await this.generateDownloadUri(e,t,n),o=new il;if(i&&await o.exists(i))return i}catch{E(`Failed downloading ${e}:${t} from ${n}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(mG,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Ko.window.showWarningMessage(b.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),ve.ok,ve.doNotShowAgain,ve.moreInfo)){case ve.doNotShowAgain:return this.globalMemento.update(mG,!0);case ve.moreInfo:return Ko.env.openExternal(Ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(LT,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=le(),N("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await Ko.window.showInformationMessage(b.useCDNForWidgetsNoInformation,{modal:!0},ve.ok,ve.doNotShowAgain,ve.moreInfo),t="dismissed";switch(e){case ve.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(LT,!0)]);break}case ve.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(LT,!0)]);break}case ve.moreInfo:{Ko.env.openExternal(Ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===ve.cancel?"cancel":"dismissed";break}N("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){let t="widgetScriptSources";await this.configurationSettings.updateSetting(t,e,void 0,Ko.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(dG,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Ko.window.showWarningMessage(b.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),ve.ok,ve.doNotShowAgain,ve.reportThisIssue)){case ve.doNotShowAgain:return this.globalMemento.update(dG,!0);case ve.reportThisIssue:return Ko.env.openExternal(Ko.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};qa=v([(0,Pf.injectable)(),d(0,(0,Pf.inject)(He)),d(0,(0,Pf.named)(bt)),d(1,(0,Pf.inject)(ue))],qa);var $C=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new Fo.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(F),this.jupyterOutput=this.serviceContainer.get(Bo,Hu),this.configService=this.serviceContainer.get(ue),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(ne(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(f,f)}},this,this.disposables);let t=le(),n=async()=>{let i=new Je;if(!t.completed){let s=[],a=this.serviceContainer.get(Ke),c=le();a.get(this.document)?c.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&c.resolve(u)},this,s);let l=await c.promise;l&&(ft(l.kernelConnectionMetadata)?l.ipywidgetsVersion?t.completed||t.resolve(l.ipywidgetsVersion):l.onIPyWidgetVersionResolved(()=>{l.ipywidgetsVersion&&(t.completed||t.resolve(l.ipywidgetsVersion),z(s))},this,s):t.completed||t.resolve(KS)),s.length&&this.disposables.push(...s)}let o=await t.promise;E(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(f,f)};e.onDidReceiveMessage(async i=>{ne(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await n(),i.type==="IPyWidgets_Window_Alert"&&Fo.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&Fo.env.openExternal(Fo.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(E("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(f,f),n().catch(f)}onMessage(e,t,n){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(n).catch(f):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,n).catch(f):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(n).catch(f):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(n):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(n),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:n}),this.getIPyWidgetScriptSource().onMessage(t,n)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(f,f)}initialize(){this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{N("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await It(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let n=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)n=b.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),Fo.window.showErrorMessage(n).then(f,f);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=ve.moreInfo,c=b.enableCDNForWidgetsButton;n=b.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),Fo.window.showErrorMessage(n,{modal:!0},c,a).then(l=>{switch(l){case a:Fo.env.openExternal(Fo.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case c:this.enableCDNForWidgets(e).catch(f);break;default:break}},f)}x(`Widget load failure ${n}`,i,t),N("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await It(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await Fo.commands.executeCommand(J.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{N("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await It(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{x("Error rendering a widget: ",e),N("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(fl)}ee(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(b.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),N("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(Pu).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new NT(this.document,this.serviceContainer.get(Ke),this.serviceContainer.get(F),this.serviceContainer.get(ue),this.serviceContainer.get(OT),this.serviceContainer.get(qa)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){ne("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};v([Lr()],$C.prototype,"enableCDNForWidgets",1);var uL=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new xd.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){z(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},Sd=class{constructor(e,t,n){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=n;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){xd.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),xd.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),xd.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>{let i=this.notebookCommunications.get(n);this.notebookCommunications.delete(n),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(n),i&&i.dispose())}),t?.dispose()),xd.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>this.initializeNotebookCommunication(n,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!Rt(e.notebook))return;let n=e.notebook;if(!t){E(`No controller, hence notebook communications cannot be initialized for editor ${$(e.notebook.uri)}`);return}if(this.notebookCommunications.has(e))return;let i=new uL(e,t);this.addNotebookDisposables(n,[i]),this.notebookCommunications.set(e,i);let o=this.messageCoordinators.get(n);o||(o=new $C(n,this.serviceContainer),this.messageCoordinators.set(n,o)),o.attach(i)}addNotebookDisposables(e,t){let n=this.notebookDisposables.get(e)||[];n.push(...t),this.notebookDisposables.set(e,n)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let n=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,n)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];z(this.notebookDisposables.get(e)||[]),t.forEach(n=>this.notebookCommunications.get(n)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};Sd=v([(0,fb.injectable)(),d(0,(0,fb.inject)(pt)),d(1,(0,fb.inject)(F)),d(2,(0,fb.inject)(Ct))],Sd);var Cd=D(O());var hb=class{constructor(e,t,n,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=n;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:n}){t.isClosed||(n.connection.kind==="connectToLiveRemoteKernel"&&n.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id)),mt(n.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(f))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let n=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(E(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(f),this.liveKernelTracker.trackKernelIdAsUsed(t,n,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};hb=v([(0,Cd.injectable)(),d(0,(0,Cd.inject)(F)),d(1,(0,Cd.inject)(Ke)),d(2,(0,Cd.inject)(Ct)),d(3,(0,Cd.inject)(Tm)),d(4,(0,Cd.inject)(ss))],hb);var Df=D(O());var hG=require("vscode");var kf=class{constructor(e,t,n,i){this.disposables=e;this.uriStorage=t;this.controllers=n;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(n=>this.checkExpiredServersInJupyterCollection(n)),t.forEach(n=>this.removeControllersBelongingToDisposedProvider(n.extensionId,n.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(f),this,this.disposables));let t=new hG.CancellationTokenSource;this.disposables.push(t);try{let n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(n||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,n){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{n.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;mt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||n.includes(s.serverProviderHandle.handle)||(W(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(n=>{let i=n.connection;mt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(W(`Deleting controller ${n.id} as it is associated with a Provider Id that has been removed`),n.dispose())})}};v([Lr("Failed to check what servers were shutdown in Controller Watcher")],kf.prototype,"checkExpiredServersInJupyterCollection",1),kf=v([(0,Df.injectable)(),d(0,(0,Df.inject)(F)),d(1,(0,Df.inject)(Zt)),d(2,(0,Df.inject)(Ct)),d(3,(0,Df.inject)(Qt))],kf);var _f=D(O());var gG=require("vscode");var UT=class{constructor(e,t,n,i,o,s){this.label=e;this._description=t;this.detail=n;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new gG.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function vG(r){switch(r.kind){case"connectToLiveRemoteKernel":return b.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return b.kernelCategoryForRemoteJupyterKernel;default:return jT(r)}}function jT(r){switch(r.kind){case"startUsingLocalKernelSpec":return b.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Fn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return b.kernelCategoryForJupyterKernel;switch(Be(r.interpreter)){case"Conda":return wr(r.interpreter)?b.kernelCategoryForCondaWithoutPython:b.kernelCategoryForConda;case"PipEnv":return b.kernelCategoryForPipEnv;case"Poetry":return b.kernelCategoryForPoetry;case"Pyenv":return b.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return b.kernelCategoryForVirtual;default:return b.kernelCategoryForGlobal}}default:return""}}var gb=class{constructor(e,t,n,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=n;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=ht(e),o=BN(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=VN(e));let s=jT(e),a=e.kind==="connectToLiveRemoteKernel"?()=>VN(e):void 0,c=new UT(i,o,"",s,void 0,a);if(this.disposables.push(c),this.details.set(e.id,c),e.kind==="startUsingPythonInterpreter"&&wr(e.interpreter)){let l=u=>{let p=u.find(h=>h.id===e.interpreter?.id),m=Ti(ho().find(h=>h.id===p?.id));if(e.kind==="startUsingPythonInterpreter"&&m){e.updateInterpreter(m);let h=ht(e),g=BN(e,this.platform),y=jT(e),C=!1;h!==c.label&&(c.label=h,C=!0),g!==c.description&&(c.description=g,C=!0),y!==c.category&&(c.category=y,C=!0),C&&c.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?l([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=sy(e.serverProviderHandle,this.jupyterUriProviderRegistration,b.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let n=vG(e);return t.category!==n&&(t.category=n,t.triggerChange()),t}};gb=v([(0,_f.injectable)(),d(0,(0,_f.inject)(Dr)),d(1,(0,_f.inject)(Qt)),d(2,(0,_f.inject)(F)),d(3,(0,_f.inject)(st))],gb);var ku=D(O()),Du=require("vscode");var wd=D(O()),IG=require("vscode");var yG=require("vscode");function WT(r){try{return PP(vo(r))||r.getCells().find(t=>t.kind===yG.NotebookCellKind.Code)?.document.languageId}catch(e){W("Failed to determine language of first cell",e)}}var bG="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",vs=class{constructor(e,t,n){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=n}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,n=this.pythonExtensionChecker.isPythonExtensionInstalled?xe:"plaintext";return Tc(t||n)}activate(){IG.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(ft(e))return qj;{let t=Tc(Io(e)||"");return t&&MS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(bG)}async onDidSaveNotebookDocument(e){if(!Rt(e))return;let t=WT(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(bG,t)}};v([Lr("Saving last saved cell language")],vs.prototype,"onDidSaveNotebookDocument",1),vs=v([(0,wd.injectable)(),d(0,(0,wd.inject)(F)),d(1,(0,wd.inject)(He)),d(1,(0,wd.named)(bt)),d(2,(0,wd.inject)(Ye))],vs);function SG(r){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};r.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),N("DS_INTERNAL.KERNEL_COUNT",{...e})}var jt=require("vscode");var gl=require("vscode");var yi=Symbol("INotebookEditorProvider");var xG=require("vscode");async function CG(r,e){let t=e?.findNotebookEditor(r);return t?xG.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(x("Unable to select kernel as the Notebook document could not be identified"),!1)}var wG=require("vscode");var VT=class extends Nc{constructor(e){super(b.failedToStartAnUntrustedKernelSpec(ht(e),e.kernelSpec.specFile?$(wG.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var ia=class r{static async switchController(e,t){let i=t.get(yi).findNotebookEditor(e),o=t.get(Ct),s,a=le(),c=o.onControllerSelected(u=>a.resolve(u.controller));return await CG(e,t.get(yi))&&i&&(s=await a.promise),c.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await gl.window.showErrorMessage(b.cannotRunCellKernelIsDead(ht(e.kernelConnectionMetadata)),{modal:!0},b.showJupyterLogs,b.restartKernel),n=!1;switch(t){case b.restartKernel:{await e.restart(),n=!0;break}case b.showJupyterLogs:gl.commands.executeCommand(J.ViewJupyterOutput).then(f,f)}return n}static async handleKernelError(e,t,n,i,o,s,a,c){let l=e.get(He,bt),u=e.get(en);a.interpreter&&n==="start"&&y8(l,19,a.interpreter.uri).catch(f);let p=await u.handleKernelError(t,n,a,i,c),m=mt(a);switch(e.tryGet(fi)?.isSupported&&m&&n==="start"&&At(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:p}),o.dispose().catch(f),p){case 1:case 2:throw t;case 3:{let y=await r.switchController(i,e);if(!y)throw t;s=y.controller,a=y.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return n=>n.start(t);case"interrupt":return n=>n.interrupt();case"restart":return n=>n.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,n,i,o,s,a){let{kernel:c,deadKernelAction:l}=await i;if(q_(c)){if(this.deleteKernelInfo(t,i),l==="deadKernelWasNoRestarted")throw new od(c.kernelConnectionMetadata);return l==="deadKernelWasRestarted"?c:r.wrapKernelMethod(c.kernelConnectionMetadata,"start",o,e,t,n,a,s)}return c}static async wrapKernelMethod(e,t,n,i,o,s,a,c=()=>void 0){let l=this.getKernelInfo(o);if(!s.disableUI&&l?.options.disableUI&&(l.options.disableUI=!1),!s.disableUI&&l?.kernel.resolved&&(l?.kernel.value?.kernel?.disposed||l?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),l=void 0),l&&t!=="restart"&&t!=="interrupt")return r.verifyKernelState(i,o,s,l.kernel.promise,n,c,a);E(`${t} the kernel, options.disableUI=${s.disableUI} for ${$("notebook"in o?o.notebook.uri:o.resource)}`);let u=r.wrapKernelMethodImpl(e,t,i,o,s,n,c),p=Es(u);return p.promise.catch(f),u.then(m=>{m.kernel.onDisposed(()=>{this.deleteKernelInfo(o,p.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,p.promise)}),this.setKernelInfo(o,p,s),r.verifyKernelState(i,o,s,p.promise,n,c,a)}static getKernelInfo(e){return"notebook"in e?r.connectionsByNotebook.get(e.notebook):r.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,n){"notebook"in e?r.connectionsByNotebook.set(e.notebook,{kernel:t,options:n}):r.connectionsByUri.set(e.resource.toString(),{kernel:t,options:n})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?r.connectionsByNotebook.delete(e.notebook):r.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&r.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?r.connectionsByNotebook.delete(e.notebook):e.resource&&r.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&r.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!mt(e)||!e.kernelSpec.specFile)return;if(!t.get(gd).isTrusted(gl.Uri.file(e.kernelSpec.specFile)))throw new VT(e)}static async wrapKernelMethodImpl(e,t,n,i,o,s,a){let c=n.get(Ke),l=n.get(wm),u,p=r.convertContextToFunction(t,o),m=t,h="controller"in i?i.controller:void 0;for(t==="start"&&r.verifyWeCanStartKernel(e,n);u===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new gl.CancellationError;u="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:h||i.controller,resourceUri:i.resource}):l.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});try{if(t!=="restart"&&q_(u)&&!o.disableUI){let g=await r.notifyAndRestartDeadKernel(u);return{kernel:u,deadKernelAction:g?"deadKernelWasRestarted":"deadKernelWasNoRestarted"}}else{if(a(m,u),await p(u),"notebook"in i&&i.notebook.isClosed)throw new gl.CancellationError;q_(u)&&!o.disableUI&&m!=="interrupt"&&await r.notifyAndRestartDeadKernel(u)}}catch(g){if(hr(g)||W(`Error occurred while trying to ${m} the kernel, options.disableUI=${o.disableUI}`,g),o.disableUI)throw g;if("notebook"in i&&i.notebook.isClosed)throw new gl.CancellationError;let y=await r.handleKernelError(n,g,m,i.resource,u,h,e,s);if(h=y.controller,e=y.metadata,p=C=>C.start(o),m="start",s==="3rdPartyExtension")throw g;u=void 0}}return{kernel:u}}static async connectToNotebookKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}static async connectToKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}};var Tf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var qT=require("vscode");var BT=class extends ir{constructor(t,n,i){super();this.kernel=t;this.controller=n;this.notebook=i}initialize(){let t=this.kernel,n=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!n.createNotebookExecution)return;this._register(qT.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(n.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=n.createNotebookExecution(i);o.start(),this._register(new qT.Disposable(()=>o.end()))}};var kG=require("vscode");var JT=class{constructor(){this.cache=new Map;this.executionCount=0}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,n){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,n)}},EG=JT,PG=JT;var $T=class{constructor(e,t,n,i){this.variables=e;this.kernelProvider=t;this.controllerId=n;this.variableResultCache=new EG;this.variableSummaryCache=new PG;this.runningKernels=new Set;this._onDidChangeVariables=new kG.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event;i.push(this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this))}onKernelStatusChanged({kernel:e}){if(e.controller.id!==this.controllerId)return;let t=this.runningKernels.has(e.notebook.uri.toString());e.status==="idle"&&!t?this.runningKernels.add(e.notebook.uri.toString()):e.status!=="busy"&&e.status!=="idle"&&t&&(this.runningKernels.delete(e.notebook.uri.toString()),this._onDidChangeVariables.fire(e.notebook))}_getVariableResultCacheKey(e,t,n){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${n}`),`${e}:${i}`}async*provideVariables(e,t,n,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s||s.status==="dead"||s.status==="terminating")return;let a=this.kernelProvider.getKernelExecution(s).executionCount,c=this._getVariableResultCacheKey(e.uri.toString(),t,i),l=this.variableResultCache.getResults(a,c);if(t){let u=t;if(!l&&u.getChildren)l=(await u.getChildren(i,o)).map(m=>this.createVariableResult(m,s)),this.variableResultCache.setResults(a,c,l);else if(!l)return;for(let p of l)yield p;if(n===2&&u.count&&l.length>0&&u.count>i+l.length)for await(let p of this.provideVariables(e,t,n,i+l.length,o))yield p}else{l||(l=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(p=>this.createVariableResult(p,s)),this.variableResultCache.setResults(a,c,l));for(let u of l)yield u}}_getVariableSummaryCacheKey(e,t){return`${e}:${t.name}`}async*provideVariablesWithSummarization(e,t,n,i,o){let s=this.kernelProvider.get(e),a=this.provideVariables(e,t,n,i,o);for await(let c of a)if(s&&s.status!=="dead"&&s.status!=="terminating"){let l=this._getVariableSummaryCacheKey(e.uri.toString(),c.variable),u=this.kernelProvider.getKernelExecution(s).executionCount,p=this.variableSummaryCache.getResults(u,l);p==null&&(p=await this.variables.getVariableValueSummary({name:c.variable.name,value:c.variable.value,supportsDataExplorer:!1,type:c.variable.type??"",size:0,count:0,shape:"",truncated:!0},s,o),this.variableSummaryCache.setResults(u,l,p??null)),yield{hasNamedChildren:c.hasNamedChildren,indexedChildrenCount:c.indexedChildrenCount,variable:{name:c.variable.name,value:c.variable.value,expression:c.variable.expression,type:c.variable.type,language:c.variable.language,summary:p}}}}createVariableResult(e,t){let n=e.count??0,i=!!e.hasNamedChildren,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),expression:hye(e.root,e.propertyChain),...e};return{variable:o,hasNamedChildren:i,indexedChildrenCount:n}}async getChildren(e,t,n,i){let o=e;return await this.variables.getAllVariableDiscriptions(n,o,t,i)}};function hye(r,e){let t=r;for(let n of e)typeof n=="string"?t+=`.${n}`:t+=`[${n}]`;return t}var HT=class r{constructor(e,t,n,i,o,s,a,c,l,u,p,m){this.kernelConnection=e;this._viewType=n;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=c;this.extensionChecker=l;this.serviceContainer=u;this.displayDataProvider=p;this._onNotebookControllerSelectionChanged=new jt.EventEmitter;this._onConnecting=new jt.EventEmitter;this.pendingCellAdditions=new Map;this._onDidDispose=new jt.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new Map;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;s.push(this),this._onNotebookControllerSelected=new jt.EventEmitter,this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=jt.notebooks.createNotebookController(t,n,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.supportedLanguages.includes("python")&&(this.controller.variableProvider=new $T(m,this.kernelProvider,this.controller.id,this.disposables)),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),jt.workspace.onDidCloseNotebookDocument(h=>{this.associatedDocuments.delete(h)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelected(){return this._onNotebookControllerSelected.event}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,n,i,o,s,a,c,l,u,p,m){return new r(e,t,n,i,o,s,a,c,l,u,p,m)}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Yt(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new BT(t,this.controller,e);this.disposables.push(u),u.initialize()}let n=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Ba).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||n.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==jt.NotebookCellKind.Code)return;let s=!1,a=[],c,l=(u,p)=>{if(!(p.direction==="send"||s)&&yu(p.msg)===o.msg_id){if("msg_type"in p.msg&&p.msg.msg_type==="status"&&"execution_state"in p.msg.content&&p.msg.content.execution_state==="idle")return;s=!0,n.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(f),z(a)}};t.session.kernel.anyMessage.connect(l),c=new jt.Disposable(()=>{On(()=>t.session?.kernel?.anyMessage.disconnect(l))}),a.push(c),this.disposables.push(c)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=ht(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let n=e&&"message"in e?e.message:"";return ne(`\x1B[32mPosting message to Notebook UI ${n}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==yt)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=jt.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());E(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),ne(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelected.dispose(),this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),z(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){e.length<1||(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(n=>n.index<0?(W(`Attempting to run a cell with index ${n.index}, kind ${n.kind}, text = ${n.document.getText()}`),!1):!0),jt.workspace.isTrusted&&(ee(`Handle Execution of Cells ${e.map(n=>n.index)} for ${$(t.uri)}`),await as(t.uri,this.connection),await Promise.all(e.map(n=>this.executeCell(t,n)))))}async onDidChangeSelectedNotebooks(e){if(ne(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let n=this.kernelProvider.get(e.notebook);n?.kernelConnectionMetadata.id===this.kernelConnection.id&&(ee(`Disposing kernel ${this.kernelConnection.id} for notebook ${$(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),n.dispose().catch(f)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire(e);return}if(!Rt(e.notebook)&&e.notebook.notebookType!==yt||!jt.workspace.isTrusted)return;gye(this.kernelConnection);let t=le();ne(`Controller ${this.connection.kind}:${this.id} associated with nb ${$(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelected.fire({notebook:e.notebook,controller:this}),this._onNotebookControllerSelectionChanged.fire(e),E("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=ft(this.kernelConnection)?xe:t[0];await Promise.all(e.getCells().filter(o=>o.kind===jt.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await jt.languages.setTextDocumentLanguage(o.document,i).then(f,f)}))}getRendererScripts(){return this.context.extensionMode===jt.ExtensionMode.Development||this.context.extensionMode===jt.ExtensionMode.Test?[new jt.NotebookRendererScript(jt.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){E(`VS Code interrupted kernel for ${$(e.uri)}`),e.getCells().forEach(t=>St(t,"Cell cancellation requested")),jt.commands.executeCommand(J.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(f,t=>x("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let n=this.runningCellExecutions.get(e.notebook);if(!n||n.cell===e){n?.end(void 0,void 0),n=Ri.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,n);let i=n.end.bind(n);n.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return n}async executeCell(e,t,n){let i=new ci,o=i.add(new jt.CancellationTokenSource);i.add(jt.workspace.onDidCloseNotebookDocument(m=>m===e?o.cancel():void 0));let s=this.createCellExecutionIfNecessary(t,new Tf(this.controller)),a="start",c,l=new Tf(this.controller),u=!1,p=this.serviceContainer.get(Ba);try{if(c=await this.connectToKernel(e,new Yt(!1)),c.disposing)throw new jt.CancellationError;u=!0,c&&c.controller.id!==l.id&&(l=c.controller,s=this.createCellExecutionIfNecessary(t,c.controller)),a="execution",c.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(c,e),p.trackCellExecution(t,c);let h=this.kernelProvider.getKernelExecution(c).executeCell(t,n);return h.then(()=>{if(c&&!TS.isExiting)return p.deleteTrackedCellExecution(t,c)}).catch(f),await h}catch(m){if(m instanceof hd)return;hr(m)||x("Error in execution",m),u||(s.start(),s.clearOutput(t).then(f,f));let h=this.serviceContainer.get(en);m=ln.unwrap(m);let g=hr(m)||m instanceof od;await gp(t,l,await h.getErrorMessageForDisplayInCell(m,a,e.uri),g)}finally{i.dispose()}}async connectToKernel(e,t){return this._onConnecting.fire(),ia.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables)}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let n=[];jt.workspace.onDidCloseNotebookDocument(s=>{s===t&&z(n)},this,n);let i=e.onDisposed(()=>z(n)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await DG(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&z(n))});n.push({dispose:()=>o.dispose()}),n.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,n=this.kernelProvider.get(e);if(n&&y9(n.kernelConnectionMetadata,t)){ee("Switch kernel did not change kernel.");return}if(At(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),n&&jt.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await DG(e,t),e.notebookType===yt)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(E(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),ft(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(gd);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&mt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(jt.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Yt(!0)).catch(f)}};async function DG(r,e,t){let n=vo(r)||{},{changed:i}=await d9(n,e,t);i&&await n9(r,n)}async function gye(r){let e=await lp(r.interpreter,!0),t=e?.major||0,n=e?.minor||0;!e||t>=4||t<=0||n<=-1||r.kind!=="startUsingLocalKernelSpec"&&r.kind!=="startUsingPythonInterpreter"||(t<3||t===3&&n<=5)&&jt.window.showWarningMessage(b.warnWhenSelectingKernelWithUnSupportedPythonVersion,ve.learnMore).then(i=>{if(i===ve.learnMore)return Kp("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},f)}var vb=class{constructor(e,t,n,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=n;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new Du.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new Du.EventEmitter;this.selectionChangedEmitter=new Du.EventEmitter;this.selectedControllers=new Map;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.onDidChange(({added:e})=>{e.forEach(t=>{t.onNotebookControllerSelectionChanged(n=>{!n.selected&&this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(W(`Removing controller ${t.id} for ${t.connection.kind} from kernel list`),t.dispose())},this,this.disposables)})},this,this.disposables),Du.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),Du.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebookDocument(e).catch(f)),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),SG(this.registered.map(e=>e.connection)),ne(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async onDidOpenNotebookDocument(e){e.notebookType!==xt&&e.notebookType!==yt||Du.workspace.isTrusted}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(n=>{let i=e.some(o=>o.id===n.connection.id)||ni&&this._activeInterpreterControllerIds.has(n.id);return!i&&n.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(n)?(i||E(`Controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}' is no longer a valid`),!i):!1}).forEach(n=>{W(`Disposing old controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}'`),n.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[xt,yt])}catch(t){if(!hr(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:n})=>{let i=new Set((n||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{W(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(n=>{n.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(n=>{Ft(n.connection)&&n.connection.serverProviderHandle.id===t.id&&n.connection.serverProviderHandle.handle===t.handle&&(W(`Deleting controller ${n.id} as it is associated with a connection that has been removed`),n.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.filter(t=>!this.isFiltered(t)).forEach(t=>this.addOrUpdate(t,[xt,yt])),this.registered.forEach(t=>{this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(W(`Deleting controller ${t.id} as it is associated with a connection that has been hidden`),t.dispose())})}batchAdd(e,t){let n=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);n.push(...o)}),n.length&&this.changeEmitter.fire({added:n,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e.uri.toString())}addOrUpdate(e,t){let{added:n,existing:i}=this.addImpl(e,t,!0);return n.concat(i)}addImpl(e,t,n){let i=[],o=[];ne(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),ne(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):this.isFiltered(e)?(ne(`Existing controller '${s}' will be excluded as it is filtered`),!1):(ne(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let c=HT.create(e,s,a,this.serviceContainer.get(Ke),this.serviceContainer.get(ut),this.disposables,this.serviceContainer.get(vs),this.serviceContainer.get(ue),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(Cp),this.serviceContainer.get(Mn,Qe.KERNEL_VARIABLES)),l=[];c.onDidDispose(()=>{ne(`Deleting controller '${c.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(c.id),l.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(c),this.registeredControllers.set(c.id,c),i.push(c),c.onNotebookControllerSelected(u=>{ne(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook.uri.toString(),u.controller),this.selectedEmitter.fire(u)},this,l),c.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:c}),this,l)}),n&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(hr(s,!0))return{added:i,existing:o};x(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let n=this.getControllerId(e,t);return this.registeredControllers.get(n)}isFiltered(e){return!1}getControllerId(e,t){return t===xt?e.id:`${e.id}${V9}`}isControllerAttachedToADocument(e){return Du.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};vb=v([(0,ku.injectable)(),d(0,(0,ku.inject)(F)),d(1,(0,ku.inject)(pi)),d(2,(0,ku.inject)(Ye)),d(3,(0,ku.inject)(pt)),d(4,(0,ku.inject)(Zt)),d(5,(0,ku.inject)(Mr))],vb);var Ed=D(O());var GT=class{constructor(e,t,n){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=n;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var _G=require("vscode"),zT=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return _G.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let n=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!n&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return n||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async n=>({moduleName:n,scriptUri:e[n].toString(),source:"remote"}))):[]}};var yb=class{constructor(e,t,n){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=n}getProviders(e,t){let n=[];switch(n.push(new qa(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":n.push(new zT(e,this.widgetScriptManagerFactory));break;default:n.push(new GT(e,t,this.widgetScriptManagerFactory))}return n}};yb=v([(0,Ed.injectable)(),d(0,(0,Ed.inject)(ue)),d(1,(0,Ed.inject)(FT)),d(2,(0,Ed.inject)(He)),d(2,(0,Ed.named)(bt))],yb);var TG=D(O()),QT=require("vscode");var bb=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return QT.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":{let t=await Ea(e.kernelConnectionMetadata.interpreter);return t?QT.Uri.joinPath(QT.Uri.file(t),"share","jupyter"):void 0}default:return}}};bb=v([(0,TG.injectable)()],bb);var _u=D(O());var Rf=require("vscode");var mL=require("vscode");var BG=D(WG());var VG=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function Iye(r,e,t){let n=[...VG],i=await It(e),o=0,s;for(;o<=0&&n.length&&(s=n.pop(),!!s);)o=t.indexOf(s);if(o<0){let m=[...VG].map(h=>h.substring(0,h.length-2));for(;o<=0&&m.length&&(s=m.pop(),!!s);)o=t.indexOf(s)}if(o<0){N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let c=t.indexOf("{",o),l=t.substring(c,a);l=(0,BG.default)(l,{language:"javascript"}),l=Fe(l,{trim:!0,removeEmptyEntries:!0}).join("");let u=l.split("{")[l.split("{").length-1].split("}")[0].split(",").map(m=>m.trim()).filter(m=>m.length&&m.includes(":")),p={};if(u.forEach(m=>{let h=m.split(":"),g=pm(h[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),y=pm(m.substring(m.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();p[g]=y.startsWith("http")?mL.Uri.parse(y):mL.Uri.joinPath(r,y)}),!p||!Object.keys(p).length){N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return N("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(p).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),p}var Ib=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){z(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,n){let i=await this.getWidgetScriptSource(t);try{let o=await Iye(e,n,i);if(!o){let s=`Failed to extract require.config from widget for ${n} from ${$(t)}`;ni&&(s+=`with contents ${i}`),W(s)}return o}catch(o){x(`Failed to extract require.config entry for ${n} from ${$(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new Je,[t,n]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!n)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(n,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),N("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:mt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var e0=class extends Ib{constructor(t,n,i,o){super(t);this.context=n;this.fs=i;this.connection=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(f)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return Rf.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(Rf.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!ft(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return ne("No Kernel session to get list of widget entry points"),[];let n=[];n.push(bn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!ni&&this.context.extensionMode===Rf.ExtensionMode.Production&&n.push(Ci(1e4).then(()=>[])),n.forEach(s=>s.catch(f));let i=await Promise.race(n);if(i.length===0)return ne("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return ne("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return E(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>pm(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:Rf.Uri.joinPath(Rf.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:dt(a)}))}catch(s){return x(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let n=this.getWidgetScriptSourceUsingHttpClient(t),i=this.getWidgetScriptSourceUsingFetch(t);return n.catch(()=>i)}async getWidgetScriptSourceUsingHttpClient(t){let n=t.toString(!0),o=await new il().downloadFile(n);if(o.status===200)return o.text();throw x(`Error downloading from ${n}: ${o.statusText}`),new Error(`Error downloading from ${n}: ${o.statusText}`)}async getWidgetScriptSourceUsingFetch(t){let n=await this.connection.createConnectionInfo(this.kernelConnection.serverProviderHandle),i=t.toString(!0),s=await new il(n.settings.fetch).downloadFile(i);if(s.status===200)return s.text();throw x(`Error downloading from ${i} using custom fetch: ${s.statusText}`),new Error(`Error downloading from ${i} using custom fetch: ${s.statusText}`)}};var Sb=require("vscode");var t0=class r extends Ib{constructor(t,n,i,o,s){super(t);this.fs=n;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!r.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let n=new Je;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){W(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await It(this.kernel.kernelConnectionMetadata.id),o=Sb.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=Sb.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),c=a.map(l=>Sb.Uri.joinPath(l,"nbextensions"));c.reverse();for(let l of c)await this.fs.exists(l)&&await this.fs.copy(l,s,{overwrite:t});return this.overwriteExistingFiles=!1,r.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),N("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:n.elapsedTime}),o}catch(n){throw N("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,n),n}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let n=Sb.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("*/extension.js",n.fsPath,!0)).map(o=>({uri:Sb.Uri.joinPath(n,o),widgetFolderName:dt(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var xb=class{constructor(e,t,n,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=n;this.jupyterPaths=i;this.disposables=o;this.connection=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new e0(e,this.context,this.fs,this.connection);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new t0(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};xb=v([(0,_u.injectable)(),d(0,(0,_u.inject)(KT)),d(1,(0,_u.inject)(vr)),d(2,(0,_u.inject)(ut)),d(3,(0,_u.inject)(Br)),d(4,(0,_u.inject)(F)),d(5,(0,_u.inject)(pn))],xb);var r0=D(O()),Ja=require("vscode");var oa=class{constructor(e){this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){Ja.workspace.onDidChangeNotebookDocument(this.onDidChangeNotebookDocument,this,this.disposables)}onDidChangeNotebookDocument(e){Rt(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(n=>n.items&&n.items.some(i=>i.mime===qi)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!Ja.workspace.isTrusted)return;let e=Ja.extensions.getExtension(Ih);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let n=t.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){oa.messageDisplayed||(oa.messageDisplayed=!0,Ja.window.showInformationMessage(b.rendererExtensionRequired,{modal:!0},ve.bannerLabelYes).then(e=>{e===ve.bannerLabelYes&&Ja.commands.executeCommand("extension.open",Ih).then(f,f)}).then(f,f))}displayUpdateMessage(){oa.messageDisplayed||(oa.messageDisplayed=!0,Ja.window.showInformationMessage(b.rendererExtension1015Required,{modal:!0},ve.bannerLabelYes).then(e=>{e===ve.bannerLabelYes&&Ja.commands.executeCommand("extension.open",Ih).then(f,f)}).then(f,f))}};oa.messageDisplayed=!1,oa=v([(0,r0.injectable)(),d(0,(0,r0.inject)(F))],oa);function qG(r,e){r.addSingleton(Pu,Pu),r.addSingleton(OT,yb),r.addSingleton(FT,xb),r.addSingleton(KT,bb),r.addSingleton(qa,qa),r.addSingleton(be,oa)}var kd=D(O()),qr=require("vscode");var Cb=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=n;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){z(this.localDisposables)}activate(){if(!cn()){this.localDisposables.push(qr.notebooks.registerKernelSourceActionProvider(xt,{provideNotebookKernelSourceActions:()=>[{label:b.localPythonEnvironments,documentation:qr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(qr.notebooks.registerKernelSourceActionProvider(yt,{provideNotebookKernelSourceActions:()=>[{label:b.localPythonEnvironments,documentation:qr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],n=new qr.EventEmitter;this.localDisposables.push(qr.notebooks.registerKernelSourceActionProvider(xt,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(qr.notebooks.registerKernelSourceActionProvider(yt,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>bg(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:b.localKernelSpecs,documentation:qr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],n.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(qr.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(qr.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(qr.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),Pe.instance.get(Qt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=Pe.instance.get(Qt),t=new Set;e.jupyterCollections.map(n=>{let i=`${n.extensionId}:${n.id}`;if(n.id===Jw||(t.add(i),this.providerMappings.has(i)))return;let o=qr.notebooks.registerKernelSourceActionProvider(xt,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]}),s=qr.notebooks.registerKernelSourceActionProvider(yt,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:n})}),this.providerMappings.forEach(({disposables:n},i)=>{t.has(i)||(z(n),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||qr.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await Pe.instance.get(Rm).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await Pe.instance.get(WP).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,n){if(n=n||qr.window.activeNotebookEditor?.notebook,!n&&qr.window.activeTextEditor&&(n=this.notebookEditorProvider.findNotebookEditor(qr.window.activeTextEditor.document.uri)?.notebook),!n)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await Pe.instance.get(jP).selectRemoteKernel(n,o);return this.getSelectedController(n,a)}async getSelectedController(e,t){if(!t)return;let n=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(n)||n.length===0){W(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}as(e.uri,t).finally(()=>At(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(f),n.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,qr.NotebookControllerAffinity.Preferred);let i=n[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(mt(t.connection)&&ft(t.connection)&&wr(t.connection.interpreter)&&!cn()){let n=[];try{let i=new qr.CancellationTokenSource;n.push(i);let o=new Yt(!1);n.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){x(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{z(n)}}}};Cb=v([(0,kd.injectable)(),d(0,(0,kd.inject)(Ct)),d(1,(0,kd.inject)(Mr)),d(2,(0,kd.inject)(yi)),d(3,(0,kd.inject)(Ls)),d(4,(0,kd.inject)(F))],Cb);var Af=D(O()),s0=require("vscode");var vl=require("vscode");var n0=require("vscode");var Dd=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){z(this.disposables)}async findPreferredRemoteKernelConnection(e,t,n){return this.findPreferredRemoteKernelConnectionImpl(e,t,n,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,n,i){let o=await Pe.instance.get(ss).getPreferredRemoteKernelId(e),s=async()=>{let c=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(c)return c;if(t.status==="idle")return;let l=await new Promise(u=>t.onDidChangeKernels(()=>{let p=t.kernels.find(m=>m.kind==="connectToLiveRemoteKernel"&&m.id===o);p&&u(p),(t.status==="idle"||n.isCancellationRequested)&&u(void 0)},this,this.disposables));if(l)return l};if(o){let c=await s();if(c||i)return c}let a=t.kernels.find(c=>Ft(c))?.serverProviderHandle;if(a){let c=await this.jupyterConnection.createConnectionInfo(a),l=(e.uri,void 0),u=l&&t.kernels.find(p=>Ft(p)&&p.kind==="connectToLiveRemoteKernel"&&p.kernelModel.model&&p.kernelModel.model.path===l.path&&p.kernelModel.model.name===l.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,n,i)}async findPreferredLocalKernelSpecConnection(e,t,n){return this.findPreferredKernelSpecConnection(e,t,n,!1)}async findPreferredKernelSpecConnection(e,t,n,i){let s=vo(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.name===s):[];if(u.length||i)return u;let p=WT(e);if(p)return t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.language&&(m.kernelSpec.language===p||Tc(m.kernelSpec.language)===Tc(p)))},c=a();if(Array.isArray(c)&&c.length)return i&&c.length>1?void 0:c[0];if(t.status==="idle")return;let l=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(n.isCancellationRequested)return u(void 0);let p=a();if(Array.isArray(p)&&p.length)return i&&p.length>1?u(void 0):u(p[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>z(l))}async findPreferredPythonKernelConnection(e,t,n){return this.findPreferredPythonKernelConnectionImpl(e,t,n)}async findPreferredPythonKernelConnectionImpl(e,t,n){t=t||Pe.instance.get(Mr).registered.find(l=>l.kind==="localPythonEnvironment");let i=Pe.instance.get(st),o=fL(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!n.isCancellationRequested)return t.kernels.filter(l=>l.kind==="startUsingPythonInterpreter").map(l=>l).find(l=>l.interpreter.id===s.id)},c=a();if(c)return c;if(t.status==="discovering")return await new Promise(l=>{t.onDidChangeStatus(()=>t.status==="idle"&&l(),this,this.disposables),t.onDidChangeKernels(()=>(fL(e,t)||a())&&l(),this,this.disposables)}),fL(e,t)||a()}};function fL(r,e){let t=n0.workspace.getWorkspaceFolder(r.uri)?.uri||(n0.workspace.workspaceFolders?.length===1?n0.workspace.workspaceFolders[0].uri:void 0),n=JG(Ei(r.uri),e);if(n)return n;if(t)return JG(t,e)}function JG(r,e){let n=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>rv(Nr(a.interpreter)?.environment?.folderUri?.fsPath||a.interpreter.uri.fsPath,r.fsPath)),i=n.find(a=>Be(a.interpreter)==="Venv"&&qo(a.interpreter)?.toLowerCase()===".venv");if(i)return i;let o=n.find(a=>Be(a.interpreter)==="Conda"&&qo(a.interpreter)?.toLowerCase()===".venv");if(o)return o;let s=n.find(a=>qo(a.interpreter)?.toLowerCase()===".venv");return s||(n.length?n[0]:void 0)}var i0=class{constructor(e,t,n,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new vl.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new vl.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new vl.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new vl.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new vl.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=b.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),um(n)?n.then(s=>this.setupFinder(s)).catch(s=>x(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(n)}dispose(){z(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>x(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>x(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=b.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=b.quickPickSelectPythonEnvironmentTitle;break;default:this.title=b.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new vl.CancellationTokenSource;this.disposables.push(new vl.Disposable(()=>t.cancel())),this.disposables.push(t);let n=new Dd(this.connection);this.disposables.push(n),e.kind==="remote"?this.computePreferredRemoteKernel(e,n,t.token):this.computePreferredLocalKernel(e,n,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(n=>n.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(n.interpreter)):e}computePreferredRemoteKernel(e,t,n){t.findPreferredRemoteKernelConnection(this.notebook,e,n).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>x(`Preferred connection failure ${$(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,n){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,n).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>x(`Preferred connection failure ${$(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var _d=require("vscode");function yl(r){return"connection"in r}function Sye(r){return"command"in r}function xye(r,e,t){let n=t?[t]:r.activeItems.length?[r.activeItems[0]]:[];if(n.length&&!e.includes(n[0])){let i=n[0],o=yl(i)&&e.find(s=>yl(s)&&s.connection.id===i.connection.id);o?n[0]=o:n.length=0}r.items=e,r.activeItems=n}var hL=class extends Error{},o0=class extends ir{constructor(t,n){super();this.provider=t;this.token=n;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=Pe.instance.get(Cp)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,n){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:_d.QuickPickItemKind.Separator,label:b.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,n)}async selectKernelImplInternal(t,n){let i={iconPath:new _d.ThemeIcon("refresh"),tooltip:ve.refresh},o={iconPath:new _d.ThemeIcon("loading~spin"),tooltip:ve.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let p=s.buttons;s.buttons=p.filter(m=>m!==i).concat(o),await this.provider.refresh().catch(f),s.buttons=p}}});n.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let c;this._register(this.provider.onDidChangeStatus(()=>{switch(c&&clearTimeout(c),this.provider.status){case"discovering":s.busy=!0;break;case"idle":c=setTimeout(()=>s.busy=!1,500),this._register(new _d.Disposable(()=>c&&clearTimeout(c)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let l=await a;if(!this.token.isCancellationRequested){if(Sye(l))try{let u=await l.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof hL)return{selection:"userPerformedSomeOtherAction"};if(u===Ne.back)return this.selectKernelImplInternal(t,n);throw u}if(l&&"connection"in l)return{selection:"controller",connection:l.connection};if(l&&"error"in l)throw Ne.back}}updateQuickPickItems(t){t.title=this.provider.title;let n=new Set(t.items.filter(u=>yl(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!n.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,p)=>u.label.localeCompare(p.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),c=s.size;i.forEach(u=>{let p=a.get(u.connection.id);p&&s.delete(p),s.add(u)});let l=Array.from(s);l.sort((u,p)=>u.label.localeCompare(p.label)),this.quickPickItems.splice(o+1,c,...l),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommendedItems.find(a=>yl(a)),i=new Set(this.recommendedItems.filter(yl).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!yl(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;n&&yl(n)&&s&&(yl(s)?s.connection.id!==n.connection.id&&(n=void 0):n=void 0),xye(t,this.recommendedItems.concat(o),n)}removeMissingKernels(t){let n=t.items.filter(s=>yl(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=n.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:b.recommendedItemCategoryInQuickPick,kind:_d.QuickPickItemKind.Separator});let n=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=n:this.recommendedItems.push(n),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let n=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!yl(i)||!n.has(i.connection.id))return;let o=n.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,n=!1){let i=n?"$(star-full) ":"",o=(c,l,u)=>{c.label=`${i}${l.label}`,c.detail=l.detail,c.description=l.description,this.quickPickItems.forEach(p=>{"connection"in p&&p.connection.id===u.id&&(p.label=l.label,p.detail=l.detail,p.description=l.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:n,connection:t};return o(a,s,t),this._register(s.onDidChange(c=>o(a,c,t),this)),a}};var wb=class{constructor(e,t,n,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=n;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==xt&&e.notebookType!==yt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new s0.CancellationTokenSource;let t=this.multiStepFactory.create(),n={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,n),n)===Ne.cancel||n.selection?.type==="userPerformedSomeOtherAction")throw new s0.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(n.disposables);return}if(n.selection?.type==="connection")return n.selection.connection}finally{z(n.disposables)}}selectKernelFromKernelFinder(e,t,n,i){let o=new i0(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,n,i)}async selectKernel(e,t,n,i){if(t.isCancellationRequested)return;let o=new o0(e,t);i.disposables.push(o);let s=c=>{let{quickPick:l,selection:u}=n.showLazyLoadQuickPick({...c,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:l,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};wb=v([(0,Af.injectable)(),d(0,(0,Af.inject)(Mr)),d(1,(0,Af.inject)(Qg)),d(2,(0,Af.inject)(pi)),d(3,(0,Af.inject)(pn))],wb);var Tu=D(O()),Mf=require("vscode");var Nf=require("vscode");var Eb=require("vscode");var a0=class{constructor(e,t){this.notebook=e;this.disposables=[];Pe.instance.get(Ct).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=Eg(t)}dispose(){this.cancelTokeSource.dispose(),z(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,E(`Python Environment created ${e.id}`);let n=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!n)return N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),E(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};E(`Python Environment ${e.id} found as a kernel ${n.kind}:${n.id}`);let o=await Pe.instance.get(Ls).installMissingDependencies({resource:this.notebook.uri,kernelConnection:n,ui:new Yt(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,W(`Dependencies not installed for new Python Env ${$(e.uri)} for notebook ${$(this.notebook.uri)}`)),N("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:Be(t.interpreter)}),{kernelConnection:n}}async waitForPythonKernel(e){let n=Pe.instance.get(Mr).registered.find(i=>i.kind==="localPythonEnvironment");if(n)return this.waitForPythonKernelFromFinder(e,n)}async waitForPythonKernelFromFinder(e,t){let n=t.kernels.find(i=>i.interpreter.id===e.id);return n||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return z(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{z(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||W(`New Python Environment ${$(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=Pe.instance.get(st),t=new Eb.CancellationTokenSource;try{let n=await Eb.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0});if(n?.action==="Cancel")return{action:"Cancel"};if(n?.action==="Back")return{action:"Back"};let i=n?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return W("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,E(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||W(`No interpreter details for New Python Environment ${$(Eb.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var c0=require("vscode");function HG(r,e){let t=Cye(r,e.environments.known);return t||(()=>{let i=e.environments.getActiveEnvironmentPath(r.uri);return i&&e.environments.known.find(o=>o.id===i.id)})()}function Cye(r,e){let t=c0.workspace.getWorkspaceFolder(r.uri)?.uri||(c0.workspace.workspaceFolders?.length===1?c0.workspace.workspaceFolders[0].uri:void 0),n=$G(Ei(r.uri),e);if(n)return n;if(t)return $G(t,e)}function $G(r,e){let t=e.filter(n=>rv(n.environment?.folderUri?.fsPath||n.executable.uri?.fsPath||n.path,r.fsPath));return t.find(n=>Be(n)==="Venv"&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>Be(n)==="Conda"&&n.environment?.name?.toLowerCase()===".conda")||t.find(n=>["VirtualEnv","VirtualEnvWrapper"].includes(Be(n))&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>n.environment?.name?.toLowerCase()===".venv"||n.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}var l0=class extends ir{constructor(t,n){super();this.notebook=t;this.token=n;let i=Pe.instance.get(pi),o=Pe.instance.get(Ye),s=Pe.instance.get(tr);this.provider=Pe.instance.get(zs).withFilter(h=>!i.isPythonEnvironmentExcluded(h)),this.pythonEnvPicker=this._register(new td(Promise.resolve(this.provider),VD,BD,{supportsBack:!0},void 0,b.quickPickSelectPythonEnvironmentTitle));let a=!1,c=()=>{a||(a=!0,this.pythonEnvPicker.addCommand({label:`$(add) ${b.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this)))};this.provider.items.length&&c();let l={dispose:f},u=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),l.dispose(),u.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(l=this.pythonEnvPicker.addCommand({label:b.installPythonQuickPickTitle,tooltip:b.installPythonQuickPickToolTip,description:b.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>Nf.commands.executeCommand(J.InstallPythonViaKernelPicker).then(f,f)),new Nf.CancellationError}))}).catch(f);let p=()=>{!this.pythonApi||n.isCancellationRequested||(this.pythonEnvPicker.recommended=HG(this.notebook,this.pythonApi))},m=h=>{h&&(this.pythonApi=h,p(),this._register(h.environments.onDidChangeActiveEnvironmentPath(p)),this._register(h.environments.onDidChangeEnvironments(p)))};o.isPythonExtensionInstalled?s.getNewApi().then(m).catch(f):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(m),this)),p()}async selectKernel(){let t=le();Nf.extensions.getExtension(ii)||Nf.commands.executeCommand(J.InstallPythonExtensionViaKernelPicker).then(c=>{c===!0?this.provider.refresh().catch(f):t.resolve()},c=>{x("Failed to install the Python extension",c),t.resolve()});let n=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!n||n instanceof Ne)return n||Ne.cancel;let i=Pe.instance.get(st),o=Pe.instance.get(Br),s=await i.getInterpreterDetails(n.path);if(!s)return Ne.cancel;let a=await js(s,await o.getKernelSpecTempRegistrationFolder());return Ho.create({kernelSpec:a,interpreter:s,id:Ai(a,s)})}async createNewEnvironment(){let t=Pe.instance.get(tr);if(!Pe.instance.get(Ye).isPythonExtensionInstalled)return;let o=await this._register(new a0(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?Ne.back:Ne.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):Ne.cancel}};var Pb=class extends Ws{constructor(t,n,i,o,s,a){super();this.pythonApi=n;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=b.localPythonEnvironments;this._onDidChangeKernels=this._register(new Mf.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new Mf.EventEmitter);this._status="idle";this.promiseMonitor=new go;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f))},this))}async selectLocalKernel(t){let n=new Mf.CancellationTokenSource,i=[n];try{let o=new l0(t,n.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof Ne&&s===Ne.back)return;throw new Mf.CancellationError}return this.addUpdateKernel(s),s}finally{z(i)}}async getKernelConnection(t){let n=Pe.instance.get(st),i=Pe.instance.get(Br),o=await n.getInterpreterDetails(t.path);if(!o){W(`Python Env ${$(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){W(`Python Env hidden via filter: ${$(o.id)}`);return}let s=await js(o,await i.getKernelSpecTempRegistrationFolder()),a=Ho.create({kernelSpec:s,interpreter:o,id:Ai(s,o)}),c=this._kernels.get(a.id);return c||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let n=this._kernels.get(t.id);n?(n.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(n,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),z(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(f)),t.environments.known.forEach(n=>this.buildDummyEnvironment(n).catch(f)))}).catch(f)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||(this.tempDirForKernelSpecs=this.jupyterPaths.getKernelSpecTempRegistrationFolder()),this.tempDirForKernelSpecs}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();t&&(t.environments.known.map(n=>this.buildDummyEnvironment(n).catch(f)),this._register(t.environments.onDidChangeEnvironments(n=>{if(n.type==="remove"){let i=this._kernels.get(n.env.id);i&&(this._kernels.delete(n.env.id),this._onDidChangeKernels.fire({removed:[i]}))}else this.buildDummyEnvironment(n.env).catch(f)},this)))}async buildDummyEnvironment(t){let n=KV(t);if(!n||this.filter.isPythonEnvironmentExcluded(n))return;let i=await js(n,await this.getKernelSpecsDir()),o=Ho.create({kernelSpec:i,interpreter:n,id:Ai(i,n)});this._kernels.get(t.id)||(this._kernels.set(t.id,o),this._onDidChangeKernels.fire({}))}};Pb=v([(0,Tu.injectable)(),d(0,(0,Tu.inject)(F)),d(1,(0,Tu.inject)(tr)),d(2,(0,Tu.inject)(pi)),d(3,(0,Tu.inject)(Br)),d(4,(0,Tu.inject)(Ye)),d(5,(0,Tu.inject)(Mr))],Pb);var bl=D(O()),Wn=require("vscode");function u0(r){return r===$e||r===yh}var kb=class{constructor(e,t,n,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=n;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==xt&&e.notebookType!==yt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Wn.CancellationTokenSource;let n=new Lx,i={disposables:[],notebook:e};try{if(await n.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===Ne.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Wn.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{z(i.disposables)}}async getRemoteServersFromProvider(e,t,n,i){let o=this.kernelFinder.registered.filter(T=>T.kind==="remote"),s=[],a=[],c=[],l=this.jupyterServerRegistry.jupyterCollections.find(T=>T.extensionId===e.extensionId&&T.id===e.id)?.serverProvider,u=l?.provideJupyterServers?Promise.resolve(l.provideJupyterServers.bind(l)(t)).then(T=>T||[]):Promise.resolve([]),p=new Set,m=await u,h=new Set(m.map(T=>T.id));if(o.filter(T=>T.serverProviderHandle.id===e.id).filter(T=>h.has(T.serverProviderHandle.id)).map(T=>{let U=this.serverUriStorage.all.find(oe=>Vt(oe.provider)===Vt(T.serverProviderHandle));p.add(Vt(T.serverProviderHandle)),c.push({server:T,time:U?.time})}),c.sort((T,U)=>!T.time&&!U.time?T.server.displayName.localeCompare(U.server.displayName):!T.time&&U.time?1:T.time&&!U.time||(T.time||0)>(U.time||0)?-1:1),c.filter(({time:T})=>(T||0)>0).forEach(({server:T,time:U})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,description:U?b.jupyterServerLastConnectionForQuickPickDescription(new Date(U)):void 0,buttons:l?.removeJupyterServer&&u0(e.extensionId)?[{iconPath:new Wn.ThemeIcon("close"),tooltip:b.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),c.filter(({time:T})=>!T).forEach(({server:T})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,buttons:l?.removeJupyterServer&&u0(e.extensionId)?[{iconPath:new Wn.ThemeIcon("close"),tooltip:b.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),m.sort((T,U)=>T.label.localeCompare(U.label)).forEach(T=>{let U=Vt({extensionId:e.extensionId,id:e.id,handle:T.id});p.has(U)||s.push({type:"jupyterServer",label:T.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:T.id},server:T,buttons:l?.removeJupyterServer&&u0(e.extensionId)?[{iconPath:new Wn.ThemeIcon("close"),tooltip:b.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let T=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map(U=>({...U,provider:e,type:"uriProviderQuickPick",command:U}));s.length>0&&T.length&&a.push({label:"",kind:Wn.QuickPickItemKind.Separator}),a.push(...T)}let g=s.concat(a),y=new Wn.EventEmitter,C=g.length===1&&"command"in g[0]&&g[0].command.canBeAutoSelected?g[0]:void 0;if(l){let T=g.filter(U=>"type"in U);T.length===1&&T.every(U=>U.type!=="uriProviderQuickPick")?C=T[0]:T.every(U=>U.type==="uriProviderQuickPick")&&T.filter(U=>U.picked).length===1&&(C=g.filter(U=>U.picked)[0])}let k,A;if(C)A=C;else{let{quickPick:T,selection:U}=n.showLazyLoadQuickPick({items:g,placeholder:e.extensionId===$e||e.extensionId===yh?b.enterOrSelectRemoteJupyterPlaceholder:b.selectRemoteJupyterPlaceholder,title:b.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async oe=>{if("type"in oe.item&&(oe.item.type==="finder"||oe.item.type==="jupyterServer")){let G=oe.item.idAndHandle.handle,pe=m.find(de=>de.id===G);l?.removeJupyterServer&&pe&&u0(e.extensionId)&&(T.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:G}).catch(f),await l.removeJupyterServer(pe),T.busy=!1,g.splice(g.indexOf(oe.item),1),y.fire(g.concat([])))}},onDidChangeItems:y.event});T.onDidChangeValue(async oe=>{if(!e.commandProvider?.provideCommands)return;let G=[];s.length>0&&G.push({label:"",kind:Wn.QuickPickItemKind.Separator});let de=(await Promise.resolve(e.commandProvider.provideCommands(oe,t))||[]).map(te=>({...te,provider:e,type:"uriProviderQuickPick",command:te}));T.items=s.concat(G).concat(de)},this),k=T,A=await U}if(!t.isCancellationRequested&&A&&"type"in A)switch(A.type){case"finder":{let T=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(A.kernelFinderInfo),t).catch(U=>x("Failed to select a kernel",U));if(T&&T===Ne.back){if(A===C)throw Ne.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!T||T instanceof Ne)throw new Wn.CancellationError;i.selection={type:"connection",connection:T};return}case"jupyterServer":{let T=(async()=>{let oe={id:e.id,handle:A.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===rc.toLowerCase()&&await ur(t,this.serverSelector.addJupyterServer(oe)),this.kernelFinderController.getOrCreateRemoteKernelFinder(oe,A.server.label)})(),U=await this.selectRemoteKernelFromPicker(i.notebook,T,t).catch(oe=>x("Failed to select a kernel",oe));if(U&&U===Ne.back){if(A===C)throw Ne.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!U||U instanceof Ne)throw new Wn.CancellationError;i.selection={type:"connection",connection:U};return}case"uriProviderQuickPick":{let T=Wn.notebooks.createNotebookControllerDetectionTask(xt);try{k&&(k.busy=!0);let U=await this.selectRemoteServerFromRemoteKernelFinder(A,i,t);return k&&(k.busy=!1),U}catch(U){if(U===Ne.back&&!C)return this.getRemoteServersFromProvider(e,t,n,i);throw U}finally{T.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,n){if(!e.provider.commandProvider?.handleCommand||n.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,n));if(!i)throw Ne.back;if(n.isCancellationRequested)throw new Wn.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===rc.toLowerCase()&&await ur(n,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,n).catch(a=>x("Failed to select a kernel",a));if(s&&s===Ne.back)throw Ne.back;if(!s||s instanceof Ne)throw new Wn.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,n){let i,o=u=>{let p=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${p.label}`,description:p.description,detail:p.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:b.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:b.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),c=new td(t,o,s,{supportsBack:!0},a),l=new Dd(this.jupyterConnection);return t.then(u=>l.findPreferredRemoteKernelConnection(e,u,n)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(c.recommended=u),c.selected=u}).catch(u=>x("Failed to determine preferred remote kernel",u)),c.selectItem(n)}};kb=v([(0,bl.injectable)(),d(0,(0,bl.inject)(Mr)),d(1,(0,bl.inject)(Zt)),d(2,(0,bl.inject)(Da)),d(3,(0,bl.inject)(pn)),d(4,(0,bl.inject)(Cp)),d(5,(0,bl.inject)(_C)),d(6,(0,bl.inject)(Qt))],kb);function GG(r,e){r.addSingleton(Ct,vb),r.addBinding(Ct,be),r.addSingleton(Cp,gb),r.addSingleton(jP,kb),r.addSingleton(WP,wb),r.addSingleton(Rm,Pb),r.addBinding(Rm,be),r.addSingleton(be,Cb),qG(r,e)}var GC=D(O()),Of=require("vscode");var $a=Symbol("IJupyterDebugService"),Td=Symbol("INotebookDebuggingManager");var p0=Symbol("IDebugLocationTrackerFactory"),d0=Symbol("IDebugLocationTracker");var Db=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(Of.commands.registerCommand(J.RunByLine,this.runByLine,this)),this.disposables.push(Of.commands.registerCommand(J.RunByLineNext,this.runByLineNext,this)),this.disposables.push(Of.commands.registerCommand(J.RunByLineStop,this.runByLineStop,this)),this.disposables.push(Of.commands.registerCommand(J.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){N("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){N("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=Of.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};Db=v([(0,GC.injectable)(),d(0,(0,GC.inject)(Td)),d(1,(0,GC.inject)(F))],Db);var Ru=D(O());var _b=class{constructor(e,t,n){this.debugService=e;this.disposables=t;this.debugVariables=n}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(xe,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(rx,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(nx,this))}createDebugAdapterTracker(e){return this.debugVariables}};_b=v([(0,Ru.injectable)(),d(0,(0,Ru.inject)($a)),d(0,(0,Ru.named)(Qe.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Ru.inject)(F)),d(2,(0,Ru.inject)(Mn)),d(2,(0,Ru.named)(Qe.DEBUGGER_VARIABLES))],_b);var Ha=D(O());var zC=require("vscode");var gL=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function f0(r){return{name:r.evaluateName??r.name,type:r.type,count:0,shape:"",size:0,supportsDataExplorer:gL.has(r.type||""),value:r.value,truncated:!0,frameId:r.variablesReference}}var vL=require("vscode"),Tb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new vL.EventEmitter;this.sessionEndedEmitter=new vL.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var wye=new Set(["In","Out","exit","quit"]),h0=100,Rb=class extends Tb{constructor(t,n,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=n;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new zC.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,n){n&&this.watchKernel(n);let i=n&&this.kernelProvider.getKernelExecution(n),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,p)=>{let m=u[s]?u[s]:"",h=p[s]?p[s]:"";return t.sortAscending?m.localeCompare(h,void 0,{sensitivity:"base"}):h.localeCompare(m,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let c=t.startIndex?t.startIndex:0,l=t.pageSize?t.pageSize:h0;o.pageStartIndex=c;for(let u=c;u<c+l&&u<this.lastKnownVariables.length;u+=1){let p=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=p,o.pageResponse.push(p)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,n){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&n?.resourceUri&&np(n?.resourceUri).toLowerCase()===".ipynb"&&N("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getVariableValueSummary(t){}async getDataFrameInfo(t,n,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),n&&this.watchKernel(n);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:c,code:l}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:l,cleanupCode:a,initializeCode:c,frameId:t.frameId}),p=n?.notebook,m=p?_e(p.uri.path):"";return!m&&this.debugLocation?.fileName&&(m=_e(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:h0,fileName:m}:t}async getDataFrameRows(t,n,i,o,s){if(i-n>h0)throw new Error(`Debugger cannot provide more than ${h0} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:c,initializeCode:l,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:n,endIndex:i}),p=await this.evaluate({code:u,cleanupCode:c,initializeCode:l,frameId:t.frameId});return iL(JSON.parse(p.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(f);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let n=this.debugService.activeDebugSession?.id;n&&this.importedGetVariableInfoScriptsIntoKernel.delete(n)}}watchKernel(t){let n=t.notebook?.uri.toString();if(n&&!this.watchedNotebooks.has(n)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,n))),i.push(t.onDisposed(()=>{this.resetImport(n),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(n)})),this.watchedNotebooks.set(n,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:n,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};E(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;x(`Cannot evaluate ${t}`);return}finally{n&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:n})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:n,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:n,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(n=>{n.type&&gL.has(n.type)&&(n.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,n){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=n.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||wye.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>f0(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=zC.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let n=zC.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(n){let o=this.debuggingManager.getDebugSession(n);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],c=this.debuggingManager.getDebugMode(n),l;if(c===0){let u=this.debuggingManager.getDebugCell(n);a.source&&u&&a.source.path===u.document.uri.toString()&&(l=await o.customRequest("scopes",{frameId:a.id}))}else{let u=_e(n.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(l=await o.customRequest("scopes",{frameId:a.id}))}l&&(l.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(f,f)}),this.refreshEventEmitter.fire())}}}}};Rb=v([(0,Ha.injectable)(),d(0,(0,Ha.inject)($a)),d(0,(0,Ha.named)(Qe.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Ha.inject)(Td)),d(2,(0,Ha.inject)(ue)),d(3,(0,Ha.inject)(Mh)),d(4,(0,Ha.inject)(Oh)),d(5,(0,Ha.inject)(Ke))],Rb);var Au=D(O()),Rd=require("vscode");var zG=require("vscode"),sr=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await zG.commands.executeCommand("setContext",this.name,this.lastValue))}};var tz=require("vscode");var QC=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(QC||{});async function QG(r){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,n=await r.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of n){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let c=a[1];return Number(c)>=6?1:2}}return 0}function YC(r){let e=r;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function YG(r){if(YC(r),r.__mode!==2)throw new Error("Invalid launch configuration")}function g0(r,e){switch(r.type){case"event":let t=r;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let n=r;switch(n.command){case"setBreakpoints":let o=n.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(l=>{e(l,{...o.source})});let c={source:o.source,line:a};e(c),o.source=c.source}break;case"breakpointLocations":e(n.arguments);break;case"source":e(n.arguments);break;case"gotoTargets":e(n.arguments);break;default:break}break;case"response":let i=r;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function XG(r){return/~\d+\\/.test(r)}function ZG(r,e){return new RegExp(r.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function Kf(r,e){let t=`import debugpy
debugpy.debug_this_thread()`;await r.executeHidden(t),await e.dumpAllCells()}function ez(r){return!!r.header&&r.header.msg_type==="debug_event"}function XC(r){return r.includes("Frame skipped from debugging during step-in")}function yL(r){return r.event==="debugpyAttach"}var v0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;N("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){E(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return yL(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&XC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await Kf(this.execution,this.debugAdapter),tz.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f))}};var ZC=class{constructor(e,t,n,i){this.mode=e;this.debugAdapter=t;this.debugCell=n;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(Td)}trace(e,t){E(`[Debug-Restart] ${e}: ${t}`)}error(e,t){x(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var ew=require("vscode");var y0=class{constructor(e,t,n,i){this.debugAdapter=e;this.debugCell=t;this.execution=n;this.settings=i;N("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){E("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(f,f)}stop(){ne("RunbylineController::stop()"),this.execution.executeHidden("pass").then(f,f),this.debugAdapter.disconnect().then(f,f)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&XC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){ne(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(f,f),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let n=t.stackFrames[0],i=new ew.Position(n.line,n.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!n.source&&n.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){E(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await Kf(this.execution,this.debugAdapter);let e=Fe(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(Em(e,()=>void 0,(n,i)=>{n.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let n={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:_e(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[n],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&ew.commands.executeCommand(J.OpenVariableView).then(f,f)}ew.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f)}};var Ab=class{constructor(e,t,n){this.document=e;this.config=t;this.session=n}};var Vn=require("vscode");var Nb=class{constructor(e,t,n){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=n;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new Vn.EventEmitter}activate(){this.disposables.push(Vn.debug.onDidTerminateDebugSession(this.endSession.bind(this)),Vn.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await Vn.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){ne(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await Vn.debug.startDebugging(void 0,e,t)}catch(n){x(`Can't start debugging (${n})`),Vn.window.showErrorMessage(b.cantStartDebugging).then(f,f)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){ee(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,n]of this.notebookToDebugger.entries())if(n&&e.id===n.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,n]of this.notebookToDebugger.entries())if(e===t)return n}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),n=this.kernelProvider.get(e);return t&&(!n||n&&n.status==="unknown")&&(n=await ia.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Yt(!1),this.disposables,"jupyterExtension")),n}findEditorForCell(e){let t=e.notebook.uri.toString();return Vn.window.visibleNotebookEditors.find(n=>n.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let n=this.findEditorForCell(e);if(!n)return Vn.window.showErrorMessage(b.noNotebookToDebug).then(f,f),0;let i=await this.checkForIpykernel6(n.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(f,f);break}case 4:if(t)return await Vn.commands.executeCommand("notebook.selectKernel",{notebookEditor:n}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let s=this.controllerRegistration.getSelected(e);if(!s)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:s.connection,controller:s?.controller,resourceUri:e.uri})}let n=t.kernelConnectionMetadata;if(Ft(n)){if(n.kind==="startUsingRemoteKernelSpec"&&n.kernelSpec.metadata?.debugger)return 1;if(n.kind==="connectToLiveRemoteKernel"&&n.kernelModel.metadata?.debugger)return 1}let i=this.kernelProvider.getKernelExecution(t),o=await QG(i);return N("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:o===1?"installed":"notInstalled"}),o}catch(t){x("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await Vn.window.showInformationMessage(b.needIpykernel6,{modal:!0},b.setup)===b.setup?(N("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),Vn.env.openExternal(Vn.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):N("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var oo=require("vscode");var b0=class{constructor(e){this.debugAdapter=e}trace(e,t){E(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(n=>this.debugAdapter.continueDirect(n)))}};var Mb=class{constructor(e,t,n,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=n;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new oo.EventEmitter;this.endSession=new oo.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;ne("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;YC(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new b0(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new oo.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(oo.debug.stopDebugging(this.session).then(f,f),this.disconnect().catch(f),N("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(oo.notebooks.onDidChangeNotebookCellExecutionState(c=>{this.configuration.__cellIndex===c.cell.index&&c.state===oo.NotebookCellExecutionState.Idle&&!this.disconnected&&(N("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(f))},this,this.disposables)),this.disposables.push(oo.workspace.onDidChangeNotebookDocument(c=>{c.contentChanges.forEach(l=>{l.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(f)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(c=>{(c===this.session||c===this.session)&&this.disconnect().catch(f)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){E(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(ne(`Debug IO Pub message: ${JSON.stringify(t)}`),ez(t)){this.trace("event",JSON.stringify(t));for(let n of this.delegates??[])if(await n?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(f)}async handleClientMessageAsync(e){try{if(ne(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let n=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);n&&await this.dumpCell(n.index)}}if(e.type==="request")for(let t of this.delegates??[]){let n=await t?.willSendRequest?.(e);if(n){this.trace("response",JSON.stringify(n)),this.sendMessage.fire(n);return}}await this.sendMessageToJupyterSession(e)}catch(t){x(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new yn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session||this.debugService.activeDebugSession?.id===this.session.id)try{await Promise.all([this.deleteDumpedFiles().catch(e=>W("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){x("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===oo.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=xn(e);for(let[t,n]of this.fileToCell.entries())if(XG(t)&&ZG(t,e))return n}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){ee(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){g0(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else x(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(g0(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new yn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;g0(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let n=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);n&&(t.name=_e(n.path),t.path=n.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let n=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await bn(this.jupyterSession.kernel,n,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var I0=class extends Mb{constructor(){super(...arguments);this.cellToFile=new Map}async dumpCell(t){let n=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:n.document.getText().replace(/\r\n/g,`
`)}),o=xn(i.sourcePath);this.fileToCell.set(o,n.document.uri),this.cellToFile.set(n.document.uri.toString(),o)}catch(i){x(i)}}translateRealLocationToDebuggerLocation(t){let n=t.source;if(n&&n.path){let i=this.cellToFile.get(n.path);i&&(n.path=i)}}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};var Ob=class extends Nb{constructor(t,n,i,o,s,a){super(t,n,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new sr(Sr.RunByLineCells),this.runByLineDocuments=new sr(Sr.RunByLineDocuments),this.debugDocuments=new sr(Sr.DebugDocuments)}activate(){super.activate(),this.disposables.push(Rd.debug.registerDebugAdapterDescriptorFactory(rx,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],n=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),n.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(f),this.runByLineDocuments.set(n).catch(f)}updateDebugContextKey(){let t=new Uc;this.notebookToDebugAdapter.forEach((n,i)=>t.add(i.uri)),this.notebookInProgress.forEach(n=>t.add(n.uri)),this.debugDocuments.set(Array.from(t.values())).catch(f)}async tryToStartDebugging(t,n,i=!1){if(ee(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(n);if(o!==1){ee(`Ipykernel check failed: ${QC[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,n)}runByLineNext(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&n.debugCell.document.uri.toString()===t.document.uri.toString()&&n.continue()}runByLineStop(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&(N("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),n.stop())}async startDebuggingCell(t,n){let i=n.notebook,o=this.configurationService.getSettings(i.uri),s={type:rx,name:_e(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:n.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let n=t.configuration;YC(n);let i=n.__notebookUri,o=Rd.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){ee(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){ee("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){ee("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new Ab(o,n,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(n,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,n,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new I0(n,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new y0(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([c,new ZC(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,c),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new v0(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([c,new ZC(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new Rd.DebugAdapterInlineImplementation(s)}else Rd.window.showInformationMessage(b.kernelWasNotStarted).then(f,f)}};Ob=v([(0,Au.injectable)(),d(0,(0,Au.inject)(Ke)),d(1,(0,Au.inject)(Ct)),d(2,(0,Au.inject)(ue)),d(3,(0,Au.inject)(Dr)),d(4,(0,Au.inject)(Oi)),d(5,(0,Au.inject)(pt))],Ob);var tw=D(O()),rz=require("vscode");var Kb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.activeTrackersById=new Map;this.updatedEmitter=new rz.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new Tb(e.id);return this.activeTrackers.set(e,t),this.activeTrackersById.set(e.id,t),t.sessionEnded(()=>{this.activeTrackers.delete(e),this.activeTrackersById.delete(e.id)},this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e)||this.activeTrackersById.get(e.id);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};Kb=v([(0,tw.injectable)(),d(0,(0,tw.inject)(Oi)),d(1,(0,tw.inject)(F))],Kb);var x0=D(O()),oz=D(require("net"));var sz=D(Ro()),Ff=require("vscode");var iz=require("events"),nz=`\r
\r
`,S0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new iz.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let n=t;typeof n.event=="string"&&this.events.emit(`${t.type}_${n.event}`,n);break}case"request":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}case"response":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(nz);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+nz.length);continue}}break}}};var bL=class{constructor(e,t,n){this._id=e;this._configuration=t;this.customRequestHandler=n;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},Fb=class{constructor(e){this.sequence=1;this.breakpointEmitter=new Ff.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new Ff.EventEmitter;this.sessionStartedEvent=new Ff.EventEmitter;this.sessionTerminatedEvent=new Ff.EventEmitter;this.sessionCustomEvent=new Ff.EventEmitter;this.breakpointsChangedEvent=new Ff.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new S0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(n=>n!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,n){let i=t;return i.port?(this.session=new bL((0,sz.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=oz.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=le();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let n=t,i=n.body.stackFrames?n.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=le(),t=0;return this.protocolParser.once("response_scopes",n=>{this.sendToTrackers(n);let i=n;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(f)}),this.protocolParser.once("response_variables",n=>{this.sendToTrackers(n),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){ee("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(ee("Sending breakpoints"),await this.sendBreakpoints()),ee("Sending debugger attach...");let n=this.sendAttach(e,t);return ee("Sending configuration done"),await this.sendConfigurationDone(),ee("Session started."),n.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(n=>n),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:_e(t),path:t},lines:e.map(n=>n.location.range.start.line),breakpoints:e.map(n=>({line:n.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:rs,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let n=le(),i=this.sessionTerminatedEvent.event(()=>{n.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),ee(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),n.resolve(s.body))}),this.socket?.on("error",s=>n.reject(s)),this.emitMessage(e,t).catch(s=>{x(`Exception attempting to emit ${e} to debugger: `,s)}),n.promise}emitMessage(e,t){return new Promise((n,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);ee(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,c=>{this.sendToTrackers(o),n()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),ee(JSON.stringify(e))}onError(e){this.sendToTrackers(e),ee(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(f),this.socket.destroy(),this.socket=void 0)}};Fb=v([(0,x0.injectable)(),d(0,(0,x0.inject)(F))],Fb);var Il=D(O()),Lf=require("vscode");var Lb=class{constructor(e,t,n){this.vscodeDebugService=t;this.jupyterDebugService=n;this.sessionChangedEvent=new Lf.EventEmitter;this.sessionStartedEvent=new Lf.EventEmitter;this.sessionTerminatedEvent=new Lf.EventEmitter;this.sessionCustomEvent=new Lf.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),n&&(e.push(n.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(n.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(n.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(n.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let n=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(n,i)}return n}registerDebugAdapterTrackerFactory(e,t){let n=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(n,i)}return n}startDebugging(e,t,n){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,n)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():Lf.commands.executeCommand("workbench.action.debug.stop").then(f,f)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};Lb=v([(0,Il.injectable)(),d(0,(0,Il.inject)(F)),d(1,(0,Il.inject)(Oi)),d(2,(0,Il.optional)()),d(2,(0,Il.inject)($a)),d(2,(0,Il.named)(Qe.RUN_BY_LINE_DEBUGSERVICE))],Lb);var Mu=D(O());var P0=require("vscode");var Ub=Symbol("IFileConverter"),Ad=Symbol("IExportBase"),oSt=Symbol("IExport"),Nd=Symbol("IExportUtil");var E0=D(O()),az=D(require("os"));var cz=D(Ro());var jb=require("vscode");var rw=require("vscode");var Eye={PDF:["pdf"]},Pye={HTML:["html","htm"]},kye={Python:["py"]},Ga=class{async showDialog(e,t,n){let i={},o;switch(e){case"python":i=kye,o=".py";break;case"pdf":o=".pdf",i=Eye;break;case"html":o=".html",i=Pye;break;case"ipynb":o=".ipynb";let c=b.exportDialogFilter;i[c]=["ipynb"];break;default:return}let s=n||!t?n||"":`${_e(t.path,Ji(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:b.exportButtonTitle,filters:i};return rw.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&cn())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=Pe.instance.get(QP);return rw.Uri.file(Ve(await i.computeWorkingDirectory(e),t))}let n=Ve(dt(e.path),t);return rw.Uri.parse(`${e.scheme}://${n}`).with({authority:e.authority})}};var C0=class{async getContent(e){let t=jb.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new jb.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new jb.NotebookData(i);return o.metadata=JSON.parse(JSON.stringify(e.metadata)),t.exports.exportNotebook(o)}async getTargetFile(e,t,n){return await new Ga().showDialog(e,t,n)}};var w0=require("vscode");var Wb=class extends C0{constructor(t){super();this.fs=t}async getTargetFile(t,n,i){let o;return t!=="python"?o=await new Ga().showDialog(t,n,i):o=w0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};Wb=v([(0,E0.injectable)(),d(0,(0,E0.inject)(vr))],Wb);var nw=class{async generateTempDir(){let e=w0.Uri.file(Ve(az.tmpdir(),(0,cz.default)())),t=Pe.instance.get(vr);return await t.createDirectory(e),{path:Te(e),dispose:async()=>{let n=0;for(;n<10;)try{await t.delete(e),n=10}catch{await Ci(3e3),n+=1}}}}async makeFileInDirectory(e,t,n){let i=Ve(n,t);return await Pe.instance.get(vr).writeFile(w0.Uri.file(i),e),i}};async function lz(r){let e=JSON.parse(r);for(let t of e.cells){let n="outputs"in t?t.outputs:void 0;n&&Array.isArray(n)&&Dye(n)}return JSON.stringify(e,void 0,4)}function Dye(r){let e="image/svg+xml",t="image/png";for(let n of r)if("data"in n){let i=n.data;if(!(e in i))continue;t in i&&delete i[e]}}var Vb=D(O());var Nu=class{constructor(e,t,n){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=n}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(b.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};Nu=v([(0,Vb.injectable)(),d(0,(0,Vb.inject)(bp)),d(1,(0,Vb.inject)(xg)),d(2,(0,Vb.inject)(mi))],Nu);var Uf=class{constructor(e,t,n,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=n;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,n,i){}async executeCommand(e,t,n,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),n==="python"){let h=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,h);return}let s=await this.exportUtil.getContent(e);n==="pdf"&&(s=await lz(s));let a=await new nw().generateTempDir(),c=await this.makeSourceFile(t,s,a),l=await this.getExecutionService(c,i);if(!l||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Ji(t.fsPath)),p=[c.fsPath,"--to",n,"--output",_e(u.filePath),"--output-dir",dt(u.filePath),"--debug"],m=await l.execModule("jupyter",["nbconvert"].concat(p),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(P0.Uri.file(u.filePath))).size>1)await this.fs.copy(P0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(m.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,n){let i=_e(e.fsPath,Ji(e.fsPath)),o=await new nw().makeFileInDirectory(t,`${i}.ipynb`,n.path);return P0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};v([Ov("PerformingExport")],Uf.prototype,"executeCommand",1),Uf=v([(0,Mu.injectable)(),d(0,(0,Mu.inject)(Vr)),d(1,(0,Mu.inject)(ed)),d(2,(0,Mu.inject)(vr)),d(3,(0,Mu.inject)(Nd)),d(4,(0,Mu.inject)(MP)),d(5,(0,Mu.inject)(Nu))],Uf);var jf=D(O());var Ou=require("vscode");var Bb=class{constructor(){this.fs=Pe.instance.get(at)}async openFile(e,t,n=!1){if(e==="python")await this.openPythonFile(t,n),N("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,n);N("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let n;if(t)n=await Ou.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await Ou.workspace.openTextDocument({language:xe,content:i});n=await Ou.window.showTextDocument(o)}await n.edit(i=>{i.insert(new Ou.Position(n.document.lineCount,0),`
`)})}async askOpenFile(e,t){let n=b.openExportFileYes,i=b.openExportFileNo,o=[n,i];return await Ou.window.showInformationMessage(b.openExportedFileMessage,...o).then(a=>a)===n?(t?Ou.window.showTextDocument(e).then(f,f):Kp(e.toString()),!0):!1}};var R0=D(O()),A0=require("vscode");var k0=class{async export(e,t,n,i){await Pe.instance.get(Ad).executeCommand(e,t,"python",n,i)}};var D0=class{async export(e,t,n,i){await Pe.instance.get(Ad).executeCommand(e,t,"pdf",n,i)}};var _0=class{async export(e,t,n,i){await Pe.instance.get(Ad).executeCommand(e,t,"html",n,i)}};var IL=require("vscode");var T0=class{constructor(){this.fs=Pe.instance.get(at),this.configuration=Pe.instance.get(ue),this.platform=Pe.instance.get(Dr)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,n){if(n.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata?.isInteractiveWindowMessageCell).reduce((t,n)=>t+this.exportCell(n),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),n=this.getEOL();switch(e.kind){case IL.NotebookCellKind.Code:return`${t}${n}${this.exportCodeCell(e)}${n}${n}`;case IL.NotebookCellKind.Markup:return`${t} [markdown]${n}${this.exportMarkdownCell(e)}${n}${n}`}}return""}exportCodeCell(e){let t=Fe(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),n=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return dg(t,this.getEOL(),n?_ye:void 0).join("")}exportMarkdownCell(e){let t=Fe(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return dg(t,this.getEOL(),Tye).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function _ye(r){return/^\s*!/.test(r)||/^\s*%/.test(r)?`# ${r}`:r}function Tye(r){return`# ${r}`}var qb=class{constructor(e,t,n){this.exportUtil=e;this.progressReporter=t;this.configuration=n}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(b.importingIpynb,!0);try{let n=await A0.workspace.openNotebookDocument(e);await this.exportImpl("python",n,void 0,t.token)}finally{t.dispose()}}async export(e,t,n,i){let o=this.progressReporter.createProgressIndicator(b.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,n,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){N("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,n,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,n);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){x("Export failed",s),N("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&x(b.exportToPDFDependencyMessage),this.showExportFailed(b.exportFailedGeneralMessage)}}async performExport(e,t,n,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,n,i):await this.performNbConvertExport(t,e,n,o,i),n&&this.openExportedFile(e,n).catch(f)}async openExportedFile(e,t){await new Bb().openFile(e,t,!0).catch(f)}async performPlainExport(e,t,n,i){if(n)switch(e){case"python":await new T0().export(t,n,i);break}return n}async performNbConvertExport(e,t,n,i,o){try{return await this.exportToFormat(e,n,t,i,o)}finally{}}async exportToFormat(e,t,n,i,o){switch(n){case"python":return new k0().export(e,t,i,o);case"pdf":return new D0().export(e,t,i,o);case"html":return new _0().export(e,t,i,o);default:break}}showExportFailed(e){A0.window.showErrorMessage(`${b.failedExportMessage} ${e}`)}};qb=v([d(0,(0,R0.inject)(Nd)),d(1,(0,R0.inject)(is)),d(2,(0,R0.inject)(ue))],qb);var Jb=class extends qb{constructor(t,n,i,o){super(t,i,o);this.exportUtil=t;this.fs=n}async openExportedFile(t,n){await new Bb().openFile(t,n).catch(f)}};Jb=v([(0,jf.injectable)(),d(0,(0,jf.inject)(Nd)),d(1,(0,jf.inject)(vr)),d(2,(0,jf.inject)(is)),d(3,(0,jf.inject)(ue))],Jb);var Hb=D(O());var Wf=require("vscode");var $b=class{constructor(e,t,n){this.configService=e;this.fs=t;this.registry=n;this.priority=0}activate(){this.registry.register(this,xt)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?Fe(ic(nc.UpdateCWDAndPath,Te(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!mt(e.kernelConnectionMetadata)&&!kP(e.kernelConnectionMetadata)||!ft(e.kernelConnectionMetadata))return;let t=await this.calculateWorkingDirectory(e.resourceUri);if(t&&await this.fs.exists(t))return t;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(t=Wf.Uri.file(cg(Te(t),e.resourceUri,this.configService.getSettings(e.resourceUri))),t&&await this.fs.exists(t)))return t}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=$k(n.notebookFileRoot);if(i&&Wf.workspace.workspaceFolders?.length){let o=Wf.Uri.file(i),s=Wf.workspace.workspaceFolders[0].uri;if(kh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=Wf.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};$b=v([(0,Hb.injectable)(),d(0,(0,Hb.inject)(ue)),d(1,(0,Hb.inject)(at)),d(2,(0,Hb.inject)(Go))],$b);var ow=D(O()),Vf=require("vscode");var iw=require("vscode");var SL=new WeakMap;async function sa(r,e){let t=r;if(r.isClosed)return!0;let n=SL.has(t)?SL.get(t):Promise.resolve(),i=le(),o=n.finally(async()=>{let s=new iw.WorkspaceEdit,a=e(s);um(a)&&await a,await iw.workspace.applyEdit(s).then(c=>i.resolve(c),c=>i.reject(c))}).catch(f);return SL.set(t,o),i.promise}var Gb=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,n=e.controller.connection;if(!Rt(t))return;let i=Vf.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===Vf.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===Vf.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,c=n.kind;switch(n.kind){case"connectToLiveRemoteKernel":{a=n.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=n.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=xe;break}default:{x(`Unsupported kernel kind encountered ${c}`);return}}if(!a)return;let l=Tc(a);sa(i.notebook,async()=>{await o.map(async u=>{if(l.toLowerCase()!==u.document.languageId)return Vf.languages.setTextDocumentLanguage(u.document,l).then(f,f)})}).then(f,f)}};Gb=v([(0,ow.injectable)(),d(0,(0,ow.inject)(F)),d(1,(0,ow.inject)(Ct))],Gb);var za=D(O()),$t=require("vscode");var zb=class{constructor(e,t,n,i,o,s,a,c){this.disposableRegistry=e;this.languageService=t;this.configurationService=n;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=c;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(){this.disposableRegistry.push($t.commands.registerCommand(J.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push($t.commands.registerCommand(J.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push($t.commands.registerCommand(J.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push($t.commands.registerCommand(J.NotebookEditorCollapseAllCells,()=>this.collapseAll())),this.disposableRegistry.push($t.commands.registerCommand(J.NotebookEditorExpandAllCells,()=>this.expandAll())),this.disposableRegistry.push($t.commands.registerCommand(J.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push($t.commands.registerCommand(J.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernel(e?.notebookEditor?.notebookUri).catch(f):this.restartKernel(e).catch(f))),this.disposableRegistry.push($t.commands.registerCommand(J.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push($t.commands.registerCommand(J.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(f):this.restartKernelAndRunAllCells(e).catch(f)}))}runAllCells(){$t.window.activeNotebookEditor&&$t.commands.executeCommand("notebook.execute").then(f,f)}addCellBelow(){$t.window.activeNotebookEditor&&$t.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(f,f)}removeAllCells(){let e=$t.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(vo(e));sa(e,n=>{let i=$t.NotebookEdit.replaceCells(new $t.NotebookRange(0,e.cellCount),[new $t.NotebookCellData($t.NotebookCellKind.Code,"",t)]);n.set(e.uri,[i])}).then(f,f)}collapseAll(){let e=$t.window.activeNotebookEditor?.notebook;e&&sa(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!0,outputCollapsed:!0};t.set(e.uri,[$t.NotebookEdit.updateCellMetadata(i,o)])})}).then(f,f)}expandAll(){let e=$t.window.activeNotebookEditor?.notebook;e&&sa(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!1,outputCollapsed:!0};t.set(e.uri,[$t.NotebookEdit.updateCellMetadata(i,o)])})}).then(f,f)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=$t.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;E(`Command interrupted kernel for ${$(n.uri)}`);let i=this.kernelProvider.get(n);if(!i){ee("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),$t.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(f,f))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=$t.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;let i=this.kernelProvider.get(n);if(i)if(E(`Restart kernel command handler for ${$(n.uri)}`),await this.shouldAskForRestart(n.uri)){let o=b.restartKernelMessage,s=b.restartKernelMessageYes,a=b.restartKernelMessageDontAskAgain,c=await $t.window.showInformationMessage(o,{modal:!0},s,a);c===a?(await this.disableAskForRestart(n.uri),this.wrapKernelMethod("restart",i).catch(f)):c===s&&this.wrapKernelMethod("restart",i).catch(f)}else this.wrapKernelMethod("restart",i).catch(f)}async wrapKernelMethod(e,t){let n=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(n);try{if(!a)throw new Error("No kernel associated with the notebook");await ia.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:n,controller:a.controller},new Yt(!1),this.disposableRegistry)}catch(c){s?await gp(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCell(c,e,t.resourceUri),!1):$t.window.showErrorMessage(c.toString()).then(f,f)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(f),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,$t.ConfigurationTarget.Global).catch(f)}};zb=v([(0,za.injectable)(),d(0,(0,za.inject)(F)),d(1,(0,za.inject)(vs)),d(2,(0,za.inject)(ue)),d(3,(0,za.inject)(Ke)),d(4,(0,za.inject)(Ct)),d(5,(0,za.inject)(en)),d(6,(0,za.inject)(yi)),d(7,(0,za.inject)(pt))],zb);var uz=D(O()),Md=require("vscode");var Qb=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?gn(e,!0):"false",n=Yi(e)==="notebook"?Md.workspace.notebookDocuments.find(o=>gn(o.uri,!0)===t):void 0,i=n&&Md.window.activeNotebookEditor?.notebook===n?Md.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(Md.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(Md.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=Ur()==="Windows",n=Md.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(n)return n;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Qb=v([(0,uz.injectable)()],Qb);var N0=D(O()),Od=require("vscode");var Yb=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}get isTelemetryDisabled(){return zE()}activate(){Od.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Od.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Od.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Od.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}dispose(){z(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!Rt(e.cell.notebook)||this.isTelemetryDisabled||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!Rt(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===Od.NotebookCellKind.Markup||e.document.languageId==="raw")return;let n=e.notebook.notebookType===xt?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,n))}sendTelemetry(e,t,n){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),N("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:n}))}};Yb=v([(0,N0.injectable)(),d(0,(0,N0.inject)(F))],Yb);var M0=D(O());var Rye=/(;32m[ ->]*?)(\d+)(.*)/g,Xb=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==xt?t:t.map(n=>this.modifyTracebackFrameIPython(e,n))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,c,l)=>(l=l.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${c}${l}
`)),ne(`Trace frame to match: ${t}`);let n=(s,a)=>{let c=s.replace(Rye,(u,p,m,h)=>{let g=parseInt(m,10);return`${p}<a href='${e.document.uri.toString()}?line=${g-1}'>${g}</a>${h}`}),l=b.cellAtFormat(Te(e.document.uri),e.index+1);return c.replace(/.*?\n/,`\x1B[1;32m${l}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return n(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?n(t,o[2]):t}};Xb=v([(0,M0.injectable)(),d(0,(0,M0.inject)(ue))],Xb);var Qa=D(O());var Zb=class{constructor(e,t,n,i,o,s){this.packages=e;this.installer=t;this.pythonExtensionChecker=n;this.disposables=i;this.interpreterService=o;this.notebookControllerManager=s}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await ro(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(zu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};Zb=v([(0,Qa.injectable)(),d(0,(0,Qa.inject)(Hp)),d(1,(0,Qa.inject)(Ui)),d(1,(0,Qa.optional)()),d(2,(0,Qa.inject)(Ye)),d(3,(0,Qa.inject)(F)),d(4,(0,Qa.inject)(st)),d(5,(0,Qa.inject)(Ct))],Zb);function pz(r,e){GG(r,e),r.addSingleton(be,wf),r.addSingleton(Nh,zb),r.addSingleton(yi,Qb),r.addSingleton(be,kf),r.addSingleton(lg,Xb),r.addSingleton($a,Fb,Qe.RUN_BY_LINE_DEBUGSERVICE),r.addSingleton(Sd,Sd),r.addBinding(Sd,be),r.addSingleton(be,hb),r.addSingleton(be,Zb),r.addSingleton(be,pb),r.addSingleton(vs,vs),r.addBinding(vs,be),r.addSingleton(be,Gb),r.addSingleton(Td,Ob,void 0,[be]),r.addSingleton(be,_b),r.addSingleton(Mn,Rb,Qe.DEBUGGER_VARIABLES),r.addSingleton($a,Lb,Qe.MULTIPLEXING_DEBUGSERVICE),r.addSingleton(d0,Kb,void 0,[p0]),r.addSingleton(be,Db),r.addSingleton(be,Yb),r.addSingleton(be,$b),r.addSingleton(Ub,Jb),r.addSingleton(Nu,Nu),r.addSingleton(Ad,Uf),r.addSingleton(Nd,Wb)}var wn=D(O()),Ge=require("vscode");var Kd=Symbol("IDataScienceCodeLensProvider"),O0=Symbol("ICodeWatcher"),K0=Symbol("ICodeLensFactory"),hEt=Symbol("IGeneratedCodeStore"),aa=Symbol("IGeneratedCodeStorageFactory"),eI=Symbol("ICodeGeneratorFactory");var F0=Symbol("IInteractiveWindowDebugger"),Wi=Symbol("IInteractiveWindowProvider"),L0=Symbol("IInteractiveControllerHelper"),U0=Symbol("IInteractiveWindowDebuggingManager");var j0=require("vscode");async function W0(r){let e=await j0.workspace.openNotebookDocument(r);await j0.window.showNotebookDocument(e)}var ca=require("vscode");var so=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,cm.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,cm.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=Fe(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=Fe(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var ys=require("vscode");function dz(r,e){let t=ht(r);return t?e==1?b.restartingKernelCustomHeader(t):b.startingNewKernelCustomHeader(t):e==1?b.restartingKernelHeader:b.startingNewKernelHeader}function mz(r,e){let t=ht(r);return e==1?b.restartedKernelHeader(t||""):b.connectedKernelHeader(t||"")}function sw(r){return r.kind===ys.NotebookCellKind.Markup&&r.metadata?.isInteractiveWindowMessageCell===!0}var V0=class{constructor(e,t){this.notebookDocument=e;this.isDeleted=!1;if(e.cellCount){let n=e.cellAt(e.cellCount);sw(n)&&(this.sysInfoCellPromise=Promise.resolve(n),this.sysInfoCellPromise=this.updateMessage(t))}this.sysInfoCellPromise===void 0&&(this.sysInfoCellPromise=this.createCell(t))}async createCell(e){let t;return await sa(this.notebookDocument,n=>{let i=new ys.NotebookCellData(ys.NotebookCellKind.Markup,e,RS);i.metadata={isInteractiveWindowMessageCell:!0},t=this.notebookDocument.cellCount;let o=ys.NotebookEdit.insertCells(t,[i]);n.set(this.notebookDocument.uri,[o])}),t=t??this.notebookDocument.cellCount-1,this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await sa(this.notebookDocument,n=>{if(t.index>=0&&!this.isDeleted&&sw(t)){n.replace(t.document.uri,new ys.Range(0,0,t.document.lineCount,0),e),n.set(this.notebookDocument.uri,[ys.NotebookEdit.updateCellMetadata(t.index,{isInteractiveWindowMessageCell:!0})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await sa(this.notebookDocument,t=>{if(e.index>=0&&sw(e)){let n=ys.NotebookEdit.deleteCells(new ys.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[n]);return}})}};function B0(r){return/^#\s*!/.test(r)?/^#\s*!\s*%%?/.test(r)?r.replace(/^#\s*!\s*/,""):r.replace(/^#\s*/,""):r}function fz(r){return new ca.NotebookCellData(ca.NotebookCellKind.Code,r.join(`
`),"python")}function hz(r){return new ca.NotebookCellData(ca.NotebookCellKind.Markup,yP(r).join(`
`),"markdown")}function Nye(r,e,t){let n=Fe(e,{trim:!1}),i=n[0];if(new so(r).isMarkdown(i)){let s=-1;return Em(n,(a,c)=>void 0,(a,c)=>{a&&a.length>0&&s===-1&&(s=t?c:-1)}),s>=0?[hz(n.slice(0,s)),fz(n.slice(s))]:[hz(n)]}else return[fz(n)]}function gz(r,e){let t=new so(e);for(let n=0;n<r.lineCount;n+=1){let i=r.lineAt(n);if(t.isCell(i.text))return!0}return!1}function aw(r,e){let t=new so(e),n=[];for(let i=0;i<r.lineCount;i+=1){let o=r.lineAt(i);if(t.isCell(o.text)){if(n.length>0){let s=n[n.length-1];s.range=new ca.Range(s.range.start,r.lineAt(i-1).range.end)}n.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(n.length>=1){let i=r.lineAt(r.lineCount-1),o=n[n.length-1];o.range=new ca.Range(o.range.start,i.range.end)}return n}function xL(r,e){let t=aw(r,e);return Array.prototype.concat(...t.map(n=>{let i=r.getText(n.range);return Nye(e,i,!1)}))}function vz(r){return r.getCells().filter(e=>!sw(e)).map(e=>{let t=Fe(e.document.getText(),{trim:!1,removeEmptyEntries:!1});e.metadata.interactiveWindowCellMarker!==void 0&&t.unshift(e.metadata.interactiveWindowCellMarker+`
`);let n=new ca.NotebookCellData(e.kind,t.join(`
`),e.kind===ca.NotebookCellKind.Code?e.document.languageId:"markdown");return e.kind===ca.NotebookCellKind.Code&&(n.outputs=[...e.outputs]),n.metadata=hp()?{custom:Pm(e)}:Pm(e),n})}var cw=require("vscode");var CL=class{constructor(e,t,n){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=le(),this.disposeCallback=t,n&&(this.timeout=setTimeout(this.dispose,n))}},q0=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,n){this.incrementCount();let i=new CL(e,()=>this.decrementCount(),t),o={location:n?cw.ProgressLocation.Notification:cw.ProgressLocation.Window,title:e,cancellable:n!==void 0};return cw.window.withProgress(o,(s,a)=>(a&&n&&a.onCancellationRequested(()=>{n(),i.reject()}),i.promise())).then(f,f),i}async waitWithStatus(e,t,n,i){let o=this.set(t,n,i),s;try{s=await e()}finally{o.dispose()}return s}};var Lo=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=n;this.fileSystem=i;this.configuration=o;this.dataScienceCodeLensProvider=s;this.debugService=a;this.configService=c;this.interactiveWindowProvider=l;this.kernelProvider=u;this.dataScienceErrorHandler=p;this.ipynbProvider=m;this.fileConverter=h;this.statusProvider=new q0,Ge.workspace.isTrusted||Ge.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand(J.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand(J.InsertCellBelow,this.insertCellBelow),this.registerCommand(J.InsertCellAbove,this.insertCellAbove),this.registerCommand(J.DeleteCells,this.deleteCells),this.registerCommand(J.SelectCell,this.selectCell),this.registerCommand(J.SelectCellContents,this.selectCellContents),this.registerCommand(J.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand(J.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand(J.MoveCellsUp,this.moveCellsUp),this.registerCommand(J.MoveCellsDown,this.moveCellsDown),this.registerCommand(J.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand(J.ChangeCellToCode,this.changeCellToCode),this.registerCommand(J.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand(J.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand(J.AddCellBelow,this.addCellBelow),this.registerCommand(J.CreateNewNotebook,this.createNewNotebook),this.registerCommand(J.LatestExtension,this.openPythonExtensionPage),this.registerCommand(J.EnableDebugLogging,this.enableDebugLogging),this.registerCommand(J.ResetLoggingLevel,this.resetLoggingLevel),this.registerCommand(J.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand(J.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand(J.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand(J.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),Ge.commands.registerCommand(J.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let n=Ge.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFile(n.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let n=Ge.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFileAndOutput(n.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand(J.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand(J.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand(J.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand(J.InteractiveGoToCode,this.goToCodeInInteractiveWindow),Ge.commands.registerCommand(J.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){Ge.workspace.isTrusted&&(this.registerCommand(J.RunAllCells,this.runAllCells),this.registerCommand(J.RunCell,this.runCell),this.registerCommand(J.RunCurrentCell,this.runCurrentCell),this.registerCommand(J.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand(J.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(f)}),this.registerCommand(J.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand(J.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand(J.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand(J.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand(J.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand(J.DebugCell,this.debugCell),this.registerCommand(J.DebugStepOver,this.debugStepOver),this.registerCommand(J.DebugContinue,this.debugContinue),this.registerCommand(J.DebugStop,this.debugStop),this.registerCommand(J.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand(J.OpenVariableView,this.openVariableView),this.registerCommand(J.OpenOutlineView,this.openOutlineView),this.registerCommand(J.RunToLine,this.runToLine),this.registerCommand(J.RunFromLine,this.runFromLine),this.registerCommand(J.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand(J.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let n=Ge.commands.registerCommand(e,t,this);this.disposables.push(n)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=Ge.workspace.textDocuments.filter(n=>wi(n.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(b.documentMismatch(Te(e)))}}async enableDebugLogging(){this.configService.getSettings().logging.level!=="debug"&&(await this.configService.updateSetting("logging.level","debug",void 0,Ge.ConfigurationTarget.Global),Ge.commands.executeCommand("jupyter.reloadVSCode",b.reloadRequired).then(f,f))}async resetLoggingLevel(){this.configService.getSettings().logging.level!=="error"&&(await this.configService.updateSetting("logging.level","error",void 0,Ge.ConfigurationTarget.Global),Ge.commands.executeCommand("jupyter.reloadVSCode",b.reloadRequired).then(f,f))}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,Ge.ConfigurationTarget.Global).catch(f)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,n,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new Ge.Range(t,n,i,o))}async runAllCellsAbove(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,n)}}async runCellAndAllBelow(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,n)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=Ge.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=Ge.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(Ge.window.activeTextEditor,Jn(e)?void 0:e)}async debugCell(e,t,n,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new Ge.Range(t,n,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&Ge.commands.executeCommand("workbench.action.debug.stepOver").then(f,f)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let n=this.kernelProvider.get(t.notebookDocument);n&&(E(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await n.interrupt())}Ge.commands.executeCommand("workbench.action.debug.stop").then(f,f)}}async debugContinue(){this.debugService?.activeDebugSession&&Ge.commands.executeCommand("workbench.action.debug.continue").then(f,f)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){Ge.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(f,f),await Ge.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=Ge.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(n=>n.range.end.line>=e.selection.anchor.line&&n.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=Ge.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){Ge.env.openExternal(Ge.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(f,f)}async openVariableView(){return Ge.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return Ge.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(n){x("listenForErrors",n),this.dataScienceErrorHandler.handleError(n).then(f,f)}return t}async exportFile(e){let t=Te(e);if(t&&t.length>0&&this.jupyterExporter){let n=Ge.window.activeTextEditor;if(n&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=xL(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new Ga().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},b.exportingFormat,$(e)),o&&t){let s=b.exportOpenQuestion1;await Ge.window.showInformationMessage(b.exportDialogComplete($(e)),s)===s&&await W0(o)}}}}}async exportFileAndOutput(e){let t=Te(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let n=Ge.window.activeTextEditor;if(n&&n.document&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=xL(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new Ga().showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},b.exportingFormat,$(e)),await Ge.workspace.openNotebookDocument(o).then(s=>Ge.window.showNotebookDocument(s)),await Ge.commands.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new to(b.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);ee(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);ee(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,n,i){let o=t(n||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=b.importDialogFilter,t={};t[e]=["ipynb"];let n=await Ge.window.showOpenDialog({openLabel:b.importDialogTitle,filters:t});n&&n.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(n[0])},b.importingFormat,$(n[0]))}async importNotebookOnFile(e){let t=Te(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},b.importingFormat,$(e))}async scrollToCell(e,t){if(t&&e){let n=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<n.length;i+=1)if(await n[i].hasCell(t)){n[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let n=Ge.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!n)return;let i=new Ge.WorkspaceEdit,o=Ge.NotebookEdit.deleteCells(new Ge.NotebookRange(0,n.cellCount));i.set(n.uri,[o]),await Ge.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=Ge.Uri.parse(e.metadata.interactive.uristring),n=e.metadata.interactive.lineIndex,i=await Ge.window.showTextDocument(t,{viewColumn:Ge.ViewColumn.One});i&&(i.revealRange(new Ge.Range(n,0,n,0)),i.selection=new Ge.Selection(new Ge.Position(n,0),new Ge.Position(n,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),n=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await Ge.env.clipboard.writeText(n)}}};v([Zr("DATASCIENCE.DEBUG_STEP_OVER")],Lo.prototype,"debugStepOver",1),v([Zr("DATASCIENCE.DEBUG_STOP")],Lo.prototype,"debugStop",1),v([Zr("DATASCIENCE.DEBUG_CONTINUE")],Lo.prototype,"debugContinue",1),v([fr("DATASCIENCE.ADD_CELL_BELOW")],Lo.prototype,"addCellBelow",1),v([Zr("DATASCIENCE.EXPORT_PYTHON_FILE")],Lo.prototype,"exportFile",1),v([Zr("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],Lo.prototype,"exportFileAndOutput",1),v([Zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],Lo.prototype,"importNotebook",1),v([Zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],Lo.prototype,"importNotebookOnFile",1),Lo=v([(0,wn.injectable)(),d(0,(0,wn.inject)(F)),d(1,(0,wn.inject)(Sg)),d(1,(0,wn.optional)()),d(2,(0,wn.inject)(yp)),d(2,(0,wn.optional)()),d(3,(0,wn.inject)(at)),d(4,(0,wn.inject)(ue)),d(5,(0,wn.inject)(Kd)),d(5,(0,wn.optional)()),d(6,(0,wn.inject)(Oi)),d(6,(0,wn.optional)()),d(7,(0,wn.inject)(ue)),d(8,(0,wn.inject)(Wi)),d(9,(0,wn.inject)(Ke)),d(10,(0,wn.inject)(en)),d(11,(0,wn.inject)(yi)),d(12,(0,wn.inject)(Ub))],Lo);var rI=D(O());var la=require("vscode");var J0=class{constructor(e,t,n,i){this.configService=e;this.storage=t;this.notebook=n;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),la.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),la.notebooks.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,n,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,n,i)}extractExecutableLines(e){let t=e.interactive.originalSource,n=this.configService.getSettings(this.notebook.uri),i=new so(n),o=pg(t);if(n.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=B0(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0)}async generateCodeImpl(e,t,n,i){let{lineIndex:o,uristring:s}=e.interactive,a=la.workspace.textDocuments.find(te=>te.uri.toString()===s);if(!a)return;let{stripped:c,trueStartLine:l}=this.extractStrippedLines(e),u=a.lineAt(l),p=a.lineAt(Math.min(l+c.length-1,a.lineCount-1)),m=0;for(;m<c.length&&c[m].trim().length===0;)m+=1;let h=m+l,g=a.offsetAt(new la.Position(o,0)),y=a.offsetAt(p.rangeIncludingLineBreak.end),C=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:k,debuggerStartLine:A}=this.addHiddenLines(n,c,l,h,C,i),T=c.join(""),U=a.getText(new la.Range(new la.Position(o,0),p.rangeIncludingLineBreak.end)),oe=(await wa(T,"SHA-1")).substring(0,12),G=this.getRuntimeFile(oe,t),pe=n?-1:0,de={line:u?u.lineNumber+1:1,endLine:p?p.lineNumber+1:1,firstNonBlankLineIndex:h,debuggerStartLine:A,executionCount:t,startOffset:g,endOffset:y,deleted:!1,code:T,trimmedRightCode:c.map(te=>te.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:U,runtimeLine:k,runtimeFile:G,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:pe,hasCellMarker:C};return ee(`Generated code for ${t} = ${G} with ${c.length} lines`),this.storage.store(la.Uri.parse(e.interactive.uristring),de),de}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let n=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(n,i,t)})}}extractStrippedLines(e){let t=pg(e.interactive.originalSource),{lines:n}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let c=0;c<n.length;c+=1)if(n[c]!==t[c]){i+=c+1;break}}let o=0;for(;o<n.length&&n[o].trim().length===0;)o+=1;let s=n.length-1,a=n.length-2;for(;a>0;){let c=n[s],l=n[a];if((c.length===0||c===`
`)&&(l.length===0||l===`
`))n.splice(s,1),s-=1,a-=1;else break}!n[s].endsWith(`
`)&&n[s].length>0&&(n[s]=`${n[s]}
`);for(let c=0;c<n.length;c++)n[c]=n[c].replace(/\r\n/g,`
`);return{stripped:n,trueStartLine:i}}handleContentChange(e,t,n){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;n.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,n,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:n+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:n}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var yz=require("vscode");var tI=class{constructor(e,t,n){this.configService=e;this.storageFactory=t;this.disposables=n;this.codeGenerators=new WeakMap}activate(){yz.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let n=new J0(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,n),n}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};tI=v([(0,rI.injectable)(),d(0,(0,rI.inject)(ue)),d(1,(0,rI.inject)(aa)),d(2,(0,rI.inject)(F))],tI);var qf=D(O()),xl=require("vscode");function bs(r){if(r.metadata.interactive!==void 0)return r.metadata}function bz(r,e,t){let n=Fe(r,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(n),o=o9(i),s=dg(o,`
`,e.magicCommandsAsComments?B0:void 0);return Ph(s.join(""))}function Bf(r){let e=r;return e&&e.input&&Jn(e.input.uri)&&Jn(e.input.inputBoxUri)}var Sz=require("vscode");var Mye=b.runCurrentCellAndAddBelow,Oye=b.addCellBelowCommandTitle,Kye=b.debugCellCommandTitle,Fye=b.debugCellCommandTitle,Lye=b.debugStepOverCommandTitle,Uye=b.debugContinueCommandTitle,jye=b.debugStopCommandTitle,Wye=b.runCellLensCommandTitle,Vye=b.runAllCellsLensCommandTitle,Bye=b.runAllCellsAboveLensCommandTitle,Iz=b.runCellAndAllBelowLensCommandTitle,qye=b.scrollToCellTitleFormatMessage,nI=class{constructor(e,t,n,i){this.configService=e;this.generatedCodeStorageFactory=n;this.updateEvent=new xl.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;xl.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),xl.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),Sz.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(o=>{this.notebookData.delete(o.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new Je,n=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=aw(e,this.configService.getSettings(e.uri)),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(c=>!o?.cachedExecutionCounts.has(c)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){n=!0;let c=this.enumerateCommands(e.uri);E(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${c.join(", ")}`);let l=!0;o.cellRanges.forEach(u=>{c.forEach(p=>{let m=this.createCodeLens(e,u,p,l);m&&o.documentLenses.push(m)}),l=!1})}else ne(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let c=this.generatedCodeStorageFactory.get({fileUri:e.uri}),l=c?c.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;l&&l.length&&o.cellRanges.forEach(u=>{let p=this.createExecutionLens(e,u.range,l);p&&o?.gotoCellLens.push(p)})}return n&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(e.cell.notebook.notebookType!==yt||e.state!==xl.NotebookCellExecutionState.Idle||!e.cell.executionSummary?.executionOrder)return;let t=bs(e.cell),n=this.notebookData.get(e.cell.notebook.uri.toString());n||(n={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),n)),n!==void 0&&t!==void 0&&(n.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),n.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,n=this.configService.getSettings(e).codeLenses;n?t=n.split(",").map(s=>s.trim()):t=Gu.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(Gu.DefaultDebuggingLenses);let o=[];return xl.workspace.isTrusted||(o=[...Gu.DebuggerCommands,...Gu.DebuggerCommands,J.RunAllCells,J.RunAllCellsAbove,J.RunAllCellsAbovePalette,J.RunCellAndAllBelowPalette,J.RunCurrentCell,J.RunCurrentCellAdvance,J.RunCurrentCellAndAddBelow,J.RunFileInInteractiveWindows,J.InterruptKernel,J.RunToLine,J.RunCell,J.DebugCell,J.DebugContinue,J.DebugStepOver,J.DebugStop,J.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,n,i){let{range:o,cell_type:s}=t;switch(n){case J.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,J.RunCurrentCellAndAddBelow,Mye);case J.AddCellBelow:return this.generateCodeLens(o,J.AddCellBelow,Oye,[e.uri,o.start.line]);case J.DebugCurrentCellPalette:return this.generateCodeLens(o,J.DebugCurrentCellPalette,Kye);case J.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,J.DebugCell,Fye,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStepOver,Lye,[e.uri]);case J.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,J.DebugContinue,Uye,[e.uri]);case J.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStop,jye,[e.uri]);case J.RunCurrentCell:case J.RunCell:return this.generateCodeLens(o,J.RunCell,Wye,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.RunAllCells:return this.generateCodeLens(o,J.RunAllCells,Vye,[e.uri,o.start.line,o.start.character]);case J.RunAllCellsAbovePalette:case J.RunAllCellsAbove:return i?this.generateCodeLens(o,J.RunCellAndAllBelow,Iz,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,J.RunAllCellsAbove,Bye,[e.uri,o.start.line,o.start.character]);case J.RunCellAndAllBelowPalette:case J.RunCellAndAllBelow:return this.generateCodeLens(o,J.RunCellAndAllBelow,Iz,[e.uri,o.start.line,o.start.character]);default:W(`Invalid command for code lens ${n}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(n=>n.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,n){if(n){let i=n.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,J.ScrollToCell,qye(s),[e.uri,o.id])}}}generateCodeLens(e,t,n,i){return new xl.CodeLens(e,Jye(t,n,i))}};nI=v([(0,qf.injectable)(),d(0,(0,qf.inject)(ue)),d(1,(0,qf.inject)(F)),d(2,(0,qf.inject)(aa)),d(3,(0,qf.inject)(Ke))],nI);function Jye(r,e,t){return{arguments:t,title:e,command:r}}var Cl=D(O()),Ya=D(require("vscode"));var iI=class{constructor(e,t,n,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=n;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new Ya.EventEmitter;i.push(this),i.push(Ya.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=z(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(Ya.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&N("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),z(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[Ul,Hw].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(n=>n.uri&&n.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new Je,n=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,new sr(Sr.HasCodeCells).set(n&&n.length>0).catch(f),this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,n):[]}adjustDebuggingLenses(e,t){let n=Gu.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?Ya.Uri.parse(i.fileName):void 0}catch{}if(i&&(wi(Ya.Uri.file(i.fileName),e.uri,!0)||o&&wi(o,e.uri,!0)))return t.filter(a=>{let c=new Ya.Position(i.lineNumber-1,i.column-1);return a.range.contains(c)}).filter(a=>a.command?n.includes(a.command.command):!1);ne(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!n.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(E(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let n=Ya.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(n&&n.length>0)return E(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(n[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(O0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};iI=v([(0,Cl.injectable)(),d(0,(0,Cl.inject)(pt)),d(1,(0,Cl.inject)(d0)),d(1,(0,Cl.optional)()),d(2,(0,Cl.inject)(ue)),d(3,(0,Cl.inject)(F)),d(4,(0,Cl.inject)(Oi))],iI);var Fd=D(O()),Se=require("vscode");var Jf=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function $ye(r,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return r<0&&(r+=e),r<0?0:r>=e?e-1:r}var er=class{constructor(e,t,n,i,o){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=n;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new Se.EventEmitter;this.disposables=[this.codeLensUpdatedEvent]}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.disposables.push(this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this))),this.disposables.push(Se.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))),this.disposables.push(Se.workspace.onDidCloseNotebookDocument(this.ondidCloseNotebook.bind(this)))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&N("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),z(this.disposables)}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),n=this.codeLenses.filter(s=>s.command&&s.command.command===J.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=n.length,o=Promise.resolve(!0);for(let s of n){let a=new Se.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===n.length&&(a=new Se.Range(new Se.Position(0,0),a.end));let c=this.document.getText(a);i-=1,o=this.addCode(t,c,this.document.uri,a.start.line,e)}}if(await o,n.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===J.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let c of i)if(o>0&&this.document){let l=new Se.Range(c.range.start,c.range.end);o===s&&(l=new Se.Range(new Se.Position(0,0),l.end)),o-=1;let u=this.document.getText(l);a=this.addCode(n,u,this.document.uri,c.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===J.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let c=o;c>=0&&c<i.length;c+=1)if(s>0&&this.document){let l=i[c];s-=1;let u=this.document.getText(l.range);a=this.addCode(n,u,this.document.uri,l.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&wi(e.document.uri,this.document.uri)){let n=await this.getActiveInteractiveWindow(),i;if(t===void 0||Jn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;let s=this.configService.getSettings(e.document.uri).normalizeSelectionForInteractiveWindow??!0?await this.executionHelper.normalizeLines(i):i;if(!s||s.trim().length===0)return;await this.addCode(n,s,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(e-1),i=this.document.getText(new Se.Range(0,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new Se.Range(e,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let t=e.contains(Se.window.activeTextEditor.selection.start)&&this.configService.getSettings(Se.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=Se.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let e=Se.window.activeTextEditor,t=new so(this.configService.getSettings(e.document.uri)),n=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let c=e.selection.end.line+1;c<e.document.lineCount;c+=1)if(t.isCell(e.document.lineAt(c).text)){a=!1,n=c,s.insert(new Se.Position(c,0),`${i}

`);break}a&&(n=e.document.lineCount,s.insert(new Se.Position(e.document.lineCount,0),`
${i}
`))}).then(f,f);let o=new Se.Position(n+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new Se.Range(o,o)))}insertCellBelowPosition(){let e=Se.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let n=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,c=0;n.range.start.line>0&&(o=n.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,c=i.range.end.character);let l=new Se.Range(new Se.Position(o,s),new Se.Position(a,c));e.edit(u=>{u.replace(l,""),this.codeLensUpdatedEvent.fire()}).then(f,f)}selectCell(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let n=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new Se.Selection(n.range.start,i.range.end):e.selection=new Se.Selection(i.range.end,n.range.start)}}}selectCellContents(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let n=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let c=n;c<=i;c+=1){let l=s[c],u=l.range.start.line+1,p=0,m=l.range.end.line,h=l.range.end.character;l.range.start.line===l.range.end.line&&(u=l.range.start.line,p=e.document.lineAt(u).range.end.character,m=u,h=p),o?a.push(new Se.Selection(u,p,m,h)):a.push(new Se.Selection(m,h,u,p))}e.selections=a}extendSelectionByCellAbove(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?s<a?u=new Se.Selection(c.range.start,o[a-1].range.end):u=new Se.Selection(c.range.end,c.range.start):u=new Se.Selection(l.range.end,c.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new Se.Selection(c.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?u=new Se.Selection(c.range.start,l.range.end):s<a?u=new Se.Selection(o[s+1].range.start,l.range.end):u=new Se.Selection(l.range.start,l.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new Se.Selection(c.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);n&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);n&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=Se.window.activeTextEditor,n=this.getStartEndCellIndex(t?.selection);if(!t||!n)return;let i=this.cells,o=n[0],s=n[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,n){if(n==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===n)return;let i=new so(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),c=n==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!c)return;let l=c[c.length-1],u=n==="markdown"?`${a} [markdown]${l}`:`${a}${l}`;e.edit(async p=>{p.replace(o.range,u),t.cell_type=n,t.range.start.line<t.range.end.line&&(e.selection=new Se.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),Se.commands.executeCommand("editor.action.removeCommentLine").then(f,f),n==="markdown"&&Se.commands.executeCommand("editor.action.addCommentLine").then(f,f))}).then(f,f)}async moveCellsDirection(e){let t=Se.window.activeTextEditor;if(!t||!t.selection)return!1;let n=this.getStartEndCellIndex(t.selection);if(!n)return!1;let i=n[0],o=n[1],s=this.cells,a=s[i],c=s[o];if(!a||!c)return!1;let l=new Se.Range(a.range.start,c.range.end),u=new Se.Range(t.selection.start.line-l.start.line,t.selection.start.character,t.selection.end.line-l.start.line,t.selection.end.character),p=t.selection.active.isBefore(t.selection.anchor),m;if(e){if(i===0)return!1;{let h=s[i-1];m=this.exchangeTextLines(t,h.range,l).then(y=>(y&&(t.selection=new Se.Selection(h.range.start.line+u.start.line,u.start.character,h.range.start.line+u.end.line,u.end.character)),y))}}else{if(o===s.length-1)return!1;{let h=s[o+1],g=this.exchangeTextLines(t,l,h.range),y=h.range.end.line-h.range.start.line,C=l.end.line-l.start.line,k=y-C;m=g.then(A=>(A&&(t.selection=new Se.Selection(h.range.start.line+k+u.start.line,u.start.character,h.range.start.line+k+u.end.line,u.end.character)),A))}}return m.then(h=>(h&&p&&(t.selection=new Se.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,n){let i=t.start.line,o=t.end.line,s=n.start.line,a=n.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let c=new Se.Range(i,0,o,e.document.lineAt(o).range.end.character),l=e.document.getText(c),u=new Se.Range(s,0,a,e.document.lineAt(a).range.end.character),p=e.document.getText(u),m="";if(o+1<s){let y=o+1,C=s-1,k=new Se.Range(y,0,C,e.document.lineAt(C).range.end.character);m=`${e.document.getText(k)}
`}let h=`${p}
${m}${l}`,g=new Se.Range(c.start,u.end);return e.edit(y=>{y.replace(g,h),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let n=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[n,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),n=t;if(e.start.line!==e.end.line&&(n=this.getCellIndex(e.end)),t===-1){if(n===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&n>=0)return[t,n]}insertCell(e,t){let n=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${n}
`:`${n}

`,o=new Se.Position(t,0),s=new Se.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(f,f),e.selection=new Se.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Qe.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&wi(e.uri,this.document.uri)&&z(this.disposables)}ondidCloseNotebook(e){e.notebookType===yt&&this.configService.getSettings(this.document?.uri).addGotoCodeLenses&&this.onCodeLensFactoryUpdated()}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,n,i,o){let s=!1;try{o?s=await e.debugCode(t,n,i):s=await e.addCode(t,n,i)}catch(a){a instanceof Jf||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,n){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=Ph(this.document.getText(i.range));if(t){let c=Se.window.activeTextEditor,{newCellOnRunLast:l}=this.configService.getSettings(this.document.uri),u=new so(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):l&&c&&!u.isEmptyCell(s)&&this.insertCell(c,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,n)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,n=$ye(e,t.length);return t[n]}getCellFromPosition(e){if(!e){let t=Se.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===J.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===J.RunCell);if(t>=0)return this.codeLenses.find((n,i)=>n.command!==void 0&&n.command.command===J.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===J.RunCell);if(t>=1)return this.codeLenses.find((n,i)=>n.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),n=this.document.getText();await this.addCode(t,n,this.document.uri,0,e)}}advanceToRange(e){let t=Se.window.activeTextEditor,n=new Se.Selection(e.start,e.start);t&&(t.selection=n,t.revealRange(e,Se.TextEditorRevealType.Default))}};v([Zr("DATASCIENCE.DEBUG_CURRENT_CELL")],er.prototype,"debugCurrentCell",1),v([Zr("DATASCIENCE.RUN_ALL_CELLS")],er.prototype,"runAllCells",1),v([Zr("DATASCIENCE.RUN_FILE_INTERACTIVE")],er.prototype,"runFileInteractive",1),v([Zr("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],er.prototype,"debugFileInteractive",1),v([Zr("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],er.prototype,"runAllCellsAbove",1),v([Zr("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],er.prototype,"runCellAndAllBelow",1),v([Zr("DATASCIENCE.RUN_SELECTION_OR_LINE")],er.prototype,"runSelectionOrLine",1),v([Zr("DATASCIENCE.RUN_TO_LINE")],er.prototype,"runToLine",1),v([Zr("DATASCIENCE.RUN_FROM_LINE")],er.prototype,"runFromLine",1),v([oi("CodeWatcher::runCell",4)],er.prototype,"runCell",1),v([Zr("DATASCIENCE.DEBUG_CURRENT_CELL")],er.prototype,"debugCell",1),v([Zr("DATASCIENCE.RUN_CURRENT_CELL")],er.prototype,"runCurrentCell",1),v([Zr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],er.prototype,"runCurrentCellAndAdvance",1),v([fr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],er.prototype,"runCurrentCellAndAddBelow",1),v([fr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],er.prototype,"insertCellBelowPosition",1),v([fr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],er.prototype,"insertCellBelow",1),v([fr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],er.prototype,"insertCellAbove",1),v([fr("DATASCIENCE.RUN_DELETE_CELLS")],er.prototype,"deleteCells",1),v([fr("DATASCIENCE.RUN_SELECT_CELL")],er.prototype,"selectCell",1),v([fr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],er.prototype,"selectCellContents",1),v([fr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],er.prototype,"extendSelectionByCellAbove",1),v([fr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],er.prototype,"extendSelectionByCellBelow",1),v([fr("DATASCIENCE.RUN_MOVE_CELLS_UP")],er.prototype,"moveCellsUp",1),v([fr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],er.prototype,"moveCellsDown",1),v([fr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],er.prototype,"changeCellToMarkdown",1),v([fr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],er.prototype,"changeCellToCode",1),v([fr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],er.prototype,"gotoNextCell",1),v([fr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],er.prototype,"gotoPreviousCell",1),er=v([(0,Fd.injectable)(),d(0,(0,Fd.inject)(Wi)),d(1,(0,Fd.inject)(ue)),d(2,(0,Fd.inject)(oD)),d(3,(0,Fd.inject)(en)),d(4,(0,Fd.inject)(K0))],er);var sI=D(O()),ei=D(require("vscode"));var Ld=require("vscode");var oI=class{constructor(e,t,n){this.configuration=t;this.extensionChecker=n;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(ei.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(ei.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(ei.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){ei.window.activeTextEditor&&this.triggerUpdate(ei.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){ei.window.activeTextEditor&&e.document===ei.window.activeTextEditor.document&&this.triggerUpdate(Ld.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=Ld.window.createTextEditorDecorationType({borderColor:new ei.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=Ld.window.createTextEditorDecorationType({borderColor:new ei.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=Ld.window.createTextEditorDecorationType({borderColor:new ei.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=Ld.window.createTextEditorDecorationType({borderColor:new ei.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?Ld.window.visibleTextEditors:[e];for(let n of t)if(n&&n.document&&n.document.languageId===xe&&!ug(n.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(n.document.uri);if(this.cellDecorationEnabled(i)){let o=aw(n.document,i),s=o.map(u=>u.range).filter(u=>u.contains(n.selection.anchor)),a=s.length>0?[new ei.Range(s[0].start,s[0].start)]:[],c=i.decorateCells!=="allCells"&&s.length>0?[new ei.Range(s[0].end,s[0].end)]:[],l=[];i.decorateCells==="allCells"&&o.forEach(u=>{let p=u.range.start;p!==s[0].start&&l.push(new ei.Range(p,p))}),Ld.window.activeTextEditor===n?(n.setDecorations(this.currentCellTop,a),n.setDecorations(this.currentCellBottom,c),n.setDecorations(this.currentCellTopUnfocused,l),n.setDecorations(this.currentCellBottomUnfocused,[])):(n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[...l,...a]),n.setDecorations(this.currentCellBottomUnfocused,c))}else n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[]),n.setDecorations(this.currentCellBottomUnfocused,[])}}};oI=v([(0,sI.injectable)(),d(0,(0,sI.inject)(F)),d(1,(0,sI.inject)(ue)),d(2,(0,sI.inject)(Ye))],oI);var xz=D(O()),Cz=require("vscode");var $0=class{constructor(){this.codeGeneratorsByFile=new So}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let n=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<n.length&&!i;o+=1){let s=n[o];t.line>=s.line&&t.line<=s.endLine?(n.splice(o,1,t),i=!0):s.line>t.line&&(n.splice(o,0,t),i=!0)}i||n.push(t),this.codeGeneratorsByFile.set(e,n)}};var aI=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new $0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=Cz.workspace.notebookDocuments.find(n=>this.storages.get(n)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};aI=v([(0,xz.injectable)()],aI);var Ku=D(O()),Ud=D(require("vscode"));var cI=class{constructor(e,t,n,i){this.variableProvider=e;this.interactiveProvider=t;this.disposables=n;this.kernelProvider=i;this.runFiles=new Set;this.stopWatch=new Je}activate(){Ud.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(e.cell.notebook.notebookType!==yt)return;let t=this.runFiles.size,n=bs(e.cell);n!==void 0&&this.runFiles.add(n.interactive.uristring),t!==this.runFiles.size&&await this.initializeHoverProvider()}catch(t){x(t)}}async provideHover(e,t,n){this.stopWatch.reset();let i=await xr(300,this.getVariableHover(e,t,n));return N("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}async initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=Ud.languages.registerHoverProvider(Vj,this))}async getVariableHover(e,t,n){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await or(n,{},...s.map(l=>this.variableProvider.getVariableProperties(o,l,n))),c=Object.entries(a||{});if(c.length>0){let l=c.reduce((p,m)=>p+`${m[0]}: ${m[1]}
`,"```\n")+"```";return{contents:[new Ud.MarkdownString(l)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let n=new Set;return Ud.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&n.add(o)}),Array.from(n)}};cI=v([(0,Ku.injectable)(),d(0,(0,Ku.inject)(Mn)),d(0,(0,Ku.named)(Qe.KERNEL_VARIABLES)),d(1,(0,Ku.inject)(Wi)),d(2,(0,Ku.inject)(F)),d(3,(0,Ku.inject)(Ke))],cI);var Uo=D(O()),Qr=require("vscode");var Lt=require("vscode");var wz=D(Ro());var $f=class{constructor(e,t,n,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=n;this.inputUri=o;this._onDidChangeViewState=new Lt.EventEmitter;this.closedEvent=new Lt.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(at),this.configuration=this.serviceContainer.get(ue),this.jupyterExporter=this.serviceContainer.get(Sg),this.interactiveWindowDebugger=this.serviceContainer.tryGet(F0),this.errorHandler=this.serviceContainer.get(en),this.codeGeneratorFactory=this.serviceContainer.get(eI),this.storageFactory=this.serviceContainer.get(aa),this.kernelProvider=this.serviceContainer.get(Ke),this.debuggingManager=this.serviceContainer.get(U0),this.notebookUri=Bf(i)?i.input.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),Lt.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),Lt.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),Lt.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new so(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=Lt.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.setInfoMessageCell(b.noKernelConnected);else{let e=Lt.workspace.onDidOpenNotebookDocument(t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(t),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(b.noKernelConnected),e.dispose())})}}initController(e){let t=this.controllerFactory.create(e,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(t.listenForControllerSelection()),t}async ensureInitialized(){if(!this.notebookDocument&&(E("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.controller?this.controller.startKernel().catch(f):(ee("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(b.selectKernelForEditor))}async showInteractiveEditor(){let e;Lt.window.tabGroups.all.find(i=>{i.tabs.find(o=>{Bf(o)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o)})});let t=this.notebookDocument||await this.openNotebookDocument();return await Lt.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e?.group.viewColumn})}async openNotebookDocument(){return E(`Opening notebook document ${this.notebookUri}`),await Lt.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let n=this.controller?.controller,i=zh(e);if(n&&i&&t){let o=Ri.getOrCreate(t,new Tf(n));try{await o.appendOutput(i)}catch(s){W(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else ee(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,n){return this.submitCode(e,t,n,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!mt(this.controller.metadata))}async debugCode(e,t,n){let i=!0,o=Lt.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...Lt.workspace.textDocuments];if(i=await o.save(),i){let c=Lt.workspace.textDocuments.filter(l=>a.indexOf(l)===-1);c&&c.length>0&&(t=(c.find(u=>u.languageId==="python")||c.find(u=>!u.fileName.endsWith(".interactive"))||c[0]).uri,await Lt.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,n,!0):s}async submitCode(e,t,n,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=Fe(e,{trim:!1}),s=new so(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&Em(o,(u,p)=>void 0,(u,p)=>{u&&u.length>0&&a===-1&&(a=p)});let l=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let p=le();this.controller.setPendingCellAdd(p.promise);let m=this.addNotebookCell(u,t,n),h=this.createExecutionPromise(m,i);return h.catch(g=>{g instanceof Jf?m.then(y=>{g.cell!==y&&this.showErrorForCell(b.cellStopOnErrorMessage,y).then(f,f)}).catch(f):m.then(y=>this.errorHandler.getErrorMessageForDisplayInCell(g,"execution",this.owningResource).then(C=>this.showErrorForCell(C,y))).catch(f)}).finally(()=>{p?.resolve()}),h});return l[l.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;ne("InteractiveWindow.ts.createExecutionPromise.start");let n=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await n;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&mt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),ne("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let c=bs(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,c?.generatedCode?.code).then(()=>!0,()=>!1),ne("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),ne("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Jf(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await Lt.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===Lt.NotebookCellKind.Code&&await Lt.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),n=t.notebook.getCells().find(i=>bs(i)?.id===e);if(n){let i=new Lt.NotebookRange(n.index,n.index+1);t.revealRange(i,Lt.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(n=>bs(n)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=Os();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,n){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===RS,a=s?yP(Fe(e)).join(""):bz(e,o,this.cellMatcher),c=this.cellMatcher.getFirstMarker(e),l=Lt.workspace.textDocuments.find(g=>g.uri.toString()===this.owner?.toString())?.languageId??xe,u=new Lt.NotebookCellData(s?Lt.NotebookCellKind.Markup:Lt.NotebookCellKind.Code,a,s?RS:l),p={uristring:t.toString(),lineIndex:n,originalSource:e},m={interactiveWindowCellMarker:c,interactive:p,id:(0,wz.default)()};u.metadata=m,await sa(i,g=>{let y=Lt.NotebookEdit.insertCells(i.cellCount,[u]);g.set(i.uri,[y])});let h=i.cellCount-1;return i.cellAt(h)}async generateCodeAndAddMetadata(e,t,n){let i=bs(e);if(!i)return;let o=!mt(n.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},c=new Lt.WorkspaceEdit,l=Lt.NotebookEdit.updateCellMetadata(e.index,a);c.set(e.notebook.uri,[l]),await Lt.workspace.applyEdit(c)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let e=vz(this.notebookDocument),t=await new Ga().showDialog("ipynb",this.owningResource);t&&await this.jupyterExporter?.exportToFile(e,Te(t))}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value,t;if(this.submitters&&this.submitters.length){let n=this.submitters[this.submitters.length-1];t=_e(n.path,Ji(n.path))}cn()?Lt.commands.executeCommand(J.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(f,f):Lt.commands.executeCommand(J.Export,this.notebookDocument,t,e?.kernelConnectionMetadata.interpreter).then(f,f)}};v([dA()],$f.prototype,"showErrorForCell",1),v([dA()],$f.prototype,"createExecutionPromise",1);function Ez(r){return b.interactiveWindowTitleFormat(_e(r.path))}var wL=class{constructor(e,t,n,i,o,s,a){this.controllerService=e;this.mode=t;this.notebook=n;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.notebook&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{E("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{x("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=le();e.promise.catch(f),this.kernel=e;try{let{kernel:t,actualController:n}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.notebook,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=n,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){ne("Unable to run initialization for IW");return}let n=Te(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(E(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(E(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):E(`Not Initializing __file__ in setFileInKernel with ${n} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.notebook&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.notebook,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.notebook||e.notebook.uri.toString()!==this.notebook?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(f):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(f)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>W(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new V0(this.notebook,e)}setInfoMessage(e,t){let n=dz(e,t);this.setInfoMessageCell(n)}finishSysInfoMessage(e,t){let n=mz(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(n).catch(i=>W(`System info message was not updated: "${n}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(n=>W(`System info message was not updated: "${t}" because of error: ${n}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(f,f),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},lw=class{constructor(e,t,n){this.controllerService=e;this.mode=t;this.initialController=n}create(e,t,n,i){let o=this.initialController,s=this.controllerService.getSelectedController(e);return s&&(o=s),new wL(this.controllerService,this.mode,e,t,n,i,o)}};var Pz="ds_asked_per_file_interactive",kz="ds_interactive_window_cache",lI=class{constructor(e,t,n,i,o,s,a,c){this.serviceContainer=e;this.disposables=t;this.fs=n;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=c;this._onDidChangeActiveInteractiveWindow=new Qr.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Qr.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Qr.window.tabGroups.all.forEach(t=>{t.tabs.forEach(n=>{Bf(n)&&n.input.uri&&e.set(n.input.uri.toString(),n)})}),this.workspaceMemento.get(kz,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let n=e.get(t.uriString);if(!n)return;let i=this.configService.getSettings(n.input.uri).interactiveWindowMode,o=new $f(this.serviceContainer,Qr.Uri.parse(t.owner),new lw(this.controllerHelper,i),n,Qr.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset(),this._windows.push(o),N("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Qr.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(f);let i=this.getExisting(e,n,t);return i||(i=await this.create(e,n,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,n){let i=le();this.pendingCreations=i.promise;try{let o=await this.controllerHelper.getInitialController(e,n);ee(`Starting interactive window for resource '${$(e)}' with controller '${o?.id}'`);let[s,a]=await this.createEditor(o,e,t);o&&o.controller.updateNotebookAffinity(a.notebook,Qr.NotebookControllerAffinity.Preferred),E(`Interactive Window Editor Created: ${a.notebook.uri.toString()} with input box: ${s.toString()}`);let c=new $f(this.serviceContainer,e,new lw(this.controllerHelper,t,o),a,s);this._windows.push(c),N("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!o,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=c;let l=c.closed(this.onInteractiveWindowClosed.bind(this,c));return this.disposables.push(c),this.disposables.push(l),this.disposables.push(c.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),c}finally{i.resolve()}}async createEditor(e,t,n){let i=e?`${$e}/${e.id}`:void 0,o=t!==void 0,s=this.getInteractiveViewColumn(t),{inputUri:a,notebookEditor:c}=await Qr.commands.executeCommand("interactive.open",{viewColumn:s,preserveFocus:o},void 0,i,t&&n==="perFile"?Ez(t):void 0);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[a,c]}getInteractiveViewColumn(e){if(e)return Qr.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Qr.ViewColumn.One:t==="active"?Qr.ViewColumn.Active:Qr.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(Pz)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(Pz,!0).then(f,f);let n=[b.interactiveWindowModeBannerSwitchYes,b.interactiveWindowModeBannerSwitchNo];await Qr.window.showInformationMessage(b.interactiveWindowModeBannerTitle,...n)===n[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Qr.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(kz,e).then(f,f)}getExisting(e,t,n){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!n?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!n||i.kernelConnectionMetadata?.id===n.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){E(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Qr.window.activeTextEditor===void 0)return;let e=Qr.window.activeTextEditor.document.uri;if(e.scheme!==Ul)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let n=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,n)?.notebookDocument}return t?Qr.window.visibleNotebookEditors.find(n=>n.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(n=>n.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(n=>this.fs.arePathsSame(e,n)))}};lI=v([(0,Uo.injectable)(),d(0,(0,Uo.inject)(pt)),d(1,(0,Uo.inject)(F)),d(2,(0,Uo.inject)(at)),d(3,(0,Uo.inject)(ue)),d(4,(0,Uo.inject)(He)),d(4,(0,Uo.named)(bt)),d(5,(0,Uo.inject)(He)),d(5,(0,Uo.named)(si)),d(6,(0,Uo.inject)(yi)),d(7,(0,Uo.inject)(L0))],lI);var jd=D(O());var uI=class{constructor(e,t,n,i,o){this.kernelProvider=e;this.codeGeneratorFactory=n;this.storageFactory=i;this.controllers=o;this.disposables=[];t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||t.notebookType!==yt||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};uI=v([(0,jd.injectable)(),d(0,(0,jd.inject)(Ke)),d(1,(0,jd.inject)(F)),d(2,(0,jd.inject)(eI)),d(3,(0,jd.inject)(aa)),d(4,(0,jd.inject)(Ct))],uI);var dI=D(O()),lQ=require("vscode");var cQ=aQ(),G0=/(;32m[ ->]*?)(\d+)(.*)/g,pI=class{constructor(e,t,n){this.storageFactory=e;this.platformService=t;this.configurationService=n}format(e,t){if(e.notebook.notebookType!==yt)return t;let n=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!n)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,n?.all,s):s?this.modifyTracebackFrameIPython7(a,n.all):a)}modifyTracebackFrameIPython8(e,t,n){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,p,m,h)=>(h=h.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${p}${m}${h}
`)),ne(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,c=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),l=s.exec(e);if(c&&c.groups?.executionCount&&c.groups?.lineNumber?(i=parseInt(c.groups.executionCount),o=c.groups?.lineNumber):l&&l.groups?.executionCount&&l.groups?.lineNumber&&(i=parseInt(l.groups.executionCount),o=l.groups.lineNumber),t&&i){let u,p;for(let m of t)if(p=m.generatedCodes.find(h=>h.executionCount===i),p){u=m.uri;break}if(p&&u){let m=e;return n&&(m=m.replace(G0,(h,g,y,C)=>{let k=parseInt(y,10),U=(p.hasCellMarker?p.line-1:p.line)-1+p.lineOffsetRelativeToIndexOfFirstLineInCell+k;return`${g}<a href='${u?.toString()}?line=${U-1}'>${U}</a>${C}`})),m.replace(/.*?\n/,`File \x1B[1;32m${Te(u)}:${o}\x1B[0m
`)}}if(n){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let p=Dh(u[1],Te(this.platformService.homeDir)),m=lQ.Uri.file(p);return e.replace(G0,(h,g,y,C)=>{let k=parseInt(y,10);return`${g}<a href='${m?.toString()}?line=${k-1}'>${k}</a>${C}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Te(i),s=$(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${cQ(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${cQ(s)}`).test(e)){let c="",l=/(;32m[ ->]*?)(\d+)(.*)/g;for(let p=l.exec(e);p&&p.length>3;p=l.exec(e)){let m=fl(p[3]).substr(1);c=`${c}${m}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),c);u!==void 0&&(e=e.replace(G0,(p,m,h,g)=>{let y=parseInt(h,10),C=u+y-1;return`${m}<a href='${i.toString()}?line=${C}'>${C+1}</a>${g}`}))}if(e.includes(o)){let c=this.findCellOffset(a.getFileGeneratedCode(i),e);if(c)return e.replace(G0,(l,u,p,m)=>{let h=parseInt(p,10),g=c+h-1;return`${u}<a href='${i.toString()}?line=${g}'>${g+1}</a>${m}`})}}}),e}findCellOffset(e,t){if(e){for(let n of e)if(n.trimmedRightCode.indexOf(t)>=0)return n.firstNonBlankLineIndex}}};pI=v([(0,dI.injectable)(),d(0,(0,dI.inject)(aa)),d(1,(0,dI.inject)(Dr)),d(2,(0,dI.inject)(ue))],pI);var Fu=D(O());var pw=class extends _n{constructor(e,t,n){let i=t||b.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,n)}};function z0(r){let e={source:{path:Te(r.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=r.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var mI=class{constructor(e,t,n,i){this.apiProvider=e;this.configService=t;this.debugService=n;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),n=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:n})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(ee("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(ne("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",z0(t))})))}enable(e){e.session?.kernel&&bn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}disable(e){e.session?.kernel&&bn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}async startDebugSession(e,t,n){if(ee("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,n);if(i&&(ee("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await bn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?W(`${this.debuggerPackage} not found in path.`):ee(`import startup: ${J_(o)}`),await this.disable(t)}}async connect(e,t){let n=e.notebook,i=n,o=this.configs.get(i);if(o)return{...o,...t};ee("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(n,o);let c=[],l=()=>{this.configs.delete(i),c.forEach(u=>u.dispose())};c.push(e.onDisposed(l)),c.push(e.onRestarted(l))}return o}async calculateDebuggerPathList(e){let t=[],n=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(n&&(this.platform.isWindows&&(n=n.replace(/\\/g,"\\\\")),t.push(n)),mt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let n=e.session?.kernel?await bn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];ee(`Appending paths: ${J_(n)}`)}}async connectToLocal(e){let t=e.session?.kernel?await bn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0)for(let n of t){let i=J_([n]);if(i){i=pm(i);let s=/\('(.*?)', ([0-9]*)\)/.exec(i);if(s)return{port:parseInt(s[2],10),host:s[1]}}}if(t.length>0&&t[0].output_type==="error"){let n=t[0];throw new pw(this.debuggerPackage,n.ename,e.kernelConnectionMetadata)}throw new pw(b.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};mI=v([(0,Fu.injectable)(),d(0,(0,Fu.inject)(tr)),d(1,(0,Fu.inject)(ue)),d(2,(0,Fu.inject)($a)),d(2,(0,Fu.named)(Qe.MULTIPLEXING_DEBUGSERVICE)),d(3,(0,Fu.inject)(Dr))],mI);var wl=D(O()),Wd=require("vscode");var Q0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;this._ready=le();this.ready=this._ready.promise;N("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){E(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return yL(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&XC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=bs(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=Kf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=Kf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var Y0=class extends Ab{constructor(){super(...arguments);this._ready=le();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var EL=require("vscode");var X0=class extends Mb{constructor(t,n,i,o,s,a,c){super(t,n,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];c&&(this.debugLocationTracker=c.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(l=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(l)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return ne(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let n=this.notebookDocument.cellAt(t),i=bs(n);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||n.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=xn(s.sourcePath);this.fileToCell.set(a,EL.Uri.parse(i.interactive.uristring));let c=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(c=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:EL.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:c+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((l,u)=>u.metadata.interactive.lineIndex-l.metadata.interactive.lineIndex)}catch(o){x(`Failed to dump cell for ${n.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,n){if(n=t?.source??n,!n||!n.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===n.path);i&&(n.name=_e(i.interactiveWindow.path),n.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,n){let i=t.line;if(n=t?.source??n,!n||!n.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==n.path||(n.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let n=t.arguments;if(delete n.lines,n.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let p=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(m=>u.line>=m.metadata.generatedCode.line&&u.line<=m.metadata.generatedCode.endLine);if(p&&p.metadata.interactive.lineIndex!==i)a(),i=p.metadata.interactive.lineIndex,o=[u];else if(p)o.push(u);else{let m={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[m]}}))}}a();let c=await Promise.all(s),l=JSON.parse(JSON.stringify(c[0]));return c.slice(1).forEach(u=>{l.body.breakpoints=l.body.breakpoints.concat(u.body.breakpoints??[])}),l.command="setBreakpoints",l.type="response",l.success=!0,l.request_seq=t.seq,l}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var uQ=require("vscode");var Z0=class{constructor(e){this.debugCell=e}trace(e,t){E(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),uQ.window.showWarningMessage(b.restartNotSupported,{modal:!0}).then(f,f),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var fI=class extends Nb{constructor(t,n,i,o,s,a,c){super(t,n,c);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(Wd.debug.registerDebugAdapterDescriptorFactory(nx,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,n){ne("Starting debugging IW"),await this.checkIpykernelAndPrompt(n)===1&&await this.startDebuggingCell(t,n)}async startDebuggingCell(t,n){let i=this.configService.getSettings(t.uri),o={type:nx,name:_e(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:n.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){x("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let n=t.configuration;YG(n);let i=Wd.workspace.notebookDocuments.find(s=>s.uri.toString()===n.__notebookUri);if(!i||typeof n.__cellIndex!="number"){x("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){ee("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){ee("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new Y0(i,n,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(n,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,n,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){Wd.window.showInformationMessage(b.kernelWasNotStarted).then(f,f);return}let a=new X0(n,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let c=i.cellAt(t.__cellIndex),l=new Q0(a,c,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([l,new Z0(c)]),l.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new Wd.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,n){let i=this.getDebugSession(t.notebook);i&&(ne("Sending debug request for source map"),await Promise.all(n.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",z0(o))})))}};fI=v([(0,wl.injectable)(),d(0,(0,wl.inject)(Ke)),d(1,(0,wl.inject)(Ct)),d(2,(0,wl.inject)(Dr)),d(3,(0,wl.inject)(p0)),d(4,(0,wl.inject)(ue)),d(5,(0,wl.inject)(Oi)),d(6,(0,wl.inject)(pt))],fI);var dw=D(O()),mw=require("vscode");var pQ="InteractiveShiftEnterBanner";var Vd=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=lN.bannerMessage;this.bannerLabels=[ve.bannerLabelYes,ve.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(N("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await mw.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,mw.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,mw.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};v([Zr("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],Vd.prototype,"disableInteractiveShiftEnter",1),v([Zr("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],Vd.prototype,"enableInteractiveShiftEnter",1),Vd=v([(0,dw.injectable)(),d(0,(0,dw.inject)(ac)),d(1,(0,dw.inject)(ue))],Vd);var Hf=D(O()),dQ=require("vscode");var hI=class{constructor(e,t,n,i){this.configService=e;this.fs=t;this.context=n;this.registry=i;this.priority=5}activate(){this.registry.register(this,yt)}async getCode(e){if(!ft(e.kernelConnectionMetadata))return[];if(!cn()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!mt(e.kernelConnectionMetadata))return[]}if(e.notebook?.notebookType===yt){if(!mt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(dQ.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return Fe(t,{trim:!1})}return[]}};hI=v([(0,Hf.injectable)(),d(0,(0,Hf.inject)(ue)),d(1,(0,Hf.inject)(at)),d(2,(0,Hf.inject)(ut)),d(3,(0,Hf.inject)(Go))],hI);var vI=D(O()),yI=require("vscode");var gI=class{constructor(e,t,n){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=n}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(yI.languages.registerFoldingRangeProvider([$w],this))}provideFoldingRanges(e,t,n){if([Ul,Hw].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return n.isCancellationRequested||o.length==0?void 0:o.map(s=>new yI.FoldingRange(s.range.start.line,s.range.end.line,yI.FoldingRangeKind.Region))}}};gI=v([(0,vI.injectable)(),d(0,(0,vI.inject)(Kd)),d(1,(0,vI.inject)(ut)),d(2,(0,vI.inject)(ue))],gI);var fw=D(O());var mQ=require("vscode");var bI=class{constructor(e,t){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(mQ.languages.registerCodeLensProvider([$w],this.dataScienceCodeLensProvider))}};bI=v([(0,fw.injectable)(),d(0,(0,fw.inject)(Kd)),d(1,(0,fw.inject)(ut))],bI);var ua=D(O());var PL="LastInteractiveKernelSelected",II=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=n;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t){if(t){let n=this.controllerRegistration.get(t,yt);if(n)return n}if(this.workspaceMemento.get(PL)){let n=this.workspaceMemento.get(PL),i=n?this.controllerRegistration.get(n,yt):void 0;if(i)return i}if(this.interpreterService)return await Pbe(yt,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,n,i,o){await as(n,e);let s=(u,p)=>{u!=="start"&&u!=="restart"||ne(`(onStart) Looking for controller ${p.controller.id} in ${this.controllerRegistration.all.map(m=>`${m.kind}:${m.id}`).join(", ")}`)},a=await ia.connectToNotebookKernel(e,this.serviceContainer,{resource:n||i.uri,notebook:i,controller:t},new Yt(!1),o,"jupyterExtension",s),c=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!c)throw Error(`Controller ${a.controller.id} not found or not yet created`);let l=c.controller;return this.interpreterService&&kbe(a.kernelConnectionMetadata,n,this.interpreterService).then(async u=>{await this.workspaceMemento.update(PL,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{W("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:l}}};II=v([(0,ua.injectable)(),d(0,(0,ua.inject)(Ct)),d(1,(0,ua.inject)(st)),d(1,(0,ua.optional)()),d(2,(0,ua.inject)(F)),d(3,(0,ua.inject)(He)),d(3,(0,ua.named)(si)),d(4,(0,ua.inject)(pt))],II);async function Pbe(r,e,t,n){let i=await t.getActiveInterpreter(e);if(i){let o=await js(i),s=Ho.create({kernelSpec:o,interpreter:i,id:Ai(o,i)}),a=n.addOrUpdate(s,[r]),c=a[0];return n.trackActiveInterpreterControllers(a),ne(`Active Interpreter Controller ${c.connection.kind}:${c.id} created for View ${r} with resource ${$(e)}`),c}}async function kbe(r,e,t){return(await t.getActiveInterpreter(e))?.id===r.interpreter?.id}var xI=D(O());var Bd=require("vscode");var SI=class{constructor(e,t,n){this.configService=e;this.fs=t;this.registry=n;this.priority=0}activate(){this.registry.register(this,yt)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?Fe(ic(nc.UpdateCWDAndPath,Te(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!mt(e.kernelConnectionMetadata)&&!kP(e.kernelConnectionMetadata)||!ft(e.kernelConnectionMetadata))return;let t=Os(),n=e.resourceUri?.path.endsWith(".interactive")&&t?Bd.Uri.joinPath(t,e.resourceUri.path):e.resourceUri,i=await this.calculateWorkingDirectory(e.resourceUri);if(i&&await this.fs.exists(i))return i;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(i=Bd.Uri.file(cg(Te(i),n,this.configService.getSettings(n))),i&&await this.fs.exists(i)))return i}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=$k(n.notebookFileRoot);if(i&&Bd.workspace.workspaceFolders?.length){let o=Bd.Uri.file(i),s=Bd.workspace.workspaceFolders[0].uri;if(kh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=Bd.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};SI=v([(0,xI.injectable)(),d(0,(0,xI.inject)(ue)),d(1,(0,xI.inject)(at)),d(2,(0,xI.inject)(Go))],SI);function fQ(r){r.addSingleton(Wi,lI),r.addSingleton(L0,II),r.addSingleton(be,Lo),r.addSingleton(be,cI),r.add(O0,er),r.addSingleton(K0,nI),r.addSingleton(Kd,iI),r.addSingleton(be,bI),r.addSingleton(be,gI),r.addSingleton(be,oI),r.addSingleton(be,uI),r.addSingleton(be,SI),r.addSingleton(be,hI),r.addSingleton(eI,tI,void 0,[be]),r.addSingleton(aa,aI),r.addSingleton(lg,pI),r.addSingleton(F0,mI),r.addSingleton(U0,fI,void 0,[be]),r.addSingleton(P2,Vd,pQ)}var qd=D(O()),El=require("vscode");var CI=class{constructor(e,t,n){this.jupyterServerHelper=e;this.fileSystem=t;this.errorHandler=n;this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython(),t=await lp(e);return e&&t&&t.major||3}}async exportToFile(e,t,n=!0){let i=await this.serialize(e);try{if(await this.fileSystem.writeFile(El.Uri.file(t),i||""),!n)return;let o=b.exportOpenQuestion1;El.window.showInformationMessage(b.exportDialogComplete(t),o).then(async s=>{try{s===o&&await W0(El.Uri.file(t))}catch(a){await this.errorHandler.handleError(a)}},f)}catch(o){x("Error in exporting notebook file"),El.window.showInformationMessage(b.exportDialogFailed(o)).then(f,f)}}async serialize(e,t){let n=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:n},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${n}`,version:n},kernelspec:t},o=El.extensions.getExtension("vscode.ipynb")?.exports;if(!o)throw new Error("vscode.ipynb extension not found");let s=new El.NotebookData(e);return s.metadata=hp()?{custom:{metadata:i,nbformat:OS.major,nbformat_minor:OS.minor}}:{metadata:i,nbformat:OS.major,nbformat_minor:OS.minor},o.exportNotebook(s)}};CI=v([(0,qd.injectable)(),d(0,(0,qd.inject)(yp)),d(0,(0,qd.optional)()),d(1,(0,qd.inject)(at)),d(2,(0,qd.inject)(en))],CI);var Jd=D(O()),hQ=require("vscode");var wI=class{constructor(e,t,n,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=n;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>b.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>ic(nc.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let n=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(n){let i;n.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(b.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Qe.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(hQ.Uri.file(t.filePath),ic(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};wI=v([(0,Jd.injectable)(),d(0,(0,Jd.inject)(vr)),d(1,(0,Jd.inject)(F)),d(2,(0,Jd.inject)(ue)),d(3,(0,Jd.inject)(xg)),d(4,(0,Jd.inject)(OP))],wI);var pa=D(O());var Is=require("vscode");var e1=class{constructor(e,t,n,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=n;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand(J.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand(J.ExportToHTML,(e,t,n)=>this.export(e,"html",t,n)),this.registerCommand(J.ExportToPDF,(e,t,n)=>this.export(e,"pdf",t,n)),this.registerCommand(J.Export,(e,t,n)=>this.export(e,void 0,t,n)),this.registerCommand(J.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let n=Is.commands.registerCommand(e,t,this);this.disposables.push(n)}async nativeNotebookExport(e){let t=Jn(e)?e:e?.notebookEditor?.notebookUri,n=t?Is.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):Is.window.activeNotebookEditor?.notebook;if(n){let i,o=this.kernelFinder.registered.find(c=>c.kind==="localPythonEnvironment"),s=new Is.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(n,o,s.token).then(c=>c?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(n)?.connection.interpreter||i;return this.export(n,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,n,i){if(!e){if(e=Is.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){ee("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&N("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,n,i);else{let o=await this.showExportQuickPickMenu(e,n,i).then(s=>s);o!==void 0?o.handler():N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,n){let i=[];return(n||e.metadata&&CP(vo(e)))&&i.push({label:b.exportPythonQuickPickLabel,picked:!0,handler:()=>{N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),Is.commands.executeCommand(J.ExportAsPythonScript,e,n).then(f,f)}}),i.push({label:b.exportHTMLQuickPickLabel,picked:!1,handler:()=>{N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),Is.commands.executeCommand(J.ExportToHTML,e,t,n).then(f,f)}},{label:b.exportPDFQuickPickLabel,picked:!1,handler:()=>{N("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),Is.commands.executeCommand(J.ExportToPDF,e,t,n).then(f,f)}}),i}async showExportQuickPickMenu(e,t,n){let i=this.getExportQuickPickItems(e,t,n),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:b.exportAsQuickPickPlaceholder};return Is.window.showQuickPick(i,o)}};var t1=require("vscode");var EI=class{constructor(e,t,n,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=n;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new e1(this.fileConverter,this.fs,this.interactiveProvider,o,new Dd(a),s),t1.workspace.isTrusted||t1.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){t1.workspace.isTrusted&&this.exportCommand?.register()}};EI=v([(0,pa.injectable)(),d(0,(0,pa.inject)(F)),d(1,(0,pa.inject)(Ub)),d(2,(0,pa.inject)(at)),d(3,(0,pa.inject)(Wi)),d(3,(0,pa.optional)()),d(4,(0,pa.inject)(Ct)),d(5,(0,pa.inject)(Mr)),d(6,(0,pa.inject)(pn))],EI);var $d=D(O()),kI=require("vscode");var gQ=require("vscode");var kL="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",Dbe=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),_be=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),PI=class{constructor(e,t,n){this.controllerManager=e;this.globalMemento=n;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){z(this.disposables)}activate(){kI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!Rt(e))return;let t=PP(vo(e));t&&this.recommendExtensionForLanguage(t).catch(f)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||ft(e.connection))return;let t=Io(e.connection);t&&this.recommendExtensionForLanguage(t).catch(f)}async recommendExtensionForLanguage(e){let t=_be.get(e.toLowerCase());if(!t||gQ.extensions.getExtension(t))return;let n=Dbe.get(t);if(!n||this.globalMemento.get(kL,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=b.recommendExtensionForNotebookLanguage(`[${n.displayName}](${n.extensionLink})`,e);switch(N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await kI.window.showInformationMessage(i,ve.bannerLabelYes,ve.bannerLabelNo,ve.doNotShowAgain)){case ve.bannerLabelYes:{N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),kI.commands.executeCommand("extension.open",t).then(f,f);break}case ve.bannerLabelNo:{N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case ve.doNotShowAgain:{N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(kL,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(kL,s));break}default:N("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};PI=v([(0,$d.injectable)(),d(0,(0,$d.inject)(Ct)),d(1,(0,$d.inject)(F)),d(2,(0,$d.inject)(He)),d(2,(0,$d.named)(bt))],PI);var Pl=D(O()),Vi=require("vscode");var DI=class{constructor(e,t,n,i,o){this.interactiveProvider=e;this.kernelProvider=n;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;t.push(this),this.nativeContext=new sr(Sr.IsNativeActive),this.canRestartNotebookKernelContext=new sr(Sr.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new sr(Sr.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new sr(Sr.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new sr(Sr.CanInterruptInteractiveWindowKernel),this.interactiveContext=new sr(Sr.IsInteractiveActive),this.interactiveOrNativeContext=new sr(Sr.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new sr(Sr.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new sr(Sr.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new sr(Sr.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new sr(Sr.HaveNativeCells),this.isPythonNotebook=new sr(Sr.IsPythonNotebook),this.isJupyterKernelSelected=new sr(Sr.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new sr(Sr.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new sr(Sr.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){Vi.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),Vi.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(Vi.window.activeNotebookEditor),Vi.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),Vi.window.activeTextEditor?.document.languageId===xe&&this.onDidChangeActiveTextEditor(Vi.window.activeTextEditor),Vi.window.onDidChangeNotebookEditorSelection(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Vi.workspace.onDidOpenNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Vi.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(Vi.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(f)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(f),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===xt:!1;this.nativeContext.set(t).catch(f),this.isPythonNotebook.set(e&&t?CP(vo(e.notebook)):!1).catch(f),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(){this.hasNativeNotebookOrInteractiveWindowOpen.set(Vi.workspace.notebookDocuments.some(e=>e.notebookType===xt||e.notebookType===yt)).catch(f)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===xt?this.kernelProvider.get(e.notebook):void 0;if(t){let n=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||n.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(f);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(f)}else this.canRestartNotebookKernelContext.set(!1).catch(f),this.canInterruptNotebookKernelContext.set(!1).catch(f);this.updateKernelSourceContext(t).catch(f),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!Ft(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(f);return}let t=e.kernelConnectionMetadata,n=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!n){this.kernelSourceContext.set("").catch(f);return}this.kernelSourceContext.set(n.id).catch(f)}updateSelectedKernelContext(){let e=Vi.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&Rt(e)&&this.controllers.getSelected(e)?this.isJupyterKernelSelected.set(!0).catch(f):this.isJupyterKernelSelected.set(!1).catch(f)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let n=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!n).catch(f);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(f)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(f),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(f);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===yt?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===xt&&t===Vi.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(Vi.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===xe&&!Qj(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(f),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(f)}};DI=v([(0,Pl.injectable)(),d(0,(0,Pl.inject)(Wi)),d(0,(0,Pl.optional)()),d(1,(0,Pl.inject)(F)),d(2,(0,Pl.inject)(Ke)),d(3,(0,Pl.inject)(Ct)),d(4,(0,Pl.inject)(Qt))],DI);var r1=D(O()),Xa=require("vscode");var Tbe=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,Rbe=1e3,Abe=Ar(),vQ=Symbol("IImportTracker"),Gf=class{constructor(e){this.pendingChecks=new So;this.disposables=[];this.sentMatches=new Set;e.push(this),Xa.workspace.onDidOpenNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),Xa.workspace.onDidCloseNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),Xa.workspace.onDidSaveNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),Xa.notebooks.onDidChangeNotebookCellExecutionState(t=>{t.state==Xa.NotebookCellExecutionState.Pending&&!this.isTelemetryDisabled&&this.checkNotebookCell(t.cell,"onExecution").catch(f)},this,e)}get isTelemetryDisabled(){return zE()}dispose(){z(this.disposables),this.pendingChecks.clear()}activate(){Xa.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let n=0;n<Math.min(Rbe,e.lineCount);n++){let i=e.lineAt(n);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!Rt(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let n=this.pendingChecks.get(e);n&&(clearTimeout(n),this.pendingChecks.delete(e)),Abe?t():this.pendingChecks.set(e,setTimeout(t,5e3))}async checkNotebookDocument(e,t){!Rt(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async n=>this.checkNotebookCell(n,t)))}async checkNotebookCell(e,t){if(!(!Rt(e.notebook)||e.kind!==Xa.NotebookCellKind.Code||e.document.languageId!==xe))try{let n=e.notebook.notebookType===xt?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),n,t)}catch(n){if(!ni)throw n}}lookForImports(e){let t=[];try{for(let n of e){if(!n.includes("import")&&!n.includes("from"))continue;let i=n?Tbe.exec(n):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,n){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${n}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await It(i);N("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:n})}))}};Gf=v([(0,r1.injectable)(),d(0,(0,r1.inject)(F))],Gf);var kl=D(O());var DL=require("vscode");var _I=class{constructor(e,t,n,i){this.disposableRegistry=e;this.configuration=t;this.rawSupported=n;this.commandListeners=i;this.isDisposed=!1;this.startTime=Date.now();this.onSettingsChanged=()=>{let t=this.configuration.getSettings(void 0).sendSelectionToInteractiveWindow;new sr(Sr.OwnsSelection).set(t).catch(f)}}get activationStartTime(){return this.startTime}activate(){this.onSettingsChanged(),this.changeHandler=this.configuration.getSettings(void 0).onDidChange(this.onSettingsChanged.bind(this)),this.disposableRegistry.push(this),this.disposableRegistry.push(DL.window.onDidChangeActiveTextEditor(()=>this.onChangedActiveTextEditor())),this.onChangedActiveTextEditor(),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new sr(Sr.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(f,f)}onChangedActiveTextEditor(){let e=new sr(Sr.HasCodeCells),t=DL.window.activeTextEditor;t&&t.document.languageId===xe?e.set(gz(t.document,this.configuration.getSettings())).catch(f):e.set(!1).catch(f)}};_I=v([(0,kl.injectable)(),d(0,(0,kl.inject)(F)),d(1,(0,kl.inject)(ue)),d(2,(0,kl.inject)(fi)),d(2,(0,kl.optional)()),d(3,(0,kl.multiInject)(Nh))],_I);var bi=D(O()),n1=require("vscode");var Qf=D(O()),zf=require("vscode");var bQ=require("vscode");var _L="JUPYTER_API_ACCESS_INFORMATION",yQ=new Set([$e.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),TL=new Set(["rchiodo","nuant"]),Lu=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new xh}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===Sh?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===zf.ExtensionMode.Test||!t||wo()==="insiders"){if(!yQ.has(t)&&!TL.has(t)){W(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=bQ.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;zf.window.showErrorMessage(b.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(f,f)}if(!TL.has(t)||!t||this.context.extensionMode===zf.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(yQ.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!TL.has(t))return zf.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(f,f),x(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(_L)?.find(s=>s.extensionId===e.extensionId);if(i)return N("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=b.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,ve.bannerLabelYes),c=await zf.window.showInformationMessage(s,{modal:!0},ve.bannerLabelYes,ve.bannerLabelNo)===ve.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let l=[...this.globalState.get(_L,[])];return l=l.filter(u=>u.extensionId!==e.extensionId),l.push({allowed:c?"yes":"no",extensionId:e.extensionId}),this.globalState.update(_L,l)}).then(f,f),N("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:c?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:c}})();return this.extensionAccess.set(e.extensionId,o),o}};Lu=v([(0,Qf.injectable)(),d(0,(0,Qf.inject)(He)),d(0,(0,Qf.named)(bt)),d(1,(0,Qf.inject)(ut))],Lu);var IQ=new WeakMap;function RL(r){let e=IQ.get(r);return e||(e=Nbe(r),IQ.set(r,e)),e}function Nbe(r){return new Proxy(r,{get(e,t){return t==="kernel"?e.kernel?Mbe(e.kernel):void 0:Reflect.get(e,t)}})}var SQ=new WeakMap;function Mbe(r){let e=SQ.get(r);return e||(e=Obe(r),SQ.set(r,e)),e}function Obe(r){return new Proxy(r,{get(e,t){return t==="registerCommTarget"?(n,i)=>(aG(r,n),Reflect.get(e,t).apply(e,[n,i])):t==="removeCommTarget"?(n,i)=>(cG(r,n),Reflect.get(e,t).apply(e,[n,i])):Reflect.get(e,t)}})}var TI=class{constructor(e,t,n,i,o,s,a,c){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=n;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=c;this.chainedApiAccess=new xh;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let n=new hw(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,n),n}};TI=v([(0,bi.injectable)(),d(0,(0,bi.inject)(Ke)),d(1,(0,bi.inject)(Mr)),d(2,(0,bi.inject)(wm)),d(3,(0,bi.inject)(F)),d(4,(0,bi.inject)(Ct)),d(5,(0,bi.inject)(Lu)),d(6,(0,bi.inject)(Ia)),d(7,(0,bi.inject)(pt))],TI);var hw=class{constructor(e,t,n,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=n;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new n1.EventEmitter;this._onDidChangeKernels=new n1.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new n1.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(c=>{ne(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(c=>{ne(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(c=>{ne(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(c=>{ne(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),E(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.kernelProvider.get(n.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.thirdPartyKernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.thirdPartyKernelProvider.get(n.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.controllerRegistration.registered.forEach(n=>{n.controller.notebookType===xt&&n.connection.kind==="connectToLiveRemoteKernel"&&(!n.connection.kernelModel.id||t.has(n.connection.kernelModel.id)||e.push({metadata:n.connection,uri:void 0,id:n.id}))}),e}getKernel(e){N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:RL(t.session)}}async startKernel(e,t){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return N("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let n=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!n)throw new Error("Not found");let i=await ia.connectToKernel(n,this.serviceContainer,{resource:t},new Yt(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return RL(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(Fs.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};hw=v([d(1,(0,bi.inject)(Ke)),d(2,(0,bi.inject)(Mr)),d(3,(0,bi.inject)(wm)),d(4,(0,bi.inject)(F)),d(5,(0,bi.inject)(Ct)),d(6,(0,bi.inject)(pt))],hw);var i1=D(O()),Dl=require("vscode");var xQ=require("vscode");var Yf=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(f)}getActiveResource(){let e=xQ.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(Dl.workspace.workspaceFolders)&&Dl.workspace.workspaceFolders.length>0?Dl.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await WJ(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==xe)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(Dl.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let n=Dl.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(n?n.uri:void 0).catch(f)}addHandlers(){this.disposables.push(Dl.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=Dl.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(Dl.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),n=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(Dl.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return Ms(e,"")}};v([Rh("Failed to activate a workspace")],Yf.prototype,"activateWorkspace",1),Yf=v([(0,i1.injectable)(),d(0,(0,i1.inject)(at))],Yf);var AI=D(O());var RI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){x(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};RI=v([(0,AI.injectable)(),d(0,(0,AI.optional)()),d(0,(0,AI.multiInject)(be))],RI);var gw=D(O()),Tl=require("vscode");var AL=Symbol("ISurveyBanner");var _l=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[qE.bannerLabelYes,qE.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner"),setTimeout(()=>{_l.surveyDelay=!0},10*60*1e3)}isEnabled(e){switch(e){case 0:if(wo()==="insiders")return this.isEnabledInternal(e);break;case 1:if(wo()==="stable")return this.isEnabledInternal(e);break;default:return x("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return Tl.env.uiKind!==Tl.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){Tl.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){if(!this.shouldShowBanner(e))return;switch(this.disabledInCurrentSession=!0,await Tl.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return sm()||!this.isEnabled(e)||this.disabledInCurrentSession||!_l.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){Kp(this.getSurveyLink(e))}async disable(e,t){let n=e===0?6:4;n&&await this.showBannerState.get(t).updateValue({expiry:n*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return x("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){Rt(e.cell.notebook)&&e.state===Tl.NotebookCellExecutionState.Executing&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(f),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(f))}async updateStateAndShowBanner(e,t){let n=this.persistentState.createGlobalPersistentState(e,0);await n.updateValue(n.value+1),this.showBanner(t).catch(f)}getBannerMessage(e){switch(e){case 0:case 1:return uN.bannerMessage;default:return x("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return x("Invalid Banner type"),""}}};_l.surveyDelay=!1,_l=v([(0,gw.injectable)(),d(0,(0,gw.inject)(ac)),d(1,(0,gw.inject)(F))],_l);var Za=require("vscode");function CQ(r,e){e&&Za.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let n of r.globalState.keys())t.push(r.globalState.update(n,void 0).then(f,f));for(let n of r.workspaceState.keys())t.push(r.workspaceState.update(n,void 0).then(f,f));t.push(Za.commands.executeCommand(J.ClearSavedJupyterUris).then(f,f)),await Promise.all(t).catch(f),await Promise.all([Za.workspace.fs.delete(Za.Uri.joinPath(r.globalStorageUri,"lastExecutedRemoteCell.json")).then(f,f),Za.workspace.fs.delete(Za.Uri.joinPath(r.globalStorageUri,"remoteServersMRUList.json")).then(f,f),Za.workspace.fs.delete(Za.Uri.joinPath(r.globalStorageUri,Dy)).then(f,f)]),ee("Cache cleared")})}function wQ(r,e){CQ(r,e)}var a1=D(O()),Ht=require("vscode");var o1=b.percentPipCondaInstallInsteadOfBang("pip"),NL=b.percentPipCondaInstallInsteadOfBang("conda"),EQ=b.matplotlibWidgetInsteadOfOther,s1="Jupyter",NI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=Ht.languages.createDiagnosticCollection(s1),this.disposables.push(this.problems),e.push(this)}dispose(){z(this.disposables),this.problems.dispose()}activate(){this.disposables.push(Ht.languages.registerCodeActionsProvider(xe,this)),this.disposables.push(Ht.languages.registerHoverProvider(xe,this)),Ht.workspace.onDidChangeTextDocument(e=>{let t=ug(e.document);if(!t)return;let n=t.getCells().find(i=>i.document===e.document);n&&this.analyzeNotebookCell(n)},this,this.disposables),Ht.workspace.onDidCloseNotebookDocument(e=>{this.problems.delete(e.uri);let t=this.notebooksProcessed.get(e);this.notebooksProcessed.delete(e),t&&t.forEach((n,i)=>this.problems.delete(Ht.Uri.parse(i)))},this,this.disposables),Ht.workspace.onDidOpenNotebookDocument(e=>this.analyzeNotebook(e),this,this.disposables),Ht.workspace.onDidChangeNotebookDocument(e=>{let t=this.notebooksProcessed.get(e.notebook);e.contentChanges.forEach(n=>{n.removedCells.forEach(i=>{t?.delete(i.document.uri.toString())}),n.addedCells.forEach(i=>this.queueCellForProcessing(i))}),e.cellChanges.forEach(n=>this.queueCellForProcessing(n.cell))},this,this.disposables),Ht.workspace.notebookDocuments.map(e=>this.analyzeNotebook(e))}provideHover(e,t,n){if(ug(e)?.notebookType!==xt)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(c=>c.message===o1||c.message===NL);if(!s||!s.range.contains(t))return;let a=s.message===o1?"pip":"conda";return new Ht.Hover(b.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,n,i){if(!ug(e))return[];let o=[];return n.diagnostics.forEach(s=>{switch(s.message){case o1:o.push(this.createReplaceCodeAction(e,"pip",s));break;case NL:o.push(this.createReplaceCodeAction(e,"conda",s));break;case EQ:o.push(this.createGotoWikiAction(e,Ht.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,n){let i=new Ht.CodeAction(b.replacePipCondaInstallCodeAction(t),Ht.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[n];let o=new Ht.WorkspaceEdit;return o.replace(e.uri,new Ht.Range(n.range.start,new Ht.Position(n.range.start.line,n.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,n){let i=new Ht.CodeAction(b.matplotlibWidgetCodeActionTitle,Ht.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[n],i.command={title:b.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===xt&&e.getCells().forEach((t,n)=>n<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;this.cellsToProcess.delete(e),this.analyzeNotebookCell(e),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==Ht.NotebookCellKind.Code||e.document.languageId!==xe||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let n=0;n<Math.min(e.document.lineCount,50);n++){let i=e.document.lineAt(n),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new Ht.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:o1,range:c,severity:Ht.DiagnosticSeverity.Error,source:s1}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new Ht.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:NL,range:c,severity:Ht.DiagnosticSeverity.Error,source:s1}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,c=new Ht.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:EQ,range:c,severity:Ht.DiagnosticSeverity.Warning,source:s1}])}}}};NI=v([(0,a1.injectable)(),d(0,(0,a1.inject)(F))],NI);var d1=D(O()),Ir=require("vscode");var PQ=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function c1(r){if(r>=300)return"ZZZZZZZ";if(r<=25)return`A${String.fromCharCode(65+r)}`;let e=String.fromCharCode(65+Math.ceil(r/25)),t=String.fromCharCode(65+r%25);return`${e}${t}`}var NQ=require("vscode");var Xf=require("vscode");var Fbe=new Map([["julia",Wbe],["python",Ube],["r",Vbe]]);function kQ(r,e){let t=Fbe.get(e.toLowerCase());return t?t(r):r}var Lbe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function Ube(r){let e=Fe(r,{trim:!1,removeEmptyEntries:!1}),t=-1,n=!1,i=!1,o=[],s=new Set,a=!1,c="",l=!1,u=!1;if(e.map((m,h)=>{if(h===0){let y=["Signature:","Init signature:"].find(C=>m.toLowerCase().startsWith(C.toLowerCase()));if(y){n=!0,m=m.substring(y.length).trim(),o.push("```python"),m.trim().length&&(o.push(m),l=!0);return}}if(m.startsWith("File:")&&h===e.length-1||m.startsWith("Type:")&&h===0)return;if(!a&&m.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let g=Lbe.find(y=>m.trim().toLowerCase().startsWith(y.toLowerCase()));if(g&&!s.has(g)){c=g.toLowerCase(),s.add(g),a=!0,t=h,i=!1,n&&o.push("```","----------"),n=!1,u=!1,c!=="docstring:"&&o.push(`## ${g}`);let y=m.includes(":")?m.split(":")[1].replace("<no docstring>","").trim():"";y.length&&(o.push(y),l=!0);return}if(!i){if(t+1===h&&m.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=h,i=!1,n=!1,u=!1;return}if(c==="parameters"||c==="see also"){m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="options:"){m.startsWith("-")&&m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="returns"){m.trim().length&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="examples"&&!n&&(t+1===h||t+2===h))return i=!1,n=!0,l=l||m.trim().length>0,o.push("```python",m);if(!n&&m.startsWith("class ")&&m.trim().endsWith("):")){n=!0,u=!0,o.push("```python",m),l=l||m.trim().length>0;return}if(n&&u&&m.trim().length>0&&m.substring(0,1)!==" "&&m.substring(0,1)!=="	")return n=!1,u=!1,o.push(m,"```");l=l||m.trim().length>0,o.push(m)}}),!l)return"";let p=o.join(`  
`);return n?new Xf.MarkdownString(p+"  \n```"):new Xf.MarkdownString(p)}var jbe=[{section:"Examples:",header:"Examples",nextLine:/≡/g},{section:"Usage note",header:"Usage note",nextLine:/≡/g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:String.fromCharCode(9474)}];function Wbe(r){let e=Fe(r,{trim:!1,removeEmptyEntries:!1}),t=!1,n=[],i=new Set,o="",s=!1,a=!1;e.every(l=>l.trim().length===0||l.startsWith("  "))&&e.forEach((l,u)=>e[u]=l.trim().length?l.substring(2):l),e.map((l,u)=>{if(l.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,n.push(l);if(!a)return o="signature",t=!0,a=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");o==="signature"&&l.trim()===""&&(o="",t=!1,s=!1,n.push("```"));let p=jbe.find(m=>l.trim().toLowerCase().startsWith(m.header.toLowerCase()));if(p&&(typeof p.nextLine=="string"?e[u+1].trim()===p.nextLine.trim():e[u+1].trim().replace(p.nextLine,"").length===0)){e[u+1]="",o=p.section.toLowerCase(),i.add(p.header),t&&n.push("```"),t=!1,n.push(`## ${p.section}`),o==="note:"&&!e.slice(u+1).every(m=>m.trim().length===0||m.trim().startsWith("|")||m.trim().startsWith(String.fromCharCode(9474)))&&(o="");return}if(o==="examples:"&&!t)return t=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");if(o==="note:"){n.push(l.trim()?l.trim().substring(1):"");return}t&&!s&&l.trim().length===0||n.push(l)});let c=n.join(`  
`);return t?new Xf.MarkdownString(c+"  \n```"):new Xf.MarkdownString(c)}function Vbe(r){let e=Fe(r,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,c)=>e[c]=a.indexOf("     ")===0?a.substring(5):a);let n="",i=!1,o=!1;e.map(a=>{let c=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes(String.fromCharCode(8))&&a.split("_").length===a.split(String.fromCharCode(8)).length&&c){i&&t.push("```"),i=!1,n=c.trim().toLowerCase(),t.push(`## ${c}`);return}if((n==="examples"||n==="examples:"||n==="usage"||n==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(n==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new Xf.MarkdownString(s+"  \n```"):new Xf.MarkdownString(s)}var DQ=new WeakMap;async function MI(r,e,t){let n=DQ.get(r)||0;DQ.set(r,n+1);let i=RP($e,r,{accessAllowed:!0}),o=`application/vnd.vscode.bg.execution.${n}`,s=`application/vnd.vscode.bg.execution.${n}.result`,a="",c=`
def __jupyter_exec_background__():
    from IPython.display import display
    from threading import Thread

    # First send a dummy response to get the display id.
    # Later we'll send the real response with the actual data.
    # And that can happen much later even after the execution completes,
    # as that response will be sent from a bg thread.
    output = display({"${o}": ""}, raw=True, display_id=True)

    def do_implementation():
        ${e.map((p,m)=>m===0?p:`        ${p}`).join(`
`)}

    def bg_main():
        try:
            output.update({"${s}": do_implementation()}, raw=True)
        except:
            pass


    Thread(target=bg_main, daemon=True).start()


__jupyter_exec_background__()
del __jupyter_exec_background__
`.trim(),l=new ci;l.add(t.onCancellationRequested(()=>l.dispose()));let u=or(t,new Promise((p,m)=>{l.add(i.onDidReceiveDisplayUpdate(async h=>{if(t.isCancellationRequested)return p(void 0);let g=km(h);if(!a||g?.transient?.display_id!==a)return;let y=h.items.find(C=>C.mime===s);if(y)try{return p(JSON.parse(new TextDecoder().decode(y.data)))}catch(C){return m(new Error("Failed to parse the result",C))}}))})).finally(()=>r.session&&_9(r.session,a));for await(let p of i.executeCode(c,t)){if(t.isCancellationRequested)return;let m=km(p);if(!m?.transient?.display_id)continue;let h=p.items.find(g=>g.mime===o||g.mime===s);if(h){if(h.mime===o){a=m.transient.display_id;continue}if(h.mime===s&&a===m.transient.display_id)return JSON.parse(new TextDecoder().decode(h.data))}}if(!t.isCancellationRequested){if(!a){W("Failed to get display id for completions");return}return u}}var Bbe=1,Hd=ri.IntellisenseResolveTimeout,_Q=5,ML=new WeakSet,l1=class extends Error{constructor(){super("Request timed out")}};async function MQ(r,e,t,n,i,o,s,a){if(!r.range||!n.session?.kernel||ML.has(n)||!ft(n.kernelConnectionMetadata)&&n.status!=="idle")return r;let c=Zbe(e||r,s,a),l=Xbe(c,n,t),u=Eg(t);try{let p=await Ch(Hd,new l1,or(u.token,l));if(!t.isCancellationRequested&&p?.status==="ok"&&p?.found){let m=qbe(p);r.documentation=kQ(m,o)}}catch(p){if(p instanceof NQ.CancellationError)return r;p instanceof l1&&(u.cancel(),Jbe(n,o,i))}finally{u.dispose()}return r}function qbe(r){return!r||r.status!=="ok"||!r.found?";":!r.data||typeof r.data!="object"?"":"text/plain"in r.data?fl(r.data["text/plain"]):""}var TQ=new WeakSet;function Jbe(r,e,t){ft(r.kernelConnectionMetadata)||ML.has(r)||(ML.add(r),W(`Failed to inspect code in kernel ${ht(r.kernelConnectionMetadata)}`),TQ.has(r)||(TQ.add(r),N("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:r.kernelConnectionMetadata.kind,kernelLanguage:e})))}var OL=new WeakMap,KL=new WeakMap;async function $be(r,e,t){let n=`return get_ipython().kernel.do_inspect("${Ix(e.code)}", ${e.cursor_pos}, ${e.detail_level})`;return{content:await MI(r,[n],t)}}var RQ={data:{},found:!1,status:"ok",metadata:{}};function Hbe(r,e){if(!r.session?.kernel)return;let t=JSON.stringify(e);return OL.get(r.session.kernel)?.get(t)}function Gbe(r,e,t){if(!r.session?.kernel||t.status!=="ok"||!t.found)return;let n=JSON.stringify(e),i=OL.get(r.session.kernel)||new Map;OL.set(r.session.kernel,i),i.size>100&&i.clear(),i.set(n,t)}function zbe(r){if(!r.session?.kernel)return!1;let e=KL.get(r.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};return!ft(r.kernelConnectionMetadata)&&e.maxTime>Hd?(W(`Not sending inspect request as previous requests took over ${Hd}s.`),!1):e.numberOfTimesMaxedOut>_Q?(W(`Not sending inspect request as there have been at least ${_Q} requests that took over ${Hd}s.`),!1):e.maxTime>Hd&&Date.now()-e.lastRequestTime<3e4?(W(`Not sending inspect request as previous requests took over ${Hd}s.`),!1):!0}async function Qbe(r,e){if(!r.session?.kernel||!AQ(r))return;ee(`Too many pending requests ${OQ(r)} for kernel ${r.id}, waiting for it to be ready.`);let t=r.session.kernel,n=[];await or(e,new Promise(i=>{let o=()=>{if(!AQ(r)){i(),z(n);return}setInterval(o,100)};ka(e.onCancellationRequested)(()=>{i(),t.statusChanged.disconnect(o)},void 0,n),t.statusChanged.connect(o),n.push({dispose:()=>{t.statusChanged.disconnect(o)}})})).finally(()=>z(n))}function Ybe(r,e){if(!r.session?.kernel)return;let t=KL.get(r.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};t.maxTime=Math.max(t.maxTime,e),t.lastRequestTime=Date.now(),e>Hd&&(t.numberOfTimesMaxedOut+=1),KL.set(r.session.kernel,t)}async function Xbe(r,e,t){if(!e.session?.kernel)return;let n=Hbe(e,r);if(n)return n;if(!zbe(e)||(await Qbe(e,t),t.isCancellationRequested))return RQ;let i=eIe(e),o=new Je,s=Fe(r.code).reverse()[0].slice(-50);E(`Inspecting code ${s}`);let a=ft(e.kernelConnectionMetadata)?$be(e,r,t):e.session.kernel.requestInspect(r);return a.finally(()=>i.dispose()),a.then(({content:c})=>{if(!e.session?.kernel)return;Gbe(e,r,c),Ybe(e,o.elapsedTime);let l=o.elapsedTime>Hd?W:E;return t.isCancellationRequested?l(`Inspected code ${s} in ${o.elapsedTime}ms (but cancelled)`):l(`Inspected code ${s} in ${o.elapsedTime}ms`),c})}function Zbe(r,e,t){let n=e.getText(),i=(typeof r.insertText=="string"?r.insertText:r.insertText?.value)||(typeof r.label=="string"?r.label:r.label.label)||"",o=n.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}var vw=new WeakMap;function AQ(r){return r.session?.kernel?OQ(r)>=Bbe:!1}function OQ(r){return r.session?.kernel?(vw.has(r.session?.kernel)||vw.set(r.session?.kernel,{count:0}),vw.get(r.session?.kernel)?.count||0):0}function eIe(r){if(!r.session?.kernel)return{dispose:f};let e=vw.get(r.session?.kernel)||{count:0};return vw.set(r.session?.kernel,e),e.count+=1,{dispose:()=>{e.count-=1}}}var p1=class extends Error{constructor(){super("Request timed out")}},FL=class{constructor(e,t,n){this.kernelId=e;this.kernel=t;this.monacoLanguage=n;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,n,i){if(!this.kernel.session?.kernel)return[];let o=e.version;if(this.pendingCompletionRequest.has(e))return[];this.pendingCompletionRequest.set(e,{position:t,version:o});let s=new Ir.Disposable(()=>{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===o&&this.pendingCompletionRequest.delete(e)});try{let a=Es(or(n,Promise.resolve(Ir.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(m=>m?.items||[]))),c=new Je;if(await Ci(50),n.isCancellationRequested)return[];let l=await Ch(ri.IntellisenseTimeout,new p1,this.provideCompletionItemsFromKernel(e,t,n,i));if(n.isCancellationRequested||!l||!l.length)return[];let u=await xr(0,a.promise);ft(this.kernel.kernelConnectionMetadata)&&!a.completed&&c.elapsedTime<ri.IntellisenseTimeout+50&&(u=await xr(ri.IntellisenseTimeout-c.elapsedTime,a.promise));let p=new Set((u||[]).map(m=>typeof m.label=="string"?m.label:m.label.label));return l.filter(m=>!p.has(typeof m.label=="string"?m.label:m.label.label))}catch(a){if(a instanceof p1)return[];throw a instanceof Ir.CancellationError||E("Completions failed",a),a}finally{s.dispose()}}async provideCompletionItemsFromKernel(e,t,n,i){if(n.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new Je,s={duration:0,timesExceededTimeout:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:f1(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(!ft(this.kernel.kernelConnectionMetadata)&&this.kernel.status!=="idle")return[];let c=e.getText(),l=e.offsetAt(t);a.requestSent=!0;let u=await or(n,this.getKernelCompletion(c,l,n));if(E(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=n.isCancellationRequested,a.completed=!n.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=n.isCancellationRequested?0:o.elapsedTime,n.isCancellationRequested)return[];if(u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return FQ(this.kernel,s,a),[];let p={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},m=p.metadata?p.metadata._jupyter_types_experimental:[];s.completionItems=p.matches.length,FQ(this.kernel,s,a);let h={code:c,cursor:p.cursor,documentRef:new WeakRef(e),position:e.positionAt(p.cursor.start)},g=new Ir.Range(e.positionAt(p.cursor.start),e.positionAt(p.cursor.end)),y=[];return Array.isArray(m)&&m.length>=p.matches.length&&m.every(C=>C&&typeof C.text=="string")?y=u.content.matches.map((C,k)=>{let A=m[k],T=A.type?PQ.get(A.type):Ir.CompletionItemKind.Field,U=new Ir.CompletionItem(C,T);return typeof A.start=="number"&&typeof A.end=="number"?U.range=new Ir.Range(e.positionAt(A.start),e.positionAt(A.end)):U.range=g,U.insertText=A.text,U.sortText=c1(k),ft(this.kernel.kernelConnectionMetadata)&&(C.startsWith("%")||C.startsWith("!"))&&(U.sortText=`ZZZ${U.sortText}`),this.previousCompletionItems.set(U,{...h,originalCompletionItem:JSON.parse(JSON.stringify(U))}),U}):y=p.matches.map((C,k)=>{let A=new Ir.CompletionItem(C);return A.range=g,A.sortText=c1(k),ft(this.kernel.kernelConnectionMetadata)&&(C.startsWith("%")||C.startsWith("!"))&&(A.sortText=`ZZZ${A.sortText}`),this.previousCompletionItems.set(A,{...h,originalCompletionItem:A}),A}),ft(this.kernel.kernelConnectionMetadata)?iIe(i.triggerCharacter,this.allowStringFilterForPython,y,e,t):y}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let n=this.previousCompletionItems.get(e);if(!n)return e;let{documentRef:i,position:o,originalCompletionItem:s}=n,a=i.deref();return a?MQ(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o):e}async getKernelCompletion(e,t,n){if(this.kernel.session?.kernel)return ft(this.kernel.kernelConnectionMetadata)?this.getPythonKernelCompletion(e,t,n):or(n,this.kernel.session.kernel.requestComplete({code:e,cursor_pos:t}))}async getPythonKernelCompletion(e,t,n){let i=`return get_ipython().kernel.do_complete("${Ix(e)}", ${t})`;return{content:await MI(this.kernel,[i],n)}}},KQ=new WeakMap,u1=new WeakMap;function FQ(r,e,t){let n=KQ.get(r),i=u1.get(r)?.count||0;e.duration>=ri.IntellisenseTimeout&&u1.set(r,{count:i+1,measures:e,properties:t}),e.timesExceededTimeout=i,n?n.elapsedTime>6e4&&(N("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),n.reset(),u1.delete(r)):(N("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),n=new Je,KQ.set(r,new Je),u1.delete(r))}var LL=class extends ir{constructor(t,n){super();this.kernel=t;this.notebookEditorProvider=n;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=m1(this.kernel);this.registerCompletionProvider(),this._register(Ir.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(LQ(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||this.registerCompletionProvider()}))}registerCompletionProvider(){if(!LQ(this.kernel.notebook.uri))return;let t=tIe(this.kernel);if(t.length===0){rIe(this.kernel);return}E(`Registering Kernel Completion Provider from kernel ${ht(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider?.dispose(),this.completionProvider=void 0,this.completionProvider=Ir.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,n,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await It(this.kernel.kernelConnectionMetadata.id);s=new FL(a,this.kernel,this.monacoLanguage),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,n,i,o).then(a=>(a.forEach(c=>this.completionItemsSent.set(c,s)),a))}async resolveCompletionItem(t,n){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,n):t}},Gd=class extends ir{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=Pe.instance.get(Ke);this._register(t.onDidStartKernel(async n=>{n.session?.kernel&&ft(n.kernelConnectionMetadata)&&n.session.kernel.requestComplete({code:"__file__.",cursor_pos:9});let i=Pe.instance.get(Ds),o=m1(n);if(!o||!i.inExperiment("KernelCompletions")&&o.toLowerCase()!==xe.toLowerCase()||this.kernelCompletionProviders.has(n))return;let s=Pe.instance.get(yi),a=this._register(new LL(n,s));this.kernelCompletionProviders.set(n,a)})),this._register(t.onDidDisposeKernel(n=>{this.kernelCompletionProviders.get(n)?.dispose()}))}};Gd=v([(0,d1.injectable)(),d(0,(0,d1.inject)(F))],Gd);function m1(r){return Tc(f1(r))}function f1(r){let e="";switch(r.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=r.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;default:e=r.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function LQ(r){return Ir.workspace.getConfiguration("jupyter",r).get("enableKernelCompletions",!1)}function tIe(r){let e=Ir.workspace.getConfiguration("jupyter",r.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=f1(r),n=m1(r);return t in e?Array.isArray(e[t])?e[t]:[]:n in e?Array.isArray(e[n])?e[n]:[]:[]}function rIe(r){let e=f1(r),t=m1(r);e.toLowerCase()===t.toLowerCase()?W(Ir.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,ht(r.kernelConnectionMetadata),`{${e}`)):W(Ir.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,ht(r.kernelConnectionMetadata),`{${e}`,`{${t}`))}function nIe(r,e){let t=r.indexOf('"'),n=r.indexOf("'"),i=r.lastIndexOf('"'),o=r.lastIndexOf("'"),s=t>=0?t:n,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function iIe(r,e,t,n,i){let o=t,s=i.character===0?void 0:new Ir.Range(i.line,i.character-1,i.line,i.character),c=(s?n.getText(s):void 0)===".",l=n.getWordRangeAtPosition(c||r==="."?new Ir.Position(i.line,i.character-1):i),u=l&&s?l.union(s):void 0,p=n.lineAt(i.line).text,m=u?n.getText(u):p,h=m.endsWith(".")||c,g=e&&(r=="'"||r=='"'||nIe(p,i));return ne(`Jupyter completions filtering applied: ${g} on ${p}`),o=o.map((y,C)=>{let k=typeof y.label=="string"?y.label:y.label.label,A=typeof y.label=="string"?y.label:y.label.label;if(A.startsWith("%")||A.startsWith("!"))return{...y,sortText:`ZZZ${y.sortText}`};if(g)return y;let T=m?A.indexOf(m):-1,U,oe,G;if(m&&h&&A.includes(m)){U=A.substring(A.indexOf(m)+(h?m.length:0)),oe=A.substring(A.indexOf(m)+m.length);let pe=(typeof y.label=="string"?y.label.length:y.label.label.length)-oe.length;G=y.range&&"start"in y.range?new Ir.Range(new Ir.Position(y.range.start.line,y.range.start.character+pe),y.range.end):y.range}if(!oe&&T>0){U=A.substring(A.indexOf(m)+(h?m.length:0)),oe=A.substring(A.indexOf(m)+m.length);let pe=(typeof y.label=="string"?y.label.length:y.label.label.length)-oe.length;G=y.range&&"start"in y.range?new Ir.Range(new Ir.Position(y.range.start.line,y.range.start.character+pe),y.range.end):y.range}return U&&oe&&G&&(y.label=U,k=oe,y.insertText=oe,y.filterText=h?`.${oe}`:oe,y.range=G,y.sortText=c1(C)),k.endsWith("/")?{...y,command:{command:"editor.action.triggerSuggest",title:""}}:(k.includes(" ")&&(k=k.replace(/\\ /g," "),typeof y.label=="string"?y.label=y.label.replace(/\\ /g," "):y.label.label=y.label.label.replace(/\\ /g," ")),g||!k.includes(".")&&!k.endsWith("/")?y:void 0)}).filter(y=>y!==void 0),ne(`Jupyter completions for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${t.map(y=>y.label).join(",")}`),ne(`Jupyter results for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${o.map(y=>y.label).join(",")}`),o}var zd=D(O()),yw=require("vscode");var jQ=D(Hc());var UL=require("vscode");function h1(){let e=UL.workspace.getConfiguration("python")?.get("languageServer");return!(e!=="Pylance"&&e!=="Default")}function UQ(r){if(r.scheme!=="vscode-interactive-input")return;let e=`${r.path.replace("InteractiveInput-","Interactive-")}.interactive`;return UL.workspace.notebookDocuments.find(t=>t.uri.path===e)?.uri}var Qd=class{constructor(e,t,n,i,o){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=n;this.controllerRegistration=i;this.kernelProvider=o;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=yw.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t)),e.registerGetNotebookUriForTextDocumentUriFunction!==void 0&&e.registerGetNotebookUriForTextDocumentUriFunction(t=>this._getNotebookUriForTextDocumentUri(t))}).catch(f)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return yw.extensions.getExtension(am)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){return this._isEnabled===void 0&&(this._isEnabled=h1()),this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let n=this.controllerRegistration.getSelected(t);if(n&&Ft(n.connection)){let o=this.kernelProvider.get(t);if(!o)return;let s=[];if(!o.startedAtLeastOnce){let g=new Promise(y=>o.onStarted(y,void 0,s));await xr(5e3,void 0,g)}if(!o.startedAtLeastOnce)return;let a=this.kernelProvider.getKernelExecution(o),c=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists("${__filename}"):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,u=(await a.executeHidden(c).catch(f)||[]).find(g=>g.output_type==="stream"&&g.name==="stdout");if(!u||!(u.text||"").toString().includes("EXECUTABLE"))return;let p=(u.text||"").toString();p=p.substring(p.indexOf("EXECUTABLE"));let m=p.split("EXECUTABLE").filter(g=>g.trim().length),h=m.length?m[0].trim():"";return!h||!await jQ.pathExists(h)?void 0:h}let i=n?.connection?.interpreter;return i?Te(i.uri):(ee(`No interpreter for Pylance for Notebook URI "${$(t.uri)}"`),"")}_getNotebookUriForTextDocumentUri(e){let t=UQ(e);if(!t)return;let n;return yw.window.tabGroups.all.find(i=>{i.tabs.find(o=>{if(Bf(o)){let s=o.input.uri.toString();o.input.uri.toString().endsWith(t.path)&&(n=s)}})}),n}};Qd=v([(0,zd.injectable)(),d(0,(0,zd.inject)(tr)),d(1,(0,zd.inject)(Ye)),d(2,(0,zd.inject)(yi)),d(3,(0,zd.inject)(Ct)),d(4,(0,zd.inject)(Ke))],Qd);function WQ(r){r.addSingleton(be,NI),r.addSingleton(Gd,Gd),r.addBinding(Gd,be),r.addSingleton(Qd,Qd),r.addBinding(Qd,be)}var KI=D(O());var VQ=require("vscode");var OI=class{constructor(e,t,n){this.extensionChecker=e;this.disposables=t;this.kernelProvider=n}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&VQ.window.showInformationMessage(b.pythonExtensionInstalled,ve.ok).then(f,f)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};OI=v([(0,KI.injectable)(),d(0,(0,KI.inject)(Ye)),d(1,(0,KI.inject)(F)),d(2,(0,KI.inject)(Ke))],OI);var Jr=D(O()),JQ=D(Ro()),Et=require("vscode");var Rl=require("vscode");var g1=class{constructor(e,t,n,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=n;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=bw(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:n,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(W(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&z(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,n,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=Rl.window.createInputBox();e.disposables.push(a),a.title=b.jupyterSelectPasswordTitle,a.placeholder=b.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[Rl.QuickInputButtons.Back],o=await new Promise((c,l)=>{a.onDidTriggerButton(u=>{u===Rl.QuickInputButtons.Back&&l(Ne.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>c(a.value),this,e.disposables),a.onDidHide(()=>l(Ne.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new Rl.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");n=a.sessionCookieName,i=a.sessionCookieValue}else n="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${n}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&n&&(i||e.isTokenEmpty)?(N("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${n}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(N("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getXSRFToken(e,t){let n,i,o=new URL("login?",bw(e)).toString();t!=""?(o=new URL("tree",bw(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(n=a.get("_xsrf")?.split(";")[0])}return n}async needPassword(e){return(await this.makeRequest(new URL("tree?",bw(e)).toString(),{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}})).status!==200}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=b.jupyterSelfCertEnable,s=b.jupyterSelfCertClose,a=await Rl.window.showErrorMessage(b.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Rl.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,n){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",n);let a=await this.makeRequest(new URL("login?",bw(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let c=this.getCookies(a);c.size>0&&(i=c.entries().next().value[0],o=c.entries().next().value[1])}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function bw(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var y1=require("vscode");var v1=class{constructor(e,t,n,i,o,s,a){this.multiStepFactory=e;this.asyncDisposableRegistry=t;this.configService=n;this.agentCreator=i;this.requestCreator=o;this.serverUriStorage=s;this.disposables=a;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}async getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");if(!await this.isJupyterHub(e.url))throw new Error("Not a Jupyter Hub Url");let t=BQ(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterHubConnectionInfo(t,e.validationErrorMessage).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(W(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&z(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",BQ(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let n=await t.json();return E(`JupyterHub version is ${n&&n.version} for url ${e}`),n&&n.version}catch{}return!1}catch(t){return E(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}async getJupyterHubConnectionInfo(e,t){try{let n=await this.getUserNameAndPassword(t);if(n.username||n.password){let i=await this.getJupyterHubConnectionInfoFromLogin(e,n.username,n.password);if(i){let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromLogin":"gotResponseFromLogin";N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}else{N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"emptyResponseFromLogin"}),i=await this.getJupyterHubConnectionInfoFromApi(e,n.username,n.password);let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromApi":"gotResponseFromApi";N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}return i}return N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!1,info:"passwordNotRequired"}),{requiresPassword:!1}}catch(n){throw N("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"failure"}),n}}async getJupyterHubConnectionInfoFromLogin(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=new URLSearchParams;s.append("username",t||""),s.append("password",n||"");let a=await this.makeRequest(`${o}/hub/login?next=`,{method:"POST",headers:{Connection:"keep-alive",Referer:`${o}/hub/login`,"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a&&a.status===302){let l=[...this.getCookies(a).entries()].reduce((u,p)=>`${u};${p[0]}=${p[1]}`,"");if(a=await this.makeRequest(`${o}/hub/api/users/${t}/tokens`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),a.ok&&a.status===200){let u=await a.json();if(u&&u.token&&u.id)return await this.makeRequest(`${o}/hub/api/users/${t}/server`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),this.asyncDisposableRegistry.push({dispose:async()=>{this.makeRequest(`${o}/hub/api/users/${t}/tokens/${u.id}`,{method:"DELETE",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}).catch(f)}}),{requestHeaders:{},remappedBaseUrl:`${o}/user/${t}`,remappedToken:u.token,requiresPassword:!0}}}}async getJupyterHubConnectionInfoFromApi(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=await this.makeRequest(`${o}/hub/api/authorizations/token`,{method:"POST",headers:{Connection:"keep-alive","content-type":"application/json;charset=UTF-8"},body:`{ "username": "${t||""}", "password": "${n||""}"  }`,redirect:"manual"});if(s.ok&&s.status===200){let a=await s.json();if(a&&a.user&&a.user.server&&a.token)return{requestHeaders:{},remappedBaseUrl:`${o}${a.user.server}`,remappedToken:a.token,requiresPassword:!0}}return{requiresPassword:!1}}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getUserNameAndPassword(e){let t=this.multiStepFactory.create(),n={username:"",password:"",validationMessage:e};return await t.run(this.getUserNameMultiStep.bind(this),n),n}async getUserNameMultiStep(e,t){if(t.username=await e.showInputBox({title:b.jupyterSelectUserAndPasswordTitle,prompt:b.jupyterSelectUserPrompt,validate:this.validateUserNameOrPassword,validationMessage:t.validationMessage,value:""}),t.username)return this.getPasswordMultiStep.bind(this)}async validateUserNameOrPassword(e){}async getPasswordMultiStep(e,t){t.password=await e.showInputBox({title:b.jupyterSelectUserAndPasswordTitle,prompt:b.jupyterSelectPasswordPrompt,validate:this.validateUserNameOrPassword,value:"",password:!0})}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=b.jupyterSelfCertEnable,s=b.jupyterSelfCertClose,a=await y1.window.showErrorMessage(b.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return N("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,y1.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&N("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function BQ(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var b1="user-jupyter-server-uri-list-version2";var oIe="DataScienceAllowInsecureConnections",FI=class extends ir{constructor(t,n,i,o,s,a,c,l,u,p,m,h,g,y=aA){super();this.jupyterConnection=n;this.context=m;this.fs=h;this.jupyterServerProviderRegistry=g;this.id=y;this.extensionId=$e;this.documentation=Et.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=b.UserJupyterServerUrlProviderDisplayName;this.detail=b.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new Et.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new Et.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new xw(i),this.secureConnectionValidator=new Sw(s),this.jupyterServerUriInput=new Iw(p),this.jupyterServerUriDisplayName=new jL,this.jupyterPasswordConnect=new g1(t,u,p,o,a),this.jupyterHubPasswordConnect=new v1(c,l,t,u,p,o,a)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection($e,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(Et.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(f),this.fs.delete(Et.Uri.joinPath(this.context.globalStorageUri,Dy)).catch(f)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(f)}async resolveJupyterServer(t,n){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:Et.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?Et.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,n){let i=new Et.CancellationTokenSource;this._register(new Et.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===Ne.cancel)throw new Et.CancellationError;if(s&&s instanceof Ne)return;let c=(await this.provideJupyterServers(i.token)).find(l=>l.id===s);if(!c)throw new Error(`Server ${s} not found`);return c}catch(o){if(o instanceof Et.CancellationError)throw o;x("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,n){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:b.connectToToTheJupyterServer(i),url:i}]:[{label:b.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=le();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(f),t.resolve()})().then(()=>t.resolve(),n=>t.reject(n)).catch(f),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){if(!Et.workspace.getConfiguration("jupyter").get("bypassJupyterHubExtensionCheck"))throw Et.extensions.getExtension(yh)?Et.window.showInformationMessage(b.useJupyterHubExtension,{modal:!0,detail:b.useJupyterHubExtensionDetail}).then(()=>{Et.commands.executeCommand("notebook.selectKernel",{notebookEditor:Et.window.activeNotebookEditor}).then(f,f)},f):Et.window.showInformationMessage(b.installJupyterHub,{modal:!0,detail:b.installJupyterHubDetail},ve.install,ve.moreInfo).then(t=>{t===ve.install?Et.commands.executeCommand("workbench.extensions.installExtension",yh,{context:{skipWalkthrough:!0}}).then(f,f):t===ve.moreInfo&&Et.env.openExternal(Et.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(f,f)},f),new Et.CancellationError}async captureRemoteJupyterUrl(t,n=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,c=!1,l,u="Get Url",p="Get Url",m=n,h=!1;if(n){let g=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(n);typeof g.validationError=="string"?(s=g.validationError,u="Get Url"):(h=!0,o=g.jupyterServerUri,u="Check Passwords")}try{let g=!1,y=!1;for(;;)try{if(l=(0,JQ.default)(),u==="Get Url"){h=!1,u="Check Passwords",p=void 0;let k=s;s="";let A=await this.jupyterServerUriInput.getUrlFromUser(m||n,k,i);o=A.jupyterServerUri,m=A.url}if(t.isCancellationRequested)return Ne.cancel;let C=[];if(u==="Check Passwords"){u="Check Insecure Connections",p=h&&n?void 0:"Get Url";try{let k=s;s="",g=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),g&&this.recommendInstallingJupyterHubExtension();let A=g?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:l,displayName:o.displayName,validationErrorMessage:k,disposables:C}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:l,validationErrorMessage:k,disposables:C});a=A.requiresPassword,o.authorizationHeader=A.requestHeaders,y=!1}catch(k){if(y=!1,k instanceof Et.CancellationError||k==Ne.back||k==Ne.cancel)throw k;if(!zo.isSelfCertsError(k)){if(!Ac.isSelfCertsExpiredError(k)){Zf(l,o.baseUrl,g,"ConnectionFailure");let A=/(https?:\/\/[^\s]+)/g,T=(k.message||k.toString()).replace(A,U=>`[${U}](${U})`);if(s=(cn()?b.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:b.remoteJupyterConnectionFailedWithoutServerWithError)(T),o.token.length>0&&(k.message||"").toLowerCase()==="Failed to fetch".toLowerCase())y=!0;else{u="Get Url";continue}}}}finally{C.forEach(k=>this._register(k))}}if(t.isCancellationRequested)return Ne.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",p=a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(c=!0,z(C),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return Zf(l,o.baseUrl,g,"InsecureHTTP"),Ne.cancel;if(t.isCancellationRequested)return Ne.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:l,extensionId:$e},o,!0)}catch(k){if(W("Uri verification error",k),y&&s){u="Get Url";continue}if(k instanceof Et.CancellationError||k==Ne.back||k==Ne.cancel)throw k;if(zo.isSelfCertsError(k)){s=b.jupyterSelfCertFailErrorMessageOnly,u="Get Url",Zf(l,o.baseUrl,g,"SelfCert");continue}else if(Ac.isSelfCertsExpiredError(k)){s=b.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",Zf(l,o.baseUrl,g,"ExpiredCert");continue}else if(a&&o.token.length===0){s=b.passwordFailure,u="Check Passwords",Zf(l,o.baseUrl,g,"AuthFailure");continue}else{Zf(l,o.baseUrl,g,"ConnectionFailure");let A=/(https?:\/\/[^\s]+)/g,T=(k.message||k.toString()).replace(A,U=>`[${U}](${U})`);s=(cn()?b.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:b.remoteJupyterConnectionFailedWithoutServerWithError)(T),u="Get Url";continue}}finally{z(C)}if(t.isCancellationRequested)return Ne.cancel;if(u==="Get Display Name"){z(C),p=c?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(l,o.displayName||new URL(o.baseUrl).hostname);break}}catch(C){if(C instanceof Et.CancellationError||C===Ne.cancel)return Ne.cancel;if(C===Ne.back){if(!p)return Ne.back;u=p;continue}throw C}return t.isCancellationRequested?Ne.cancel:(await this.addNewServer({handle:l,uri:m,serverInfo:o}),ZD({extensionId:this.extensionId,id:this.id,handle:l},o.displayName),Zf(l,o.baseUrl,g),l)}catch(g){if(g instanceof Et.CancellationError)return Ne.cancel;throw g}finally{z(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),c=Object.assign({},o);try{let l=a?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:t,displayName:o.displayName}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});c=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader}),a&&l.remappedBaseUrl&&(c.baseUrl=l.remappedBaseUrl),a&&l.remappedToken&&(c.token=l.remappedToken)}catch(l){x("Failed to validate Password info",l)}return c}};FI=v([(0,Jr.injectable)(),d(0,(0,Jr.inject)(ue)),d(1,(0,Jr.inject)(pn)),d(2,(0,Jr.inject)(Px)),d(3,(0,Jr.inject)(Zt)),d(4,(0,Jr.inject)(He)),d(4,(0,Jr.named)(bt)),d(5,(0,Jr.inject)(F)),d(6,(0,Jr.inject)(Qg)),d(7,(0,Jr.inject)(ai)),d(8,(0,Jr.inject)(Ip)),d(8,(0,Jr.optional)()),d(9,(0,Jr.inject)(Hl)),d(10,(0,Jr.inject)(ut)),d(11,(0,Jr.inject)(at)),d(12,(0,Jr.inject)(Qt)),d(13,(0,Jr.optional)()),d(13,(0,Jr.inject)(Date.now().toString()))],FI);var Iw=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",n){if(!e&&!rE)try{let s=await Et.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:Et.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=Et.window.createInputBox();n.push(i),i.title=b.jupyterSelectUriInputTitle,i.placeholder=b.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[Et.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=le();return i.onDidChangeValue(()=>i.validationMessage="",this,n),i.onDidHide(()=>o.reject(Ne.cancel),this,n),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(Ne.back)},this,n),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),n=WL(t,"");return n?(n.baseUrl=await sIe(t,this.requestCreator)||n.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:b.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:n,url:t,validationError:void 0}):{validationError:b.jupyterSelectURIInvalidURI}}};Iw=v([d(0,(0,Jr.inject)(Hl))],Iw);async function sIe(r,e){try{if(r=WL(r,"")?.baseUrl||r,new URL(r).pathname==="/")return r;let t=r.indexOf("token=")>0?r.substring(0,r.indexOf("token=")):r,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){E("Unable to identify the baseUrl of the Jupyter Server",t)}}function Zf(r,e,t,n){e=e.trim().toLowerCase();let i=Vt({handle:r,extensionId:$e,id:aA});Promise.all([It(e.toLowerCase()),It(i.toLowerCase())]).then(([o,s])=>{N("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!n,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:n})}).catch(o=>x(`Failed to hash remote url ${e}`,o))}var jL=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let n=[];try{let i=Et.window.createInputBox();n.push(i),i.ignoreFocusOut=!0,i.title=b.jupyterRenameServer,i.value=t,i.placeholder=b.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[Et.QuickInputButtons.Back],i.show();let o=le();return n.push(i.onDidHide(()=>o.reject(Ne.cancel))),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(Ne.back)},this,n),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,n),await o.promise}finally{z(n)}}},Sw=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get(oIe,!1))return!0;let e=[],t=le();try{let n=Et.window.createQuickPick();e.push(n),n.canSelectMany=!1,n.ignoreFocusOut=!0,n.title=b.insecureSessionMessage,n.buttons=[Et.QuickInputButtons.Back],n.items=[{label:ve.bannerLabelYes},{label:ve.bannerLabelNo}],n.show(),e.push(n.onDidHide(()=>t.reject(Ne.cancel))),n.onDidTriggerButton(i=>{i===Et.QuickInputButtons.Back&&t.reject(Ne.back)},this,e),n.onDidAccept(()=>t.resolve(n.selectedItems.some(i=>i.label===ve.bannerLabelYes)),this,e)}finally{z(e)}return t.promise}};Sw=v([d(0,(0,Jr.inject)(He)),d(0,(0,Jr.named)(bt))],Sw);function WL(r,e){if(!r.startsWith(Qe.REMOTE_URI))try{let t=new URL(r);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){x(`Failed to parse URI ${r}`,t);return}}function qQ(r){return r.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function aIe(r){let e=[];return r.forEach(t=>{let n=WL(t.uri,t.displayName);n&&e.push({handle:t.handle,uri:t.uri,serverInfo:n})}),e}var xw=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(ri.JupyterServerRemoteLaunchService,b1);if(!t||t==="[]")return[];try{return this.servers=aIe(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(ri.JupyterServerRemoteLaunchService,b1,JSON.stringify(qQ(t)))}).catch(f))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(n=>n.handle!==e);return this.servers=t,this.encryptedStorage.store(ri.JupyterServerRemoteLaunchService,b1,JSON.stringify(qQ(t)))}).catch(f))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(ri.JupyterServerRemoteLaunchService,b1,void 0)}).catch(f))}};xw=v([d(0,(0,Jr.inject)(Px))],xw);var Cw=D(O()),UI=require("vscode");var LI=class extends ir{constructor(t,n){super();this.uriProviderRegistration=t;this.serverUriStorage=n;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new UI.EventEmitter);this.extensionId=$e;this.id=Jw;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(n=>n.server)}async resolveJupyterServer(t,n){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection($e,this.id,this.displayName,this)),this._register(UI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){ee(`Setting Jupyter Server URI to remote: ${t}`);let n=t.toString(!0),i=new URL(n),o=UI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await wa(t.toString(!0),"SHA-1"),c={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:c}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:$e}),this._onDidChangeHandles.fire()}};LI=v([(0,Cw.injectable)(),d(0,(0,Cw.inject)(Qt)),d(1,(0,Cw.inject)(Zt))],LI);var I1=D(O());var ww=require("vscode");var jI=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){ww.workspace.isTrusted&&this.registerCommand(J.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let n=ww.commands.registerCommand(e,t,this);this.disposables.push(n)}async continueEditSessionInCodespace(){await ww.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};jI=v([(0,I1.injectable)(),d(0,(0,I1.inject)(F))],jI);var $Q=D(O());var HQ=require("vscode");var WI=class{activate(){this.eagerlyActivateOtherExtensions().catch(f)}async eagerlyActivateOtherExtensions(){await Promise.all(HQ.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(f,f)))}};WI=v([(0,$Q.injectable)()],WI);var S1=D(O()),GQ=require("vscode");var VI=class{constructor(e){this.uriStorage=e}activate(){GQ.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(n=>{n.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(n.provider)}),e})}};VI=v([(0,S1.injectable)(),d(0,(0,S1.inject)(Zt))],VI);var Uu=require("vscode");var zQ=D(O());var BI=class{activate(){let e=Pe.instance.get(F),t=new ci;e.push(t),e.push(Uu.commands.registerCommand("jupyter.manageAccessToKernels",()=>cIe(t)))}};BI=v([(0,zQ.injectable)()],BI);async function cIe(r){let e=await N9(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=Uu.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let n=[];r.add({dispose:()=>{n=z(n)}});let i=Uu.window.createQuickPick();i.title=Uu.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=Uu.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;n.push(i),i.show(),await Promise.race([HN(i.onDidAccept,void 0,n).then(()=>o=!0),HN(i.onDidHide,void 0,n)]),o&&(await M9(i.selectedItems.map(s=>s.extensionId)),n=z(n))}function QQ(r,e,t){e.addSingleton(be,_I),e.addSingleton(be,Yf),e.addSingleton(be,PI),e.addSingleton(be,DI),e.addSingleton(vQ,Gf),e.addSingleton(be,Gf),e.addSingleton(be,WI),e.addSingleton(be,LI),e.add(Sg,CI),e.add(MP,wI),e.addSingleton(be,EI),e.addSingleton(be,jI),e.addSingleton(AL,_l),e.addBinding(AL,be),e.add(BP,RI),e.addSingleton(VP,TI),e.addSingleton(Lu,Lu),e.addSingleton(be,OI),WQ(e),wQ(r,t),e.addSingleton(be,FI),e.addSingleton(be,VI),e.addSingleton(be,BI)}var Al=D(O()),ma=require("vscode");var x1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var YQ=1e3,lIe;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(lIe||={});var da;(p=>(p.Started="started",p.UpdateSettings="update_settings",p.InitializeData="init",p.GetAllRowsRequest="get_all_rows_request",p.GetAllRowsResponse="get_all_rows_response",p.GetRowsRequest="get_rows_request",p.GetRowsResponse="get_rows_response",p.CompletedData="complete",p.GetSliceRequest="get_slice_request",p.RefreshDataViewer="refresh_data_viewer",p.SliceEnablementStateChanged="slice_enablement_state_changed"))(da||={});var qI=Symbol("IDataViewerFactory"),C1=Symbol("IDataViewer"),w1=Symbol("IJupyterVariableDataProvider"),E1=Symbol("IJupyterVariableDataProviderFactory"),JI=Symbol("IDataViewerDependencyService");var BL;function qL(r,e){return BL&&BL.hasOwnProperty(r)?BL[r]:e}function JL(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}var uIe=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function $L(r){let e=r.length-2;return"["+r.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function pIe(r,e){if(r.startsWith("[")&&r.endsWith("]")){let t,n=r.substring(1,r.length-1).split(",").map((i,o)=>{let s=uIe.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),c=e[o];return(a>=0&&a>=c||a<0&&a<-c)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=qL("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return JL(s,o.toString(),i.toString(),e[i].toString())}else if(n&&n.length!==e.length){let i=qL("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return JL(i,e.length.toString(),n.length.toString())}}return""}function XQ(r,e){return pIe(r,e)===""}var Wu=require("vscode");var ju=class{constructor(e,t,n){this.configService=e;this.rootPath=t;this.scripts=n;this.disposed=!1;this.themeIsDarkPromise=le();this.webviewInit=le();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new Wu.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(f)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let n=JSON.stringify(t);this.postMessageInternal("update_settings",n).catch(f)}}};this._disposables.push(Wu.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=le(),this.postMessageInternal("get_html_by_id_request",e).catch(f);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(n=>{n(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||le(),this.webview===void 0){let n=await this.generateDataScienceExtraSettings(),i=Wu.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,n,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(f),this.sendLocStrings().catch(f)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=Wu.workspace.getConfiguration("editor"),n=Wu.workspace.getConfiguration("workbench"),i=n?n.get("colorTheme",cA):cA,o=Wu.extensions.getExtension(ii);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:Ur()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:qt.collapseSingle,expandSingle:qt.expandSingle,openExportFileYes:b.openExportFileYes,openExportFileNo:b.openExportFileNo,noRowsInDataViewer:qt.noRowsInDataViewer,sliceIndexError:qt.sliceIndexError,sliceMismatchedAxesError:qt.sliceMismatchedAxesError,filterRowsTooltip:qt.sliceMismatchedAxesError,fetchingDataViewer:qt.fetchingDataViewer,dataViewerHideFilters:qt.dataViewerHideFilters,dataViewerShowFilters:qt.dataViewerShowFilters,refreshDataViewer:qt.refreshDataViewer,clearFilters:qt.refreshDataViewer,sliceSummaryTitle:qt.sliceSummaryTitle,sliceData:qt.sliceData,sliceSubmitButton:qt.sliceSubmitButton,sliceDropdownAxisLabel:qt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:qt.sliceDropdownIndexLabel,variableExplorerNameColumn:qt.variableExplorerNameColumn,variableExplorerTypeColumn:qt.variableExplorerTypeColumn,variableExplorerCountColumn:qt.variableExplorerCountColumn,variableExplorerValueColumn:qt.variableExplorerValueColumn,collapseVariableExplorerLabel:qt.collapseVariableExplorerLabel,variableLoadingValue:qt.variableLoadingValue,showDataExplorerTooltip:qt.showDataExplorerTooltip,noRowsInVariableExplorer:qt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:qt.loadingRowsInVariableExplorer,previousPlot:qt.previousPlot,nextPlot:qt.nextPlot,panPlot:qt.panPlot,zoomInPlot:qt.zoomInPlot,zoomOutPlot:qt.zoomOutPlot,exportPlot:qt.exportPlot,deletePlot:qt.deletePlot,selectedImageListLabel:qt.selectedImageListLabel,selectedImageLabel:qt.selectedImageLabel};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(f)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(f),this.onDataScienceSettingsChanged().catch(f)}getValue(e,t,n){return e?e.get(t,n):n}};v([wh()],ju.prototype,"getHTMLById",1),v([wh()],ju.prototype,"addMessageListener",1),v([wh()],ju.prototype,"removeMessageListener",1);var $I=class extends ju{constructor(t,n,i,o,s,a,c){super(t,o,s);this.configService=t;this.provider=n;this._title=a;this.viewColumn=c;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let n=t.isVisible(),i=t.isActive(),o={visible:n,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=n,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,n,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:n,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var ZQ="JupyterDataViewerPreferredViewColumn",eh=class extends $I{constructor(t,n,i,o,s){let a=lr(s.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new x1(c,l,u),a,[lr(a,"dataExplorer.js")],b.dataExplorerTitle,i.get(ZQ)??ma.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new ma.EventEmitter;this._onDidChangeDataViewerViewState=new ma.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,n){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(ma.Uri.file(process.cwd())).catch(x),super.setTitle(n),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=$L(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(da.InitializeData,i).catch(f)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let n=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&n.shape!==void 0)if(XQ(t,n.shape))n=await this.getDataFrameInfo(t);else{let i=$L(n.shape);n=await this.getDataFrameInfo(i)}ee(`Refreshing data viewer for variable ${n.name}`),this.postMessage(da.InitializeData,n).catch(f)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(ZQ,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,n){switch(t){case da.GetAllRowsRequest:this.getAllRows(n).catch(f);break;case da.GetRowsRequest:this.getRowChunk(n).catch(f);break;case da.GetSliceRequest:this.getSlice(n).catch(f);break;case da.RefreshDataViewer:this.refreshData().catch(f),N("DATASCIENCE.REFRESH_DATA_VIEWER");break;case da.SliceEnablementStateChanged:N("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:n.newState?"checked":"unchecked"});break;default:break}super.onMessage(t,n)}getDataFrameInfo(t,n){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,n):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new Je;let t=await this.getDataFrameInfo();try{N("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(da.GetAllRowsResponse,n)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.slice);return n.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(n.shape.length),N("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(da.InitializeData,n)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,n.rowCount?n.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(da.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(n){if(n instanceof ob){x(n.message);let i=b.pythonInteractiveHelpLink;ma.window.showErrorMessage(b.jupyterDataRateExceeded,i).then(o=>{o===i&&ma.env.openExternal(ma.Uri.parse(AS.JupyterDataRateHelpLink))},f),this.dispose()}x(n),this.errorHandler.handleError(n).then(f,f)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&N("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(N("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};v([fr("DATAVIEWER.WEBVIEW_LOADED")],eh.prototype,"showData",1),eh=v([(0,Al.injectable)(),d(0,(0,Al.inject)(kp)),d(1,(0,Al.inject)(ue)),d(2,(0,Al.inject)(He)),d(2,(0,Al.named)(bt)),d(3,(0,Al.inject)(en)),d(4,(0,Al.inject)(ut))],eh);var Kr=D(O()),jo=require("vscode");var k1=require("vscode");var P1=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>YQ&&await this.shouldAskForLargeData(t)){let n=b.tooManyColumnsMessage,i=b.tooManyColumnsYes,o=b.tooManyColumnsNo,s=b.tooManyColumnsDontAskAgain,a=await k1.window.showWarningMessage(n,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,k1.ConfigurationTarget.Global).catch(f))}};var eY="ds_prompt_about_deprecation",HI=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h,g){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=c;this.interpreterService=l;this.platformService=u;this.kernelProvider=p;this.interactiveWindowProvider=m;this.experimentService=h;this.globalMemento=g;this.dataViewerChecker=new P1(n),jo.workspace.isTrusted||jo.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){jo.workspace.isTrusted&&this.registerCommand(J.ShowDataViewer,this.onVariablePanelShowDataViewerRequest)}registerCommand(e,t){let n=jo.commands.registerCommand(e,t,this);this.disposables.push(n)}async onVariablePanelShowDataViewerRequest(e){let t="variable"in e?e.variable:e;N("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX");let n=this.experimentService.inExperiment("DataViewerDeprecation");if(!this.globalMemento.get(eY)&&n&&(this.globalMemento.update(eY,!0).then(f,f),jo.window.showInformationMessage(b.dataViewerDeprecationMessage,b.dataViewerDeprecationRecommendationActionMessage).then(i=>{i===b.dataViewerDeprecationRecommendationActionMessage&&jo.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(f,f)},f)),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let l=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);l&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(l)}let i=f0(t),o=await this.variableProvider.getFullVariable(i),s=await this.jupyterVariableDataProviderFactory.create(o),c=(await s.getDataFrameInfo())?.columns?.length;if(c&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(c)){let l=`${b.dataExplorerTitle} - ${o.name}`,u=await this.dataViewerFactory.create(s,l);return N("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),u}}catch(i){N("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,i),x(i),this.errorHandler.handleError(i).then(f,f)}else try{let i=this.getActiveKernel();if(i&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let o=await this.jupyterVariableDataProviderFactory.create(t,i),s=`${b.dataExplorerTitle} - ${t.name}`;return await this.dataViewerFactory.create(o,s)}}catch(i){x(i),N("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),jo.window.showErrorMessage(b.showDataViewerFail).then(f,f)}}getActiveKernel(){let e=jo.window.activeNotebookEditor?.notebook,t=e?.notebookType==xt?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return jo.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){ee("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(ee("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(ee("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let n=t;return n.startsWith("~")&&this.platformService.homeDir&&(n=Dh(n,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(jo.Uri.file(n))}else return this.interpreterService.getActiveInterpreter()}};HI=v([(0,Kr.injectable)(),d(0,(0,Kr.inject)(F)),d(1,(0,Kr.inject)(Oi)),d(1,(0,Kr.optional)()),d(2,(0,Kr.inject)(ue)),d(3,(0,Kr.inject)(E1)),d(3,(0,Kr.optional)()),d(4,(0,Kr.inject)(qI)),d(4,(0,Kr.optional)()),d(5,(0,Kr.inject)(Mn)),d(5,(0,Kr.optional)()),d(5,(0,Kr.named)(Qe.DEBUGGER_VARIABLES)),d(6,(0,Kr.inject)(en)),d(7,(0,Kr.inject)(JI)),d(7,(0,Kr.optional)()),d(8,(0,Kr.inject)(st)),d(8,(0,Kr.optional)()),d(9,(0,Kr.inject)(Dr)),d(10,(0,Kr.inject)(Ke)),d(11,(0,Kr.inject)(Wi)),d(12,(0,Kr.inject)(Ds)),d(13,(0,Kr.inject)(He)),d(13,(0,Kr.named)(bt))],HI);var zI=D(O());var D1="0.20.0";var _1=require("vscode");var th=class{async getVersion(e,t){try{let n=await this._getVersion(e,t);return typeof n=="string"?bP(n):n}catch(n){W(b.failedToGetVersionOfPandas,n.message);return}}async promptInstall(e,t,n){let i=n?b.pandasTooOldForViewingFormat(n,D1):b.pandasRequiredForViewing(D1);if((sm()?ve.install:await _1.window.showErrorMessage(i,{modal:!0},ve.install))===ve.install)await this._doInstall(e,t);else throw N("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new _1.CancellationTokenSource;try{let n=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){N("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(n){if(n.compare(D1)>0){N("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}N("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${n.major}.${n.minor}.${n.build}`;await this.promptInstall(e,t,i)}N("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};v([fr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:gr.get(23)})],th.prototype,"promptInstall",1);var HL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",dIe=`import pandas;print(pandas.__version__);print("${HL}")`,T1=class extends th{constructor(t,n,i){super();this.installer=t;this.pythonFactory=n;this.interpreterService=i}async _getVersion(t,n){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",dIe],{token:n})).stdout;if(!s?.includes(HL))return W(b.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=Fe(s.trim()),c=a.indexOf(HL);return c>=0?a[c-1]:""}async _doInstall(t,n){let i=t||await this.interpreterService.getActiveInterpreter();if(n.token.isCancellationRequested)return;await or(n.token,2,this.installer.install(23,i,n))===0&&N("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){N("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var GL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",mIe=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${GL}"); del _VSCODE_pandas`;function fIe(r){return(r.kernelConnectionMetadata.interpreter&&Be(r.kernelConnectionMetadata.interpreter))==="Conda"?"%conda":"%pip"}var R1=class extends th{async execute(e,t){if(!t.session?.kernel)throw new yn;let n=await bn(t.session.kernel,e),i=n.find(o=>o.output_type==="error");return i&&W(b.failedToGetVersionOfPandas,i.message),n.map(o=>o.text?.toString())}async _getVersion(e){let n=(await this.execute(mIe,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!n?.includes(GL))return W(b.failedToGetVersionOfPandas,`Output is ${n}`),"";let i=Fe(n.trim()),o=i.indexOf(GL);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${fIe(e)} install pandas`;try{await this.execute(t,e),N("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(n){throw N("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,n),new Error(b.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(N("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw N("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};var GI=class{constructor(e,t,n){this.withKernel=new R1,this.withInterpreter=new T1(e,t,n)}async checkAndInstallMissingDependencies(e){return"controller"in e?this.withKernel.checkAndInstallMissingDependencies(e):this.withInterpreter.checkAndInstallMissingDependencies(e)}};GI=v([(0,zI.injectable)(),d(0,(0,zI.inject)(Ui)),d(1,(0,zI.inject)(Vr)),d(2,(0,zI.inject)(st))],GI);var QI=D(O());var tY=require("vscode");var Yd=class{constructor(e,t,n){this.serviceContainer=e;this.disposables=n;this.knownViewers=new Set;t.push(this),this.viewContext=new sr(Sr.IsDataViewerActive),this.disposables.push(tY.commands.registerCommand(J.RefreshDataViewer,this.refreshDataViewer,this))}async dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let n,i=this.serviceContainer.get(C1);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),n=i}finally{n||i.dispose()}return n}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(f,f)}};v([fr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Yd.prototype,"create",1),v([Lv(1e3)],Yd.prototype,"refreshDataViewer",1),Yd=v([(0,QI.injectable)(),d(0,(0,QI.inject)(pt)),d(1,(0,QI.inject)(ai)),d(2,(0,QI.inject)(F))],Yd);var Bu=D(O());var Vu=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let n;switch(t.type){case"bool":n="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":n="number";break;default:n="string"}return{key:t.key,type:n}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{x(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let n={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),n={columns:i.columns?Vu.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Vu.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Te(i.fileName)}),t&&(this.variable=i),n}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,n){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,n)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(Qu()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Vu=v([(0,Bu.injectable)(),d(0,(0,Bu.inject)(Mn)),d(0,(0,Bu.named)(Qe.ALL_VARIABLES)),d(1,(0,Bu.inject)(JI)),d(1,(0,Bu.optional)())],Vu);var A1=D(O());var YI=class{constructor(e){this.serviceContainer=e}async create(e,t){let n=this.serviceContainer.get(w1);return n.setDependencies(e,t),n}};YI=v([(0,A1.injectable)(),d(0,(0,A1.inject)(pt))],YI);var Ew=D(O()),N1=require("vscode");var XI=class{constructor(e,t){this.kernelProvider=e;this.controllers=t;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){z(this.disposables)}activate(){let e=N1.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,n=e.session?.kernel?.iopubMessage;if(!n)return;let i=require("@jupyterlab/services"),o=(s,a)=>{s===t&&(i.KernelMessage.isDisplayDataMsg(a)||i.KernelMessage.isUpdateDisplayDataMsg(a)||i.KernelMessage.isExecuteReplyMsg(a)||i.KernelMessage.isExecuteResultMsg(a))&&this.trackModelId(e.notebook,a)};n.connect(o),this.disposables.push(new N1.Disposable(()=>n.disconnect(o)))}trackModelId(e,t){let n=t.content;if(n.data&&typeof n.data=="object"&&qi in n.data){let i=n.data[qi];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:n}){n&&typeof n=="object"&&n.command==="query-widget-state"&&this.queryWidgetState(e,t,n),n&&typeof n=="object"&&n.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,n){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(n.model_id);e.postMessage({command:"query-widget-state",model_id:n.model_id,hasWidgetState:s,kernelSelected:o},t).then(f,f)}sendWidgetVersionAndState(e,t){let n=this.kernelProvider.get(t.notebook),i=n?.ipywidgetsVersion;n?.ipywidgetsVersion&&E(`IPyWidget version in Kernel is ${n?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(f,f)}};XI=v([(0,Ew.injectable)(),d(0,(0,Ew.inject)(Ke)),d(1,(0,Ew.inject)(Ct))],XI);var nh=D(O());var zL=require("vscode");var rh=D(O());var Nl=require("vscode");var M1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var fa;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(fa||={});var rY=class{static{fa.Started,fa.UpdateSettings,fa.SendPlot,fa.CopyPlot,fa.ExportPlot,fa.RemovePlot}},O1=Symbol("IPlotViewerProvider"),K1=Symbol("IPlotViewer");var ZI=class extends $I{constructor(t,n,i,o){let s=new Je,a=lr(o.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new M1(c,l,u),a,[lr(a,"plotViewer.js")],b.plotViewerTitle,Nl.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new Nl.EventEmitter;this.removedEvent=new Nl.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(fa.SendPlot,t).catch(f))};super.loadWebview(Nl.Uri.file(process.cwd())).catch(x).finally(()=>{N("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,n){switch(t){case fa.CopyPlot:this.copyPlot(n.toString()).catch(f);break;case fa.ExportPlot:this.exportPlot(n).catch(f);break;case fa.RemovePlot:this.removePlot(n);break;default:break}super.onMessage(t,n)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){ee("exporting plot...");let n={};n[b.pngFilter]=["png"],n[b.svgFilter]=["svg"];let i=await Nl.window.showSaveDialog({saveLabel:b.exportPlotTitle,filters:n});try{if(i)switch(Ji(i.path).toLowerCase()){case".png":let s=mg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){x(o),Nl.window.showErrorMessage(b.exportImageFailed(o.toString())).then(f,f)}}};ZI=v([(0,rh.injectable)(),d(0,(0,rh.inject)(kp)),d(1,(0,rh.inject)(ue)),d(2,(0,rh.inject)(at)),d(3,(0,rh.inject)(ut))],ZI);var eS=class extends ZI{constructor(t,n,i,o){super(t,n,i,o);this.fsNode=i}async exportPlot(t){ee("exporting plot...");let n={};n[b.pdfFilter]=["pdf"],n[b.pngFilter]=["png"],n[b.svgFilter]=["svg"];let i=await zL.window.showSaveDialog({saveLabel:b.exportPlotTitle,filters:n});try{if(i)switch(Ji(i.fsPath).toLowerCase()){case".pdf":await QL(t.svg,this.fsNode,i);break;case".png":let s=mg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){x(o),zL.window.showErrorMessage(b.exportImageFailed(o)).then(f,f)}}};eS=v([(0,nh.injectable)(),d(0,(0,nh.inject)(kp)),d(1,(0,nh.inject)(ue)),d(2,(0,nh.inject)(vr)),d(3,(0,nh.inject)(ut))],eS);async function QL(r,e,t){ee("Attempting pdf write...");let n=(await import("svg-to-pdfkit")).default,i=le(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);ee(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),n(s,r,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),ee(`Finishing pdf to ${t.fsPath}`),await i.promise,ee(`Completed pdf to ${t.fsPath}`)}var Pw=D(O());var tS=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}async dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,n=await this.getOrCreate();await Promise.all(t.map(n.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(K1),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),N("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};tS=v([(0,Pw.injectable)(),d(0,(0,Pw.inject)(pt)),d(1,(0,Pw.inject)(ai))],tS);var j1=D(O());var L1=D(O()),Xd=require("vscode");var U1="image/svg+xml",F1={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[U1]:"svg"},rS=class{constructor(e){this.fs=e}async savePlot(e,t,n){if(e.isClosed)return;let i=hIe(e,t,n);if(!i)return x(`No plot to save ${$(e.uri)}, id: ${t} for ${n}`);if(!(n.toLowerCase()in F1))return x(`Unsupported MimeType ${$(e.uri)}, id: ${t} for ${n}`);let o=await this.getSaveTarget(i,n);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let n=F1[t.toLowerCase()],i={};e.items.find(c=>c.mime.toLowerCase()===U1)&&(i[b.pdfFilter]=["pdf"],i[b.svgFilter]=["svg"]),n==="png"&&(i[b.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[n]);let o=(Xd.workspace.workspaceFolders?.length||0)>0?Xd.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?Xd.Uri.joinPath(o,s):Xd.Uri.file(s);return Xd.window.showSaveDialog({defaultUri:a,saveLabel:b.exportPlotTitle,filters:i})}async saveAsImage(e,t){let n=Ji(t.path).substring(1),i=Object.keys(F1).find(s=>F1[s]===n),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,o.data)}async saveAsPdf(e,t){return x("Save as PDF is not yet supported on the web.")}};rS=v([(0,L1.injectable)(),d(0,(0,L1.inject)(at))],rS);function hIe(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var nS=class extends rS{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,n){let i=Buffer.from(t.items.find(o=>o.mime===U1).data).toString();await QL(i,this.fsNode,n)}};nS=v([(0,j1.injectable)(),d(0,(0,j1.inject)(vr))],nS);var W1=D(O());var gIe="image/svg+xml",vIe="image/png",qu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let n=nY(e,t,gIe),i;if(n)i=new TextDecoder().decode(n.data);else{let o=nY(e,t,vIe);if(!o)return x(`No SVG or PNG Plot to open ${$(e.uri)}, id: ${t}`);i=yIe(o)}i&&await this.plotViewProvider.showPlot(i)}};qu=v([(0,W1.injectable)(),d(0,(0,W1.inject)(O1))],qu);function nY(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function yIe(r){let e=r.data,t=IP(e),n=bIe(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${n.height}" width="${n.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function bIe(r){if(!IIe(r))throw new Error("The buffer is not a valid png");let e=new DataView(new Uint8Array(r).buffer);return{width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}function IIe(r){return r[0]===137&&r[1]===80&&r[2]===78&&r[3]===71&&r[4]===13&&r[5]===10&&r[6]===26&&r[7]===10&&r.length>8+21}var kw=D(O()),B1=require("vscode");var V1=Symbol("IPlotSaveHandler");var iS=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){z(this.disposables)}activate(){this.activateImpl().catch(f)}async activateImpl(){let e=B1.extensions.getExtension(Ih);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(({editor:n,message:i})=>{let o=n.notebook||B1.window.activeNotebookEditor?.notebook;o&&(i.type==="saveImageAs"?this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType).catch(f):i.type==="openImageInPlotViewer"&&this.plotViewHandler.openPlot(o,i.outputId).catch(f))},this,this.disposables)}};iS=v([(0,kw.injectable)(),d(0,(0,kw.inject)(V1)),d(1,(0,kw.inject)(qu))],iS);var ih=D(O()),Wo=require("vscode");var oS=class{constructor(e,t,n,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=n;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new Wo.EventEmitter;this._onDidChangeActiveNotebook=new Wo.EventEmitter;this._onDidRestartActiveNotebook=new Wo.EventEmitter;this._executionCountTracker=new WeakMap;Wo.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),Wo.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),Wo.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=Wo.window.activeNotebookEditor?.notebook,t=e?.notebookType==xt?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Wo.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){Rt(e.cell.notebook)&&e.state===Wo.NotebookCellExecutionState.Idle&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&Rt(e.notebook)){let n=this._executionCountTracker.get(e.notebook);n&&(t.executionCount=n)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};oS=v([(0,ih.injectable)(),d(0,(0,ih.inject)(Wi)),d(1,(0,ih.inject)(Ke)),d(2,(0,ih.inject)(qI)),d(3,(0,ih.inject)(F))],oS);var iY=class{static{"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel"}},q1=Symbol("INotebookWatcher"),J1=Symbol("IVariableViewProvider");var Dw=D(O()),oY=require("vscode");var sS=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(oY.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};sS=v([(0,Dw.injectable)(),d(0,(0,Dw.inject)(ut)),d(1,(0,Dw.inject)(J1))],sS);var ga=D(O());var ha=require("vscode");var $1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var H1=class extends ju{constructor(t,n,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=n(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,n,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:n,webviewHost:o})}};var sY=require("vscode");var oh=class extends H1{constructor(t,n,i,o,s,a,c){let l=lr(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,p)=>new $1(u,p),n,l,[lr(l,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.experiments=c;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),ha.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(ha.Uri.file(process.cwd()),t).catch(x),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,n){switch(t){case"get_variables_request":this.handleMessage(t,n,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,n,this.showDataViewer);break;default:break}super.onMessage(t,n)}handleMessage(t,n,i){let o=n;i.bind(this)(o)}handleVisibilityChanged(){let t=new sr("jupyter.variableViewVisible"),n=!1;this.webviewView&&(n=this.webviewView.visible),t.set(n).catch(f),n&&(N("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(f):this.postMessage("force_variable_refresh").catch(f))}async showDataViewer(t){t.variable.fileName=t.variable.fileName??this.notebookWatcher.activeKernel?.notebook.uri;try{if(this.experiments.inExperiment("DataViewerContribution")){let n=this.getMatchingVariableViewers(t.variable);if(n.length===0){await ha.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers");return}else if(n.length===1){let i=n[0].jupyterVariableViewers.command;return ha.commands.executeCommand(i,t.variable)}else{let i=n.filter(s=>s.extension.id!==$e);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return ha.commands.executeCommand(s,t.variable)}let o=ha.window.createQuickPick();o.title="Select DataFrame Viewer",o.items=n.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(()=>{let s=o.selectedItems[0];s&&(o.hide(),ha.commands.executeCommand(s.command,t.variable).then(f,f))}),o.show()}}else return ha.commands.executeCommand(J.ShowDataViewer,t.variable)}catch(n){x(n),N("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),ha.window.showErrorMessage(b.showDataViewerFail).then(f,f)}}getMatchingVariableViewers(t){return this.getVariableViewers().filter(i=>i.jupyterVariableViewers.dataTypes.includes(t.type))}getVariableViewers(){return sY.extensions.all.filter(n=>n.packageJSON?.contributes?.jupyterVariableViewers&&n.packageJSON?.contributes?.jupyterVariableViewers.length).map(n=>{let i=n.packageJSON?.contributes;return i?.jupyterVariableViewers?i.jupyterVariableViewers.map(o=>({extension:n,jupyterVariableViewers:o})):[]}).flat()}postProcessSupportsDataExplorer(t){let n=this.getVariableViewers();return t.pageResponse.forEach(i=>{this.experiments.inExperiment("DataViewerContribution")&&(i.supportsDataExplorer=n.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type)))}),t}async requestVariables(t){let n=this.notebookWatcher.activeKernel;if(n){let i=await this.variables.getVariables(t,n);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(f),N("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(f)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(f),this.postMessage("force_variable_refresh").catch(f)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(f)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(f)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(f)}};v([fr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],oh.prototype,"load",1),v([Lr()],oh.prototype,"showDataViewer",1),v([Lr()],oh.prototype,"requestVariables",1);var aS=class{constructor(e,t,n,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=n;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.experiments=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!Ar())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=le(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,n){e.webview.options={enableScripts:!0},this.variableView=new oh(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.experiments),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};aS=v([(0,ga.injectable)(),d(0,(0,ga.inject)(ue)),d(1,(0,ga.inject)(YP)),d(2,(0,ga.inject)(ut)),d(3,(0,ga.inject)(Mn)),d(3,(0,ga.named)(Qe.ALL_VARIABLES)),d(4,(0,ga.inject)(F)),d(5,(0,ga.inject)(q1)),d(6,(0,ga.inject)(Ds))],aS);function aY(r){r.addSingleton(be,iS),r.add(C1,eh),r.addSingleton(qI,Yd),r.addSingleton(JI,GI),r.addSingleton(be,HI),r.add(K1,eS),r.addSingleton(O1,tS),r.addSingleton(V1,nS),r.addSingleton(qu,qu),r.addSingleton(q1,oS),r.addSingleton(be,sS),r.addSingleton(be,XI),r.addSingleton(J1,aS),r.add(w1,Vu),r.addSingleton(E1,YI)}var lY=require("vscode");function uY(r){let e=lY.window.createOutputChannel(b.jupyterServerConsoleOutputChannel,"log");r.push(e);let t={get(n,i){let o=n[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),cY(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),cY(...s)}}return o}};return new Proxy(e,t)}function cY(...r){r.length===1?E(Fe(r[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):E(...r)}var SY=D(XA());var pY=D(O());var sh=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,n,i){n?this.container.bind(e).to(t).whenTargetNamed(n):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,n,i){n?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,n){n?this.container.bind(e).toConstantValue(t).whenTargetNamed(n):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,n){n?this.container.rebind(e).to(t).whenTargetNamed(n):this.container.rebind(e).to(t)}rebindSingleton(e,t,n){n?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,n){n?this.container.rebind(e).toConstantValue(t).whenTargetNamed(n):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};v([wh()],sh.prototype,"getContainer",1),sh=v([(0,pY.injectable)()],sh);var mY=YL(),G1=class{constructor(e,t,n){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=n}format(e,t,...n){let i=e?`${Qw()} [${e}] ${mY(t,...n)}`:mY(t,...n);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}traceLog(e,...t){this.channel.appendLine(this.format("",e,...t))}traceError(e,...t){this.channel.appendLine(this.format("error",e,...t))}traceWarn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}traceInfo(e,...t){this.channel.appendLine(this.format("info",e,...t))}traceVerbose(e,...t){this.channel.appendLine(this.format("debug",e,...t))}};var XL=YL();function z1(r,e,...t){let i=[...t].length===0?XL(e):XL(e,...t);return r?`${r} ${Qw()}: ${i}`:i}var Q1=class{constructor(e){this.prefix=e}traceLog(e,...t){console.log(XL(`${this.prefix||""} ${e}`,...t))}traceError(e,...t){console.error(z1("error",`${this.prefix||""} ${e}`,...t))}traceWarn(e,...t){console.warn(z1("warn",`${this.prefix||""} ${e}`,...t))}traceInfo(e,...t){console.info(z1("info",`${this.prefix||""} ${e}`,...t))}traceVerbose(e,...t){console.log(z1("verbose",`${this.prefix||""} ${e}`,...t))}};var Zd=require("os");var Vo=D(require("vscode"));var gY=D(require("vscode"));var ah=D(require("vscode")),ZL;(t=>{function r(n){return n.start.line===n.end.line&&n.start.character===n.end.character}t.isEmpty=r;function e(n,i){let o=n.start.line,s=n.start.character,a=n.end.line,c=n.end.character,l=i.start.line,u=i.start.character,p=i.end.line,m=i.end.character;return o<l?(o=l,s=u):o===l&&(s=Math.max(s,u)),a>p?(a=p,c=m):a===p&&(c=Math.min(c,m)),!(o>a||o===a&&s>c)}t.intersects=e})(ZL||={});function eU(r){r.sort((t,n)=>t-n);let e=r.shift();return e===void 0?[]:r.reduce(function(t,n){return n<=t[0][1]?t[0][1]=n+1:t.unshift([n,n+1]),t},[[e,e+1]]).reverse().map(t=>new ah.NotebookRange(t[0],t[1]))}function fY(r){return r.reduce((t,n)=>{for(let i=n.start;i<n.end;i++)t.push(i);return t},[])}function SIe(r){return ah.workspace.notebookDocuments.find(e=>e.uri.authority===r.uri.authority&&e.uri.path===r.uri.path)}function _w(r){let e=ah.workspace.textDocuments.find(o=>o.uri.toString()===r?.document.uri.toString())??ah.window.activeTextEditor?.document;if(!e)return;let t=SIe(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function tU(r,e){return r.start.line===e.start.line&&r.start.character===e.start.character&&r.end.line===e.end.line&&r.end.character===e.end.character}function Ii(){}var hY="ms-python.vscode-pylance";async function xIe(r){return await r.activate()}var rU;async function vY(){let r=gY.extensions.getExtension(hY);if(r)return rU||new Promise((e,t)=>{xIe(r).then(async n=>{if(!n){console.error("Could not start Pylance"),t();return}n.client&&await n.client.start(),rU=n.notebook,e(n.notebook)}).then(Ii,Ii)})}var ar=D(require("vscode"));var CIe=ar.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),wIe=ar.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),Y1=class{constructor(e,t,n){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=n}_getVirtualCellList(e){return this._cellExecution.findIndex(n=>n.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(n=>n.cell)}getPredecessorCells(e,t=!1){let n=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=n.length-1;i>=0&&n[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=n.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let c=new Map;for(let[p,m]of this._cellRefs.entries()){let h=m.filter(g=>g.kind==="write").map(g=>g.uri.fragment);m.forEach(g=>{let y=g.uri.fragment;c.has(y)?c.get(y)?.push(p):c.set(y,[p])}),m.forEach(g=>{let y=g.uri.fragment;c.has(y)?c.get(y)?.push(...h):c.set(y,h)})}let l=e.document.uri.fragment;this._resolveDependencies(c,a,l,s,t);let u=[];for(let p=0;p<a.length;p++)a[p]&&u.push(s[p]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),n=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(n===-1)return[];let i=new Array(t.length).fill(!1);i[n]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(c=>{if(c.kind==="write"){let l=c.uri.fragment,u=o.get(l)??[];u.push(...a.filter(p=>p!==c)),o.set(l,u)}})});for(let a=n;a<t.length;a++)if(i[a]){let c=this._cellRefs.get(t[a].document.uri.fragment)||[],l=o.get(t[a].document.uri.fragment)||[];[...c,...l].forEach(p=>{let m=t.findIndex(h=>h.document.uri.fragment===p.uri.fragment);m!==-1&&m>=a&&(i[m]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,n,i,o=!1){if(e.has(n))for(let s of e.get(n)){let a=i.findIndex(c=>c.document.uri.fragment===s);if(a===-1){if(o)continue;throw new Error(`Dependency ${s} is not in the execution list.`)}t[a]||(t[a]=!0,this._resolveDependencies(e,t,s,i,o))}}};var X1=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(n=>{this._requestCellSymbols(n,!1).then(Ii,Ii)}),this._disposables.push(ar.workspace.onDidChangeNotebookDocument(n=>{n.notebook===this._notebookEditor.notebook&&(n.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(Ii,Ii)})}),n.cellChanges.forEach(i=>{this._requestCellSymbols(i.cell,!1).then(Ii,Ii),this._updateCellStatus(i.cell,0)}))})),this._disposables.push(ar.notebooks.onDidChangeNotebookCellExecutionState(n=>{n.state===ar.NotebookCellExecutionState.Executing&&n.cell.document.languageId==="python"&&this._updateCellStatus(n.cell,1),n.state===ar.NotebookCellExecutionState.Idle&&n.cell.document.languageId==="python"&&(this._cellExecution.push({cell:n.cell,executionCount:n.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(n.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async _requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let n=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);n&&await this._requestCellSymbols(n,!0)}}async getCellSymbolRefs(e){let t=this._cellRefs.get(e.document.uri.fragment);if(t)return t}async selectPrecedentCells(e){let t=await this.getPrecedentCells(e);this._notebookEditor.selections=t}async selectSuccessorCells(e){let t=await this.getSuccessorCells(e);this._notebookEditor.selections=t}async runPrecedentCells(e){let t=await this.getPrecedentCells(e);await ar.commands.executeCommand("notebook.cell.execute",{ranges:t.map(n=>({start:n.start,end:n.end})),document:this._notebookEditor.notebook.uri}).then(Ii,Ii)}async runSuccessorCells(e){let t=await this.getSuccessorCells(e);await ar.commands.executeCommand("notebook.cell.execute",{ranges:t.map(n=>({start:n.start,end:n.end})),document:this._notebookEditor.notebook.uri}).then(Ii,Ii)}async getPrecedentCells(e){await this._requestCellSymbolsSync();let t=new Y1(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),n=[];try{n=t.getPredecessorCells(e)}catch{try{n=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=n.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0);return eU((i===-1?n:n.slice(i)).map(s=>s.index))}async getSuccessorCells(e){await this._requestCellSymbolsSync();let n=new Y1(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e);return eU(n.map(o=>o.index))}async debugSymbols(){let e=[];await this._requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let n of ar.window.visibleTextEditors){let i=n.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(n=>{let i=n.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(n)}),t.forEach((n,i)=>{let o=ar.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];n.reduce((l,u)=>l.find(m=>tU(m.range,u.range))?l:l.concat([u]),[]).forEach(l=>{let u=new ar.Position(l.range.end.line,l.range.end.character),p=new ar.Range(u,u);l.kind==="write"?s.push(p):l.kind==="read"&&a.push(p)}),o.setDecorations(CIe,s),o.setDecorations(wIe,a)}})}async _requestCellSymbols(e,t){let n=this._pendingRequests.get(e.document.uri.fragment);if(n&&n.cancel(),t){let o=new ar.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new ar.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(Ii,Ii))},500)}async _getDocumentSymbols(e){if(this._client.getDocumentSymbols){let t=new ar.CancellationTokenSource,n=await this._client.getDocumentSymbols(e.document,t.token);if(n&&n.length>0)return t.dispose(),n}if(e.document.lineCount>1||e.document.lineAt(0).text.length>0)return ar.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let n=await this._getDocumentSymbols(e);if(!n)return;let i=[];for(let o of n){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.filter(a=>a.uri.scheme==="vscode-notebook-cell").map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:o.uri,kind:tU(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},Z1=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;ar.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new X1(t,this._client))}),this._disposables.push(ar.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(n=>{this._notebookDocumentSymbolTrackers.has(n.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(n.notebook.uri.toString(),new X1(n,this._client))}),this._notebookDocumentSymbolTrackers.forEach((n,i)=>{ar.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(n.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}getNotebookDocumentSymbolTracker(e){return this._notebookDocumentSymbolTrackers.get(e.toString())}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runSuccessorCells(t)}async runPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runPrecedentCells(t)}async selectSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},eR=class{constructor(e){this.symbolsTracker=e}async provideCodeActions(e,t,n,i){let o=ar.workspace.notebookDocuments.filter(g=>g.uri.path===e.uri.path),s,a;for(let g of o)if(s=g.getCells().find(y=>y.document.uri.toString()===e.uri.toString()),s){a=g;break}if(!s||!a)return[];let c=this.symbolsTracker.getNotebookDocumentSymbolTracker(a.uri);if(!c)return[];let l=n.diagnostics.find(g=>g.source==="Cell Execution Error"&&g.message.startsWith("NameError")&&g.message.endsWith("is not defined"));if(!l)return[];let u=l.message.match(/NameError: name '(.+)' is not defined/);if(!u)return[];let p=u[1],m=await c.getPrecedentCells(s),h=await Promise.all(fY(m).map(async g=>{let y=a?.cellAt(g);if(!y)return!1;let C=await c.getCellSymbolRefs(y);if(!C||C.length<=0)return!1;let k=C.filter(A=>A.associatedSymbol?.name===p).find(A=>A.uri.toString()===s?.document.uri.toString());if(!k)return!1;if(ZL.intersects(k.range,t))return!0}));if(i.isCancellationRequested)return[];if(h.some(g=>g)){let g=new ar.CodeAction("Run Precedent Cells",ar.CodeActionKind.QuickFix);return g.command={command:"jupyter.runPrecedentCells",title:"Run Precedent Cells",arguments:[s]},[g]}return[]}};async function yY(r){if(!Vo.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await vY();if(!t)return;let n=new Z1(t);r.subscriptions.push(n),r.subscriptions.push(Vo.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=_w(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectSuccessorCells(s,a)})),r.subscriptions.push(Vo.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=_w(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runPrecedentCells(s,a)})),r.subscriptions.push(Vo.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=_w(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runSuccessorCells(s,a)})),r.subscriptions.push(Vo.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=_w(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectPrecedentCells(s,a)})),r.subscriptions.push(Vo.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=Vo.window.activeNotebookEditor;i&&await n.debugSymbols(i.notebook)})),r.subscriptions.push(Vo.languages.registerCodeActionsProvider({language:"python",notebookType:"jupyter-notebook"},new eR(n),{providedCodeActionKinds:[Vo.CodeActionKind.QuickFix]}))}function bY(){}var Ss=D(require("vscode"));async function IY(r){r.subscriptions.push(Ss.commands.registerCommand("jupyter.listPipPackages",async e=>{let t=e??Ss.window.activeNotebookEditor?.notebook.uri;if(t){let i=await Pe.instance.get(Ke).get(t);if(i){let o=new Ss.CancellationTokenSource().token;try{let s=await EIe(i,o);if(Array.isArray(s.content))return s.content}catch(s){W("Failed to get pip packages",s)}}}return[]})),r.subscriptions.push(Ss.commands.registerCommand("jupyter.listVariables",async e=>{let t=e??Ss.window.activeNotebookEditor?.notebook.uri;if(!t)return[];let n=Ss.workspace.notebookDocuments.find(u=>u.uri.toString()===t.toString());if(!n)return[];let o=Pe.instance.get(Ct).getSelected(n);if(!o)return[];let s=o.controller.variableProvider;if(!s)return[];let a=new Ss.CancellationTokenSource().token,c=s.provideVariablesWithSummarization(n,void 0,Ss.NotebookVariablesRequestKind.Named,0,a),l=[];for await(let u of c)l.push(u);return l}))}async function EIe(r,e){let t=`import subprocess
proc = subprocess.Popen(["pip", "list", "--format", "json"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
stdout, stderr = proc.communicate()
return stdout
`.split(`
`);try{return{content:await MI(r,t,e)}}catch(n){throw n}}var tR={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0},nU=new Je;tR.codeLoadingTime=nU.elapsedTime;var iU;async function PIe(r){w9(r.subscriptions),Uj(dr.env.uiKind==dr.UIKind.Web),Wj(!1),r.subscriptions.push({dispose:()=>TS.isExiting=!0});try{let e,t;return[e,t]=await DIe(r,nU,tR),Z9(t,tR,nU).catch(f),await t,e}catch(e){return await TIe(e,tR),x("Failed to active the Jupyter Extension",e),{ready:Promise.resolve(),registerPythonApi:f,registerRemoteServerProvider:()=>({dispose:f}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0)}}}}function kIe(){if(TS.isExiting=!0,iU){let r=iU.get(ai);if(r)return r.dispose()}return bY(),Promise.resolve()}async function DIe(r,e,t){let n=le();try{_Ie(n.promise),t.startActivateTime=e.elapsedTime;let[i,o]=LIe(r);iU=o,w$(c=>o.get(Hp).getPackageVersions(c));let s=AIe(r,i,o);return t.endActivateTime=e.elapsedTime,n.resolve(),yY(r).then(f,f),IY(r).then(f,f),[Q9(s,i,o,r),s,o]}finally{n.completed||n.reject()}}function _Ie(r){let e={location:dr.ProgressLocation.Window,title:ve.loadingExtension};dr.window.withProgress(e,()=>r).then(f,f)}async function TIe(r,e){RIe(ve.handleExtensionActivationError),console.error("extension activation failed",r),x("extension activation failed",r),await e3(r,e)}function RIe(r){try{dr.window.showErrorMessage(r).then(f,f)}catch(e){x("failed to notify user",e)}}async function AIe(r,e,t){return FIe(r,e,t)}function NIe(){if(process.env.VSC_JUPYTER_FORCE_LOGGING){let r;ni||(r="Jupyter Extension:"),wA(new Q1(r))}}function xY(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function MIe(){try{let r=xY((0,Zd.userInfo)().username);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get username info with ${r}
 username will not be obfuscated in local logs`)}}function OIe(){try{let r=xY(iv().fsPath);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get home directory path with ${r}
 home Path will not be obfuscated in local logs`)}}function KIe(r,e){let t=dr.window.createOutputChannel(aN.jupyter,"log");wA(new G1(t,OIe(),MIe())),e.addSingletonInstance(Bo,t,Hu),e.addSingletonInstance(Bo,uY(r.subscriptions),bh),t.appendLine(`${dr.env.appName} (${dr.version}, ${dr.env.remoteName}, ${dr.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${r.extension.packageJSON.version}.`);let n=dr.extensions.getExtension(ii);n?t.appendLine(`Python Extension Version: ${n.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=dr.extensions.getExtension(am);i?t.appendLine(`Pylance Extension Version${h1()?"":" (Not Used) "}: ${i.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),t.appendLine(`Platform: ${(0,Zd.platform)()} (${(0,Zd.arch)()}).`),!dr.workspace.workspaceFolders||dr.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):dr.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${$(dr.workspace.workspaceFolders[0].uri)}, Home = ${Gk.fsPath}`):t.appendLine(`Multiple Workspace folders opened ${dr.workspace.workspaceFolders.map(o=>$(o.uri)).join(", ")}`)}async function FIe(r,e,t){let n=!Ar()&&(r.extensionMode===dr.ExtensionMode.Development||dr.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(w2,n),n&&dr.commands.executeCommand("setContext","jupyter.development",!0).then(f,f),dr.commands.executeCommand("setContext","jupyter.webExtension",!1).then(f,f),S2((0,Zd.homedir)()),NIe(),KIe(r,e),f$(e),nG(e,n),pz(e,n),fQ(e),QQ(r,e,n),aY(e);let i=t.get(Ds),o=new Je;await i.activate();let s=o.elapsedTime;N("DS_INTERNAL.EXPERIMENT_LOAD",{duration:s});let c=e.get(ue).getSettings();EA(c.logging.level),c.onDidChange(()=>{EA(c.logging.level)}),dr.commands.executeCommand("setContext","jupyter.vscode.channel",wo()).then(f,f),t.get(BP).activate();let l=t.get(uE);l.initialize(),r.subscriptions.push(l)}function LIe(r){let e=new SY.Container({skipBaseClassChecks:!0}),t=new sh(e),n=new Pe(e);return t.addSingletonInstance(pt,n),t.addSingletonInstance(Y9,t),t.addSingletonInstance(F,r.subscriptions),t.addSingletonInstance(He,r.globalState,bt),t.addSingletonInstance(He,r.workspaceState,si),t.addSingletonInstance(ut,r),[t,n]}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
