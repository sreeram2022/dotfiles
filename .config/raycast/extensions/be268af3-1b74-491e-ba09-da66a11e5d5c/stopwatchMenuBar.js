"use strict";var E=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var n in e)E(t,n,{get:e[n],enumerable:!0})},j=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of H(e))!k.call(t,r)&&r!==n&&E(t,r,{get:()=>e[r],enumerable:!(a=v(e,r))||a.enumerable});return t};var V=t=>j(E({},"__esModule",{value:!0}),t);var q={};A(q,{default:()=>b});module.exports=V(q);var p=require("@raycast/api"),U=require("react");var T=require("@raycast/api"),M=require("react");var m=t=>{let e=Math.floor(t/3600),n=String(Math.floor(t%3600/60)).padStart(2,"0"),a=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${n}:${a}`};var f=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var S=require("@raycast/api"),W=require("child_process"),B=require("crypto"),o=require("fs"),O=require("path");var u=require("@raycast/api"),I=(t,e)=>(t==null||t.length==0||t.length==null)&&!["always","onlyWhenNotRunning"].includes(e.showMenuBarIconWhen),P=t=>{let e=(0,u.getPreferenceValues)();if(t.launchedFromMenuBar||e.closeWindowOnTimerStart){let n=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,u.showHUD)(`${n} ${t.msg}`),(0,u.popToRoot)()}else(0,u.showToast)({style:t.isErr?u.Toast.Style.Failure:u.Toast.Style.Success,title:t.msg})};var c=S.environment.supportPath+"/raycast-stopwatches.json",l=()=>{(!(0,o.existsSync)(c)||(0,o.readFileSync)(c).toString()=="")&&(0,o.writeFileSync)(c,"[]")},N=t=>({name:t,swID:(0,B.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),_=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,f({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let n=Math.max(0,f({d2:e.timeStarted}));e.timeElapsed=n-e.pauseElapsed}}),t),$=()=>{l();let t=JSON.parse((0,o.readFileSync)(c).toString()),e=Y(t),n=_(e);return n.sort((a,r)=>a.timeElapsed-r.timeElapsed),n},J=async({swName:t="Untitled",launchedFromMenuBar:e=!1})=>{l();let n=JSON.parse((0,o.readFileSync)(c).toString()),a=N(t);n.push(a),(0,o.writeFileSync)(c,JSON.stringify(n)),(0,S.popToRoot)(),P({msg:`Stopwatch "${t}" started!`,launchedFromMenuBar:e,isErr:!1})},L=t=>{l();let e=JSON.parse((0,o.readFileSync)(c).toString());e=e.map(n=>n.swID==t?{...n,lastPaused:new Date}:n),(0,o.writeFileSync)(c,JSON.stringify(e))},x=t=>{l();let e=JSON.parse((0,o.readFileSync)(c).toString());e=e.map(n=>n.swID==t?{...n,pauseElapsed:n.pauseElapsed+f({d2:n.lastPaused}),lastPaused:"----"}:n),(0,o.writeFileSync)(c,JSON.stringify(e))},C=t=>{l();let e=JSON.parse((0,o.readFileSync)(c).toString());e=e.filter(n=>n.swID!==t),(0,o.writeFileSync)(c,JSON.stringify(e))},Y=t=>((0,o.readdirSync)(S.environment.supportPath).forEach(n=>{if((0,O.extname)(n)==".stopwatch"){let a=N((0,o.readFileSync)(S.environment.supportPath+"/"+n).toString()),r=n.replace(/__/g,":").replace(".stopwatch","");a.timeStarted=new Date(r),a.timeElapsed=Math.max(0,f({})),(0,W.execSync)(`rm "${S.environment.supportPath}/${n}"`),t.push(a)}}),(0,o.writeFileSync)(c,JSON.stringify(t)),t);function y(){let[t,e]=(0,M.useState)(void 0),[n,a]=(0,M.useState)(t===void 0),r=()=>{let i=$();e(i),a(!1)},w=i=>{J(i),r()},D=i=>{L(i),r()},h=i=>{x(i),r()},g=i=>{(0,T.getPreferenceValues)().copyOnSwStop&&T.Clipboard.copy(m(i.timeElapsed)),C(i.swID),r()};return{stopwatches:t,isLoading:n,refreshSWes:r,handleRestartSW:i=>{g(i),w({swName:i.name,launchedFromMenuBar:!1}),r()},handleStartSW:w,handleStopSW:g,handlePauseSW:D,handleUnpauseSW:h}}var F=(t,e)=>{if(t===void 0||t?.length===0||t.length==null)return;let n="timeLeft"in t[0]?t[0].timeLeft:t[0].timeElapsed;return e.showTitleInMenuBar?`${t[0].name}: ~${m(n)}`:`~${m(n)}`},R=(t,e,n)=>{switch(e.showMenuBarIconWhen){case"always":return n;case"never":return;case"onlyWhenRunning":return t!==void 0&&t?.length>0?n:void 0;case"onlyWhenNotRunning":return t===void 0||t?.length===0?n:void 0}};var d=require("react/jsx-runtime");function b(){let{stopwatches:t,isLoading:e,refreshSWes:n,handlePauseSW:a,handleStartSW:r,handleStopSW:w,handleUnpauseSW:D}=y();(0,U.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]),e&&n();let h=(0,p.getPreferenceValues)();if(I(t,h))return null;let g=s=>s.lastPaused==="----"?" elapsed":" (paused)";return(0,d.jsxs)(p.MenuBarExtra,{icon:R(t,h,p.Icon.Stopwatch),isLoading:e,title:F(t,h),children:[(0,d.jsx)(p.MenuBarExtra.Item,{title:"Click running stopwatch to pause"}),t?.map(s=>(0,d.jsx)(p.MenuBarExtra.Item,{title:s.name+": "+m(s.timeElapsed)+g(s),onAction:()=>s.lastPaused==="----"?a(s.swID):D(s.swID)},s.swID)),(0,d.jsx)(p.MenuBarExtra.Section,{children:t?.map(s=>(0,d.jsx)(p.MenuBarExtra.Item,{title:`Delete "${s.name}"`,onAction:()=>w(s)},s.swID))}),(0,d.jsx)(p.MenuBarExtra.Section,{children:(0,d.jsx)(p.MenuBarExtra.Item,{title:"Start New Stopwatch",onAction:()=>r({launchedFromMenuBar:!0})},"startSW")})]})}
